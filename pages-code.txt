# M Platform - Pages Code
# Page routes, workflows
# Generated: Fri Jan  2 06:26:14 PM UTC 2026

========================================
FILE: client/src/main.tsx
========================================
import { createRoot } from "react-dom/client";
import App from "./App";
import "./index.css";

createRoot(document.getElementById("root")!).render(<App />);


========================================
FILE: client/src/App.tsx
========================================
import { useEffect, lazy } from "react";
import { Switch, Route, useLocation } from "wouter";
import { queryClient } from "./lib/queryClient";
import { QueryClientProvider } from "@tanstack/react-query";
import { Toaster } from "@/components/ui/toaster";
import { TooltipProvider } from "@/components/ui/tooltip";
import NotFound from "@/pages/not-found";
import Landing from "@/pages/Landing";
import Dashboard from "@/pages/Dashboard";
import CrisisResponse from "@/pages/CrisisResponse";
// ScenarioTemplates consolidated into PlaybookLibrary
import UnifiedEnterprisePlatform from "@/pages/UnifiedEnterprisePlatform";
import ExecutiveSuite from "@/pages/ExecutiveSuite";
import AIIntelligence from "@/pages/AIIntelligence";
import BusinessIntelligence from "@/pages/BusinessIntelligence";
import VCPresentations from "@/pages/VCPresentations";
// ComprehensiveScenarios consolidated into PlaybookLibrary
import EnterpriseMetrics from "@/pages/EnterpriseMetrics";
import Settings from "@/pages/Settings";
import CrisisResponseCenter from "./pages/CrisisResponseCenter";
import CrisisDetail from "./pages/CrisisDetail";
import StrategicPlanningHub from "./pages/StrategicPlanningHub";
import ExecutiveAnalyticsDashboard from "./pages/ExecutiveAnalyticsDashboard";
import ComprehensiveAIIntelligence from "./pages/ComprehensiveAIIntelligence";
import RealTimeCollaboration from "./pages/RealTimeCollaboration";
import AuditLoggingCenter from "./pages/AuditLoggingCenter";
import IntegrationHub from "./pages/IntegrationHub";
import IntegrationsPage from "./pages/IntegrationsPage";
import AdvancedAnalytics from "./pages/AdvancedAnalytics";
import TriggersManagement from "./pages/TriggersManagement";
import PulseIntelligence from "./pages/PulseIntelligence";
import FluxAdaptations from "./pages/FluxAdaptations";
import PrismInsights from "./pages/PrismInsights";
import EchoCulturalAnalytics from "./pages/EchoCulturalAnalytics";
import NovaInnovations from "./pages/NovaInnovations";
import ExecutiveWarRoomPage from "./pages/ExecutiveWarRoomPage";
import UATAdmin from "./pages/UATAdmin";
import PlaybookActivationConsole from "./pages/PlaybookActivationConsole";
import WhatIfAnalyzer from "./pages/WhatIfAnalyzer";
import PreparednessReport from "./pages/PreparednessReport";
import PlaybookLibraryV2 from "./pages/PlaybookLibraryV2";
import PlaybookDetail from "./pages/PlaybookDetail";
import PlaybookCommand from "./pages/PlaybookCommand";
import PlaybookSettings from "./pages/PlaybookSettings";
import PracticeDrills from "./pages/PracticeDrills";
import LiveDrillExecution from "./pages/LiveDrillExecution";
import NFLLearningDashboard from "./pages/NFLLearningDashboard";
import DemoRouter from "./pages/DemoRouter";
import InvestorDemo from "./pages/InvestorDemo";
import CustomerDemo from "./pages/CustomerDemo";
import RoadshowResources from "./pages/RoadshowResources";
import AIIntelligenceHub from "./pages/AIIntelligenceHub";
import IntelligenceControlCenter from "./pages/IntelligenceControlCenter";
import ExecutiveScorecard from "./pages/ExecutiveScorecard";
import AIRadarDashboard from "./pages/AIRadarDashboard";
import SignalIntelligenceHub from "./pages/SignalIntelligenceHub";
import InstitutionalMemory from "./pages/InstitutionalMemory";
import DrillTrackingSystem from "./pages/DrillTrackingSystem";
import BoardBriefings from "./pages/BoardBriefings";
import MarketingLanding from "./pages/MarketingLanding";
// ScenarioGallery consolidated into PlaybookLibrary
import InvestorLanding from "./pages/InvestorLanding";
import InvestorResources from "./pages/InvestorResources";
import DecisionVelocityPage from "./pages/DecisionVelocityPage";
import DecisionVelocityDashboard from "./pages/DecisionVelocityDashboard";
import DecisionTreeBuilder from "./pages/DecisionTreeBuilder";
import ExecutionCoordination from "./pages/ExecutionCoordination";
import OperatingModelHealthReport from "./pages/OperatingModelHealthReport";
import OperatingModelAlignment from "./pages/OperatingModelAlignment";
import ComprehensiveROIBreakdown from "./pages/ComprehensiveROIBreakdown";
import OurStory from "./pages/OurStory";
import WhyM from "./pages/WhyM";
import Research from "./pages/Research";
import Contact from "./pages/Contact";
import Pricing from "./pages/Pricing";
import PilotMonitoring from "./pages/PilotMonitoring";
import CrisisExposureMatrix from "./pages/CrisisExposureMatrix";
import SimulationStudio from "./pages/SimulationStudio";
import LuxuryCrisisDemo from "./pages/LuxuryCrisisDemo";
import IndustryDemosHub from "./pages/IndustryDemosHub";
import FinancialRansomwareDemo from "./pages/FinancialRansomwareDemo";
import LVMHMarketEntryDemo from "./pages/LVMHMarketEntryDemo";
import SHEINTrendDemo from "./pages/SHEINTrendDemo";
import SpaceXLaunchDemo from "./pages/SpaceXLaunchDemo";
import PharmaceuticalRecallDemo from "./pages/PharmaceuticalRecallDemo";
import ManufacturingSupplierDemo from "./pages/ManufacturingSupplierDemo";
import RetailFoodSafetyDemo from "./pages/RetailFoodSafetyDemo";
import EnergyGridFailureDemo from "./pages/EnergyGridFailureDemo";
import DemoLiveActivation from "./pages/DemoLiveActivation";
import RoleSelector from "./pages/RoleSelector";
import Homepage from "./pages/Homepage";
import McKinseyIntelligenceCenter from "./pages/mckinsey/McKinseyIntelligenceCenter";
import FutureReadinessDashboard from "./pages/FutureReadinessDashboard";
import ExecutiveDashboard from "./pages/ExecutiveDashboard";
import Sitemap from "./pages/Sitemap";
import CommandCenter from "./pages/CommandCenter";
// ScenarioLibraryPage consolidated into PlaybookLibrary
import FutureGym from "./pages/FutureGym";
import ForesightRadar from "./pages/ForesightRadar";
import LivingPlaybooks from "./pages/LivingPlaybooks";
import ContinuousModePage from "./pages/ContinuousModePage";
import PlaybookReadinessAudit from "./pages/PlaybookReadinessAudit";
import ExecutiveSimulationDemo from "./pages/ExecutiveSimulationDemo";
import ProductTour from "./pages/ProductTour";
import InvestorPresentation from "./pages/InvestorPresentation";
import OrganizationSetup from "./pages/OrganizationSetup";
import PlaybookCustomization from "./pages/PlaybookCustomization";
import PlaybookCustomize from "./pages/PlaybookCustomize";
import SuccessMetricsConfiguration from "./pages/SuccessMetricsConfiguration";
import OnboardingWizard from "./pages/OnboardingWizard";
import NewUserJourney from "./pages/NewUserJourney";
import CompetitivePositioning from "./pages/CompetitivePositioning";
import PilotProgram from "./pages/PilotProgram";
import HowItWorks from "./pages/HowItWorks";
import OneClickDemo from "./pages/OneClickDemo";
import ROICalculator from "./pages/ROICalculator";
import BoardExport from "./pages/BoardExport";
import SandboxDemo from "./pages/SandboxDemo";
import PlaybookManagement from "./pages/PlaybookManagement";
import TaskManagement from "./pages/TaskManagement";
import StakeholderManagement from "./pages/StakeholderManagement";
import { DemoControllerProvider } from "./contexts/DemoController";
import { DemoTimelineProvider } from "./contexts/DemoTimelineContext";
import { DynamicStrategyProvider } from "./contexts/DynamicStrategyContext";
import { OnboardingProvider } from "./contexts/OnboardingContext";
import { CustomerProvider } from "./contexts/CustomerContext";
import OnboardingOverlay from "./components/onboarding/OnboardingOverlay";
import { ThemeProvider } from "./components/ThemeProvider";
import { useAuth } from "./hooks/useAuth";
import GuidedOverlay from "./components/demo/GuidedOverlay";
import { HeroMetricsOverlay } from "./components/demo/HeroMetricsOverlay";
import { CrisisResolvedCelebration } from "./components/demo/CrisisResolvedCelebration";
import { PowerfulCTA } from "./components/demo/PowerfulCTA";
import { CostOfInactionOverlay } from "./components/demo/CostOfInactionOverlay";
import { PersonalReputationRiskOverlay } from "./components/demo/PersonalReputationRiskOverlay";
import { PeerAdoptionOverlay } from "./components/demo/PeerAdoptionOverlay";
import { ExecutiveTestimonialOverlay } from "./components/demo/ExecutiveTestimonialOverlay";
import { SplitScreenComparison } from "./components/demo/SplitScreenComparison";
import { ScrollToTop } from "./components/ScrollToTop";

function HomeRoute() {
  // Show new professional homepage for everyone - no authentication required
  return <Homepage />;
}

// Redirect component for deprecated routes
function RedirectToScenarios() {
  const [, setLocation] = useLocation();
  
  useEffect(() => {
    setLocation('/business-scenarios');
  }, [setLocation]);
  
  return null;
}

// Redirect all legacy scenario/template pages to unified Playbooks page
function RedirectToPlaybookLibrary() {
  const [, setLocation] = useLocation();
  
  useEffect(() => {
    setLocation('/playbooks');
  }, [setLocation]);
  
  return null;
}

// Redirect all demo routes to the unified How It Works page
function RedirectToHowItWorks() {
  const [, setLocation] = useLocation();
  
  useEffect(() => {
    setLocation('/how-it-works');
  }, [setLocation]);
  
  return null;
}

// Redirect all legacy dashboard pages to unified Executive Dashboard
function RedirectToExecutiveDashboard() {
  const [, setLocation] = useLocation();
  
  useEffect(() => {
    setLocation('/executive-dashboard');
  }, [setLocation]);
  
  return null;
}

// Redirect all legacy demo pages to unified Demo Hub
function RedirectToDemoHub() {
  const [, setLocation] = useLocation();
  
  useEffect(() => {
    setLocation('/demo-hub');
  }, [setLocation]);
  
  return null;
}

// Redirect all legacy intelligence pages to Intelligence Control Center
function RedirectToIntelligence() {
  const [, setLocation] = useLocation();
  
  useEffect(() => {
    setLocation('/intelligence');
  }, [setLocation]);
  
  return null;
}

// Redirect legacy trigger routes to triggers management
function RedirectToTriggersManagement() {
  const [, setLocation] = useLocation();
  
  useEffect(() => {
    setLocation('/triggers-management');
  }, [setLocation]);
  
  return null;
}

function Router() {
  const [location] = useLocation();
  
  return (
    <DemoTimelineProvider defaultDuration={720000} defaultSpeedMultiplier={20}>
      <DemoControllerProvider>
        <ScrollToTop />
        <Switch>
        {/* Primary Routes - Simplified Executive Experience */}
        <Route path="/" component={Homepage} />
        <Route path="/home" component={Homepage} />
        <Route path="/executive-dashboard" component={ExecutiveDashboard} />
        <Route path="/scorecard" component={RedirectToExecutiveDashboard} />
        <Route path="/executive-scorecard" component={RedirectToExecutiveDashboard} />
        <Route path="/executive-suite" component={RedirectToExecutiveDashboard} />
        <Route path="/dashboard" component={RedirectToExecutiveDashboard} />
        <Route path="/platform" component={RedirectToExecutiveDashboard} />
        <Route path="/business-intelligence" component={BusinessIntelligence} />
        
        {/* Strategic Operations */}
        <Route path="/strategic-monitoring" component={CrisisResponseCenter} />
        <Route path="/strategic-monitoring/:id" component={CrisisDetail} />
        <Route path="/command-center" component={ExecutiveWarRoomPage} />
        <Route path="/collaboration" component={RealTimeCollaboration} />
        <Route path="/playbook-activation/:triggerId/:playbookId" component={PlaybookActivationConsole} />
        
        {/* Strategic Planning */}
        <Route path="/strategic" component={StrategicPlanningHub} />
        <Route path="/what-if-analyzer" component={WhatIfAnalyzer} />
        <Route path="/decision-velocity" component={DecisionVelocityPage} />
        <Route path="/decisions" component={DecisionVelocityDashboard} />
        <Route path="/decision-trees" component={DecisionTreeBuilder} />
        <Route path="/execution-coordination" component={ExecutionCoordination} />
        <Route path="/scenarios" component={RedirectToPlaybookLibrary} />
        <Route path="/institutional-memory" component={InstitutionalMemory} />
        <Route path="/board-briefings" component={BoardBriefings} />
        <Route path="/operating-model" component={OperatingModelAlignment} />
        <Route path="/operating-model-health" component={RedirectToExecutiveDashboard} />
        <Route path="/roi-breakdown" component={ComprehensiveROIBreakdown} />
        <Route path="/our-story" component={OurStory} />
        <Route path="/why-m" component={WhyM} />
        <Route path="/research" component={Research} />
        <Route path="/how-it-works" component={HowItWorks} />
        <Route path="/pricing" component={Pricing} />
        <Route path="/competitive-positioning" component={CompetitivePositioning} />
        <Route path="/pilot-program" component={PilotProgram} />
        <Route path="/contact" component={Contact} />
        <Route path="/early-access" component={Contact} />
        
        {/* Intelligence Control Center - Unified Entry Point */}
        <Route path="/intelligence" component={IntelligenceControlCenter} />
        <Route path="/intelligence-control-center" component={IntelligenceControlCenter} />
        
        {/* AI Intelligence - Consolidated Hub */}
        <Route path="/ai" component={AIIntelligenceHub} />
        <Route path="/ai-radar" component={AIRadarDashboard} />
        <Route path="/signal-intelligence" component={SignalIntelligenceHub} />
        <Route path="/pulse" component={AIIntelligenceHub} />
        <Route path="/flux" component={AIIntelligenceHub} />
        <Route path="/prism" component={AIIntelligenceHub} />
        <Route path="/echo" component={AIIntelligenceHub} />
        <Route path="/nova" component={AIIntelligenceHub} />
        
        {/* AI Intelligence - Individual Module Pages */}
        <Route path="/pulse-intelligence" component={PulseIntelligence} />
        <Route path="/flux-adaptations" component={FluxAdaptations} />
        <Route path="/prism-insights" component={PrismInsights} />
        <Route path="/echo-cultural-analytics" component={EchoCulturalAnalytics} />
        <Route path="/nova-innovations" component={NovaInnovations} />
        
        {/* Dynamic Strategy - Future Readiness (redirected to Executive Dashboard) */}
        <Route path="/future-readiness" component={RedirectToExecutiveDashboard} />
        <Route path="/readiness" component={RedirectToExecutiveDashboard} />
        <Route path="/command-center-dynamic" component={CommandCenter} />
        <Route path="/scenario-library" component={RedirectToPlaybookLibrary} />
        <Route path="/scenario-gallery" component={RedirectToPlaybookLibrary} />
        <Route path="/comprehensive-scenarios" component={RedirectToPlaybookLibrary} />
        <Route path="/triggers" component={RedirectToTriggersManagement} />
        <Route path="/trigger-dashboard" component={RedirectToTriggersManagement} />
        <Route path="/playbook-readiness" component={PlaybookReadinessAudit} />
        <Route path="/playbook-audit" component={PlaybookReadinessAudit} />
        <Route path="/future-gym" component={FutureGym} />
        <Route path="/foresight-radar" component={ForesightRadar} />
        <Route path="/living-playbooks" component={LivingPlaybooks} />
        <Route path="/continuous-mode" component={ContinuousModePage} />
        
        {/* McKinsey Intelligence Center */}
        <Route path="/mckinsey" component={McKinseyIntelligenceCenter} />
        <Route path="/mckinsey-intelligence" component={McKinseyIntelligenceCenter} />
        
        {/* Triggers & Preparedness */}
        <Route path="/triggers-management" component={TriggersManagement} />
        <Route path="/organization-setup" component={OrganizationSetup} />
        <Route path="/playbook-customization" component={PlaybookCustomization} />
        <Route path="/success-metrics" component={SuccessMetricsConfiguration} />
        <Route path="/onboarding" component={OnboardingWizard} />
        <Route path="/setup" component={OnboardingWizard} />
        <Route path="/get-started" component={OnboardingWizard} />
        <Route path="/new-user-journey" component={NewUserJourney} />
        <Route path="/start" component={NewUserJourney} />
        <Route path="/welcome" component={NewUserJourney} />
        <Route path="/journey" component={NewUserJourney} />
        <Route path="/experience" component={NewUserJourney} />
        <Route path="/preparedness-report" component={PreparednessReport} />
        <Route path="/drill-tracking" component={DrillTrackingSystem} />
        <Route path="/playbook-library" component={PlaybookLibraryV2} />
        <Route path="/identify/playbook-library" component={PlaybookLibraryV2} />
        <Route path="/identify/playbook-command/:id" component={PlaybookCommand} />
        <Route path="/playbooks" component={PlaybookLibraryV2} />
        <Route path="/playbooks/:id/customize" component={PlaybookCustomize} />
        <Route path="/playbooks/:id/preview" component={PlaybookDetail} />
        <Route path="/playbooks/:id/edit" component={PlaybookCustomize} />
        <Route path="/playbooks/create" component={PlaybookCustomize} />
        <Route path="/playbook-management" component={PlaybookManagement} />
        <Route path="/playbook-customize/new" component={PlaybookCustomize} />
        <Route path="/playbook-customize/:id" component={PlaybookCustomize} />
        <Route path="/task-management" component={TaskManagement} />
        <Route path="/stakeholder-management" component={StakeholderManagement} />
        <Route path="/stakeholders" component={StakeholderManagement} />
        <Route path="/playbook-library/:id" component={PlaybookDetail} />
        <Route path="/playbook-library/:id/settings" component={PlaybookSettings} />
        <Route path="/playbook-command/:id" component={PlaybookCommand} />
        <Route path="/practice-drills/:drillId/live" component={LiveDrillExecution} />
        <Route path="/practice-drills" component={PracticeDrills} />
        <Route path="/crisis-exposure-matrix" component={CrisisExposureMatrix} />
        <Route path="/simulation-studio" component={SimulationStudio} />
        <Route path="/nfl-learning" component={NFLLearningDashboard} />
        
        {/* Analytics */}
        <Route path="/analytics" component={AdvancedAnalytics} />
        <Route path="/executive-analytics-dashboard" component={ExecutiveAnalyticsDashboard} />
        <Route path="/audit-logging-center" component={AuditLoggingCenter} />
        <Route path="/calculator" component={ComprehensiveROIBreakdown} />
        <Route path="/roi-calculator" component={ROICalculator} />
        
        {/* Sales & Demo Tools */}
        <Route path="/live-demo" component={OneClickDemo} />
        <Route path="/board-export" component={BoardExport} />
        <Route path="/sandbox-demo" component={SandboxDemo} />
        <Route path="/try-it" component={SandboxDemo} />
        
        {/* Integration Hub */}
        <Route path="/integration-hub" component={IntegrationHub} />
        <Route path="/integrations" component={IntegrationsPage} />
        
        {/* Demo Entry Point - Single clear path */}
        <Route path="/demo" component={DemoRouter} />
        <Route path="/demo-hub" component={DemoRouter} />
        <Route path="/demo-selector" component={DemoRouter} />
        <Route path="/demo/selector" component={DemoRouter} />
        <Route path="/transformational-demo" component={DemoRouter} />
        <Route path="/four-phase-demo" component={DemoRouter} />
        <Route path="/4-phase-demo" component={DemoRouter} />
        
        {/* Live Interactive Demos - All 7 demos now use unified DemoLiveActivation component */}
        <Route path="/role-selector" component={RoleSelector} />
        <Route path="/demo/role-selector" component={RoleSelector} />
        <Route path="/demo/live-activation" component={DemoLiveActivation} />
        <Route path="/demo/ransomware" component={DemoLiveActivation} />
        <Route path="/demo/ma-integration" component={DemoLiveActivation} />
        <Route path="/demo/product-launch" component={DemoLiveActivation} />
        <Route path="/demo/supplier-crisis" component={DemoLiveActivation} />
        <Route path="/demo/competitive-response" component={DemoLiveActivation} />
        <Route path="/demo/regulatory-crisis" component={DemoLiveActivation} />
        <Route path="/demo/customer-crisis" component={DemoLiveActivation} />
        
        {/* Approval Pages - Magic Link Approvals */}
        <Route path="/approval-success" component={lazy(() => import('./pages/ApprovalSuccess'))} />
        <Route path="/approval-error" component={lazy(() => import('./pages/ApprovalError'))} />
        
        {/* Industry Demos Hub - Centralized Demo Access */}
        <Route path="/industry-demos" component={IndustryDemosHub} />
        <Route path="/crisis-demos" component={IndustryDemosHub} />
        
        {/* Industry-Specific Crisis Demos */}
        <Route path="/luxury-demo" component={LuxuryCrisisDemo} />
        <Route path="/luxury-crisis-demo" component={LuxuryCrisisDemo} />
        <Route path="/financial-demo" component={FinancialRansomwareDemo} />
        <Route path="/pharma-demo" component={PharmaceuticalRecallDemo} />
        <Route path="/manufacturing-demo" component={ManufacturingSupplierDemo} />
        <Route path="/retail-demo" component={RetailFoodSafetyDemo} />
        <Route path="/energy-demo" component={EnergyGridFailureDemo} />
        
        {/* Strategic Opportunity Demos (Offensive Coordination) */}
        <Route path="/lvmh-demo" component={LVMHMarketEntryDemo} />
        <Route path="/shein-demo" component={SHEINTrendDemo} />
        <Route path="/spacex-demo" component={SpaceXLaunchDemo} />
        
        {/* Additional Demo Experiences */}
        <Route path="/demos" component={DemoRouter} />
        <Route path="/intelligence-demo" component={DemoRouter} />
        <Route path="/signals-demo" component={DemoRouter} />
        <Route path="/executive-simulation" component={ExecutiveSimulationDemo} />
        <Route path="/simulation-demo" component={ExecutiveSimulationDemo} />
        <Route path="/product-tour" component={ProductTour} />
        <Route path="/video-tour" component={ProductTour} />
        <Route path="/investor-presentation" component={InvestorPresentation} />
        <Route path="/investor-demo" component={InvestorDemo} />
        <Route path="/customer-demo" component={CustomerDemo} />
        <Route path="/investor-resources" component={InvestorResources} />
        <Route path="/roadshow-resources" component={RoadshowResources} />
        <Route path="/roadshow" component={RoadshowResources} />
        <Route path="/pitch-deck" component={InvestorPresentation} />
        
        {/* Legacy demos - redirect to main demo paths */}
        <Route path="/watch-demo" component={DemoRouter} />
        <Route path="/trade-show-demo" component={DemoRouter} />
        <Route path="/executive-demo" component={DemoRouter} />
        <Route path="/hybrid-demo" component={DemoRouter} />
        <Route path="/executive-demo-walkthrough" component={DemoRouter} />
        
        {/* Legacy Routes */}
        <Route path="/interactive-demo" component={RedirectToHowItWorks} />
        <Route path="/interactive-master-demo" component={RedirectToHowItWorks} />
        <Route path="/investor-landing" component={RedirectToHowItWorks} />
        
        {/* Playbook Library - 166 Strategic Playbooks */}
        <Route path="/business-scenarios" component={PlaybookLibraryV2} />
        <Route path="/business-scenario/:id" component={PlaybookDetail} />
        
        {/* Settings & Administration */}
        <Route path="/vc-presentations" component={VCPresentations} />
        <Route path="/settings" component={Settings} />
        <Route path="/uat-admin" component={UATAdmin} />
        <Route path="/pilot-monitoring" component={PilotMonitoring} />
        <Route path="/sitemap" component={Sitemap} />
        
        {/* Landing Page */}
        <Route path="/landing" component={Landing} />
        
        {/* Legacy Routes - Redirects for backwards compatibility */}
        <Route path="/login" component={Landing} />
        <Route path="/comprehensive-homepage" component={ExecutiveScorecard} />
        <Route path="/templates" component={RedirectToPlaybookLibrary} />
        <Route path="/crisis" component={CrisisResponseCenter} />
        <Route path="/crisis/:id" component={CrisisDetail} />
        <Route path="/war-room" component={ExecutiveWarRoomPage} />
        <Route path="/crisis-response-center" component={CrisisResponseCenter} />
        <Route path="/strategic-planning-hub" component={StrategicPlanningHub} />
        <Route path="/advanced-analytics" component={AdvancedAnalytics} />
        
          <Route component={NotFound} />
        </Switch>
      </DemoControllerProvider>
    </DemoTimelineProvider>
  );
}

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <CustomerProvider>
        <DynamicStrategyProvider>
          <OnboardingProvider>
            <ThemeProvider>
              <TooltipProvider>
                <Toaster />
                <OnboardingOverlay />
                <Router />
              </TooltipProvider>
            </ThemeProvider>
          </OnboardingProvider>
        </DynamicStrategyProvider>
      </CustomerProvider>
    </QueryClientProvider>
  );
}

export default App;


========================================
FILE: client/src/index.css
========================================
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --background: hsl(210, 45%, 98%);
  --foreground: hsl(215, 25%, 15%);
  --card: hsl(0, 0%, 100%);
  --card-foreground: hsl(215, 25%, 15%);
  --popover: hsl(0, 0%, 100%);
  --popover-foreground: hsl(215, 25%, 15%);
  --primary: hsl(220, 90%, 56%);
  --primary-foreground: hsl(0, 0%, 100%);
  --secondary: hsl(210, 40%, 96%);
  --secondary-foreground: hsl(215, 25%, 25%);
  --muted: hsl(210, 40%, 96%);
  --muted-foreground: hsl(215, 15%, 55%);
  --accent: hsl(220, 90%, 56%);
  --accent-foreground: hsl(0, 0%, 100%);
  --destructive: hsl(0, 84%, 60%);
  --destructive-foreground: hsl(0, 0%, 100%);
  --border: hsl(214, 32%, 91%);
  --input: hsl(214, 32%, 91%);
  --ring: hsl(220, 90%, 56%);
  --chart-1: hsl(220, 90%, 56%);
  --chart-2: hsl(160, 60%, 45%);
  --chart-3: hsl(30, 80%, 55%);
  --chart-4: hsl(280, 65%, 60%);
  --chart-5: hsl(340, 75%, 55%);
  --sidebar-background: hsl(222, 47%, 11%);
  --sidebar-foreground: hsl(210, 40%, 98%);
  --sidebar-primary: hsl(220, 90%, 56%);
  --sidebar-primary-foreground: hsl(0, 0%, 100%);
  --sidebar-accent: hsl(217, 33%, 17%);
  --sidebar-accent-foreground: hsl(210, 40%, 98%);
  --sidebar-border: hsl(217, 33%, 17%);
  --sidebar-ring: hsl(220, 90%, 56%);
  --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
  --font-serif: Georgia, serif;
  --font-mono: Menlo, monospace;
  --radius: 0.5rem;
}

.dark {
  --background: hsl(222, 47%, 6%);
  --foreground: hsl(210, 40%, 98%);
  --card: hsl(222, 47%, 11%);
  --card-foreground: hsl(210, 40%, 98%);
  --popover: hsl(222, 47%, 11%);
  --popover-foreground: hsl(210, 40%, 98%);
  --primary: hsl(220, 90%, 56%);
  --primary-foreground: hsl(0, 0%, 100%);
  --secondary: hsl(217, 33%, 17%);
  --secondary-foreground: hsl(210, 40%, 98%);
  --muted: hsl(217, 33%, 17%);
  --muted-foreground: hsl(215, 20%, 65%);
  --accent: hsl(220, 90%, 56%);
  --accent-foreground: hsl(210, 40%, 98%);
  --destructive: hsl(0, 63%, 31%);
  --destructive-foreground: hsl(210, 40%, 98%);
  --border: hsl(217, 33%, 17%);
  --input: hsl(217, 33%, 17%);
  --ring: hsl(220, 90%, 56%);
  --chart-1: hsl(220, 90%, 66%);
  --chart-2: hsl(160, 60%, 55%);
  --chart-3: hsl(30, 80%, 65%);
  --chart-4: hsl(280, 65%, 70%);
  --chart-5: hsl(340, 75%, 65%);
  --sidebar-background: hsl(222, 47%, 8%);
  --sidebar-foreground: hsl(210, 40%, 98%);
  --sidebar-primary: hsl(220, 90%, 56%);
  --sidebar-primary-foreground: hsl(0, 0%, 100%);
  --sidebar-accent: hsl(217, 33%, 17%);
  --sidebar-accent-foreground: hsl(210, 40%, 98%);
  --sidebar-border: hsl(217, 33%, 17%);
  --sidebar-ring: hsl(220, 90%, 56%);
}

@layer base {
  * {
    @apply border-border;
  }
  
  body {
    @apply font-sans antialiased bg-background text-foreground;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  nav ul, nav li, [role="navigation"] ul, [role="navigation"] li,
  [data-radix-navigation-menu-list] {
    list-style: none !important;
    margin: 0;
    padding: 0;
  }
}

html {
  scroll-behavior: smooth;
}

.sidebar-nav-item:hover {
  background-color: hsl(217, 33%, 17%);
}

.real-time-indicator {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

@keyframes skeleton-loading {
  0% { background-position: -200px 0; }
  100% { background-position: calc(200px + 100%) 0; }
}

.skeleton {
  background: linear-gradient(
    90deg,
    hsl(217, 33%, 17%) 25%,
    hsl(217, 33%, 25%) 50%,
    hsl(217, 33%, 17%) 75%
  );
  background-size: 200px 100%;
  animation: skeleton-loading 1.5s infinite;
}

button, a {
  @apply transition-all duration-200;
}

/* ========================================
   M DESIGN SYSTEM - Standardized Classes
   ======================================== */

/* Typography System */
.text-title {
  @apply text-3xl font-bold text-slate-900 dark:text-white;
}

.text-subtitle {
  @apply text-lg text-slate-600 dark:text-slate-400;
}

.text-body {
  @apply text-base text-slate-700 dark:text-slate-300;
}

.text-caption {
  @apply text-sm text-slate-500 dark:text-slate-400;
}

.text-label {
  @apply text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400;
}

/* Page Backgrounds - Unified gradients */
.page-background {
  @apply bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-blue-950;
}

.page-hero {
  @apply bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white;
}

.page-hero-light {
  @apply bg-gradient-to-br from-slate-50 via-blue-50 to-white dark:from-slate-900 dark:via-blue-900 dark:to-slate-900;
}

/* Card Styles */
.card-bg {
  @apply bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl shadow-sm;
}

.card-elevated {
  @apply bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl shadow-lg;
}

.card-interactive {
  @apply bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl shadow-sm 
         hover:shadow-md hover:border-blue-300 dark:hover:border-blue-700 transition-all cursor-pointer;
}

/* Metric Cards */
.metric-card {
  @apply bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-4;
}

.metric-value {
  @apply text-3xl font-bold text-slate-900 dark:text-white;
}

.metric-label {
  @apply text-sm text-slate-500 dark:text-slate-400;
}

/* Status Indicators */
.status-success {
  @apply text-emerald-600 dark:text-emerald-400;
}

.status-warning {
  @apply text-amber-600 dark:text-amber-400;
}

.status-error {
  @apply text-red-600 dark:text-red-400;
}

.status-info {
  @apply text-blue-600 dark:text-blue-400;
}

/* Badge Variants */
.badge-phase {
  @apply px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide;
}

.badge-prepare {
  @apply bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300;
}

.badge-monitor {
  @apply bg-violet-100 text-violet-700 dark:bg-violet-900/50 dark:text-violet-300;
}

.badge-execute {
  @apply bg-emerald-100 text-emerald-700 dark:bg-emerald-900/50 dark:text-emerald-300;
}

.badge-learn {
  @apply bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300;
}

/* Section Headers */
.section-header {
  @apply flex items-center justify-between mb-6;
}

.section-title {
  @apply text-2xl font-bold text-slate-900 dark:text-white;
}

/* Container Utilities */
.container-narrow {
  @apply max-w-4xl mx-auto px-6;
}

.container-wide {
  @apply max-w-7xl mx-auto px-6;
}

.container-full {
  @apply w-full px-6;
}

/* Dividers */
.divider {
  @apply border-t border-slate-200 dark:border-slate-800;
}

.divider-vertical {
  @apply border-l border-slate-200 dark:border-slate-800;
}

/* Focus States */
.focus-ring {
  @apply focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-slate-900;
}

/* Animation Utilities */
.animate-fade-in {
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Scrollbar Styling */
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  @apply bg-slate-100 dark:bg-slate-800 rounded;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  @apply bg-slate-300 dark:bg-slate-600 rounded hover:bg-slate-400 dark:hover:bg-slate-500;
}


========================================
FILE: client/src/pages/AdvancedAnalytics.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Progress } from '@/components/ui/progress';
import { Link } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import { AIChat } from '@/components/AIChat';
import { 
  TrendingUp, 
  BarChart3, 
  Target, 
  DollarSign,
  AlertTriangle,
  Brain,
  Activity,
  Globe,
  Users,
  Zap,
  Clock,
  CheckCircle,
  ArrowUp,
  ArrowDown,
  Minus,
  ArrowLeft,
  Home,
  MessageSquare
} from 'lucide-react';

interface PredictiveModel {
  id: string;
  name: string;
  type: 'revenue' | 'market_share' | 'customer_churn' | 'operational_efficiency' | 'risk_assessment';
  accuracy: number;
  confidenceInterval: {
    lower: number;
    upper: number;
  };
  predictions: {
    period: string;
    value: number;
    probability: number;
    factors: string[];
  }[];
  keyDrivers: {
    factor: string;
    impact: number;
    trend: 'positive' | 'negative' | 'stable';
    significance: number;
  }[];
  scenarios: {
    name: string;
    probability: number;
    outcome: number;
    description: string;
  }[];
}

interface BusinessIntelligence {
  id: string;
  category: 'market' | 'financial' | 'operational' | 'competitive' | 'regulatory';
  insight: string;
  impact: 'high' | 'medium' | 'low';
  timeHorizon: 'immediate' | 'short_term' | 'long_term';
  actionRequired: boolean;
  quantifiedValue: number;
  riskLevel: number;
  sources: string[];
  recommendations: {
    action: string;
    priority: number;
    estimatedROI: number;
    timeToImplement: string;
  }[];
}

interface IndustryBenchmark {
  metric: string;
  ourPerformance: number;
  industryAverage: number;
  topQuartile: number;
  percentileRank: number;
  improvementPotential: number;
  competitiveGap: number;
  trends: {
    period: string;
    value: number;
    industryValue: number;
  }[];
}

export default function AdvancedAnalytics() {
  const [activeTab, setActiveTab] = useState('predictive');
  const [predictiveModels, setPredictiveModels] = useState<PredictiveModel[]>([]);
  const [businessIntelligence, setBusinessIntelligence] = useState<BusinessIntelligence[]>([]);
  const [industryBenchmarks, setIndustryBenchmarks] = useState<IndustryBenchmark[]>([]);

  useEffect(() => {
    // Advanced Predictive Models
    const models: PredictiveModel[] = [
      {
        id: 'revenue-forecast',
        name: 'Revenue Forecasting Model',
        type: 'revenue',
        accuracy: 94.7,
        confidenceInterval: { lower: 92.1, upper: 97.3 },
        predictions: [
          { period: 'Q2 2024', value: 3200000, probability: 87.3, factors: ['market expansion', 'product launch', 'seasonal trends'] },
          { period: 'Q3 2024', value: 3850000, probability: 82.1, factors: ['new customer acquisition', 'price optimization'] },
          { period: 'Q4 2024', value: 4100000, probability: 78.9, factors: ['holiday seasonality', 'enterprise contracts'] }
        ],
        keyDrivers: [
          { factor: 'Customer Acquisition Rate', impact: 0.34, trend: 'positive', significance: 0.92 },
          { factor: 'Average Contract Value', impact: 0.28, trend: 'positive', significance: 0.87 },
          { factor: 'Market Expansion', impact: 0.23, trend: 'positive', significance: 0.81 },
          { factor: 'Competitive Pressure', impact: -0.15, trend: 'negative', significance: 0.76 }
        ],
        scenarios: [
          { name: 'Best Case', probability: 15, outcome: 4500000, description: 'Major enterprise wins + market expansion success' },
          { name: 'Expected', probability: 70, outcome: 3850000, description: 'Normal growth trajectory with current initiatives' },
          { name: 'Conservative', probability: 15, outcome: 3200000, description: 'Market headwinds + delayed initiatives' }
        ]
      },
      {
        id: 'churn-prediction',
        name: 'Customer Churn Risk Model',
        type: 'customer_churn',
        accuracy: 91.2,
        confidenceInterval: { lower: 89.8, upper: 92.6 },
        predictions: [
          { period: 'Next 30 Days', value: 3.2, probability: 94.1, factors: ['engagement decline', 'support tickets', 'usage patterns'] },
          { period: 'Next 90 Days', value: 8.7, probability: 89.3, factors: ['contract renewal timing', 'competitive activity'] },
          { period: 'Next 180 Days', value: 15.4, probability: 83.7, factors: ['budget cycles', 'feature gap analysis'] }
        ],
        keyDrivers: [
          { factor: 'Product Engagement Score', impact: -0.42, trend: 'negative', significance: 0.95 },
          { factor: 'Support Ticket Volume', impact: 0.31, trend: 'positive', significance: 0.88 },
          { factor: 'Feature Utilization', impact: -0.29, trend: 'stable', significance: 0.82 },
          { factor: 'Contract Value', impact: -0.18, trend: 'stable', significance: 0.74 }
        ],
        scenarios: [
          { name: 'High Risk', probability: 20, outcome: 22.1, description: 'Major product issues + competitive pressure' },
          { name: 'Baseline', probability: 65, outcome: 8.7, description: 'Normal churn patterns with current interventions' },
          { name: 'Optimized', probability: 15, outcome: 4.2, description: 'Successful retention programs + product improvements' }
        ]
      }
    ];

    // Business Intelligence Insights
    const intelligence: BusinessIntelligence[] = [
      {
        id: 'market-opportunity',
        category: 'market',
        insight: 'AI automation market segment shows 67% growth potential with $4.2M revenue opportunity in next 18 months',
        impact: 'high',
        timeHorizon: 'short_term',
        actionRequired: true,
        quantifiedValue: 4200000,
        riskLevel: 23,
        sources: ['Gartner Research', 'IDC Market Analysis', 'Forrester Reports', 'Internal Sales Data'],
        recommendations: [
          { action: 'Accelerate AI product development', priority: 1, estimatedROI: 340, timeToImplement: '6 months' },
          { action: 'Strategic partnership with AI vendors', priority: 2, estimatedROI: 225, timeToImplement: '3 months' },
          { action: 'Sales team specialization training', priority: 3, estimatedROI: 180, timeToImplement: '2 months' }
        ]
      },
      {
        id: 'operational-efficiency',
        category: 'operational',
        insight: 'Process automation could reduce operational costs by $1.8M annually while improving delivery speed by 34%',
        impact: 'high',
        timeHorizon: 'immediate',
        actionRequired: true,
        quantifiedValue: 1800000,
        riskLevel: 12,
        sources: ['McKinsey Operations Study', 'Internal Process Analysis', 'Vendor Benchmarking'],
        recommendations: [
          { action: 'Implement RPA for finance processes', priority: 1, estimatedROI: 280, timeToImplement: '4 months' },
          { action: 'Automate customer onboarding', priority: 2, estimatedROI: 195, timeToImplement: '3 months' },
          { action: 'Deploy AI-powered quality assurance', priority: 3, estimatedROI: 165, timeToImplement: '5 months' }
        ]
      },
      {
        id: 'competitive-threat',
        category: 'competitive',
        insight: 'Competitor X launching similar solution in Q3 with 25% lower pricing - potential 15% market share impact',
        impact: 'high',
        timeHorizon: 'short_term',
        actionRequired: true,
        quantifiedValue: -2300000,
        riskLevel: 78,
        sources: ['Competitive Intelligence', 'Industry Reports', 'Sales Team Feedback', 'Customer Surveys'],
        recommendations: [
          { action: 'Accelerate unique feature development', priority: 1, estimatedROI: 210, timeToImplement: '4 months' },
          { action: 'Implement value-based pricing strategy', priority: 2, estimatedROI: 175, timeToImplement: '2 months' },
          { action: 'Strengthen customer relationships', priority: 3, estimatedROI: 145, timeToImplement: '1 month' }
        ]
      }
    ];

    // Industry Benchmarks
    const benchmarks: IndustryBenchmark[] = [
      {
        metric: 'Customer Acquisition Cost',
        ourPerformance: 1250,
        industryAverage: 1580,
        topQuartile: 980,
        percentileRank: 72,
        improvementPotential: 270,
        competitiveGap: -330,
        trends: [
          { period: 'Q1 2024', value: 1320, industryValue: 1620 },
          { period: 'Q2 2024', value: 1285, industryValue: 1590 },
          { period: 'Q3 2024', value: 1250, industryValue: 1580 }
        ]
      },
      {
        metric: 'Revenue per Employee',
        ourPerformance: 285000,
        industryAverage: 245000,
        topQuartile: 320000,
        percentileRank: 68,
        improvementPotential: 35000,
        competitiveGap: 40000,
        trends: [
          { period: 'Q1 2024', value: 275000, industryValue: 240000 },
          { period: 'Q2 2024', value: 280000, industryValue: 242000 },
          { period: 'Q3 2024', value: 285000, industryValue: 245000 }
        ]
      },
      {
        metric: 'Net Promoter Score',
        ourPerformance: 67,
        industryAverage: 52,
        topQuartile: 75,
        percentileRank: 78,
        improvementPotential: 8,
        competitiveGap: 15,
        trends: [
          { period: 'Q1 2024', value: 63, industryValue: 50 },
          { period: 'Q2 2024', value: 65, industryValue: 51 },
          { period: 'Q3 2024', value: 67, industryValue: 52 }
        ]
      }
    ];

    setPredictiveModels(models);
    setBusinessIntelligence(intelligence);
    setIndustryBenchmarks(benchmarks);
  }, []);

  const getTrendIcon = (trend: string) => {
    switch (trend) {
      case 'positive': return <ArrowUp className="h-4 w-4 text-emerald-400" />;
      case 'negative': return <ArrowDown className="h-4 w-4 text-red-400" />;
      default: return <Minus className="h-4 w-4 text-amber-400" />;
    }
  };

  const getImpactColor = (impact: string) => {
    switch (impact) {
      case 'high': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'medium': return 'bg-amber-500/20 text-amber-300 border-amber-500/30';
      case 'low': return 'bg-green-500/20 text-green-300 border-green-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(Math.abs(amount));
  };

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-y-auto p-8 space-y-8">
        
        {/* Breadcrumb Navigation */}
        <div className="mb-6">
          <div className="flex items-center gap-2 text-sm text-gray-400">
            <Link to="/">
              <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                <Home className="h-4 w-4" />
              </Button>
            </Link>
            <span>/</span>
            <span>Analytics & Intelligence</span>
            <span>/</span>
            <span className="text-white">Advanced Analytics</span>
          </div>
        </div>

        {/* Advanced Analytics Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-white mb-2">Advanced Business Intelligence</h1>
            <p className="text-slate-300">Predictive analytics, market intelligence, and competitive benchmarking</p>
          </div>
          <div className="flex items-center gap-4">
            <Link to="/">
              <Button variant="secondary" className="bg-slate-700 hover:bg-slate-600 text-slate-100 border-slate-600">
                <ArrowLeft className="h-4 w-4 mr-2" />
                Dashboard
              </Button>
            </Link>
            <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">
              <Brain className="w-4 h-4 mr-2" />
              AI Models Active: 12
            </Badge>
            <Button className="bg-blue-600 hover:bg-blue-700">
              <BarChart3 className="w-4 h-4 mr-2" />
              Generate Report
            </Button>
          </div>
        </div>

        {/* Advanced Analytics Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="bg-slate-800/50 border border-slate-700/50">
            <TabsTrigger value="predictive" className="data-[state=active]:bg-slate-700">Predictive Models</TabsTrigger>
            <TabsTrigger value="intelligence" className="data-[state=active]:bg-slate-700">Business Intelligence</TabsTrigger>
            <TabsTrigger value="benchmarks" className="data-[state=active]:bg-slate-700">Industry Benchmarks</TabsTrigger>
            <TabsTrigger value="scenarios" className="data-[state=active]:bg-slate-700">Scenario Analysis</TabsTrigger>
            <TabsTrigger value="ai-chat" className="data-[state=active]:bg-slate-700 flex items-center gap-2">
              <MessageSquare className="h-4 w-4" />
              AI Chat
            </TabsTrigger>
          </TabsList>

          {/* Predictive Models */}
          <TabsContent value="predictive" className="space-y-6">
            <div className="space-y-6">
              {predictiveModels.map((model) => (
                <Card key={model.id} className="bg-slate-900/50 border-slate-700/50">
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-white flex items-center gap-3">
                        <Brain className="h-6 w-6" />
                        {model.name}
                      </CardTitle>
                      <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">
                        {model.accuracy}% Accuracy
                      </Badge>
                    </div>
                  </CardHeader>
                  <CardContent className="space-y-6">
                    
                    {/* Predictions */}
                    <div>
                      <h4 className="font-semibold text-white mb-3">Forecasts</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {model.predictions.map((prediction, index) => (
                          <div key={index} className="p-4 bg-slate-800/50 rounded-lg">
                            <div className="flex items-center justify-between mb-2">
                              <span className="text-white font-medium">{prediction.period}</span>
                              <Badge className="bg-blue-500/20 text-blue-300 border-blue-500/30">
                                {prediction.probability}% Confidence
                              </Badge>
                            </div>
                            <div className="text-2xl font-bold text-white mb-2">
                              {model.type === 'revenue' ? formatCurrency(prediction.value) : 
                               model.type === 'customer_churn' ? `${prediction.value}%` : 
                               prediction.value.toLocaleString()}
                            </div>
                            <div className="text-xs text-slate-400">
                              Key factors: {prediction.factors.slice(0, 2).join(', ')}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* Key Drivers */}
                    <div>
                      <h4 className="font-semibold text-white mb-3">Key Drivers</h4>
                      <div className="space-y-3">
                        {model.keyDrivers.map((driver, index) => (
                          <div key={index} className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                            <div className="flex items-center gap-3">
                              {getTrendIcon(driver.trend)}
                              <span className="text-white">{driver.factor}</span>
                            </div>
                            <div className="flex items-center gap-4">
                              <div className="text-right">
                                <div className="text-sm font-medium text-white">
                                  {(Math.abs(driver.impact) * 100).toFixed(1)}% Impact
                                </div>
                                <div className="text-xs text-slate-400">
                                  {(driver.significance * 100).toFixed(0)}% Significance
                                </div>
                              </div>
                              <Progress value={driver.significance * 100} className="w-20 h-2" />
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* Scenarios */}
                    <div>
                      <h4 className="font-semibold text-white mb-3">Scenario Analysis</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {model.scenarios.map((scenario, index) => (
                          <div key={index} className="p-4 bg-slate-800/50 rounded-lg border border-slate-600/50">
                            <div className="flex items-center justify-between mb-2">
                              <span className="font-medium text-white">{scenario.name}</span>
                              <span className="text-sm text-slate-400">{scenario.probability}%</span>
                            </div>
                            <div className="text-xl font-bold text-white mb-2">
                              {model.type === 'revenue' ? formatCurrency(scenario.outcome) : `${scenario.outcome}%`}
                            </div>
                            <p className="text-xs text-slate-400">{scenario.description}</p>
                          </div>
                        ))}
                      </div>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Business Intelligence */}
          <TabsContent value="intelligence" className="space-y-6">
            <div className="space-y-4">
              {businessIntelligence.map((insight) => (
                <Card key={insight.id} className="bg-slate-900/50 border-slate-700/50">
                  <CardContent className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex-1 page-background">
                        <div className="flex items-center gap-3 mb-2">
                          <Badge className={getImpactColor(insight.impact)}>
                            {insight.impact.toUpperCase()} IMPACT
                          </Badge>
                          <Badge variant="outline" className="border-slate-600 text-slate-300">
                            {insight.category.toUpperCase()}
                          </Badge>
                          <Badge variant="outline" className="border-slate-600 text-slate-300">
                            {insight.timeHorizon.replace('_', ' ').toUpperCase()}
                          </Badge>
                        </div>
                        <p className="text-white text-lg mb-4">{insight.insight}</p>
                      </div>
                      <div className="text-right">
                        <div className="text-sm text-slate-400">Financial Impact</div>
                        <div className={`text-2xl font-bold ${insight.quantifiedValue > 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                          {insight.quantifiedValue > 0 ? '+' : ''}{formatCurrency(insight.quantifiedValue)}
                        </div>
                        <div className="text-sm text-slate-400">Risk Level: {insight.riskLevel}%</div>
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <h4 className="font-semibold text-white mb-2">Data Sources</h4>
                        <div className="space-y-1">
                          {insight.sources.map((source, index) => (
                            <div key={index} className="text-sm text-slate-300 flex items-center gap-2">
                              <CheckCircle className="w-3 h-3 text-emerald-400" />
                              {source}
                            </div>
                          ))}
                        </div>
                      </div>
                      
                      <div>
                        <h4 className="font-semibold text-white mb-2">Recommended Actions</h4>
                        <div className="space-y-2">
                          {insight.recommendations.slice(0, 2).map((rec, index) => (
                            <div key={index} className="p-2 bg-slate-800/50 rounded">
                              <div className="flex items-center justify-between">
                                <span className="text-sm text-white">{rec.action}</span>
                                <span className="text-xs text-emerald-400">{rec.estimatedROI}% ROI</span>
                              </div>
                              <div className="text-xs text-slate-400">Timeline: {rec.timeToImplement}</div>
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Industry Benchmarks */}
          <TabsContent value="benchmarks" className="space-y-6">
            <div className="space-y-6">
              {industryBenchmarks.map((benchmark, index) => (
                <Card key={index} className="bg-slate-900/50 border-slate-700/50">
                  <CardHeader>
                    <CardTitle className="text-white">{benchmark.metric}</CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                      <div className="text-center">
                        <div className="text-sm text-slate-400 mb-1">Our Performance</div>
                        <div className="text-2xl font-bold text-white">
                          {benchmark.metric.includes('Cost') || benchmark.metric.includes('Revenue') ? 
                            formatCurrency(benchmark.ourPerformance) : benchmark.ourPerformance.toLocaleString()}
                        </div>
                        <div className="text-xs text-emerald-400">
                          {benchmark.percentileRank}th percentile
                        </div>
                      </div>
                      
                      <div className="text-center">
                        <div className="text-sm text-slate-400 mb-1">Industry Average</div>
                        <div className="text-2xl font-bold text-slate-300">
                          {benchmark.metric.includes('Cost') || benchmark.metric.includes('Revenue') ? 
                            formatCurrency(benchmark.industryAverage) : benchmark.industryAverage.toLocaleString()}
                        </div>
                        <div className={`text-xs ${benchmark.competitiveGap > 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                          {benchmark.competitiveGap > 0 ? '+' : ''}{formatCurrency(benchmark.competitiveGap)} vs us
                        </div>
                      </div>
                      
                      <div className="text-center">
                        <div className="text-sm text-slate-400 mb-1">Top Quartile</div>
                        <div className="text-2xl font-bold text-amber-300">
                          {benchmark.metric.includes('Cost') || benchmark.metric.includes('Revenue') ? 
                            formatCurrency(benchmark.topQuartile) : benchmark.topQuartile.toLocaleString()}
                        </div>
                        <div className="text-xs text-amber-400">
                          Target performance
                        </div>
                      </div>
                      
                      <div className="text-center">
                        <div className="text-sm text-slate-400 mb-1">Improvement Potential</div>
                        <div className="text-2xl font-bold text-blue-300">
                          {benchmark.metric.includes('Cost') || benchmark.metric.includes('Revenue') ? 
                            formatCurrency(benchmark.improvementPotential) : benchmark.improvementPotential.toLocaleString()}
                        </div>
                        <div className="text-xs text-blue-400">
                          To reach top quartile
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Scenario Analysis */}
          <TabsContent value="scenarios" className="space-y-6">
            <Card className="bg-slate-900/50 border-slate-700/50">
              <CardHeader>
                <CardTitle className="text-white">Monte Carlo Business Scenarios</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-center text-slate-400 py-12">
                  <BarChart3 className="h-16 w-16 mx-auto mb-4" />
                  <p>Advanced Monte Carlo simulations and sensitivity analysis</p>
                  <p className="text-sm">10,000+ scenario iterations with probability distributions</p>
                </div>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/AIIntelligenceHub.tsx
========================================
import { useState, useEffect } from 'react';
import { useLocation } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Badge } from '@/components/ui/badge';
import { 
  Activity, 
  Brain, 
  Zap, 
  Users, 
  Sparkles,
  TrendingUp,
  Target,
  AlertCircle
} from 'lucide-react';

// Import existing AI module components
import PulseIntelligence from './PulseIntelligence';
import FluxAdaptations from './FluxAdaptations';
import PrismInsights from './PrismInsights';
import EchoCulturalAnalytics from './EchoCulturalAnalytics';
import NovaInnovations from './NovaInnovations';

export default function AIIntelligenceHub() {
  const [location] = useLocation();
  
  // Derive initial tab from URL path
  const getInitialTab = () => {
    const path = location.replace('/ai', '').replace('/', '').toLowerCase();
    const validModules = ['pulse', 'flux', 'prism', 'echo', 'nova'];
    return validModules.includes(path) ? path : 'pulse';
  };
  
  const [activeTab, setActiveTab] = useState(getInitialTab());
  
  // Update active tab when location changes
  useEffect(() => {
    const tab = getInitialTab();
    setActiveTab(tab);
  }, [location]);

  const modules = [
    {
      id: 'pulse',
      name: 'Pulse Intelligence',
      icon: Activity,
      color: 'text-blue-400',
      bgColor: 'bg-blue-500/10',
      borderColor: 'border-blue-500/30',
      description: 'Market signals & competitive intelligence',
      component: PulseIntelligence
    },
    {
      id: 'flux',
      name: 'Flux Adaptations',
      icon: Zap,
      color: 'text-yellow-400',
      bgColor: 'bg-yellow-500/10',
      borderColor: 'border-yellow-500/30',
      description: 'Dynamic response optimization',
      component: FluxAdaptations
    },
    {
      id: 'prism',
      name: 'Prism Insights',
      icon: Target,
      color: 'text-purple-400',
      bgColor: 'bg-purple-500/10',
      borderColor: 'border-purple-500/30',
      description: 'Multi-dimensional strategic analysis',
      component: PrismInsights
    },
    {
      id: 'echo',
      name: 'Echo Analytics',
      icon: Users,
      color: 'text-green-400',
      bgColor: 'bg-green-500/10',
      borderColor: 'border-green-500/30',
      description: 'Cultural & stakeholder impact',
      component: EchoCulturalAnalytics
    },
    {
      id: 'nova',
      name: 'Nova Innovations',
      icon: Sparkles,
      color: 'text-pink-400',
      bgColor: 'bg-pink-500/10',
      borderColor: 'border-pink-500/30',
      description: 'Innovation pipeline & opportunities',
      component: NovaInnovations
    }
  ];

  const ActiveComponent = modules.find(m => m.id === activeTab)?.component || PulseIntelligence;

  return (
    <PageLayout>
      <div className="page-background min-h-screen bg-gray-950">
        {/* Page Title Section */}
        <div className="max-w-7xl mx-auto px-6 pt-6 pb-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="p-2 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg">
                <Brain className="h-5 w-5 text-white" />
              </div>
              <div>
                <h1 className="text-xl font-bold text-white">AI Intelligence Hub</h1>
                <p className="text-sm text-gray-400">Strategic co-pilots for executive decision-making</p>
              </div>
            </div>
            <Badge variant="outline" className="bg-green-500/10 text-green-300 border-green-500/30">
              <div className="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse" />
              All Systems Active
            </Badge>
          </div>
        </div>

        {/* Module Navigation */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          <div className="border-b border-gray-800 bg-gray-900/30">
            <div className="max-w-7xl mx-auto px-6">
              <TabsList className="grid w-full grid-cols-5 bg-transparent gap-2 h-auto p-0 border-0">
                {modules.map((module) => {
                  const Icon = module.icon;
                  const isActive = activeTab === module.id;
                  return (
                    <TabsTrigger
                      key={module.id}
                      value={module.id}
                      className={`
                        flex flex-col items-center gap-2 py-4 px-4 rounded-none border-b-2 transition-all
                        ${isActive 
                          ? `${module.borderColor} bg-gray-800/50` 
                          : 'border-transparent hover:bg-gray-800/30'
                        }
                        data-[state=active]:shadow-none
                      `}
                      data-testid={`ai-module-${module.id}`}
                    >
                      <div className={`p-2 rounded-lg ${isActive ? module.bgColor : 'bg-gray-800/50'}`}>
                        <Icon className={`h-5 w-5 ${isActive ? module.color : 'text-gray-400'}`} />
                      </div>
                      <div className="text-center">
                        <p className={`text-sm font-semibold ${isActive ? 'text-white' : 'text-gray-400'}`}>
                          {module.name}
                        </p>
                        <p className="text-xs text-gray-500 mt-0.5">
                          {module.description}
                        </p>
                      </div>
                    </TabsTrigger>
                  );
                })}
              </TabsList>
            </div>
          </div>

          {/* Module Content */}
          {modules.map((module) => (
            <TabsContent key={module.id} value={module.id} className="m-0 focus-visible:outline-none">
              <ActiveComponent />
            </TabsContent>
          ))}
        </Tabs>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/AIIntelligence.tsx
========================================
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import PageLayout from '@/components/layout/PageLayout';
import { 
  Brain, 
  Activity, 
  TrendingUp, 
  Layers, 
  Users, 
  Rocket,
  Zap,
  BarChart3,
  Target,
  Clock,
  AlertTriangle,
  CheckCircle,
  ArrowRight,
  Globe
} from 'lucide-react';

export default function AIIntelligence() {
  const [activeModule, setActiveModule] = useState('pulse');

  const aiModules = [
    {
      id: 'pulse',
      name: 'Pulse Intelligence',
      icon: <Activity className="w-6 h-6" />,
      description: 'Real-time organizational health monitoring and predictive analytics',
      status: 'active',
      accuracy: 92,
      lastUpdate: '2 minutes ago',
      insights: 847,
      color: 'from-blue-500 to-cyan-500'
    },
    {
      id: 'flux',
      name: 'Flux Adaptations',
      icon: <TrendingUp className="w-6 h-6" />,
      description: 'Dynamic adaptation strategies and change management intelligence',
      status: 'active',
      accuracy: 89,
      lastUpdate: '5 minutes ago',
      insights: 623,
      color: 'from-green-500 to-emerald-500'
    },
    {
      id: 'prism',
      name: 'Prism Insights',
      icon: <Layers className="w-6 h-6" />,
      description: 'Multi-dimensional strategic analysis and decision support',
      status: 'active',
      accuracy: 94,
      lastUpdate: '1 minute ago',
      insights: 1203,
      color: 'from-purple-500 to-indigo-500'
    },
    {
      id: 'echo',
      name: 'Echo Cultural Analytics',
      icon: <Users className="w-6 h-6" />,
      description: 'Cultural intelligence and team dynamics assessment',
      status: 'active',
      accuracy: 87,
      lastUpdate: '3 minutes ago',
      insights: 456,
      color: 'from-orange-500 to-red-500'
    },
    {
      id: 'nova',
      name: 'Nova Innovations',
      icon: <Rocket className="w-6 h-6" />,
      description: 'Innovation pipeline management and breakthrough opportunity identification',
      status: 'active',
      accuracy: 91,
      lastUpdate: '4 minutes ago',
      insights: 329,
      color: 'from-yellow-500 to-orange-500'
    }
  ];

  const realtimeInsights = [
    "Organizational adaptability score increased 12% this quarter",
    "Crisis response readiness at 97% - protocols optimized",
    "Cross-functional collaboration efficiency up 23%",
    "Innovation pipeline identified 5 breakthrough opportunities",
    "Cultural alignment metrics show improved team dynamics"
  ];

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800">
        <div className="p-8">
          {/* AI Intelligence Header */}
          <div className="flex items-center justify-between mb-8">
            <div className="flex items-center space-x-4">
              <div className="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                <Brain className="w-7 h-7 text-white" />
              </div>
              <div>
                <h1 className="text-3xl font-bold text-gray-900 dark:text-white">AI Intelligence Center</h1>
                <p className="text-gray-600 dark:text-gray-300">Advanced Organizational Intelligence & Predictive Analytics</p>
              </div>
            </div>
            <div className="flex items-center space-x-3">
              <Badge variant="outline" className="text-green-600 border-green-500/50">
                <Activity className="w-3 h-3 mr-1" />
                All Modules Active
              </Badge>
              <Badge className="bg-blue-600 text-white">
                Enterprise AI
              </Badge>
            </div>
          </div>

          {/* AI Modules Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            {aiModules.map((module) => (
              <Card 
                key={module.id} 
                className={`cursor-pointer transition-all duration-300 hover:shadow-lg ${
                  activeModule === module.id ? 'ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/20' : 'bg-white dark:bg-slate-800'
                }`}
                onClick={() => setActiveModule(module.id)}
                data-testid={`card-ai-module-${module.id}`}
              >
                <CardHeader className="pb-3">
                  <div className="flex items-center justify-between">
                    <div className={`p-2 rounded-lg bg-gradient-to-r ${module.color} text-white`}>
                      {module.icon}
                    </div>
                    <Badge variant={module.status === 'active' ? 'default' : 'secondary'}>
                      {module.status}
                    </Badge>
                  </div>
                  <CardTitle className="text-lg">{module.name}</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">{module.description}</p>
                  
                  <div className="space-y-3">
                    <div className="flex items-center justify-between text-sm">
                      <span className="text-gray-600 dark:text-gray-400">Accuracy</span>
                      <span className="font-semibold text-green-600">{module.accuracy}%</span>
                    </div>
                    <Progress value={module.accuracy} className="h-2" />
                    
                    <div className="flex items-center justify-between text-xs text-gray-500">
                      <span>Last Update: {module.lastUpdate}</span>
                      <span>{module.insights} insights</span>
                    </div>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {/* Real-time Intelligence Feed */}
            <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
              <CardHeader>
                <CardTitle className="flex items-center text-gray-900 dark:text-white">
                  <Zap className="w-5 h-5 mr-2 text-yellow-500" />
                  Real-time Intelligence Feed
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  {realtimeInsights.map((insight, index) => (
                    <div key={index} className="flex items-start space-x-3 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                      <CheckCircle className="w-4 h-4 mt-0.5 text-green-500 flex-shrink-0" />
                      <div className="flex-1 page-background">
                        <p className="text-sm text-gray-700 dark:text-gray-300">{insight}</p>
                        <p className="text-xs text-gray-500 mt-1">AI Confidence: {Math.floor(Math.random() * 10) + 85}%</p>
                      </div>
                      <Clock className="w-3 h-3 text-gray-400" />
                    </div>
                  ))}
                </div>
                <Button className="w-full mt-4" variant="outline" data-testid="button-view-all-insights">
                  View All Intelligence Reports
                  <ArrowRight className="w-4 h-4 ml-2" />
                </Button>
              </CardContent>
            </Card>

            {/* AI Module Controls */}
            <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
              <CardHeader>
                <CardTitle className="flex items-center text-gray-900 dark:text-white">
                  <Target className="w-5 h-5 mr-2 text-blue-500" />
                  AI Intelligence Controls
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="p-4 bg-gradient-to-r .section-background dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg">
                  <h4 className="font-semibold text-gray-900 dark:text-white mb-2">Active Intelligence Module</h4>
                  <p className="text-sm text-gray-600 dark:text-gray-400 mb-3">
                    {aiModules.find(m => m.id === activeModule)?.description}
                  </p>
                  <div className="flex space-x-2">
                    <Button size="sm" data-testid="button-run-analysis">
                      Run Deep Analysis
                    </Button>
                    <Button size="sm" variant="outline" data-testid="button-export-insights">
                      Export Insights
                    </Button>
                  </div>
                </div>

                <div className="space-y-3">
                  <Button className="w-full justify-start" variant="outline" data-testid="button-predictive-analytics">
                    <BarChart3 className="w-4 h-4 mr-2" />
                    Run Predictive Analytics
                  </Button>
                  <Button className="w-full justify-start" variant="outline" data-testid="button-scenario-modeling">
                    <Globe className="w-4 h-4 mr-2" />
                    AI Scenario Modeling
                  </Button>
                  <Button className="w-full justify-start" variant="outline" data-testid="button-decision-intelligence">
                    <Target className="w-4 h-4 mr-2" />
                    Decision Intelligence
                  </Button>
                </div>

                <div className="mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                  <div className="flex items-center text-yellow-800 dark:text-yellow-200">
                    <AlertTriangle className="w-4 h-4 mr-2" />
                    <span className="text-sm font-medium">AI Intelligence Recommendation</span>
                  </div>
                  <p className="text-xs text-yellow-700 dark:text-yellow-300 mt-1">
                    Based on current data, recommend immediate focus on crisis response protocol optimization and cross-functional team collaboration enhancement.
                  </p>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/AIRadarDashboard.tsx
========================================
import { useState, useEffect } from 'react';
import PageLayout from '@/components/layout/PageLayout';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { useLocation } from 'wouter';
import { 
  AlertTriangle, 
  TrendingUp, 
  Activity, 
  CheckCircle, 
  Radar,
  Shield,
  Eye,
  Zap,
  ArrowRight,
  Radio,
  Target,
  DollarSign,
  Users,
  Globe,
  Building2,
  BarChart3,
  Settings
} from 'lucide-react';
import { SIGNAL_CATEGORIES } from '@shared/intelligence-signals';

export default function AIRadarDashboard() {
  const [, setLocation] = useLocation();
  const [radarAngle, setRadarAngle] = useState(0);
  const [scanningCategory, setScanningCategory] = useState(0);

  const { data: triggersData } = useQuery<any[]>({
    queryKey: ['/api/triggers'],
  });

  const { data: alertsData } = useQuery<any[]>({
    queryKey: ['/api/strategic-alerts'],
  });

  const { data: weakSignalsData } = useQuery<any[]>({
    queryKey: ['/api/dynamic-strategy/weak-signals'],
    refetchInterval: 30000,
  });

  const { data: dynamicStatus } = useQuery<any>({
    queryKey: ['/api/dynamic-strategy/status'],
    refetchInterval: 10000,
  });

  const triggers = triggersData ?? [];
  const alerts = alertsData ?? [];
  const weakSignals = weakSignalsData ?? [];
  const activeTriggers = triggers.filter((t: any) => t.currentStatus === 'red' || t.currentStatus === 'yellow');
  const criticalTriggers = triggers.filter((t: any) => t.currentStatus === 'red');
  const activeAlerts = alerts.filter((a: any) => a.status === 'active');
  const totalDataPoints = SIGNAL_CATEGORIES.reduce((acc, cat) => acc + cat.dataPoints.length, 0);

  // Radar animation
  useEffect(() => {
    const interval = setInterval(() => {
      setRadarAngle(prev => (prev + 2) % 360);
    }, 50);
    return () => clearInterval(interval);
  }, []);

  // Cycle through categories for visual scanning effect
  useEffect(() => {
    const interval = setInterval(() => {
      setScanningCategory(prev => (prev + 1) % SIGNAL_CATEGORIES.length);
    }, 3000);
    return () => clearInterval(interval);
  }, []);

  const currentCategory = SIGNAL_CATEGORIES[scanningCategory];

  return (
    <PageLayout>
      <div className="space-y-6 p-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold flex items-center gap-3" data-testid="page-title">
              <div className="relative">
                <Radar className="h-10 w-10 text-blue-500" />
                <div className="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full animate-pulse" />
              </div>
              Threat Radar
            </h1>
            <p className="text-muted-foreground mt-1">
              Real-time AI monitoring across {SIGNAL_CATEGORIES.length} signal categories and {totalDataPoints} data points
            </p>
          </div>
          <Button onClick={() => setLocation('/signal-intelligence')} data-testid="button-configure-signals">
            <Settings className="h-4 w-4 mr-2" />
            Configure Signals
          </Button>
        </div>

        {/* Live Status Bar */}
        <div className="bg-gradient-to-r from-slate-900 to-slate-800 rounded-xl p-4 text-white">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-6">
              <div className="flex items-center gap-2">
                <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
                <span className="text-sm font-medium">LIVE MONITORING</span>
              </div>
              <div className="text-sm text-slate-400">
                Now scanning: <span className="text-blue-400 font-medium">{currentCategory?.name}</span>
              </div>
            </div>
            <div className="flex items-center gap-6 text-sm">
              <div>
                <span className="text-slate-400">Active monitors:</span>
                <span className="ml-2 font-mono text-green-400">{triggers.length}</span>
              </div>
              <div>
                <span className="text-slate-400">Weak signals:</span>
                <span className="ml-2 font-mono text-amber-400">{weakSignals.length}</span>
              </div>
              <div>
                <span className="text-slate-400">Status:</span>
                <span className="ml-2 font-mono text-blue-400">Active</span>
              </div>
            </div>
          </div>
        </div>

        {/* Main Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Radar Visualization */}
          <Card className="lg:col-span-1 bg-slate-950 border-slate-800">
            <CardHeader className="pb-2">
              <CardTitle className="text-white text-lg">Signal Radar</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="relative w-full aspect-square max-w-[300px] mx-auto">
                {/* Radar circles */}
                <div className="absolute inset-0 flex items-center justify-center">
                  <div className="w-full h-full rounded-full border border-slate-700" />
                  <div className="absolute w-3/4 h-3/4 rounded-full border border-slate-700" />
                  <div className="absolute w-1/2 h-1/2 rounded-full border border-slate-700" />
                  <div className="absolute w-1/4 h-1/4 rounded-full border border-slate-700" />
                </div>
                
                {/* Cross lines */}
                <div className="absolute inset-0 flex items-center justify-center">
                  <div className="w-full h-px bg-slate-700" />
                </div>
                <div className="absolute inset-0 flex items-center justify-center">
                  <div className="w-px h-full bg-slate-700" />
                </div>
                
                {/* Radar sweep */}
                <div 
                  className="absolute inset-0 flex items-center justify-center"
                  style={{ transform: `rotate(${radarAngle}deg)` }}
                >
                  <div 
                    className="w-1/2 h-1 origin-left"
                    style={{
                      background: 'linear-gradient(90deg, rgba(34,197,94,0.8) 0%, rgba(34,197,94,0) 100%)'
                    }}
                  />
                </div>
                
                {/* Sweep trail */}
                <div 
                  className="absolute inset-0 flex items-center justify-center pointer-events-none"
                  style={{ transform: `rotate(${radarAngle}deg)` }}
                >
                  <div 
                    className="absolute inset-0 rounded-full"
                    style={{
                      background: `conic-gradient(from ${radarAngle}deg, rgba(34,197,94,0.15) 0deg, transparent 60deg)`
                    }}
                  />
                </div>

                {/* Signal blips */}
                {activeTriggers.map((trigger: any, idx: number) => {
                  const angle = (idx * 137.5) % 360;
                  const distance = 30 + (idx % 3) * 25;
                  const x = Math.cos(angle * Math.PI / 180) * distance;
                  const y = Math.sin(angle * Math.PI / 180) * distance;
                  return (
                    <div
                      key={trigger.id}
                      className={`absolute w-3 h-3 rounded-full ${
                        trigger.currentStatus === 'red' ? 'bg-red-500' : 'bg-amber-500'
                      } animate-pulse`}
                      style={{
                        left: `calc(50% + ${x}%)`,
                        top: `calc(50% + ${y}%)`,
                        transform: 'translate(-50%, -50%)'
                      }}
                      title={trigger.name}
                    />
                  );
                })}

                {/* Center dot */}
                <div className="absolute inset-0 flex items-center justify-center">
                  <div className="w-2 h-2 bg-green-500 rounded-full" />
                </div>
              </div>

              {/* Legend */}
              <div className="mt-4 flex justify-center gap-4 text-xs text-slate-400">
                <div className="flex items-center gap-1">
                  <div className="w-2 h-2 bg-red-500 rounded-full" />
                  Critical
                </div>
                <div className="flex items-center gap-1">
                  <div className="w-2 h-2 bg-amber-500 rounded-full" />
                  Warning
                </div>
                <div className="flex items-center gap-1">
                  <div className="w-2 h-2 bg-green-500 rounded-full" />
                  Normal
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Status Cards */}
          <div className="lg:col-span-2 space-y-4">
            {/* Key Metrics */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <Card className={`${criticalTriggers.length > 0 ? 'border-red-500 bg-red-50 dark:bg-red-950/20' : 'border-green-500 bg-green-50 dark:bg-green-950/20'}`} data-testid="card-threat-level">
                <CardContent className="p-4">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-xs text-muted-foreground">Threat Level</p>
                      <p className={`text-2xl font-bold ${criticalTriggers.length > 0 ? 'text-red-600' : 'text-green-600'}`}>
                        {criticalTriggers.length > 0 ? 'ELEVATED' : 'NORMAL'}
                      </p>
                    </div>
                    <Shield className={`h-8 w-8 ${criticalTriggers.length > 0 ? 'text-red-500' : 'text-green-500'}`} />
                  </div>
                </CardContent>
              </Card>

              <Card data-testid="card-active-monitors">
                <CardContent className="p-4">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-xs text-muted-foreground">Active Monitors</p>
                      <p className="text-2xl font-bold">{triggers.length}</p>
                    </div>
                    <Eye className="h-8 w-8 text-blue-500" />
                  </div>
                </CardContent>
              </Card>

              <Card data-testid="card-signals-today">
                <CardContent className="p-4">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-xs text-muted-foreground">Weak Signals</p>
                      <p className="text-2xl font-bold">{weakSignals.length}</p>
                    </div>
                    <Radio className="h-8 w-8 text-purple-500" />
                  </div>
                </CardContent>
              </Card>

              <Card data-testid="card-response-time">
                <CardContent className="p-4">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-xs text-muted-foreground">Avg Response</p>
                      <p className="text-2xl font-bold text-green-600">12m</p>
                    </div>
                    <Zap className="h-8 w-8 text-amber-500" />
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Active Threats Panel */}
            <Card data-testid="card-active-threats">
              <CardHeader className="pb-3">
                <div className="flex items-center justify-between">
                  <CardTitle className="text-lg flex items-center gap-2">
                    <AlertTriangle className="h-5 w-5 text-amber-500" />
                    Active Threat Indicators
                  </CardTitle>
                  <Badge variant={activeTriggers.length > 0 ? "destructive" : "secondary"}>
                    {activeTriggers.length} Active
                  </Badge>
                </div>
              </CardHeader>
              <CardContent>
                {activeTriggers.length === 0 ? (
                  <div className="text-center py-6 text-muted-foreground">
                    <CheckCircle className="h-10 w-10 mx-auto mb-2 text-green-500" />
                    <p className="font-medium">All Clear</p>
                    <p className="text-sm">No elevated threats detected across {triggers.length} active monitors</p>
                  </div>
                ) : (
                  <div className="space-y-3">
                    {activeTriggers.slice(0, 5).map((trigger: any) => {
                      const category = SIGNAL_CATEGORIES.find(c => c.id === trigger.category);
                      return (
                        <div 
                          key={trigger.id}
                          className={`flex items-center gap-3 p-3 rounded-lg border ${
                            trigger.currentStatus === 'red' 
                              ? 'bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800' 
                              : 'bg-amber-50 dark:bg-amber-950/20 border-amber-200 dark:border-amber-800'
                          }`}
                          data-testid={`threat-${trigger.id}`}
                        >
                          <div className={`w-3 h-3 rounded-full ${
                            trigger.currentStatus === 'red' ? 'bg-red-500 animate-pulse' : 'bg-amber-500'
                          }`} />
                          <div className="flex-1">
                            <p className="font-medium">{trigger.name}</p>
                            <p className="text-xs text-muted-foreground">{category?.name || trigger.category}</p>
                          </div>
                          <Badge variant={trigger.currentStatus === 'red' ? 'destructive' : 'default'}>
                            {trigger.currentStatus === 'red' ? 'Critical' : 'Warning'}
                          </Badge>
                          <Button size="sm" variant="outline" onClick={() => setLocation('/signal-intelligence')}>
                            View
                          </Button>
                        </div>
                      );
                    })}
                    {activeTriggers.length > 5 && (
                      <Button variant="ghost" className="w-full" onClick={() => setLocation('/signal-intelligence')}>
                        View all {activeTriggers.length} active threats
                      </Button>
                    )}
                  </div>
                )}
              </CardContent>
            </Card>
          </div>
        </div>

        {/* Signal Categories Being Monitored */}
        <Card data-testid="card-signal-coverage">
          <CardHeader>
            <div className="flex items-center justify-between">
              <div>
                <CardTitle className="flex items-center gap-2">
                  <BarChart3 className="h-5 w-5 text-blue-500" />
                  Signal Coverage
                </CardTitle>
                <CardDescription>
                  AI continuously monitors {SIGNAL_CATEGORIES.length} categories with {totalDataPoints} data points
                </CardDescription>
              </div>
              <Button variant="outline" onClick={() => setLocation('/signal-intelligence')}>
                Configure Triggers
                <ArrowRight className="h-4 w-4 ml-2" />
              </Button>
            </div>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3">
              {SIGNAL_CATEGORIES.slice(0, 16).map((category, idx) => {
                const isScanning = idx === scanningCategory;
                const hasTrigger = triggers.some((t: any) => t.category === category.id);
                const hasAlert = triggers.some((t: any) => t.category === category.id && (t.currentStatus === 'red' || t.currentStatus === 'yellow'));
                
                return (
                  <div 
                    key={category.id}
                    className={`p-3 rounded-lg border text-center transition-all cursor-pointer hover:border-blue-400 ${
                      isScanning ? 'border-green-500 bg-green-50 dark:bg-green-950/20 ring-2 ring-green-500/50' :
                      hasAlert ? 'border-amber-400 bg-amber-50 dark:bg-amber-950/20' :
                      hasTrigger ? 'border-blue-300 bg-blue-50 dark:bg-blue-950/20' :
                      'border-slate-200 dark:border-slate-700'
                    }`}
                    onClick={() => setLocation('/signal-intelligence')}
                    data-testid={`category-${category.id}`}
                  >
                    <div 
                      className="w-8 h-8 mx-auto mb-2 rounded-full flex items-center justify-center text-lg"
                      style={{ backgroundColor: `${category.color}20` }}
                    >
                      {category.icon === 'TrendingUp' && <TrendingUp className="h-4 w-4" style={{ color: category.color }} />}
                      {category.icon === 'Users' && <Users className="h-4 w-4" style={{ color: category.color }} />}
                      {category.icon === 'DollarSign' && <DollarSign className="h-4 w-4" style={{ color: category.color }} />}
                      {category.icon === 'Globe' && <Globe className="h-4 w-4" style={{ color: category.color }} />}
                      {category.icon === 'Building2' && <Building2 className="h-4 w-4" style={{ color: category.color }} />}
                      {category.icon === 'Shield' && <Shield className="h-4 w-4" style={{ color: category.color }} />}
                      {category.icon === 'Target' && <Target className="h-4 w-4" style={{ color: category.color }} />}
                      {category.icon === 'Activity' && <Activity className="h-4 w-4" style={{ color: category.color }} />}
                      {!['TrendingUp', 'Users', 'DollarSign', 'Globe', 'Building2', 'Shield', 'Target', 'Activity'].includes(category.icon) && 
                        <Radio className="h-4 w-4" style={{ color: category.color }} />
                      }
                    </div>
                    <p className="text-xs font-medium truncate">{category.name}</p>
                    <p className="text-xs text-muted-foreground">{category.dataPoints.length} signals</p>
                    {isScanning && (
                      <Badge className="mt-1 text-[10px] bg-green-500">Scanning</Badge>
                    )}
                    {hasAlert && !isScanning && (
                      <Badge className="mt-1 text-[10px]" variant="destructive">Alert</Badge>
                    )}
                  </div>
                );
              })}
            </div>
          </CardContent>
        </Card>

        {/* Recent Activity Feed */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <Card data-testid="card-live-feed">
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Activity className="h-5 w-5 text-green-500" />
                Recent Activity
                <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse ml-2" />
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-2 max-h-[300px] overflow-y-auto">
                {(weakSignals.length === 0 && activeAlerts.length === 0 && activeTriggers.length === 0) ? (
                  <div className="text-center py-8 text-muted-foreground">
                    <Radio className="h-8 w-8 mx-auto mb-2 animate-pulse" />
                    <p className="text-sm">Monitoring for signals...</p>
                    <p className="text-xs mt-1">No recent activity detected</p>
                  </div>
                ) : (
                  <>
                    {activeTriggers.slice(0, 3).map((trigger: any) => (
                      <div 
                        key={`trigger-${trigger.id}`}
                        className={`flex items-center gap-3 p-2 rounded text-sm ${
                          trigger.currentStatus === 'red' 
                            ? 'bg-red-50 dark:bg-red-950/30' 
                            : 'bg-amber-50 dark:bg-amber-950/30'
                        }`}
                      >
                        <div className={`w-2 h-2 rounded-full ${
                          trigger.currentStatus === 'red' ? 'bg-red-500' : 'bg-amber-500'
                        }`} />
                        <div className="flex-1">
                          <span className="font-medium">{trigger.name}</span>
                          <span className="text-muted-foreground">  Trigger {trigger.currentStatus === 'red' ? 'Critical' : 'Warning'}</span>
                        </div>
                      </div>
                    ))}
                    {weakSignals.slice(0, 3).map((signal: any) => (
                      <div 
                        key={`weak-${signal.id}`}
                        className="flex items-center gap-3 p-2 rounded bg-purple-50 dark:bg-purple-950/30 text-sm"
                      >
                        <div className="w-2 h-2 bg-purple-500 rounded-full" />
                        <div className="flex-1">
                          <span className="font-medium">{signal.title || 'Weak Signal'}</span>
                          <span className="text-muted-foreground">  Early indicator</span>
                        </div>
                      </div>
                    ))}
                    {activeAlerts.slice(0, 3).map((alert: any) => (
                      <div 
                        key={`alert-${alert.id}`}
                        className="flex items-center gap-3 p-2 rounded bg-blue-50 dark:bg-blue-950/30 text-sm"
                      >
                        <div className="w-2 h-2 bg-blue-500 rounded-full" />
                        <div className="flex-1">
                          <span className="font-medium">{alert.title}</span>
                          <span className="text-muted-foreground">  Strategic Alert</span>
                        </div>
                      </div>
                    ))}
                  </>
                )}
              </div>
            </CardContent>
          </Card>

          {/* Monitoring Summary */}
          <Card className="bg-gradient-to-br from-emerald-50 to-blue-50 dark:from-emerald-950/20 dark:to-blue-950/20" data-testid="card-value-protected">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-emerald-700 dark:text-emerald-400">
                <Shield className="h-5 w-5" />
                Monitoring Summary
              </CardTitle>
              <CardDescription>
                Real-time intelligence coverage and readiness status
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div className="text-center p-4 bg-white dark:bg-slate-900 rounded-lg">
                  <p className="text-3xl font-bold text-emerald-600">
                    {dynamicStatus?.readinessScore?.toFixed(1) || ''}%
                  </p>
                  <p className="text-xs text-muted-foreground">Readiness Score</p>
                </div>
                <div className="text-center p-4 bg-white dark:bg-slate-900 rounded-lg">
                  <p className="text-3xl font-bold text-blue-600">{totalDataPoints}</p>
                  <p className="text-xs text-muted-foreground">Data Points</p>
                </div>
              </div>
              
              <div className="space-y-2">
                <div className="flex justify-between text-sm">
                  <span>Active Triggers</span>
                  <span className="font-medium">{triggers.length}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span>Elevated Alerts</span>
                  <span className={`font-medium ${activeTriggers.length > 0 ? 'text-amber-600' : 'text-green-600'}`}>
                    {activeTriggers.length}
                  </span>
                </div>
                <div className="flex justify-between text-sm">
                  <span>Weak Signals Detected</span>
                  <span className="font-medium">{weakSignals.length}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span>Signal Categories</span>
                  <span className="font-medium">{SIGNAL_CATEGORIES.length}</span>
                </div>
              </div>

              <Button 
                className="w-full bg-emerald-600 hover:bg-emerald-700"
                onClick={() => setLocation('/analytics')}
              >
                View Full Analytics
                <ArrowRight className="h-4 w-4 ml-2" />
              </Button>
            </CardContent>
          </Card>
        </div>

        {/* Bottom CTA */}
        {triggers.length === 0 && (
          <Card className="border-2 border-dashed border-blue-300 dark:border-blue-700 bg-blue-50/50 dark:bg-blue-950/20" data-testid="card-setup-cta">
            <CardContent className="py-8 text-center">
              <Target className="h-12 w-12 mx-auto mb-4 text-blue-500" />
              <h3 className="text-xl font-semibold mb-2">Start Monitoring Your Strategic Signals</h3>
              <p className="text-muted-foreground mb-4 max-w-md mx-auto">
                Configure triggers across {SIGNAL_CATEGORIES.length} signal categories to detect threats and opportunities before they impact your business.
              </p>
              <Button size="lg" onClick={() => setLocation('/signal-intelligence')} data-testid="button-setup-triggers">
                <Settings className="h-4 w-4 mr-2" />
                Configure Signal Triggers
              </Button>
            </CardContent>
          </Card>
        )}
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/ApprovalError.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useEffect } from 'react';
import { useLocation } from 'wouter';
import { AlertCircle } from 'lucide-react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription } from '@/components/ui/alert';

export default function ApprovalError() {
  const [, setLocation] = useLocation();
  const params = new URLSearchParams(window.location.search);
  const message = params.get('message') || 'Invalid or expired approval link';

  useEffect(() => {
    document.title = 'Approval Error - M';
  }, []);

  const getErrorDetails = (msg: string) => {
    if (msg.includes('expired')) {
      return {
        title: 'Link Expired',
        description: 'This approval link has expired. Approval links are valid for 72 hours.',
        suggestions: [
          'Request a new approval link from your administrator',
          'Check your email for a more recent approval request',
        ],
      };
    }
    if (msg.includes('already used')) {
      return {
        title: 'Link Already Used',
        description: 'This approval link has already been used and cannot be used again.',
        suggestions: [
          'This execution has already been approved or rejected',
          'Check the execution status in your dashboard',
        ],
      };
    }
    return {
      title: 'Invalid Link',
      description: 'This approval link is invalid or has been revoked.',
      suggestions: [
        'Verify you clicked the correct link from your email',
        'Request a new approval link if needed',
      ],
    };
  };

  const errorDetails = getErrorDetails(message);

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-red-50 to-orange-50 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4">
      <Card className="max-w-md w-full">
        <CardHeader className="text-center">
          <div className="mx-auto w-16 h-16 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center mb-4">
            <AlertCircle className="w-10 h-10 text-red-600 dark:text-red-400" />
          </div>
          <CardTitle className="text-2xl">{errorDetails.title}</CardTitle>
          <CardDescription>{errorDetails.description}</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <Alert variant="destructive">
            <AlertDescription>{message}</AlertDescription>
          </Alert>

          <div className="space-y-2">
            <p className="text-sm font-medium text-gray-700 dark:text-gray-300">
              What you can do:
            </p>
            <ul className="space-y-1 text-sm text-gray-600 dark:text-gray-400">
              {errorDetails.suggestions.map((suggestion, index) => (
                <li key={index} className="flex items-start">
                  <span className="mr-2"></span>
                  <span>{suggestion}</span>
                </li>
              ))}
            </ul>
          </div>

          <Button 
            onClick={() => setLocation('/')} 
            className="w-full"
            variant="outline"
            data-testid="button-return-home"
          >
            Return to Dashboard
          </Button>
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/pages/ApprovalSuccess.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useEffect } from 'react';
import { useLocation } from 'wouter';
import { CheckCircle } from 'lucide-react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';

export default function ApprovalSuccess() {
  const [, setLocation] = useLocation();
  const params = new URLSearchParams(window.location.search);
  const action = params.get('action') || 'approved';
  const executionId = params.get('execution');

  useEffect(() => {
    document.title = 'Approval Successful - M';
  }, []);

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4">
      <Card className="max-w-md w-full">
        <CardHeader className="text-center">
          <div className="mx-auto w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mb-4">
            <CheckCircle className="w-10 h-10 text-green-600 dark:text-green-400" />
          </div>
          <CardTitle className="text-2xl">
            {action === 'approve' ? 'Approved Successfully' : 'Action Completed'}
          </CardTitle>
          <CardDescription>
            Your decision has been recorded and the execution will proceed accordingly.
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {executionId && (
            <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
              <p className="text-sm text-gray-600 dark:text-gray-400">Execution ID</p>
              <p className="font-mono text-sm break-all">{executionId}</p>
            </div>
          )}
          
          <div className="space-y-2 text-sm text-gray-600 dark:text-gray-400">
            <p> Your approval has been processed</p>
            <p> Stakeholders have been notified</p>
            <p> Execution will begin shortly</p>
          </div>

          <Button 
            onClick={() => setLocation('/')} 
            className="w-full"
            data-testid="button-return-home"
          >
            Return to Dashboard
          </Button>
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/pages/AuditLoggingCenter.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Calendar } from '@/components/ui/calendar';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import PageLayout from '@/components/layout/PageLayout';
import { 
  FileText, 
  Shield, 
  Clock, 
  Users, 
  AlertTriangle,
  CheckCircle,
  Eye,
  Download,
  Filter,
  Search,
  Activity,
  Database,
  Lock,
  Unlock,
  Settings,
  Target,
  BarChart3,
  Calendar as CalendarIcon,
  TrendingUp,
  Globe,
  Monitor,
  Key
} from 'lucide-react';

interface AuditLog {
  id: string;
  timestamp: string;
  user: string;
  action: string;
  resource: string;
  resourceId?: string;
  category: 'authentication' | 'data_access' | 'configuration' | 'decision' | 'system' | 'security';
  severity: 'low' | 'medium' | 'high' | 'critical';
  outcome: 'success' | 'failure' | 'warning';
  ipAddress: string;
  userAgent?: string;
  details: string;
  metadata?: {
    sessionId?: string;
    requestId?: string;
    geolocation?: string;
    duration?: number;
  };
}

interface SecurityEvent {
  id: string;
  type: 'failed_login' | 'suspicious_activity' | 'privilege_escalation' | 'data_export' | 'unauthorized_access';
  severity: 'low' | 'medium' | 'high' | 'critical';
  timestamp: string;
  user: string;
  description: string;
  status: 'detected' | 'investigating' | 'resolved' | 'false_positive';
  riskScore: number;
  affectedResources: string[];
  recommendations: string[];
}

interface ComplianceReport {
  id: string;
  reportType: string;
  period: string;
  generatedDate: string;
  status: 'generated' | 'reviewed' | 'approved';
  findings: {
    category: string;
    count: number;
    severity: string;
    details: string[];
  }[];
  compliance: {
    framework: string;
    score: number;
    requirements: {
      requirement: string;
      status: 'compliant' | 'non_compliant' | 'partial';
      evidence: string;
    }[];
  }[];
}

export default function AuditLoggingCenter() {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [auditLogs, setAuditLogs] = useState<AuditLog[]>([]);
  const [securityEvents, setSecurityEvents] = useState<SecurityEvent[]>([]);
  const [complianceReports, setComplianceReports] = useState<ComplianceReport[]>([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterCategory, setFilterCategory] = useState('all');
  const [filterSeverity, setFilterSeverity] = useState('all');
  const [dateRange, setDateRange] = useState<{ from?: Date; to?: Date }>({});
  const [metrics, setMetrics] = useState({
    totalLogs: 15847,
    securityEvents: 23,
    complianceScore: 97.8,
    systemHealth: 99.2,
    dailyLogins: 1247,
    failedAttempts: 12
  });

  useEffect(() => {
    // Generate sample audit logs
    const generateAuditLogs = (): AuditLog[] => {
      const actions = [
        'User Login', 'User Logout', 'Document Access', 'Configuration Change',
        'Data Export', 'Permission Grant', 'System Backup', 'Password Reset',
        'Resource Creation', 'Resource Deletion', 'API Access', 'Report Generation'
      ];
      
      const resources = [
        'Strategic Planning Hub', 'Crisis Response Center', 'AI Intelligence',
        'Executive Dashboard', 'User Management', 'System Configuration',
        'Financial Data', 'Customer Database', 'API Gateway', 'Security Settings'
      ];
      
      const users = [
        'Executive User', 'Strategic Lead', 'Operations Manager',
        'Finance Lead', 'Technology Lead', 'System Admin',
        'API Service', 'Background Process'
      ];

      return Array.from({ length: 50 }, (_, i) => ({
        id: `log-${i + 1}`,
        timestamp: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString(),
        user: users[Math.floor(Math.random() * users.length)],
        action: actions[Math.floor(Math.random() * actions.length)],
        resource: resources[Math.floor(Math.random() * resources.length)],
        resourceId: `res-${Math.floor(Math.random() * 1000)}`,
        category: ['authentication', 'data_access', 'configuration', 'decision', 'system', 'security'][Math.floor(Math.random() * 6)] as any,
        severity: ['low', 'medium', 'high', 'critical'][Math.floor(Math.random() * 4)] as any,
        outcome: ['success', 'failure', 'warning'][Math.floor(Math.random() * 3)] as any,
        ipAddress: `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
        userAgent: 'Mozilla/5.0 (compatible; M/1.0)',
        details: `Audit log entry for ${actions[Math.floor(Math.random() * actions.length)]} operation`,
        metadata: {
          sessionId: `sess-${Math.random().toString(36).substr(2, 9)}`,
          requestId: `req-${Math.random().toString(36).substr(2, 9)}`,
          geolocation: ['San Francisco, CA', 'New York, NY', 'Austin, TX', 'London, UK'][Math.floor(Math.random() * 4)],
          duration: Math.floor(Math.random() * 5000)
        }
      }));
    };

    const securityEvents: SecurityEvent[] = [
      {
        id: 'sec-001',
        type: 'failed_login',
        severity: 'medium',
        timestamp: new Date(Date.now() - 3600000).toISOString(),
        user: 'Unknown User',
        description: 'Multiple failed login attempts from suspicious IP address',
        status: 'investigating',
        riskScore: 65,
        affectedResources: ['Authentication System'],
        recommendations: ['Monitor IP address', 'Consider temporary IP block', 'Review authentication logs']
      },
      {
        id: 'sec-002',
        type: 'data_export',
        severity: 'high',
        timestamp: new Date(Date.now() - 7200000).toISOString(),
        user: 'Strategic Lead',
        description: 'Large data export outside normal business hours',
        status: 'resolved',
        riskScore: 75,
        affectedResources: ['Strategic Planning Data', 'Market Analysis Reports'],
        recommendations: ['Verify export authorization', 'Review data classification', 'Update access policies']
      },
      {
        id: 'sec-003',
        type: 'privilege_escalation',
        severity: 'critical',
        timestamp: new Date(Date.now() - 10800000).toISOString(),
        user: 'Unknown Service Account',
        description: 'Unauthorized attempt to escalate system privileges',
        status: 'detected',
        riskScore: 90,
        affectedResources: ['System Configuration', 'User Management'],
        recommendations: ['Immediate investigation required', 'Review service account permissions', 'Audit system access']
      }
    ];

    const complianceReports: ComplianceReport[] = [
      {
        id: 'comp-001',
        reportType: 'SOX Compliance Review',
        period: 'Q1 2024',
        generatedDate: new Date().toISOString(),
        status: 'approved',
        findings: [
          {
            category: 'Access Controls',
            count: 3,
            severity: 'medium',
            details: ['Privileged access review needed', 'Role segregation improvements', 'Access certification overdue']
          },
          {
            category: 'Data Protection',
            count: 1,
            severity: 'low',
            details: ['Encryption key rotation schedule']
          }
        ],
        compliance: [
          {
            framework: 'SOX',
            score: 96.5,
            requirements: [
              { requirement: 'Internal Controls', status: 'compliant', evidence: 'Monthly access reviews documented' },
              { requirement: 'Data Integrity', status: 'compliant', evidence: 'Automated data validation in place' },
              { requirement: 'Audit Trail', status: 'compliant', evidence: 'Comprehensive logging implemented' }
            ]
          }
        ]
      },
      {
        id: 'comp-002',
        reportType: 'GDPR Privacy Assessment',
        period: 'Q1 2024',
        generatedDate: new Date(Date.now() - 86400000).toISOString(),
        status: 'reviewed',
        findings: [
          {
            category: 'Data Processing',
            count: 2,
            severity: 'medium',
            details: ['Update privacy notices', 'Data retention policy review']
          }
        ],
        compliance: [
          {
            framework: 'GDPR',
            score: 94.2,
            requirements: [
              { requirement: 'Lawful Basis', status: 'compliant', evidence: 'Privacy policy updated' },
              { requirement: 'Data Subject Rights', status: 'partial', evidence: 'Automated deletion in progress' },
              { requirement: 'Data Protection Impact Assessment', status: 'compliant', evidence: 'DPIA completed for AI systems' }
            ]
          }
        ]
      }
    ];

    setAuditLogs(generateAuditLogs());
    setSecurityEvents(securityEvents);
    setComplianceReports(complianceReports);

    // Update metrics in real-time
    const interval = setInterval(() => {
      setMetrics(prev => ({
        ...prev,
        totalLogs: prev.totalLogs + Math.floor(Math.random() * 5),
        dailyLogins: prev.dailyLogins + Math.floor(Math.random() * 3),
        failedAttempts: prev.failedAttempts + Math.floor(Math.random() * 2)
      }));
    }, 30000);

    return () => clearInterval(interval);
  }, []);

  const getCategoryColor = (category: string) => {
    switch (category) {
      case 'authentication': return 'bg-blue-500/20 text-blue-300 border-blue-500/30';
      case 'data_access': return 'bg-purple-500/20 text-purple-300 border-purple-500/30';
      case 'configuration': return 'bg-amber-500/20 text-amber-300 border-amber-500/30';
      case 'decision': return 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30';
      case 'system': return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
      case 'security': return 'bg-red-500/20 text-red-300 border-red-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case 'critical': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'high': return 'bg-orange-500/20 text-orange-300 border-orange-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30';
      case 'low': return 'bg-green-500/20 text-green-300 border-green-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const getOutcomeColor = (outcome: string) => {
    switch (outcome) {
      case 'success': return 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30';
      case 'failure': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'warning': return 'bg-amber-500/20 text-amber-300 border-amber-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const filteredLogs = auditLogs.filter((log) => {
    const matchesSearch = log.action.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         log.user.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         log.resource.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesCategory = filterCategory === 'all' || log.category === filterCategory;
    const matchesSeverity = filterSeverity === 'all' || log.severity === filterSeverity;
    
    return matchesSearch && matchesCategory && matchesSeverity;
  });

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-y-auto p-8 space-y-8">
        
        {/* Audit Logging Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-white mb-2">Enterprise Audit & Compliance Center</h1>
            <p className="text-slate-300">Comprehensive activity logging, security monitoring, and compliance tracking</p>
          </div>
          <div className="flex items-center gap-4">
            <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">
              <Shield className="w-4 h-4 mr-2" />
              Compliance: {metrics.complianceScore}%
            </Badge>
            <Button className="bg-blue-600 hover:bg-blue-700">
              <Download className="w-4 h-4 mr-2" />
              Export Logs
            </Button>
          </div>
        </div>

        {/* Metrics Overview */}
        <div className="grid grid-cols-1 md:grid-cols-6 gap-6">
          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Total Logs</h3>
                <FileText className="h-5 w-5 text-blue-400" />
              </div>
              <div className="text-2xl font-bold text-white">{metrics.totalLogs.toLocaleString()}</div>
              <div className="text-sm text-slate-400">All time</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Security Events</h3>
                <AlertTriangle className="h-5 w-5 text-amber-400" />
              </div>
              <div className="text-2xl font-bold text-white">{metrics.securityEvents}</div>
              <div className="text-sm text-slate-400">This month</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Compliance</h3>
                <CheckCircle className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{metrics.complianceScore}%</div>
              <div className="text-sm text-slate-400">Overall score</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">System Health</h3>
                <Activity className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{metrics.systemHealth}%</div>
              <div className="text-sm text-slate-400">Uptime</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Daily Logins</h3>
                <Users className="h-5 w-5 text-purple-400" />
              </div>
              <div className="text-2xl font-bold text-white">{metrics.dailyLogins}</div>
              <div className="text-sm text-slate-400">Today</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Failed Attempts</h3>
                <Lock className="h-5 w-5 text-red-400" />
              </div>
              <div className="text-2xl font-bold text-white">{metrics.failedAttempts}</div>
              <div className="text-sm text-slate-400">Today</div>
            </CardContent>
          </Card>
        </div>

        {/* Main Audit Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="bg-slate-800/50 border border-slate-700/50">
            <TabsTrigger value="dashboard" className="data-[state=active]:bg-slate-700">Dashboard</TabsTrigger>
            <TabsTrigger value="logs" className="data-[state=active]:bg-slate-700">Audit Logs</TabsTrigger>
            <TabsTrigger value="security" className="data-[state=active]:bg-slate-700">Security Events</TabsTrigger>
            <TabsTrigger value="compliance" className="data-[state=active]:bg-slate-700">Compliance</TabsTrigger>
            <TabsTrigger value="analytics" className="data-[state=active]:bg-slate-700">Analytics</TabsTrigger>
          </TabsList>

          {/* Dashboard */}
          <TabsContent value="dashboard" className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              {/* Recent Activity */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Clock className="h-5 w-5" />
                    Recent Activity
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4 max-h-96 overflow-y-auto">
                  {auditLogs.slice(0, 8).map((log) => (
                    <div key={log.id} className="p-3 bg-slate-800/50 rounded-lg border border-slate-600/50">
                      <div className="flex items-start justify-between mb-2">
                        <div className="flex items-center gap-2">
                          <Badge className={getCategoryColor(log.category)}>
                            {log.category.replace('_', ' ').toUpperCase()}
                          </Badge>
                          <Badge className={getOutcomeColor(log.outcome)}>
                            {log.outcome.toUpperCase()}
                          </Badge>
                        </div>
                        <span className="text-xs text-slate-400">
                          {new Date(log.timestamp).toLocaleString()}
                        </span>
                      </div>
                      <h4 className="font-semibold text-white text-sm mb-1">{log.action}</h4>
                      <p className="text-slate-300 text-sm mb-2">{log.details}</p>
                      <div className="text-xs text-slate-500">
                        User: {log.user} | Resource: {log.resource}
                      </div>
                    </div>
                  ))}
                </CardContent>
              </Card>

              {/* Security Alerts */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Shield className="h-5 w-5" />
                    Security Alerts
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  {securityEvents.slice(0, 3).map((event) => (
                    <div key={event.id} className="p-3 bg-slate-800/50 rounded-lg border border-slate-600/50">
                      <div className="flex items-start justify-between mb-2">
                        <Badge className={getSeverityColor(event.severity)}>
                          {event.severity.toUpperCase()}
                        </Badge>
                        <div className="text-right">
                          <div className="text-sm font-medium text-white">Risk: {event.riskScore}%</div>
                          <div className="text-xs text-slate-400">{event.status}</div>
                        </div>
                      </div>
                      <h4 className="font-semibold text-white text-sm mb-1">{event.type.replace('_', ' ')}</h4>
                      <p className="text-slate-300 text-sm mb-2">{event.description}</p>
                      <div className="text-xs text-slate-500">
                        User: {event.user} | {new Date(event.timestamp).toLocaleString()}
                      </div>
                    </div>
                  ))}
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Audit Logs */}
          <TabsContent value="logs" className="space-y-6">
            
            {/* Filters */}
            <div className="flex items-center gap-4 bg-slate-900/50 p-4 rounded-lg border border-slate-700/50">
              <div className="flex-1 page-background relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400" />
                <Input
                  placeholder="Search logs..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="pl-10 bg-slate-800 border-slate-600 text-white"
                />
              </div>
              <Select value={filterCategory} onValueChange={setFilterCategory}>
                <SelectTrigger className="w-48 bg-slate-800 border-slate-600 text-white">
                  <SelectValue placeholder="Category" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">All Categories</SelectItem>
                  <SelectItem value="authentication">Authentication</SelectItem>
                  <SelectItem value="data_access">Data Access</SelectItem>
                  <SelectItem value="configuration">Configuration</SelectItem>
                  <SelectItem value="decision">Decision</SelectItem>
                  <SelectItem value="system">System</SelectItem>
                  <SelectItem value="security">Security</SelectItem>
                </SelectContent>
              </Select>
              <Select value={filterSeverity} onValueChange={setFilterSeverity}>
                <SelectTrigger className="w-40 bg-slate-800 border-slate-600 text-white">
                  <SelectValue placeholder="Severity" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">All Severity</SelectItem>
                  <SelectItem value="critical">Critical</SelectItem>
                  <SelectItem value="high">High</SelectItem>
                  <SelectItem value="medium">Medium</SelectItem>
                  <SelectItem value="low">Low</SelectItem>
                </SelectContent>
              </Select>
            </div>

            {/* Logs Table */}
            <Card className="bg-slate-900/50 border-slate-700/50">
              <CardContent className="p-0">
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead className="bg-slate-800/50 border-b border-slate-700">
                      <tr>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Timestamp</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">User</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Action</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Resource</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Category</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Outcome</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Actions</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-700">
                      {filteredLogs.slice(0, 20).map((log) => (
                        <tr key={log.id} className="hover:bg-slate-800/30">
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-300">
                            {new Date(log.timestamp).toLocaleString()}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-white">
                            {log.user}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-white">
                            {log.action}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-300">
                            {log.resource}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap">
                            <Badge className={getCategoryColor(log.category)}>
                              {log.category.replace('_', ' ')}
                            </Badge>
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap">
                            <Badge className={getOutcomeColor(log.outcome)}>
                              {log.outcome}
                            </Badge>
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm">
                            <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                              <Eye className="w-4 h-4" />
                            </Button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Security Events */}
          <TabsContent value="security" className="space-y-6">
            <div className="space-y-4">
              {securityEvents.map((event) => (
                <Card key={event.id} className="bg-slate-900/50 border-slate-700/50">
                  <CardContent className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex-1 page-background">
                        <div className="flex items-center gap-3 mb-2">
                          <h3 className="text-lg font-semibold text-white">{event.type.replace('_', ' ').toUpperCase()}</h3>
                          <Badge className={getSeverityColor(event.severity)}>
                            {event.severity.toUpperCase()}
                          </Badge>
                          <Badge variant="outline" className="border-slate-600 text-slate-300">
                            {event.status.replace('_', ' ').toUpperCase()}
                          </Badge>
                        </div>
                        <p className="text-slate-300 mb-4">{event.description}</p>
                      </div>
                      <div className="text-right">
                        <div className="text-sm text-slate-400">Risk Score</div>
                        <div className="text-2xl font-bold text-white">{event.riskScore}%</div>
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <div className="text-sm font-semibold text-white mb-2">Affected Resources</div>
                        <div className="space-y-1">
                          {event.affectedResources.map((resource, index) => (
                            <div key={index} className="text-sm text-slate-300 flex items-center gap-2">
                              <Database className="w-4 h-4 text-blue-400" />
                              {resource}
                            </div>
                          ))}
                        </div>
                      </div>
                      
                      <div>
                        <div className="text-sm font-semibold text-white mb-2">Recommendations</div>
                        <div className="space-y-1">
                          {event.recommendations.map((rec, index) => (
                            <div key={index} className="text-sm text-slate-300 flex items-center gap-2">
                              <Target className="w-4 h-4 text-emerald-400" />
                              {rec}
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                    
                    <div className="mt-4 pt-4 border-t border-slate-700 flex items-center justify-between">
                      <div className="text-xs text-slate-500">
                        User: {event.user} | Detected: {new Date(event.timestamp).toLocaleString()}
                      </div>
                      <div className="flex gap-2">
                        <Button size="sm" className="bg-blue-600 hover:bg-blue-700">
                          <Eye className="w-4 h-4 mr-2" />
                          Investigate
                        </Button>
                        <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                          Mark Resolved
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Compliance */}
          <TabsContent value="compliance" className="space-y-6">
            <div className="space-y-4">
              {complianceReports.map((report) => (
                <Card key={report.id} className="bg-slate-900/50 border-slate-700/50">
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-white">{report.reportType}</CardTitle>
                      <Badge className={report.status === 'approved' ? 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30' : 'bg-amber-500/20 text-amber-300 border-amber-500/30'}>
                        {report.status.toUpperCase()}
                      </Badge>
                    </div>
                  </CardHeader>
                  <CardContent className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div>
                        <div className="text-sm text-slate-400">Period</div>
                        <div className="text-white font-medium">{report.period}</div>
                      </div>
                      <div>
                        <div className="text-sm text-slate-400">Generated</div>
                        <div className="text-white font-medium">{new Date(report.generatedDate).toLocaleDateString()}</div>
                      </div>
                      <div>
                        <div className="text-sm text-slate-400">Overall Score</div>
                        <div className="text-white font-medium">{report.compliance[0]?.score}%</div>
                      </div>
                    </div>
                    
                    <div>
                      <h4 className="font-semibold text-white mb-3">Findings</h4>
                      <div className="space-y-2">
                        {report.findings.map((finding, index) => (
                          <div key={index} className="p-3 bg-slate-800/50 rounded-lg">
                            <div className="flex items-center justify-between mb-2">
                              <span className="font-medium text-white">{finding.category}</span>
                              <Badge className={getSeverityColor(finding.severity)}>
                                {finding.count} {finding.severity.toUpperCase()}
                              </Badge>
                            </div>
                            <div className="text-sm text-slate-300">
                              {finding.details.join(', ')}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                    
                    <div className="flex gap-3">
                      <Button className="bg-blue-600 hover:bg-blue-700">
                        <Download className="w-4 h-4 mr-2" />
                        Download Report
                      </Button>
                      <Button variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <Eye className="w-4 h-4 mr-2" />
                        View Details
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Analytics */}
          <TabsContent value="analytics" className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Log Volume</h3>
                    <BarChart3 className="h-5 w-5 text-blue-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">2,847</div>
                  <div className="text-sm text-slate-400">Logs today</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Security Score</h3>
                    <Shield className="h-5 w-5 text-emerald-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">94.2%</div>
                  <div className="text-sm text-slate-400">Overall security</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Response Time</h3>
                    <Clock className="h-5 w-5 text-purple-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">1.2s</div>
                  <div className="text-sm text-slate-400">Average response</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Threat Detection</h3>
                    <TrendingUp className="h-5 w-5 text-emerald-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">99.7%</div>
                  <div className="text-sm text-slate-400">Detection rate</div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/BoardBriefings.tsx
========================================
import PageLayout from '@/components/layout/PageLayout';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { FileText, Download, Calendar, CheckCircle, TrendingUp, Award } from 'lucide-react';

export default function BoardBriefings() {
  const { data: briefingsData, isLoading: briefingsLoading } = useQuery<any[]>({
    queryKey: ['/api/executive-briefings'],
  });

  const { data: boardReportsData, isLoading: reportsLoading } = useQuery<any[]>({
    queryKey: ['/api/board-reports'],
  });

  const briefings = briefingsData ?? [];
  const boardReports = boardReportsData ?? [];
  const acknowledgedBriefings = briefings.filter((b: any) => b.reviewed);

  return (
    <PageLayout>
      <div className="space-y-6 p-6">
        {/* V2 Feature Banner */}
      <div className="bg-blue-50 dark:bg-blue-950/30 border-2 border-blue-300 dark:border-blue-700 rounded-lg p-4">
        <div className="flex items-center gap-3">
          <Badge variant="outline" className="bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 font-semibold">Coming in V2</Badge>
          <p className="text-sm text-gray-700 dark:text-gray-300">
            This feature launches after your organization builds crisis data. Board Briefings auto-generate executive reports with evidence traceability.
          </p>
        </div>
      </div>

      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold flex items-center gap-2" data-testid="page-title">
            <FileText className="h-8 w-8 text-blue-500" />
            Board Briefings
          </h1>
          <p className="text-muted-foreground mt-1">
            Automated executive reports with evidence traceability for board presentations
          </p>
        </div>
        <Button data-testid="button-generate-briefing">
          <FileText className="h-4 w-4 mr-2" />
          Generate New Briefing
        </Button>
      </div>

      {/* Key Metrics */}
      <div className="grid gap-4 md:grid-cols-4">
        <Card data-testid="card-total-briefings">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Total Briefings</CardTitle>
            <FileText className="h-4 w-4 text-blue-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{briefings.length}</div>
            <p className="text-xs text-muted-foreground">
              Executive intelligence summaries
            </p>
          </CardContent>
        </Card>

        <Card data-testid="card-board-reports">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Board Reports</CardTitle>
            <Award className="h-4 w-4 text-purple-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{boardReports.length}</div>
            <p className="text-xs text-muted-foreground">
              Quarterly board presentations
            </p>
          </CardContent>
        </Card>

        <Card data-testid="card-reviewed">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Reviewed</CardTitle>
            <CheckCircle className="h-4 w-4 text-green-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{acknowledgedBriefings.length}</div>
            <p className="text-xs text-muted-foreground">
              Acknowledged by executives
            </p>
          </CardContent>
        </Card>

        <Card data-testid="card-avg-confidence">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Avg Confidence</CardTitle>
            <TrendingUp className="h-4 w-4 text-blue-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              {briefings.length > 0 
                ? Math.round(briefings.reduce((acc: number, b: any) => acc + (b.confidenceLevel || 85), 0) / briefings.length)
                : 85}%
            </div>
            <p className="text-xs text-muted-foreground">
              AI-generated insights
            </p>
          </CardContent>
        </Card>
      </div>

      {/* Executive Briefings */}
      <Card>
        <CardHeader>
          <CardTitle>Executive Briefings</CardTitle>
          <CardDescription>
            AI-generated daily intelligence, crisis alerts, and decision support summaries
          </CardDescription>
        </CardHeader>
        <CardContent>
          {briefingsLoading ? (
            <div className="text-center py-8 text-muted-foreground">Loading briefings...</div>
          ) : briefings.length === 0 ? (
            <div className="text-center py-8 text-muted-foreground">
              <FileText className="h-12 w-12 mx-auto mb-2 text-gray-400" />
              <p>No briefings generated yet</p>
              <Button className="mt-4" data-testid="button-create-first-briefing">Generate First Briefing</Button>
            </div>
          ) : (
            <div className="space-y-4">
              {briefings.map((briefing: any) => (
                <div 
                  key={briefing.id} 
                  className="border rounded-lg p-4 space-y-3"
                  data-testid={`briefing-${briefing.id}`}
                >
                  <div className="flex items-start justify-between">
                    <div className="flex-1 page-background space-y-2">
                      <div className="flex items-center gap-2">
                        <h3 className="font-semibold" data-testid={`text-briefing-title-${briefing.id}`}>{briefing.title}</h3>
                        <Badge variant="outline">{briefing.briefingType}</Badge>
                        {briefing.timeToDecision && (
                          <Badge variant="secondary">{briefing.timeToDecision}</Badge>
                        )}
                        {briefing.reviewed && (
                          <CheckCircle className="h-5 w-5 text-green-500" />
                        )}
                      </div>
                      <p className="text-sm">{briefing.executiveSummary}</p>
                      
                      {briefing.keyInsights && briefing.keyInsights.length > 0 && (
                        <div className="bg-blue-50 dark:bg-blue-950 p-3 rounded-md">
                          <p className="text-sm font-medium mb-1">Key Insights:</p>
                          <ul className="list-disc list-inside text-sm text-muted-foreground">
                            {(briefing.keyInsights as any[]).slice(0, 3).map((insight: string, idx: number) => (
                              <li key={idx}>{insight}</li>
                            ))}
                          </ul>
                        </div>
                      )}

                      <div className="flex items-center gap-4 text-sm text-muted-foreground">
                        {briefing.confidenceLevel && (
                          <span>Confidence: {briefing.confidenceLevel}%</span>
                        )}
                        {briefing.createdAt && (
                          <span className="flex items-center gap-1">
                            <Calendar className="h-4 w-4" />
                            {new Date(briefing.createdAt).toLocaleDateString()}
                          </span>
                        )}
                      </div>
                    </div>

                    <div className="flex flex-col gap-2">
                      <Button size="sm" variant="outline" data-testid={`button-view-briefing-${briefing.id}`}>
                        View Full
                      </Button>
                      <Button size="sm" variant="ghost" data-testid={`button-download-briefing-${briefing.id}`}>
                        <Download className="h-4 w-4" />
                      </Button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>

      {/* Board Reports */}
      <Card>
        <CardHeader>
          <CardTitle>Quarterly Board Reports</CardTitle>
          <CardDescription>
            Comprehensive performance dashboards and strategic updates for board presentations
          </CardDescription>
        </CardHeader>
        <CardContent>
          {reportsLoading ? (
            <div className="text-center py-8 text-muted-foreground">Loading board reports...</div>
          ) : boardReports.length === 0 ? (
            <div className="text-center py-8 text-muted-foreground">
              <Award className="h-12 w-12 mx-auto mb-2 text-gray-400" />
              <p>No board reports generated yet</p>
              <Button className="mt-4" data-testid="button-generate-first-report">Generate First Report</Button>
            </div>
          ) : (
            <div className="space-y-4">
              {boardReports.map((report: any) => (
                <div 
                  key={report.id} 
                  className="border rounded-lg p-4 space-y-3"
                  data-testid={`report-${report.id}`}
                >
                  <div className="flex items-start justify-between">
                    <div className="flex-1 page-background space-y-2">
                      <div className="flex items-center gap-2">
                        <h3 className="font-semibold" data-testid={`text-report-title-${report.id}`}>{report.title}</h3>
                        <Badge variant="outline">{report.reportType}</Badge>
                        <Badge>{report.reportingPeriod}</Badge>
                        {report.approvedBy && (
                          <CheckCircle className="h-5 w-5 text-green-500" />
                        )}
                      </div>
                      <p className="text-sm">{report.executiveSummary}</p>
                      
                      {report.presentedAt && (
                        <div className="flex items-center gap-2 text-sm text-muted-foreground">
                          <Calendar className="h-4 w-4" />
                          <span>Presented: {new Date(report.presentedAt).toLocaleDateString()}</span>
                        </div>
                      )}
                    </div>

                    <div className="flex flex-col gap-2">
                      <Button size="sm" data-testid={`button-view-report-${report.id}`}>
                        View Report
                      </Button>
                      <Button size="sm" variant="outline" data-testid={`button-export-report-${report.id}`}>
                        <Download className="h-4 w-4 mr-2" />
                        Export
                      </Button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/BoardExport.tsx
========================================
import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Checkbox } from '@/components/ui/checkbox';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { 
  FileText,
  Download,
  Clock,
  Users,
  Shield,
  DollarSign,
  TrendingUp,
  BarChart3,
  CheckCircle2,
  AlertTriangle,
  Calendar,
  Building2,
  Target,
  Zap,
  Eye,
  Loader2
} from 'lucide-react';
import { useLocation } from 'wouter';
import StandardNav from '@/components/layout/StandardNav';
import Footer from '@/components/layout/Footer';
import { useToast } from '@/hooks/use-toast';

interface ExportSection {
  id: string;
  label: string;
  description: string;
  icon: React.ReactNode;
  included: boolean;
}

const SAMPLE_DATA = {
  organization: 'Meridian Industries',
  reportDate: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
  quarter: 'Q4 2025',
  preparedBy: 'M Strategic Execution Platform',
  
  executiveSummary: {
    overallReadiness: 87,
    activeScenarios: 3,
    resolvedThisQuarter: 12,
    avgResponseTime: '11m 47s',
    budgetUtilization: 78,
  },
  
  activeScenarios: [
    { id: 1, name: 'Supply Chain Disruption - Asia Pacific', severity: 'High', status: 'Monitoring', daysActive: 14, stakeholders: 8 },
    { id: 2, name: 'Competitive Response - Market Entry', severity: 'Medium', status: 'Executing', daysActive: 3, stakeholders: 6 },
    { id: 3, name: 'Regulatory Compliance - GDPR Update', severity: 'Low', status: 'Planning', daysActive: 7, stakeholders: 4 },
  ],
  
  responseMetrics: {
    avgDecisionTime: '12 min',
    avgExecutionTime: '87 min',
    stakeholderResponseRate: 94,
    playboookActivations: 15,
    tasksCompleted: 847,
    blockerResolution: '8 min avg',
  },
  
  financialSummary: {
    budgetAllocated: 2500000,
    budgetUsed: 1950000,
    revenueProtected: 47000000,
    costAvoided: 12000000,
    roiThisQuarter: 312,
  },
  
  stakeholderCoverage: [
    { department: 'Executive', coverage: 100, trained: 8, total: 8 },
    { department: 'Legal', coverage: 92, trained: 11, total: 12 },
    { department: 'Finance', coverage: 88, trained: 14, total: 16 },
    { department: 'Operations', coverage: 85, trained: 34, total: 40 },
    { department: 'Communications', coverage: 100, trained: 6, total: 6 },
    { department: 'IT/Security', coverage: 95, trained: 19, total: 20 },
  ],
  
  playbookReadiness: [
    { domain: 'Crisis Management', playbooks: 24, readiness: 92, lastDrill: '2 weeks ago' },
    { domain: 'Competitive Response', playbooks: 18, readiness: 88, lastDrill: '1 month ago' },
    { domain: 'M&A Integration', playbooks: 12, readiness: 75, lastDrill: '3 months ago' },
    { domain: 'Regulatory Compliance', playbooks: 20, readiness: 94, lastDrill: '1 week ago' },
    { domain: 'Cyber Security', playbooks: 16, readiness: 91, lastDrill: '2 weeks ago' },
    { domain: 'Market Entry', playbooks: 14, readiness: 82, lastDrill: '6 weeks ago' },
  ],
  
  recommendations: [
    { priority: 'High', recommendation: 'Conduct M&A integration drill before Q1 acquisition', owner: 'COO', dueDate: 'Jan 15, 2026' },
    { priority: 'Medium', recommendation: 'Update Asia Pacific supply chain playbooks with new vendors', owner: 'VP Supply Chain', dueDate: 'Jan 30, 2026' },
    { priority: 'Low', recommendation: 'Schedule competitive response refresher training', owner: 'Chief Strategy Officer', dueDate: 'Feb 15, 2026' },
  ],
};

export default function BoardExport() {
  const [, setLocation] = useLocation();
  const { toast } = useToast();
  const [isGenerating, setIsGenerating] = useState(false);
  const [exportFormat, setExportFormat] = useState<'pdf' | 'pptx' | 'docx'>('pdf');
  
  const [sections, setSections] = useState<ExportSection[]>([
    { id: 'executive_summary', label: 'Executive Summary', description: 'Overall readiness score, active scenarios, key metrics', icon: <Target className="h-5 w-5" />, included: true },
    { id: 'active_scenarios', label: 'Active Scenarios', description: 'Current strategic events and their status', icon: <AlertTriangle className="h-5 w-5" />, included: true },
    { id: 'response_metrics', label: 'Response Metrics', description: 'Decision time, execution time, stakeholder engagement', icon: <Clock className="h-5 w-5" />, included: true },
    { id: 'financial_summary', label: 'Financial Summary', description: 'Budget utilization, revenue protected, ROI', icon: <DollarSign className="h-5 w-5" />, included: true },
    { id: 'stakeholder_coverage', label: 'Stakeholder Coverage', description: 'Department-level training and readiness', icon: <Users className="h-5 w-5" />, included: true },
    { id: 'playbook_readiness', label: 'Playbook Readiness', description: 'Domain-specific playbook status and drill dates', icon: <Shield className="h-5 w-5" />, included: true },
    { id: 'recommendations', label: 'Recommendations', description: 'Action items and next steps for leadership', icon: <Zap className="h-5 w-5" />, included: true },
  ]);

  const toggleSection = (sectionId: string) => {
    setSections(current =>
      current.map(s => s.id === sectionId ? { ...s, included: !s.included } : s)
    );
  };

  const handleExport = async () => {
    setIsGenerating(true);
    
    // Simulate export generation
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    const includedSections = sections.filter(s => s.included).map(s => s.label);
    
    toast({
      title: 'Board Report Generated',
      description: `${exportFormat.toUpperCase()} export with ${includedSections.length} sections is ready for download.`,
    });
    
    setIsGenerating(false);
  };

  const formatCurrency = (value: number) => {
    if (value >= 1000000) return `$${(value / 1000000).toFixed(1)}M`;
    if (value >= 1000) return `$${(value / 1000).toFixed(0)}K`;
    return `$${value.toFixed(0)}`;
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-950">
      <StandardNav />
      
      <div className="container mx-auto px-4 py-12">
        <div className="max-w-6xl mx-auto">
          {/* Header */}
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-purple-500/20 text-purple-400 border-purple-500/30">
              <FileText className="h-4 w-4 mr-2" />
              Board-Ready Export
            </Badge>
            <h1 className="text-4xl font-bold text-white mb-4">
              Executive Briefing Generator
            </h1>
            <p className="text-xl text-slate-300 max-w-2xl mx-auto">
              Generate comprehensive board-ready reports showing strategic readiness, 
              active scenarios, and response metricsin one click.
            </p>
          </div>

          <div className="grid lg:grid-cols-3 gap-8">
            {/* Left Column - Configuration */}
            <div className="space-y-6">
              <Card className="bg-slate-900/50 border-slate-800">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Building2 className="h-5 w-5 text-blue-400" />
                    Report Configuration
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-6">
                  <div className="space-y-2">
                    <Label className="text-slate-300">Export Format</Label>
                    <Select value={exportFormat} onValueChange={(v: 'pdf' | 'pptx' | 'docx') => setExportFormat(v)}>
                      <SelectTrigger className="bg-slate-800 border-slate-700 text-white" data-testid="select-format">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="pdf">PDF Document</SelectItem>
                        <SelectItem value="pptx">PowerPoint Presentation</SelectItem>
                        <SelectItem value="docx">Word Document</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>

                  <div className="space-y-2">
                    <Label className="text-slate-300">Report Period</Label>
                    <div className="text-white bg-slate-800 rounded-md px-3 py-2 border border-slate-700">
                      {SAMPLE_DATA.quarter}
                    </div>
                  </div>

                  <div className="pt-4 border-t border-slate-700">
                    <Label className="text-slate-300 mb-3 block">Include Sections</Label>
                    <div className="space-y-3">
                      {sections.map((section) => (
                        <div 
                          key={section.id}
                          className="flex items-start gap-3 p-2 rounded hover:bg-slate-800/50 transition-colors"
                        >
                          <Checkbox
                            id={section.id}
                            checked={section.included}
                            onCheckedChange={() => toggleSection(section.id)}
                            className="mt-0.5"
                            data-testid={`checkbox-${section.id}`}
                          />
                          <div className="flex-1">
                            <Label 
                              htmlFor={section.id}
                              className="text-white cursor-pointer flex items-center gap-2"
                            >
                              <span className="text-slate-400">{section.icon}</span>
                              {section.label}
                            </Label>
                            <div className="text-xs text-slate-500">{section.description}</div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </CardContent>
              </Card>

              <Button 
                size="lg" 
                className="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700"
                onClick={handleExport}
                disabled={isGenerating || sections.filter(s => s.included).length === 0}
                data-testid="button-generate-report"
              >
                {isGenerating ? (
                  <>
                    <Loader2 className="h-5 w-5 mr-2 animate-spin" />
                    Generating Report...
                  </>
                ) : (
                  <>
                    <Download className="h-5 w-5 mr-2" />
                    Generate Board Report
                  </>
                )}
              </Button>
            </div>

            {/* Right Column - Preview */}
            <div className="lg:col-span-2 space-y-6">
              <Card className="bg-slate-900/50 border-slate-800">
                <CardHeader className="border-b border-slate-800">
                  <div className="flex items-center justify-between">
                    <div>
                      <CardTitle className="text-white flex items-center gap-2">
                        <Eye className="h-5 w-5 text-slate-400" />
                        Report Preview
                      </CardTitle>
                      <CardDescription>
                        {SAMPLE_DATA.organization}  {SAMPLE_DATA.quarter}
                      </CardDescription>
                    </div>
                    <Badge variant="outline" className="text-slate-400">
                      {sections.filter(s => s.included).length} sections selected
                    </Badge>
                  </div>
                </CardHeader>
                <CardContent className="p-6 space-y-6 max-h-[700px] overflow-y-auto">
                  {/* Executive Summary */}
                  {sections.find(s => s.id === 'executive_summary')?.included && (
                    <div className="space-y-4">
                      <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                        <Target className="h-5 w-5 text-violet-400" />
                        Executive Summary
                      </h3>
                      <div className="grid grid-cols-3 gap-4">
                        <div className="bg-gradient-to-br from-green-950/50 to-emerald-950/50 rounded-lg p-4 text-center border border-green-500/20">
                          <div className="text-3xl font-bold text-green-400">{SAMPLE_DATA.executiveSummary.overallReadiness}%</div>
                          <div className="text-sm text-slate-400">Overall Readiness</div>
                        </div>
                        <div className="bg-slate-800/50 rounded-lg p-4 text-center">
                          <div className="text-3xl font-bold text-blue-400">{SAMPLE_DATA.executiveSummary.activeScenarios}</div>
                          <div className="text-sm text-slate-400">Active Scenarios</div>
                        </div>
                        <div className="bg-slate-800/50 rounded-lg p-4 text-center">
                          <div className="text-3xl font-bold text-amber-400">{SAMPLE_DATA.executiveSummary.avgResponseTime}</div>
                          <div className="text-sm text-slate-400">Avg Response Time</div>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Active Scenarios */}
                  {sections.find(s => s.id === 'active_scenarios')?.included && (
                    <div className="space-y-4 pt-4 border-t border-slate-800">
                      <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                        <AlertTriangle className="h-5 w-5 text-amber-400" />
                        Active Scenarios
                      </h3>
                      <div className="space-y-2">
                        {SAMPLE_DATA.activeScenarios.map((scenario) => (
                          <div 
                            key={scenario.id}
                            className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg"
                          >
                            <div className="flex items-center gap-3">
                              <Badge className={
                                scenario.severity === 'High' ? 'bg-red-500/20 text-red-400 border-red-500/30' :
                                scenario.severity === 'Medium' ? 'bg-amber-500/20 text-amber-400 border-amber-500/30' :
                                'bg-green-500/20 text-green-400 border-green-500/30'
                              }>
                                {scenario.severity}
                              </Badge>
                              <span className="text-white">{scenario.name}</span>
                            </div>
                            <div className="flex items-center gap-4 text-sm text-slate-400">
                              <span>{scenario.stakeholders} stakeholders</span>
                              <Badge variant="outline">{scenario.status}</Badge>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Response Metrics */}
                  {sections.find(s => s.id === 'response_metrics')?.included && (
                    <div className="space-y-4 pt-4 border-t border-slate-800">
                      <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                        <Clock className="h-5 w-5 text-blue-400" />
                        Response Metrics
                      </h3>
                      <div className="grid grid-cols-3 gap-3">
                        <div className="bg-slate-800/50 rounded-lg p-3 text-center">
                          <div className="text-xl font-bold text-white">{SAMPLE_DATA.responseMetrics.avgDecisionTime}</div>
                          <div className="text-xs text-slate-500">Avg Decision Time</div>
                        </div>
                        <div className="bg-slate-800/50 rounded-lg p-3 text-center">
                          <div className="text-xl font-bold text-white">{SAMPLE_DATA.responseMetrics.avgExecutionTime}</div>
                          <div className="text-xs text-slate-500">Avg Execution Time</div>
                        </div>
                        <div className="bg-slate-800/50 rounded-lg p-3 text-center">
                          <div className="text-xl font-bold text-green-400">{SAMPLE_DATA.responseMetrics.stakeholderResponseRate}%</div>
                          <div className="text-xs text-slate-500">Response Rate</div>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Financial Summary */}
                  {sections.find(s => s.id === 'financial_summary')?.included && (
                    <div className="space-y-4 pt-4 border-t border-slate-800">
                      <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                        <DollarSign className="h-5 w-5 text-green-400" />
                        Financial Summary
                      </h3>
                      <div className="grid grid-cols-2 gap-3">
                        <div className="bg-slate-800/50 rounded-lg p-3">
                          <div className="text-sm text-slate-400 mb-1">Revenue Protected</div>
                          <div className="text-2xl font-bold text-green-400">{formatCurrency(SAMPLE_DATA.financialSummary.revenueProtected)}</div>
                        </div>
                        <div className="bg-slate-800/50 rounded-lg p-3">
                          <div className="text-sm text-slate-400 mb-1">Cost Avoided</div>
                          <div className="text-2xl font-bold text-green-400">{formatCurrency(SAMPLE_DATA.financialSummary.costAvoided)}</div>
                        </div>
                        <div className="bg-slate-800/50 rounded-lg p-3">
                          <div className="text-sm text-slate-400 mb-1">Budget Utilization</div>
                          <div className="text-2xl font-bold text-blue-400">
                            {formatCurrency(SAMPLE_DATA.financialSummary.budgetUsed)} / {formatCurrency(SAMPLE_DATA.financialSummary.budgetAllocated)}
                          </div>
                        </div>
                        <div className="bg-gradient-to-br from-green-950/50 to-emerald-950/50 rounded-lg p-3 border border-green-500/20">
                          <div className="text-sm text-slate-400 mb-1">Quarterly ROI</div>
                          <div className="text-2xl font-bold text-green-400">{SAMPLE_DATA.financialSummary.roiThisQuarter}%</div>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Playbook Readiness */}
                  {sections.find(s => s.id === 'playbook_readiness')?.included && (
                    <div className="space-y-4 pt-4 border-t border-slate-800">
                      <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                        <Shield className="h-5 w-5 text-purple-400" />
                        Playbook Readiness by Domain
                      </h3>
                      <div className="space-y-2">
                        {SAMPLE_DATA.playbookReadiness.map((domain) => (
                          <div 
                            key={domain.domain}
                            className="flex items-center justify-between p-2 bg-slate-800/30 rounded"
                          >
                            <div className="flex items-center gap-3">
                              <span className="text-white text-sm">{domain.domain}</span>
                              <Badge variant="outline" className="text-xs text-slate-400">
                                {domain.playbooks} playbooks
                              </Badge>
                            </div>
                            <div className="flex items-center gap-3">
                              <span className="text-xs text-slate-500">Drill: {domain.lastDrill}</span>
                              <Badge className={
                                domain.readiness >= 90 ? 'bg-green-500/20 text-green-400' :
                                domain.readiness >= 80 ? 'bg-blue-500/20 text-blue-400' :
                                'bg-amber-500/20 text-amber-400'
                              }>
                                {domain.readiness}%
                              </Badge>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Recommendations */}
                  {sections.find(s => s.id === 'recommendations')?.included && (
                    <div className="space-y-4 pt-4 border-t border-slate-800">
                      <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                        <Zap className="h-5 w-5 text-amber-400" />
                        Recommendations
                      </h3>
                      <div className="space-y-2">
                        {SAMPLE_DATA.recommendations.map((rec, idx) => (
                          <div 
                            key={idx}
                            className="p-3 bg-slate-800/30 rounded-lg border-l-4 border-l-amber-500"
                          >
                            <div className="flex items-start justify-between">
                              <div>
                                <Badge className={
                                  rec.priority === 'High' ? 'bg-red-500/20 text-red-400 mb-2' :
                                  rec.priority === 'Medium' ? 'bg-amber-500/20 text-amber-400 mb-2' :
                                  'bg-green-500/20 text-green-400 mb-2'
                                }>
                                  {rec.priority} Priority
                                </Badge>
                                <div className="text-white text-sm">{rec.recommendation}</div>
                              </div>
                              <div className="text-right text-xs text-slate-500">
                                <div>{rec.owner}</div>
                                <div>{rec.dueDate}</div>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </CardContent>
              </Card>
            </div>
          </div>
        </div>
      </div>
      
      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/BusinessIntelligence.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import PageLayout from '@/components/layout/PageLayout';
import { 
  BarChart3, 
  TrendingUp, 
  DollarSign, 
  Users, 
  Target,
  Globe,
  ArrowUpRight,
  ArrowDownRight,
  AlertTriangle,
  CheckCircle,
  Clock,
  Building2,
  Briefcase,
  PieChart
} from 'lucide-react';

export default function BusinessIntelligence() {
  const executiveMetrics = [
    { title: "Revenue Growth", value: "$127.5M", change: "+23.5%", trend: "up", color: "text-green-600" },
    { title: "Market Share", value: "34.2%", change: "+5.7%", trend: "up", color: "text-blue-600" },
    { title: "Operational Efficiency", value: "94.8%", change: "+12.3%", trend: "up", color: "text-purple-600" },
    { title: "Customer Satisfaction", value: "4.8/5", change: "+0.3", trend: "up", color: "text-orange-600" }
  ];

  const competitiveAnalysis = [
    {
      competitor: "Traditional Consulting Firms",
      strength: "Established relationships",
      weakness: "Slow response times (6+ months)",
      ourAdvantage: "4-minute crisis activation vs 6-month traditional process",
      marketPosition: "Disrupting"
    },
    {
      competitor: "Business Intelligence Platforms", 
      strength: "Data visualization",
      weakness: "No crisis response integration",
      ourAdvantage: "AI intelligence + immediate crisis protocols",
      marketPosition: "Leading"
    },
    {
      competitor: "Crisis Management Software",
      strength: "Crisis protocols",
      weakness: "No predictive AI capabilities", 
      ourAdvantage: "85-92% AI accuracy + comprehensive templates",
      marketPosition: "Superior"
    }
  ];

  const performanceIndicators = [
    { kpi: "Decision Intelligence Speed", current: "4 min", target: "2 min", progress: 80 },
    { kpi: "AI Prediction Accuracy", current: "91%", target: "95%", progress: 92 },
    { kpi: "Crisis Response Readiness", current: "97%", target: "99%", progress: 97 },
    { kpi: "Platform Adoption Rate", current: "87%", target: "95%", progress: 87 }
  ];

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800">
        <div className="p-8">
          {/* Business Intelligence Header */}
          <div className="flex items-center justify-between mb-8">
            <div className="flex items-center space-x-4">
              <div className="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                <BarChart3 className="w-7 h-7 text-white" />
              </div>
              <div>
                <h1 className="text-3xl font-bold text-gray-900 dark:text-white">Business Intelligence Center</h1>
                <p className="text-gray-600 dark:text-gray-300">Executive Analytics & Competitive Intelligence</p>
              </div>
            </div>
            <div className="flex items-center space-x-3">
              <Badge variant="outline" className="text-green-600 border-green-500/50">
                <TrendingUp className="w-3 h-3 mr-1" />
                Market Leading
              </Badge>
              <Badge className="bg-green-600 text-white">
                Executive BI
              </Badge>
            </div>
          </div>

          {/* Executive Performance Dashboard */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            {executiveMetrics.map((metric, index) => (
              <Card key={index} className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
                <CardHeader className="pb-3">
                  <div className="flex items-center justify-between">
                    <CardTitle className="text-sm font-medium text-gray-600 dark:text-gray-400">{metric.title}</CardTitle>
                    {metric.trend === 'up' ? 
                      <ArrowUpRight className="w-4 h-4 text-green-500" /> : 
                      <ArrowDownRight className="w-4 h-4 text-red-500" />
                    }
                  </div>
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold text-gray-900 dark:text-white mb-1">{metric.value}</div>
                  <div className={`text-sm ${metric.color}`}>{metric.change}</div>
                </CardContent>
              </Card>
            ))}
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            {/* Competitive Analysis */}
            <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
              <CardHeader>
                <CardTitle className="flex items-center text-gray-900 dark:text-white">
                  <Target className="w-5 h-5 mr-2 text-red-500" />
                  Competitive Intelligence Analysis
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  {competitiveAnalysis.map((comp, index) => (
                    <div key={index} className="p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                      <div className="flex items-center justify-between mb-2">
                        <h4 className="font-semibold text-gray-900 dark:text-white">{comp.competitor}</h4>
                        <Badge 
                          variant={comp.marketPosition === 'Leading' ? 'default' : 
                                 comp.marketPosition === 'Superior' ? 'destructive' : 'secondary'}
                        >
                          {comp.marketPosition}
                        </Badge>
                      </div>
                      <div className="space-y-2 text-sm">
                        <div className="text-green-600"> Strength: {comp.strength}</div>
                        <div className="text-red-600"> Weakness: {comp.weakness}</div>
                        <div className="text-blue-600 font-medium">Our Advantage: {comp.ourAdvantage}</div>
                      </div>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>

            {/* Performance Indicators */}
            <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
              <CardHeader>
                <CardTitle className="flex items-center text-gray-900 dark:text-white">
                  <PieChart className="w-5 h-5 mr-2 text-purple-500" />
                  Key Performance Indicators
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-6">
                  {performanceIndicators.map((kpi, index) => (
                    <div key={index} className="space-y-2">
                      <div className="flex items-center justify-between text-sm">
                        <span className="font-medium text-gray-900 dark:text-white">{kpi.kpi}</span>
                        <span className="text-gray-600 dark:text-gray-400">{kpi.current} / {kpi.target}</span>
                      </div>
                      <Progress value={kpi.progress} className="h-3" />
                      <div className="text-xs text-gray-500 text-right">{kpi.progress}% of target achieved</div>
                    </div>
                  ))}
                </div>
                <Button className="w-full mt-6" data-testid="button-detailed-analytics">
                  View Detailed Analytics Dashboard
                </Button>
              </CardContent>
            </Card>
          </div>

          {/* Executive Actions */}
          <Card className="bg-gradient-to-r from-blue-500/10 to-purple-500/10 border-blue-200 dark:border-blue-800">
            <CardHeader>
              <CardTitle className="flex items-center text-gray-900 dark:text-white">
                <Briefcase className="w-5 h-5 mr-2 text-blue-500" />
                Executive Business Intelligence Actions
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <Button className="h-14 bg-blue-600 hover:bg-blue-700 text-white" data-testid="button-market-analysis">
                  <Globe className="w-5 h-5 mr-2" />
                  Market Analysis
                </Button>
                <Button className="h-14 bg-green-600 hover:bg-green-700 text-white" data-testid="button-financial-modeling">
                  <DollarSign className="w-5 h-5 mr-2" />
                  Financial Modeling
                </Button>
                <Button className="h-14 bg-purple-600 hover:bg-purple-700 text-white" data-testid="button-competitive-intel">
                  <Target className="w-5 h-5 mr-2" />
                  Competitive Intel
                </Button>
                <Button className="h-14 bg-orange-600 hover:bg-orange-700 text-white" data-testid="button-executive-report">
                  <Briefcase className="w-5 h-5 mr-2" />
                  Executive Report
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/CommandCenter.tsx
========================================
import { useState, useEffect, useCallback, useMemo } from 'react';
import PageLayout from '@/components/layout/PageLayout';
import { useDynamicStrategy } from '@/contexts/DynamicStrategyContext';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';
import ReactConfetti from 'react-confetti';
import { 
  Activity, 
  Zap, 
  Users, 
  Target, 
  TrendingUp, 
  AlertTriangle,
  PlayCircle,
  Pause,
  Radio,
  DollarSign,
  Clock,
  CheckCircle2,
  ArrowRight,
  Bell,
  Shield,
  Radar,
  Rocket,
  Timer,
  Sparkles,
  FastForward,
  Trophy,
  FileCheck,
  Send,
  Wallet,
  Calendar
} from 'lucide-react';

interface CoordinationEvent {
  id: string;
  time: string;
  team: string;
  action: string;
  status: 'completed' | 'in-progress' | 'pending';
}

interface SignalAlert {
  id: string;
  severity: 'critical' | 'high' | 'medium' | 'low';
  title: string;
  source: string;
  time: string;
}

const EXECUTION_PHASES = [
  { id: 'immediate', name: 'Immediate Response', duration: 180, icon: '' },
  { id: 'coordinate', name: 'Team Coordination', duration: 240, icon: '' },
  { id: 'resolve', name: 'Issue Resolution', duration: 240, icon: '' },
  { id: 'close', name: 'Closure & Learning', duration: 60, icon: '' },
];

interface DemoTask {
  id: string;
  time: number;
  team: string;
  action: string;
  type: 'task' | 'document' | 'communication' | 'budget' | 'integration';
  value: number;
}

const DEMO_TASKS: DemoTask[] = [
  { id: 't1', time: 15, team: 'Executive', action: 'Crisis team activated', type: 'task', value: 5000 },
  { id: 't2', time: 30, team: 'Legal', action: 'NDA template staged', type: 'document', value: 2500 },
  { id: 't3', time: 45, team: 'Communications', action: 'Press statement drafted', type: 'communication', value: 8000 },
  { id: 't4', time: 60, team: 'Finance', action: '$500K emergency budget unlocked', type: 'budget', value: 12000 },
  { id: 't5', time: 90, team: 'IT Security', action: 'System isolation protocol started', type: 'task', value: 3500 },
  { id: 't6', time: 120, team: 'Operations', action: 'Backup suppliers notified', type: 'communication', value: 4200 },
  { id: 't7', time: 150, team: 'HR', action: 'Employee communication ready', type: 'document', value: 2800 },
  { id: 't8', time: 180, team: 'Jira', action: 'Project synced - 24 tasks created', type: 'integration', value: 6500 },
  { id: 't9', time: 210, team: 'Legal', action: 'Contract review initiated', type: 'task', value: 5500 },
  { id: 't10', time: 240, team: 'Board', action: 'Emergency meeting scheduled', type: 'task', value: 15000 },
  { id: 't11', time: 280, team: 'ServiceNow', action: 'Incident ticket auto-created', type: 'integration', value: 3200 },
  { id: 't12', time: 320, team: 'Investors', action: 'IR statement approved', type: 'communication', value: 25000 },
  { id: 't13', time: 360, team: 'Risk', action: 'Impact assessment complete', type: 'document', value: 8500 },
  { id: 't14', time: 400, team: 'Operations', action: 'Contingency plan activated', type: 'task', value: 11000 },
  { id: 't15', time: 450, team: 'Slack', action: 'War room channel created', type: 'integration', value: 1500 },
  { id: 't16', time: 500, team: 'Procurement', action: 'Emergency vendor contracts staged', type: 'document', value: 7200 },
  { id: 't17', time: 540, team: 'Strategy', action: 'Competitive response brief ready', type: 'document', value: 9000 },
  { id: 't18', time: 600, team: 'CEO', action: 'Executive briefing delivered', type: 'communication', value: 15000 },
  { id: 't19', time: 660, team: 'Finance', action: 'Financial impact model completed', type: 'document', value: 20000 },
  { id: 't20', time: 700, team: 'All Teams', action: 'Execution complete - Learning captured', type: 'task', value: 8600 },
];

const DEMO_SPEEDS = [
  { label: '1x', value: 1, icon: '' },
  { label: '2x', value: 2, icon: '' },
  { label: '5x', value: 5, icon: '' },
  { label: '10x', value: 10, icon: '' },
];

export default function CommandCenter() {
  const { 
    readiness, 
    activeScenarios, 
    weakSignals, 
    oraclePatterns,
    continuousMode,
    teamsCoordinating,
    percentOnTrack,
    isLoading
  } = useDynamicStrategy();

  const [currentTime, setCurrentTime] = useState(new Date());
  const [demoSpeed, setDemoSpeed] = useState(1);
  const [showConfetti, setShowConfetti] = useState(false);
  const [lastTickTime, setLastTickTime] = useState<number>(0);
  const [demoExecution, setDemoExecution] = useState<{
    active: boolean;
    startTime: number;
    elapsedSeconds: number;
    phase: number;
    scenario: string;
    completedTasks: string[];
    accumulatedValue: number;
  } | null>(null);

  useEffect(() => {
    const timer = setInterval(() => setCurrentTime(new Date()), 1000);
    return () => clearInterval(timer);
  }, []);

  useEffect(() => {
    if (demoExecution?.active) {
      const interval = setInterval(() => {
        const now = Date.now();
        const deltaRealMs = now - lastTickTime;
        const deltaScaledSeconds = (deltaRealMs / 1000) * demoSpeed;
        setLastTickTime(now);
        
        setDemoExecution(prev => {
          if (!prev) return null;
          const newElapsed = Math.min(720, prev.elapsedSeconds + deltaScaledSeconds);
          
          let currentPhase = 0;
          let accumulated = 0;
          for (let i = 0; i < EXECUTION_PHASES.length; i++) {
            accumulated += EXECUTION_PHASES[i].duration;
            if (newElapsed < accumulated) {
              currentPhase = i;
              break;
            }
            if (i === EXECUTION_PHASES.length - 1) currentPhase = i;
          }
          
          const newCompletedTasks = DEMO_TASKS
            .filter(t => t.time <= newElapsed)
            .map(t => t.id);
          
          const newValue = DEMO_TASKS
            .filter(t => t.time <= newElapsed)
            .reduce((sum, t) => sum + t.value, 0);
          
          if (newElapsed >= 720) {
            setShowConfetti(true);
            setTimeout(() => setShowConfetti(false), 8000);
            return { ...prev, active: false, elapsedSeconds: 720, phase: 4, completedTasks: newCompletedTasks, accumulatedValue: newValue };
          }
          
          return { ...prev, elapsedSeconds: newElapsed, phase: currentPhase, completedTasks: newCompletedTasks, accumulatedValue: newValue };
        });
      }, 100);
      return () => clearInterval(interval);
    }
  }, [demoExecution?.active, demoSpeed, lastTickTime]);

  const launchDemoExecution = useCallback(() => {
    setShowConfetti(false);
    setLastTickTime(Date.now());
    setDemoExecution({
      active: true,
      startTime: Date.now(),
      elapsedSeconds: 0,
      phase: 0,
      scenario: 'Competitor Acquisition Response',
      completedTasks: [],
      accumulatedValue: 0,
    });
  }, []);

  const recentTasks = useMemo(() => {
    if (!demoExecution) return [];
    return DEMO_TASKS
      .filter(t => demoExecution.completedTasks.includes(t.id))
      .slice(-5)
      .reverse();
  }, [demoExecution?.completedTasks]);

  const getTaskIcon = (type: DemoTask['type']) => {
    switch (type) {
      case 'task': return <CheckCircle2 className="w-4 h-4 text-emerald-500" />;
      case 'document': return <FileCheck className="w-4 h-4 text-blue-500" />;
      case 'communication': return <Send className="w-4 h-4 text-violet-500" />;
      case 'budget': return <Wallet className="w-4 h-4 text-amber-500" />;
      case 'integration': return <Zap className="w-4 h-4 text-cyan-500" />;
    }
  };

  const formatTime = (seconds: number, countdown: boolean = false) => {
    const displaySeconds = countdown ? Math.max(0, 720 - seconds) : seconds;
    const mins = Math.floor(displaySeconds / 60);
    const secs = displaySeconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const coordinationTimeline: CoordinationEvent[] = [
    { id: '1', time: '2 min ago', team: 'Legal', action: 'Approved crisis communication draft', status: 'completed' },
    { id: '2', time: '5 min ago', team: 'Communications', action: 'Drafting stakeholder message', status: 'in-progress' },
    { id: '3', time: '8 min ago', team: 'Operations', action: 'Activated supply chain backup', status: 'completed' },
    { id: '4', time: '10 min ago', team: 'Executive', action: 'CEO briefing scheduled', status: 'pending' },
    { id: '5', time: '12 min ago', team: 'IT Security', action: 'System isolation complete', status: 'completed' },
  ];

  const signalAlerts: SignalAlert[] = [
    { id: '1', severity: 'critical', title: 'Competitor acquisition announced', source: 'Market Intel', time: '1 min ago' },
    { id: '2', severity: 'high', title: 'Supply chain disruption - Region APAC', source: 'Operations Monitor', time: '15 min ago' },
    { id: '3', severity: 'medium', title: 'Social sentiment shift detected', source: 'Echo Analytics', time: '32 min ago' },
    { id: '4', severity: 'low', title: 'Regulatory update - GDPR amendment', source: 'Compliance Watch', time: '1 hr ago' },
  ];

  const severityColors = {
    critical: 'bg-red-500 text-white',
    high: 'bg-orange-500 text-white',
    medium: 'bg-amber-500 text-white',
    low: 'bg-blue-500 text-white'
  };

  // Fetch ROI metrics
  const { data: roiReport } = useQuery<any>({
    queryKey: ['/api/roi/report'],
  });

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-blue-950 p-8">
        <div className="max-w-7xl mx-auto">
          <div className="animate-pulse space-y-4">
            <div className="h-12 bg-slate-200 dark:bg-slate-800 rounded"></div>
            <div className="h-64 bg-slate-200 dark:bg-slate-800 rounded"></div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <PageLayout>
      {/* Confetti Celebration */}
      {showConfetti && (
        <ReactConfetti
          width={window.innerWidth}
          height={window.innerHeight}
          recycle={false}
          numberOfPieces={500}
          gravity={0.2}
          colors={['#3B82F6', '#8B5CF6', '#10B981', '#F59E0B', '#EC4899']}
        />
      )}

      {/* Header with Key Metrics */}
      <div className="bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-blue-950 border-b border-slate-200 dark:border-slate-800">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div>
              <div className="flex items-center gap-3 mb-2">
                <h1 className="text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900 dark:text-white">
                  Command Center
                </h1>
                <OnboardingTrigger pageId="command-center" autoStart={true} />
              </div>
              <p className="text-sm sm:text-base text-slate-600 dark:text-slate-400 flex flex-wrap items-center gap-2">
                <span className="hidden sm:inline">Real-time strategic execution coordination and control</span>
                <span className="sm:hidden">Live execution control</span>
                <Badge variant="outline" className="text-xs">
                  <Clock className="w-3 h-3 mr-1" />
                  {currentTime.toLocaleTimeString()}
                </Badge>
              </p>
            </div>
            <div className="grid grid-cols-3 gap-3 sm:flex sm:items-center sm:gap-6">
              <div className="text-center">
                <div className="text-xl sm:text-3xl font-bold text-blue-600 dark:text-blue-400">
                  {activeScenarios.length}
                </div>
                <div className="text-[10px] sm:text-xs text-slate-600 dark:text-slate-400 uppercase tracking-wide">
                  Active
                </div>
              </div>
              <div className="hidden sm:block h-12 w-px bg-slate-300 dark:bg-slate-700"></div>
              <div className="text-center">
                <div className="text-xl sm:text-3xl font-bold text-violet-600 dark:text-violet-400">
                  {teamsCoordinating}
                </div>
                <div className="text-[10px] sm:text-xs text-slate-600 dark:text-slate-400 uppercase tracking-wide">
                  Teams
                </div>
              </div>
              <div className="hidden sm:block h-12 w-px bg-slate-300 dark:bg-slate-700"></div>
              <div className="text-center">
                <div className="text-xl sm:text-3xl font-bold text-emerald-600 dark:text-emerald-400">
                  {percentOnTrack}%
                </div>
                <div className="text-[10px] sm:text-xs text-slate-600 dark:text-slate-400 uppercase tracking-wide">
                  On Track
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Live Execution Velocity Display - Hero Section */}
      {demoExecution && (
        <div className="bg-gradient-to-r from-blue-600 via-violet-600 to-purple-600 dark:from-blue-800 dark:via-violet-800 dark:to-purple-800">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
            <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
              <div className="flex items-center gap-4 sm:gap-6">
                <div className="relative shrink-0">
                  <div className="w-16 h-16 sm:w-24 sm:h-24 rounded-full bg-white/10 flex items-center justify-center border-2 sm:border-4 border-white/30">
                    <div className="text-center">
                      <div className="text-xl sm:text-3xl font-bold text-white" data-testid="text-countdown-time">
                        {formatTime(demoExecution.elapsedSeconds, true)}
                      </div>
                      <div className="text-[10px] sm:text-xs text-white/70">remaining</div>
                    </div>
                  </div>
                  {demoExecution.active && (
                    <div className="absolute -top-1 -right-1 w-3 h-3 sm:w-4 sm:h-4 bg-green-400 rounded-full animate-pulse border-2 border-white"></div>
                  )}
                </div>
                <div className="min-w-0 flex-1">
                  <div className="flex flex-wrap items-center gap-2 mb-1">
                    <Rocket className="w-4 h-4 sm:w-5 sm:h-5 text-white shrink-0" />
                    <h2 className="text-base sm:text-xl font-bold text-white truncate">
                      {demoExecution.scenario}
                    </h2>
                    {demoExecution.active ? (
                      <Badge className="bg-green-500 text-white animate-pulse text-xs">LIVE</Badge>
                    ) : (
                      <Badge className="bg-emerald-500 text-white text-xs">COMPLETED</Badge>
                    )}
                  </div>
                  <p className="text-white/80 text-xs sm:text-sm truncate">
                    {demoExecution.active 
                      ? `Executing: ${EXECUTION_PHASES[demoExecution.phase]?.name}`
                      : 'Complete - All phases finished'}
                  </p>
                </div>
              </div>
              <div className="flex flex-wrap items-center gap-2 sm:gap-4 lg:gap-6">
                <div className="grid grid-cols-3 gap-2 sm:flex sm:items-center sm:gap-4 flex-1 sm:flex-initial">
                  <div className="text-center px-2 sm:px-3 py-1.5 sm:py-2 bg-white/10 rounded-lg">
                    <div className="text-base sm:text-xl font-bold text-white">{demoExecution.completedTasks.length}</div>
                    <div className="text-[10px] sm:text-xs text-white/70">Tasks</div>
                  </div>
                  <div className="text-center px-2 sm:px-3 py-1.5 sm:py-2 bg-white/10 rounded-lg">
                    <div className="text-base sm:text-xl font-bold text-emerald-300" data-testid="text-roi-value">
                      ${(demoExecution.accumulatedValue / 1000).toFixed(0)}K
                    </div>
                    <div className="text-[10px] sm:text-xs text-white/70">Value</div>
                  </div>
                  <div className="text-center px-2 sm:px-3 py-1.5 sm:py-2 bg-white/10 rounded-lg">
                    <div className="text-base sm:text-xl font-bold text-white">8</div>
                    <div className="text-[10px] sm:text-xs text-white/70">Teams</div>
                  </div>
                </div>
                <div className="flex items-center gap-1">
                  {DEMO_SPEEDS.map((speed) => (
                    <Button
                      key={speed.value}
                      size="sm"
                      variant={demoSpeed === speed.value ? "secondary" : "ghost"}
                      className={`h-7 sm:h-8 px-2 sm:px-3 text-xs ${demoSpeed === speed.value ? "bg-white text-violet-600" : "text-white hover:bg-white/20"}`}
                      onClick={() => setDemoSpeed(speed.value)}
                      data-testid={`button-speed-${speed.value}x`}
                    >
                      {speed.label}
                    </Button>
                  ))}
                </div>
              </div>
            </div>
            
            {/* Phase Progress Bar */}
            <div className="mt-4 sm:mt-6 grid grid-cols-2 sm:flex gap-2">
              {EXECUTION_PHASES.map((phase, idx) => {
                const phaseStart = EXECUTION_PHASES.slice(0, idx).reduce((a, p) => a + p.duration, 0);
                const phaseProgress = demoExecution.elapsedSeconds >= phaseStart + phase.duration 
                  ? 100 
                  : demoExecution.elapsedSeconds <= phaseStart 
                    ? 0 
                    : ((demoExecution.elapsedSeconds - phaseStart) / phase.duration) * 100;
                const isActive = demoExecution.phase === idx && demoExecution.active;
                const isComplete = demoExecution.elapsedSeconds >= phaseStart + phase.duration;
                
                return (
                  <div key={phase.id} className="flex-1" data-testid={`phase-progress-${phase.id}`}>
                    <div className="flex items-center justify-between mb-1">
                      <span className={`text-[10px] sm:text-xs font-medium ${isActive ? 'text-white' : 'text-white/60'}`}>
                        {phase.icon} <span className="hidden sm:inline">{phase.name}</span>
                        <span className="sm:hidden">{phase.name.split(' ')[0]}</span>
                      </span>
                      {isComplete && <CheckCircle2 className="w-3 h-3 text-emerald-300" />}
                    </div>
                    <div className="h-1.5 sm:h-2 bg-white/20 rounded-full overflow-hidden">
                      <div 
                        className={`h-full transition-all duration-300 ${
                          isComplete ? 'bg-emerald-400' : isActive ? 'bg-white animate-pulse' : 'bg-white/40'
                        }`}
                        style={{ width: `${phaseProgress}%` }}
                      ></div>
                    </div>
                  </div>
                );
              })}
            </div>

            {/* Live Activity Feed */}
            {demoExecution.completedTasks.length > 0 && (
              <div className="mt-4 pt-4 border-t border-white/20">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                    <Activity className="w-4 h-4 text-white/70" />
                    <span className="text-xs font-medium text-white/70 uppercase tracking-wide">Live Activity</span>
                  </div>
                  <span className="text-xs text-white/60">{demoExecution.completedTasks.length} of 20 tasks</span>
                </div>
                <div className="max-h-24 overflow-y-auto scrollbar-thin scrollbar-thumb-white/20">
                  <div className="flex flex-wrap gap-2">
                    {DEMO_TASKS
                      .filter(t => demoExecution.completedTasks.includes(t.id))
                      .reverse()
                      .map((task, idx) => (
                      <div 
                        key={task.id}
                        className={`flex items-center gap-2 px-3 py-1.5 bg-white/10 rounded-full text-xs text-white whitespace-nowrap ${
                          idx === 0 ? 'animate-pulse ring-2 ring-white/30' : ''
                        }`}
                        data-testid={`live-task-${task.id}`}
                      >
                        {getTaskIcon(task.type)}
                        <span className="font-medium">{task.team}:</span>
                        <span className="opacity-90 max-w-[150px] truncate">{task.action}</span>
                        <span className="opacity-60">+${(task.value/1000).toFixed(0)}K</span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Completion Celebration Modal */}
      {demoExecution && !demoExecution.active && demoExecution.elapsedSeconds >= 720 && (
        <div className="bg-gradient-to-r from-emerald-600 to-teal-600 dark:from-emerald-800 dark:to-teal-800">
          <div className="max-w-7xl mx-auto px-8 py-8">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-6">
                <div className="w-20 h-20 rounded-full bg-white/20 flex items-center justify-center">
                  <Trophy className="w-10 h-10 text-white" />
                </div>
                <div>
                  <h2 className="text-2xl font-bold text-white mb-1">
                    Execution Complete!
                  </h2>
                  <p className="text-white/80">
                    {demoExecution.scenario} - Full coordinated response in under 12 minutes
                  </p>
                </div>
              </div>
              <div className="flex items-center gap-8">
                <div className="text-center px-4 py-2 bg-white/10 rounded-lg">
                  <div className="text-3xl font-bold text-white">{demoExecution.completedTasks.length}</div>
                  <div className="text-xs text-white/70">Tasks Completed</div>
                </div>
                <div className="text-center px-4 py-2 bg-white/10 rounded-lg">
                  <div className="text-3xl font-bold text-emerald-200">${(demoExecution.accumulatedValue / 1000).toFixed(0)}K</div>
                  <div className="text-xs text-white/70">Value Delivered</div>
                </div>
                <div className="text-center px-4 py-2 bg-white/10 rounded-lg">
                  <div className="text-3xl font-bold text-white">8</div>
                  <div className="text-xs text-white/70">Teams Coordinated</div>
                </div>
                <Button
                  size="lg"
                  onClick={launchDemoExecution}
                  className="bg-white text-emerald-600 hover:bg-white/90"
                  data-testid="button-restart-demo"
                >
                  <Rocket className="w-4 h-4 mr-2" />
                  Run Again
                </Button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Main Content */}
      <div className="max-w-7xl mx-auto p-8 space-y-8">
        {/* Active Scenarios - or Demo Launch */}
        <div>
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-2xl font-bold text-slate-900 dark:text-white">Active Scenarios</h2>
            <div className="flex gap-2">
              <Button 
                variant="outline"
                onClick={launchDemoExecution}
                disabled={demoExecution?.active}
                data-testid="button-demo-execution"
              >
                <Timer className="w-4 h-4 mr-2" />
                Demo 12-Min Execution
              </Button>
              <Button data-testid="button-launch-scenario">
                <PlayCircle className="w-4 h-4 mr-2" />
                Launch New Scenario
              </Button>
            </div>
          </div>
          {activeScenarios.length === 0 && !demoExecution ? (
            <Card className="border-2 border-dashed border-slate-300 dark:border-slate-700 bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950" data-testid="card-no-scenarios">
              <CardContent className="py-12 text-center">
                <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 dark:bg-blue-900 mb-4">
                  <Sparkles className="w-8 h-8 text-blue-600 dark:text-blue-400" />
                </div>
                <h3 className="text-xl font-semibold text-slate-900 dark:text-white mb-2">
                  Ready for Strategic Execution
                </h3>
                <p className="text-slate-600 dark:text-slate-400 max-w-md mx-auto mb-6">
                  M monitors 12 intelligence signals continuously. When a trigger fires, 
                  your coordinated response activates in under 12 minutes.
                </p>
                <div className="flex items-center justify-center gap-4 mb-6">
                  <div className="text-center px-4 py-2 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                    <div className="text-2xl font-bold text-blue-600 dark:text-blue-400">166</div>
                    <div className="text-xs text-slate-500">Playbooks Ready</div>
                  </div>
                  <div className="text-center px-4 py-2 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                    <div className="text-2xl font-bold text-violet-600 dark:text-violet-400">12</div>
                    <div className="text-xs text-slate-500">Signal Sources</div>
                  </div>
                  <div className="text-center px-4 py-2 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                    <div className="text-2xl font-bold text-emerald-600 dark:text-emerald-400">&lt;12m</div>
                    <div className="text-xs text-slate-500">Activation Time</div>
                  </div>
                </div>
                <Button 
                  size="lg" 
                  onClick={launchDemoExecution}
                  className="bg-gradient-to-r from-blue-600 to-violet-600 hover:from-blue-700 hover:to-violet-700"
                  data-testid="button-launch-demo"
                >
                  <Rocket className="w-4 h-4 mr-2" />
                  Watch 12-Minute Execution Demo
                </Button>
              </CardContent>
            </Card>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {activeScenarios.map((scenario) => (
                <Card key={scenario.id} className="border-l-4 border-l-blue-500" data-testid={`card-scenario-${scenario.id}`}>
                  <CardHeader>
                    <div className="flex items-start justify-between">
                      <div>
                        <CardTitle className="text-lg">{scenario.name}</CardTitle>
                        <CardDescription>
                          {scenario.teamsInvolved} teams coordinating
                        </CardDescription>
                      </div>
                      <Badge variant={scenario.status === 'active' ? 'default' : 'secondary'}>
                        {scenario.status === 'active' && <Radio className="w-3 h-3 mr-1 animate-pulse" />}
                        {scenario.status}
                      </Badge>
                    </div>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-2">
                      <div className="flex items-center justify-between text-sm">
                        <span className="text-slate-600 dark:text-slate-400">Progress</span>
                        <span className="font-semibold">{scenario.progress}%</span>
                      </div>
                      <Progress value={scenario.progress} />
                      <Button variant="outline" size="sm" className="w-full mt-2" data-testid={`button-view-${scenario.id}`}>
                        View Details
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          )}
        </div>

        {/* ROI & Value Demonstration */}
        {roiReport && (
          <Card className="border-2 border-emerald-500 dark:border-emerald-700 bg-emerald-50 dark:bg-emerald-950/30">
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <DollarSign className="w-5 h-5 text-emerald-600" />
                Enterprise Value Realized
              </CardTitle>
              <CardDescription>
                Cumulative impact from strategic executions
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div className="p-3 bg-white dark:bg-slate-800 rounded-lg border border-emerald-200 dark:border-emerald-900">
                  <div className="text-xs text-slate-600 dark:text-slate-400 mb-1">Total Value</div>
                  <div className="text-lg font-bold text-emerald-600 dark:text-emerald-400">
                    ${(roiReport.cumulativeValue / 1000000).toFixed(1)}M
                  </div>
                </div>
                <div className="p-3 bg-white dark:bg-slate-800 rounded-lg border border-emerald-200 dark:border-emerald-900">
                  <div className="text-xs text-slate-600 dark:text-slate-400 mb-1">Executions</div>
                  <div className="text-lg font-bold text-emerald-600 dark:text-emerald-400">
                    {roiReport.totalExecutions}
                  </div>
                </div>
                <div className="p-3 bg-white dark:bg-slate-800 rounded-lg border border-emerald-200 dark:border-emerald-900">
                  <div className="text-xs text-slate-600 dark:text-slate-400 mb-1">Avg Velocity</div>
                  <div className="text-lg font-bold text-emerald-600 dark:text-emerald-400">
                    {roiReport.avgTimeToActivate}m
                  </div>
                </div>
                <div className="p-3 bg-white dark:bg-slate-800 rounded-lg border border-emerald-200 dark:border-emerald-900">
                  <div className="text-xs text-slate-600 dark:text-slate-400 mb-1">Efficiency</div>
                  <div className="text-lg font-bold text-emerald-600 dark:text-emerald-400">
                    {roiReport.efficiency}
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        )}

        {/* Real-time Coordination & Alerts */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* Coordination Timeline */}
          <Card data-testid="card-coordination-timeline">
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Users className="w-5 h-5 text-violet-600" />
                Coordination Timeline
              </CardTitle>
              <CardDescription>
                Live team coordination across active scenarios
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                {coordinationTimeline.map((event) => (
                  <div 
                    key={event.id} 
                    className="flex items-start gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700"
                    data-testid={`timeline-event-${event.id}`}
                  >
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${
                      event.status === 'completed' ? 'bg-emerald-100 dark:bg-emerald-900' :
                      event.status === 'in-progress' ? 'bg-blue-100 dark:bg-blue-900' :
                      'bg-slate-200 dark:bg-slate-700'
                    }`}>
                      {event.status === 'completed' ? (
                        <CheckCircle2 className="w-4 h-4 text-emerald-600 dark:text-emerald-400" />
                      ) : event.status === 'in-progress' ? (
                        <Radio className="w-4 h-4 text-blue-600 dark:text-blue-400 animate-pulse" />
                      ) : (
                        <Clock className="w-4 h-4 text-slate-500" />
                      )}
                    </div>
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center justify-between">
                        <span className="font-medium text-sm text-slate-900 dark:text-white">
                          {event.team}
                        </span>
                        <span className="text-xs text-slate-500">{event.time}</span>
                      </div>
                      <p className="text-sm text-slate-600 dark:text-slate-400 truncate">
                        {event.action}
                      </p>
                    </div>
                    <ArrowRight className="w-4 h-4 text-slate-400 flex-shrink-0" />
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>

          {/* Signal Alerts */}
          <Card data-testid="card-signal-alerts">
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Bell className="w-5 h-5 text-amber-600" />
                Signal Alerts
              </CardTitle>
              <CardDescription>
                Real-time intelligence from 12 monitoring sources
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                {signalAlerts.map((alert) => (
                  <div 
                    key={alert.id} 
                    className="flex items-start gap-3 p-3 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors cursor-pointer"
                    data-testid={`signal-alert-${alert.id}`}
                  >
                    <Badge className={`${severityColors[alert.severity]} text-xs px-2`}>
                      {alert.severity.toUpperCase()}
                    </Badge>
                    <div className="flex-1 min-w-0">
                      <p className="font-medium text-sm text-slate-900 dark:text-white">
                        {alert.title}
                      </p>
                      <div className="flex items-center gap-2 mt-1">
                        <span className="text-xs text-slate-500">{alert.source}</span>
                        <span className="text-xs text-slate-400"></span>
                        <span className="text-xs text-slate-500">{alert.time}</span>
                      </div>
                    </div>
                    <Button variant="ghost" size="sm" className="flex-shrink-0">
                      <ArrowRight className="w-4 h-4" />
                    </Button>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Grid: Readiness + Weak Signals + Oracle */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Future Readiness */}
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <TrendingUp className="w-5 h-5 text-blue-600" />
                Future Readiness Index
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-center mb-4">
                <div className="text-5xl font-bold text-blue-600 dark:text-blue-400 mb-2">
                  {readiness.overall.toFixed(1)}%
                </div>
                <p className="text-sm text-slate-600 dark:text-slate-400">
                  Overall Readiness Score
                </p>
              </div>
              <div className="space-y-3">
                {Object.entries(readiness).filter(([key]) => key !== 'overall').map(([key, value]) => (
                  <div key={key}>
                    <div className="flex items-center justify-between text-sm mb-1">
                      <span className="capitalize text-slate-700 dark:text-slate-300">{key}</span>
                      <span className="font-semibold">{value}%</span>
                    </div>
                    <Progress value={value} className="h-2" />
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>

          {/* Weak Signals */}
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <AlertTriangle className="w-5 h-5 text-amber-600" />
                Weak Signals Detected
              </CardTitle>
              <CardDescription>
                {weakSignals.length} signals detected
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-3 max-h-96 overflow-y-auto">
                {weakSignals.slice(0, 5).map((signal) => (
                  <div 
                    key={signal.id} 
                    className="p-3 bg-amber-50 dark:bg-amber-950/30 rounded-lg border border-amber-200 dark:border-amber-900"
                    data-testid={`weak-signal-${signal.id}`}
                  >
                    <div className="flex items-start justify-between mb-1">
                      <h4 className="font-semibold text-sm text-slate-900 dark:text-white">
                        {signal.title}
                      </h4>
                      <Badge variant="outline" className="text-xs">
                        {signal.confidence}%
                      </Badge>
                    </div>
                    <p className="text-xs text-slate-600 dark:text-slate-400">
                      {signal.source}  {signal.category}
                    </p>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>

          {/* Oracle Patterns */}
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Zap className="w-5 h-5 text-violet-600" />
                Oracle Intelligence
              </CardTitle>
              <CardDescription>
                {oraclePatterns.length} patterns recognized
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-3 max-h-96 overflow-y-auto">
                {oraclePatterns.map((pattern) => (
                  <div 
                    key={pattern.id} 
                    className="p-3 bg-violet-50 dark:bg-violet-950/30 rounded-lg border border-violet-200 dark:border-violet-900"
                    data-testid={`oracle-pattern-${pattern.id}`}
                  >
                    <div className="flex items-start justify-between mb-1">
                      <h4 className="font-semibold text-sm text-slate-900 dark:text-white">
                        {pattern.name}
                      </h4>
                      <Badge variant="outline" className="text-xs">
                        {pattern.accuracy}%
                      </Badge>
                    </div>
                    <p className="text-xs text-slate-600 dark:text-slate-400">
                      {pattern.signals} signals  {pattern.trend}
                    </p>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Continuous Mode Status */}
        <Card className="border-2 border-blue-500 dark:border-blue-700">
          <CardHeader>
            <div className="flex items-center justify-between">
              <div>
                <CardTitle className="flex items-center gap-2">
                  <Activity className="w-5 h-5 text-blue-600" />
                  Continuous Operations Mode
                </CardTitle>
                <CardDescription>
                  Always-on strategic monitoring and coordination
                </CardDescription>
              </div>
              <Button 
                variant={continuousMode.enabled ? "destructive" : "default"}
                data-testid="button-toggle-continuous-mode"
              >
                {continuousMode.enabled ? (
                  <>
                    <Pause className="w-4 h-4 mr-2" />
                    Pause
                  </>
                ) : (
                  <>
                    <PlayCircle className="w-4 h-4 mr-2" />
                    Activate
                  </>
                )}
              </Button>
            </div>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-3 gap-6">
              <div className="text-center p-4 bg-slate-50 dark:bg-slate-800 rounded-lg">
                <div className="text-3xl font-bold text-blue-600 dark:text-blue-400 mb-1">
                  {continuousMode.enabled ? 'ON' : 'OFF'}
                </div>
                <div className="text-xs text-slate-600 dark:text-slate-400">Status</div>
              </div>
              <div className="text-center p-4 bg-slate-50 dark:bg-slate-800 rounded-lg">
                <div className="text-3xl font-bold text-violet-600 dark:text-violet-400 mb-1">
                  {continuousMode.tasksScheduled}
                </div>
                <div className="text-xs text-slate-600 dark:text-slate-400">Tasks Scheduled</div>
              </div>
              <div className="text-center p-4 bg-slate-50 dark:bg-slate-800 rounded-lg">
                <div className="text-3xl font-bold text-emerald-600 dark:text-emerald-400 mb-1">
                  {continuousMode.nextRun ? new Date(continuousMode.nextRun).toLocaleTimeString() : '--'}
                </div>
                <div className="text-xs text-slate-600 dark:text-slate-400">Next Run</div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/CompetitivePositioning.tsx
========================================
import { useLocation } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { 
  Target, 
  Zap, 
  Radio, 
  Clock, 
  BookOpen, 
  Brain, 
  ArrowRight,
  CheckCircle,
  XCircle,
  Minus,
  TrendingUp,
  Shield,
  Users,
  BarChart3,
  Layers,
  AlertTriangle,
  Play,
  Bell,
  Settings,
  MessageSquare,
  Building2,
  HelpCircle
} from 'lucide-react';
import { useEffect } from 'react';
import { updatePageMetadata } from '@/lib/seo';

const crisisNotificationTools = [
  {
    name: 'Everbridge',
    category: 'Crisis Notification',
    marketPosition: 'Market leader in mass notification',
    focus: 'Emergency alerts, mass notification, critical event management',
    strengths: ['Global reach', 'Mass notification', 'Multi-channel alerts', 'Compliance certified'],
    gaps: ['Alert only - no execution', 'No playbook library', 'No task orchestration', 'No institutional learning'],
    color: 'bg-red-500',
    whenTheyWin: 'Pure notification requirements, government/public sector mandates',
    trapQuestion: '"How do you turn an alert into coordinated action across 6 departments in under an hour?"'
  },
  {
    name: 'OnSolve',
    category: 'Crisis Notification',
    marketPosition: 'Risk intelligence + notification',
    focus: 'AI-powered risk intelligence, mass notification, travel risk',
    strengths: ['Risk intelligence', 'Travel tracking', 'Quick deployment', 'Location-based alerts'],
    gaps: ['Detection without execution', 'No pre-built responses', 'No cross-functional coordination', 'No decision support'],
    color: 'bg-orange-500',
    whenTheyWin: 'Risk monitoring focus, travel-heavy organizations',
    trapQuestion: '"After OnSolve detects a risk, how long does it take your teams to mobilize a coordinated response?"'
  },
  {
    name: 'Noggin',
    category: 'Crisis Management',
    marketPosition: 'Integrated resilience workspace',
    focus: 'Crisis management, business continuity, incident management',
    strengths: ['Incident management', 'Plan repository', 'Exercise management', 'Resilience focus'],
    gaps: ['Manual coordination', 'No signal monitoring', 'Slow activation', 'No AI recommendations'],
    color: 'bg-purple-500',
    whenTheyWin: 'BC/DR focused requirements, manual plan management',
    trapQuestion: '"How quickly can you activate a response and have all stakeholders aligned with assigned tasks?"'
  }
];

const projectManagementTools = [
  {
    name: 'Jira',
    category: 'Project Management',
    marketPosition: 'Dev team work management',
    focus: 'Agile project management, issue tracking, dev workflows',
    strengths: ['Developer adoption', 'Workflow flexibility', 'Integrations', 'Reporting'],
    gaps: ['No strategic playbooks', 'No signal detection', 'Manual project setup', 'No pre-approved resources'],
    color: 'bg-blue-500',
    whenTheyWin: 'Engineering-first organizations, existing heavy Jira adoption',
    trapQuestion: '"When a strategic event hits, how long does it take to create the project, assign owners, and get everyone aligned?"'
  },
  {
    name: 'Asana',
    category: 'Work Management',
    marketPosition: 'Team collaboration platform',
    focus: 'Task management, team collaboration, project tracking',
    strengths: ['User-friendly', 'Cross-functional visibility', 'Templates', 'Timeline views'],
    gaps: ['No external intelligence', 'No crisis readiness', 'No auto-orchestration', 'No institutional memory'],
    color: 'bg-pink-500',
    whenTheyWin: 'Marketing/ops teams, simple project needs',
    trapQuestion: '"Does Asana tell you when to act, or just help you track work you\'ve already decided to do?"'
  },
  {
    name: 'Monday.com',
    category: 'Work OS',
    marketPosition: 'Visual work management',
    focus: 'Team collaboration, project management, workflow automation',
    strengths: ['Visual interface', 'Customizable', 'Automations', 'Integrations'],
    gaps: ['Task-level focus', 'No signal monitoring', 'No coordinated response', 'No strategic execution'],
    color: 'bg-yellow-500',
    whenTheyWin: 'Visual-first teams, simple automation needs',
    trapQuestion: '"Can Monday.com automatically create a project with 50 tasks, assign 6 departments, and unlock budget when a competitor announces M&A?"'
  },
  {
    name: 'ServiceNow',
    category: 'Enterprise Workflow',
    marketPosition: 'Enterprise service management',
    focus: 'IT service management, workflow automation, enterprise ops',
    strengths: ['Enterprise scale', 'ITSM strength', 'Process automation', 'Compliance'],
    gaps: ['IT-centric', 'No external signals', 'No strategic playbooks', 'Reactive not proactive'],
    color: 'bg-green-500',
    whenTheyWin: 'IT-led initiatives, ITSM expansion plays',
    trapQuestion: '"ServiceNow is great for IT incidents. But when a regulatory change hits, can it coordinate Legal, Compliance, Comms, and Ops in 12 minutes?"'
  }
];

const categoryComparison = [
  { capability: 'Detects strategic triggers proactively', crisisTools: 'partial', pmTools: false, m: true },
  { capability: 'Pre-built playbooks with assigned tasks', crisisTools: false, pmTools: false, m: true },
  { capability: 'Auto-creates project on activation', crisisTools: false, pmTools: false, m: true },
  { capability: 'Assigns tasks to specific owners', crisisTools: false, pmTools: 'manual', m: true },
  { capability: 'Stages required documents', crisisTools: false, pmTools: 'manual', m: true },
  { capability: 'Unlocks pre-approved budgets', crisisTools: false, pmTools: false, m: true },
  { capability: 'Syncs to existing PM tools (Jira, etc.)', crisisTools: false, pmTools: 'native', m: true },
  { capability: '12-minute coordinated response', crisisTools: false, pmTools: false, m: true },
  { capability: 'AI-powered recommendations', crisisTools: 'partial', pmTools: false, m: true },
  { capability: 'Institutional learning loop', crisisTools: false, pmTools: false, m: true },
];

const objections = [
  {
    objection: '"We already have Everbridge for crisis management."',
    response: 'Everbridge excels at notificationtelling people something happened. M picks up where Everbridge stops: the 20-50 hours of coordination after the alert goes out. M can actually receive Everbridge alerts as triggers, then auto-orchestrate your response.',
    category: 'Crisis Tools'
  },
  {
    objection: '"We use Jira/Asana for all our project management."',
    response: 'PerfectM syncs directly to Jira and Asana. When M activates a playbook, it creates the project in your existing PM tool with all tasks assigned. Your teams work where they\'re comfortable; M just eliminates the 20-50 hours of setup.',
    category: 'PM Tools'
  },
  {
    objection: '"This sounds like another tool to adopt."',
    response: 'M is the oppositeit reduces tools. Teams don\'t learn M; M comes to them via the tools they already use (Slack, Teams, Jira, email). The playbook library and signal monitoring are invisible to end users.',
    category: 'Adoption'
  },
  {
    objection: '"We have crisis playbooks in SharePoint."',
    response: 'Static playbooks become stale and require manual activation. When did you last update them? Who activates them? M turns static documents into living, self-improving execution engines that activate automatically.',
    category: 'Process'
  },
  {
    objection: '"Our teams can coordinate in 72 hours."',
    response: 'What\'s the cost of those 72 hours? For a cyber breach, every hour is $150K+ in damages. For M&A response, competitors who react in 12 minutes gain insurmountable advantages. M captures the value of speed.',
    category: 'Urgency'
  },
  {
    objection: '"How is this different from AI agents?"',
    response: 'AI agents introduce unpredictabilityyou don\'t know what they\'ll do. M provides deterministic execution: pre-defined playbooks where AI recommends and humans decide. You get speed without surprises.',
    category: 'Technology'
  }
];

const strategicDomains = [
  { name: 'Market Dynamics', count: 24, icon: TrendingUp },
  { name: 'Competitive Intelligence', count: 18, icon: Target },
  { name: 'Crisis Management', count: 22, icon: AlertTriangle },
  { name: 'M&A Integration', count: 16, icon: Layers },
  { name: 'Supply Chain', count: 20, icon: BarChart3 },
  { name: 'Regulatory Response', count: 18, icon: Shield },
  { name: 'Talent & Culture', count: 14, icon: Users },
  { name: 'Technology Disruption', count: 16, icon: Zap },
  { name: 'AI Governance', count: 18, icon: Brain },
];

export default function CompetitivePositioning() {
  const [, setLocation] = useLocation();

  useEffect(() => {
    updatePageMetadata({
      title: "Competitive Positioning - M | Strategic Execution OS",
      description: "See how M creates a new category between crisis notification tools (Everbridge, OnSolve) and project management (Jira, Asana). The execution layer Fortune 1000 companies need.",
      ogTitle: "M vs. Crisis Tools vs. PM Tools | Category of One",
      ogDescription: "M isn't competing with Everbridge or Jira. M owns the strategic execution layer between them.",
    });
  }, []);

  return (
    <PageLayout>
      <div className="bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-blue-950">
        
        {/* Hero Section */}
        <section className="py-16 px-6 bg-gradient-to-br from-slate-900 via-slate-800 to-blue-900">
          <div className="max-w-6xl mx-auto text-center">
            <Badge className="mb-6 bg-blue-600/20 text-blue-300 border-blue-500/30" data-testid="badge-market-position">
              Market Position
            </Badge>
            <h1 className="text-4xl md:text-5xl font-bold text-white mb-6" data-testid="heading-competitive-positioning">
              The Strategic Execution Layer
              <span className="block text-blue-400 mt-2">Category of One</span>
            </h1>
            <p className="text-xl text-slate-300 max-w-3xl mx-auto mb-8">
              Crisis tools notify. PM tools track. M executes. We're not competing with Everbridge or Jirawe own the 
              <span className="text-blue-300 font-semibold"> 20-50 hours of coordination </span> 
              that happens between alert and action.
            </p>
            
            {/* Three Category Visual */}
            <div className="flex flex-wrap justify-center gap-4 mb-8">
              <div className="bg-red-500/20 border border-red-500/40 rounded-lg px-6 py-3">
                <Bell className="w-5 h-5 text-red-400 inline mr-2" />
                <span className="text-red-300 font-medium">Crisis Notification</span>
                <div className="text-xs text-red-400/70 mt-1">Everbridge, OnSolve, Noggin</div>
              </div>
              <div className="bg-blue-500/30 border-2 border-blue-400 rounded-lg px-6 py-3 ring-2 ring-blue-400/50">
                <Zap className="w-5 h-5 text-blue-300 inline mr-2" />
                <span className="text-blue-200 font-bold">Strategic Execution</span>
                <div className="text-xs text-blue-300 mt-1">M (Category of One)</div>
              </div>
              <div className="bg-green-500/20 border border-green-500/40 rounded-lg px-6 py-3">
                <Settings className="w-5 h-5 text-green-400 inline mr-2" />
                <span className="text-green-300 font-medium">Project Management</span>
                <div className="text-xs text-green-400/70 mt-1">Jira, Asana, Monday, ServiceNow</div>
              </div>
            </div>

            <div className="flex flex-wrap justify-center gap-4">
              <Button 
                size="lg" 
                className="bg-blue-600 hover:bg-blue-700"
                onClick={() => setLocation('/demo/live-activation')}
                data-testid="button-see-demo"
              >
                <Play className="w-5 h-5 mr-2" />
                See 12-Minute Activation
              </Button>
              <Button 
                size="lg" 
                variant="outline" 
                className="border-white/30 text-white hover:bg-white/10"
                onClick={() => setLocation('/pilot-program')}
                data-testid="button-pilot-program"
              >
                Start Pilot Program
              </Button>
            </div>
          </div>
        </section>

        {/* The Gap We Fill */}
        <section className="py-16 px-6">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-gap">
                The $2M Gap Between Alert and Action
              </h2>
              <p className="text-lg text-slate-600 dark:text-slate-400 max-w-3xl mx-auto">
                When a strategic event hits, organizations spend 20-50 hours getting organized. 
                That's $60K-$2M in lost value per major event. M eliminates that gap entirely.
              </p>
            </div>

            {/* Visual Timeline */}
            <Card className="mb-12 overflow-hidden" data-testid="card-timeline">
              <CardContent className="p-8">
                <div className="flex flex-col md:flex-row items-center justify-between gap-8">
                  {/* Without M */}
                  <div className="flex-1 text-center">
                    <div className="text-red-500 font-bold text-lg mb-2">Without M</div>
                    <div className="flex items-center justify-center gap-2 flex-wrap">
                      <div className="bg-red-100 dark:bg-red-900/30 rounded-lg p-3 text-center">
                        <div className="text-xs text-red-600 dark:text-red-400">Alert</div>
                        <div className="font-bold text-red-700 dark:text-red-300">T+0</div>
                      </div>
                      <ArrowRight className="w-4 h-4 text-slate-400" />
                      <div className="bg-amber-100 dark:bg-amber-900/30 rounded-lg p-3 text-center">
                        <div className="text-xs text-amber-600 dark:text-amber-400">Triage</div>
                        <div className="font-bold text-amber-700 dark:text-amber-300">+4-8 hrs</div>
                      </div>
                      <ArrowRight className="w-4 h-4 text-slate-400" />
                      <div className="bg-amber-100 dark:bg-amber-900/30 rounded-lg p-3 text-center">
                        <div className="text-xs text-amber-600 dark:text-amber-400">Planning</div>
                        <div className="font-bold text-amber-700 dark:text-amber-300">+12-24 hrs</div>
                      </div>
                      <ArrowRight className="w-4 h-4 text-slate-400" />
                      <div className="bg-amber-100 dark:bg-amber-900/30 rounded-lg p-3 text-center">
                        <div className="text-xs text-amber-600 dark:text-amber-400">Coordination</div>
                        <div className="font-bold text-amber-700 dark:text-amber-300">+24-48 hrs</div>
                      </div>
                      <ArrowRight className="w-4 h-4 text-slate-400" />
                      <div className="bg-slate-100 dark:bg-slate-800 rounded-lg p-3 text-center">
                        <div className="text-xs text-slate-600 dark:text-slate-400">Execution</div>
                        <div className="font-bold text-slate-700 dark:text-slate-300">+72 hrs</div>
                      </div>
                    </div>
                  </div>

                  {/* Divider */}
                  <div className="hidden md:block w-px h-24 bg-slate-300 dark:bg-slate-700"></div>
                  <div className="md:hidden h-px w-full bg-slate-300 dark:bg-slate-700"></div>

                  {/* With M */}
                  <div className="flex-1 text-center">
                    <div className="text-emerald-500 font-bold text-lg mb-2">With M</div>
                    <div className="flex items-center justify-center gap-2 flex-wrap">
                      <div className="bg-emerald-100 dark:bg-emerald-900/30 rounded-lg p-3 text-center">
                        <div className="text-xs text-emerald-600 dark:text-emerald-400">Trigger Detected</div>
                        <div className="font-bold text-emerald-700 dark:text-emerald-300">T+0</div>
                      </div>
                      <ArrowRight className="w-4 h-4 text-emerald-400" />
                      <div className="bg-emerald-100 dark:bg-emerald-900/30 rounded-lg p-3 text-center">
                        <div className="text-xs text-emerald-600 dark:text-emerald-400">Playbook Activated</div>
                        <div className="font-bold text-emerald-700 dark:text-emerald-300">+30 sec</div>
                      </div>
                      <ArrowRight className="w-4 h-4 text-emerald-400" />
                      <div className="bg-emerald-100 dark:bg-emerald-900/30 rounded-lg p-3 text-center">
                        <div className="text-xs text-emerald-600 dark:text-emerald-400">All Teams Aligned</div>
                        <div className="font-bold text-emerald-700 dark:text-emerald-300">+12 min</div>
                      </div>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </section>

        {/* Battle Cards by Category */}
        <section className="py-16 px-6 bg-slate-100 dark:bg-slate-900/50">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-battle-cards">
                Competitive Battle Cards
              </h2>
              <p className="text-lg text-slate-600 dark:text-slate-400">
                How M positions against each category of competitor
              </p>
            </div>

            <Tabs defaultValue="crisis" className="w-full">
              <TabsList className="grid w-full grid-cols-2 mb-8" data-testid="tabs-competitor-categories">
                <TabsTrigger value="crisis" className="flex items-center gap-2" data-testid="tab-crisis-tools">
                  <Bell className="w-4 h-4" />
                  Crisis Notification Tools
                </TabsTrigger>
                <TabsTrigger value="pm" className="flex items-center gap-2" data-testid="tab-pm-tools">
                  <Settings className="w-4 h-4" />
                  Project Management Tools
                </TabsTrigger>
              </TabsList>

              <TabsContent value="crisis">
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                  {crisisNotificationTools.map((tool) => (
                    <Card key={tool.name} className="border-t-4 hover:shadow-lg transition-shadow" style={{ borderTopColor: tool.color.replace('bg-', '').includes('red') ? '#ef4444' : tool.color.includes('orange') ? '#f97316' : '#a855f7' }} data-testid={`card-competitor-${tool.name.toLowerCase()}`}>
                      <CardHeader className="pb-3">
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <div className={`w-10 h-10 rounded-full ${tool.color} flex items-center justify-center`}>
                              <span className="text-white font-bold">{tool.name.charAt(0)}</span>
                            </div>
                            <div>
                              <CardTitle className="text-lg">{tool.name}</CardTitle>
                              <Badge variant="outline" className="text-xs">{tool.category}</Badge>
                            </div>
                          </div>
                        </div>
                        <CardDescription className="mt-2">{tool.marketPosition}</CardDescription>
                      </CardHeader>
                      <CardContent className="space-y-4">
                        <div>
                          <div className="text-xs font-semibold text-emerald-600 dark:text-emerald-400 mb-2">Their Strengths</div>
                          <ul className="space-y-1">
                            {tool.strengths.map((s, i) => (
                              <li key={i} className="text-xs text-slate-600 dark:text-slate-400 flex items-center gap-1">
                                <CheckCircle className="w-3 h-3 text-emerald-500 flex-shrink-0" /> {s}
                              </li>
                            ))}
                          </ul>
                        </div>
                        <div>
                          <div className="text-xs font-semibold text-blue-600 dark:text-blue-400 mb-2">Gaps M Fills</div>
                          <ul className="space-y-1">
                            {tool.gaps.map((g, i) => (
                              <li key={i} className="text-xs text-slate-600 dark:text-slate-400 flex items-center gap-1">
                                <Zap className="w-3 h-3 text-blue-500 flex-shrink-0" /> {g}
                              </li>
                            ))}
                          </ul>
                        </div>
                        <div className="pt-2 border-t border-slate-200 dark:border-slate-700">
                          <div className="text-xs font-semibold text-amber-600 dark:text-amber-400 mb-1">When They Win</div>
                          <p className="text-xs text-slate-500 dark:text-slate-500">{tool.whenTheyWin}</p>
                        </div>
                        <div className="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                          <div className="text-xs font-semibold text-blue-700 dark:text-blue-300 mb-1 flex items-center gap-1">
                            <MessageSquare className="w-3 h-3" /> Trap Question
                          </div>
                          <p className="text-xs text-blue-600 dark:text-blue-400 italic">{tool.trapQuestion}</p>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                </div>
              </TabsContent>

              <TabsContent value="pm">
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {projectManagementTools.map((tool) => (
                    <Card key={tool.name} className="border-t-4 hover:shadow-lg transition-shadow" style={{ borderTopColor: tool.color.includes('blue') ? '#3b82f6' : tool.color.includes('pink') ? '#ec4899' : tool.color.includes('yellow') ? '#eab308' : '#22c55e' }} data-testid={`card-competitor-${tool.name.toLowerCase().replace(/\./g, '')}`}>
                      <CardHeader className="pb-3">
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <div className={`w-10 h-10 rounded-full ${tool.color} flex items-center justify-center`}>
                              <span className="text-white font-bold">{tool.name.charAt(0)}</span>
                            </div>
                            <div>
                              <CardTitle className="text-lg">{tool.name}</CardTitle>
                              <Badge variant="outline" className="text-xs">{tool.category}</Badge>
                            </div>
                          </div>
                        </div>
                        <CardDescription className="mt-2">{tool.marketPosition}</CardDescription>
                      </CardHeader>
                      <CardContent className="space-y-4">
                        <div className="grid grid-cols-2 gap-4">
                          <div>
                            <div className="text-xs font-semibold text-emerald-600 dark:text-emerald-400 mb-2">Their Strengths</div>
                            <ul className="space-y-1">
                              {tool.strengths.map((s, i) => (
                                <li key={i} className="text-xs text-slate-600 dark:text-slate-400 flex items-center gap-1">
                                  <CheckCircle className="w-3 h-3 text-emerald-500 flex-shrink-0" /> {s}
                                </li>
                              ))}
                            </ul>
                          </div>
                          <div>
                            <div className="text-xs font-semibold text-blue-600 dark:text-blue-400 mb-2">Gaps M Fills</div>
                            <ul className="space-y-1">
                              {tool.gaps.map((g, i) => (
                                <li key={i} className="text-xs text-slate-600 dark:text-slate-400 flex items-center gap-1">
                                  <Zap className="w-3 h-3 text-blue-500 flex-shrink-0" /> {g}
                                </li>
                              ))}
                            </ul>
                          </div>
                        </div>
                        <div className="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                          <div className="text-xs font-semibold text-blue-700 dark:text-blue-300 mb-1 flex items-center gap-1">
                            <MessageSquare className="w-3 h-3" /> Trap Question
                          </div>
                          <p className="text-xs text-blue-600 dark:text-blue-400 italic">{tool.trapQuestion}</p>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                </div>
              </TabsContent>
            </Tabs>
          </div>
        </section>

        {/* Category Comparison Matrix */}
        <section className="py-16 px-6">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-category-comparison">
                Three Categories, One Gap
              </h2>
              <p className="text-lg text-slate-600 dark:text-slate-400">
                M is the only platform that bridges detection and execution
              </p>
            </div>

            <Card data-testid="card-comparison-matrix">
              <CardContent className="p-0 overflow-x-auto">
                <table className="w-full min-w-[600px]">
                  <thead>
                    <tr className="border-b bg-slate-50 dark:bg-slate-800/50">
                      <th className="text-left p-4 font-semibold text-slate-900 dark:text-white">Capability</th>
                      <th className="text-center p-4">
                        <div className="flex flex-col items-center">
                          <Bell className="w-5 h-5 text-red-500 mb-1" />
                          <span className="text-xs font-semibold text-slate-600 dark:text-slate-400">Crisis Tools</span>
                        </div>
                      </th>
                      <th className="text-center p-4">
                        <div className="flex flex-col items-center">
                          <Settings className="w-5 h-5 text-green-500 mb-1" />
                          <span className="text-xs font-semibold text-slate-600 dark:text-slate-400">PM Tools</span>
                        </div>
                      </th>
                      <th className="text-center p-4 bg-blue-50 dark:bg-blue-900/20">
                        <div className="flex flex-col items-center">
                          <div className="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mb-1">
                            <span className="text-white font-bold text-sm">M</span>
                          </div>
                          <span className="text-xs font-bold text-blue-600 dark:text-blue-400">M</span>
                        </div>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    {categoryComparison.map((row, i) => (
                      <tr key={i} className="border-b last:border-0 hover:bg-slate-50 dark:hover:bg-slate-800/30">
                        <td className="p-4 text-sm text-slate-700 dark:text-slate-300">{row.capability}</td>
                        <td className="p-4 text-center">
                          {row.crisisTools === true && <CheckCircle className="w-5 h-5 text-emerald-500 mx-auto" />}
                          {row.crisisTools === false && <XCircle className="w-5 h-5 text-slate-300 dark:text-slate-600 mx-auto" />}
                          {row.crisisTools === 'partial' && <Minus className="w-5 h-5 text-amber-500 mx-auto" />}
                          {row.crisisTools === 'manual' && <span className="text-xs text-slate-500">Manual</span>}
                          {row.crisisTools === 'native' && <span className="text-xs text-slate-500">N/A</span>}
                        </td>
                        <td className="p-4 text-center">
                          {row.pmTools === true && <CheckCircle className="w-5 h-5 text-emerald-500 mx-auto" />}
                          {row.pmTools === false && <XCircle className="w-5 h-5 text-slate-300 dark:text-slate-600 mx-auto" />}
                          {row.pmTools === 'partial' && <Minus className="w-5 h-5 text-amber-500 mx-auto" />}
                          {row.pmTools === 'manual' && <span className="text-xs text-slate-500">Manual</span>}
                          {row.pmTools === 'native' && <span className="text-xs text-slate-500">N/A</span>}
                        </td>
                        <td className="p-4 text-center bg-blue-50/50 dark:bg-blue-900/10">
                          {row.m === true && <CheckCircle className="w-5 h-5 text-blue-500 mx-auto" />}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </CardContent>
            </Card>
          </div>
        </section>

        {/* Objection Handling */}
        <section className="py-16 px-6 bg-slate-100 dark:bg-slate-900/50">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-objections">
                Objection Handling Guide
              </h2>
              <p className="text-lg text-slate-600 dark:text-slate-400">
                Common pushback and how to address it
              </p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {objections.map((obj, i) => (
                <Card key={i} className="hover:shadow-lg transition-shadow" data-testid={`card-objection-${i}`}>
                  <CardHeader className="pb-2">
                    <div className="flex items-start gap-3">
                      <div className="p-2 rounded-lg bg-red-100 dark:bg-red-900/30">
                        <HelpCircle className="w-5 h-5 text-red-500" />
                      </div>
                      <div>
                        <Badge variant="outline" className="mb-2 text-xs">{obj.category}</Badge>
                        <CardTitle className="text-base text-red-700 dark:text-red-400">{obj.objection}</CardTitle>
                      </div>
                    </div>
                  </CardHeader>
                  <CardContent>
                    <div className="flex items-start gap-3">
                      <div className="p-2 rounded-lg bg-emerald-100 dark:bg-emerald-900/30">
                        <MessageSquare className="w-5 h-5 text-emerald-500" />
                      </div>
                      <p className="text-sm text-slate-600 dark:text-slate-400">{obj.response}</p>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </div>
        </section>

        {/* Strategic Domains */}
        <section className="py-16 px-6 bg-gradient-to-br from-blue-900 to-purple-900">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl font-bold text-white mb-4" data-testid="heading-domains">
                166 Playbooks Across 9 Strategic Domains
              </h2>
              <p className="text-lg text-blue-200">
                No competitor offers pre-built, executable strategic playbooks
              </p>
            </div>

            <div className="grid grid-cols-3 md:grid-cols-5 gap-4">
              {strategicDomains.map((domain) => (
                <div 
                  key={domain.name} 
                  className="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center hover:bg-white/20 transition-colors cursor-pointer"
                  onClick={() => setLocation('/playbook-library')}
                  data-testid={`card-domain-${domain.name.toLowerCase().replace(/\s+/g, '-')}`}
                >
                  <domain.icon className="w-6 h-6 text-blue-300 mx-auto mb-2" />
                  <div className="text-xl font-bold text-white mb-1">{domain.count}</div>
                  <div className="text-xs text-blue-200">{domain.name}</div>
                </div>
              ))}
            </div>

            <div className="text-center mt-12">
              <Button 
                size="lg" 
                className="bg-white text-blue-900 hover:bg-blue-50"
                onClick={() => setLocation('/playbook-library')}
                data-testid="button-browse-playbooks"
              >
                Browse All 166 Playbooks
                <ArrowRight className="w-5 h-5 ml-2" />
              </Button>
            </div>
          </div>
        </section>

        {/* The Moat */}
        <section className="py-16 px-6">
          <div className="max-w-4xl mx-auto">
            <Card className="bg-gradient-to-br from-slate-900 to-blue-900 text-white border-0" data-testid="card-moat">
              <CardContent className="p-8">
                <div className="flex items-start gap-4">
                  <div className="p-3 rounded-xl bg-white/10">
                    <Building2 className="w-8 h-8 text-blue-300" />
                  </div>
                  <div>
                    <h3 className="text-2xl font-bold mb-4">The Enterprise Moat</h3>
                    <p className="text-blue-200 mb-6">
                      Once a Fortune 1000 company has 50+ playbooks syncing to Jira with bi-directional updates, 
                      historical execution data, and months of organizational knowledge encoded in Mswitching 
                      becomes nearly impossible.
                    </p>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      <div className="text-center">
                        <div className="text-2xl font-bold text-blue-300">50+</div>
                        <div className="text-xs text-blue-400">Active Playbooks</div>
                      </div>
                      <div className="text-center">
                        <div className="text-2xl font-bold text-blue-300">2-way</div>
                        <div className="text-xs text-blue-400">Jira Sync</div>
                      </div>
                      <div className="text-center">
                        <div className="text-2xl font-bold text-blue-300">12mo</div>
                        <div className="text-xs text-blue-400">Execution History</div>
                      </div>
                      <div className="text-center">
                        <div className="text-2xl font-bold text-blue-300">100%</div>
                        <div className="text-xs text-blue-400">Institutional Memory</div>
                      </div>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </section>

        {/* CTA Section */}
        <section className="py-16 px-6 bg-slate-100 dark:bg-slate-900/50">
          <div className="max-w-4xl mx-auto text-center">
            <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-cta">
              Ready to Own Strategic Execution?
            </h2>
            <p className="text-lg text-slate-600 dark:text-slate-400 mb-8">
              See how M eliminates the 20-50 hours between alert and action
            </p>
            <div className="flex flex-wrap justify-center gap-4">
              <Button 
                size="lg" 
                className="bg-blue-600 hover:bg-blue-700"
                onClick={() => setLocation('/demo/live-activation')}
                data-testid="button-cta-demo"
              >
                <Play className="w-5 h-5 mr-2" />
                Watch 12-Minute Demo
              </Button>
              <Button 
                size="lg" 
                variant="outline"
                onClick={() => setLocation('/pilot-program')}
                data-testid="button-cta-pilot"
              >
                Start 90-Day Pilot
                <ArrowRight className="w-5 h-5 ml-2" />
              </Button>
            </div>
          </div>
        </section>

      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/ComprehensiveAIIntelligence.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Alert, AlertDescription } from '@/components/ui/alert';
import PageLayout from '@/components/layout/PageLayout';
import { Link } from 'wouter';
import { 
  Brain, 
  Activity, 
  TrendingUp, 
  Users, 
  Lightbulb, 
  Layers,
  Zap, 
  BarChart3, 
  Target, 
  Globe,
  Clock,
  CheckCircle,
  AlertTriangle,
  Eye,
  Cpu,
  Network,
  Settings,
  Play,
  Pause,
  RefreshCw,
  Download,
  Share,
  Filter
} from 'lucide-react';

interface AIModule {
  id: string;
  name: string;
  icon: JSX.Element;
  status: 'operational' | 'processing' | 'offline';
  performance: number;
  lastUpdate: string;
  description: string;
  capabilities: string[];
  metrics: {
    accuracy: number;
    processingTime: string;
    dataPoints: number;
    confidence: number;
  };
  insights: any[];
}

interface IntelligenceReport {
  id: string;
  title: string;
  module: string;
  timestamp: string;
  priority: 'low' | 'medium' | 'high' | 'critical';
  status: 'generated' | 'reviewed' | 'actioned';
  summary: string;
  keyFindings: string[];
  recommendations: string[];
  confidence: number;
}

export default function ComprehensiveAIIntelligence() {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [aiModules, setAIModules] = useState<AIModule[]>([]);
  const [intelligenceReports, setIntelligenceReports] = useState<IntelligenceReport[]>([]);
  const [systemMetrics, setSystemMetrics] = useState({
    totalProcessingPower: 94.7,
    activeModules: 5,
    dailyInsights: 127,
    accuracyRate: 96.2,
    systemHealth: 98.5
  });
  const [isGenerating, setIsGenerating] = useState(false);

  useEffect(() => {
    // Initialize AI modules with live data
    const initializeModules = async () => {
      try {
        // Fetch live data from AI modules
        const pulseResponse = await fetch('/api/pulse/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ organizationId: 'ec61b8f6-7d87-41fd-9969-cb990ed0b10b' })
        });
        const pulseData = await pulseResponse.json();

        const novaResponse = await fetch('/api/nova/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ organizationId: 'ec61b8f6-7d87-41fd-9969-cb990ed0b10b' })
        });
        const novaData = await novaResponse.json();

        const prismResponse = await fetch('/api/prism/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ organizationId: 'ec61b8f6-7d87-41fd-9969-cb990ed0b10b' })
        });
        const prismData = await prismResponse.json();

        const modules: AIModule[] = [
          {
            id: 'pulse',
            name: 'Pulse Intelligence',
            icon: <Activity className="h-6 w-6" />,
            status: 'operational',
            performance: 97,
            lastUpdate: 'Live',
            description: 'Real-time organizational health and performance monitoring with predictive analytics',
            capabilities: ['Performance Tracking', 'Health Monitoring', 'Predictive Analytics', 'Benchmarking'],
            metrics: {
              accuracy: 96.4,
              processingTime: '< 2 seconds',
              dataPoints: pulseData.success ? pulseData.count * 1000 : 5000,
              confidence: 94.7
            },
            insights: pulseData.success ? pulseData.metrics : []
          },
          {
            id: 'flux',
            name: 'Flux Adaptations',
            icon: <TrendingUp className="h-6 w-6" />,
            status: 'operational',
            performance: 94,
            lastUpdate: '3 min ago',
            description: 'Dynamic adaptation strategies and change management intelligence with scenario modeling',
            capabilities: ['Change Management', 'Adaptation Strategies', 'Risk Assessment', 'Scenario Planning'],
            metrics: {
              accuracy: 93.8,
              processingTime: '< 5 seconds',
              dataPoints: 12400,
              confidence: 91.2
            },
            insights: []
          },
          {
            id: 'prism',
            name: 'Prism Insights',
            icon: <Layers className="h-6 w-6" />,
            status: 'operational',
            performance: 96,
            lastUpdate: '1 min ago',
            description: 'Multi-dimensional strategic analysis and decision support with market intelligence',
            capabilities: ['Strategic Analysis', 'Market Intelligence', 'Decision Support', 'Competitive Analysis'],
            metrics: {
              accuracy: 95.1,
              processingTime: '< 3 seconds',
              dataPoints: prismData.success ? prismData.count * 2000 : 10000,
              confidence: 93.5
            },
            insights: prismData.success ? prismData.insights : []
          },
          {
            id: 'echo',
            name: 'Echo Cultural Analytics',
            icon: <Users className="h-6 w-6" />,
            status: 'operational',
            performance: 91,
            lastUpdate: '5 min ago',
            description: 'Cultural intelligence and organizational dynamics assessment with sentiment analysis',
            capabilities: ['Cultural Analysis', 'Sentiment Tracking', 'Team Dynamics', 'Engagement Metrics'],
            metrics: {
              accuracy: 89.7,
              processingTime: '< 4 seconds',
              dataPoints: 8750,
              confidence: 87.3
            },
            insights: []
          },
          {
            id: 'nova',
            name: 'Nova Innovations',
            icon: <Lightbulb className="h-6 w-6" />,
            status: 'operational',
            performance: 95,
            lastUpdate: 'Live',
            description: 'Innovation pipeline and breakthrough opportunity identification with trend forecasting',
            capabilities: ['Innovation Tracking', 'Opportunity Identification', 'Trend Forecasting', 'R&D Analytics'],
            metrics: {
              accuracy: 94.6,
              processingTime: '< 3 seconds',
              dataPoints: novaData.success ? novaData.count * 1500 : 7500,
              confidence: 92.8
            },
            insights: novaData.success ? novaData.opportunities : []
          }
        ];

        setAIModules(modules);

        // Generate intelligence reports
        const reports: IntelligenceReport[] = [
          {
            id: 'report-001',
            title: 'Organizational Agility Assessment',
            module: 'Pulse Intelligence',
            timestamp: new Date().toISOString(),
            priority: 'high',
            status: 'generated',
            summary: 'Comprehensive analysis shows 8.7/10 agility score with strong team velocity and strategic alignment.',
            keyFindings: [
              'Team velocity increased 12% over last quarter',
              'Strategic alignment shows 95% consistency across departments',
              'Cultural health metrics indicate high employee satisfaction',
              'Innovation capacity trending upward with 23% improvement'
            ],
            recommendations: [
              'Maintain current agility practices while scaling to new teams',
              'Invest in advanced training for emerging technologies',
              'Strengthen cross-departmental collaboration frameworks'
            ],
            confidence: 96.4
          },
          {
            id: 'report-002',
            title: 'Market Positioning Intelligence',
            module: 'Prism Insights',
            timestamp: new Date(Date.now() - 1800000).toISOString(),
            priority: 'critical',
            status: 'reviewed',
            summary: 'Strategic market analysis reveals significant expansion opportunities and competitive advantages.',
            keyFindings: [
              'Market gap identified worth $2.3M annual revenue potential',
              'Competitive positioning shows 15-month advantage window',
              'Customer acquisition patterns indicate strong product-market fit',
              'Brand strength metrics exceed industry benchmarks by 34%'
            ],
            recommendations: [
              'Accelerate product development for identified market gap',
              'Implement targeted customer acquisition strategy',
              'Leverage brand strength for premium positioning'
            ],
            confidence: 87.2
          },
          {
            id: 'report-003',
            title: 'Innovation Pipeline Analysis',
            module: 'Nova Innovations',
            timestamp: new Date(Date.now() - 3600000).toISOString(),
            priority: 'medium',
            status: 'actioned',
            summary: 'Innovation assessment shows strong pipeline with breakthrough potential in AI-powered solutions.',
            keyFindings: [
              'AI-powered customer intelligence platform shows breakthrough potential',
              'Sustainability framework development ahead of schedule',
              'Remote collaboration ecosystem testing exceeds expectations',
              'Predictive maintenance implementation showing 40% efficiency gains'
            ],
            recommendations: [
              'Prioritize AI platform development with $750K budget allocation',
              'Fast-track sustainability framework to market leadership position',
              'Scale successful predictive maintenance across all operations'
            ],
            confidence: 92.1
          }
        ];

        setIntelligenceReports(reports);

      } catch (error) {
        console.error('Error initializing AI modules:', error);
      }
    };

    initializeModules();

    // Real-time updates every 30 seconds
    const interval = setInterval(() => {
      setSystemMetrics(prev => ({
        ...prev,
        totalProcessingPower: +(prev.totalProcessingPower + (Math.random() * 2 - 1)).toFixed(1),
        dailyInsights: prev.dailyInsights + Math.floor(Math.random() * 3),
        accuracyRate: +(prev.accuracyRate + (Math.random() * 0.5 - 0.25)).toFixed(1),
        systemHealth: +(prev.systemHealth + (Math.random() * 0.3 - 0.15)).toFixed(1)
      }));
    }, 30000);

    return () => clearInterval(interval);
  }, []);

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'operational': return 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30';
      case 'processing': return 'bg-amber-500/20 text-amber-300 border-amber-500/30';
      case 'offline': return 'bg-red-500/20 text-red-300 border-red-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'critical': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'high': return 'bg-orange-500/20 text-orange-300 border-orange-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30';
      case 'low': return 'bg-green-500/20 text-green-300 border-green-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const generateAllIntelligence = async () => {
    setIsGenerating(true);
    try {
      // Trigger all AI modules to generate fresh intelligence
      const modules = ['pulse', 'nova', 'prism', 'flux', 'echo'];
      const promises = modules.map(module => 
        fetch(`/api/${module}/generate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ organizationId: 'ec61b8f6-7d87-41fd-9969-cb990ed0b10b' })
        })
      );

      await Promise.all(promises);
      
      // Refresh the page data
      window.location.reload();
    } catch (error) {
      console.error('Error generating intelligence:', error);
    } finally {
      setIsGenerating(false);
    }
  };

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-y-auto p-8 space-y-8">
        
        {/* AI Intelligence Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-white mb-2">AI Intelligence Command Center</h1>
            <p className="text-slate-300">Comprehensive AI-powered organizational intelligence and strategic insights</p>
          </div>
          <div className="flex items-center gap-4">
            <Button 
              onClick={generateAllIntelligence}
              disabled={isGenerating}
              className="bg-blue-600 hover:bg-blue-700"
            >
              {isGenerating ? (
                <RefreshCw className="w-4 h-4 mr-2 animate-spin" />
              ) : (
                <Zap className="w-4 h-4 mr-2" />
              )}
              Generate Intelligence
            </Button>
            <Button variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
              <Download className="w-4 h-4 mr-2" />
              Export Reports
            </Button>
          </div>
        </div>

        {/* System Overview */}
        <div className="grid grid-cols-1 md:grid-cols-5 gap-6">
          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Processing Power</h3>
                <Cpu className="h-5 w-5 text-blue-400" />
              </div>
              <div className="text-2xl font-bold text-white">{systemMetrics.totalProcessingPower}%</div>
              <div className="text-sm text-slate-400">System utilization</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Active Modules</h3>
                <Brain className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{systemMetrics.activeModules}</div>
              <div className="text-sm text-slate-400">AI systems online</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Daily Insights</h3>
                <Eye className="h-5 w-5 text-purple-400" />
              </div>
              <div className="text-2xl font-bold text-white">{systemMetrics.dailyInsights}</div>
              <div className="text-sm text-slate-400">Generated today</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Accuracy Rate</h3>
                <Target className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{systemMetrics.accuracyRate}%</div>
              <div className="text-sm text-slate-400">Prediction accuracy</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">System Health</h3>
                <Activity className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{systemMetrics.systemHealth}%</div>
              <div className="text-sm text-slate-400">Overall health</div>
            </CardContent>
          </Card>
        </div>

        {/* Main Intelligence Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="bg-slate-800/50 border border-slate-700/50">
            <TabsTrigger value="dashboard" className="data-[state=active]:bg-slate-700">AI Dashboard</TabsTrigger>
            <TabsTrigger value="modules" className="data-[state=active]:bg-slate-700">AI Modules</TabsTrigger>
            <TabsTrigger value="reports" className="data-[state=active]:bg-slate-700">Intelligence Reports</TabsTrigger>
            <TabsTrigger value="insights" className="data-[state=active]:bg-slate-700">Live Insights</TabsTrigger>
            <TabsTrigger value="configuration" className="data-[state=active]:bg-slate-700">Configuration</TabsTrigger>
          </TabsList>

          {/* AI Dashboard */}
          <TabsContent value="dashboard" className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              {/* Module Status Overview */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Brain className="h-5 w-5" />
                    AI Module Status
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  {aiModules.map((module) => (
                    <div key={module.id} className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                      <div className="flex items-center gap-3">
                        <div className="p-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg">
                          {module.icon}
                        </div>
                        <div>
                          <div className="font-semibold text-white">{module.name}</div>
                          <div className="text-xs text-slate-400">Updated: {module.lastUpdate}</div>
                        </div>
                      </div>
                      <div className="flex items-center gap-3">
                        <div className="text-right">
                          <div className="text-sm font-medium text-white">{module.performance}%</div>
                          <Progress value={module.performance} className="w-16 h-2" />
                        </div>
                        <Badge className={getStatusColor(module.status)}>
                          {module.status.toUpperCase()}
                        </Badge>
                      </div>
                    </div>
                  ))}
                </CardContent>
              </Card>

              {/* Recent Intelligence Activity */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Clock className="h-5 w-5" />
                    Recent Intelligence Activity
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="space-y-3">
                    <div className="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
                      <div className="w-2 h-2 bg-emerald-400 rounded-full animate-pulse" />
                      <div className="flex-1 page-background">
                        <div className="text-sm text-white">Pulse Intelligence generated performance metrics</div>
                        <div className="text-xs text-slate-400">Real-time  Confidence: 96.4%</div>
                      </div>
                    </div>
                    <div className="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
                      <div className="w-2 h-2 bg-blue-400 rounded-full" />
                      <div className="flex-1 page-background">
                        <div className="text-sm text-white">Nova identified breakthrough innovation opportunity</div>
                        <div className="text-xs text-slate-400">2 min ago  Impact: $750K potential</div>
                      </div>
                    </div>
                    <div className="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
                      <div className="w-2 h-2 bg-purple-400 rounded-full" />
                      <div className="flex-1 page-background">
                        <div className="text-sm text-white">Prism completed strategic market analysis</div>
                        <div className="text-xs text-slate-400">5 min ago  Market opportunity: $2.3M</div>
                      </div>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* AI Modules */}
          <TabsContent value="modules" className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
              {aiModules.map((module) => (
                <Card key={module.id} className="bg-slate-900/50 border-slate-700/50 hover:bg-slate-800/50 transition-all duration-300">
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-white flex items-center gap-3">
                        <div className="p-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg">
                          {module.icon}
                        </div>
                        {module.name}
                      </CardTitle>
                      <Badge className={getStatusColor(module.status)}>
                        {module.status.toUpperCase()}
                      </Badge>
                    </div>
                    <p className="text-slate-400 text-sm">{module.description}</p>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    
                    {/* Performance Metrics */}
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <div className="text-slate-400">Performance</div>
                        <div className="text-white font-medium">{module.performance}%</div>
                      </div>
                      <div>
                        <div className="text-slate-400">Accuracy</div>
                        <div className="text-white font-medium">{module.metrics.accuracy}%</div>
                      </div>
                      <div>
                        <div className="text-slate-400">Processing</div>
                        <div className="text-white font-medium">{module.metrics.processingTime}</div>
                      </div>
                      <div>
                        <div className="text-slate-400">Confidence</div>
                        <div className="text-white font-medium">{module.metrics.confidence}%</div>
                      </div>
                    </div>

                    {/* Capabilities */}
                    <div>
                      <div className="text-sm font-semibold text-white mb-2">Capabilities</div>
                      <div className="flex flex-wrap gap-2">
                        {module.capabilities.map((capability, index) => (
                          <Badge key={index} variant="outline" className="border-slate-600 text-slate-300 text-xs">
                            {capability}
                          </Badge>
                        ))}
                      </div>
                    </div>

                    {/* Action Buttons */}
                    <div className="flex gap-2">
                      <Link to={`/${module.id}`} className="flex-1">
                        <Button size="sm" className="w-full bg-blue-600 hover:bg-blue-700">
                          <Eye className="w-4 h-4 mr-2" />
                          View Details
                        </Button>
                      </Link>
                      <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <Settings className="w-4 h-4" />
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Intelligence Reports */}
          <TabsContent value="reports" className="space-y-6">
            <div className="space-y-4">
              {intelligenceReports.map((report) => (
                <Card key={report.id} className="bg-slate-900/50 border-slate-700/50">
                  <CardContent className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex-1 page-background">
                        <div className="flex items-center gap-3 mb-2">
                          <h3 className="text-lg font-semibold text-white">{report.title}</h3>
                          <Badge className={getPriorityColor(report.priority)}>
                            {report.priority.toUpperCase()}
                          </Badge>
                          <Badge variant="outline" className="border-slate-600 text-slate-300">
                            {report.module}
                          </Badge>
                        </div>
                        <p className="text-slate-300 mb-4">{report.summary}</p>
                      </div>
                      <div className="text-right">
                        <div className="text-sm text-slate-400">Confidence</div>
                        <div className="text-xl font-bold text-white">{report.confidence}%</div>
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <div className="text-sm font-semibold text-white mb-2">Key Findings</div>
                        <div className="space-y-1">
                          {report.keyFindings.map((finding, index) => (
                            <div key={index} className="text-sm text-slate-300 flex items-start gap-2">
                              <CheckCircle className="w-4 h-4 text-emerald-400 mt-0.5 flex-shrink-0" />
                              {finding}
                            </div>
                          ))}
                        </div>
                      </div>
                      
                      <div>
                        <div className="text-sm font-semibold text-white mb-2">Recommendations</div>
                        <div className="space-y-1">
                          {report.recommendations.map((rec, index) => (
                            <div key={index} className="text-sm text-slate-300 flex items-start gap-2">
                              <Target className="w-4 h-4 text-blue-400 mt-0.5 flex-shrink-0" />
                              {rec}
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                    
                    <div className="mt-4 pt-4 border-t border-slate-700 flex items-center justify-between">
                      <div className="text-xs text-slate-500">
                        Generated: {new Date(report.timestamp).toLocaleString()}
                      </div>
                      <div className="flex gap-2">
                        <Button size="sm" className="bg-blue-600 hover:bg-blue-700">
                          <Eye className="w-4 h-4 mr-2" />
                          Full Report
                        </Button>
                        <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                          <Share className="w-4 h-4 mr-2" />
                          Share
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Live Insights */}
          <TabsContent value="insights" className="space-y-6">
            <Alert className="border-blue-500/30 bg-blue-500/10">
              <Brain className="h-4 w-4" />
              <AlertDescription className="text-blue-200">
                Live insights are generated in real-time from all AI modules. Refresh automatically every 30 seconds.
              </AlertDescription>
            </Alert>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {aiModules.filter(m => m.insights.length > 0).map((module) => (
                <Card key={module.id} className="bg-slate-900/50 border-slate-700/50">
                  <CardHeader>
                    <CardTitle className="text-white flex items-center gap-2">
                      {module.icon}
                      {module.name} Insights
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-center text-slate-400">
                      <Brain className="h-12 w-12 mx-auto mb-2" />
                      <p>Live insights streaming...</p>
                      <p className="text-xs">{module.insights.length} data points processed</p>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Configuration */}
          <TabsContent value="configuration" className="space-y-6">
            <Card className="bg-slate-900/50 border-slate-700/50">
              <CardHeader>
                <CardTitle className="text-white">AI System Configuration</CardTitle>
              </CardHeader>
              <CardContent className="space-y-6">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  <Button className="h-24 bg-blue-600 hover:bg-blue-700 flex-col gap-2">
                    <Brain className="w-8 h-8" />
                    Model Training
                  </Button>
                  <Button className="h-24 bg-emerald-600 hover:bg-emerald-700 flex-col gap-2">
                    <Network className="w-8 h-8" />
                    Data Sources
                  </Button>
                  <Button className="h-24 bg-purple-600 hover:bg-purple-700 flex-col gap-2">
                    <Settings className="w-8 h-8" />
                    System Settings
                  </Button>
                  <Button className="h-24 bg-amber-600 hover:bg-amber-700 flex-col gap-2">
                    <Filter className="w-8 h-8" />
                    Processing Rules
                  </Button>
                  <Button className="h-24 bg-pink-600 hover:bg-pink-700 flex-col gap-2">
                    <Target className="w-8 h-8" />
                    Performance Tuning
                  </Button>
                  <Button className="h-24 bg-indigo-600 hover:bg-indigo-700 flex-col gap-2">
                    <Globe className="w-8 h-8" />
                    Integration Hub
                  </Button>
                </div>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/ComprehensiveROIBreakdown.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useQuery } from "@tanstack/react-query";
import { 
  DollarSign, 
  TrendingUp, 
  Clock, 
  Shield,
  Target,
  Download,
  ArrowRight,
  CheckCircle2
} from "lucide-react";
import { scenarios } from "@shared/scenarios";

// Parse annual value from string to number (e.g., "$12M annual savings" -> 12)
function parseAnnualValue(valueString: string): number {
  const match = valueString.match(/\$(\d+(?:\.\d+)?)(M|K)?/);
  if (!match) return 0;
  const value = parseFloat(match[1]);
  const unit = match[2];
  if (unit === 'M') return value;
  if (unit === 'K') return value / 1000;
  return value / 1000000; // Assume dollars if no unit
}

// Calculate speed improvement in days
function parseSpeedAdvantage(speedString: string): number {
  // Extract patterns like "18 days faster" or "2-3 months faster"
  const daysMatch = speedString.match(/(\d+)\s*days?\s*faster/i);
  if (daysMatch) return parseInt(daysMatch[1]);
  
  const monthsMatch = speedString.match(/(\d+)-?(\d+)?\s*months?\s*faster/i);
  if (monthsMatch) {
    const avgMonths = monthsMatch[2] ? (parseInt(monthsMatch[1]) + parseInt(monthsMatch[2])) / 2 : parseInt(monthsMatch[1]);
    return avgMonths * 30;
  }
  
  const weeksMatch = speedString.match(/(\d+)\s*weeks?\s*faster/i);
  if (weeksMatch) return parseInt(weeksMatch[1]) * 7;
  
  return 0;
}

export default function ComprehensiveROIBreakdown() {
  // Calculate totals
  const scenarioData = scenarios.map(scenario => ({
    ...scenario,
    valueNumber: parseAnnualValue(scenario.annualValue || ''),
    speedDays: parseSpeedAdvantage(scenario.speedAdvantage || '')
  }));

  const totalAnnualValue = scenarioData.reduce((sum, s) => sum + s.valueNumber, 0);
  const avgSpeedImprovement = Math.round(
    scenarioData.reduce((sum, s) => sum + s.speedDays, 0) / scenarioData.length
  );

  // Category breakdown
  const offensiveValue = scenarioData.filter(s => s.category === 'offensive').reduce((sum, s) => sum + s.valueNumber, 0);
  const defensiveValue = scenarioData.filter(s => s.category === 'defensive').reduce((sum, s) => sum + s.valueNumber, 0);
  const specialTeamsValue = scenarioData.filter(s => s.category === 'special-teams').reduce((sum, s) => sum + s.valueNumber, 0);

  // Top scenarios by value
  const topScenarios = [...scenarioData].sort((a, b) => b.valueNumber - a.valueNumber).slice(0, 5);

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800">
      <div className="container mx-auto px-6 py-8">
        {/* Header */}
        <div className="mb-8">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-3">
              <div className="h-12 w-12 rounded-lg bg-gradient-to-br from-green-600 to-emerald-700 flex items-center justify-center">
                <DollarSign className="h-6 w-6 text-white" />
              </div>
              <div>
                <h1 className="text-4xl font-bold text-slate-900 dark:text-white">
                  Comprehensive ROI Analysis
                </h1>
                <p className="text-lg text-slate-600 dark:text-slate-400">
                  Complete value breakdown across all strategic scenarios
                </p>
              </div>
            </div>
            <Button className="gap-2" data-testid="button-export-report">
              <Download className="h-4 w-4" />
              Export Report
            </Button>
          </div>
        </div>

        {/* Executive Summary */}
        <div className="grid md:grid-cols-4 gap-6 mb-8">
          <Card className="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950 dark:to-emerald-950 border-2 border-green-200 dark:border-green-800">
            <CardHeader className="pb-3">
              <CardDescription className="text-green-700 dark:text-green-300">Total Annual Value</CardDescription>
              <CardTitle className="text-4xl font-bold text-green-900 dark:text-green-100" data-testid="text-total-annual-value">
                ${totalAnnualValue.toFixed(0)}M
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-sm text-green-700 dark:text-green-300">
                Across 166 strategic playbooks
              </p>
            </CardContent>
          </Card>

          <Card className="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950 dark:to-indigo-950 border-2 border-blue-200 dark:border-blue-800">
            <CardHeader className="pb-3">
              <CardDescription className="text-blue-700 dark:text-blue-300">Avg Speed Advantage</CardDescription>
              <CardTitle className="text-4xl font-bold text-blue-900 dark:text-blue-100" data-testid="text-avg-speed">
                {avgSpeedImprovement} days
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-sm text-blue-700 dark:text-blue-300">
                Faster decision execution
              </p>
            </CardContent>
          </Card>

          <Card className="bg-gradient-to-br from-purple-50 to-violet-50 dark:from-purple-950 dark:to-violet-950 border-2 border-purple-200 dark:border-purple-800">
            <CardHeader className="pb-3">
              <CardDescription className="text-purple-700 dark:text-purple-300">Platform Investment</CardDescription>
              <CardTitle className="text-4xl font-bold text-purple-900 dark:text-purple-100">
                $120K
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-sm text-purple-700 dark:text-purple-300">
                Annual subscription cost
              </p>
            </CardContent>
          </Card>

          <Card className="bg-gradient-to-br from-orange-50 to-red-50 dark:from-orange-950 dark:to-red-950 border-2 border-orange-200 dark:border-orange-800">
            <CardHeader className="pb-3">
              <CardDescription className="text-orange-700 dark:text-orange-300">Net ROI</CardDescription>
              <CardTitle className="text-4xl font-bold text-orange-900 dark:text-orange-100" data-testid="text-net-roi">
                {Math.round(((totalAnnualValue * 1000000 - 120000) / 120000) * 100).toLocaleString()}%
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-sm text-orange-700 dark:text-orange-300">
                First-year return on investment
              </p>
            </CardContent>
          </Card>
        </div>

        {/* Value by Category */}
        <Card className="mb-8">
          <CardHeader>
            <CardTitle className="text-2xl">Value Distribution by Strategy Type</CardTitle>
            <CardDescription>
              How M creates value across 8 strategic domains
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="grid md:grid-cols-3 gap-6">
              <div className="bg-blue-50 dark:bg-blue-950 rounded-lg p-6 border-2 border-blue-200 dark:border-blue-800">
                <div className="flex items-center gap-2 mb-3">
                  <Target className="h-5 w-5 text-blue-600" />
                  <h3 className="font-semibold text-lg text-blue-900 dark:text-blue-100">Market Growth</h3>
                </div>
                <div className="text-3xl font-bold text-blue-900 dark:text-blue-100 mb-2" data-testid="text-offensive-value">
                  ${offensiveValue.toFixed(0)}M
                </div>
                <p className="text-sm text-blue-700 dark:text-blue-300 mb-4">
                  Market dynamics, opportunities, and expansion playbooks
                </p>
                <div className="space-y-1 text-xs text-blue-600 dark:text-blue-400">
                  {scenarioData.filter(s => s.category === 'offensive').map(s => (
                    <div key={s.id} className="flex justify-between">
                      <span>{s.title}</span>
                      <span className="font-semibold">${s.valueNumber.toFixed(0)}M</span>
                    </div>
                  ))}
                </div>
              </div>

              <div className="bg-red-50 dark:bg-red-950 rounded-lg p-6 border-2 border-red-200 dark:border-red-800">
                <div className="flex items-center gap-2 mb-3">
                  <Shield className="h-5 w-5 text-red-600" />
                  <h3 className="font-semibold text-lg text-red-900 dark:text-red-100">Risk Management</h3>
                </div>
                <div className="text-3xl font-bold text-red-900 dark:text-red-100 mb-2" data-testid="text-defensive-value">
                  ${defensiveValue.toFixed(0)}M
                </div>
                <p className="text-sm text-red-700 dark:text-red-300 mb-4">
                  Risk mitigation, compliance, crisis response
                </p>
                <div className="space-y-1 text-xs text-red-600 dark:text-red-400">
                  {scenarioData.filter(s => s.category === 'defensive').map(s => (
                    <div key={s.id} className="flex justify-between">
                      <span>{s.title}</span>
                      <span className="font-semibold">${s.valueNumber.toFixed(0)}M</span>
                    </div>
                  ))}
                </div>
              </div>

              <div className="bg-purple-50 dark:bg-purple-950 rounded-lg p-6 border-2 border-purple-200 dark:border-purple-800">
                <div className="flex items-center gap-2 mb-3">
                  <TrendingUp className="h-5 w-5 text-purple-600" />
                  <h3 className="font-semibold text-lg text-purple-900 dark:text-purple-100">Strategic Transformation</h3>
                </div>
                <div className="text-3xl font-bold text-purple-900 dark:text-purple-100 mb-2" data-testid="text-special-teams-value">
                  ${specialTeamsValue.toFixed(0)}M
                </div>
                <p className="text-sm text-purple-700 dark:text-purple-300 mb-4">
                  M&A, restructuring, sustainability
                </p>
                <div className="space-y-1 text-xs text-purple-600 dark:text-purple-400">
                  {scenarioData.filter(s => s.category === 'special-teams').map(s => (
                    <div key={s.id} className="flex justify-between">
                      <span>{s.title}</span>
                      <span className="font-semibold">${s.valueNumber.toFixed(0)}M</span>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Detailed Scenario Breakdown */}
        <Tabs defaultValue="all" className="mb-8">
          <TabsList className="mb-6">
            <TabsTrigger value="all" data-testid="tab-all-scenarios">All Playbooks</TabsTrigger>
            <TabsTrigger value="top5" data-testid="tab-top-5">Top 5 by Value</TabsTrigger>
            <TabsTrigger value="comparison" data-testid="tab-comparison">Traditional vs M</TabsTrigger>
          </TabsList>

          <TabsContent value="all">
            <Card>
              <CardHeader>
                <CardTitle>Complete Playbook Value Analysis</CardTitle>
                <CardDescription>
                  Financial impact and speed advantages across strategic playbooks
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead>
                      <tr className="border-b-2 border-slate-200 dark:border-slate-700">
                        <th className="text-left py-3 px-4 font-semibold text-slate-900 dark:text-white">Scenario</th>
                        <th className="text-left py-3 px-4 font-semibold text-slate-900 dark:text-white">Category</th>
                        <th className="text-right py-3 px-4 font-semibold text-slate-900 dark:text-white">Annual Value</th>
                        <th className="text-right py-3 px-4 font-semibold text-slate-900 dark:text-white">Speed Advantage</th>
                        <th className="text-right py-3 px-4 font-semibold text-slate-900 dark:text-white">Elements</th>
                      </tr>
                    </thead>
                    <tbody>
                      {scenarioData.map((scenario, index) => (
                        <tr 
                          key={scenario.id} 
                          className="border-b border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-900"
                          data-testid={`row-scenario-${scenario.id}`}
                        >
                          <td className="py-3 px-4">
                            <div className="font-medium text-slate-900 dark:text-white">{scenario.title}</div>
                            <div className="text-sm text-slate-600 dark:text-slate-400">{scenario.purpose}</div>
                          </td>
                          <td className="py-3 px-4">
                            <Badge 
                              variant={scenario.category === 'offensive' ? 'default' : scenario.category === 'defensive' ? 'destructive' : 'secondary'}
                            >
                              {scenario.category}
                            </Badge>
                          </td>
                          <td className="py-3 px-4 text-right">
                            <div className="font-bold text-green-600 dark:text-green-400">
                              ${scenario.valueNumber.toFixed(1)}M
                            </div>
                          </td>
                          <td className="py-3 px-4 text-right">
                            <div className="text-slate-900 dark:text-white">
                              {scenario.speedDays > 0 ? `${scenario.speedDays} days` : scenario.speedAdvantage}
                            </div>
                          </td>
                          <td className="py-3 px-4 text-right">
                            <span className="text-slate-600 dark:text-slate-400">
                              {scenario.elementsActivated?.length || 0}/12
                            </span>
                          </td>
                        </tr>
                      ))}
                      <tr className="bg-slate-100 dark:bg-slate-900 font-bold border-t-2 border-slate-300 dark:border-slate-600">
                        <td className="py-4 px-4 text-lg" colSpan={2}>TOTAL VALUE</td>
                        <td className="py-4 px-4 text-right text-xl text-green-600 dark:text-green-400" data-testid="text-table-total-value">
                          ${totalAnnualValue.toFixed(1)}M
                        </td>
                        <td className="py-4 px-4 text-right" colSpan={2}>
                          Avg {avgSpeedImprovement} days faster
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="top5">
            <Card>
              <CardHeader>
                <CardTitle>Top 5 Highest-Value Scenarios</CardTitle>
                <CardDescription>
                  The strategic scenarios that deliver the greatest financial impact
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  {topScenarios.map((scenario, index) => (
                    <div 
                      key={scenario.id} 
                      className="bg-gradient-to-r from-slate-50 to-white dark:from-slate-900 dark:to-slate-800 rounded-lg p-6 border-2 border-slate-200 dark:border-slate-700"
                      data-testid={`card-top-scenario-${index + 1}`}
                    >
                      <div className="flex items-start justify-between mb-3">
                        <div className="flex items-center gap-3">
                          <div className="h-10 w-10 rounded-full bg-gradient-to-br from-green-600 to-emerald-600 flex items-center justify-center text-white font-bold text-lg">
                            #{index + 1}
                          </div>
                          <div>
                            <h3 className="font-bold text-lg text-slate-900 dark:text-white">{scenario.title}</h3>
                            <p className="text-sm text-slate-600 dark:text-slate-400">{scenario.description}</p>
                          </div>
                        </div>
                        <div className="text-right">
                          <div className="text-3xl font-bold text-green-600 dark:text-green-400">
                            ${scenario.valueNumber.toFixed(1)}M
                          </div>
                          <div className="text-sm text-slate-600 dark:text-slate-400">annual value</div>
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-4 mt-4">
                        <div className="flex items-center gap-2">
                          <Clock className="h-4 w-4 text-blue-600" />
                          <span className="text-sm text-slate-700 dark:text-slate-300">{scenario.speedAdvantage}</span>
                        </div>
                        <div className="flex items-center gap-2">
                          <CheckCircle2 className="h-4 w-4 text-green-600" />
                          <span className="text-sm text-slate-700 dark:text-slate-300">
                            {scenario.elementsActivated?.length || 0} elements activated
                          </span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="comparison">
            <Card>
              <CardHeader>
                <CardTitle>Traditional Approach vs. M: Side-by-Side Comparison</CardTitle>
                <CardDescription>
                  See how M's NFL coach-inspired methodology delivers superior outcomes
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid md:grid-cols-2 gap-6">
                  {/* Traditional Approach */}
                  <div className="bg-red-50 dark:bg-red-950/30 rounded-lg p-6 border-2 border-red-200 dark:border-red-800">
                    <h3 className="text-xl font-bold text-red-900 dark:text-red-100 mb-4">
                       Traditional Approach
                    </h3>
                    <div className="space-y-4">
                      <div>
                        <div className="text-sm text-red-700 dark:text-red-300 mb-1">Average Response Time</div>
                        <div className="text-2xl font-bold text-red-900 dark:text-red-100">72 hours</div>
                      </div>
                      <div>
                        <div className="text-sm text-red-700 dark:text-red-300 mb-1">Decision Process</div>
                        <ul className="text-sm text-red-800 dark:text-red-200 space-y-1">
                          <li> Emergency meetings to assemble team</li>
                          <li> Debate response strategies</li>
                          <li> Delayed decision-making</li>
                          <li> Fragmented communication</li>
                          <li> Improvised recovery plans</li>
                        </ul>
                      </div>
                      <div>
                        <div className="text-sm text-red-700 dark:text-red-300 mb-1">Annual Cost Impact</div>
                        <div className="text-xl font-bold text-red-900 dark:text-red-100">
                          ${totalAnnualValue.toFixed(0)}M+ in losses
                        </div>
                        <div className="text-xs text-red-700 dark:text-red-300 mt-1">
                          Revenue loss, inefficiencies, missed opportunities
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* M Approach */}
                  <div className="bg-green-50 dark:bg-green-950/30 rounded-lg p-6 border-2 border-green-200 dark:border-green-800">
                    <h3 className="text-xl font-bold text-green-900 dark:text-green-100 mb-4">
                       M Platform
                    </h3>
                    <div className="space-y-4">
                      <div>
                        <div className="text-sm text-green-700 dark:text-green-300 mb-1">Average Response Time</div>
                        <div className="text-2xl font-bold text-green-900 dark:text-green-100">12 minutes</div>
                      </div>
                      <div>
                        <div className="text-sm text-green-700 dark:text-green-300 mb-1">Decision Process</div>
                        <ul className="text-sm text-green-800 dark:text-green-200 space-y-1">
                          <li> AI detects trigger automatically</li>
                          <li> Pre-configured playbook activates</li>
                          <li> One-click stakeholder coordination</li>
                          <li> Real-time progress monitoring</li>
                          <li> Learning captured for next time</li>
                        </ul>
                      </div>
                      <div>
                        <div className="text-sm text-green-700 dark:text-green-300 mb-1">Annual Value Created</div>
                        <div className="text-xl font-bold text-green-900 dark:text-green-100">
                          ${totalAnnualValue.toFixed(0)}M+ delivered
                        </div>
                        <div className="text-xs text-green-700 dark:text-green-300 mt-1">
                          Cost savings, revenue protection, faster execution
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Bottom CTA */}
                <div className="mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950 dark:to-indigo-950 rounded-lg p-6 border-2 border-blue-200 dark:border-blue-800">
                  <div className="flex items-center justify-between">
                    <div>
                      <h4 className="font-bold text-lg text-blue-900 dark:text-blue-100 mb-2">
                        The Choice is Clear
                      </h4>
                      <p className="text-sm text-blue-700 dark:text-blue-300">
                        Stop losing ${totalAnnualValue.toFixed(0)}M annually to slow, reactive decision-making. 
                        Get NFL coach-level execution speed in your boardroom.
                      </p>
                    </div>
                    <Button className="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 gap-2" data-testid="button-schedule-demo">
                      Schedule Demo
                      <ArrowRight className="h-4 w-4" />
                    </Button>
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/ComprehensiveScenarios.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { useLocation } from 'wouter';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import PageLayout from '@/components/layout/PageLayout';
import CreateScenarioButton from '@/components/scenario/CreateScenarioButton';
import { formatDistanceToNow } from 'date-fns';
import { useToast } from '@/hooks/use-toast';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { 
  MapPin, 
  AlertTriangle, 
  TrendingUp, 
  Users, 
  Building2,
  Shield,
  DollarSign,
  Globe,
  Zap,
  Target,
  CheckCircle,
  Clock,
  ArrowRight,
  PlayCircle,
  FileText,
  Brain,
  Rocket,
  CircleDot,
  Calendar,
  Percent,
  Trophy
} from 'lucide-react';

export default function ComprehensiveScenarios() {
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [selectedIndustry, setSelectedIndustry] = useState('all');
  const { toast } = useToast();
  const [, setLocation] = useLocation();
  
  // Fetch scenarios from API (includes both demo scenarios and database scenarios)
  const { data: scenariosData, isLoading, isError } = useQuery<any[]>({
    queryKey: ['/api/scenarios'],
  });
  const scenarios = scenariosData ?? [];

  // Helper to check if a scenario is executable (has UUID ID from database)
  const isExecutable = (id: string) => /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(id);

  // Import template mutation
  const importTemplateMutation = useMutation({
    mutationFn: async (templateId: string) => {
      const response = await fetch(`/api/scenarios/${templateId}/import`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
      });
      if (!response.ok) throw new Error('Failed to import template');
      return await response.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/scenarios'] });
      toast({
        title: 'Template Imported',
        description: 'The playbook template has been added to your organization.',
      });
      // Switch to "All Playbooks" tab to see the imported template
      setSelectedCategory('all');
    },
    onError: () => {
      toast({
        title: 'Import Failed',
        description: 'Failed to import template. Please try again.',
        variant: 'destructive',
      });
    },
  });

  const scenarioCategories = [
    {
      id: 'all',
      name: 'All Playbooks',
      icon: <Target className="w-5 h-5" />,
      count: scenarios.length,
      description: 'Complete decision operations platform with customizable execution frameworks',
      color: 'text-blue-500'
    },
    {
      id: 'crisis',
      name: 'Crisis Response',
      icon: <AlertTriangle className="w-5 h-5" />,
      count: scenarios.filter((s: any) => (s.type || s.category) === 'crisis').length,
      description: 'Emergency response and crisis management scenarios',
      color: 'text-red-500'
    },
    {
      id: 'strategic',
      name: 'Strategic Opportunities',
      icon: <Target className="w-5 h-5" />,
      count: scenarios.filter((s: any) => (s.type || s.category) === 'strategic').length,
      description: 'Strategic planning and opportunity capture scenarios', 
      color: 'text-blue-500'
    },
    {
      id: 'templates',
      name: 'Industry Templates',
      icon: <Building2 className="w-5 h-5" />,
      count: scenarios.filter((s: any) => s.isTemplate).length,
      description: 'Pre-built industry-specific playbooks ready to import',
      color: 'text-purple-500'
    }
  ];

  const industryOptions = [
    { id: 'all', name: 'All Industries', icon: <Globe className="w-4 h-4" />, color: 'text-blue-500' },
    { id: 'financial', name: 'Financial Services', icon: <DollarSign className="w-4 h-4" />, color: 'text-green-500' },
    { id: 'manufacturing', name: 'Manufacturing', icon: <Building2 className="w-4 h-4" />, color: 'text-orange-500' },
    { id: 'healthcare', name: 'Healthcare', icon: <Shield className="w-4 h-4" />, color: 'text-red-500' },
    { id: 'retail', name: 'Retail', icon: <Users className="w-4 h-4" />, color: 'text-purple-500' },
    { id: 'technology', name: 'Technology', icon: <Zap className="w-4 h-4" />, color: 'text-cyan-500' }
  ];

  const filteredScenarios = scenarioCategories.find(cat => cat.id === selectedCategory);
  
  let filteredScenariosData = selectedCategory === 'all' 
    ? scenarios 
    : selectedCategory === 'templates'
    ? scenarios.filter((s: any) => s.isTemplate)
    : scenarios.filter((s: any) => (s.type || s.category) === selectedCategory);
  
  // Filter by industry if in templates tab
  if (selectedCategory === 'templates' && selectedIndustry !== 'all') {
    filteredScenariosData = filteredScenariosData.filter((s: any) => 
      s.industry === selectedIndustry
    );
  }

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800">
        <div className="p-8">
          {/* Scenarios Header */}
          <div className="flex items-center justify-between mb-8">
            <div className="flex items-center space-x-4">
              <div className="w-12 h-12 bg-gradient-to-r from-red-500 to-pink-600 rounded-xl flex items-center justify-center">
                <MapPin className="w-7 h-7 text-white" />
              </div>
              <div>
                <h1 className="text-3xl font-bold text-gray-900 dark:text-white">Comprehensive Scenarios</h1>
                <p className="text-gray-600 dark:text-gray-300">Strategic Response Templates & AI-Powered Workflows</p>
              </div>
            </div>
            <div className="flex items-center space-x-3">
              {scenarios.length > 0 && (
                <>
                  <Badge variant="outline" className="text-green-600 border-green-500/50">
                    <CheckCircle className="w-3 h-3 mr-1" />
                    {scenarios.length} Playbook{scenarios.length !== 1 ? 's' : ''} Active
                  </Badge>
                  <Badge className="bg-blue-600 text-white">
                    Ready to Execute
                  </Badge>
                </>
              )}
              <CreateScenarioButton organizationId="default-org" size="lg" />
            </div>
          </div>

          {/* Scenario Categories */}
          <Tabs value={selectedCategory} onValueChange={setSelectedCategory} className="mb-8">
            <TabsList className="grid w-full grid-cols-4 bg-slate-100 dark:bg-slate-800">
              {scenarioCategories.map((category) => (
                <TabsTrigger 
                  key={category.id} 
                  value={category.id}
                  className="flex items-center space-x-2"
                  data-testid={`tab-scenario-${category.id}`}
                >
                  {category.icon}
                  <span>{category.name}</span>
                  <Badge variant="secondary">{category.count}</Badge>
                </TabsTrigger>
              ))}
            </TabsList>

            <div className="mt-6">
              <TabsContent value={selectedCategory} className="space-y-6">
                {/* Category Overview */}
                <Card className="bg-gradient-to-r .section-background dark:from-blue-900/20 dark:to-purple-900/20 border-blue-200 dark:border-blue-800">
                  <CardContent className="p-6">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center space-x-4">
                        <div className={`p-3 rounded-lg bg-white dark:bg-slate-800 ${filteredScenarios?.color}`}>
                          {filteredScenarios?.icon}
                        </div>
                        <div>
                          <h3 className="text-xl font-bold text-gray-900 dark:text-white">{filteredScenarios?.name} Scenarios</h3>
                          <p className="text-gray-600 dark:text-gray-400">{filteredScenarios?.description}</p>
                          <div className="flex items-center space-x-4 mt-2 text-sm text-gray-500">
                            <span>{filteredScenarios?.count} templates available</span>
                            <span></span>
                            <span>Enterprise-grade protocols</span>
                            <span></span>
                            <span>AI-powered execution</span>
                          </div>
                        </div>
                      </div>
                      {selectedCategory !== 'templates' && (
                        <CreateScenarioButton organizationId="default-org" variant="outline" />
                      )}
                    </div>
                  </CardContent>
                </Card>

                {/* Industry Filter (only show in templates tab) */}
                {selectedCategory === 'templates' && (
                  <Card className="bg-white dark:bg-slate-800">
                    <CardHeader>
                      <CardTitle className="text-base">Browse by Industry</CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                        {industryOptions.map((industry) => (
                          <Button
                            key={industry.id}
                            variant={selectedIndustry === industry.id ? 'default' : 'outline'}
                            className={`flex items-center justify-start gap-2 ${selectedIndustry === industry.id ? '' : industry.color}`}
                            onClick={() => setSelectedIndustry(industry.id)}
                            data-testid={`button-industry-${industry.id}`}
                          >
                            {industry.icon}
                            <span className="text-xs">{industry.name}</span>
                          </Button>
                        ))}
                      </div>
                    </CardContent>
                  </Card>
                )}

                {/* Scenarios Grid */}
                {isLoading && (
                  <div className="text-center py-12 text-gray-500">
                    Loading playbooks...
                  </div>
                )}
                
                {isError && (
                  <div className="text-center py-12">
                    <AlertTriangle className="h-12 w-12 text-red-500 mx-auto mb-4" />
                    <p className="text-red-600">Failed to load playbooks. Please try again.</p>
                  </div>
                )}
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {!isLoading && !isError && filteredScenariosData.length === 0 && (
                    <div className="col-span-2 text-center py-12 text-gray-500">
                      {scenarios.length === 0 
                        ? "No playbooks available yet. Create your first playbook to get started."
                        : `No ${selectedCategory} playbooks available. Select a different category.`}
                    </div>
                  )}
                  
                  {!isLoading && !isError && filteredScenariosData.map((scenario) => {
                    const readinessColor = scenario.readinessState === 'green' ? 'text-green-500' : 
                                          scenario.readinessState === 'yellow' ? 'text-yellow-500' : 'text-red-500';
                    const readinessBg = scenario.readinessState === 'green' ? 'bg-green-50 dark:bg-green-900/20 border-green-200' : 
                                       scenario.readinessState === 'yellow' ? 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200' : 
                                       'bg-red-50 dark:bg-red-900/20 border-red-200';
                                       
                    return (
                      <Card key={scenario.id} className={`bg-white/90 dark:bg-slate-800/90 backdrop-blur hover:shadow-lg transition-shadow border-l-4 ${scenario.readinessState === 'green' ? 'border-l-green-500' : scenario.readinessState === 'yellow' ? 'border-l-yellow-500' : 'border-l-red-500'}`}>
                        <CardHeader>
                          <div className="flex items-center justify-between">
                            <CardTitle className="text-lg text-gray-900 dark:text-white flex items-center gap-2">
                              <CircleDot className={`w-5 h-5 ${readinessColor}`} />
                              {scenario.title || scenario.name}
                            </CardTitle>
                            <Badge 
                              variant={scenario.readinessState === 'green' ? 'default' : scenario.readinessState === 'yellow' ? 'secondary' : 'destructive'}
                              className="text-xs"
                              data-testid={`badge-readiness-${scenario.id}`}
                            >
                              {scenario.readinessState === 'green' ? ' Ready' : 
                               scenario.readinessState === 'yellow' ? ' Needs Review' : 
                               ' Requires Setup'}
                            </Badge>
                          </div>
                        </CardHeader>
                        <CardContent className="space-y-4">
                          <p className="text-sm text-gray-600 dark:text-gray-400">{scenario.description}</p>
                          
                          {/* NFL-Style Readiness Indicators */}
                          <div className={`p-3 rounded-lg border ${readinessBg}`}>
                            <div className="grid grid-cols-2 gap-3 text-xs">
                              {/* Last Drill Date */}
                              <div className="flex items-center gap-2">
                                <Calendar className="w-3 h-3" />
                                <div>
                                  <div className="text-gray-500">Last Drill</div>
                                  <div className="font-semibold">
                                    {scenario.lastDrillDate 
                                      ? formatDistanceToNow(new Date(scenario.lastDrillDate), { addSuffix: true })
                                      : 'Never practiced'}
                                  </div>
                                </div>
                              </div>
                              
                              {/* Automation Coverage */}
                              <div className="flex items-center gap-2">
                                <Percent className="w-3 h-3" />
                                <div>
                                  <div className="text-gray-500">Automated</div>
                                  <div className="font-semibold">
                                    {scenario.automationCoverage 
                                      ? `${Math.round(parseFloat(scenario.automationCoverage) * 100)}%`
                                      : 'Not configured'}
                                  </div>
                                </div>
                              </div>
                              
                              {/* Average Execution Time */}
                              <div className="flex items-center gap-2">
                                <Clock className="w-3 h-3" />
                                <div>
                                  <div className="text-gray-500">Avg Execution</div>
                                  <div className="font-semibold">
                                    {scenario.averageExecutionTime 
                                      ? `${scenario.averageExecutionTime} min`
                                      : scenario.executionCount > 0 ? 'Calculating...' : 'First run'}
                                  </div>
                                </div>
                              </div>
                              
                              {/* Execution Count */}
                              <div className="flex items-center gap-2">
                                <Trophy className="w-3 h-3" />
                                <div>
                                  <div className="text-gray-500">Executions</div>
                                  <div className="font-semibold">
                                    {scenario.executionCount || 0} times
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          
                          {/* Approval Status */}
                          {scenario.approvalStatus && (
                            <div className="flex items-center gap-2 text-xs">
                              <CheckCircle className="w-3 h-3 text-green-600" />
                              <span className="text-gray-600">
                                {scenario.approvalStatus === 'approved' 
                                  ? `Approved ${scenario.approvedAt ? formatDistanceToNow(new Date(scenario.approvedAt), { addSuffix: true }) : ''}`
                                  : `Status: ${scenario.approvalStatus}`}
                              </span>
                            </div>
                          )}

                          <div className="flex space-x-2 pt-2">
                            {scenario.isTemplate && selectedCategory === 'templates' ? (
                              <>
                                <Button 
                                  className="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700"
                                  data-testid={`button-import-${scenario.id}`}
                                  onClick={() => importTemplateMutation.mutate(scenario.id)}
                                  disabled={importTemplateMutation.isPending}
                                >
                                  <Rocket className="w-4 h-4 mr-2" />
                                  {importTemplateMutation.isPending ? 'Importing...' : 'Import Template'}
                                </Button>
                                <Button 
                                  variant="outline"
                                  data-testid={`button-preview-${scenario.id}`}
                                >
                                  <FileText className="w-4 h-4 mr-2" />
                                  Preview
                                </Button>
                              </>
                            ) : (
                              <>
                                <Button 
                                  className="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700"
                                  data-testid={`button-activate-${scenario.id}`}
                                  disabled={scenario.readinessState === 'red' || !isExecutable(scenario.id)}
                                  onClick={() => setLocation(`/playbook-activation/manual/${scenario.id}`)}
                                  title={!isExecutable(scenario.id) ? 'Demo scenario - View interactive demo instead' : scenario.readinessState === 'red' ? 'Setup required before execution' : 'Execute this playbook'}
                                >
                                  <PlayCircle className="w-4 h-4 mr-2" />
                                  {!isExecutable(scenario.id) ? 'View Demo' : scenario.readinessState === 'red' ? 'Setup Required' : 'Execute Now'}
                                </Button>
                                <Button 
                                  variant="outline"
                                  data-testid={`button-preview-${scenario.id}`}
                                  onClick={() => {
                                    // For demo scenarios (string IDs), go to interactive demo
                                    if (!isExecutable(scenario.id)) {
                                      setLocation(`/business-scenario/${scenario.id}`);
                                    }
                                  }}
                                >
                                  <FileText className="w-4 h-4 mr-2" />
                                  {!isExecutable(scenario.id) ? 'View Details' : 'Preview'}
                                </Button>
                              </>
                            )}
                          </div>
                        </CardContent>
                      </Card>
                    );
                  })}
                </div>
              </TabsContent>
            </div>
          </Tabs>

          {/* AI-Powered Scenario Intelligence */}
          <Card className="bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-purple-200 dark:border-purple-800">
            <CardHeader>
              <CardTitle className="flex items-center text-gray-900 dark:text-white">
                <Brain className="w-5 h-5 mr-2 text-purple-500" />
                AI-Powered Scenario Intelligence
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className="text-center">
                  <div className="w-16 h-16 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <Brain className="w-8 h-8 text-white" />
                  </div>
                  <h4 className="text-lg font-semibold text-gray-900 dark:text-white mb-2">Trigger-Based Intelligence</h4>
                  <p className="text-sm text-gray-600 dark:text-gray-400">YOU define trigger conditions, AI monitors 24/7 and recommends optimal response strategies with 85-92% success rate</p>
                </div>
                
                <div className="text-center">
                  <div className="w-16 h-16 bg-gradient-to-r from-blue-500 to-cyan-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <Zap className="w-8 h-8 text-white" />
                  </div>
                  <h4 className="text-lg font-semibold text-gray-900 dark:text-white mb-2">Instant Activation</h4>
                  <p className="text-sm text-gray-600 dark:text-gray-400">One-click scenario activation with automated stakeholder notification and resource allocation</p>
                </div>
                
                <div className="text-center">
                  <div className="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <Target className="w-8 h-8 text-white" />
                  </div>
                  <h4 className="text-lg font-semibold text-gray-900 dark:text-white mb-2">Success Optimization</h4>
                  <p className="text-sm text-gray-600 dark:text-gray-400">Continuous learning from scenario outcomes to optimize future response effectiveness</p>
                </div>
              </div>

              <div className="flex justify-center mt-8">
                <Button className="bg-gradient-to-r from-purple-600 to-blue-600 text-white" data-testid="button-ai-scenario-builder">
                  <Brain className="w-5 h-5 mr-2" />
                  Launch AI Scenario Builder
                  <ArrowRight className="w-4 h-4 ml-2" />
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/Contact.tsx
========================================
import { useEffect } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { useToast } from "@/hooks/use-toast";
import StandardNav from "@/components/layout/StandardNav";
import { updatePageMetadata } from "@/lib/seo";
import { CheckCircle2, Shield, Zap, Target } from "lucide-react";
import { useLocation } from "wouter";

const earlyAccessSchema = z.object({
  firstName: z.string().min(1, "First name required"),
  lastName: z.string().min(1, "Last name required"),
  email: z.string().email("Valid email required"),
  company: z.string().min(1, "Company name required"),
  title: z.string().min(1, "Job title required"),
  companySize: z.string().min(1, "Please select company size"),
  primaryChallenge: z.string().min(10, "Please describe your challenge (min 10 characters)"),
  scenariosOfInterest: z.string().min(5, "Please share scenario examples"),
});

type EarlyAccessForm = z.infer<typeof earlyAccessSchema>;

export default function Contact() {
  const { toast } = useToast();
  const [, setLocation] = useLocation();

  useEffect(() => {
    updatePageMetadata({
      title: "Request Early Access - M Q1 2025 Pilot Program",
      description: "Join M's exclusive Q1 2025 pilot program. Limited to 10 Fortune 1000 companies for 90-day validation partnership. Transform strategic execution from days to minutes.",
      ogTitle: "Request Early Access - M Pilot Program",
      ogDescription: "Limited pilot opportunity for Fortune 1000 companies. 90-day validation partnership starting Q1 2025.",
    });
  }, []);

  const form = useForm<EarlyAccessForm>({
    resolver: zodResolver(earlyAccessSchema),
    defaultValues: {
      firstName: "",
      lastName: "",
      email: "",
      company: "",
      title: "",
      companySize: "",
      primaryChallenge: "",
      scenariosOfInterest: "",
    },
  });

  const onSubmit = async (data: EarlyAccessForm) => {
    console.log("Early Access Request:", data);
    
    toast({
      title: "Request Received!",
      description: "Thank you for your interest. Our team will contact you within 48 hours to schedule your executive interview.",
    });

    form.reset();
    
    setTimeout(() => {
      setLocation("/");
    }, 3000);
  };

  return (
    <div className="page-background min-h-screen bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900">
      <StandardNav />

      {/* Hero Section */}
      <section className="py-16 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
        <div className="max-w-5xl mx-auto text-center">
          <Badge className="mb-4 bg-purple-600 text-white border-0 text-base px-6 py-2" data-testid="badge-early-access">
            Q1 2025 Pilot Program
          </Badge>
          <h1 className="text-4xl md:text-6xl font-bold mb-6 text-white" data-testid="heading-early-access">
            Request Early Access Interview
          </h1>
          <p className="text-xl text-blue-200 max-w-3xl mx-auto mb-6">
            Join an exclusive group of 10 Fortune 1000 companies transforming strategic execution through M's 90-day validation partnership.
          </p>
          <div className="flex items-center justify-center gap-8 text-sm text-blue-300">
            <div className="flex items-center gap-2">
              <Shield className="h-5 w-5 text-cyan-400" />
              <span>Limited to 10 Partners</span>
            </div>
            <div className="flex items-center gap-2">
              <Zap className="h-5 w-5 text-cyan-400" />
              <span>Q1 2025 Launch</span>
            </div>
            <div className="flex items-center gap-2">
              <Target className="h-5 w-5 text-cyan-400" />
              <span>90-Day Validation</span>
            </div>
          </div>
        </div>
      </section>

      {/* Main Form Section */}
      <section className="py-16 px-6">
        <div className="max-w-6xl mx-auto grid md:grid-cols-3 gap-8">
          {/* Left Column - Value Proposition */}
          <div className="md:col-span-1">
            <Card className="sticky top-24" data-testid="card-pilot-benefits">
              <CardHeader>
                <CardTitle className="text-2xl">Pilot Partner Benefits</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <div className="flex items-start gap-3">
                    <CheckCircle2 className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
                    <div>
                      <div className="font-semibold text-slate-900 dark:text-white">Full Platform Access</div>
                      <p className="text-sm text-slate-600 dark:text-slate-400">Complete 7-component ecosystem during validation period</p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <CheckCircle2 className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
                    <div>
                      <div className="font-semibold text-slate-900 dark:text-white">Strategic Implementation</div>
                      <p className="text-sm text-slate-600 dark:text-slate-400">Dedicated support for 3-5 critical scenarios</p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <CheckCircle2 className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
                    <div>
                      <div className="font-semibold text-slate-900 dark:text-white">First-Mover Advantage</div>
                      <p className="text-sm text-slate-600 dark:text-slate-400">Category leadership in Executive Decision Operations</p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <CheckCircle2 className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
                    <div>
                      <div className="font-semibold text-slate-900 dark:text-white">Risk-Free Validation</div>
                      <p className="text-sm text-slate-600 dark:text-slate-400">Prove ROI in your context before full commitment</p>
                    </div>
                  </div>
                </div>

                <div className="mt-6 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800">
                  <p className="text-sm text-blue-900 dark:text-blue-200">
                    <strong>Selection Process:</strong> Executive interview  Use case assessment  Partnership agreement  Week 1 onboarding
                  </p>
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Right Column - Form */}
          <div className="md:col-span-2">
            <Card data-testid="card-early-access-form">
              <CardHeader>
                <CardTitle className="text-3xl">Tell Us About Your Organization</CardTitle>
                <p className="text-slate-600 dark:text-slate-400">
                  Help us understand your strategic execution challenges and pilot readiness.
                </p>
              </CardHeader>
              <CardContent>
                <Form {...form}>
                  <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
                    {/* Name Fields */}
                    <div className="grid md:grid-cols-2 gap-4">
                      <FormField
                        control={form.control}
                        name="firstName"
                        render={({ field }) => (
                          <FormItem>
                            <FormLabel>First Name *</FormLabel>
                            <FormControl>
                              <Input placeholder="John" {...field} data-testid="input-first-name" />
                            </FormControl>
                            <FormMessage />
                          </FormItem>
                        )}
                      />
                      <FormField
                        control={form.control}
                        name="lastName"
                        render={({ field }) => (
                          <FormItem>
                            <FormLabel>Last Name *</FormLabel>
                            <FormControl>
                              <Input placeholder="Smith" {...field} data-testid="input-last-name" />
                            </FormControl>
                            <FormMessage />
                          </FormItem>
                        )}
                      />
                    </div>

                    {/* Email */}
                    <FormField
                      control={form.control}
                      name="email"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Business Email *</FormLabel>
                          <FormControl>
                            <Input type="email" placeholder="john.smith@company.com" {...field} data-testid="input-email" />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />

                    {/* Company & Title */}
                    <div className="grid md:grid-cols-2 gap-4">
                      <FormField
                        control={form.control}
                        name="company"
                        render={({ field }) => (
                          <FormItem>
                            <FormLabel>Company Name *</FormLabel>
                            <FormControl>
                              <Input placeholder="Acme Corporation" {...field} data-testid="input-company" />
                            </FormControl>
                            <FormMessage />
                          </FormItem>
                        )}
                      />
                      <FormField
                        control={form.control}
                        name="title"
                        render={({ field }) => (
                          <FormItem>
                            <FormLabel>Job Title *</FormLabel>
                            <FormControl>
                              <Input placeholder="VP of Strategy" {...field} data-testid="input-title" />
                            </FormControl>
                            <FormMessage />
                          </FormItem>
                        )}
                      />
                    </div>

                    {/* Company Size */}
                    <FormField
                      control={form.control}
                      name="companySize"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Company Size (Employees) *</FormLabel>
                          <Select onValueChange={field.onChange} defaultValue={field.value}>
                            <FormControl>
                              <SelectTrigger data-testid="select-company-size">
                                <SelectValue placeholder="Select company size" />
                              </SelectTrigger>
                            </FormControl>
                            <SelectContent>
                              <SelectItem value="10000+">10,000+ (Fortune 1000)</SelectItem>
                              <SelectItem value="5000-10000">5,000-10,000</SelectItem>
                              <SelectItem value="1000-5000">1,000-5,000</SelectItem>
                              <SelectItem value="500-1000">500-1,000</SelectItem>
                              <SelectItem value="<500">Less than 500</SelectItem>
                            </SelectContent>
                          </Select>
                          <FormMessage />
                        </FormItem>
                      )}
                    />

                    {/* Primary Challenge */}
                    <FormField
                      control={form.control}
                      name="primaryChallenge"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Primary Strategic Execution Challenge *</FormLabel>
                          <FormControl>
                            <Textarea
                              placeholder="Example: We miss 60% of market opportunities due to slow stakeholder coordination. By the time we align cross-functional teams, competitors have already moved."
                              className="min-h-[100px]"
                              {...field}
                              data-testid="textarea-challenge"
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />

                    {/* Scenarios of Interest */}
                    <FormField
                      control={form.control}
                      name="scenariosOfInterest"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Strategic Scenarios You'd Like to Operationalize *</FormLabel>
                          <FormControl>
                            <Textarea
                              placeholder="Example: Competitive response to new entrant, M&A opportunity evaluation, product recall crisis, regulatory change adaptation"
                              className="min-h-[100px]"
                              {...field}
                              data-testid="textarea-scenarios"
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />

                    {/* Disclaimer */}
                    <div className="bg-yellow-50 dark:bg-yellow-950 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                      <p className="text-sm text-yellow-900 dark:text-yellow-200">
                        <strong>Note:</strong> M is in pre-launch with zero production customers. This pilot program is designed to validate our design goals (12-minute execution vs 72-hour industry standard) in real-world Fortune 1000 environments. Selection is limited to 10 companies with clear strategic fit and implementation readiness.
                      </p>
                    </div>

                    {/* Submit Button */}
                    <Button
                      type="submit"
                      size="lg"
                      className="w-full bg-purple-600 hover:bg-purple-700 text-white text-lg py-6"
                      data-testid="button-submit-early-access"
                    >
                      Submit Early Access Request
                    </Button>

                    <p className="text-sm text-center text-slate-600 dark:text-slate-400">
                      Our team will review your request and contact you within 48 hours to schedule an executive interview.
                    </p>
                  </form>
                </Form>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Supporting Information */}
      <section className="py-16 px-6 bg-slate-100 dark:bg-slate-800">
        <div className="max-w-5xl mx-auto text-center">
          <h2 className="text-3xl font-bold mb-6 text-slate-900 dark:text-white">
            Questions About the Pilot Program?
          </h2>
          <p className="text-lg text-slate-600 dark:text-slate-400 mb-8">
            Learn more about program structure, technical requirements, and success metrics.
          </p>
          <div className="flex flex-wrap justify-center gap-4">
            <Button
              onClick={() => setLocation("/how-it-works")}
              variant="outline"
              size="lg"
              data-testid="button-see-demo"
            >
              See How M Works
            </Button>
            <Button
              onClick={() => setLocation("/playbook-library")}
              variant="outline"
              size="lg"
              data-testid="button-view-scenarios"
            >
              View 166 Playbooks
            </Button>
            <Button
              onClick={() => setLocation("/our-story")}
              variant="outline"
              size="lg"
              data-testid="button-our-story"
            >
              Read Our Story
            </Button>
          </div>
        </div>
      </section>
    </div>
  );
}


========================================
FILE: client/src/pages/ContinuousModePage.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useDynamicStrategy } from '@/contexts/DynamicStrategyContext';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Activity, Clock, Calendar, CheckCircle, AlertCircle, PlayCircle, Pause } from 'lucide-react';

const scheduledTasks = [
  {
    id: 1,
    name: 'Weak Signal Sweep',
    schedule: 'Every 15 minutes',
    lastRun: '3 minutes ago',
    nextRun: '12 minutes',
    status: 'active',
    executions: 1247,
  },
  {
    id: 2,
    name: 'Oracle Pattern Analysis',
    schedule: 'Every 30 minutes',
    lastRun: '8 minutes ago',
    nextRun: '22 minutes',
    status: 'active',
    executions: 623,
  },
  {
    id: 3,
    name: 'Readiness Index Calculation',
    schedule: 'Daily at 6:00 AM',
    lastRun: '18 hours ago',
    nextRun: 'Tomorrow at 6:00 AM',
    status: 'active',
    executions: 342,
  },
  {
    id: 4,
    name: 'Playbook Learning Extraction',
    schedule: 'After each activation',
    lastRun: '2 days ago',
    nextRun: 'On demand',
    status: 'active',
    executions: 89,
  },
  {
    id: 5,
    name: 'Compliance Check',
    schedule: 'Weekly on Monday',
    lastRun: '3 days ago',
    nextRun: 'Monday at 9:00 AM',
    status: 'active',
    executions: 52,
  },
];

const recentExecutions = [
  { task: 'Weak Signal Sweep', time: '3 min ago', status: 'success', findings: '2 new signals' },
  { task: 'Oracle Pattern Analysis', time: '8 min ago', status: 'success', findings: '1 pattern detected' },
  { task: 'Weak Signal Sweep', time: '18 min ago', status: 'success', findings: '0 new signals' },
  { task: 'Weak Signal Sweep', time: '33 min ago', status: 'success', findings: '1 new signal' },
  { task: 'Readiness Index Calculation', time: '18 hrs ago', status: 'success', findings: 'Score: 84.4%' },
];

export default function ContinuousModePage() {
  const { continuousMode } = useDynamicStrategy();

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-blue-950 p-8">
      <div className="max-w-7xl mx-auto space-y-8">
        {/* Header */}
        <div className="flex items-start justify-between">
          <div>
            <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-600 to-violet-600 bg-clip-text text-transparent mb-2 flex items-center gap-3">
              <Activity className="w-10 h-10 text-blue-600" />
              Continuous Operations Mode
            </h1>
            <p className="text-slate-600 dark:text-slate-400">
              Always-on strategic monitoring, learning, and automated coordination
            </p>
          </div>
          <Button 
            size="lg"
            variant={continuousMode.enabled ? "destructive" : "default"}
            data-testid="button-toggle-continuous"
          >
            {continuousMode.enabled ? (
              <>
                <Pause className="w-5 h-5 mr-2" />
                Pause Operations
              </>
            ) : (
              <>
                <PlayCircle className="w-5 h-5 mr-2" />
                Activate Continuous Mode
              </>
            )}
          </Button>
        </div>

        {/* Status Cards */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <Card className={continuousMode.enabled ? 
            "border-2 border-green-500 dark:border-green-700" : 
            "border-2 border-slate-300 dark:border-slate-700"
          }>
            <CardHeader>
              <CardDescription>System Status</CardDescription>
              <CardTitle className={`text-3xl ${continuousMode.enabled ? "text-green-600" : "text-slate-400"}`}>
                {continuousMode.enabled ? "ACTIVE" : "PAUSED"}
              </CardTitle>
            </CardHeader>
            <CardContent>
              {continuousMode.enabled && (
                <div className="flex items-center gap-2 text-sm text-green-700 dark:text-green-400">
                  <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                  <span>Monitoring in progress</span>
                </div>
              )}
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardDescription>Tasks Scheduled</CardDescription>
              <CardTitle className="text-3xl text-blue-600">{continuousMode.tasksScheduled}</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-sm text-slate-600 dark:text-slate-400">
                Automated operations running
              </p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardDescription>Next Scheduled Run</CardDescription>
              <CardTitle className="text-3xl text-violet-600">
                {continuousMode.nextRun ? new Date(continuousMode.nextRun).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) : '--:--'}
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-sm text-slate-600 dark:text-slate-400">
                {continuousMode.nextRun ? 'Weak Signal Sweep' : 'No tasks scheduled'}
              </p>
            </CardContent>
          </Card>
        </div>

        {/* Scheduled Tasks */}
        <div>
          <h2 className="text-2xl font-bold text-slate-900 dark:text-white mb-4">Scheduled Automation Tasks</h2>
          <div className="space-y-3">
            {scheduledTasks.map((task) => (
              <Card key={task.id} data-testid={`card-task-${task.id}`}>
                <CardContent className="p-6">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-4 flex-1">
                      <div className="bg-blue-100 dark:bg-blue-900 p-3 rounded-lg">
                        <Clock className="w-5 h-5 text-blue-600 dark:text-blue-400" />
                      </div>
                      <div className="flex-1 page-background">
                        <h3 className="font-semibold text-slate-900 dark:text-white mb-1">
                          {task.name}
                        </h3>
                        <div className="flex items-center gap-4 text-sm text-slate-600 dark:text-slate-400">
                          <div className="flex items-center gap-1">
                            <Calendar className="w-4 h-4" />
                            <span>{task.schedule}</span>
                          </div>
                          <span></span>
                          <span>{task.executions} executions</span>
                        </div>
                      </div>
                    </div>
                    <div className="flex items-center gap-6">
                      <div className="text-right">
                        <div className="text-xs text-slate-500 dark:text-slate-500 mb-1">Last run</div>
                        <div className="text-sm font-medium text-slate-700 dark:text-slate-300">
                          {task.lastRun}
                        </div>
                      </div>
                      <div className="text-right">
                        <div className="text-xs text-slate-500 dark:text-slate-500 mb-1">Next run</div>
                        <div className="text-sm font-medium text-slate-700 dark:text-slate-300">
                          {task.nextRun}
                        </div>
                      </div>
                      <Badge variant={task.status === 'active' ? 'default' : 'secondary'}>
                        {task.status}
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </div>

        {/* Recent Execution Log */}
        <div>
          <h2 className="text-2xl font-bold text-slate-900 dark:text-white mb-4">Recent Executions</h2>
          <Card>
            <CardContent className="p-6">
              <div className="space-y-3">
                {recentExecutions.map((execution, index) => (
                  <div 
                    key={index} 
                    className="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg"
                    data-testid={`execution-log-${index}`}
                  >
                    <div className="flex items-center gap-3">
                      <CheckCircle className="w-5 h-5 text-green-600" />
                      <div>
                        <div className="font-medium text-slate-900 dark:text-white">
                          {execution.task}
                        </div>
                        <div className="text-sm text-slate-600 dark:text-slate-400">
                          {execution.findings}
                        </div>
                      </div>
                    </div>
                    <div className="text-sm text-slate-500 dark:text-slate-500">
                      {execution.time}
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Capabilities Overview */}
        <Card className="bg-gradient-to-r from-blue-600 to-violet-600 text-white border-0">
          <CardHeader>
            <CardTitle className="text-2xl">Continuous Mode Capabilities</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <h4 className="font-semibold mb-2 flex items-center gap-2">
                  <Activity className="w-5 h-5" />
                  Always-On Monitoring
                </h4>
                <p className="text-sm text-blue-100">
                  24/7 scanning of intelligence signals for threats and opportunities
                </p>
              </div>
              <div>
                <h4 className="font-semibold mb-2 flex items-center gap-2">
                  <CheckCircle className="w-5 h-5" />
                  Automated Learning
                </h4>
                <p className="text-sm text-blue-100">
                  Self-improving playbooks after every execution
                </p>
              </div>
              <div>
                <h4 className="font-semibold mb-2 flex items-center gap-2">
                  <Clock className="w-5 h-5" />
                  Scheduled Operations
                </h4>
                <p className="text-sm text-blue-100">
                  Automated tasks run on smart schedules optimized for your org
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/CrisisDetail.tsx
========================================
import { useParams } from 'wouter';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { apiRequest } from '@/lib/queryClient';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Separator } from '@/components/ui/separator';
import { useToast } from '@/hooks/use-toast';
import PageLayout from '@/components/layout/PageLayout';
import { Link } from 'wouter';
import { 
  AlertTriangle, 
  Shield, 
  Clock, 
  Users, 
  Phone, 
  Mail, 
  FileText, 
  CheckCircle, 
  AlertCircle, 
  Activity, 
  Target, 
  Zap,
  Building2,
  Globe,
  TrendingUp,
  BarChart3,
  ArrowLeft,
  Calendar,
  DollarSign,
  MessageSquare,
  Settings,
  Play,
  Pause,
  Square,
  RotateCcw,
  ExternalLink,
  Download,
  Share2,
  Bell,
  Eye
} from 'lucide-react';

interface CrisisScenario {
  id: string;
  organizationId: string;
  name: string;
  title: string;
  description: string;
  status: string;
  createdAt: string;
  updatedAt: string;
  createdBy: string;
}

interface Task {
  id: string;
  scenarioId: string;
  description: string;
  priority: string;
  status: string;
  assignedTo: string;
  dueDate: string;
  createdAt: string;
}

export default function CrisisDetail() {
  const params = useParams();
  const crisisId = params.id;
  const { toast } = useToast();
  const queryClient = useQueryClient();

  // Fetch crisis details
  const { data: crisis, isLoading: crisisLoading } = useQuery<CrisisScenario>({
    queryKey: ['/api/scenarios', crisisId],
    enabled: !!crisisId,
  });

  // Fetch related tasks
  const { data: tasksData, isLoading: tasksLoading } = useQuery<Task[]>({
    queryKey: [`/api/tasks?scenarioId=${crisisId}`],
    enabled: !!crisisId,
  });
  const tasks = tasksData ?? [];

  // Fetch organization details
  const { data: organizationsData } = useQuery<any[]>({ 
    queryKey: ['/api/organizations'] 
  });
  const organizations = organizationsData ?? [];
  
  const organization = organizations.find(org => org.id === crisis?.organizationId);

  // Update crisis status mutation
  const updateStatusMutation = useMutation({
    mutationFn: async (newStatus: string) => {
      return apiRequest('PATCH', `/api/scenarios/${crisisId}`, { status: newStatus });
    },
    onSuccess: () => {
      toast({
        title: 'Crisis Status Updated',
        description: 'Crisis response status has been successfully updated.',
      });
      queryClient.invalidateQueries({ queryKey: ['/api/scenarios', crisisId] });
    },
  });

  // Update task status mutation
  const updateTaskMutation = useMutation({
    mutationFn: async ({ taskId, completed }: { taskId: string; completed: boolean }) => {
      const response = await apiRequest('PATCH', `/api/tasks/${taskId}/status`, { completed });
      return response.json();
    },
    onSuccess: () => {
      toast({
        title: 'Task Updated',
        description: 'Task status has been updated successfully.',
      });
      queryClient.invalidateQueries({ queryKey: [`/api/tasks?scenarioId=${crisisId}`] });
    },
    onError: (error) => {
      toast({
        title: 'Error',
        description: 'Failed to update task status. Please try again.',
        variant: 'destructive',
      });
      console.error('Task update error:', error);
    },
  });

  if (crisisLoading) {
    return (
      <PageLayout>
        <div className="flex items-center justify-center h-64">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        </div>
      </PageLayout>
    );
  }

  if (!crisis) {
    return (
      <PageLayout>
        <div className="text-center py-12">
          <AlertTriangle className="h-12 w-12 text-red-500 mx-auto mb-4" />
          <h2 className="text-xl font-semibold mb-2">Crisis Not Found</h2>
          <p className="text-gray-600 mb-4">The requested crisis scenario could not be found.</p>
          <Link href="/crisis">
            <Button variant="outline">
              <ArrowLeft className="w-4 h-4 mr-2" />
              Back to Crisis Management
            </Button>
          </Link>
        </div>
      </PageLayout>
    );
  }

  const getStatusBadgeVariant = (status: string) => {
    switch (status.toLowerCase()) {
      case 'active': return 'destructive';
      case 'monitoring': return 'default';
      case 'resolved': return 'secondary';
      case 'draft': return 'outline';
      default: return 'default';
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority.toLowerCase()) {
      case 'high': return 'text-red-600 bg-red-50 dark:bg-red-900/20';
      case 'medium': return 'text-orange-600 bg-orange-50 dark:bg-orange-900/20';
      case 'low': return 'text-green-600 bg-green-50 dark:bg-green-900/20';
      default: return 'text-gray-600 bg-gray-50 dark:bg-gray-900/20';
    }
  };

  const completedTasks = tasks.filter(task => task.status === 'Completed').length;
  const totalTasks = tasks.length;
  const progressPercentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto" data-testid="crisis-detail-page">
        {/* Header */}
        <div className="bg-gradient-to-r from-red-600 to-orange-600 text-white p-6">
          <div className="max-w-7xl mx-auto">
            <div className="flex items-center justify-between mb-4">
              <Link href="/crisis">
                <Button variant="ghost" className="text-white hover:bg-white/20">
                  <ArrowLeft className="w-4 h-4 mr-2" />
                  Back to Crisis Center
                </Button>
              </Link>
              <div className="flex items-center gap-3">
                <Badge 
                  variant={getStatusBadgeVariant(crisis.status)} 
                  className="bg-white/20 text-white border-white/30"
                >
                  {crisis.status.toUpperCase()}
                </Badge>
                <Button variant="ghost" className="text-white hover:bg-white/20">
                  <Share2 className="w-4 h-4 mr-2" />
                  Share
                </Button>
                <Button variant="ghost" className="text-white hover:bg-white/20">
                  <Download className="w-4 h-4 mr-2" />
                  Export
                </Button>
              </div>
            </div>
            
            <div className="space-y-2">
              <h1 className="text-3xl font-bold">{crisis.title}</h1>
              <p className="text-red-100 text-lg">
                {organization?.name || 'Organization'}  Crisis Response Protocol
              </p>
              <div className="flex items-center gap-4 text-sm text-red-100">
                <div className="flex items-center gap-1">
                  <Calendar className="w-4 h-4" />
                  Created {new Date(crisis.createdAt).toLocaleDateString()}
                </div>
                <div className="flex items-center gap-1">
                  <Clock className="w-4 h-4" />
                  Last updated {new Date(crisis.updatedAt).toLocaleDateString()}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div className="p-6 max-w-7xl mx-auto space-y-6">
          {/* Quick Actions & Progress */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <Card className="lg:col-span-2">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Activity className="h-5 w-5" />
                  Response Progress
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="flex items-center justify-between">
                  <span className="text-sm font-medium">Task Completion</span>
                  <span className="text-sm text-gray-600" data-testid="task-progress-counter">{completedTasks} of {totalTasks} tasks</span>
                </div>
                <Progress value={progressPercentage} className="h-2" />
                
                <div className="grid grid-cols-2 gap-4 mt-6">
                  <div className="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                    <div className="text-2xl font-bold text-blue-600">{totalTasks}</div>
                    <div className="text-sm text-gray-600">Total Tasks</div>
                  </div>
                  <div className="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                    <div className="text-2xl font-bold text-green-600">{completedTasks}</div>
                    <div className="text-sm text-gray-600">Completed</div>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Settings className="h-5 w-5" />
                  Quick Actions
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-3">
                <Button 
                  className="w-full"
                  onClick={() => updateStatusMutation.mutate('active')}
                  disabled={updateStatusMutation.isPending}
                  data-testid="button-activate-crisis"
                >
                  <Play className="w-4 h-4 mr-2" />
                  Activate Response
                </Button>
                <Button 
                  variant="outline" 
                  className="w-full"
                  onClick={() => updateStatusMutation.mutate('monitoring')}
                  disabled={updateStatusMutation.isPending}
                  data-testid="button-monitor-crisis"
                >
                  <Eye className="w-4 h-4 mr-2" />
                  Monitor Situation
                </Button>
                <Button 
                  variant="outline" 
                  className="w-full"
                  onClick={() => updateStatusMutation.mutate('resolved')}
                  disabled={updateStatusMutation.isPending}
                  data-testid="button-resolve-crisis"
                >
                  <CheckCircle className="w-4 h-4 mr-2" />
                  Mark Resolved
                </Button>
                <Separator className="my-3" />
                <Button variant="ghost" className="w-full text-left justify-start">
                  <Bell className="w-4 h-4 mr-2" />
                  Notification Settings
                </Button>
              </CardContent>
            </Card>
          </div>

          {/* Main Content Tabs */}
          <Tabs defaultValue="overview" className="space-y-4">
            <TabsList className="grid w-full grid-cols-4">
              <TabsTrigger value="overview">Overview</TabsTrigger>
              <TabsTrigger value="tasks" data-testid="nav-item-tasks">Tasks ({totalTasks})</TabsTrigger>
              <TabsTrigger value="timeline">Timeline</TabsTrigger>
              <TabsTrigger value="analysis">Analysis</TabsTrigger>
            </TabsList>

            <TabsContent value="overview" className="space-y-6">
              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <FileText className="h-5 w-5" />
                    Crisis Description
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="prose dark:prose-invert max-w-none">
                    <p className="text-gray-700 dark:text-gray-300 leading-relaxed">
                      {crisis.description}
                    </p>
                  </div>
                </CardContent>
              </Card>

              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Building2 className="h-5 w-5" />
                      Organization Details
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div>
                      <div className="text-sm font-medium text-gray-500">Organization</div>
                      <div className="text-lg font-semibold">{organization?.name || 'Unknown'}</div>
                    </div>
                    <div>
                      <div className="text-sm font-medium text-gray-500">Industry</div>
                      <div>{organization?.industry || 'Not specified'}</div>
                    </div>
                    <div>
                      <div className="text-sm font-medium text-gray-500">Size</div>
                      <div>{organization?.size ? `${organization.size} employees` : 'Not specified'}</div>
                    </div>
                    <div>
                      <div className="text-sm font-medium text-gray-500">Location</div>
                      <div>{organization?.headquarters || 'Not specified'}</div>
                    </div>
                  </CardContent>
                </Card>

                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <BarChart3 className="h-5 w-5" />
                      Impact Metrics
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="flex justify-between items-center">
                      <span className="text-sm font-medium">Severity Level</span>
                      <Badge variant="destructive">HIGH</Badge>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm font-medium">Response Time</span>
                      <span className="text-sm">&lt; 2 hours</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm font-medium">Affected Stakeholders</span>
                      <span className="text-sm">Multiple departments</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm font-medium">Est. Financial Impact</span>
                      <span className="text-sm font-semibold text-red-600">$2.4M+</span>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="tasks" className="space-y-4">
              <div className="flex items-center justify-between">
                <h3 className="text-lg font-semibold">Strategic Action Items</h3>
                <div className="text-sm text-gray-600">
                  {completedTasks} of {totalTasks} completed
                </div>
              </div>

              {tasksLoading ? (
                <div className="text-center py-8">
                  <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"></div>
                </div>
              ) : tasks.length === 0 ? (
                <Card>
                  <CardContent className="text-center py-8">
                    <FileText className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                    <h3 className="text-lg font-semibold mb-2">No Tasks Yet</h3>
                    <p className="text-gray-600">Tasks will be created when the crisis response is activated.</p>
                  </CardContent>
                </Card>
              ) : (
                <div className="space-y-3">
                  {tasks.map((task) => (
                    <Card key={task.id} className="hover:shadow-md transition-shadow">
                      <CardContent className="p-4">
                        <div className="flex items-start justify-between">
                          <div className="flex-1 page-background space-y-2">
                            <div className="flex items-center gap-3">
                              <Button
                                variant="ghost"
                                size="sm"
                                className="p-0 h-auto"
                                onClick={() => updateTaskMutation.mutate({
                                  taskId: task.id,
                                  completed: task.status !== 'Completed'
                                })}
                                disabled={updateTaskMutation.isPending}
                                data-testid={`button-toggle-task-${task.id}`}
                              >
                                {task.status === 'Completed' ? (
                                  <CheckCircle className="h-5 w-5 text-green-600" />
                                ) : (
                                  <div className="h-5 w-5 border-2 border-gray-300 rounded-full" />
                                )}
                              </Button>
                              <div className="flex-1 page-background">
                                <p className={`text-sm ${task.status === 'Completed' ? 'line-through text-gray-500' : 'text-gray-900 dark:text-gray-100'}`}>
                                  {task.description}
                                </p>
                              </div>
                            </div>
                            <div className="flex items-center gap-4 text-xs text-gray-500 ml-8">
                              <span className={`px-2 py-1 rounded-full ${getPriorityColor(task.priority)}`}>
                                {task.priority}
                              </span>
                              <span>Due: {new Date(task.dueDate).toLocaleDateString()}</span>
                              <span>Status: {task.status}</span>
                            </div>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                </div>
              )}
            </TabsContent>

            <TabsContent value="timeline" className="space-y-4">
              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <Clock className="h-5 w-5" />
                    Crisis Timeline
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-6">
                    <div className="flex items-start gap-4">
                      <div className="w-2 h-2 bg-blue-600 rounded-full mt-2"></div>
                      <div className="flex-1 page-background">
                        <div className="text-sm font-medium">Crisis Detected</div>
                        <div className="text-xs text-gray-500">{new Date(crisis.createdAt).toLocaleString()}</div>
                        <div className="text-sm text-gray-600 mt-1">Initial crisis scenario created and logged</div>
                      </div>
                    </div>
                    
                    {crisis.status === 'active' && (
                      <div className="flex items-start gap-4">
                        <div className="w-2 h-2 bg-orange-600 rounded-full mt-2"></div>
                        <div className="flex-1 page-background">
                          <div className="text-sm font-medium">Response Activated</div>
                          <div className="text-xs text-gray-500">{new Date().toLocaleString()}</div>
                          <div className="text-sm text-gray-600 mt-1">Emergency response protocols initiated</div>
                        </div>
                      </div>
                    )}

                    {crisis.status === 'resolved' && (
                      <div className="flex items-start gap-4">
                        <div className="w-2 h-2 bg-green-600 rounded-full mt-2"></div>
                        <div className="flex-1 page-background">
                          <div className="text-sm font-medium">Crisis Resolved</div>
                          <div className="text-xs text-gray-500">{new Date(crisis.updatedAt).toLocaleString()}</div>
                          <div className="text-sm text-gray-600 mt-1">All critical tasks completed, situation stabilized</div>
                        </div>
                      </div>
                    )}
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            <TabsContent value="analysis" className="space-y-4">
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <TrendingUp className="h-5 w-5" />
                      Response Performance
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="flex justify-between items-center">
                      <span className="text-sm">Task Completion Rate</span>
                      <span className="font-semibold">{Math.round(progressPercentage)}%</span>
                    </div>
                    <Progress value={progressPercentage} className="h-2" />
                    
                    <div className="pt-4 space-y-3">
                      <div className="flex justify-between">
                        <span className="text-sm text-gray-600">Response Speed</span>
                        <Badge variant="outline">Excellent</Badge>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-sm text-gray-600">Team Coordination</span>
                        <Badge variant="outline">Good</Badge>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-sm text-gray-600">Resource Efficiency</span>
                        <Badge variant="outline">Very Good</Badge>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Target className="h-5 w-5" />
                      Key Insights
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <Alert>
                      <AlertCircle className="h-4 w-4" />
                      <AlertDescription>
                        Crisis response is progressing well with {Math.round(progressPercentage)}% of critical tasks completed.
                      </AlertDescription>
                    </Alert>
                    
                    <div className="space-y-2 text-sm">
                      <div> Executive team alignment achieved</div>
                      <div> Communication protocols established</div>
                      <div> Resource allocation optimized</div>
                      <div> Stakeholder engagement active</div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>
          </Tabs>
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/CrisisExposureMatrix.tsx
========================================
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { AlertTriangle, TrendingUp, Shield, Target, ArrowRight } from 'lucide-react';
import PageLayout from '@/components/layout/PageLayout';
import { Link } from 'wouter';

export default function CrisisExposureMatrix() {
  const { data: organizationsData } = useQuery<any[]>({ 
    queryKey: ['/api/organizations'] 
  });
  const organizations = organizationsData ?? [];
  const organizationId = organizations[0]?.id;

  const { data: scenariosQueryData } = useQuery<any[]>({
    queryKey: ['/api/strategic-scenarios', organizationId],
    enabled: !!organizationId,
  });
  const scenariosData = scenariosQueryData ?? [];

  // Group scenarios by likelihood and impact
  const getQuadrant = (likelihood: number, impact: string) => {
    const likelihoodThreshold = 0.5; // 50%
    const isHighLikelihood = likelihood >= likelihoodThreshold;
    const isHighImpact = impact === 'high' || impact === 'severe';

    if (isHighLikelihood && isHighImpact) return 'critical';
    if (!isHighLikelihood && isHighImpact) return 'important';
    if (isHighLikelihood && !isHighImpact) return 'monitor';
    return 'low';
  };

  const critical = scenariosData.filter(s => getQuadrant(s.likelihood || 0, s.impact) === 'critical');
  const important = scenariosData.filter(s => getQuadrant(s.likelihood || 0, s.impact) === 'important');
  const monitor = scenariosData.filter(s => getQuadrant(s.likelihood || 0, s.impact) === 'monitor');
  const low = scenariosData.filter(s => getQuadrant(s.likelihood || 0, s.impact) === 'low');

  const QuadrantCard = ({ 
    title, 
    description, 
    scenarios, 
    color,
    icon: Icon 
  }: { 
    title: string; 
    description: string; 
    scenarios: any[]; 
    color: string;
    icon: any;
  }) => (
    <Card className={`${color} border-2`} data-testid={`card-${title.toLowerCase().replace(' ', '-')}`}>
      <CardHeader>
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <Icon className="h-5 w-5" />
            <CardTitle className="text-lg">{title}</CardTitle>
          </div>
          <Badge variant="outline" className="text-lg font-bold" data-testid={`badge-count-${title.toLowerCase().replace(' ', '-')}`}>
            {scenarios.length}
          </Badge>
        </div>
        <CardDescription>{description}</CardDescription>
      </CardHeader>
      <CardContent>
        {scenarios.length === 0 ? (
          <p className="text-sm text-muted-foreground italic">No scenarios in this category</p>
        ) : (
          <div className="space-y-2">
            {scenarios.slice(0, 5).map((scenario) => (
              <Link
                key={scenario.id}
                href={`/strategic-monitoring/${scenario.id}`}
                data-testid={`link-scenario-${scenario.id}`}
              >
                <div className="flex items-center justify-between p-2 rounded hover:bg-accent cursor-pointer transition-colors">
                  <div className="flex-1 page-background">
                    <p className="text-sm font-medium">{scenario.title || scenario.name}</p>
                    <p className="text-xs text-muted-foreground">
                      Likelihood: {Math.round((scenario.likelihood || 0) * 100)}% | Impact: {scenario.impact}
                    </p>
                  </div>
                  <ArrowRight className="h-4 w-4 text-muted-foreground" />
                </div>
              </Link>
            ))}
            {scenarios.length > 5 && (
              <p className="text-xs text-muted-foreground text-center pt-2">
                +{scenarios.length - 5} more scenarios
              </p>
            )}
          </div>
        )}
      </CardContent>
    </Card>
  );

  return (
    <PageLayout>
      <div className="p-6 space-y-6" data-testid="crisis-exposure-matrix-page">
        {/* Header */}
        <div>
          <h1 className="text-3xl font-bold mb-2" data-testid="page-title">Crisis Exposure Matrix</h1>
          <p className="text-muted-foreground">
            Prioritize your playbook preparation with our Likelihood  Impact framework. 
            Focus on Critical threats first for fastest time-to-value.
          </p>
        </div>

        {/* Strategy Card */}
        <Card className="bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800">
          <CardHeader>
            <CardTitle className="text-blue-900 dark:text-blue-100">90-Day Onboarding Strategy</CardTitle>
            <CardDescription className="text-blue-700 dark:text-blue-300">
              Don't try to prepare for all 166 playbooks at once. Start with your Top 10 Critical threats.
            </CardDescription>
          </CardHeader>
          <CardContent className="text-blue-900 dark:text-blue-100">
            <div className="space-y-2 text-sm">
              <div className="flex items-start gap-2">
                <div className="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-xs font-bold">1</div>
                <div>
                  <strong>Days 1-30:</strong> Run your Crisis Exposure Matrix workshop with our Crisis Architects
                </div>
              </div>
              <div className="flex items-start gap-2">
                <div className="bg-orange-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-xs font-bold">2</div>
                <div>
                  <strong>Days 31-90:</strong> Get your Top 10 Critical playbooks to 95%+ readiness
                </div>
              </div>
              <div className="flex items-start gap-2">
                <div className="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-xs font-bold">3</div>
                <div>
                  <strong>Ongoing:</strong> Build out remaining playbooks with quarterly readiness sprints
                </div>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* 2x2 Matrix Grid */}
        <div className="grid md:grid-cols-2 gap-6">
          {/* Top Left: High Impact, Low Likelihood */}
          <QuadrantCard
            title="Important"
            description="High Impact, Lower Likelihood - Prepare but don't panic"
            scenarios={important}
            color="bg-orange-50 dark:bg-orange-950/20 border-orange-300 dark:border-orange-800"
            icon={Shield}
          />

          {/* Top Right: High Impact, High Likelihood */}
          <QuadrantCard
            title="Critical Priority"
            description="High Impact, High Likelihood - Your Top 10 for 90-day onboarding"
            scenarios={critical}
            color="bg-red-50 dark:bg-red-950/20 border-red-300 dark:border-red-800"
            icon={AlertTriangle}
          />

          {/* Bottom Left: Low Impact, Low Likelihood */}
          <QuadrantCard
            title="Low Priority"
            description="Lower Impact, Lower Likelihood - Address when ready"
            scenarios={low}
            color="bg-slate-50 dark:bg-slate-900/20 border-slate-200 dark:border-slate-700"
            icon={Target}
          />

          {/* Bottom Right: Low Impact, High Likelihood */}
          <QuadrantCard
            title="Monitor Closely"
            description="Lower Impact, High Likelihood - Quick response playbooks"
            scenarios={monitor}
            color="bg-yellow-50 dark:bg-yellow-950/20 border-yellow-300 dark:border-yellow-800"
            icon={TrendingUp}
          />
        </div>

        {/* Action Items */}
        <Card>
          <CardHeader>
            <CardTitle>Recommended Next Steps</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              <div className="flex items-center justify-between p-4 border rounded-lg" data-testid="card-action-drills">
                <div>
                  <p className="font-medium">Schedule practice drills for your Critical playbooks</p>
                  <p className="text-sm text-muted-foreground">Turn preparedness into proven performance</p>
                </div>
                <Link href="/practice-drills">
                  <Button data-testid="button-schedule-drills">
                    Schedule Drills
                    <ArrowRight className="ml-2 h-4 w-4" />
                  </Button>
                </Link>
              </div>

              <div className="flex items-center justify-between p-4 border rounded-lg" data-testid="card-action-library">
                <div>
                  <p className="font-medium">Review full playbook library</p>
                  <p className="text-sm text-muted-foreground">Explore all 166 strategic playbooks</p>
                </div>
                <Link href="/playbook-library">
                  <Button variant="outline" data-testid="button-view-library">
                    View Library
                    <ArrowRight className="ml-2 h-4 w-4" />
                  </Button>
                </Link>
              </div>

              <div className="flex items-center justify-between p-4 border rounded-lg" data-testid="card-action-preparedness">
                <div>
                  <p className="font-medium">Check your preparedness score</p>
                  <p className="text-sm text-muted-foreground">See your overall crisis readiness rating</p>
                </div>
                <Link href="/preparedness-report">
                  <Button variant="outline" data-testid="button-check-score">
                    View Score
                    <ArrowRight className="ml-2 h-4 w-4" />
                  </Button>
                </Link>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/CrisisResponseCenter.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Alert, AlertDescription } from '@/components/ui/alert';
import PageLayout from '@/components/layout/PageLayout';
import { Link } from 'wouter';
import { useDemoController } from '@/contexts/DemoController';
import { DemoStrategicAlert, DemoActiveStrategicCard } from '@/components/demo/DemoStrategicSimulation';
import { 
  AlertTriangle, 
  Shield, 
  Clock, 
  Users, 
  Phone, 
  Mail, 
  FileText, 
  CheckCircle, 
  AlertCircle, 
  Activity, 
  Target, 
  Zap,
  Building2,
  Globe,
  TrendingUp,
  BarChart3,
  Settings,
  Bell,
  Play,
  Pause,
  Square,
  ArrowLeft,
  Home
} from 'lucide-react';

interface CrisisTemplate {
  id: string;
  name: string;
  category: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  activationTime: string;
  stakeholders: string[];
  resources: string[];
  phases: {
    immediate: string[];
    shortTerm: string[];
    longTerm: string[];
  };
  kpis: string[];
}

interface ActiveCrisis {
  id: string;
  template: string;
  status: 'active' | 'monitoring' | 'resolved';
  severity: string;
  startTime: string;
  currentPhase: string;
  progress: number;
  assignedTeam: string[];
  nextActions: string[];
}

export default function CrisisResponseCenter() {
  const demoController = useDemoController();
  const [activeTab, setActiveTab] = useState('dashboard');
  const [crisisTemplates, setCrisisTemplates] = useState<CrisisTemplate[]>([]);
  const [activeCrises, setActiveCrises] = useState<ActiveCrisis[]>([]);
  const [systemStatus, setSystemStatus] = useState({
    readinessLevel: 95,
    responseTeamsActive: 8,
    protocolsReady: 15,
    lastDrillDate: '2024-02-15'
  });

  useEffect(() => {
    // Load comprehensive crisis response templates
    const templates: CrisisTemplate[] = [
      {
        id: 'supply-chain-disruption',
        name: 'Supply Chain Disruption',
        category: 'Operations',
        severity: 'high',
        description: 'Comprehensive response for major supply chain interruptions affecting production and delivery',
        activationTime: '< 2 hours',
        stakeholders: ['COO', 'Procurement', 'Operations', 'Communications', 'Legal'],
        resources: ['Emergency suppliers', 'Alternative logistics', 'Financial reserves'],
        phases: {
          immediate: ['Assess impact scope', 'Activate emergency suppliers', 'Notify key customers'],
          shortTerm: ['Implement alternative sourcing', 'Adjust production schedules', 'Manage customer expectations'],
          longTerm: ['Review supplier relationships', 'Strengthen resilience', 'Update contingency plans']
        },
        kpis: ['Supply chain recovery time', 'Customer satisfaction', 'Financial impact']
      },
      {
        id: 'cybersecurity-incident',
        name: 'Cybersecurity Incident',
        category: 'Technology',
        severity: 'critical',
        description: 'Immediate response protocols for data breaches, ransomware, or system compromises',
        activationTime: '< 30 minutes',
        stakeholders: ['CISO', 'IT Security', 'Legal', 'Communications', 'CEO'],
        resources: ['Incident response team', 'Forensics experts', 'Legal counsel', 'PR team'],
        phases: {
          immediate: ['Isolate affected systems', 'Assess breach scope', 'Notify authorities'],
          shortTerm: ['Contain threat', 'Begin forensics', 'Prepare communications'],
          longTerm: ['System recovery', 'Security improvements', 'Stakeholder updates']
        },
        kpis: ['Time to containment', 'Data exposure', 'System recovery time']
      },
      {
        id: 'financial-liquidity-crisis',
        name: 'Financial Liquidity Crisis',
        category: 'Finance',
        severity: 'critical',
        description: 'Emergency financial management for cash flow crises and liquidity shortfalls',
        activationTime: '< 4 hours',
        stakeholders: ['CFO', 'Treasury', 'Board', 'Banking Partners', 'Investors'],
        resources: ['Emergency credit lines', 'Asset liquidation', 'Investor relations'],
        phases: {
          immediate: ['Cash position assessment', 'Activate credit facilities', 'Board notification'],
          shortTerm: ['Asset optimization', 'Cost reduction measures', 'Stakeholder communication'],
          longTerm: ['Financial restructuring', 'Strategy adjustment', 'Recovery planning']
        },
        kpis: ['Cash runway', 'Credit utilization', 'Stakeholder confidence']
      },
      {
        id: 'reputation-crisis',
        name: 'Reputation Crisis',
        category: 'Communications',
        severity: 'high',
        description: 'Strategic communication response for negative publicity and reputation threats',
        activationTime: '< 1 hour',
        stakeholders: ['CEO', 'Communications', 'Legal', 'HR', 'Board'],
        resources: ['PR agency', 'Media monitoring', 'Executive spokespeople'],
        phases: {
          immediate: ['Monitor situation', 'Prepare holding statement', 'Executive briefing'],
          shortTerm: ['Public response', 'Stakeholder outreach', 'Media engagement'],
          longTerm: ['Reputation recovery', 'Trust rebuilding', 'Process improvements']
        },
        kpis: ['Media sentiment', 'Stakeholder trust', 'Business impact']
      },
      {
        id: 'pandemic-response',
        name: 'Pandemic Response',
        category: 'Health & Safety',
        severity: 'critical',
        description: 'Comprehensive health crisis management and business continuity protocols',
        activationTime: '< 6 hours',
        stakeholders: ['CEO', 'HR', 'Facilities', 'Operations', 'Legal'],
        resources: ['Health protocols', 'Remote work infrastructure', 'Medical support'],
        phases: {
          immediate: ['Employee safety', 'Workspace protocols', 'Communication plan'],
          shortTerm: ['Remote operations', 'Health monitoring', 'Supply adjustments'],
          longTerm: ['Recovery planning', 'Policy updates', 'Resilience building']
        },
        kpis: ['Employee health', 'Business continuity', 'Recovery timeline']
      },
      {
        id: 'regulatory-compliance',
        name: 'Regulatory Compliance Crisis',
        category: 'Legal',
        severity: 'high',
        description: 'Response to regulatory violations, investigations, or compliance failures',
        activationTime: '< 2 hours',
        stakeholders: ['Chief Legal Officer', 'Compliance', 'CEO', 'Board', 'External Counsel'],
        resources: ['Legal team', 'Compliance experts', 'External counsel', 'Documentation'],
        phases: {
          immediate: ['Violation assessment', 'Legal counsel', 'Authority notification'],
          shortTerm: ['Investigation support', 'Corrective actions', 'Stakeholder updates'],
          longTerm: ['Compliance strengthening', 'Process improvements', 'Monitoring systems']
        },
        kpis: ['Compliance restoration', 'Penalty minimization', 'Relationship recovery']
      }
    ];

    setCrisisTemplates(templates);

    // Mock active crisis for demonstration
    setActiveCrises([
      {
        id: 'cr-001',
        template: 'Supply Chain Disruption',
        status: 'monitoring',
        severity: 'medium',
        startTime: '2024-02-20 14:30',
        currentPhase: 'Short-term Response',
        progress: 65,
        assignedTeam: ['Operations Team', 'Procurement', 'Communications'],
        nextActions: ['Finalize alternative supplier contracts', 'Update delivery schedules', 'Customer communication']
      }
    ]);
  }, []);

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case 'critical': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'high': return 'bg-orange-500/20 text-orange-300 border-orange-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30';
      case 'low': return 'bg-green-500/20 text-green-300 border-green-500/30';
      default: return 'bg-gray-500/20 text-gray-300 border-gray-500/30';
    }
  };

  const getSeverityIcon = (severity: string) => {
    switch (severity) {
      case 'critical': return <AlertTriangle className="h-4 w-4" />;
      case 'high': return <AlertCircle className="h-4 w-4" />;
      case 'medium': return <Clock className="h-4 w-4" />;
      case 'low': return <CheckCircle className="h-4 w-4" />;
      default: return <Activity className="h-4 w-4" />;
    }
  };

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-y-auto p-8 space-y-8" data-testid="crisis-response-center">
        
        {/* Breadcrumb Navigation */}
        <div className="mb-6">
          <div className="flex items-center gap-2 text-sm text-gray-400">
            <Link to="/">
              <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                <Home className="h-4 w-4" />
              </Button>
            </Link>
            <span>/</span>
            <span>Crisis Management</span>
            <span>/</span>
            <span className="text-white">Crisis Response Center</span>
          </div>
        </div>

        {/* Crisis Response Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-white mb-2">Crisis Response Command Center</h1>
            <p className="text-slate-300">Enterprise-grade crisis management with 15+ response protocols</p>
          </div>
          <div className="flex items-center gap-4">
            <Link to="/">
              <Button variant="secondary" className="bg-slate-700 hover:bg-slate-600 text-slate-100 border-slate-600">
                <ArrowLeft className="h-4 w-4 mr-2" />
                Dashboard
              </Button>
            </Link>
            <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">
              <Shield className="w-4 h-4 mr-2" />
              All Systems Ready
            </Badge>
            <Button className="bg-red-600 hover:bg-red-700">
              <AlertTriangle className="w-4 h-4 mr-2" />
              Emergency Activation
            </Button>
          </div>
        </div>

        {/* Demo Crisis Simulation - Only visible during demo mode */}
        <DemoStrategicAlert />
        <DemoActiveStrategicCard />

        {/* System Status Overview */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Readiness Level</h3>
                <Shield className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white mb-2">{systemStatus.readinessLevel}%</div>
              <Progress value={systemStatus.readinessLevel} className="h-2" />
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Response Teams</h3>
                <Users className="h-5 w-5 text-blue-400" />
              </div>
              <div className="text-2xl font-bold text-white mb-2">{systemStatus.responseTeamsActive}</div>
              <div className="text-sm text-slate-400">Teams Active</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Protocols Ready</h3>
                <FileText className="h-5 w-5 text-purple-400" />
              </div>
              <div className="text-2xl font-bold text-white mb-2">{systemStatus.protocolsReady}</div>
              <div className="text-sm text-slate-400">Response Templates</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Last Drill</h3>
                <Clock className="h-5 w-5 text-amber-400" />
              </div>
              <div className="text-2xl font-bold text-white mb-2">8</div>
              <div className="text-sm text-slate-400">days ago</div>
            </CardContent>
          </Card>
        </div>

        {/* Crisis Management Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="bg-slate-800/50 border border-slate-700/50">
            <TabsTrigger value="dashboard" className="data-[state=active]:bg-slate-700">Dashboard</TabsTrigger>
            <TabsTrigger value="templates" className="data-[state=active]:bg-slate-700">Response Templates</TabsTrigger>
            <TabsTrigger value="active" className="data-[state=active]:bg-slate-700">Active Crises</TabsTrigger>
            <TabsTrigger value="protocols" className="data-[state=active]:bg-slate-700">Protocols</TabsTrigger>
            <TabsTrigger value="analytics" className="data-[state=active]:bg-slate-700">Analytics</TabsTrigger>
          </TabsList>

          {/* Dashboard Tab */}
          <TabsContent value="dashboard" className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              {/* Active Situations */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Activity className="h-5 w-5" />
                    Active Situations <span data-testid="crisis-active-counter">({activeCrises.length} Active)</span>
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  {activeCrises.map((crisis) => (
                    <div key={crisis.id} className="p-4 bg-slate-800/50 rounded-lg border border-slate-600/50" data-testid={crisis.template === 'Supply Chain Disruption' ? 'crisis-card-supply-chain' : `crisis-card-${crisis.id}`}>
                      <div className="flex items-center justify-between mb-3">
                        <h4 className="font-semibold text-white">{crisis.template}</h4>
                        <Badge className={getSeverityColor(crisis.severity)}>
                          {getSeverityIcon(crisis.severity)}
                          {crisis.severity.toUpperCase()}
                        </Badge>
                      </div>
                      <div className="space-y-2">
                        <div className="flex justify-between text-sm">
                          <span className="text-slate-400">Progress</span>
                          <span className="text-white">{crisis.progress}%</span>
                        </div>
                        <Progress value={crisis.progress} className="h-2" />
                        <div className="text-xs text-slate-500">Phase: {crisis.currentPhase}</div>
                      </div>
                    </div>
                  ))}
                </CardContent>
              </Card>

              {/* Quick Actions */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Zap className="h-5 w-5" />
                    Emergency Quick Actions
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-3">
                  <Button className="w-full bg-red-600 hover:bg-red-700 justify-start">
                    <AlertTriangle className="w-4 h-4 mr-2" />
                    Activate Crisis Protocol
                  </Button>
                  <Button className="w-full bg-amber-600 hover:bg-amber-700 justify-start">
                    <Users className="w-4 h-4 mr-2" />
                    Assemble Response Team
                  </Button>
                  <Button className="w-full bg-blue-600 hover:bg-blue-700 justify-start">
                    <Phone className="w-4 h-4 mr-2" />
                    Emergency Communications
                  </Button>
                  <Button className="w-full bg-purple-600 hover:bg-purple-700 justify-start">
                    <Bell className="w-4 h-4 mr-2" />
                    Stakeholder Alerts
                  </Button>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Templates Tab */}
          <TabsContent value="templates" className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {crisisTemplates.map((template) => (
                <Card key={template.id} className="bg-slate-900/50 border-slate-700/50 hover:bg-slate-800/50 transition-all duration-300">
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-white text-lg">{template.name}</CardTitle>
                      <Badge className={getSeverityColor(template.severity)}>
                        {getSeverityIcon(template.severity)}
                        {template.severity.toUpperCase()}
                      </Badge>
                    </div>
                    <p className="text-slate-400 text-sm">{template.description}</p>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-400">Category:</span>
                        <span className="text-white">{template.category}</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-400">Activation:</span>
                        <span className="text-white">{template.activationTime}</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-400">Stakeholders:</span>
                        <span className="text-white">{template.stakeholders.length}</span>
                      </div>
                    </div>
                    
                    <div className="flex gap-2">
                      <Button size="sm" className="flex-1 bg-blue-600 hover:bg-blue-700">
                        <FileText className="w-4 h-4 mr-2" />
                        View Details
                      </Button>
                      <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <Play className="w-4 h-4 mr-2" />
                        Activate
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Active Crises Tab */}
          <TabsContent value="active" className="space-y-6">
            {activeCrises.length > 0 ? (
              <div className="space-y-6">
                {activeCrises.map((crisis) => (
                  <Card key={crisis.id} className="bg-slate-900/50 border-slate-700/50">
                    <CardHeader>
                      <div className="flex items-center justify-between">
                        <CardTitle className="text-white">{crisis.template}</CardTitle>
                        <div className="flex items-center gap-3">
                          <Badge className={getSeverityColor(crisis.severity)}>
                            {getSeverityIcon(crisis.severity)}
                            {crisis.severity.toUpperCase()}
                          </Badge>
                          <Badge className="bg-blue-500/20 text-blue-300 border-blue-500/30">
                            {crisis.status.toUpperCase()}
                          </Badge>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent className="space-y-6">
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                          <h4 className="font-semibold text-white mb-2">Timeline</h4>
                          <div className="text-sm space-y-1">
                            <div className="text-slate-400">Started: {crisis.startTime}</div>
                            <div className="text-slate-400">Phase: {crisis.currentPhase}</div>
                            <div className="text-slate-400">Progress: {crisis.progress}%</div>
                          </div>
                        </div>
                        
                        <div>
                          <h4 className="font-semibold text-white mb-2">Assigned Team</h4>
                          <div className="space-y-1">
                            {crisis.assignedTeam.map((team, index) => (
                              <Badge key={index} variant="outline" className="border-slate-600 text-slate-300">
                                {team}
                              </Badge>
                            ))}
                          </div>
                        </div>
                        
                        <div>
                          <h4 className="font-semibold text-white mb-2">Next Actions</h4>
                          <div className="space-y-1">
                            {crisis.nextActions.map((action, index) => (
                              <div key={index} className="text-sm text-slate-300 flex items-center gap-2">
                                <div className="w-2 h-2 bg-amber-400 rounded-full" />
                                {action}
                              </div>
                            ))}
                          </div>
                        </div>
                      </div>
                      
                      <div className="flex gap-3">
                        <Button className="bg-emerald-600 hover:bg-emerald-700">
                          <CheckCircle className="w-4 h-4 mr-2" />
                          Update Status
                        </Button>
                        <Button variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                          <FileText className="w-4 h-4 mr-2" />
                          View Full Report
                        </Button>
                        <Button variant="outline" className="border-red-600 text-red-300 hover:bg-red-900/20">
                          <Square className="w-4 h-4 mr-2" />
                          Escalate
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            ) : (
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-12 text-center">
                  <CheckCircle className="h-16 w-16 text-emerald-400 mx-auto mb-4" />
                  <h3 className="text-xl font-bold text-white mb-2">No Active Crises</h3>
                  <p className="text-slate-400">All systems operational. Crisis response protocols ready.</p>
                </CardContent>
              </Card>
            )}
          </TabsContent>

          {/* Protocols Tab */}
          <TabsContent value="protocols" className="space-y-6">
            <Alert className="border-amber-500/30 bg-amber-500/10">
              <AlertTriangle className="h-4 w-4" />
              <AlertDescription className="text-amber-200">
                Crisis response protocols are regularly updated based on industry best practices and regulatory requirements.
              </AlertDescription>
            </Alert>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white">Communication Protocols</CardTitle>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <span className="text-white">Emergency Notification Chain</span>
                    <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">ACTIVE</Badge>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <span className="text-white">Media Response Guidelines</span>
                    <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">ACTIVE</Badge>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <span className="text-white">Stakeholder Updates</span>
                    <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">ACTIVE</Badge>
                  </div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white">Response Procedures</CardTitle>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <span className="text-white">Incident Assessment</span>
                    <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">READY</Badge>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <span className="text-white">Resource Mobilization</span>
                    <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">READY</Badge>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <span className="text-white">Recovery Planning</span>
                    <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">READY</Badge>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Analytics Tab */}
          <TabsContent value="analytics" className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Response Time</h3>
                    <Clock className="h-5 w-5 text-blue-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">12 min</div>
                  <div className="text-sm text-slate-400">Average activation</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Recovery Rate</h3>
                    <TrendingUp className="h-5 w-5 text-emerald-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">96%</div>
                  <div className="text-sm text-slate-400">Successful resolution</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Team Readiness</h3>
                    <Users className="h-5 w-5 text-purple-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">100%</div>
                  <div className="text-sm text-slate-400">Teams certified</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Drills Completed</h3>
                    <BarChart3 className="h-5 w-5 text-amber-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">24</div>
                  <div className="text-sm text-slate-400">This quarter</div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/CrisisResponse.tsx
========================================
import { useToast } from "@/hooks/use-toast";
import PageLayout from '@/components/layout/PageLayout';
import CrisisResponseDashboard from "@/components/CrisisResponseDashboard";
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { Badge } from "@/components/ui/badge";
import { AlertTriangle, Shield, Activity, Clock } from "lucide-react";

export default function CrisisResponse() {
  const { toast } = useToast();
  
  // Fetch organizations to get the correct organization ID
  const { data: organizationsData } = useQuery<any[]>({ queryKey: ['/api/organizations'] });
  const organizations = organizationsData ?? [];
  const organizationId = organizations[0]?.id || '95b97862-8e9d-4c4c-8609-7d8f37b68d36'; // fallback to known UUID

  // Full access to crisis response platform

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto" data-testid="crisis-response-page">
        <div className="bg-gradient-to-r from-red-600 to-orange-600 text-white p-8">
          <div className="max-w-7xl mx-auto">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-4xl font-bold mb-2">Crisis Response Center</h1>
                <p className="text-red-100 text-lg">Immediate response protocols and emergency management systems</p>
              </div>
              <div className="text-right">
                <div className="flex items-center gap-2 mb-2">
                  <div className="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                  <Badge variant="secondary" className="bg-white/20 text-white">OPERATIONAL</Badge>
                </div>
                <div className="text-red-100">24/7 Crisis Monitoring Active</div>
              </div>
            </div>
          </div>
        </div>

        <div className="p-6 max-w-7xl mx-auto space-y-6">
          {/* Crisis Status Overview */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <Card className="border-green-200 bg-green-50 dark:bg-green-900/20" data-testid="readiness-status">
              <CardHeader className="pb-2">
                <CardTitle className="text-sm flex items-center gap-2 text-green-800 dark:text-green-200">
                  <Shield className="h-4 w-4" />
                  Readiness Status
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-2xl font-bold text-green-700 dark:text-green-300">98%</div>
                <div className="text-xs text-green-600 dark:text-green-400">Crisis Prepared</div>
              </CardContent>
            </Card>

            <Card className="border-blue-200 bg-blue-50 dark:bg-blue-900/20" data-testid="response-time">
              <CardHeader className="pb-2">
                <CardTitle className="text-sm flex items-center gap-2 text-blue-800 dark:text-blue-200">
                  <Clock className="h-4 w-4" />
                  Response Time
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-2xl font-bold text-blue-700 dark:text-blue-300">&lt;1hr</div>
                <div className="text-xs text-blue-600 dark:text-blue-400">Average Activation</div>
              </CardContent>
            </Card>

            <Card className="border-purple-200 bg-purple-50 dark:bg-purple-900/20" data-testid="templates-ready">
              <CardHeader className="pb-2">
                <CardTitle className="text-sm flex items-center gap-2 text-purple-800 dark:text-purple-200">
                  <Activity className="h-4 w-4" />
                  Templates Ready
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-2xl font-bold text-purple-700 dark:text-purple-300">15+</div>
                <div className="text-xs text-purple-600 dark:text-purple-400">Crisis Scenarios</div>
              </CardContent>
            </Card>

            <Card className="border-orange-200 bg-orange-50 dark:bg-orange-900/20" data-testid="monitoring-status">
              <CardHeader className="pb-2">
                <CardTitle className="text-sm flex items-center gap-2 text-orange-800 dark:text-orange-200">
                  <AlertTriangle className="h-4 w-4" />
                  Monitoring
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-2xl font-bold text-orange-700 dark:text-orange-300">24/7</div>
                <div className="text-xs text-orange-600 dark:text-orange-400">Active Surveillance</div>
              </CardContent>
            </Card>
          </div>

          {/* Crisis Response Dashboard */}
          <CrisisResponseDashboard organizationId={organizationId} />
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/CustomerDemo.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { 
  Play, 
  Pause, 
  RotateCcw, 
  Clock, 
  Users, 
  CheckCircle2, 
  AlertTriangle,
  Zap,
  ArrowRight,
  Target,
  Shield,
  TrendingUp,
  DollarSign,
  SkipForward,
  ChevronRight,
  BookOpen,
  FileCheck,
  Radar,
  Settings,
  Globe,
  Scale,
  Building2,
  Briefcase,
  UserCheck,
  GitBranch,
  Layers,
  Brain,
  Award,
  Timer
} from 'lucide-react';
import { useLocation } from 'wouter';
import StandardNav from '@/components/layout/StandardNav';
import Footer from '@/components/layout/Footer';
import { motion, AnimatePresence } from 'framer-motion';
import Confetti from 'react-confetti';

const DEMO_DURATION = 180;

const IDEA_STORY = [
  {
    id: 1,
    beat: "THE PROBLEM",
    title: "When Strategic Events Hit, Teams Scramble",
    subtitle: "20-50 hours lost just getting organized",
    phase: "PROBLEM",
    phaseColor: "bg-red-500",
    icon: AlertTriangle,
    color: "text-red-400",
    bgColor: "bg-red-500/20",
    time: 0,
    description: "A ransomware attack hits at 2 AM. A competitor announces a major acquisition. A regulatory change requires immediate response. In each case, your team spends the first 20-50 hours figuring out who does what, what documents exist, and what budgets are available.",
    roleWins: [
      { role: "CEO", benefit: "Stop waking up to chaosknow your team has a plan" },
      { role: "COO", benefit: "Eliminate the 'who owns this?' confusion" },
      { role: "CSO", benefit: "Execute strategy faster than competitors can react" }
    ],
    metrics: [
      { label: "Time Lost", value: "20-50 hrs" },
      { label: "Cost per Event", value: "$10K-25K" },
      { label: "Value at Risk", value: "$500K-2M" }
    ],
    smartDefaults: null
  },
  {
    id: 2,
    beat: "IDENTIFY",
    title: "Your Playbooks Are Ready Before You Need Them",
    subtitle: "166 templates customized for your organization",
    phase: "IDENTIFY",
    phaseColor: "bg-violet-500",
    icon: BookOpen,
    color: "text-violet-400",
    bgColor: "bg-violet-500/20",
    time: 30,
    description: "M comes with 166 playbooks across 9 domainsfrom cyber incidents to M&A integration to product launches. Each one pre-configured with smart defaults for your industry. You customize once, then it's ready for instant activation.",
    roleWins: [
      { role: "CISO", benefit: "Cyber playbooks with ISO 27001, SOC2, NIST pre-loaded" },
      { role: "CFO", benefit: "Pre-approved budgets already staged for each scenario" },
      { role: "General Counsel", benefit: "Legal holds, regulatory notifications pre-staged" }
    ],
    metrics: [
      { label: "Ready Playbooks", value: "166" },
      { label: "Domains Covered", value: "9" },
      { label: "Setup Time", value: "2 hours" }
    ],
    smartDefaults: {
      title: "Your Industry, Pre-Configured",
      items: [
        { domain: "Gaming & Hospitality", defaults: "Gaming Commission notifications, patron privacy protocols" },
        { domain: "Healthcare", defaults: "HIPAA breach procedures, patient notification workflows" },
        { domain: "Financial Services", defaults: "SEC/FINRA reporting, customer communication holds" }
      ]
    }
  },
  {
    id: 3,
    beat: "DETECT",
    title: "AI Watches. You Approve.",
    subtitle: "Never miss a signal that matters",
    phase: "DETECT",
    phaseColor: "bg-blue-500",
    icon: Radar,
    color: "text-blue-400",
    bgColor: "bg-blue-500/20",
    time: 60,
    description: "M's AI monitors competitive intelligence, regulatory filings, supply chain signals, and internal alerts. When it detects something relevant, it recommends the right playbook. You stay in controlAI recommends, you decide.",
    roleWins: [
      { role: "Chief Strategy Officer", benefit: "Competitive moves flagged before they hit the news" },
      { role: "VP Supply Chain", benefit: "Supplier issues detected before they become crises" },
      { role: "CISO", benefit: "Threat patterns matched to response playbooks" }
    ],
    metrics: [
      { label: "Signals Analyzed", value: "24/7" },
      { label: "Match Confidence", value: "94%" },
      { label: "False Positives", value: "<5%" }
    ],
    smartDefaults: null
  },
  {
    id: 4,
    beat: "EXECUTE",
    title: "One Click. 12 Minutes. Everyone Aligned.",
    subtitle: "M handles the coordination so you handle the crisis",
    phase: "EXECUTE",
    phaseColor: "bg-emerald-500",
    icon: Zap,
    color: "text-emerald-400",
    bgColor: "bg-emerald-500/20",
    time: 100,
    description: "When you activate a playbook, M instantly notifies all stakeholders, creates tasks in your existing PM tools (Jira, Asana, etc.), stages all documents, and unlocks pre-approved budgets. Your team sees their role-specific dashboardthey know exactly what to do.",
    roleWins: [
      { role: "CEO", benefit: "Board notification happens automatically at thresholds" },
      { role: "COO", benefit: "See all 47 stakeholders acknowledge in real-time" },
      { role: "CTO", benefit: "Technical tasks appear in Jira with full context" }
    ],
    metrics: [
      { label: "Time to Align", value: "12 min" },
      { label: "vs. Traditional", value: "72 hrs" },
      { label: "Faster", value: "360x" }
    ],
    smartDefaults: {
      title: "What Happens in 12 Minutes",
      items: [
        { domain: "Stakeholders", defaults: "47 executives notified, acknowledgments tracked" },
        { domain: "Tasks", defaults: "127 tasks created in Jira with acceptance criteria" },
        { domain: "Budgets", defaults: "$2.5M pre-approved spend unlocked" }
      ]
    }
  },
  {
    id: 5,
    beat: "ADVANCE",
    title: "Every Execution Makes You Stronger",
    subtitle: "Institutional learning that stays with the company",
    phase: "ADVANCE",
    phaseColor: "bg-amber-500",
    icon: Brain,
    color: "text-amber-400",
    bgColor: "bg-amber-500/20",
    time: 150,
    description: "After each execution, M captures what worked, what didn't, and suggests improvements. This knowledge stays with your organizationnot in the head of the executive who might leave. Your playbooks get better every time.",
    roleWins: [
      { role: "CEO", benefit: "Institutional knowledge survives leadership changes" },
      { role: "COO", benefit: "Process improvements captured automatically" },
      { role: "CHRO", benefit: "Onboarding new leaders is faster with documented playbooks" }
    ],
    metrics: [
      { label: "Lessons Captured", value: "Automatic" },
      { label: "Playbook Updates", value: "Suggested" },
      { label: "Next Execution", value: "15% faster" }
    ],
    smartDefaults: null
  }
];

const STAKEHOLDER_ACKNOWLEDGMENTS = [
  { name: "Sarah Chen", role: "Chief Information Security Officer", time: 105 },
  { name: "Michael Rodriguez", role: "VP Infrastructure", time: 108 },
  { name: "Jennifer Park", role: "General Counsel", time: 112 },
  { name: "David Thompson", role: "Chief Communications Officer", time: 115 },
  { name: "Lisa Wang", role: "VP Human Resources", time: 118 },
  { name: "Robert Kim", role: "Chief Financial Officer", time: 122 },
  { name: "Amanda Foster", role: "VP Customer Success", time: 128 },
  { name: "James Mitchell", role: "Chief Operating Officer", time: 135 },
];

const VALUE_RECOVERED = [
  { icon: Timer, title: "Executive Time", value: "50+ hours", description: "per major event" },
  { icon: DollarSign, title: "Planning Cost", value: "$10K-25K", description: "eliminated" },
  { icon: Shield, title: "Value Protected", value: "$500K-2M", description: "per event" },
  { icon: Award, title: "Response Speed", value: "360x", description: "faster than industry" }
];

export default function CustomerDemo() {
  const [, setLocation] = useLocation();
  const [isPlaying, setIsPlaying] = useState(false);
  const [elapsedTime, setElapsedTime] = useState(0);
  const [currentStageIndex, setCurrentStageIndex] = useState(0);
  const [acknowledgedStakeholders, setAcknowledgedStakeholders] = useState<typeof STAKEHOLDER_ACKNOWLEDGMENTS>([]);
  const [showConfetti, setShowConfetti] = useState(false);
  const [isComplete, setIsComplete] = useState(false);
  const [playbackSpeed, setPlaybackSpeed] = useState(1);
  const [manualMode, setManualMode] = useState(true);

  useEffect(() => {
    if (!isPlaying || manualMode) return;

    const interval = setInterval(() => {
      setElapsedTime(prev => {
        const next = prev + playbackSpeed;
        
        const nextStageIndex = IDEA_STORY.findIndex(s => s.time > next);
        if (nextStageIndex > 0) {
          setCurrentStageIndex(nextStageIndex - 1);
        } else if (nextStageIndex === -1) {
          setCurrentStageIndex(IDEA_STORY.length - 1);
        }
        
        const newAcks = STAKEHOLDER_ACKNOWLEDGMENTS.filter(s => s.time <= next && s.time > prev);
        if (newAcks.length > 0) {
          setAcknowledgedStakeholders(current => [...current, ...newAcks]);
        }
        
        if (next >= DEMO_DURATION) {
          setIsPlaying(false);
          setShowConfetti(true);
          setIsComplete(true);
          setTimeout(() => setShowConfetti(false), 5000);
        }
        
        return next;
      });
    }, 2500);

    return () => clearInterval(interval);
  }, [isPlaying, playbackSpeed, manualMode]);

  const handleNextStage = () => {
    if (currentStageIndex < IDEA_STORY.length - 1) {
      const nextIndex = currentStageIndex + 1;
      setCurrentStageIndex(nextIndex);
      setElapsedTime(IDEA_STORY[nextIndex].time);
      const newAcks = STAKEHOLDER_ACKNOWLEDGMENTS.filter(s => s.time <= IDEA_STORY[nextIndex].time);
      setAcknowledgedStakeholders(newAcks);
      
      if (nextIndex === IDEA_STORY.length - 1) {
        setIsComplete(true);
        setShowConfetti(true);
        setTimeout(() => setShowConfetti(false), 5000);
      }
    }
  };

  const handlePrevStage = () => {
    if (currentStageIndex > 0) {
      const prevIndex = currentStageIndex - 1;
      setCurrentStageIndex(prevIndex);
      setElapsedTime(IDEA_STORY[prevIndex].time);
      const newAcks = STAKEHOLDER_ACKNOWLEDGMENTS.filter(s => s.time <= IDEA_STORY[prevIndex].time);
      setAcknowledgedStakeholders(newAcks);
      setIsComplete(false);
    }
  };

  const handleReset = () => {
    setIsPlaying(false);
    setElapsedTime(0);
    setCurrentStageIndex(0);
    setAcknowledgedStakeholders([]);
    setShowConfetti(false);
    setIsComplete(false);
    setPlaybackSpeed(1);
  };

  const currentStage = IDEA_STORY[currentStageIndex];
  const progress = ((currentStageIndex + 1) / IDEA_STORY.length) * 100;
  const StageIcon = currentStage.icon;

  return (
    <div className="min-h-screen bg-slate-950 flex flex-col">
      <StandardNav />
      
      {showConfetti && <Confetti recycle={false} numberOfPieces={200} />}
      
      <main className="flex-1 py-8">
        <div className="max-w-6xl mx-auto px-6">
          <div className="text-center mb-6">
            <Badge className="bg-blue-500 text-white mb-3">
              Executive Demo  Execution Confidence
            </Badge>
            <h1 className="text-3xl md:text-4xl font-bold text-white mb-2" data-testid="heading-customer-demo">
              Execute Strategy at the Speed of Disruption
            </h1>
            <p className="text-lg text-slate-400">
              From strategic event to coordinated response in 12 minutes. Success favors the prepared.
            </p>
          </div>

          {/* Playback Controls */}
          <Card className="bg-slate-900/80 border-slate-700 mb-6">
            <CardContent className="p-4">
              <div className="flex items-center justify-between flex-wrap gap-4">
                <div className="flex items-center gap-3">
                  {!isPlaying ? (
                    <Button
                      onClick={() => { setManualMode(false); setIsPlaying(true); }}
                      className="bg-emerald-600 hover:bg-emerald-700"
                      data-testid="button-play-demo"
                    >
                      <Play className="h-4 w-4 mr-2" />
                      {elapsedTime > 0 ? 'Resume' : 'Auto Play'}
                    </Button>
                  ) : (
                    <Button
                      onClick={() => setIsPlaying(false)}
                      variant="outline"
                      className="border-slate-600"
                      data-testid="button-pause-demo"
                    >
                      <Pause className="h-4 w-4 mr-2" />
                      Pause
                    </Button>
                  )}
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={() => { setManualMode(true); setIsPlaying(false); }}
                    className={`text-sm ${manualMode ? 'text-emerald-400' : 'text-slate-400'}`}
                    data-testid="button-manual-mode"
                  >
                    Manual Mode
                  </Button>
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={handleReset}
                    className="text-slate-400"
                    data-testid="button-reset-demo"
                  >
                    <RotateCcw className="h-4 w-4" />
                  </Button>
                </div>
                
                <div className="flex items-center gap-4">
                  <div className="flex items-center gap-2">
                    <span className="text-xs text-slate-500">Speed:</span>
                    {[1, 2, 4].map((speed) => (
                      <Button
                        key={speed}
                        variant="ghost"
                        size="sm"
                        onClick={() => setPlaybackSpeed(speed)}
                        className={`text-xs px-2 ${playbackSpeed === speed ? 'text-emerald-400 bg-emerald-500/20' : 'text-slate-400'}`}
                        data-testid={`button-speed-${speed}x`}
                      >
                        {speed}x
                      </Button>
                    ))}
                  </div>
                  
                  <div className="flex items-center gap-2 bg-slate-800/50 px-3 py-1.5 rounded-lg">
                    <Clock className="h-4 w-4 text-slate-400" />
                    <span className="text-white font-mono text-sm">
                      {Math.floor(elapsedTime / 60)}:{(elapsedTime % 60).toString().padStart(2, '0')}
                    </span>
                    <span className="text-slate-500 text-xs">/ 3:00</span>
                  </div>
                </div>
              </div>
              <Progress value={(elapsedTime / DEMO_DURATION) * 100} className="h-1 mt-3" />
            </CardContent>
          </Card>

          {/* Story Beat Navigation */}
          <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
            {IDEA_STORY.map((stage, idx) => (
              <button
                key={stage.id}
                onClick={() => {
                  setCurrentStageIndex(idx);
                  setElapsedTime(stage.time);
                  const newAcks = STAKEHOLDER_ACKNOWLEDGMENTS.filter(s => s.time <= stage.time);
                  setAcknowledgedStakeholders(newAcks);
                  setIsComplete(idx === IDEA_STORY.length - 1);
                }}
                className={`flex-shrink-0 px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                  idx === currentStageIndex
                    ? `${stage.phaseColor} text-white`
                    : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                }`}
                data-testid={`button-stage-${idx}`}
              >
                {stage.beat}
              </button>
            ))}
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-2 space-y-6">
              <Card className="bg-slate-900 border-slate-700">
                <CardHeader className="border-b border-slate-700 pb-4">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <Badge className={`${currentStage.phaseColor} text-white`}>
                        {currentStage.phase}
                      </Badge>
                      <span className="text-slate-400 text-sm">
                        {currentStage.beat}  {currentStageIndex + 1} of {IDEA_STORY.length}
                      </span>
                    </div>
                    {manualMode && (
                      <div className="flex items-center gap-2">
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={handlePrevStage}
                          disabled={currentStageIndex === 0}
                          className="text-slate-400"
                          data-testid="button-prev-stage"
                        >
                           Back
                        </Button>
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => {
                            setElapsedTime(DEMO_DURATION);
                            setCurrentStageIndex(IDEA_STORY.length - 1);
                            setAcknowledgedStakeholders(STAKEHOLDER_ACKNOWLEDGMENTS);
                            setIsComplete(true);
                            setShowConfetti(true);
                            setTimeout(() => setShowConfetti(false), 5000);
                          }}
                          className="text-slate-400"
                          data-testid="button-skip-to-end"
                        >
                          <SkipForward className="h-4 w-4 mr-1" />
                          Skip
                        </Button>
                      </div>
                    )}
                  </div>
                  <Progress value={progress} className="h-1 mt-4" />
                </CardHeader>
                
                <CardContent className="p-6">
                  <AnimatePresence mode="wait">
                    <motion.div
                      key={currentStage.id}
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      exit={{ opacity: 0, y: -20 }}
                      transition={{ duration: 0.3 }}
                    >
                      <div className="flex items-start gap-4 mb-6">
                        <div className={`p-4 rounded-xl ${currentStage.bgColor}`}>
                          <StageIcon className={`h-8 w-8 ${currentStage.color}`} />
                        </div>
                        <div className="flex-1">
                          <h2 className="text-2xl font-bold text-white mb-1">
                            {currentStage.title}
                          </h2>
                          <p className={`text-lg ${currentStage.color} mb-3`}>
                            {currentStage.subtitle}
                          </p>
                          <p className="text-slate-400 leading-relaxed">
                            {currentStage.description}
                          </p>
                        </div>
                      </div>
                      
                      <div className="grid grid-cols-3 gap-4 mb-6">
                        {currentStage.metrics.map((metric, idx) => (
                          <div key={idx} className="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div className="text-2xl font-bold text-white mb-1">{metric.value}</div>
                            <div className="text-xs text-slate-400">{metric.label}</div>
                          </div>
                        ))}
                      </div>

                      {/* Role-Specific Wins */}
                      <div className="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 mb-4">
                        <div className="flex items-center gap-2 mb-3">
                          <UserCheck className="h-4 w-4 text-blue-400" />
                          <span className="font-medium text-white">What This Means For You</span>
                        </div>
                        <div className="space-y-2">
                          {currentStage.roleWins.map((win, idx) => (
                            <div key={idx} className="flex items-start gap-2 text-sm">
                              <Badge variant="outline" className="text-xs border-blue-500/50 text-blue-300 flex-shrink-0">
                                {win.role}
                              </Badge>
                              <span className="text-slate-300">{win.benefit}</span>
                            </div>
                          ))}
                        </div>
                      </div>

                      {/* Smart Defaults Panel */}
                      {currentStage.smartDefaults && (
                        <div className="bg-slate-800/50 rounded-lg p-4 mb-4">
                          <div className="flex items-center gap-2 mb-3">
                            <Settings className="h-4 w-4 text-violet-400" />
                            <span className="font-medium text-white">{currentStage.smartDefaults.title}</span>
                          </div>
                          <div className="space-y-2">
                            {currentStage.smartDefaults.items.map((item, idx) => (
                              <div key={idx} className="flex items-start gap-2 text-sm">
                                <CheckCircle2 className="h-4 w-4 text-emerald-400 mt-0.5 flex-shrink-0" />
                                <div>
                                  <span className="text-white">{item.domain}:</span>{' '}
                                  <span className="text-slate-400">{item.defaults}</span>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                      
                      {!isComplete ? (
                        <Button
                          onClick={handleNextStage}
                          className="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-6 text-lg"
                          data-testid="button-next-stage"
                        >
                          {currentStageIndex === IDEA_STORY.length - 2 ? 'See the Result' : 'Continue'}
                          <ArrowRight className="ml-2 h-5 w-5" />
                        </Button>
                      ) : (
                        <div className="space-y-4">
                          <div className="bg-emerald-900/30 border border-emerald-500/30 rounded-lg p-4 text-center">
                            <CheckCircle2 className="h-8 w-8 text-emerald-400 mx-auto mb-2" />
                            <p className="text-emerald-400 font-medium text-lg">Success Favors the Prepared</p>
                            <p className="text-slate-400 text-sm">From signal to coordinated action: 12 minutes vs 72 hours</p>
                          </div>
                          
                          {/* Pilot Program Options */}
                          <div className="bg-slate-800/50 rounded-lg p-4">
                            <p className="text-white font-medium mb-3">Start With a Pilot</p>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                              <div className="p-3 bg-slate-700/50 rounded-lg border border-slate-600">
                                <div className="text-sm font-medium text-white mb-1">90-Day POC</div>
                                <div className="text-xs text-slate-400 mb-2">Single domain, 20 playbooks</div>
                                <div className="text-emerald-400 text-sm font-medium">$125K</div>
                              </div>
                              <div className="p-3 bg-slate-700/50 rounded-lg border border-slate-600">
                                <div className="text-sm font-medium text-white mb-1">Domain Pilot</div>
                                <div className="text-xs text-slate-400 mb-2">Full domain, 3 executions</div>
                                <div className="text-emerald-400 text-sm font-medium">$250K</div>
                              </div>
                              <div className="p-3 bg-violet-900/30 rounded-lg border border-violet-500/30">
                                <div className="text-sm font-medium text-white mb-1">Enterprise</div>
                                <div className="text-xs text-slate-400 mb-2">All 166 playbooks</div>
                                <div className="text-violet-400 text-sm font-medium">$500K</div>
                              </div>
                            </div>
                          </div>
                          
                          <div className="flex gap-3">
                            <Button
                              onClick={() => setLocation('/contact')}
                              className="flex-1 bg-emerald-600 hover:bg-emerald-700"
                              data-testid="button-schedule-pilot"
                            >
                              <Target className="mr-2 h-4 w-4" />
                              Schedule a Conversation
                            </Button>
                            <Button
                              onClick={() => setLocation('/playbook-library')}
                              variant="outline"
                              className="flex-1 border-slate-600 text-slate-300"
                              data-testid="button-explore-playbooks"
                            >
                              <BookOpen className="mr-2 h-4 w-4" />
                              Explore Playbooks
                            </Button>
                          </div>
                        </div>
                      )}
                    </motion.div>
                  </AnimatePresence>
                </CardContent>
              </Card>
            </div>

            <div className="space-y-6">
              {/* Value Recovered */}
              <Card className="bg-gradient-to-br from-emerald-900/40 to-slate-900 border-emerald-500/30">
                <CardHeader className="pb-3">
                  <CardTitle className="text-lg text-white flex items-center gap-2">
                    <TrendingUp className="h-5 w-5 text-emerald-400" />
                    Value Recovered Per Event
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    {VALUE_RECOVERED.map((item, idx) => (
                      <div key={idx} className="flex items-start gap-3">
                        <div className="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
                          <item.icon className="h-4 w-4 text-emerald-400" />
                        </div>
                        <div>
                          <div className="text-sm font-medium text-white">{item.title}: <span className="text-emerald-400">{item.value}</span></div>
                          <div className="text-xs text-slate-400">{item.description}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </CardContent>
              </Card>

              {/* Stakeholder Response - only show during EXECUTE */}
              {currentStageIndex >= 3 && (
                <Card className="bg-slate-900 border-slate-700">
                  <CardHeader className="pb-3">
                    <CardTitle className="text-lg text-white flex items-center gap-2">
                      <Users className="h-5 w-5 text-blue-400" />
                      Live Stakeholder Response
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-2 max-h-48 overflow-y-auto">
                      {STAKEHOLDER_ACKNOWLEDGMENTS.map((stakeholder, idx) => {
                        const isAcknowledged = acknowledgedStakeholders.some(s => s.name === stakeholder.name);
                        return (
                          <div 
                            key={idx}
                            className={`p-2 rounded-lg flex items-center gap-2 transition-all ${
                              isAcknowledged ? 'bg-emerald-900/30' : 'bg-slate-800/30'
                            }`}
                          >
                            <div className={`w-2 h-2 rounded-full ${isAcknowledged ? 'bg-emerald-400' : 'bg-slate-600'}`} />
                            <div className="flex-1 min-w-0">
                              <div className="text-sm font-medium text-white truncate">{stakeholder.name}</div>
                              <div className="text-xs text-slate-400 truncate">{stakeholder.role}</div>
                            </div>
                            {isAcknowledged && <CheckCircle2 className="h-4 w-4 text-emerald-400 flex-shrink-0" />}
                          </div>
                        );
                      })}
                    </div>
                    <div className="mt-3 pt-3 border-t border-slate-700">
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-400">Acknowledged</span>
                        <span className="text-white font-medium">{acknowledgedStakeholders.length} / {STAKEHOLDER_ACKNOWLEDGMENTS.length}</span>
                      </div>
                      <Progress value={(acknowledgedStakeholders.length / STAKEHOLDER_ACKNOWLEDGMENTS.length) * 100} className="h-2 mt-2" />
                    </div>
                  </CardContent>
                </Card>
              )}

              {/* Pilot Options */}
              <Card className="bg-slate-900 border-slate-700">
                <CardHeader className="pb-3">
                  <CardTitle className="text-lg text-white flex items-center gap-2">
                    <Target className="h-5 w-5 text-violet-400" />
                    Start With a Pilot
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="p-3 bg-slate-800/50 rounded-lg">
                      <div className="text-sm font-medium text-white mb-1">90-Day Proof of Concept</div>
                      <div className="text-xs text-slate-400">Single domain, 20 playbooks, 1 live execution</div>
                    </div>
                    <div className="p-3 bg-slate-800/50 rounded-lg">
                      <div className="text-sm font-medium text-white mb-1">Domain Pilot</div>
                      <div className="text-xs text-slate-400">Full domain, all playbooks, 3 live executions</div>
                    </div>
                    <div className="p-3 bg-violet-900/30 border border-violet-500/30 rounded-lg">
                      <div className="text-sm font-medium text-white mb-1">Enterprise Pilot</div>
                      <div className="text-xs text-slate-400">All 166 playbooks, dedicated success manager</div>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
          </div>
        </div>
      </main>
      
      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/Dashboard.tsx
========================================
import { useEffect } from "react";
import { useQuery } from '@tanstack/react-query';
import { useWebSocket } from "@/hooks/useWebSocket";
import { updatePageMetadata } from "@/lib/seo";
import PageLayout from '@/components/layout/PageLayout';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { 
  Shield, 
  Zap, 
  Target, 
  Radio, 
  Brain,
  ChevronRight,
  Activity,
  AlertTriangle,
  CheckCircle,
  Clock,
  TrendingUp
} from 'lucide-react';
import { Link } from 'wouter';
import { useDynamicStrategy } from '@/contexts/DynamicStrategyContext';

function StatusDot({ status }: { status: 'good' | 'warning' | 'critical' }) {
  const colors = {
    good: 'bg-emerald-500',
    warning: 'bg-amber-500',
    critical: 'bg-red-500'
  };
  return <div className={`w-2.5 h-2.5 rounded-full ${colors[status]} animate-pulse`} />;
}

function KPICard({ 
  label, 
  value, 
  status, 
  trend 
}: { 
  label: string; 
  value: string; 
  status: 'good' | 'warning' | 'critical';
  trend?: string;
}) {
  const statusColors = {
    good: 'text-emerald-600 dark:text-emerald-400',
    warning: 'text-amber-600 dark:text-amber-400',
    critical: 'text-red-600 dark:text-red-400'
  };

  return (
    <div className="flex items-center gap-2 sm:gap-3">
      <StatusDot status={status} />
      <div>
        <div className={`text-lg sm:text-2xl font-bold ${statusColors[status]}`}>{value}</div>
        <div className="text-[10px] sm:text-xs text-slate-500 dark:text-slate-400">{label}</div>
        {trend && <div className="text-[9px] sm:text-xs text-slate-400 dark:text-slate-500 hidden sm:block">{trend}</div>}
      </div>
    </div>
  );
}

function PhaseCard({
  phase,
  title,
  description,
  icon: Icon,
  metrics,
  link,
  color
}: {
  phase: string;
  title: string;
  description: string;
  icon: any;
  metrics: { label: string; value: string; highlight?: boolean }[];
  link: string;
  color: 'violet' | 'blue' | 'amber' | 'emerald';
}) {
  const colorClasses = {
    violet: {
      border: 'border-violet-200 dark:border-violet-800 hover:border-violet-400 dark:hover:border-violet-600',
      iconBg: 'bg-violet-100 dark:bg-violet-900/50',
      iconColor: 'text-violet-600 dark:text-violet-400',
      badge: 'bg-violet-100 text-violet-700 dark:bg-violet-900/50 dark:text-violet-300'
    },
    blue: {
      border: 'border-blue-200 dark:border-blue-800 hover:border-blue-400 dark:hover:border-blue-600',
      iconBg: 'bg-blue-100 dark:bg-blue-900/50',
      iconColor: 'text-blue-600 dark:text-blue-400',
      badge: 'bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300'
    },
    emerald: {
      border: 'border-emerald-200 dark:border-emerald-800 hover:border-emerald-400 dark:hover:border-emerald-600',
      iconBg: 'bg-emerald-100 dark:bg-emerald-900/50',
      iconColor: 'text-emerald-600 dark:text-emerald-400',
      badge: 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/50 dark:text-emerald-300'
    },
    amber: {
      border: 'border-amber-200 dark:border-amber-800 hover:border-amber-400 dark:hover:border-amber-600',
      iconBg: 'bg-amber-100 dark:bg-amber-900/50',
      iconColor: 'text-amber-600 dark:text-amber-400',
      badge: 'bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300'
    }
  };

  const c = colorClasses[color];

  return (
    <Link href={link}>
      <Card className={`card-bg border-2 ${c.border} transition-all cursor-pointer hover:shadow-lg h-full`}>
        <CardHeader className="pb-2 sm:pb-3 p-3 sm:p-6">
          <div className="flex items-center justify-between mb-2">
            <div className="flex items-center gap-2 sm:gap-3">
              <div className={`w-8 h-8 sm:w-10 sm:h-10 rounded-lg ${c.iconBg} flex items-center justify-center`}>
                <Icon className={`h-4 w-4 sm:h-5 sm:w-5 ${c.iconColor}`} />
              </div>
              <div>
                <Badge className={`${c.badge} text-[10px] sm:text-xs font-bold`}>{phase}</Badge>
              </div>
            </div>
            <ChevronRight className="h-4 w-4 text-slate-400" />
          </div>
          <CardTitle className="text-sm sm:text-lg text-slate-900 dark:text-white">{title}</CardTitle>
          <p className="text-xs sm:text-sm text-slate-500 dark:text-slate-400 line-clamp-2">{description}</p>
        </CardHeader>
        <CardContent className="p-3 sm:p-6 pt-0 sm:pt-0">
          <div className="space-y-1 sm:space-y-2">
            {metrics.map((metric, i) => (
              <div key={i} className="flex justify-between items-center">
                <span className="text-xs sm:text-sm text-slate-600 dark:text-slate-300">{metric.label}</span>
                <span className={`text-xs sm:text-sm font-semibold ${metric.highlight ? c.iconColor : 'text-slate-900 dark:text-white'}`}>
                  {metric.value}
                </span>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </Link>
  );
}

function ActivityItem({
  type,
  title,
  time,
  status
}: {
  type: 'alert' | 'activation' | 'update' | 'success';
  title: string;
  time: string;
  status?: string;
}) {
  const icons = {
    alert: AlertTriangle,
    activation: Zap,
    update: Activity,
    success: CheckCircle
  };
  const colors = {
    alert: 'text-amber-500 bg-amber-100 dark:bg-amber-900/30',
    activation: 'text-blue-500 bg-blue-100 dark:bg-blue-900/30',
    update: 'text-slate-500 bg-slate-100 dark:bg-slate-800',
    success: 'text-emerald-500 bg-emerald-100 dark:bg-emerald-900/30'
  };

  const Icon = icons[type];
  const colorClass = colors[type];

  return (
    <div className="flex items-start gap-3 p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
      <div className={`w-8 h-8 rounded-lg ${colorClass} flex items-center justify-center flex-shrink-0`}>
        <Icon className="h-4 w-4" />
      </div>
      <div className="flex-1 min-w-0">
        <p className="text-sm font-medium text-slate-900 dark:text-white truncate">{title}</p>
        <div className="flex items-center gap-2 mt-0.5">
          <span className="text-xs text-slate-500 dark:text-slate-400">{time}</span>
          {status && (
            <Badge variant="outline" className="text-xs py-0 h-5">{status}</Badge>
          )}
        </div>
      </div>
    </div>
  );
}

export default function Dashboard() {
  const { isConnected } = useWebSocket();
  const { activeScenarios, weakSignals } = useDynamicStrategy();

  const { data: preparednessScore } = useQuery({
    queryKey: ['/api/preparedness-score'],
  });

  const { data: activeTriggers } = useQuery({
    queryKey: ['/api/triggers'],
  });

  const { data: recentActivations } = useQuery({
    queryKey: ['/api/playbook-activations/recent'],
  });

  const scoreValue = (preparednessScore as any)?.overall_score || 84;
  const triggerCount = Array.isArray(activeTriggers) ? activeTriggers.filter((t: any) => t.status === 'active').length : 12;
  const activationCount = Array.isArray(recentActivations) ? recentActivations.length : 0;

  useEffect(() => {
    updatePageMetadata({
      title: "Dashboard | M Strategic Execution OS",
      description: "Your strategic execution command center. Monitor readiness, track triggers, and coordinate responses in real-time.",
      ogTitle: "M Dashboard",
      ogDescription: "Strategic Execution Operating System for Fortune 1000 executives.",
    });
  }, []);

  const overallStatus: 'good' | 'warning' | 'critical' = 
    scoreValue >= 80 && triggerCount >= 10 ? 'good' :
    scoreValue >= 60 ? 'warning' : 'critical';

  return (
    <PageLayout>
      <div className="flex-1 overflow-auto page-background">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6">
          
          {/* Hero Banner - Deterministic Strategic Execution */}
          <div className="text-center py-4 sm:py-6">
            <h1 className="text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-3 leading-tight">
              From 72 Hours to 12 Minutes.{" "}
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary to-emerald-400">
                Deterministic Strategic Execution.
              </span>
            </h1>
            <p className="text-sm sm:text-base text-muted-foreground max-w-2xl mx-auto">
              No fragmented tools. No experimental AI. Just battle-tested playbooks 
              that transform how Fortune 1000 companies respond to the moments that matter.
            </p>
          </div>

          {/* Zone 1: Executive Summary Strip */}
          <Card className="card-bg">
            <CardContent className="p-3 sm:p-5">
              <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 sm:gap-6">
                {/* Status & Title */}
                <div className="flex items-center gap-3 sm:gap-4">
                  <div className={`w-10 h-10 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center ${
                    overallStatus === 'good' ? 'bg-emerald-100 dark:bg-emerald-900/30' :
                    overallStatus === 'warning' ? 'bg-amber-100 dark:bg-amber-900/30' : 
                    'bg-red-100 dark:bg-red-900/30'
                  }`}>
                    <Shield className={`h-5 w-5 sm:h-6 sm:w-6 ${
                      overallStatus === 'good' ? 'text-emerald-600 dark:text-emerald-400' :
                      overallStatus === 'warning' ? 'text-amber-600 dark:text-amber-400' : 
                      'text-red-600 dark:text-red-400'
                    }`} />
                  </div>
                  <div>
                    <h1 className="text-base sm:text-xl font-bold text-slate-900 dark:text-white">Strategic Command Center</h1>
                    <div className="flex flex-wrap items-center gap-1.5 sm:gap-2 mt-0.5">
                      <StatusDot status={overallStatus} />
                      <span className="text-xs sm:text-sm text-slate-600 dark:text-slate-300">
                        {overallStatus === 'good' ? 'All Systems Operational' :
                         overallStatus === 'warning' ? 'Attention Required' : 'Action Needed'}
                      </span>
                      <span className="text-xs text-slate-400 hidden sm:inline"></span>
                      <span className="text-[10px] sm:text-xs text-slate-400">
                        {isConnected ? 'Live' : 'Reconnecting...'}
                      </span>
                    </div>
                  </div>
                </div>

                {/* KPI Strip */}
                <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-6 lg:gap-8">
                  <KPICard 
                    label="Readiness Score" 
                    value={`${scoreValue}%`}
                    status={scoreValue >= 80 ? 'good' : scoreValue >= 60 ? 'warning' : 'critical'}
                    trend="Target: 84.4%"
                  />
                  <KPICard 
                    label="Active Triggers" 
                    value={`${triggerCount}`}
                    status={triggerCount >= 10 ? 'good' : triggerCount >= 5 ? 'warning' : 'critical'}
                    trend="24/7 monitoring"
                  />
                  <KPICard 
                    label="Response Time" 
                    value="12 min"
                    status="good"
                    trend="vs 72hr industry"
                  />
                  <KPICard 
                    label="Weak Signals" 
                    value={`${weakSignals.length}`}
                    status={weakSignals.length === 0 ? 'good' : weakSignals.length <= 3 ? 'warning' : 'critical'}
                    trend="Detected today"
                  />
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Zone 2: 4-Phase Grid */}
          <div className="space-y-4">
            <div className="flex items-center justify-between">
              <h2 className="text-lg font-semibold text-slate-900 dark:text-white">Strategic Workflow</h2>
              <Badge variant="outline" className="text-xs">
                <Clock className="h-3 w-3 mr-1" />
                IDENTIFY  DETECT  EXECUTE  ADVANCE
              </Badge>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <PhaseCard
                phase="IDENTIFY"
                title="Build Your Depth Chart"
                description="166 templates across 9 strategic domains"
                icon={Target}
                color="violet"
                link="/playbook-library"
                metrics={[
                  { label: 'Playbook Templates', value: '166' },
                  { label: 'Custom Scenarios', value: '12' },
                  { label: 'Coverage', value: '94%', highlight: true }
                ]}
              />
              
              <PhaseCard
                phase="DETECT"
                title="Monitor Signals"
                description="Real-time signal detection and alerts"
                icon={Radio}
                color="blue"
                link="/signal-intelligence"
                metrics={[
                  { label: 'AI Modules', value: '5 Active', highlight: true },
                  { label: 'Signals Tracked', value: '12 types' },
                  { label: 'Weak Signals', value: `${weakSignals.length} detected` }
                ]}
              />
              
              <PhaseCard
                phase="EXECUTE"
                title="Execute Response"
                description="12-minute coordinated response"
                icon={Zap}
                color="emerald"
                link="/command-center"
                metrics={[
                  { label: 'Active Scenarios', value: `${activeScenarios.length}` },
                  { label: 'Avg Execution', value: '11m 47s', highlight: true },
                  { label: 'Success Rate', value: '94%' }
                ]}
              />
              
              <PhaseCard
                phase="ADVANCE"
                title="Review the Film"
                description="AI-powered analysis and refinement"
                icon={Brain}
                color="amber"
                link="/institutional-memory"
                metrics={[
                  { label: 'Scenarios Analyzed', value: '24' },
                  { label: 'Patterns Found', value: '18' },
                  { label: 'Playbook Improvements', value: '+34%', highlight: true }
                ]}
              />
            </div>
          </div>

          {/* Zone 3: Activity Feed + Quick Actions */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Activity Feed */}
            <div className="lg:col-span-2">
              <Card className="card-bg h-full">
                <CardHeader className="pb-3">
                  <div className="flex items-center justify-between">
                    <CardTitle className="text-base">Recent Activity</CardTitle>
                    <Badge variant="outline" className="text-xs">
                      <Activity className="h-3 w-3 mr-1" />
                      Live
                    </Badge>
                  </div>
                </CardHeader>
                <CardContent className="space-y-1">
                  <ActivityItem
                    type="alert"
                    title="Weak signal detected: Competitor pricing change"
                    time="2 min ago"
                    status="Monitoring"
                  />
                  <ActivityItem
                    type="activation"
                    title="M&A Integration playbook activated"
                    time="15 min ago"
                    status="In Progress"
                  />
                  <ActivityItem
                    type="success"
                    title="Product Launch scenario completed successfully"
                    time="1 hour ago"
                  />
                  <ActivityItem
                    type="update"
                    title="AI Radar updated with 3 new patterns"
                    time="2 hours ago"
                  />
                  <ActivityItem
                    type="alert"
                    title="Trigger threshold approaching: Supply chain risk"
                    time="3 hours ago"
                    status="Watch"
                  />
                  
                  <div className="pt-3">
                    <Link href="/crisis-response-center">
                      <Button variant="outline" size="sm" className="w-full">
                        View All Activity
                        <ChevronRight className="h-4 w-4 ml-1" />
                      </Button>
                    </Link>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Quick Actions */}
            <div>
              <Card className="card-bg h-full">
                <CardHeader className="pb-3">
                  <CardTitle className="text-base">Quick Actions</CardTitle>
                </CardHeader>
                <CardContent className="space-y-2">
                  <Link href="/demo/live-activation">
                    <Button variant="outline" className="w-full justify-start h-auto py-3" data-testid="button-run-demo">
                      <div className="w-8 h-8 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mr-3">
                        <Zap className="h-4 w-4 text-blue-600 dark:text-blue-400" />
                      </div>
                      <div className="text-left">
                        <div className="font-medium text-sm">Run Live Demo</div>
                        <div className="text-xs text-slate-500">Experience a 12-min activation</div>
                      </div>
                    </Button>
                  </Link>
                  
                  <Link href="/playbook-library">
                    <Button variant="outline" className="w-full justify-start h-auto py-3" data-testid="button-browse-playbooks">
                      <div className="w-8 h-8 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center mr-3">
                        <Target className="h-4 w-4 text-purple-600 dark:text-purple-400" />
                      </div>
                      <div className="text-left">
                        <div className="font-medium text-sm">Browse Playbooks</div>
                        <div className="text-xs text-slate-500">166 strategic templates</div>
                      </div>
                    </Button>
                  </Link>
                  
                  <Link href="/triggers-management">
                    <Button variant="outline" className="w-full justify-start h-auto py-3" data-testid="button-configure-triggers">
                      <div className="w-8 h-8 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center mr-3">
                        <Radio className="h-4 w-4 text-amber-600 dark:text-amber-400" />
                      </div>
                      <div className="text-left">
                        <div className="font-medium text-sm">Configure Triggers</div>
                        <div className="text-xs text-slate-500">Set up AI monitoring</div>
                      </div>
                    </Button>
                  </Link>
                  
                  <Link href="/preparedness-report">
                    <Button variant="outline" className="w-full justify-start h-auto py-3" data-testid="button-view-report">
                      <div className="w-8 h-8 rounded-lg bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center mr-3">
                        <TrendingUp className="h-4 w-4 text-emerald-600 dark:text-emerald-400" />
                      </div>
                      <div className="text-left">
                        <div className="font-medium text-sm">Preparedness Report</div>
                        <div className="text-xs text-slate-500">Full readiness analysis</div>
                      </div>
                    </Button>
                  </Link>
                </CardContent>
              </Card>
            </div>
          </div>

          {/* Footer */}
          <p className="text-center text-xs text-slate-400 dark:text-slate-500 pt-2">
            Data refreshes automatically  Last updated just now
          </p>
        </div>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/DecisionTreeBuilder.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Badge } from "@/components/ui/badge";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { ArrowLeft, Plus, Save, AlertCircle, Trash2, CheckCircle, BookOpen } from "lucide-react";
import { useLocation } from "wouter";
import { useState } from "react";
import { useToast } from "@/hooks/use-toast";
import { useMutation } from "@tanstack/react-query";
import { apiRequest } from "@/lib/queryClient";

interface DecisionOption {
  id: string;
  label: string;
  description: string;
  pros: string[];
  cons: string[];
  criteria: string[];
  triggersPlaybook: string;
}

export default function DecisionTreeBuilder() {
  const [, setLocation] = useLocation();
  const { toast } = useToast();
  const [scenario, setScenario] = useState('');
  const [domain, setDomain] = useState('');
  const [category, setCategory] = useState('');
  const [question, setQuestion] = useState('');
  const [decisionMaker, setDecisionMaker] = useState('CEO');
  const [timeWindow, setTimeWindow] = useState('15');
  const [mustWeighIn, setMustWeighIn] = useState<string[]>(['General Counsel', 'CISO']);
  
  const [options, setOptions] = useState<DecisionOption[]>([
    {
      id: '1',
      label: '',
      description: '',
      pros: [],
      cons: [],
      criteria: [],
      triggersPlaybook: ''
    }
  ]);
  
  const addOption = () => {
    setOptions([...options, {
      id: String(options.length + 1),
      label: '',
      description: '',
      pros: [],
      cons: [],
      criteria: [],
      triggersPlaybook: ''
    }]);
  };
  
  const removeOption = (id: string) => {
    if (options.length > 1) {
      setOptions(options.filter(o => o.id !== id));
    }
  };
  
  const toggleWeighIn = (role: string) => {
    if (mustWeighIn.includes(role)) {
      setMustWeighIn(mustWeighIn.filter(r => r !== role));
    } else {
      setMustWeighIn([...mustWeighIn, role]);
    }
  };
  
  const createTreeMutation = useMutation({
    mutationFn: async (data: any) => {
      return apiRequest('POST', '/api/decision-trees', data);
    },
    onSuccess: () => {
      toast({
        title: "Decision Tree Saved",
        description: "Your pre-staged decision tree has been created successfully.",
      });
      setLocation('/decisions');
    },
    onError: (error) => {
      toast({
        title: "Save Failed",
        description: "Failed to save decision tree. Please try again.",
        variant: "destructive"
      });
    }
  });
  
  const handleSave = () => {
    if (!scenario || !question) {
      toast({
        title: "Missing required fields",
        description: "Please fill in the scenario name and decision question.",
        variant: "destructive"
      });
      return;
    }
    
    if (!domain || !category) {
      toast({
        title: "Missing category selection",
        description: "Please select a domain and strategic category (Offense, Defense, or Special Teams).",
        variant: "destructive"
      });
      return;
    }
    
    const decisionPoint = {
      id: '1',
      order: 1,
      question,
      decisionMaker,
      mustWeighIn,
      timeWindowMinutes: parseInt(timeWindow),
      options: options.map((opt, idx) => ({
        id: opt.id,
        label: opt.label || `Option ${String.fromCharCode(65 + idx)}`,
        description: opt.description,
        pros: opt.pros,
        cons: opt.cons,
        criteria: opt.criteria.map(c => ({ condition: c, met: null })),
        triggersPlaybookId: opt.triggersPlaybook || undefined,
      })),
      historicalDecisions: [],
    };
    
    createTreeMutation.mutate({
      name: scenario,
      scenario,
      domain,
      category,
      decisionPoints: [decisionPoint],
    });
  };
  
  const weighInRoles = ['General Counsel', 'Chief Communications Officer', 'CISO', 'CFO', 'COO', 'CTO'];
  const optionLetters = ['A', 'B', 'C', 'D', 'E', 'F'];
  const optionColors = [
    'border-emerald-200 dark:border-emerald-800 bg-emerald-50 dark:bg-emerald-900/10',
    'border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/10',
    'border-purple-200 dark:border-purple-800 bg-purple-50 dark:bg-purple-900/10',
    'border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/10',
    'border-pink-200 dark:border-pink-800 bg-pink-50 dark:bg-pink-900/10',
    'border-cyan-200 dark:border-cyan-800 bg-cyan-50 dark:bg-cyan-900/10',
  ];
  const buttonColors = ['bg-emerald-600', 'bg-blue-600', 'bg-purple-600', 'bg-amber-600', 'bg-pink-600', 'bg-cyan-600'];
  
  return (
    <div className="min-h-screen bg-slate-50 dark:bg-slate-900">
      <StandardNav />
      
      <div className="container mx-auto px-4 py-20 max-w-5xl">
        <Button 
          variant="ghost" 
          className="mb-6"
          onClick={() => setLocation('/decisions')}
          data-testid="button-back"
        >
          <ArrowLeft className="mr-2 h-4 w-4" />
          Back to Dashboard
        </Button>
        
        <div className="mb-8">
          <h1 className="text-4xl font-bold text-slate-900 dark:text-white mb-2" data-testid="page-title">
            Create Decision Tree
          </h1>
          <p className="text-lg text-slate-600 dark:text-slate-400">
            Pre-stage critical decisions before scenarios occur. Head coaches prepare decision trees all weekso should you.
          </p>
        </div>
        
        <Card className="mb-8 bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800" data-testid="preparation-mindset-card">
          <CardContent className="p-6">
            <div className="flex items-start gap-4">
              <div className="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center shrink-0">
                <BookOpen className="h-6 w-6 text-white" />
              </div>
              <div>
                <h3 className="font-bold text-blue-900 dark:text-blue-200 text-xl mb-2">
                  "I'm not thinking about what I'm doing. I prepared all week so I could just react."
                </h3>
                <p className="text-blue-800 dark:text-blue-300 mb-4">
                   The mindset of elite teams in high-pressure environments
                </p>
                <p className="text-slate-700 dark:text-slate-300">
                  Elite performers don't figure out the play in the moment. They studied, prepared, and know exactly what to do when the opportunity or threat appears.
                </p>
                <p className="text-slate-700 dark:text-slate-300 mt-2">
                  <strong>Do the same for your business.</strong> Pre-stage critical decisions for any scenario
                  <span className="text-emerald-600 dark:text-emerald-400">seizing an M&A opportunity</span>, 
                  <span className="text-blue-600 dark:text-blue-400">defending against a crisis</span>, or 
                  <span className="text-purple-600 dark:text-purple-400">driving AI transformation</span>. 
                  You don't panicyou execute what you already prepared.
                </p>
                <div className="mt-4 p-4 bg-white dark:bg-slate-800 rounded-lg border border-blue-200 dark:border-blue-700">
                  <p className="text-sm font-semibold text-slate-900 dark:text-white mb-1">
                    That's the IDEA:
                  </p>
                  <p className="text-sm text-slate-600 dark:text-slate-400">
                    Comfortable and confident that we are prepared to execute. No matter the situation.
                  </p>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
        
        <Card className="mb-8">
          <CardHeader>
            <CardTitle>Scenario Information</CardTitle>
            <CardDescription>What high-stakes decision needs a pre-staged tree?</CardDescription>
          </CardHeader>
          <CardContent className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Scenario Name *
              </label>
              <Input 
                placeholder="e.g., M&A Target Acquisition, Customer Data Breach, AI Model Deployment"
                value={scenario}
                onChange={(e) => setScenario(e.target.value)}
                data-testid="input-scenario"
              />
              <p className="text-xs text-slate-500 mt-1">
                What situation triggers this decision?
              </p>
            </div>
            
            <div className="grid md:grid-cols-2 gap-6">
              <div>
                <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                  Domain *
                </label>
                <Select value={domain} onValueChange={setDomain}>
                  <SelectTrigger data-testid="select-domain">
                    <SelectValue placeholder="Select a domain..." />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="crisis-response">Crisis Response</SelectItem>
                    <SelectItem value="regulatory-compliance">Regulatory Compliance</SelectItem>
                    <SelectItem value="cyber-incidents">Cyber Incidents</SelectItem>
                    <SelectItem value="competitive-response">Competitive Response</SelectItem>
                    <SelectItem value="market-entry">Market Entry</SelectItem>
                    <SelectItem value="ma-integration">M&A Integration</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              
              <div>
                <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                  Strategic Category *
                </label>
                <Select value={category} onValueChange={setCategory}>
                  <SelectTrigger data-testid="select-category">
                    <SelectValue placeholder="Select a category..." />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="defense">Defense - Protect Value</SelectItem>
                    <SelectItem value="offense">Offense - Seize Opportunities</SelectItem>
                    <SelectItem value="special_teams">Special Teams - Change the Game</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </div>
          </CardContent>
        </Card>
        
        <Card className="mb-8">
          <CardHeader>
            <div className="flex items-center justify-between">
              <div>
                <CardTitle>Decision Point #1</CardTitle>
                <CardDescription>The critical question that needs a fast answer</CardDescription>
              </div>
              <Badge className="bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300">
                Target: {timeWindow} min
              </Badge>
            </div>
          </CardHeader>
          <CardContent className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Decision Question *
              </label>
              <Textarea 
                placeholder="e.g., Should we disclose the breach publicly immediately?"
                rows={2}
                value={question}
                onChange={(e) => setQuestion(e.target.value)}
                data-testid="input-question"
              />
            </div>
            
            <div className="grid md:grid-cols-2 gap-6">
              <div>
                <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                  Primary Decision Maker
                </label>
                <Select value={decisionMaker} onValueChange={setDecisionMaker}>
                  <SelectTrigger data-testid="select-decision-maker">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="CEO">CEO</SelectItem>
                    <SelectItem value="CFO">CFO</SelectItem>
                    <SelectItem value="COO">COO</SelectItem>
                    <SelectItem value="General Counsel">General Counsel</SelectItem>
                    <SelectItem value="CISO">CISO</SelectItem>
                    <SelectItem value="CTO">CTO</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              
              <div>
                <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                  Time Window (minutes)
                </label>
                <Input 
                  type="number" 
                  placeholder="15"
                  value={timeWindow}
                  onChange={(e) => setTimeWindow(e.target.value)}
                  data-testid="input-time-window"
                />
              </div>
            </div>
            
            <div>
              <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Must Weigh In Before Decision
              </label>
              <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                {weighInRoles.map((role) => (
                  <label 
                    key={role} 
                    className="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer"
                  >
                    <input 
                      type="checkbox" 
                      className="rounded"
                      checked={mustWeighIn.includes(role)}
                      onChange={() => toggleWeighIn(role)}
                    />
                    <span className="text-sm text-slate-700 dark:text-slate-300">{role}</span>
                  </label>
                ))}
              </div>
            </div>
          </CardContent>
        </Card>
        
        <Card className="mb-8">
          <CardHeader>
            <div className="flex items-center justify-between">
              <div>
                <CardTitle>Pre-Staged Decision Options</CardTitle>
                <CardDescription>Map out all possible choices before crisis hits</CardDescription>
              </div>
              <Button variant="outline" size="sm" onClick={addOption} data-testid="button-add-option">
                <Plus className="mr-2 h-4 w-4" />
                Add Option
              </Button>
            </div>
          </CardHeader>
          <CardContent className="space-y-6">
            {options.map((option, index) => (
              <div 
                key={option.id}
                className={`p-6 border-2 rounded-lg ${optionColors[index % optionColors.length]}`}
                data-testid={`option-${optionLetters[index]}`}
              >
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center gap-3">
                    <div className={`w-10 h-10 rounded-full ${buttonColors[index % buttonColors.length]} text-white flex items-center justify-center font-bold`}>
                      {optionLetters[index]}
                    </div>
                    <Input 
                      placeholder={`Option name (e.g., ${index === 0 ? 'Disclose Immediately' : 'Delay Disclosure'})`}
                      className="flex-1 bg-white dark:bg-slate-800"
                      value={option.label}
                      onChange={(e) => {
                        const newOptions = [...options];
                        newOptions[index].label = e.target.value;
                        setOptions(newOptions);
                      }}
                      data-testid={`input-option-${optionLetters[index]}-label`}
                    />
                  </div>
                  {options.length > 1 && (
                    <Button 
                      variant="ghost" 
                      size="sm"
                      onClick={() => removeOption(option.id)}
                      className="text-red-500 hover:text-red-700 hover:bg-red-50"
                    >
                      <Trash2 className="h-4 w-4" />
                    </Button>
                  )}
                </div>
                
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                      Description
                    </label>
                    <Textarea 
                      placeholder="What does this option entail?"
                      rows={2}
                      className="bg-white dark:bg-slate-800"
                      value={option.description}
                      onChange={(e) => {
                        const newOptions = [...options];
                        newOptions[index].description = e.target.value;
                        setOptions(newOptions);
                      }}
                    />
                  </div>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                        Pros
                      </label>
                      <Textarea 
                        placeholder=" Regulatory compliance&#10; Transparency&#10; Customer trust"
                        rows={3}
                        className="bg-white dark:bg-slate-800"
                      />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                        Cons
                      </label>
                      <Textarea 
                        placeholder=" Media reaction&#10; Stock impact&#10; Incomplete information"
                        rows={3}
                        className="bg-white dark:bg-slate-800"
                      />
                    </div>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                      Choose This Option If:
                    </label>
                    <Textarea 
                      placeholder=" >100K customers affected&#10; Personal data compromised&#10; Regulatory deadline <24 hours"
                      rows={3}
                      className="bg-white dark:bg-slate-800"
                    />
                    <p className="text-xs text-slate-500 mt-1">
                      Decision criteria help executives choose fast
                    </p>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                      If Chosen  Trigger Playbook
                    </label>
                    <Select>
                      <SelectTrigger className="bg-white dark:bg-slate-800">
                        <SelectValue placeholder="Select playbook..." />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="public-disclosure">Public Disclosure Playbook</SelectItem>
                        <SelectItem value="crisis-comms">Crisis Communications Playbook</SelectItem>
                        <SelectItem value="regulatory">Regulatory Notification Playbook</SelectItem>
                        <SelectItem value="internal-only">Internal Assessment Playbook</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>
              </div>
            ))}
          </CardContent>
        </Card>
        
        <div className="flex items-center justify-between">
          <Button 
            variant="outline" 
            onClick={() => setLocation('/decisions')}
            data-testid="button-cancel"
          >
            Cancel
          </Button>
          <Button 
            size="lg"
            onClick={handleSave}
            disabled={createTreeMutation.isPending}
            className="bg-emerald-600 hover:bg-emerald-700"
            data-testid="button-save"
          >
            <Save className="mr-2 h-5 w-5" />
            Save Decision Tree
          </Button>
        </div>
      </div>
      
      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/DecisionVelocityDashboard.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { Clock, CheckCircle, TrendingDown, TrendingUp, Trophy, ArrowRight, Zap, Target, Users } from "lucide-react";
import { useLocation } from "wouter";

export default function DecisionVelocityDashboard() {
  const [, setLocation] = useLocation();
  
  // Enhanced response data with DECISION + EXECUTION tracking (the full value prop)
  const responses = [
    {
      id: '1',
      scenario: 'Customer Data Breach Response',
      question: 'Should we disclose publicly immediately?',
      decisionMaker: 'John Smith (CEO)',
      optionChosen: 'Option A: Disclose immediately',
      decisionTimeMinutes: 18,
      executionTimeMinutes: 52,
      totalResponseTimeMinutes: 70,
      tasksCompleted: 47,
      totalTasks: 47,
      outcome: 'Positive - Regulatory compliance met, customer trust maintained (87% retention)',
      lessons: 'Transparency paid off long-term despite short-term media negativity',
      timestamp: '2024-11-15T09:23:00'
    },
    {
      id: '2',
      scenario: 'Competitor Pricing Response',
      question: 'Should we match competitor price cut?',
      decisionMaker: 'Sarah Johnson (CFO)',
      optionChosen: 'Option B: Hold pricing, emphasize value proposition',
      decisionTimeMinutes: 11,
      executionTimeMinutes: 35,
      totalResponseTimeMinutes: 46,
      tasksCompleted: 23,
      totalTasks: 23,
      outcome: 'Positive - Maintained margins (92%), minimal customer loss (3% churn)',
      lessons: 'Value messaging resonated with target customers',
      timestamp: '2024-11-20T14:45:00'
    },
    {
      id: '3',
      scenario: 'Regulatory Audit Response',
      question: 'Which compliance approach to take?',
      decisionMaker: 'Lisa Chen (General Counsel)',
      optionChosen: 'Option C: Full disclosure with remediation plan',
      decisionTimeMinutes: 14,
      executionTimeMinutes: 68,
      totalResponseTimeMinutes: 82,
      tasksCompleted: 31,
      totalTasks: 31,
      outcome: 'Positive - Audit closed favorably, no fines assessed',
      lessons: 'Proactive disclosure builds regulatory goodwill',
      timestamp: '2024-12-02T11:12:00'
    },
    {
      id: '4',
      scenario: 'M&A Target Valuation',
      question: 'Approve preliminary bid?',
      decisionMaker: 'Sarah Johnson (CFO)',
      optionChosen: 'Option A: Proceed with bid at $425M',
      decisionTimeMinutes: 24,
      executionTimeMinutes: 45,
      totalResponseTimeMinutes: 69,
      tasksCompleted: 18,
      totalTasks: 28,
      outcome: 'In Progress - Bid submitted, awaiting response',
      lessons: 'TBD - Decision still playing out',
      timestamp: '2024-12-10T16:30:00'
    },
    {
      id: '5',
      scenario: 'Cybersecurity Vendor Selection',
      question: 'Which vendor to contract?',
      decisionMaker: 'Mike Davis (CISO)',
      optionChosen: 'Option B: Vendor B (higher cost, better integration)',
      decisionTimeMinutes: 9,
      executionTimeMinutes: 28,
      totalResponseTimeMinutes: 37,
      tasksCompleted: 19,
      totalTasks: 19,
      outcome: 'Positive - Implementation ahead of schedule, reduced incidents by 40%',
      lessons: 'Investment in integration capabilities was worth premium',
      timestamp: '2024-12-15T10:05:00'
    }
  ];
  
  // Calculate metrics for DECISION + EXECUTION (the complete value proposition)
  const avgDecisionTime = responses.reduce((sum, d) => sum + d.decisionTimeMinutes, 0) / responses.length;
  const avgExecutionTime = responses.reduce((sum, d) => sum + d.executionTimeMinutes, 0) / responses.length;
  const avgTotalResponseTime = responses.reduce((sum, d) => sum + d.totalResponseTimeMinutes, 0) / responses.length;
  
  // Industry baseline: 72 hours to decide + 2 weeks to execute = ~10,080 min (2 weeks total)
  const baselineDecisionMinutes = 72 * 60; // 72 hours
  const baselineExecutionMinutes = 14 * 24 * 60; // 2 weeks
  const baselineTotalMinutes = baselineDecisionMinutes + baselineExecutionMinutes;
  
  const decisionSpeedMultiplier = Math.round(baselineDecisionMinutes / avgDecisionTime);
  const totalSpeedMultiplier = Math.round(baselineTotalMinutes / avgTotalResponseTime);
  
  // Keep backward compatibility - alias for legacy code
  const decisions = responses;
  const speedMultiplier = decisionSpeedMultiplier;
  const improvement = Math.round(((baselineTotalMinutes - avgTotalResponseTime) / baselineTotalMinutes) * 100);
  
  const decisionMakers = [
    { name: 'Sarah Johnson', role: 'CFO', decisions: 12, avgTime: 11.2, rank: 1 },
    { name: 'John Smith', role: 'CEO', decisions: 18, avgTime: 14.7, rank: 2 },
    { name: 'Mike Davis', role: 'CISO', decisions: 9, avgTime: 16.3, rank: 3 },
    { name: 'Lisa Chen', role: 'General Counsel', decisions: 8, avgTime: 19.4, rank: 4 }
  ];
  
  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900">
      <StandardNav />
      
      <div className="container mx-auto px-4 py-20">
        <div className="text-center mb-12">
          <Badge className="mb-4 bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300">
            <Zap className="h-3 w-3 mr-1" />
            Decision Velocity Tracking
          </Badge>
          <h1 className="text-5xl font-bold text-slate-900 dark:text-white mb-4" data-testid="page-title">
            Decision Velocity Dashboard
          </h1>
          <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto">
            Head coaches make 80+ decisions in 3 hours because they pre-stage decision trees. 
            Track how fast your executive team is deciding.
          </p>
        </div>
        
        <div className="grid md:grid-cols-4 gap-6 mb-12">
          <Card className="border-2 border-emerald-200 dark:border-emerald-800">
            <CardHeader className="pb-2">
              <CardTitle className="flex items-center gap-2 text-base">
                <Clock className="h-5 w-5 text-emerald-600" />
                Avg Decision Time
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-4xl font-bold text-emerald-600" data-testid="avg-decision-time">
                {avgDecisionTime.toFixed(1)} min
              </div>
              <p className="text-sm text-slate-500 mt-2">
                vs. 4,320 min baseline (72 hrs)
              </p>
              <div className="mt-3 flex items-center gap-2 text-sm font-medium text-emerald-600">
                <TrendingDown className="h-4 w-4" />
                {speedMultiplier}X faster
              </div>
            </CardContent>
          </Card>
          
          <Card className="border-2 border-blue-200 dark:border-blue-800">
            <CardHeader className="pb-2">
              <CardTitle className="flex items-center gap-2 text-base">
                <Target className="h-5 w-5 text-blue-600" />
                Avg Execution Time
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-4xl font-bold text-blue-600" data-testid="avg-execution-time">
                {avgExecutionTime.toFixed(0)} min
              </div>
              <p className="text-sm text-slate-500 mt-2">
                vs. 20,160 min baseline (2 weeks)
              </p>
              <div className="mt-3 flex items-center gap-2 text-sm font-medium text-blue-600">
                <TrendingDown className="h-4 w-4" />
                {Math.round(baselineExecutionMinutes / avgExecutionTime)}X faster
              </div>
            </CardContent>
          </Card>
          
          <Card className="border-2 border-purple-200 dark:border-purple-800">
            <CardHeader className="pb-2">
              <CardTitle className="flex items-center gap-2 text-base">
                <Zap className="h-5 w-5 text-purple-600" />
                Total Response Time
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-4xl font-bold text-purple-600" data-testid="total-response-time">
                {avgTotalResponseTime.toFixed(0)} min
              </div>
              <p className="text-sm text-slate-500 mt-2">
                decision + execution combined
              </p>
              <div className="mt-3 flex items-center gap-2 text-sm font-medium text-purple-600">
                <TrendingDown className="h-4 w-4" />
                {totalSpeedMultiplier}X faster than industry
              </div>
            </CardContent>
          </Card>
          
          <Card>
            <CardHeader className="pb-2">
              <CardTitle className="flex items-center gap-2 text-base">
                <Trophy className="h-5 w-5 text-amber-600" />
                Responses Completed
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-4xl font-bold text-amber-600" data-testid="responses-count">
                {responses.length}
              </div>
              <p className="text-sm text-slate-500 mt-2">
                this quarter
              </p>
              <div className="mt-3 flex items-center gap-2 text-sm font-medium text-emerald-600">
                <CheckCircle className="h-4 w-4" />
                100% on-time completion
              </div>
            </CardContent>
          </Card>
        </div>
        
        <Card className="mb-12 bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-800 dark:to-slate-900">
          <CardHeader>
            <CardTitle className="text-2xl flex items-center gap-2">
              <Target className="h-6 w-6 text-blue-600" />
              The Decision Velocity Gap
            </CardTitle>
            <CardDescription className="text-base">
              Head coaches make 80+ critical decisions in 3 hours. Your team now decides at head coach speed.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="grid md:grid-cols-2 gap-8">
              <div>
                <h3 className="text-lg font-bold text-slate-700 dark:text-slate-300 mb-4">
                  Before M Platform
                </h3>
                <div className="space-y-3">
                  <div className="flex justify-between items-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                    <span className="text-sm font-medium text-slate-700 dark:text-slate-300">Avg Decision Time</span>
                    <span className="text-lg font-bold text-red-600">72 hours</span>
                  </div>
                  <div className="flex justify-between items-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                    <span className="text-sm font-medium text-slate-700 dark:text-slate-300">Decisions Per Quarter</span>
                    <span className="text-lg font-bold text-red-600">11</span>
                  </div>
                  <div className="flex justify-between items-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                    <span className="text-sm font-medium text-slate-700 dark:text-slate-300">On-Time Rate</span>
                    <span className="text-lg font-bold text-red-600">47%</span>
                  </div>
                </div>
              </div>
              
              <div>
                <h3 className="text-lg font-bold text-slate-700 dark:text-slate-300 mb-4">
                  With M Platform
                </h3>
                <div className="space-y-3">
                  <div className="flex justify-between items-center p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg">
                    <span className="text-sm font-medium text-slate-700 dark:text-slate-300">Avg Decision Time</span>
                    <span className="text-lg font-bold text-emerald-600">{avgDecisionTime.toFixed(1)} min</span>
                  </div>
                  <div className="flex justify-between items-center p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg">
                    <span className="text-sm font-medium text-slate-700 dark:text-slate-300">Decisions Per Quarter</span>
                    <span className="text-lg font-bold text-emerald-600">{decisions.length}</span>
                  </div>
                  <div className="flex justify-between items-center p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg">
                    <span className="text-sm font-medium text-slate-700 dark:text-slate-300">On-Time Rate</span>
                    <span className="text-lg font-bold text-emerald-600">94%</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div className="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-center">
              <p className="text-lg font-bold text-blue-900 dark:text-blue-200">
                {speedMultiplier}X faster decisions  {((decisions.length / 11) * 100 - 100).toFixed(0)}% more decisions made  {(94 - 47).toFixed(0)}% improvement in on-time rate
              </p>
            </div>
          </CardContent>
        </Card>
        
        <Card className="mb-12">
          <CardHeader>
            <CardTitle className="text-2xl flex items-center gap-2">
              <Trophy className="h-6 w-6 text-amber-500" />
              Decision Maker Leaderboard
            </CardTitle>
            <CardDescription>
              Executives ranked by average decision velocity
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              {decisionMakers.map((maker) => (
                <div 
                  key={maker.name}
                  className="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg"
                  data-testid={`leaderboard-row-${maker.rank}`}
                >
                  <div className="flex items-center gap-4">
                    <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${
                      maker.rank === 1 ? 'bg-gradient-to-br from-amber-400 to-orange-500' :
                      maker.rank === 2 ? 'bg-gradient-to-br from-slate-300 to-slate-400' :
                      maker.rank === 3 ? 'bg-gradient-to-br from-amber-600 to-amber-700' :
                      'bg-slate-500'
                    }`}>
                      {maker.rank}
                    </div>
                    <div>
                      <div className="font-semibold text-slate-900 dark:text-white">{maker.name}</div>
                      <div className="text-sm text-slate-500">{maker.role}</div>
                    </div>
                  </div>
                  <div className="flex items-center gap-8">
                    <div className="text-right">
                      <div className="text-sm text-slate-500">Decisions</div>
                      <div className="font-bold text-slate-900 dark:text-white">{maker.decisions}</div>
                    </div>
                    <div className="text-right">
                      <div className="text-sm text-slate-500">Avg Time</div>
                      <div className="font-bold text-emerald-600">{maker.avgTime} min</div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
        
        <Card className="mb-12">
          <CardHeader>
            <CardTitle className="text-2xl">Recent Decisions</CardTitle>
            <CardDescription>
              Decision log with outcomes and lessons learned
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              {decisions.map((decision) => (
                <div 
                  key={decision.id}
                  className="p-4 border border-slate-200 dark:border-slate-700 rounded-lg"
                  data-testid={`decision-row-${decision.id}`}
                >
                  <div className="flex items-start justify-between mb-2">
                    <div>
                      <h4 className="font-semibold text-slate-900 dark:text-white">{decision.scenario}</h4>
                      <p className="text-sm text-slate-600 dark:text-slate-400">{decision.question}</p>
                    </div>
                    <Badge variant={decision.decisionTimeMinutes <= 15 ? 'default' : 'secondary'}>
                      {decision.decisionTimeMinutes} min
                    </Badge>
                  </div>
                  <div className="grid md:grid-cols-2 gap-4 mt-3 text-sm">
                    <div>
                      <span className="text-slate-500">Decision Maker:</span>
                      <span className="ml-2 font-medium text-slate-700 dark:text-slate-300">{decision.decisionMaker}</span>
                    </div>
                    <div>
                      <span className="text-slate-500">Choice:</span>
                      <span className="ml-2 font-medium text-slate-700 dark:text-slate-300">{decision.optionChosen}</span>
                    </div>
                  </div>
                  <div className="mt-3 p-3 bg-slate-50 dark:bg-slate-800 rounded text-sm">
                    <div className="text-slate-500 mb-1">Outcome:</div>
                    <div className="text-slate-700 dark:text-slate-300">{decision.outcome}</div>
                    {decision.lessons && (
                      <>
                        <div className="text-slate-500 mt-2 mb-1">Lessons:</div>
                        <div className="text-slate-700 dark:text-slate-300 italic">{decision.lessons}</div>
                      </>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
        
        <div className="text-center">
          <Button 
            size="lg" 
            onClick={() => setLocation('/decision-trees')}
            className="bg-blue-600 hover:bg-blue-700"
            data-testid="button-create-tree"
          >
            <ArrowRight className="mr-2 h-5 w-5" />
            Create Your First Decision Tree
          </Button>
          <p className="mt-3 text-sm text-slate-500">
            Pre-stage decisions before scenarios occurjust like head coaches do
          </p>
        </div>
      </div>
      
      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/DecisionVelocityPage.tsx
========================================
import PageLayout from "@/components/layout/PageLayout";
import DecisionVelocityDashboard from "@/components/DecisionVelocityDashboard";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { TrendingUp, Zap, Target, Award } from "lucide-react";

export default function DecisionVelocityPage() {
  const organizationId = "demo-org-1";

  return (
    <PageLayout>
      <div className="space-y-8">
        {/* Header */}
        <div>
          <div className="flex items-center gap-3 mb-2">
            <Zap className="h-8 w-8 text-yellow-500" />
            <h1 className="text-3xl font-bold tracking-tight text-gray-900 dark:text-white">
              Decision Velocity Dashboard
            </h1>
            <Badge variant="outline" className="bg-yellow-500/10 text-yellow-600 dark:text-yellow-400 border-yellow-500/20">
              Dynamic Strategy Metric
            </Badge>
          </div>
          <p className="mt-2 text-gray-600 dark:text-gray-400">
            Measure your competitive advantage through decision velocity - the #1 metric for Dynamic Strategy practitioners
          </p>
          <p className="mt-1 text-sm text-gray-500 dark:text-gray-500">
            Companies like Microsoft, DBS Bank, and Amazon track decision velocity as their strategic execution metric
          </p>
        </div>

        {/* NFL + Dynamic Strategy Foundation */}
        <Card className="bg-gradient-to-br .section-background dark:from-blue-950/20 dark:to-purple-950/20 border-2 border-blue-200 dark:border-blue-800">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Target className="h-5 w-5 text-blue-600" />
              The Foundation: NFL Coaching + Dynamic Strategy
            </CardTitle>
            <CardDescription>
              Built by reverse-engineering how NFL coaches make 80+ decisions in under 40 seconds
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="prose prose-sm dark:prose-invert max-w-none">
              <p className="text-base font-medium text-blue-900 dark:text-blue-100">
                M was built by studying the most demanding decision-making system in the world: <strong>NFL coaching</strong>. 
                Then we discovered Microsoft, DBS Bank, and Amazon independently developed the same system through <strong>Dynamic Strategy</strong> methodology.
              </p>
              
              <div className="grid md:grid-cols-2 gap-4 my-4">
                <div className="bg-white dark:bg-slate-900 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
                  <div className="text-sm font-bold text-blue-700 dark:text-blue-300 mb-3"> NFL Coaching (Execution Proof)</div>
                  <div className="space-y-2 text-xs">
                    <div><strong>Game Planning:</strong> Create 100+ plays for every scenario</div>
                    <div><strong>Sideline Headset:</strong> Monitor game in real-time</div>
                    <div><strong>40-Second Clock:</strong> Call play, coordinate 11 players</div>
                    <div><strong>Film Study:</strong> Review decisions, improve playbook</div>
                    <div className="text-green-600 dark:text-green-400 font-semibold mt-2"> Works every Sunday, 80+ decisions/game</div>
                  </div>
                </div>

                <div className="bg-white dark:bg-slate-900 rounded-lg p-4 border border-purple-200 dark:border-purple-800">
                  <div className="text-sm font-bold text-purple-700 dark:text-purple-300 mb-3"> Dynamic Strategy (Strategic Proof)</div>
                  <div className="space-y-2 text-xs">
                    <div><strong>Perpetual Foresight:</strong> Continuous signal scanning</div>
                    <div><strong>Data Pulse:</strong> Real-time intelligence loops</div>
                    <div><strong>Aligned Agility:</strong> Pre-configured execution</div>
                    <div><strong>Org Learning:</strong> Capture outcomes, refine</div>
                    <div className="text-green-600 dark:text-green-400 font-semibold mt-2"> Grew Microsoft $300B  $3T</div>
                  </div>
                </div>
              </div>

              <div className="bg-gradient-to-r from-blue-100 to-purple-100 dark:from-blue-900/30 dark:to-purple-900/30 rounded-lg p-4 border-2 border-blue-300 dark:border-blue-700">
                <div className="text-sm font-bold text-gray-900 dark:text-white mb-2"> M = Both Systems Unified</div>
                <div className="text-xs text-gray-700 dark:text-gray-300">
                  You get the <strong>proven execution speed of NFL coaching</strong> (works every Sunday) combined with the 
                  <strong> proven transformation framework of Dynamic Strategy</strong> (grew Microsoft, DBS Bank, Amazon). 
                  What took them 5 years to build, you get in 90 days.
                </div>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* What is Decision Velocity */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Target className="h-5 w-5 text-blue-600" />
              What is Decision Velocity?
            </CardTitle>
            <CardDescription>
              The competitive advantage metric that NFL coaches and Fortune 1000 leaders track
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="prose prose-sm dark:prose-invert max-w-none">
              <p>
                <strong>Decision Velocity</strong> measures how fast your organization moves from strategic signal to execution completion. 
                NFL coaches master this with their 40-second play clock. Fortune 1000 companies call it their ultimate competitive advantage.
              </p>
              <div className="bg-blue-50 dark:bg-blue-950/20 rounded-lg p-4 my-4">
                <div className="text-sm font-semibold text-blue-700 dark:text-blue-300 mb-2">
                  The Formula:
                </div>
                <div className="text-xs space-y-1">
                  <div>Time from Trigger Detection  Decision  Execution Completion</div>
                  <div className="text-muted-foreground">Your velocity: 12 minutes vs Competitor velocity: 72 hours</div>
                  <div className="font-medium text-green-600 dark:text-green-400">Result: 5-day competitive advantage per strategic move</div>
                </div>
              </div>
              <p>
                <strong>Why It Matters:</strong> While competitors coordinate through email chains and meetings, you execute instantly. 
                After 10 strategic events, you're 50 days ahead - the difference between category leader and market follower.
              </p>
            </div>
          </CardContent>
        </Card>

        {/* Main Dashboard */}
        <DecisionVelocityDashboard organizationId={organizationId} />

        {/* How to Improve */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <TrendingUp className="h-5 w-5 text-green-600" />
              How to Improve Decision Velocity
            </CardTitle>
            <CardDescription>
              Dynamic Strategy principles that amplify velocity
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/20 dark:to-blue-900/20 rounded-lg p-4">
                <div className="font-semibold text-blue-700 dark:text-blue-300 mb-2">1. Perpetual Foresight</div>
                <div className="text-sm text-gray-700 dark:text-gray-300">
                  24/7 AI monitoring detects signals early. Early detection = faster response = higher velocity.
                </div>
              </div>

              <div className="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-950/20 dark:to-purple-900/20 rounded-lg p-4">
                <div className="font-semibold text-purple-700 dark:text-purple-300 mb-2">2. Aligned Agility</div>
                <div className="text-sm text-gray-700 dark:text-gray-300">
                  Pre-configured playbooks with role-based tasks eliminate coordination time. One-click activation = instant execution.
                </div>
              </div>

              <div className="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950/20 dark:to-green-900/20 rounded-lg p-4">
                <div className="font-semibold text-green-700 dark:text-green-300 mb-2">3. Ecosystem Connectors</div>
                <div className="text-sm text-gray-700 dark:text-gray-300">
                  More integrations = faster coordination. 10-15 connected systems eliminate manual handoffs.
                </div>
              </div>

              <div className="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-950/20 dark:to-orange-900/20 rounded-lg p-4">
                <div className="font-semibold text-orange-700 dark:text-orange-300 mb-2">4. Institutional Memory</div>
                <div className="text-sm text-gray-700 dark:text-gray-300">
                  AI learns what works. Each execution improves velocity for the next event. Continuous improvement compounds.
                </div>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Real Examples */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Award className="h-5 w-5 text-yellow-600" />
              Real-World Examples
            </CardTitle>
            <CardDescription>
              How Dynamic Strategy companies achieve decision velocity
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              <div className="border-l-4 border-blue-500 pl-4">
                <div className="font-semibold text-gray-900 dark:text-white">Microsoft</div>
                <div className="text-sm text-gray-600 dark:text-gray-400 mt-1">
                  Transformed from 5-year planning cycles to continuous iteration. Decision velocity improvement enabled 
                  market cap growth from $300B to $3T. Satya Nadella: "Strategy must be a living process that learns in real time."
                </div>
              </div>

              <div className="border-l-4 border-purple-500 pl-4">
                <div className="font-semibold text-gray-900 dark:text-white">DBS Bank</div>
                <div className="text-sm text-gray-600 dark:text-gray-400 mt-1">
                  "Live More, Bank Less" required rapid execution. Built "data nervous system" and strategy sprints to improve 
                  decision velocity. Result: Named World's Best Bank, executing 5x faster than traditional banks.
                </div>
              </div>

              <div className="border-l-4 border-green-500 pl-4">
                <div className="font-semibold text-gray-900 dark:text-white">Amazon</div>
                <div className="text-sm text-gray-600 dark:text-gray-400 mt-1">
                  "Always Day One" culture = continuous decision velocity. Bezos insisted on doubling experiments yearly. 
                  Speed of execution (not just innovation) created category leadership in retail, cloud, and logistics.
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/DemoLiveActivation.tsx
========================================
import DemoNavHeader from '@/components/demo/DemoNavHeader';
import { useState, useEffect, useMemo } from 'react';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { 
  Clock, 
  Users, 
  CheckCircle2, 
  AlertCircle, 
  Zap,
  TrendingUp,
  DollarSign,
  Target,
  Play,
  RefreshCw,
  Activity,
  Server,
  Flag,
  ArrowRight,
  Award,
  Sparkles,
  Shield,
  Handshake,
  Rocket,
  PackageX,
  Info
} from 'lucide-react';
import { io, Socket } from 'socket.io-client';
import Confetti from 'react-confetti';
import { useLocation } from 'wouter';
import { getScenarioById, DEMO_SCENARIOS } from '@shared/demo-scenarios';
import FourOutcomesScorecard from '@/components/demo/FourOutcomesScorecard';
import PageLayout from '@/components/layout/PageLayout';

interface StakeholderAck {
  id: string;
  name: string;
  role: string;
  acknowledgedAt: string;
  responseTime: number;
}

interface TaskEvent {
  id: string;
  time: number; // seconds from start
  type: 'task' | 'system' | 'milestone';
  title: string;
  description: string;
  icon?: string;
  executed?: boolean;
}

type DemoPhase = 'running' | 'threshold' | 'completing' | 'complete';

function DemoLiveActivation() {
  const [location, setLocation] = useLocation();
  
  // Extract scenario ID from URL path (e.g., /demo/ransomware -> ransomware)
  const scenarioId = useMemo(() => {
    const pathParts = location.split('/');
    const lastPart = pathParts[pathParts.length - 1];
    
    // Map URL paths to scenario IDs
    if (lastPart === 'live-activation' || lastPart === 'ransomware') return 'ransomware';
    return lastPart;
  }, [location]);
  
  // Load scenario from unified configuration
  const scenario = useMemo(() => {
    const loadedScenario = getScenarioById(scenarioId);
    // Fallback to ransomware if scenario not found
    return loadedScenario || DEMO_SCENARIOS['ransomware'];
  }, [scenarioId]);

  const DEMO_SCENARIO = scenario;
  const TARGET_COMPLETION_TIME = scenario.targetCompletionTime;
  const STAKEHOLDER_ROSTER = scenario.stakeholderRoster;
  const [socket, setSocket] = useState<Socket | null>(null);
  const [isClient, setIsClient] = useState(false);

  // Check if client-side after hydration
  useEffect(() => {
    setIsClient(true);
  }, []);
  const [executionId, setExecutionId] = useState<string | null>(null);
  const [startTime, setStartTime] = useState<Date | null>(null);
  const [elapsedTime, setElapsedTime] = useState<number>(0);
  const [acknowledgments, setAcknowledgments] = useState<StakeholderAck[]>([]);
  const [totalStakeholders, setTotalStakeholders] = useState<number>(scenario.stakeholderRoster.length);
  const [demoPhase, setDemoPhase] = useState<DemoPhase>('running');
  const [executedTasks, setExecutedTasks] = useState<Set<string>>(new Set());
  const [showConfetti, setShowConfetti] = useState(false);
  const [showScorecard, setShowScorecard] = useState(false);

  // Timer effect - now continues past 80% threshold
  useEffect(() => {
    if (!startTime || demoPhase === 'complete') return;

    const interval = setInterval(() => {
      const elapsed = Math.floor((Date.now() - startTime.getTime()) / 1000);
      setElapsedTime(elapsed);
      
      // Calculate current progress
      const currentProgress = totalStakeholders > 0 
        ? (acknowledgments.length / totalStakeholders) * 100 
        : 0;
      
      // Debug logging for completion tracking
      if (currentProgress >= 80 && elapsed >= 690) { // Log when approaching completion
        console.log(` Completion Check: elapsed=${elapsed}s (target=${TARGET_COMPLETION_TIME}s), progress=${currentProgress.toFixed(1)}%, phase=${demoPhase}`);
      }
      
      // Auto-complete at target time if we've reached 80% threshold (more lenient)
      // This ensures demo completes even if we don't reach 90%
      // Note: demoPhase can't be 'complete' here due to early return above
      if (elapsed >= TARGET_COMPLETION_TIME && currentProgress >= 80) {
        console.log(` DEMO COMPLETING: elapsed=${elapsed}s, progress=${currentProgress.toFixed(1)}%, transitioning to complete phase`);
        setDemoPhase('complete');
        setShowConfetti(true);
        setTimeout(() => setShowConfetti(false), 5000);
      }
    }, 100);

    return () => clearInterval(interval);
  }, [startTime, demoPhase, TARGET_COMPLETION_TIME, acknowledgments.length, totalStakeholders]);

  // Phase progression logic
  useEffect(() => {
    const progress = totalStakeholders > 0 
      ? (acknowledgments.length / totalStakeholders) * 100 
      : 0;

    // Transition to threshold phase at 80%
    if (progress >= 80 && demoPhase === 'running') {
      setDemoPhase('threshold');
    }

    // Transition to completing phase at 90%
    if (progress >= 90 && demoPhase === 'threshold') {
      setDemoPhase('completing');
    }
  }, [acknowledgments.length, totalStakeholders, demoPhase]);

  // Task execution effect - mark tasks as executed when their time is reached
  useEffect(() => {
    if (!executionId || !startTime) return;

    DEMO_SCENARIO.tasks.forEach(task => {
      if (elapsedTime >= task.time && !executedTasks.has(task.id)) {
        setExecutedTasks(prev => {
          const newSet = new Set(Array.from(prev));
          newSet.add(task.id);
          return newSet;
        });
      }
    });
  }, [elapsedTime, executionId, startTime, executedTasks]);

  // Scorecard reveal effect - show 2 seconds after completion
  useEffect(() => {
    if (demoPhase === 'complete' && !showScorecard) {
      const timer = setTimeout(() => {
        setShowScorecard(true);
      }, 2000);
      return () => clearTimeout(timer);
    }
  }, [demoPhase, showScorecard]);

  // Format elapsed time
  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  // WebSocket connection - stable connection that persists
  useEffect(() => {
    const newSocket = io();
    setSocket(newSocket);

    newSocket.on('connect', () => {
      console.log(' Demo Dashboard connected to WebSocket');
    });

    newSocket.on('disconnect', () => {
      console.log('  Demo Dashboard disconnected from WebSocket');
    });

    // Only disconnect on actual component unmount, not on re-renders
    return () => {
      console.log(' Cleaning up WebSocket connection');
      newSocket.disconnect();
    };
  }, []); // Empty deps = only run on mount/unmount

  // WebSocket event handlers - join room when executionId is available
  useEffect(() => {
    if (!socket || !executionId) return;

    console.log(` Joining execution room: ${executionId}`);
    socket.emit('join-execution', executionId);

    const handleAcknowledgment = (data: any) => {
      console.log(` Received acknowledgment:`, data.stakeholderName);
      const ack: StakeholderAck = {
        id: data.stakeholderId,
        name: data.stakeholderName,
        role: data.stakeholderRole || 'Executive',
        acknowledgedAt: data.acknowledgedAt,
        responseTime: Math.floor((new Date(data.acknowledgedAt).getTime() - startTime!.getTime()) / 1000)
      };

      setAcknowledgments(prev => [...prev, ack]);
      setTotalStakeholders(data.totalStakeholders || 30);
    };

    const handleComplete = (data: any) => {
      console.log(` Coordination complete:`, data);
      setTotalStakeholders(data.totalStakeholders || 30);
      // Don't set complete here - let the phase logic handle it
    };

    socket.on('stakeholder-acknowledged', handleAcknowledgment);
    socket.on('coordination-complete', handleComplete);

    return () => {
      console.log(` Leaving execution room: ${executionId}`);
      socket.off('stakeholder-acknowledged', handleAcknowledgment);
      socket.off('coordination-complete', handleComplete);
      socket.emit('leave-execution', executionId);
    };
  }, [socket, executionId, startTime]);

  // Client-side fallback simulation - ensures demo always completes reliably
  // Monitors progress and fills in missing acknowledgments to guarantee completion
  useEffect(() => {
    if (!executionId || !startTime || demoPhase === 'complete') return;
    
    let isCompleted = false;
    const simulationTimeouts: NodeJS.Timeout[] = [];
    let lastAckCount = 0;
    let stallCheckCount = 0;
    
    // Check every 10 seconds if progress has stalled
    const progressMonitor = setInterval(() => {
      if (isCompleted) {
        clearInterval(progressMonitor);
        return;
      }
      
      const currentProgress = totalStakeholders > 0 
        ? (acknowledgments.length / totalStakeholders) * 100 
        : 0;
      const elapsedSeconds = Math.floor((Date.now() - startTime.getTime()) / 1000);
      const expectedProgress = Math.min(90, (elapsedSeconds / TARGET_COMPLETION_TIME) * 100);
      
      // If we haven't received any new acknowledgments in the last check
      if (acknowledgments.length === lastAckCount) {
        stallCheckCount++;
      } else {
        stallCheckCount = 0;
        lastAckCount = acknowledgments.length;
      }
      
      // If stalled for 20+ seconds OR significantly behind expected progress, start/boost simulation
      const isStalled = stallCheckCount >= 2;
      const isBehind = currentProgress < expectedProgress - 20;
      
      if ((isStalled || isBehind) && currentProgress < 80) {
        console.log(` Boosting simulation: stalled=${isStalled}, behind=${isBehind}, progress=${currentProgress.toFixed(1)}%, expected=${expectedProgress.toFixed(1)}%`);
        
        // Calculate how many more acknowledgments we need to stay on track
        const targetAcks = Math.ceil((expectedProgress / 100) * totalStakeholders);
        const acksNeeded = Math.max(0, targetAcks - acknowledgments.length);
        
        if (acksNeeded > 0) {
          // Find stakeholders that haven't been acknowledged yet
          const acknowledgedIds = new Set(acknowledgments.map(a => a.id));
          const remainingStakeholders = STAKEHOLDER_ROSTER.filter((s, i) => 
            !acknowledgedIds.has(`sim-${i}`) && !acknowledgedIds.has(s.name)
          );
          
          // Simulate the next batch of acknowledgments over the next 20 seconds
          remainingStakeholders.slice(0, acksNeeded).forEach((stakeholder, index) => {
            const delay = (index + 1) * (15000 / Math.max(1, acksNeeded)); // Spread over 15 seconds
            
            const timeoutId = setTimeout(() => {
              if (isCompleted) return;
              
              const responseTime = elapsedSeconds + Math.floor(delay / 1000);
              const ack: StakeholderAck = {
                id: `sim-boost-${Date.now()}-${index}`,
                name: stakeholder.name,
                role: stakeholder.role,
                acknowledgedAt: new Date().toISOString(),
                responseTime
              };
              
              console.log(` [Boost] ${stakeholder.name} acknowledged`);
              setAcknowledgments(prev => {
                // Prevent duplicates
                if (prev.some(a => a.name === stakeholder.name)) return prev;
                return [...prev, ack];
              });
            }, delay);
            
            simulationTimeouts.push(timeoutId);
          });
        }
      }
    }, 10000); // Check every 10 seconds
    
    // Initial fallback - if no acknowledgments after 8 seconds, start full simulation
    const initialFallback = setTimeout(() => {
      if (isCompleted || acknowledgments.length > 0) return;
      
      console.log(' Starting full client-side simulation (no WebSocket response)');
      
      const stakeholderCount = STAKEHOLDER_ROSTER.length;
      const demoSeconds = TARGET_COMPLETION_TIME;
      const avgInterval = (demoSeconds * 1000) / stakeholderCount * 0.85;
      
      STAKEHOLDER_ROSTER.forEach((stakeholder, index) => {
        const delay = Math.floor(avgInterval * (index + 1) * (0.7 + Math.random() * 0.5));
        
        const timeoutId = setTimeout(() => {
          if (isCompleted) return;
          
          const responseTime = Math.floor(delay / 1000);
          const ack: StakeholderAck = {
            id: `sim-${index}`,
            name: stakeholder.name,
            role: stakeholder.role,
            acknowledgedAt: new Date(startTime.getTime() + delay).toISOString(),
            responseTime
          };
          
          console.log(` [Simulated] ${stakeholder.name} acknowledged at ${responseTime}s`);
          setAcknowledgments(prev => {
            if (prev.some(a => a.name === stakeholder.name)) return prev;
            return [...prev, ack];
          });
        }, delay);
        
        simulationTimeouts.push(timeoutId);
      });
    }, 8000);

    return () => {
      isCompleted = true;
      clearInterval(progressMonitor);
      clearTimeout(initialFallback);
      simulationTimeouts.forEach(id => clearTimeout(id));
    };
  }, [executionId, startTime, demoPhase, STAKEHOLDER_ROSTER, TARGET_COMPLETION_TIME, acknowledgments.length, totalStakeholders]);

  // Start demo activation
  const startDemoActivation = async () => {
    try {
      const response = await fetch('/api/activations/demo', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          stakeholderCount: STAKEHOLDER_ROSTER.length,
          accelerated: true,
          targetDuration: 12,
          stakeholderRoster: STAKEHOLDER_ROSTER.map(s => ({ name: s.name, role: s.role })) // Pass scenario stakeholders
        })
      });

      if (response.ok) {
        const data = await response.json();
        setExecutionId(data.executionId);
        setStartTime(new Date(data.coordinationStartTime));
        setAcknowledgments([]);
        setDemoPhase('running');
        setElapsedTime(0);
        setExecutedTasks(new Set());
      } else {
        const error = await response.json();
        console.error('Demo activation failed:', error);
        alert(`Failed to start demo: ${error.error || 'Unknown error'}`);
      }
    } catch (error) {
      console.error('Failed to start demo:', error);
      alert('Failed to start demo. Check console for details.');
    }
  };

  const resetDemo = () => {
    setExecutionId(null);
    setStartTime(null);
    setAcknowledgments([]);
    setDemoPhase('running');
    setElapsedTime(0);
    setExecutedTasks(new Set());
    setShowConfetti(false);
    setShowScorecard(false);
  };

  const progress = totalStakeholders > 0 
    ? (acknowledgments.length / totalStakeholders) * 100 
    : 0;

  const avgResponseTime = acknowledgments.length > 0
    ? Math.floor(acknowledgments.reduce((sum, ack) => sum + ack.responseTime, 0) / acknowledgments.length)
    : 0;

  // Final metrics calculations
  const finalMetrics = {
    coordinationTime: formatTime(elapsedTime),
    stakeholdersNotified: totalStakeholders,
    stakeholdersAcknowledged: acknowledgments.length,
    acknowledgmentRate: totalStakeholders > 0 ? ((acknowledgments.length / totalStakeholders) * 100).toFixed(1) : '0',
    averageResponseTime: (avgResponseTime / 60).toFixed(1), // in minutes
    
    // Value calculations
    timeWithoutM: 48, // hours (conservative estimate)
    timeWithM: elapsedTime / 60, // minutes
    timeSavedHours: 48 - (elapsedTime / 3600), // hours saved
    
    // Economic value (30 stakeholders  avg $200/hr  hours saved)
    valueSaved: Math.round((48 - (elapsedTime / 3600)) * 30 * 200),
    
    velocityMultiplier: Math.round((48 * 60) / (elapsedTime / 60)) // how many times faster
  };

  return (
    <div className="page-background min-h-screen bg-slate-950 text-white">
      <DemoNavHeader title="M Live Activation Demo" showBackButton={true} />
      <div className="pt-20 p-8">
      {/* Confetti Celebration */}
      {showConfetti && (
        <Confetti
          width={window.innerWidth}
          height={window.innerHeight}
          recycle={false}
          numberOfPieces={500}
          gravity={0.3}
        />
      )}

      {/* Header */}
      <div className="max-w-7xl mx-auto mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-5xl font-bold mb-2" data-testid="demo-title">
              M Live Activation Demo
            </h1>
            <div className="flex items-center gap-3 mb-2">
              <Badge className="bg-green-600 text-white px-4 py-2 text-sm" data-testid="badge-human-in-loop">
                <Shield className="w-4 h-4 mr-2 inline" />
                Human-in-the-Loop Activation
              </Badge>
            </div>
            <p className="text-2xl text-slate-600 dark:text-slate-400">
              Real-time Strategic Coordination
            </p>
          </div>
          <div className="flex gap-4">
            <Button
              onClick={resetDemo}
              variant="outline"
              size="lg"
              className="text-lg"
              data-testid="button-reset-demo"
            >
              <RefreshCw className="mr-2 h-5 w-5" />
              Reset
            </Button>
            {!executionId && (
              <Button
                onClick={startDemoActivation}
                size="lg"
                className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white text-xl px-8 py-6"
                data-testid="button-start-demo"
              >
                <Play className="mr-2 h-6 w-6" />
                Start Demo Activation
              </Button>
            )}
          </div>
        </div>
      </div>

      {/* Scenario Welcome Card - Show before execution starts */}
      {!executionId && (
        <div className="max-w-7xl mx-auto mb-8">
          <Card className="bg-slate-50 dark:bg-slate-800/50 border-slate-300 dark:border-slate-700">
            <CardHeader>
              <CardTitle className="text-4xl text-center flex items-center justify-center gap-3 text-slate-900 dark:text-white">
                <span className="text-6xl">{DEMO_SCENARIO.emoji}</span>
                {DEMO_SCENARIO.title}
              </CardTitle>
              <p className="text-center text-slate-700 dark:text-slate-300 text-xl mt-4">
                {DEMO_SCENARIO.description}
              </p>
            </CardHeader>
            <CardContent className="p-8">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div className="text-center p-6 bg-blue-50 dark:bg-slate-800/50 rounded-lg border border-blue-200 dark:border-slate-700">
                  <Users className="h-12 w-12 text-blue-600 dark:text-blue-400 mx-auto mb-3" />
                  <div className="text-3xl font-bold text-slate-900 dark:text-white mb-2" data-testid="text-stakeholder-count">
                    {STAKEHOLDER_ROSTER.length}
                  </div>
                  <div className="text-slate-600 dark:text-slate-400 text-lg">Stakeholders</div>
                </div>
                <div className="text-center p-6 bg-purple-50 dark:bg-slate-800/50 rounded-lg border border-purple-200 dark:border-slate-700">
                  <Clock className="h-12 w-12 text-purple-600 dark:text-purple-400 mx-auto mb-3" />
                  <div className="text-3xl font-bold text-slate-900 dark:text-white mb-2">~12 min</div>
                  <div className="text-slate-600 dark:text-slate-400 text-lg">Duration</div>
                </div>
                <div className="text-center p-6 bg-green-50 dark:bg-slate-800/50 rounded-lg border border-green-200 dark:border-slate-700">
                  <DollarSign className="h-12 w-12 text-green-600 dark:text-green-400 mx-auto mb-3" />
                  <div className="text-3xl font-bold text-slate-900 dark:text-white mb-2">{DEMO_SCENARIO.valueProp}</div>
                  <div className="text-slate-600 dark:text-slate-400 text-lg">Value Created</div>
                </div>
              </div>

              <div className="text-center">
                <p className="text-slate-600 dark:text-slate-400 text-lg mb-6">
                  Click "Begin Activation" above to start the 12-minute live demonstration
                </p>
                <div className="flex items-center justify-center gap-4 text-sm text-slate-500 dark:text-slate-500">
                  <div className="flex items-center gap-2">
                    <div className="w-3 h-3 bg-blue-500 rounded-full"></div>
                    <span>Real-time coordination</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="w-3 h-3 bg-green-500 rounded-full"></div>
                    <span>Live acknowledgments</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="w-3 h-3 bg-purple-500 rounded-full"></div>
                    <span>Before/after metrics</span>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Scenario Context Card */}
      {executionId && demoPhase !== 'complete' && (
        <Card className="max-w-7xl mx-auto mb-8 bg-red-50 dark:bg-red-900/30 border-red-300 dark:border-red-700/50">
          <CardContent className="p-6">
            <div className="flex items-start gap-4">
              <AlertCircle className="h-12 w-12 text-red-600 dark:text-red-400 flex-shrink-0 mt-1" />
              <div className="flex-1 page-background">
                <div className="flex items-center justify-between mb-2">
                  <h2 className="text-3xl font-bold text-red-900 dark:text-red-100" data-testid="text-scenario-title">
                    {DEMO_SCENARIO.title}
                  </h2>
                  <Badge className="bg-red-600 text-white text-lg px-4 py-2">ACTIVE</Badge>
                </div>
                <p className="text-xl text-slate-700 dark:text-slate-300 mb-3" data-testid="text-playbook-name">
                  Playbook: {DEMO_SCENARIO.playbook}
                </p>
                <p className="text-lg text-slate-600 dark:text-slate-400" data-testid="text-scenario-description">
                  {DEMO_SCENARIO.description}
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      )}

      {/* Augmented Execution Info Box - Appears at 2:00 mark */}
      {executionId && elapsedTime >= 120 && elapsedTime < 180 && demoPhase !== 'complete' && (
        <Card className="max-w-7xl mx-auto mb-8 border-2 border-blue-500 bg-blue-50 dark:bg-blue-900/20 animate-in fade-in slide-in-from-top duration-500" data-testid="card-augmented-execution-info">
          <CardContent className="p-6">
            <div className="flex items-start gap-4">
              <div className="flex-shrink-0">
                <div className="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center">
                  <Info className="w-6 h-6 text-white" />
                </div>
              </div>
              <div className="flex-1 page-background">
                <h3 className="font-semibold text-lg mb-2 text-blue-900 dark:text-blue-100">
                   Augmented Execution in Action
                </h3>
                <p className="text-sm text-slate-700 dark:text-slate-300 mb-3">
                  Notice: M is coordinating stakeholders, but humans are making all decisions.
                </p>
                <ul className="space-y-1 text-sm text-slate-700 dark:text-slate-300">
                  <li className="flex items-center gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 flex-shrink-0" />
                    <span>CEO acknowledging = <strong>Human decision</strong></span>
                  </li>
                  <li className="flex items-center gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 flex-shrink-0" />
                    <span>Legal reviewing = <strong>Human oversight</strong></span>
                  </li>
                  <li className="flex items-center gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 flex-shrink-0" />
                    <span>IT executing = <strong>Human action</strong></span>
                  </li>
                </ul>
                <p className="text-sm font-semibold text-blue-600 dark:text-blue-400 mt-3">
                   The system amplifies. Humans decide.
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      )}

      {/* 80% Threshold Message - Critical Stakeholders Engaged */}
      {executionId && demoPhase === 'threshold' && (
        <Card className="max-w-7xl mx-auto mb-8 border-2 border-green-500 bg-green-50 dark:bg-green-900/20 animate-in fade-in slide-in-from-top duration-500" data-testid="card-threshold-message">
          <CardContent className="p-4">
            <div className="flex items-center gap-3">
              <Shield className="w-6 h-6 text-green-600 flex-shrink-0" />
              <div>
                <p className="font-semibold text-sm text-green-900 dark:text-green-100">
                   All Critical Stakeholders Engaged
                </p>
                <p className="text-xs text-slate-600 dark:text-slate-400">
                  Human-in-the-loop coordination: {acknowledgments.length}/{totalStakeholders} stakeholders approved their roles
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      )}

      {/* Stakeholder Roster Grid - Who's Being Coordinated */}
      {executionId && demoPhase !== 'complete' && (
        <Card className="max-w-7xl mx-auto mb-8 bg-slate-50 dark:bg-slate-800/50 border-slate-300 dark:border-slate-700">
          <CardHeader>
            <CardTitle className="flex items-center justify-between text-3xl text-slate-900 dark:text-white">
              <span className="flex items-center gap-2">
                <Users className="h-10 w-10 text-blue-600 dark:text-blue-400" />
                Stakeholders Being Coordinated
              </span>
              <Badge variant="outline" className="text-lg px-4 py-2 border-slate-400 dark:border-slate-600">
                {acknowledgments.length} of {totalStakeholders} Acknowledged
              </Badge>
            </CardTitle>
            <p className="text-slate-600 dark:text-slate-400 text-lg mt-2">
              Real-time coordination across all executive stakeholders
            </p>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3" data-testid="grid-stakeholders">
              {STAKEHOLDER_ROSTER.map((stakeholder) => {
                const isAcknowledged = acknowledgments.some(
                  ack => ack.role === stakeholder.role || ack.name === stakeholder.name
                );
                const priorityColors = {
                  Critical: 'border-red-400 bg-red-100 dark:border-red-500/50 dark:bg-red-900/20',
                  High: 'border-orange-400 bg-orange-100 dark:border-orange-500/50 dark:bg-orange-900/20',
                  Medium: 'border-yellow-400 bg-yellow-100 dark:border-yellow-500/50 dark:bg-yellow-900/20'
                };
                
                return (
                  <div
                    key={stakeholder.id}
                    className={`p-3 rounded-lg border transition-all ${
                      isAcknowledged 
                        ? 'bg-green-100 border-green-500 dark:bg-green-900/30 dark:border-green-500/70 animate-pulse' 
                        : priorityColors[stakeholder.priority as keyof typeof priorityColors] || 'border-slate-400 bg-slate-100 dark:border-slate-600 dark:bg-slate-700/30'
                    }`}
                    data-testid={`stakeholder-${stakeholder.id}`}
                  >
                    <div className="flex items-start justify-between gap-2 mb-2">
                      <div className="flex-1 page-background min-w-0">
                        <div className={`font-semibold text-sm ${isAcknowledged ? 'text-green-700 dark:text-green-300' : 'text-slate-900 dark:text-white'} truncate`}>
                          {stakeholder.name}
                        </div>
                        <div className={`text-xs ${isAcknowledged ? 'text-green-600 dark:text-green-400' : 'text-slate-600 dark:text-slate-400'} truncate`}>
                          {stakeholder.role}
                        </div>
                        <div className="text-xs text-slate-500 dark:text-slate-500 truncate">
                          {stakeholder.department}
                        </div>
                      </div>
                      {isAcknowledged && (
                        <CheckCircle2 className="h-5 w-5 text-green-400 flex-shrink-0" />
                      )}
                    </div>
                    <Badge 
                      variant="outline" 
                      className={`text-xs ${
                        stakeholder.priority === 'Critical' ? 'border-red-500 text-red-300' :
                        stakeholder.priority === 'High' ? 'border-orange-500 text-orange-300' :
                        'border-yellow-500 text-yellow-300'
                      }`}
                    >
                      {stakeholder.priority}
                    </Badge>
                  </div>
                );
              })}
            </div>
          </CardContent>
        </Card>
      )}

      {/* COMPLETION CELEBRATION SCREEN */}
      {demoPhase === 'complete' && (
        <div className="max-w-7xl mx-auto mb-8">
          <Card className="bg-gradient-to-br from-green-50 via-emerald-50 to-green-50 dark:from-green-900/40 dark:via-emerald-900/40 dark:to-green-900/40 border-green-300 dark:border-green-500/50 overflow-hidden">
            <CardContent className="p-12">
              {/* Success Header */}
              <div className="text-center mb-12">
                <div className="flex items-center justify-center gap-4 mb-6">
                  <Award className="h-24 w-24 text-green-400 animate-pulse" />
                  <div>
                    <h1 className="text-7xl font-bold text-green-400 mb-2" data-testid="text-completion-title">
                       All Stakeholders Coordinated!
                    </h1>
                    <p className="text-3xl text-green-300">
                      Strategic Execution Complete
                    </p>
                  </div>
                  <Sparkles className="h-24 w-24 text-green-400 animate-pulse" />
                </div>
              </div>

              {/* Main Coordination Stats */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <Card className="bg-slate-800/80 border-green-500/30">
                  <CardContent className="p-6 text-center">
                    <Clock className="h-12 w-12 text-green-400 mx-auto mb-3" />
                    <div className="text-6xl font-bold text-green-400 mb-2" data-testid="text-final-time">
                      {finalMetrics.coordinationTime}
                    </div>
                    <div className="text-xl text-slate-300">Coordination Time</div>
                  </CardContent>
                </Card>

                <Card className="bg-slate-800/80 border-green-500/30">
                  <CardContent className="p-6 text-center">
                    <Users className="h-12 w-12 text-blue-400 mx-auto mb-3" />
                    <div className="text-6xl font-bold text-blue-400 mb-2" data-testid="text-final-acks">
                      {finalMetrics.stakeholdersAcknowledged}/{finalMetrics.stakeholdersNotified}
                    </div>
                    <div className="text-xl text-slate-300">Acknowledged</div>
                  </CardContent>
                </Card>

                <Card className="bg-slate-800/80 border-green-500/30">
                  <CardContent className="p-6 text-center">
                    <Target className="h-12 w-12 text-purple-400 mx-auto mb-3" />
                    <div className="text-6xl font-bold text-purple-400 mb-2" data-testid="text-final-rate">
                      {finalMetrics.acknowledgmentRate}%
                    </div>
                    <div className="text-xl text-slate-300">Success Rate</div>
                  </CardContent>
                </Card>

                <Card className="bg-slate-800/80 border-green-500/30">
                  <CardContent className="p-6 text-center">
                    <Zap className="h-12 w-12 text-yellow-400 mx-auto mb-3" />
                    <div className="text-6xl font-bold text-yellow-400 mb-2" data-testid="text-final-avg">
                      {finalMetrics.averageResponseTime} min
                    </div>
                    <div className="text-xl text-slate-300">Avg Response</div>
                  </CardContent>
                </Card>
              </div>

              {/* The M Advantage - Before/After */}
              <Card className="bg-gradient-to-r from-slate-800/90 to-slate-700/90 border-purple-500/50 mb-12">
                <CardHeader>
                  <CardTitle className="text-4xl text-center text-purple-300">
                    The M Advantage
                  </CardTitle>
                </CardHeader>
                <CardContent className="p-8">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
                    {/* Without M */}
                    <div className="text-center p-6 bg-red-900/30 rounded-lg border-2 border-red-500/50">
                      <div className="text-lg text-red-300 mb-3 font-semibold">WITHOUT M</div>
                      <div className="text-7xl font-bold text-red-400 mb-3" data-testid="text-without-vexor">
                        48-72h
                      </div>
                      <div className="text-xl text-slate-400">Traditional coordination</div>
                      <div className="text-lg text-slate-500 mt-2">Email chains, meetings, delays</div>
                    </div>

                    {/* Arrow */}
                    <div className="flex justify-center">
                      <ArrowRight className="h-24 w-24 text-green-400 animate-pulse" />
                    </div>

                    {/* With M */}
                    <div className="text-center p-6 bg-green-900/30 rounded-lg border-2 border-green-500/50">
                      <div className="text-lg text-green-300 mb-3 font-semibold">WITH M</div>
                      <div className="text-7xl font-bold text-green-400 mb-3 animate-pulse" data-testid="text-with-vexor">
                        {finalMetrics.coordinationTime}
                      </div>
                      <div className="text-xl text-slate-400">Strategic velocity</div>
                      <div className="text-lg text-green-400 mt-2 font-semibold">
                        {finalMetrics.velocityMultiplier}x Faster!
                      </div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Value Created */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <Card className="bg-gradient-to-br from-blue-900/40 to-purple-900/40 border-blue-500/50">
                  <CardContent className="p-8 text-center">
                    <Clock className="h-16 w-16 text-blue-400 mx-auto mb-4" />
                    <div className="text-5xl font-bold text-blue-400 mb-3" data-testid="text-time-saved">
                      {finalMetrics.timeSavedHours.toFixed(1)} hours
                    </div>
                    <div className="text-2xl text-slate-300">Time Saved</div>
                  </CardContent>
                </Card>

                <Card className="bg-gradient-to-br from-green-900/40 to-emerald-900/40 border-green-500/50">
                  <CardContent className="p-8 text-center">
                    <DollarSign className="h-16 w-16 text-green-400 mx-auto mb-4" />
                    <div className="text-5xl font-bold text-green-400 mb-3" data-testid="text-value-saved">
                      ${finalMetrics.valueSaved.toLocaleString()}
                    </div>
                    <div className="text-2xl text-slate-300">Executive Time Value</div>
                  </CardContent>
                </Card>

                <Card className="bg-gradient-to-br from-purple-900/40 to-pink-900/40 border-purple-500/50">
                  <CardContent className="p-8 text-center">
                    <TrendingUp className="h-16 w-16 text-purple-400 mx-auto mb-4" />
                    <div className="text-5xl font-bold text-purple-400 mb-3" data-testid="text-velocity">
                      {finalMetrics.velocityMultiplier}x Faster
                    </div>
                    <div className="text-2xl text-slate-300">Strategic Velocity</div>
                  </CardContent>
                </Card>
              </div>

              {/* CTA Buttons */}
              <div className="flex justify-center gap-6">
                <Button
                  size="lg"
                  className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white text-2xl px-12 py-8"
                  data-testid="button-new-demo"
                  onClick={resetDemo}
                >
                  <Play className="mr-3 h-8 w-8" />
                  Run Another Demo
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Four Outcomes Scorecard - Revealed 2 seconds after completion */}
      {showScorecard && demoPhase === 'complete' && (
        <div className="animate-fade-in">
          <FourOutcomesScorecard
            stakeholdersTotal={finalMetrics.stakeholdersNotified}
            stakeholdersAcknowledged={finalMetrics.stakeholdersAcknowledged}
            coordinationTime={finalMetrics.coordinationTime}
            avgResponseTime={finalMetrics.averageResponseTime}
            tasksCompleted={executedTasks.size}
            tasksTotal={scenario.tasks.length}
            engagementRate={parseFloat(finalMetrics.acknowledgmentRate)}
            overrideCount={1}
          />
        </div>
      )}

      {/* RUNNING DEMO UI */}
      {demoPhase !== 'complete' && (
        <div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Main Timer - Large and Prominent */}
          <Card className="lg:col-span-3 bg-gradient-to-br from-slate-800/50 to-slate-900/50 border-slate-700">
            <CardContent className="p-12">
              <div className="text-center">
                <div className="flex items-center justify-center gap-4 mb-6">
                  <Clock className="h-16 w-16 text-blue-400" />
                  <div>
                    <div className="text-8xl font-bold font-mono tracking-tight" data-testid="text-elapsed-time">
                      {formatTime(elapsedTime)}
                    </div>
                    <div className="text-2xl text-slate-400 mt-2">
                      {demoPhase === 'threshold' && 'Continuing to Full Coordination...'}
                      {demoPhase === 'completing' && 'Finalizing Coordination...'}
                      {demoPhase === 'running' && 'Elapsed Time'}
                    </div>
                  </div>
                </div>

                {/* Progress Bar */}
                <div className="space-y-4">
                  <Progress 
                    value={progress} 
                    className="h-8"
                    data-testid="progress-coordination"
                  />
                  <div className="flex justify-between text-xl">
                    <span className="text-slate-400">
                      {acknowledgments.length} / {totalStakeholders} Stakeholders Acknowledged
                    </span>
                    <span className="font-bold text-blue-400">
                      {progress.toFixed(1)}%
                    </span>
                  </div>
                </div>

                {/* Threshold reached message */}
                {demoPhase === 'threshold' && (
                  <div className="mt-8 p-6 bg-green-500/20 border border-green-500/50 rounded-lg">
                    <div className="flex items-center justify-center gap-3">
                      <CheckCircle2 className="h-12 w-12 text-green-400" />
                      <div className="text-3xl font-bold text-green-400">
                        80% threshold reached - continuing to completion...
                      </div>
                    </div>
                  </div>
                )}

                {/* Completing message */}
                {demoPhase === 'completing' && (
                  <div className="mt-8 p-6 bg-purple-500/20 border border-purple-500/50 rounded-lg animate-pulse">
                    <div className="flex items-center justify-center gap-3">
                      <Sparkles className="h-12 w-12 text-purple-400" />
                      <div className="text-3xl font-bold text-purple-400">
                        Final stakeholders coordinating...
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </CardContent>
          </Card>

          {/* Stats Cards */}
          <Card className="bg-slate-800/50 border-slate-700">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-2xl">
                <Users className="h-8 w-8 text-blue-400" />
                Acknowledgments
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-6xl font-bold text-blue-400" data-testid="text-ack-count">
                {acknowledgments.length}
              </div>
              <div className="text-xl text-slate-400 mt-2">
                out of {totalStakeholders}
              </div>
            </CardContent>
          </Card>

          <Card className="bg-slate-800/50 border-slate-700">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-2xl">
                <Zap className="h-8 w-8 text-yellow-400" />
                Avg Response
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-6xl font-bold text-yellow-400" data-testid="text-avg-response">
                {avgResponseTime}s
              </div>
              <div className="text-xl text-slate-400 mt-2">
                per stakeholder
              </div>
            </CardContent>
          </Card>

          <Card className="bg-slate-800/50 border-slate-700">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-2xl">
                <Target className="h-8 w-8 text-green-400" />
                Coordination
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-6xl font-bold text-green-400" data-testid="text-progress">
                {progress.toFixed(0)}%
              </div>
              <div className="text-xl text-slate-400 mt-2">
                of target reached
              </div>
            </CardContent>
          </Card>

          {/* Task Execution Timeline */}
          <Card className="lg:col-span-3 bg-slate-800/50 border-slate-700">
            <CardHeader>
              <CardTitle className="flex items-center justify-between text-2xl">
                <span className="flex items-center gap-2">
                  <Activity className="h-8 w-8 text-blue-400" />
                  Execution Timeline - What's Happening
                </span>
                <Badge variant="outline" className="text-lg px-4 py-2">
                  Live
                </Badge>
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-3 max-h-[500px] overflow-y-auto" data-testid="feed-timeline">
                {!executionId && (
                  <div className="text-center py-12 text-slate-400 text-xl">
                    Click "Start Demo Activation" to see live execution timeline
                  </div>
                )}
                {executionId && DEMO_SCENARIO.tasks.map((task) => {
                  const isExecuted = executedTasks.has(task.id);
                  const isPending = elapsedTime < task.time;
                  
                  // Choose icon and color based on type
                  const getIcon = () => {
                    if (task.type === 'system') return <Server className="h-6 w-6" />;
                    if (task.type === 'milestone') return <Flag className="h-6 w-6" />;
                    return <Activity className="h-6 w-6" />;
                  };
                  
                  const getColor = () => {
                    if (task.type === 'milestone') return 'text-purple-400 bg-purple-900/30 border-purple-600/50';
                    if (task.type === 'system') return 'text-cyan-400 bg-cyan-900/30 border-cyan-600/50';
                    return 'text-blue-400 bg-blue-900/30 border-blue-600/50';
                  };
                  
                  return (
                    <div
                      key={task.id}
                      className={`p-4 rounded-lg border transition-all ${
                        isExecuted 
                          ? getColor() + ' opacity-100 animate-in slide-in-from-left'
                          : 'bg-slate-700/30 border-slate-600/30 opacity-40'
                      }`}
                      data-testid={`timeline-item-${task.id}`}
                    >
                      <div className="flex items-start gap-4">
                        <div className={`flex-shrink-0 ${isExecuted ? '' : 'opacity-40'}`}>
                          {getIcon()}
                        </div>
                        <div className="flex-1 page-background">
                          <div className="flex items-start justify-between gap-4 mb-1">
                            <div className="font-semibold text-lg">
                              {task.title}
                            </div>
                            <div className="text-sm font-mono whitespace-nowrap">
                              T+{Math.floor(task.time / 60)}:{(task.time % 60).toString().padStart(2, '0')}
                            </div>
                          </div>
                          <div className={`text-sm ${isExecuted ? 'opacity-90' : 'opacity-60'}`}>
                            {task.description}
                          </div>
                        </div>
                        {isExecuted && (
                          <CheckCircle2 className="h-6 w-6 text-green-400 flex-shrink-0" />
                        )}
                      </div>
                    </div>
                  );
                })}
              </div>
            </CardContent>
          </Card>

          {/* Real-time Acknowledgment Feed */}
          <Card className="lg:col-span-3 bg-slate-800/50 border-slate-700">
            <CardHeader>
              <CardTitle className="flex items-center justify-between text-2xl">
                <span className="flex items-center gap-2">
                  <CheckCircle2 className="h-8 w-8 text-green-400" />
                  Live Acknowledgment Feed
                </span>
                <Badge variant="outline" className="text-lg px-4 py-2">
                  Real-time
                </Badge>
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-3 max-h-[600px] overflow-y-auto" data-testid="feed-acknowledgments">
                {acknowledgments.length === 0 && (
                  <div className="text-center py-12 text-slate-400 text-xl">
                    {executionId 
                      ? 'Waiting for stakeholder acknowledgments...'
                      : 'Click "Start Demo Activation" to begin'
                    }
                  </div>
                )}
                {acknowledgments.map((ack, index) => (
                  <div
                    key={`${ack.id}-${ack.acknowledgedAt}-${index}`}
                    className="flex items-center justify-between p-4 bg-slate-700/50 rounded-lg border border-slate-600 animate-in slide-in-from-right"
                    data-testid={`ack-item-${index}`}
                  >
                    <div className="flex items-center gap-4 flex-1">
                      <CheckCircle2 className="h-8 w-8 text-green-400 flex-shrink-0" />
                      <div className="flex-1 page-background">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="font-semibold text-xl">{ack.name}</span>
                          <Badge variant="secondary" className="text-xs" data-testid={`badge-human-decision-${index}`}>
                             Human Decision
                          </Badge>
                        </div>
                        <div className="text-lg text-slate-400">{ack.role}</div>
                      </div>
                    </div>
                    <div className="text-right flex-shrink-0">
                      <div className="text-2xl font-bold text-green-400">
                        +{ack.responseTime}s
                      </div>
                      <div className="text-sm text-slate-400">
                        {new Date(ack.acknowledgedAt).toLocaleTimeString()}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>

          {/* ROI Comparison */}
          <Card className="bg-gradient-to-br from-purple-900/50 to-blue-900/50 border-purple-700">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-2xl">
                <DollarSign className="h-8 w-8 text-purple-400" />
                Impact
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-6">
              <div>
                <div className="text-sm text-slate-400 mb-2">WITHOUT M</div>
                <div className="flex items-center gap-2">
                  <AlertCircle className="h-6 w-6 text-red-400" />
                  <div className="text-3xl font-bold text-red-400">48-72h</div>
                </div>
                <div className="text-lg text-slate-400 mt-2">
                  coordination time
                </div>
              </div>

              <div className="border-t border-slate-700 pt-4">
                <div className="text-sm text-slate-400 mb-2">WITH M</div>
                <div className="flex items-center gap-2">
                  <TrendingUp className="h-6 w-6 text-green-400" />
                  <div className="text-3xl font-bold text-green-400">~12min</div>
                </div>
                <div className="text-lg text-slate-400 mt-2">
                  coordination time
                </div>
              </div>

              <div className="border-t border-slate-700 pt-4">
                <div className="text-sm text-slate-400 mb-2">TIME SAVED</div>
                <div className="text-4xl font-bold text-purple-400">360x</div>
                <div className="text-lg text-slate-400 mt-2">
                  faster execution
                </div>
              </div>

              <div className="border-t border-slate-700 pt-4">
                <div className="text-sm text-slate-400 mb-2">VALUE</div>
                <div className="text-3xl font-bold text-green-400">$283K</div>
                <div className="text-lg text-slate-400 mt-2">
                  executive time saved
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Pre-Demo Checklist (collapsible) */}
      {!executionId && (
        <Card className="max-w-7xl mx-auto mt-8 bg-slate-800/50 border-slate-700">
          <CardHeader>
            <CardTitle className="text-2xl">Pre-Demo Checklist</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-2 gap-4 text-lg">
              <div className="flex items-center gap-2">
                <CheckCircle2 className="h-6 w-6 text-green-400" />
                <span>Playbook Library ready</span>
              </div>
              <div className="flex items-center gap-2">
                <CheckCircle2 className="h-6 w-6 text-green-400" />
                <span>WebSocket connected</span>
              </div>
              <div className="flex items-center gap-2">
                <CheckCircle2 className="h-6 w-6 text-green-400" />
                <span>Demo mode enabled</span>
              </div>
              <div className="flex items-center gap-2">
                <CheckCircle2 className="h-6 w-6 text-green-400" />
                <span>Ready to activate</span>
              </div>
            </div>
          </CardContent>
        </Card>
      )}
      </div>
    </div>
  );
}

// Wrap with PageLayout to add unified navigation
export default function DemoLiveActivationPage() {
  return (
    <PageLayout>
      <DemoLiveActivation />
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/DemoRouter.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Clock, Zap, Briefcase, ArrowRight, Play, Building2, Sparkles, FileText, TrendingUp, Users } from "lucide-react";
import { useLocation } from "wouter";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";

export default function DemoRouter() {
  const [, setLocation] = useLocation();

  const demoOptions = [
    {
      id: 'customer',
      title: 'Executive Demo',
      duration: '5 minutes',
      description: 'See how M transforms 72-hour coordination into 12-minute execution. Role-specific wins for CEO, COO, CISO, and more.',
      icon: Users,
      color: 'from-blue-500 to-cyan-500',
      borderColor: 'border-blue-500/30 hover:border-blue-500',
      iconBg: 'bg-blue-500/20',
      path: '/customer-demo',
      badge: 'For Buyers',
      badgeColor: 'bg-blue-500',
      recommended: true
    },
    {
      id: 'quick',
      title: 'Quick Demo',
      duration: '3 minutes',
      description: 'See a playbook activate and tasks deploy in real-time. Perfect for a quick overview.',
      icon: Zap,
      color: 'from-emerald-500 to-teal-500',
      borderColor: 'border-emerald-500/30 hover:border-emerald-500',
      iconBg: 'bg-emerald-500/20',
      path: '/demo/live-activation',
      badge: 'Quick Start',
      badgeColor: 'bg-emerald-500',
      recommended: false
    },
    {
      id: 'simulation',
      title: 'Full Simulation',
      duration: '12 minutes',
      description: 'Step into the role of a Fortune 500 CSO. Experience signal detection, playbook activation, and coordinated response.',
      icon: Briefcase,
      color: 'from-purple-500 to-violet-500',
      borderColor: 'border-purple-500/30 hover:border-purple-500',
      iconBg: 'bg-purple-500/20',
      path: '/executive-simulation',
      badge: 'Deep Dive',
      badgeColor: 'bg-purple-500',
      recommended: false
    },
    {
      id: 'industry',
      title: 'Industry Demos',
      duration: '10-15 minutes',
      description: 'See M configured for your industry: Financial Services, Healthcare, Manufacturing, Retail, Energy, and Luxury.',
      icon: Building2,
      color: 'from-amber-500 to-orange-500',
      borderColor: 'border-amber-500/30 hover:border-amber-500',
      iconBg: 'bg-amber-500/20',
      path: '/industry-demos',
      badge: '6 Industries',
      badgeColor: 'bg-amber-500',
      recommended: false
    }
  ];

  return (
    <div className="min-h-screen bg-slate-950 flex flex-col">
      <StandardNav />
      
      <main className="flex-1">
        <div className="max-w-3xl mx-auto px-6 py-16 md:py-20">
          {/* Header */}
          <div className="text-center mb-10">
            <Badge className="mb-4 bg-emerald-500/20 text-emerald-300 border-emerald-500/30">
              Interactive Experience
            </Badge>
            <h1 className="text-4xl md:text-5xl font-bold text-white mb-4" data-testid="heading-demo-router">
              Experience M
            </h1>
            <p className="text-xl text-slate-400">
              Choose the demo that fits your schedule
            </p>
          </div>

          {/* Recommended Callout */}
          <div className="mb-8 p-4 bg-gradient-to-r from-blue-950/50 to-cyan-950/50 border border-blue-500/30 rounded-xl">
            <div className="flex items-start gap-4">
              <div className="p-2 bg-blue-500/20 rounded-lg">
                <Sparkles className="h-5 w-5 text-blue-400" />
              </div>
              <div className="flex-1">
                <p className="text-white font-medium mb-1">Recommended for executives</p>
                <p className="text-sm text-slate-400 mb-3">
                  See how M delivers 12-minute coordinated response with role-specific wins.
                </p>
                <Button
                  onClick={() => setLocation('/customer-demo')}
                  size="sm"
                  className="bg-blue-600 hover:bg-blue-700 text-white"
                  data-testid="button-recommended-demo"
                >
                  <Play className="h-4 w-4 mr-1.5" />
                  Start Executive Demo
                </Button>
              </div>
            </div>
          </div>

          {/* Demo Options */}
          <div className="space-y-4 mb-10">
            {demoOptions.map((demo) => {
              const IconComponent = demo.icon;
              return (
                <Card 
                  key={demo.id}
                  className={`bg-slate-900/50 border-2 ${demo.borderColor} cursor-pointer transition-all hover:shadow-xl group`}
                  onClick={() => setLocation(demo.path)}
                  data-testid={`card-demo-${demo.id}`}
                >
                  <CardContent className="p-5 md:p-6 flex items-center gap-4 md:gap-6">
                    {/* Icon */}
                    <div className={`p-3 md:p-4 rounded-2xl bg-gradient-to-br ${demo.color} flex-shrink-0`}>
                      <IconComponent className="h-6 w-6 md:h-8 md:w-8 text-white" />
                    </div>
                    
                    {/* Content */}
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 md:gap-3 mb-1 flex-wrap">
                        <h3 className="text-lg md:text-xl font-bold text-white group-hover:text-emerald-400 transition-colors">
                          {demo.title}
                        </h3>
                        <Badge className={`${demo.badgeColor} text-white text-xs`}>
                          {demo.badge}
                        </Badge>
                      </div>
                      <p className="text-slate-400 mb-2 text-sm md:text-base line-clamp-2">{demo.description}</p>
                      <div className="flex items-center gap-2 text-sm text-slate-500">
                        <Clock className="h-4 w-4" />
                        <span>{demo.duration}</span>
                      </div>
                    </div>
                    
                    {/* Arrow */}
                    <ArrowRight className="h-5 w-5 md:h-6 md:w-6 text-slate-500 group-hover:text-white group-hover:translate-x-1 transition-all flex-shrink-0" />
                  </CardContent>
                </Card>
              );
            })}
          </div>

          {/* Alternative Path */}
          <div className="text-center mb-10">
            <p className="text-slate-500 mb-4">
              Want to explore on your own?
            </p>
            <Button
              variant="outline"
              onClick={() => setLocation('/playbook-library')}
              className="text-slate-300 border-slate-700 hover:bg-slate-800"
              data-testid="button-explore-playbooks"
            >
              Browse 166 Playbooks 
            </Button>
          </div>

          {/* Investor/Roadshow Resources */}
          <div className="p-5 bg-purple-950/30 border border-purple-500/30 rounded-xl">
            <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
              <div className="flex items-start gap-3">
                <div className="p-2 bg-purple-500/20 rounded-lg">
                  <FileText className="h-5 w-5 text-purple-400" />
                </div>
                <div>
                  <p className="text-white font-medium">Investor?</p>
                  <p className="text-sm text-slate-400">Locked demo, FAQ, and roadshow materials</p>
                </div>
              </div>
              <div className="flex gap-2 w-full sm:w-auto">
                <Button
                  variant="outline"
                  onClick={() => setLocation('/investor-demo')}
                  className="border-purple-500/50 text-purple-300 hover:bg-purple-950 flex-1 sm:flex-initial"
                  data-testid="button-investor-demo"
                >
                  Investor Demo
                </Button>
                <Button
                  variant="ghost"
                  onClick={() => setLocation('/roadshow-resources')}
                  className="text-purple-300 hover:bg-purple-950 flex-1 sm:flex-initial"
                  data-testid="button-roadshow-resources"
                >
                  Resources
                </Button>
              </div>
            </div>
          </div>
        </div>
      </main>

      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/DrillTrackingSystem.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { PlayCircle, Trophy, Users, Clock, TrendingUp, Target } from 'lucide-react';
import { Progress } from '@/components/ui/progress';

export default function DrillTrackingSystem() {
  const { data: simulationsData, isLoading } = useQuery<any[]>({
    queryKey: ['/api/crisis-simulations'],
  });
  const simulations = simulationsData ?? [];

  const completedDrills = simulations.filter((s: any) => s.status === 'completed');
  const avgPerformance = completedDrills.length > 0
    ? completedDrills.reduce((acc: number, s: any) => acc + (s.performanceMetrics?.overallScore || 75), 0) / completedDrills.length
    : 0;

  const getStatusColor = (status: string) => {
    const colors: Record<string, string> = {
      draft: 'bg-gray-500',
      scheduled: 'bg-blue-500',
      running: 'bg-green-500',
      completed: 'bg-purple-500',
      cancelled: 'bg-red-500'
    };
    return colors[status] || 'bg-gray-500';
  };

  const getDifficultyBadge = (difficulty: string) => {
    const variants: Record<string, any> = {
      basic: 'secondary',
      intermediate: 'default',
      advanced: 'destructive'
    };
    return variants[difficulty] || 'default';
  };

  return (
    <div className="space-y-6 p-6">
      {/* V2 Feature Banner */}
      <div className="bg-blue-50 dark:bg-blue-950/30 border-2 border-blue-300 dark:border-blue-700 rounded-lg p-4">
        <div className="flex items-center gap-3">
          <Badge variant="outline" className="bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 font-semibold">Coming in V2</Badge>
          <p className="text-sm text-gray-700 dark:text-gray-300">
            This feature launches after you practice with What-If Analyzer. Drill Tracking measures your team's preparedness with quarterly simulations.
          </p>
        </div>
      </div>

      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold flex items-center gap-2" data-testid="page-title">
            <Target className="h-8 w-8 text-green-500" />
            Drill Tracking System
          </h1>
          <p className="text-muted-foreground mt-1">
            Practice scenarios quarterly to maintain Executive Preparedness Score
          </p>
        </div>
        <Button data-testid="button-create-drill">
          <PlayCircle className="h-4 w-4 mr-2" />
          Schedule New Drill
        </Button>
      </div>

      {/* Key Metrics */}
      <div className="grid gap-4 md:grid-cols-4">
        <Card data-testid="card-total-drills">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Total Drills</CardTitle>
            <PlayCircle className="h-4 w-4 text-blue-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{simulations.length}</div>
            <p className="text-xs text-muted-foreground">
              {completedDrills.length} completed
            </p>
          </CardContent>
        </Card>

        <Card data-testid="card-avg-performance">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Avg Performance</CardTitle>
            <Trophy className="h-4 w-4 text-yellow-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{Math.round(avgPerformance)}%</div>
            <p className="text-xs text-muted-foreground">
              Across all completed drills
            </p>
          </CardContent>
        </Card>

        <Card data-testid="card-participants">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Active Participants</CardTitle>
            <Users className="h-4 w-4 text-green-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              {simulations.reduce((acc: number, s: any) => {
                return acc + (s.participants?.length || 0);
              }, 0)}
            </div>
            <p className="text-xs text-muted-foreground">
              Total executive involvement
            </p>
          </CardContent>
        </Card>

        <Card data-testid="card-readiness-score">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Readiness Score</CardTitle>
            <TrendingUp className="h-4 w-4 text-blue-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              {completedDrills.length >= 4 ? 'Green' : completedDrills.length >= 2 ? 'Yellow' : 'Red'}
            </div>
            <p className="text-xs text-muted-foreground">
              Based on drill frequency
            </p>
          </CardContent>
        </Card>
      </div>

      {/* Drills List */}
      <Card>
        <CardHeader>
          <CardTitle>Crisis Simulation Drills</CardTitle>
          <CardDescription>
            Practice playbook execution with team performance tracking
          </CardDescription>
        </CardHeader>
        <CardContent>
          {isLoading ? (
            <div className="text-center py-8 text-muted-foreground">Loading drills...</div>
          ) : simulations.length === 0 ? (
            <div className="text-center py-8 text-muted-foreground">
              <Target className="h-12 w-12 mx-auto mb-2 text-gray-400" />
              <p>No drills scheduled yet</p>
              <Button className="mt-4" data-testid="button-schedule-first-drill">Schedule First Drill</Button>
            </div>
          ) : (
            <div className="space-y-4">
              {simulations.map((sim: any) => (
                <div 
                  key={sim.id} 
                  className="border rounded-lg p-4 space-y-3"
                  data-testid={`drill-${sim.id}`}
                >
                  <div className="flex items-start justify-between">
                    <div className="flex-1 page-background space-y-2">
                      <div className="flex items-center gap-2">
                        <div className={`w-3 h-3 rounded-full ${getStatusColor(sim.status)}`} data-testid={`status-indicator-${sim.id}`} />
                        <h3 className="font-semibold" data-testid={`text-drill-name-${sim.id}`}>{sim.name}</h3>
                        <Badge variant={getDifficultyBadge(sim.difficulty)} data-testid={`badge-difficulty-${sim.id}`}>
                          {sim.difficulty}
                        </Badge>
                        <Badge variant="outline">{sim.scenarioType}</Badge>
                      </div>
                      
                      {sim.participants && sim.participants.length > 0 && (
                        <div className="flex items-center gap-2 text-sm text-muted-foreground">
                          <Users className="h-4 w-4" />
                          <span>{sim.participants.length} participants</span>
                        </div>
                      )}

                      {sim.duration && (
                        <div className="flex items-center gap-2 text-sm text-muted-foreground">
                          <Clock className="h-4 w-4" />
                          <span>{sim.duration} minutes</span>
                        </div>
                      )}

                      {sim.status === 'completed' && sim.performanceMetrics && (
                        <div className="mt-2 space-y-2">
                          <div className="flex items-center justify-between text-sm">
                            <span className="text-muted-foreground">Overall Performance</span>
                            <span className="font-medium">{sim.performanceMetrics.overallScore || 75}%</span>
                          </div>
                          <Progress value={sim.performanceMetrics.overallScore || 75} className="h-2" />
                        </div>
                      )}

                      {sim.lessons && sim.lessons.length > 0 && (
                        <div className="bg-blue-50 dark:bg-blue-950 p-3 rounded-md">
                          <p className="text-sm font-medium mb-1">Key Learnings:</p>
                          <ul className="list-disc list-inside text-sm text-muted-foreground">
                            {(sim.lessons as any[]).slice(0, 2).map((lesson: string, idx: number) => (
                              <li key={idx}>{lesson}</li>
                            ))}
                          </ul>
                        </div>
                      )}
                    </div>

                    <div className="flex flex-col gap-2">
                      {sim.status === 'completed' && (
                        <Button size="sm" variant="outline" data-testid={`button-view-results-${sim.id}`}>
                          View Results
                        </Button>
                      )}
                      {sim.status === 'scheduled' && (
                        <Button size="sm" data-testid={`button-start-drill-${sim.id}`}>
                          Start Drill
                        </Button>
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/pages/EchoCulturalAnalytics.tsx
========================================
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Link } from 'wouter';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';
import { 
  Users, 
  Heart, 
  Brain,
  TrendingUp,
  MessageSquare,
  Target,
  Activity,
  Lightbulb,
  Award,
  Clock,
  BarChart3,
  PieChart,
  Globe,
  UserCheck,
  ArrowLeft,
  Home
} from 'lucide-react';

export default function EchoCulturalAnalytics() {
  const [selectedAnalysis, setSelectedAnalysis] = useState('overview');

  const culturalMetrics = [
    {
      id: 'engagement',
      name: 'Employee Engagement',
      value: 84.7,
      change: +5.2,
      status: 'excellent',
      description: 'Overall employee satisfaction and commitment levels',
      details: {
        participation: 92,
        satisfaction: 87,
        retention: 89,
        advocacy: 76
      },
      icon: <Heart className="h-5 w-5" />,
      color: 'emerald'
    },
    {
      id: 'collaboration',
      name: 'Team Collaboration',
      value: 78.9,
      change: +2.8,
      status: 'good',
      description: 'Cross-functional teamwork and knowledge sharing effectiveness',
      details: {
        crossTeam: 82,
        communication: 85,
        knowledge: 74,
        conflict: 23
      },
      icon: <Users className="h-5 w-5" />,
      color: 'blue'
    },
    {
      id: 'innovation',
      name: 'Innovation Culture',
      value: 91.3,
      change: +7.1,
      status: 'excellent',
      description: 'Creativity, risk-taking, and idea generation culture',
      details: {
        ideaGeneration: 94,
        riskTaking: 87,
        experimentation: 92,
        implementation: 89
      },
      icon: <Lightbulb className="h-5 w-5" />,
      color: 'purple'
    },
    {
      id: 'leadership',
      name: 'Leadership Trust',
      value: 73.4,
      change: -1.3,
      status: 'warning',
      description: 'Trust in leadership and organizational direction',
      details: {
        vision: 78,
        transparency: 71,
        decision: 69,
        support: 75
      },
      icon: <Award className="h-5 w-5" />,
      color: 'orange'
    }
  ];

  const teamDynamics = [
    {
      team: 'Engineering',
      engagement: 89,
      collaboration: 92,
      stress: 34,
      productivity: 87,
      retention: 94,
      size: 48
    },
    {
      team: 'Sales',
      engagement: 91,
      collaboration: 85,
      stress: 42,
      productivity: 89,
      retention: 87,
      size: 32
    },
    {
      team: 'Marketing',
      engagement: 86,
      collaboration: 88,
      stress: 28,
      productivity: 85,
      retention: 91,
      size: 24
    },
    {
      team: 'Operations',
      engagement: 78,
      collaboration: 74,
      stress: 51,
      productivity: 82,
      retention: 76,
      size: 19
    }
  ];

  const getColorClasses = (color: string) => {
    const colors = {
      emerald: 'text-emerald-400 bg-emerald-500/10 border-emerald-500/30',
      blue: 'text-blue-400 bg-blue-500/10 border-blue-500/30',
      purple: 'text-purple-400 bg-purple-500/10 border-purple-500/30',
      orange: 'text-orange-400 bg-orange-500/10 border-orange-500/30'
    };
    return colors[color as keyof typeof colors] || colors.blue;
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'excellent': return 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30';
      case 'good': return 'bg-blue-500/20 text-blue-400 border-blue-500/30';
      case 'warning': return 'bg-orange-500/20 text-orange-400 border-orange-500/30';
      case 'critical': return 'bg-red-500/20 text-red-400 border-red-500/30';
      default: return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
    }
  };

  return (
    <>
      <div className="page-background min-h-screen bg-transparent p-6" data-testid="echo-cultural-analytics">
        <div className="max-w-7xl mx-auto space-y-8">
          
          {/* Breadcrumb Navigation */}
          <div className="mb-6">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>AI Intelligence</span>
              <span>/</span>
              <span className="text-white">Echo Cultural Analytics</span>
            </div>
          </div>

          {/* ROI Value Context - Tier 2 Enhancement */}
          <Card className="mb-4 bg-teal-50 dark:bg-teal-950/20 border-teal-300 dark:border-teal-700" data-testid="echo-roi-context">
            <CardContent className="p-3 flex items-center gap-3">
              <div className="p-2 bg-teal-100 dark:bg-teal-900/30 rounded-lg">
                <Users className="h-5 w-5 text-teal-600" />
              </div>
              <div>
                <div className="font-semibold text-teal-900 dark:text-teal-100 text-sm">How Echo Saves You Money</div>
                <div className="text-xs text-teal-700 dark:text-teal-300">Prevents $2M+ culture crisis escalation costs through early detection and intervention</div>
              </div>
            </CardContent>
          </Card>

          {/* Header */}
          <div className="bg-gradient-to-r from-teal-600 to-cyan-600 text-white p-6 rounded-lg">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <Users className="h-10 w-10" />
                <div>
                  <h1 className="text-3xl font-bold" data-testid="echo-title">
                    Echo Cultural Analytics
                  </h1>
                  <p className="text-teal-100">Cultural intelligence and team dynamics assessment platform</p>
                </div>
              </div>
              <div className="flex items-center gap-4">
                <OnboardingTrigger pageId="echo-cultural" autoStart={true} className="bg-white/10 border-white/30 text-white hover:bg-white/20" />
                <Link to="/">
                  <Button variant="secondary" className="bg-teal-700 hover:bg-teal-800 text-teal-100 border-teal-600" data-testid="back-to-dashboard">
                    <ArrowLeft className="h-4 w-4 mr-2" />
                    Dashboard
                  </Button>
                </Link>
                <Badge variant="secondary" className="bg-teal-700 text-teal-100 border-teal-600" data-testid="ai-insights-badge">
                  <Brain className="h-4 w-4 mr-2" />
                  AI INSIGHTS
                </Badge>
                <Button variant="secondary" className="bg-cyan-600 hover:bg-cyan-700 text-white" data-testid="generate-report-button">
                  <BarChart3 className="h-4 w-4 mr-2" />
                  Culture Report
                </Button>
              </div>
            </div>
          </div>

          <Tabs value={selectedAnalysis} onValueChange={setSelectedAnalysis} className="w-full">
            <TabsList className="grid w-full grid-cols-4">
              <TabsTrigger value="overview" data-testid="tab-overview">Cultural Overview</TabsTrigger>
              <TabsTrigger value="teams" data-testid="tab-teams">Team Dynamics</TabsTrigger>
              <TabsTrigger value="insights" data-testid="tab-insights">AI Insights</TabsTrigger>
              <TabsTrigger value="trends" data-testid="tab-trends">Trend Analysis</TabsTrigger>
            </TabsList>

            <TabsContent value="overview" className="space-y-6">
              {/* Cultural Metrics Grid */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {culturalMetrics.map((metric) => (
                  <Card key={metric.id} className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm" data-testid={`metric-${metric.id}`}>
                    <CardHeader className="pb-3">
                      <div className="flex items-center justify-between">
                        <div className={`p-2 rounded-lg ${getColorClasses(metric.color)}`}>
                          {metric.icon}
                        </div>
                        <Badge variant="outline" className={getStatusColor(metric.status)}>
                          {metric.status.toUpperCase()}
                        </Badge>
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-3">
                        <div className="flex items-center justify-between">
                          <h3 className="font-semibold text-white">{metric.name}</h3>
                          <span className={`text-sm font-medium ${metric.change >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                            {metric.change >= 0 ? '+' : ''}{metric.change}%
                          </span>
                        </div>
                        <div className="text-2xl font-bold text-white">{metric.value}%</div>
                        <Progress value={metric.value} className="h-2" />
                        <p className="text-xs text-gray-400">{metric.description}</p>
                        
                        {/* Detailed Breakdown */}
                        <div className="grid grid-cols-2 gap-2 text-xs">
                          {Object.entries(metric.details).map(([key, value]) => (
                            <div key={key} className="flex justify-between">
                              <span className="text-gray-400 capitalize">{key}:</span>
                              <span className="text-white font-medium">{value}%</span>
                            </div>
                          ))}
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>

              {/* Key Cultural Insights */}
              <Card className="border-purple-500/30 bg-purple-950/30 backdrop-blur-sm">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-purple-300">
                    <Brain className="h-5 w-5" />
                    Cultural Health Summary
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="p-4 bg-emerald-950/30 rounded-lg border border-emerald-500/30">
                      <div className="flex items-center gap-2 mb-2">
                        <TrendingUp className="h-4 w-4 text-emerald-400" />
                        <span className="font-medium text-emerald-300">Positive Trends</span>
                      </div>
                      <ul className="space-y-1 text-sm text-emerald-200">
                        <li> Innovation culture surging (+7.1%)</li>
                        <li> Employee engagement at 3-year high</li>
                        <li> Cross-team collaboration improving</li>
                      </ul>
                    </div>
                    <div className="p-4 bg-orange-950/30 rounded-lg border border-orange-500/30">
                      <div className="flex items-center gap-2 mb-2">
                        <Target className="h-4 w-4 text-orange-400" />
                        <span className="font-medium text-orange-300">Focus Areas</span>
                      </div>
                      <ul className="space-y-1 text-sm text-orange-200">
                        <li> Leadership trust needs attention</li>
                        <li> Operations team stress levels high</li>
                        <li> Communication transparency gaps</li>
                      </ul>
                    </div>
                    <div className="p-4 bg-blue-950/30 rounded-lg border border-blue-500/30">
                      <div className="flex items-center gap-2 mb-2">
                        <Lightbulb className="h-4 w-4 text-blue-400" />
                        <span className="font-medium text-blue-300">Recommendations</span>
                      </div>
                      <ul className="space-y-1 text-sm text-blue-200">
                        <li> Leadership visibility sessions</li>
                        <li> Operations workload review</li>
                        <li> Transparent decision processes</li>
                      </ul>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            <TabsContent value="teams" className="space-y-6">
              {/* Team Dynamics Comparison */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {teamDynamics.map((team) => (
                  <Card key={team.team} className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm" data-testid={`team-${team.team.toLowerCase()}`}>
                    <CardHeader>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="p-2 rounded-lg bg-blue-500/10">
                            <Users className="h-5 w-5 text-blue-400" />
                          </div>
                          <div>
                            <h3 className="font-semibold text-white">{team.team} Team</h3>
                            <p className="text-sm text-gray-400">{team.size} members</p>
                          </div>
                        </div>
                        <Badge variant="outline" className="bg-blue-500/20 text-blue-400 border-blue-500/30">
                          {team.engagement}% ENGAGED
                        </Badge>
                      </div>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <div className="flex items-center justify-between text-sm mb-1">
                            <span className="text-gray-400">Collaboration</span>
                            <span className="text-emerald-400 font-medium">{team.collaboration}%</span>
                          </div>
                          <Progress value={team.collaboration} className="h-2" />
                        </div>
                        <div>
                          <div className="flex items-center justify-between text-sm mb-1">
                            <span className="text-gray-400">Productivity</span>
                            <span className="text-blue-400 font-medium">{team.productivity}%</span>
                          </div>
                          <Progress value={team.productivity} className="h-2" />
                        </div>
                        <div>
                          <div className="flex items-center justify-between text-sm mb-1">
                            <span className="text-gray-400">Retention</span>
                            <span className="text-purple-400 font-medium">{team.retention}%</span>
                          </div>
                          <Progress value={team.retention} className="h-2" />
                        </div>
                        <div>
                          <div className="flex items-center justify-between text-sm mb-1">
                            <span className="text-gray-400">Stress Level</span>
                            <span className="text-orange-400 font-medium">{team.stress}%</span>
                          </div>
                          <Progress value={team.stress} className="h-2" />
                        </div>
                      </div>
                      
                      <div className="pt-3 border-t border-gray-700/50">
                        <Button size="sm" variant="outline" className="w-full">
                          <UserCheck className="h-4 w-4 mr-2" />
                          Team Deep Dive
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </TabsContent>

            <TabsContent value="insights" className="space-y-6">
              <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                <CardHeader>
                  <CardTitle className="text-white">AI-Powered Cultural Insights</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-center py-12">
                    <Brain className="h-16 w-16 text-gray-400 mx-auto mb-4" />
                    <p className="text-gray-400">Advanced cultural pattern analysis and predictive insights</p>
                    <p className="text-sm text-gray-500 mt-2">AI-driven cultural transformation recommendations</p>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            <TabsContent value="trends" className="space-y-6">
              <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                <CardHeader>
                  <CardTitle className="text-white">Cultural Trend Analysis</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-center py-12">
                    <PieChart className="h-16 w-16 text-gray-400 mx-auto mb-4" />
                    <p className="text-gray-400">Historical cultural trends and future projections</p>
                    <p className="text-sm text-gray-500 mt-2">Multi-dimensional cultural evolution tracking</p>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>
          </Tabs>
        </div>
      </div>
    </>
  );
}

========================================
FILE: client/src/pages/EnergyGridFailureDemo.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Zap, AlertTriangle, CheckCircle, Clock, Users, DollarSign, ShieldAlert, ArrowLeft, Play, Activity } from "lucide-react";
import AIRadarSimulation from "@/components/demo/AIRadarSimulation";
import TwelveMinuteTimer from "@/components/demo/TwelveMinuteTimer";
import ROIComparison from "@/components/demo/ROIComparison";
import DemoNavHeader from "@/components/demo/DemoNavHeader";
import { energyDemoData } from "@shared/energy-demo-data";

type DemoAct = "intro" | "detection" | "coordination" | "outcome";

export default function EnergyGridFailureDemo() {
  const [currentAct, setCurrentAct] = useState<DemoAct>("intro");
  const [coordinationComplete, setCoordinationComplete] = useState(false);

  const goToAct = (act: DemoAct) => {
    setCurrentAct(act);
    window.scrollTo({ top: 0, behavior: "smooth" });
  };

  const renderActNavigation = () => {
    const acts: { id: DemoAct; label: string }[] = [
      { id: "intro", label: "Introduction" },
      { id: "detection", label: "Act 1: Detection" },
      { id: "coordination", label: "Act 2: Coordination" },
      { id: "outcome", label: "Act 3: Outcome" }
    ];

    return (
      <div className="flex flex-wrap items-center justify-center gap-3 mb-10">
        {acts.map((act) => (
          <Button
            key={act.id}
            variant={currentAct === act.id ? "default" : "outline"}
            size="sm"
            onClick={() => goToAct(act.id)}
            data-testid={`button-act-${act.id}`}
            className={currentAct === act.id ? "bg-amber-600 hover:bg-amber-700" : ""}
          >
            {act.label}
          </Button>
        ))}
      </div>
    );
  };

  return (
    <div className="page-background min-h-screen bg-gradient-to-b from-slate-950 to-amber-950">
      <DemoNavHeader title="Energy Grid Crisis Demo" showBackButton={true} />
      <div className="container mx-auto px-4 py-12 pt-24 max-w-6xl">
        {/* Header */}
        <div className="text-center mb-8">
          <Badge className="mb-4 bg-amber-600" data-testid="badge-demo-type">
            Interactive Demo
          </Badge>
          <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent">
            Energy Grid Crisis Demo
          </h1>
          <p className="text-xl text-amber-200 mb-2">
            {energyDemoData.crisis.subtitle}
          </p>
          <p className="text-sm text-amber-300 max-w-3xl mx-auto">
            Experience how M prevents catastrophic infrastructure failure through coordinated response
            transforming a potential 3-5 day blackout affecting 8.2M customers into controlled 3-hour stabilization.
          </p>
        </div>

        {renderActNavigation()}

        {/* ACT: Introduction */}
        {currentAct === "intro" && (
          <div className="space-y-8 animate-in fade-in duration-500">
            {/* Organization Card */}
            <Card className="p-8 bg-gradient-to-br from-amber-950 to-orange-950 border-amber-500 border-2">
              <div className="text-center mb-6">
                <Zap className="h-16 w-16 mx-auto mb-4 text-amber-400" />
                <h2 className="text-3xl font-bold mb-2 text-white">{energyDemoData.organization.name}</h2>
                <Badge variant="outline" className="mb-4 text-amber-300 border-amber-500">
                  {energyDemoData.organization.industry}
                </Badge>
                <p className="text-amber-200 mb-6">{energyDemoData.organization.description}</p>
                <div className="grid md:grid-cols-4 gap-6 mt-6">
                  <div>
                    <div className="text-3xl font-bold text-amber-400">{energyDemoData.organization.stats.revenue}</div>
                    <div className="text-sm text-amber-300">Annual Revenue</div>
                  </div>
                  <div>
                    <div className="text-3xl font-bold text-orange-400">{energyDemoData.organization.stats.customers}</div>
                    <div className="text-sm text-amber-300">Customers</div>
                  </div>
                  <div>
                    <div className="text-3xl font-bold text-yellow-400">{energyDemoData.organization.stats.coverage}</div>
                    <div className="text-sm text-amber-300">Coverage Area</div>
                  </div>
                  <div>
                    <div className="text-3xl font-bold text-red-400">{energyDemoData.organization.stats.facilities}</div>
                    <div className="text-sm text-amber-300">Substations</div>
                  </div>
                </div>
              </div>
            </Card>

            {/* Crisis Event */}
            <Card className="p-8 bg-slate-900 border-red-500 border-2">
              <div className="flex items-start gap-4 mb-6">
                <div className="p-3 bg-red-900 rounded-full">
                  <AlertTriangle className="h-8 w-8 text-red-400" />
                </div>
                <div className="flex-1 page-background">
                  <h3 className="text-2xl font-bold mb-2 text-white">The Crisis Event</h3>
                  <p className="text-lg text-slate-300 mb-4">{energyDemoData.crisis.description}</p>
                  <div className="grid md:grid-cols-3 gap-4 mt-4">
                    <div className="bg-slate-800 p-4 rounded border border-red-500/30">
                      <Users className="h-5 w-5 text-amber-400 mb-2" />
                      <div className="text-sm text-slate-400 mb-1">Scope</div>
                      <div className="text-lg font-bold text-white">{energyDemoData.crisis.impactMetrics.scope}</div>
                    </div>
                    <div className="bg-slate-800 p-4 rounded border border-red-500/30">
                      <Clock className="h-5 w-5 text-orange-400 mb-2" />
                      <div className="text-sm text-slate-400 mb-1">Response Window</div>
                      <div className="text-lg font-bold text-white">{energyDemoData.crisis.impactMetrics.timeWindow}</div>
                    </div>
                    <div className="bg-slate-800 p-4 rounded border border-red-500/30">
                      <DollarSign className="h-5 w-5 text-red-400 mb-2" />
                      <div className="text-sm text-slate-400 mb-1">Financial Impact</div>
                      <div className="text-lg font-bold text-white">{energyDemoData.crisis.impactMetrics.financialImpact}</div>
                    </div>
                  </div>
                </div>
              </div>
            </Card>

            {/* Playbook */}
            <Card className="p-8 bg-gradient-to-r from-amber-900 to-orange-900 border-amber-400 border-2">
              <div className="flex items-center gap-4 mb-4">
                <div className="p-3 bg-amber-500 rounded-full">
                  <ShieldAlert className="h-6 w-6 text-white" />
                </div>
                <div>
                  <div className="flex items-center gap-2 mb-1">
                    <Badge className="bg-amber-600 text-white" data-testid="badge-playbook-id">
                      Playbook {energyDemoData.playbook.id}
                    </Badge>
                    <Badge className="bg-orange-600 text-white" data-testid="badge-playbook-domain">
                      {energyDemoData.playbook.domain}
                    </Badge>
                  </div>
                  <h3 className="text-2xl font-bold text-white">
                    {energyDemoData.playbook.name}
                  </h3>
                </div>
              </div>
              <p className="text-amber-100 mb-4">
                Pre-configured emergency response coordinating federal agencies (DoE, FEMA, DHS), 247 substations, 
                47 critical hospitals, and 2,500 field personnel for rapid grid stabilization.
              </p>
              <div className="bg-slate-900/50 p-4 rounded">
                <div className="flex items-center justify-between">
                  <span className="text-sm text-amber-200">Preparedness Score</span>
                  <span className="text-2xl font-bold text-amber-400">{energyDemoData.playbook.preparednessScore}%</span>
                </div>
                <Progress value={energyDemoData.playbook.preparednessScore} className="mt-2 h-2" />
              </div>
            </Card>

            <div className="text-center space-y-4">
              <Button
                size="lg"
                onClick={() => goToAct("detection")}
                className="gap-2 bg-amber-600 hover:bg-amber-700 text-white"
                data-testid="button-start-demo"
              >
                <Play className="h-5 w-5" />
                Begin Crisis Simulation
              </Button>
              <div>
                <Button
                  variant="outline"
                  size="sm"
                  onClick={() => (window.location.href = "/industry-demos")}
                  className="gap-2"
                  data-testid="button-back-to-hub"
                >
                  <ArrowLeft className="h-4 w-4" />
                  All Demos
                </Button>
              </div>
            </div>
          </div>
        )}

        {/* ACT 1: AI Detection */}
        {currentAct === "detection" && (
          <div className="space-y-8 animate-in fade-in duration-500">
            <Card className="p-8 bg-gradient-to-r from-red-950 to-orange-950 border-red-500 border-2">
              <Activity className="h-12 w-12 text-red-400 mb-4" />
              <h2 className="text-3xl font-bold mb-4 text-white">
                AI Grid Monitoring Detects Cascading Failure Risk
              </h2>
              <p className="text-lg text-red-200 mb-4">
                2:15 PM - Multiple AI intelligence systems detect heat wave triggering transformer stress across 247 substations. 
                Pattern recognition identifies cascading failure risk at 96% confidence.
              </p>
              <div className="mt-6 p-4 bg-red-900/50 border border-red-500 rounded">
                <div className="flex items-center gap-3">
                  <AlertTriangle className="h-6 w-6 text-red-400 animate-pulse" />
                  <div>
                    <p className="font-bold text-white">NERC Category 3 Emergency Criteria Met</p>
                    <p className="text-sm text-red-200">
                      Cascading failures imminent - Playbook #082 activation recommended
                    </p>
                  </div>
                </div>
              </div>
            </Card>

            <AIRadarSimulation
              dataStreams={energyDemoData.aiDataStreams}
              title="Grid Intelligence Signals"
              playbookId="#082"
              playbookName="Grid Emergency Response"
              autoStart={true}
            />

            <div className="text-center mt-8">
              <Button
                size="lg"
                onClick={() => goToAct("coordination")}
                className="gap-2 bg-red-600 hover:bg-red-700 text-white"
                data-testid="button-activate-playbook"
              >
                <ShieldAlert className="h-5 w-5" />
                Activate Playbook #082 - Grid Emergency
              </Button>
              <p className="text-sm text-amber-300 mt-2">
                Trigger threshold reached - Immediate action required
              </p>
            </div>
          </div>
        )}

        {/* ACT 2: Coordinated Response */}
        {currentAct === "coordination" && (
          <div className="space-y-8 animate-in fade-in duration-500">
            <Card className="p-8 bg-gradient-to-r from-amber-950 to-orange-950 border-amber-500 border-2">
              <Zap className="h-12 w-12 text-amber-400 mb-4" />
              <h2 className="text-3xl font-bold mb-4 text-white">
                3-Hour Coordinated Response Across 2,500 Stakeholders
              </h2>
              <p className="text-lg text-amber-200 mb-4">
                Watch M orchestrate grid stabilization across 247 substations, 47 hospitals, federal agencies, 
                and 2,500 field personnelexecuting load shedding and emergency repairs in parallel.
              </p>
              <div className="bg-slate-900/50 p-4 rounded grid md:grid-cols-3 gap-4">
                <div>
                  <div className="text-sm text-amber-300 mb-1">Critical Facilities</div>
                  <div className="text-2xl font-bold text-white">47 Hospitals</div>
                </div>
                <div>
                  <div className="text-sm text-amber-300 mb-1">Substations Coordinated</div>
                  <div className="text-2xl font-bold text-white">247 Sites</div>
                </div>
                <div>
                  <div className="text-sm text-amber-300 mb-1">Total Stakeholders</div>
                  <div className="text-2xl font-bold text-white">2,500</div>
                </div>
              </div>
            </Card>

            <TwelveMinuteTimer
              timelineEvents={energyDemoData.timelineEvents}
              onComplete={() => setCoordinationComplete(true)}
              title="3-Hour Grid Stabilization Timeline"
              subtitle="From crisis detection to full grid recovery across 247 substations"
              autoStart={true}
            />

            {coordinationComplete && (
              <div className="space-y-6 animate-in fade-in duration-500">
                <Card className="p-6 bg-gradient-to-r from-green-950 to-emerald-950 border-green-500 border-2">
                  <CheckCircle className="h-12 w-12 text-green-400 mb-4 mx-auto" />
                  <h3 className="text-2xl font-bold text-center mb-4 text-white">
                    Grid Stabilized - Crisis Resolved
                  </h3>
                  <p className="text-center text-green-200 mb-6">
                    All 247 substations stable  47 hospitals uninterrupted  Zero casualties  
                    $450M infrastructure preserved through coordinated response
                  </p>
                </Card>

                <div className="grid md:grid-cols-3 gap-4">
                  <Card className="p-6 bg-slate-900 border-amber-500">
                    <div className="text-center">
                      <Users className="h-8 w-8 text-amber-400 mx-auto mb-2" />
                      <div className="text-sm text-slate-400 mb-1">Tier 1: Crisis Command</div>
                      <div className="text-3xl font-bold text-white">{energyDemoData.stakeholderTiers.tier1.count}</div>
                      <div className="text-xs text-slate-400 mt-2">{energyDemoData.stakeholderTiers.tier1.description}</div>
                    </div>
                  </Card>
                  <Card className="p-6 bg-slate-900 border-orange-500">
                    <div className="text-center">
                      <Activity className="h-8 w-8 text-orange-400 mx-auto mb-2" />
                      <div className="text-sm text-slate-400 mb-1">Tier 2: Field Execution</div>
                      <div className="text-3xl font-bold text-white">{energyDemoData.stakeholderTiers.tier2.count}</div>
                      <div className="text-xs text-slate-400 mt-2">{energyDemoData.stakeholderTiers.tier2.description}</div>
                    </div>
                  </Card>
                  <Card className="p-6 bg-slate-900 border-red-500">
                    <div className="text-center">
                      <ShieldAlert className="h-8 w-8 text-red-400 mx-auto mb-2" />
                      <div className="text-sm text-slate-400 mb-1">Tier 3: Network</div>
                      <div className="text-3xl font-bold text-white">{energyDemoData.stakeholderTiers.tier3.count}+</div>
                      <div className="text-xs text-slate-400 mt-2">{energyDemoData.stakeholderTiers.tier3.description}</div>
                    </div>
                  </Card>
                </div>

                <div className="text-center">
                  <Button
                    size="lg"
                    onClick={() => goToAct("outcome")}
                    className="gap-2 bg-green-600 hover:bg-green-700 text-white"
                    data-testid="button-view-outcome"
                  >
                    View ROI Outcome
                  </Button>
                </div>
              </div>
            )}
          </div>
        )}

        {/* ACT 3: Outcome */}
        {currentAct === "outcome" && (
          <div className="space-y-8 animate-in fade-in duration-500">
            <Card className="p-8 bg-gradient-to-r from-green-950 to-emerald-950 border-green-500 border-2">
              <div className="text-center">
                <CheckCircle className="h-16 w-16 text-green-400 mx-auto mb-4" />
                <h2 className="text-4xl font-bold mb-4 text-white">
                  $2.5B Economic Loss Prevented + Lives Saved
                </h2>
                <p className="text-xl text-green-200">
                  Zero uncontrolled outages  All hospitals protected  Grid stabilized in 3 hours vs 3-5 day blackout
                </p>
              </div>
            </Card>

            <ROIComparison
              traditional={{
                label: energyDemoData.roiComparison.traditional.title,
                duration: energyDemoData.roiComparison.traditional.timeline,
                approach: energyDemoData.roiComparison.traditional.approach,
                outcome: energyDemoData.roiComparison.traditional.outcome,
                points: energyDemoData.roiComparison.traditional.points
              }}
              vexor={{
                label: energyDemoData.roiComparison.vexor.title,
                duration: energyDemoData.roiComparison.vexor.timeline,
                approach: energyDemoData.roiComparison.vexor.approach,
                outcome: energyDemoData.roiComparison.vexor.outcome,
                points: energyDemoData.roiComparison.vexor.points
              }}
              bottomLine={energyDemoData.roiComparison.bottomLine}
            />

            <Card className="p-8 bg-slate-900 border-amber-500">
              <h3 className="text-2xl font-bold mb-4 text-white">The M Difference</h3>
              <div className="grid md:grid-cols-2 gap-6">
                <div>
                  <h4 className="font-semibold text-red-400 mb-2"> Traditional Coordination</h4>
                  <ul className="text-sm text-slate-300 space-y-1">
                    <li> 3-5 days of sequential phone trees and approvals</li>
                    <li> Grid cascades into uncontrolled blackout during delays</li>
                    <li> 8.2M customers without power for 36-72 hours</li>
                    <li> 12 preventable deaths from hospital backup failures</li>
                    <li> $2.5B total economic loss + regulatory consequences</li>
                  </ul>
                </div>
                <div>
                  <h4 className="font-semibold text-green-400 mb-2"> M Coordination</h4>
                  <ul className="text-sm text-slate-300 space-y-1">
                    <li> 3-hour coordinated response across 2,500 stakeholders</li>
                    <li> Controlled load shedding prevents cascading failures</li>
                    <li> Zero uncontrolled outages - managed rotating schedule</li>
                    <li> All 47 hospitals protected throughout crisis</li>
                    <li> $2.5B saved + Federal commendation as model response</li>
                  </ul>
                </div>
              </div>
            </Card>

            <div className="text-center space-y-4">
              <Button
                size="lg"
                onClick={() => goToAct("intro")}
                variant="outline"
                className="gap-2"
                data-testid="button-replay-demo"
              >
                Replay Demo
              </Button>
              <div>
                <Button
                  variant="default"
                  onClick={() => (window.location.href = "/industry-demos")}
                  className="gap-2 bg-amber-600 hover:bg-amber-700"
                  data-testid="button-view-all-demos"
                >
                  View All Industry Demos
                </Button>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/EnterpriseMetrics.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import PageLayout from '@/components/layout/PageLayout';
import { 
  Building, 
  Users, 
  TrendingUp, 
  Shield, 
  Globe,
  BarChart3,
  Target,
  Clock,
  CheckCircle,
  AlertTriangle,
  DollarSign,
  Activity,
  Database,
  Zap,
  Crown,
  Briefcase
} from 'lucide-react';

export default function EnterpriseMetrics() {
  const enterpriseKPIs = [
    { title: "Platform Uptime", value: "99.97%", target: "99.99%", progress: 99.7, color: "text-green-600" },
    { title: "Response Time", value: "4 min", target: "2 min", progress: 80, color: "text-blue-600" },
    { title: "User Adoption", value: "94%", target: "98%", progress: 94, color: "text-purple-600" },
    { title: "Cost Efficiency", value: "$847K", target: "$1.2M", progress: 85, color: "text-orange-600" }
  ];

  const scalabilityMetrics = [
    { metric: "Concurrent Users", value: "10,000+", status: "Optimal" },
    { metric: "Data Processing", value: "2.4TB/day", status: "Efficient" },
    { metric: "API Response Time", value: "< 200ms", status: "Excellent" },
    { metric: "Database Performance", value: "99.9%", status: "Optimal" }
  ];

  const integrationCapabilities = [
    {
      system: "Enterprise Resource Planning (ERP)",
      status: "Integrated",
      providers: ["SAP", "Oracle", "Microsoft Dynamics"],
      coverage: "100%"
    },
    {
      system: "Customer Relationship Management (CRM)",
      status: "Integrated", 
      providers: ["Salesforce", "HubSpot", "Microsoft CRM"],
      coverage: "98%" 
    },
    {
      system: "Human Resources Information System",
      status: "Integrated",
      providers: ["Workday", "ADP", "BambooHR"],
      coverage: "95%"
    },
    {
      system: "Business Intelligence Platforms",
      status: "Integrated",
      providers: ["Tableau", "Power BI", "Looker"],
      coverage: "92%"
    }
  ];

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800">
        <div className="p-8">
          {/* Enterprise Metrics Header */}
          <div className="flex items-center justify-between mb-8">
            <div className="flex items-center space-x-4">
              <div className="w-12 h-12 bg-gradient-to-r from-orange-500 to-red-600 rounded-xl flex items-center justify-center">
                <Building className="w-7 h-7 text-white" />
              </div>
              <div>
                <h1 className="text-3xl font-bold text-gray-900 dark:text-white">Enterprise Metrics Center</h1>
                <p className="text-gray-600 dark:text-gray-300">Platform Performance & Enterprise Integration Hub</p>
              </div>
            </div>
            <div className="flex items-center space-x-3">
              <Badge variant="outline" className="text-green-600 border-green-500/50">
                <CheckCircle className="w-3 h-3 mr-1" />
                Enterprise Ready
              </Badge>
              <Badge className="bg-orange-600 text-white">
                Fortune 1000
              </Badge>
            </div>
          </div>

          {/* Enterprise KPIs */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            {enterpriseKPIs.map((kpi, index) => (
              <Card key={index} className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
                <CardHeader className="pb-3">
                  <CardTitle className="text-sm font-medium text-gray-600 dark:text-gray-400">{kpi.title}</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold text-gray-900 dark:text-white mb-2">{kpi.value}</div>
                  <div className="space-y-2">
                    <div className="flex items-center justify-between text-sm">
                      <span className="text-gray-600 dark:text-gray-400">Target: {kpi.target}</span>
                      <span className={kpi.color}>{kpi.progress}%</span>
                    </div>
                    <Progress value={kpi.progress} className="h-2" />
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            {/* Scalability Dashboard */}
            <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
              <CardHeader>
                <CardTitle className="flex items-center text-gray-900 dark:text-white">
                  <Database className="w-5 h-5 mr-2 text-blue-500" />
                  Platform Scalability Metrics
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  {scalabilityMetrics.map((metric, index) => (
                    <div key={index} className="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                      <div>
                        <h4 className="font-medium text-gray-900 dark:text-white">{metric.metric}</h4>
                        <p className="text-sm text-gray-600 dark:text-gray-400">{metric.value}</p>
                      </div>
                      <Badge 
                        variant={metric.status === 'Optimal' || metric.status === 'Excellent' ? 'default' : 'secondary'}
                        className={metric.status === 'Optimal' || metric.status === 'Excellent' ? 'bg-green-600' : ''}
                      >
                        {metric.status}
                      </Badge>
                    </div>
                  ))}
                </div>
                <Button className="w-full mt-4" variant="outline" data-testid="button-detailed-performance">
                  View Detailed Performance Reports
                </Button>
              </CardContent>
            </Card>

            {/* Integration Hub */}
            <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
              <CardHeader>
                <CardTitle className="flex items-center text-gray-900 dark:text-white">
                  <Globe className="w-5 h-5 mr-2 text-green-500" />
                  Enterprise Integration Hub
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  {integrationCapabilities.map((integration, index) => (
                    <div key={index} className="p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                      <div className="flex items-center justify-between mb-2">
                        <h4 className="font-semibold text-gray-900 dark:text-white">{integration.system}</h4>
                        <Badge variant="default" className="bg-green-600">
                          {integration.status}
                        </Badge>
                      </div>
                      <div className="text-sm text-gray-600 dark:text-gray-400 mb-2">
                        {integration.providers.join(", ")}
                      </div>
                      <div className="flex items-center justify-between">
                        <span className="text-xs text-gray-500">Coverage: {integration.coverage}</span>
                        <CheckCircle className="w-4 h-4 text-green-500" />
                      </div>
                    </div>
                  ))}
                </div>
                <Button className="w-full mt-4" data-testid="button-integration-management">
                  Manage Enterprise Integrations
                </Button>
              </CardContent>
            </Card>
          </div>

          {/* Enterprise Command Actions */}
          <Card className="bg-gradient-to-r from-orange-500/10 to-red-500/10 border-orange-200 dark:border-orange-800">
            <CardHeader>
              <CardTitle className="flex items-center text-gray-900 dark:text-white">
                <Crown className="w-5 h-5 mr-2 text-orange-500" />
                Enterprise Command Actions
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <Button className="h-16 bg-blue-600 hover:bg-blue-700 text-white" data-testid="button-system-health">
                  <Activity className="w-5 h-5 mr-2" />
                  System Health Check
                </Button>
                <Button className="h-16 bg-green-600 hover:bg-green-700 text-white" data-testid="button-scale-resources">
                  <TrendingUp className="w-5 h-5 mr-2" />
                  Scale Resources
                </Button>
                <Button className="h-16 bg-purple-600 hover:bg-purple-700 text-white" data-testid="button-security-audit">
                  <Shield className="w-5 h-5 mr-2" />
                  Security Audit
                </Button>
                <Button className="h-16 bg-orange-600 hover:bg-orange-700 text-white" data-testid="button-performance-optimization">
                  <Zap className="w-5 h-5 mr-2" />
                  Optimize Performance
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/ExecutionCoordination.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { 
  Play, Clock, CheckCircle, Users, Target, Zap, 
  ArrowRight, Circle, AlertCircle, Pause, RotateCcw
} from "lucide-react";
import { useLocation } from "wouter";
import { useState } from "react";

interface ExecutionTask {
  id: string;
  title: string;
  assignee: string;
  role: string;
  status: 'pending' | 'blocked' | 'ready' | 'in_progress' | 'completed' | 'failed';
  isParallel: boolean;
  parallelGroup?: number;
  estimatedMinutes: number;
  actualMinutes?: number;
  startedAt?: string;
  completedAt?: string;
  dependencies: string[];
}

interface ExecutionPhase {
  id: string;
  name: string;
  startMinute: number;
  endMinute: number;
  tasks: ExecutionTask[];
}

// Sample execution scenarios for each category of the Strategic Triad
const sampleExecutions = {
  offense: {
    id: 'exec-offense-001',
    scenario: 'M&A Target Acquisition',
    category: 'offense',
    categoryLabel: 'OFFENSE',
    categoryColor: 'emerald',
    triggeredAt: new Date(Date.now() - 18 * 60000).toISOString(),
    status: 'running',
    totalTasks: 38,
    completedTasks: 24,
    currentPhase: 'secondary',
    phases: [
      {
        id: 'phase-1',
        name: 'OPPORTUNITY CAPTURE (0-2 min)',
        startMinute: 0,
        endMinute: 2,
        tasks: [
          { id: 't1', title: 'Activate acquisition playbook', assignee: 'CEO', role: 'Executive', status: 'completed', isParallel: true, parallelGroup: 1, estimatedMinutes: 1, actualMinutes: 1, dependencies: [] },
          { id: 't2', title: 'Alert M&A team', assignee: 'CFO', role: 'Finance', status: 'completed', isParallel: true, parallelGroup: 1, estimatedMinutes: 1, actualMinutes: 1, dependencies: [] },
          { id: 't3', title: 'Pull due diligence template', assignee: 'Legal', role: 'Legal', status: 'completed', isParallel: true, parallelGroup: 1, estimatedMinutes: 1, actualMinutes: 1, dependencies: [] },
        ]
      },
      {
        id: 'phase-2',
        name: 'DUE DILIGENCE (2-8 min)',
        startMinute: 2,
        endMinute: 8,
        tasks: [
          { id: 't4', title: 'Financial review checklist', assignee: 'CFO', role: 'Finance', status: 'completed', isParallel: true, parallelGroup: 2, estimatedMinutes: 5, actualMinutes: 4, dependencies: ['t1'] },
          { id: 't5', title: 'Legal risk assessment', assignee: 'General Counsel', role: 'Legal', status: 'in_progress', isParallel: true, parallelGroup: 2, estimatedMinutes: 5, dependencies: ['t3'] },
          { id: 't6', title: 'Technical integration planning', assignee: 'CTO', role: 'Technology', status: 'in_progress', isParallel: true, parallelGroup: 2, estimatedMinutes: 4, dependencies: ['t1'] },
        ]
      }
    ] as ExecutionPhase[]
  },
  defense: {
    id: 'exec-defense-001',
    scenario: 'Data Breach Response',
    category: 'defense',
    categoryLabel: 'DEFENSE',
    categoryColor: 'blue',
    triggeredAt: new Date(Date.now() - 25 * 60000).toISOString(),
    status: 'running',
    totalTasks: 47,
    completedTasks: 32,
    currentPhase: 'secondary',
    phases: [
      {
        id: 'phase-1',
        name: 'CONTAINMENT (0-2 min)',
        startMinute: 0,
        endMinute: 2,
        tasks: [
          { id: 't1', title: 'Contain breach - isolate systems', assignee: 'Mike Chen', role: 'CISO', status: 'completed', isParallel: true, parallelGroup: 1, estimatedMinutes: 2, actualMinutes: 1, dependencies: [] },
          { id: 't2', title: 'Preserve forensic evidence', assignee: 'Sarah Kim', role: 'IT Security', status: 'completed', isParallel: true, parallelGroup: 1, estimatedMinutes: 2, actualMinutes: 2, dependencies: [] },
          { id: 't3', title: 'Pull breach response template', assignee: 'James Wilson', role: 'Legal', status: 'completed', isParallel: true, parallelGroup: 1, estimatedMinutes: 1, actualMinutes: 1, dependencies: [] },
        ]
      },
      {
        id: 'phase-2',
        name: 'COORDINATION (2-5 min)',
        startMinute: 2,
        endMinute: 5,
        tasks: [
          { id: 't4', title: 'Draft public statement', assignee: 'Emily Roberts', role: 'Comms', status: 'completed', isParallel: false, estimatedMinutes: 5, actualMinutes: 4, dependencies: ['t3'] },
          { id: 't5', title: 'Review statement for compliance', assignee: 'James Wilson', role: 'Legal', status: 'in_progress', isParallel: false, estimatedMinutes: 3, dependencies: ['t4'] },
          { id: 't6', title: 'Notify regulatory bodies', assignee: 'Legal', role: 'Legal', status: 'pending', isParallel: false, estimatedMinutes: 5, dependencies: ['t5'] },
        ]
      }
    ] as ExecutionPhase[]
  },
  special_teams: {
    id: 'exec-special-001',
    scenario: 'AI Model Governance Review',
    category: 'special_teams',
    categoryLabel: 'SPECIAL TEAMS',
    categoryColor: 'purple',
    triggeredAt: new Date(Date.now() - 12 * 60000).toISOString(),
    status: 'running',
    totalTasks: 32,
    completedTasks: 18,
    currentPhase: 'primary',
    phases: [
      {
        id: 'phase-1',
        name: 'GOVERNANCE ACTIVATION (0-2 min)',
        startMinute: 0,
        endMinute: 2,
        tasks: [
          { id: 't1', title: 'Activate AI governance playbook', assignee: 'Chief AI Officer', role: 'AI', status: 'completed', isParallel: true, parallelGroup: 1, estimatedMinutes: 1, actualMinutes: 1, dependencies: [] },
          { id: 't2', title: 'Alert ethics review board', assignee: 'Ethics Lead', role: 'Compliance', status: 'completed', isParallel: true, parallelGroup: 1, estimatedMinutes: 1, actualMinutes: 1, dependencies: [] },
          { id: 't3', title: 'Pull AI principles framework', assignee: 'Legal', role: 'Legal', status: 'completed', isParallel: true, parallelGroup: 1, estimatedMinutes: 1, actualMinutes: 1, dependencies: [] },
        ]
      },
      {
        id: 'phase-2',
        name: 'ASSESSMENT (2-8 min)',
        startMinute: 2,
        endMinute: 8,
        tasks: [
          { id: 't4', title: 'Model bias assessment', assignee: 'Data Science Lead', role: 'AI', status: 'completed', isParallel: true, parallelGroup: 2, estimatedMinutes: 4, actualMinutes: 3, dependencies: ['t1'] },
          { id: 't5', title: 'Privacy impact analysis', assignee: 'Privacy Officer', role: 'Legal', status: 'in_progress', isParallel: true, parallelGroup: 2, estimatedMinutes: 4, dependencies: ['t3'] },
          { id: 't6', title: 'Explainability documentation', assignee: 'ML Engineer', role: 'Technology', status: 'in_progress', isParallel: true, parallelGroup: 2, estimatedMinutes: 3, dependencies: ['t1'] },
        ]
      }
    ] as ExecutionPhase[]
  }
};

type CategoryKey = 'offense' | 'defense' | 'special_teams';

const statusConfig = {
  pending: { color: 'bg-slate-200 text-slate-600', icon: Circle, label: 'Pending' },
  blocked: { color: 'bg-red-100 text-red-600', icon: AlertCircle, label: 'Blocked' },
  ready: { color: 'bg-blue-100 text-blue-600', icon: Play, label: 'Ready' },
  in_progress: { color: 'bg-amber-100 text-amber-600', icon: Pause, label: 'In Progress' },
  completed: { color: 'bg-emerald-100 text-emerald-600', icon: CheckCircle, label: 'Completed' },
  failed: { color: 'bg-red-100 text-red-600', icon: AlertCircle, label: 'Failed' },
};

export default function ExecutionCoordination() {
  const [, setLocation] = useLocation();
  const [selectedTask, setSelectedTask] = useState<ExecutionTask | null>(null);
  const [activeCategory, setActiveCategory] = useState<CategoryKey>('offense');
  
  const sampleExecution = sampleExecutions[activeCategory];
  const completionPercent = Math.round((sampleExecution.completedTasks / sampleExecution.totalTasks) * 100);
  const elapsedMinutes = Math.round((Date.now() - new Date(sampleExecution.triggeredAt).getTime()) / 60000);
  
  const categoryStyles = {
    offense: { bg: 'from-emerald-50 to-green-50 dark:from-emerald-950/40 dark:to-green-950/40', border: 'border-emerald-300 dark:border-emerald-700', text: 'text-emerald-600 dark:text-emerald-400', icon: 'bg-emerald-500' },
    defense: { bg: 'from-blue-50 to-indigo-50 dark:from-blue-950/40 dark:to-indigo-950/40', border: 'border-blue-300 dark:border-blue-700', text: 'text-blue-600 dark:text-blue-400', icon: 'bg-blue-500' },
    special_teams: { bg: 'from-purple-50 to-violet-50 dark:from-purple-950/40 dark:to-violet-950/40', border: 'border-purple-300 dark:border-purple-700', text: 'text-purple-600 dark:text-purple-400', icon: 'bg-purple-500' }
  };
  
  const currentStyle = categoryStyles[activeCategory];
  
  return (
    <div className="min-h-screen bg-slate-50 dark:bg-slate-900">
      <StandardNav />
      
      <div className="container mx-auto px-4 py-20">
        {/* Header */}
        <div className="mb-8">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-12 h-12 bg-gradient-to-br from-emerald-500 to-green-600 rounded-xl flex items-center justify-center">
              <Zap className="h-6 w-6 text-white" />
            </div>
            <div>
              <h1 className="text-3xl font-bold text-slate-900 dark:text-white" data-testid="page-title">
                Execution Coordination
              </h1>
              <p className="text-slate-600 dark:text-slate-400">
                Real-time coordinated response tracking
              </p>
            </div>
          </div>
        </div>
        
        {/* Strategic Triad Selector */}
        <div className="grid grid-cols-3 gap-4 mb-6">
          <button
            onClick={() => setActiveCategory('offense')}
            className={`p-4 rounded-xl border-2 transition-all cursor-pointer ${
              activeCategory === 'offense' 
                ? 'border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30 ring-2 ring-emerald-400/50' 
                : 'border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 hover:border-emerald-300'
            }`}
            data-testid="triad-offense"
          >
            <p className="text-xs uppercase tracking-wider text-emerald-600 dark:text-emerald-400 font-semibold mb-1">OFFENSE</p>
            <p className={`text-sm ${activeCategory === 'offense' ? 'text-emerald-700 dark:text-emerald-300 font-medium' : 'text-slate-600 dark:text-slate-400'}`}>
              {activeCategory === 'offense' ? 'M&A Target Acquisition' : 'Seize Opportunities'}
            </p>
          </button>
          <button
            onClick={() => setActiveCategory('defense')}
            className={`p-4 rounded-xl border-2 transition-all cursor-pointer ${
              activeCategory === 'defense' 
                ? 'border-blue-500 bg-blue-50 dark:bg-blue-950/30 ring-2 ring-blue-400/50' 
                : 'border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 hover:border-blue-300'
            }`}
            data-testid="triad-defense"
          >
            <p className="text-xs uppercase tracking-wider text-blue-600 dark:text-blue-400 font-semibold mb-1">DEFENSE</p>
            <p className={`text-sm ${activeCategory === 'defense' ? 'text-blue-700 dark:text-blue-300 font-medium' : 'text-slate-600 dark:text-slate-400'}`}>
              {activeCategory === 'defense' ? 'Data Breach Response' : 'Protect Value'}
            </p>
          </button>
          <button
            onClick={() => setActiveCategory('special_teams')}
            className={`p-4 rounded-xl border-2 transition-all cursor-pointer ${
              activeCategory === 'special_teams' 
                ? 'border-purple-500 bg-purple-50 dark:bg-purple-950/30 ring-2 ring-purple-400/50' 
                : 'border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 hover:border-purple-300'
            }`}
            data-testid="triad-special"
          >
            <p className="text-xs uppercase tracking-wider text-purple-600 dark:text-purple-400 font-semibold mb-1">SPECIAL TEAMS</p>
            <p className={`text-sm ${activeCategory === 'special_teams' ? 'text-purple-700 dark:text-purple-300 font-medium' : 'text-slate-600 dark:text-slate-400'}`}>
              {activeCategory === 'special_teams' ? 'AI Model Governance' : 'Drive Innovation'}
            </p>
          </button>
        </div>
        
        {/* Game Day Mindset Banner */}
        <Card className={`mb-8 bg-gradient-to-r ${currentStyle.bg} border-2 ${currentStyle.border}`} data-testid="game-day-banner">
          <CardContent className="p-6">
            <div className="flex flex-col md:flex-row items-center justify-between gap-4">
              <div className="flex items-center gap-4">
                <div className={`w-16 h-16 ${currentStyle.icon} rounded-full flex items-center justify-center`}>
                  <Zap className="h-8 w-8 text-white" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-slate-900 dark:text-white mb-1">
                    Game Day Execution
                  </p>
                  <p className="text-lg text-slate-600 dark:text-slate-400">
                    You prepared all week. Now just executewhether seizing an opportunity, defending against a threat, or driving innovation.
                  </p>
                </div>
              </div>
              <div className="text-center md:text-right">
                <p className="text-sm text-slate-500 mb-1">The Mindset:</p>
                <p className={`text-lg font-semibold ${currentStyle.text}`}>
                  "Comfortable. Confident. Prepared."
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
        
        {/* Active Execution Banner */}
        <Card className="mb-8 bg-gradient-to-r from-emerald-50 to-green-50 dark:from-emerald-950/30 dark:to-green-950/30 border-emerald-200 dark:border-emerald-800">
          <CardContent className="p-6">
            <div className="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
              <div>
                <div className="flex items-center gap-2 mb-2">
                  <Badge className="bg-emerald-500 text-white animate-pulse">LIVE</Badge>
                  <span className="text-2xl font-bold text-slate-900 dark:text-white" data-testid="text-scenario">
                    {sampleExecution.scenario}
                  </span>
                </div>
                <p className="text-slate-600 dark:text-slate-400">
                  Triggered {elapsedMinutes} minutes ago  {sampleExecution.completedTasks}/{sampleExecution.totalTasks} tasks complete
                </p>
              </div>
              
              <div className="flex items-center gap-6">
                <div className="text-center">
                  <div className="text-3xl font-bold text-emerald-600" data-testid="text-completion">
                    {completionPercent}%
                  </div>
                  <div className="text-sm text-slate-500">Complete</div>
                </div>
                <div className="text-center">
                  <div className="text-3xl font-bold text-blue-600" data-testid="text-elapsed">
                    {elapsedMinutes}m
                  </div>
                  <div className="text-sm text-slate-500">Elapsed</div>
                </div>
                <div className="text-center">
                  <div className="text-3xl font-bold text-amber-600">
                    ~{Math.max(0, 45 - elapsedMinutes)}m
                  </div>
                  <div className="text-sm text-slate-500">Remaining</div>
                </div>
              </div>
            </div>
            
            <Progress value={completionPercent} className="mt-4 h-3" />
          </CardContent>
        </Card>
        
        {/* Metrics Row */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <Card className="bg-white dark:bg-slate-800">
            <CardContent className="p-4 flex items-center gap-3">
              <div className="w-10 h-10 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg flex items-center justify-center">
                <CheckCircle className="h-5 w-5 text-emerald-600" />
              </div>
              <div>
                <div className="text-2xl font-bold text-slate-900 dark:text-white" data-testid="metric-completed">
                  {sampleExecution.completedTasks}
                </div>
                <div className="text-sm text-slate-500">Completed</div>
              </div>
            </CardContent>
          </Card>
          
          <Card className="bg-white dark:bg-slate-800">
            <CardContent className="p-4 flex items-center gap-3">
              <div className="w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center">
                <Play className="h-5 w-5 text-amber-600" />
              </div>
              <div>
                <div className="text-2xl font-bold text-slate-900 dark:text-white">
                  {sampleExecution.phases.flatMap(p => p.tasks).filter(t => t.status === 'in_progress').length}
                </div>
                <div className="text-sm text-slate-500">In Progress</div>
              </div>
            </CardContent>
          </Card>
          
          <Card className="bg-white dark:bg-slate-800">
            <CardContent className="p-4 flex items-center gap-3">
              <div className="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                <Users className="h-5 w-5 text-blue-600" />
              </div>
              <div>
                <div className="text-2xl font-bold text-slate-900 dark:text-white">
                  12
                </div>
                <div className="text-sm text-slate-500">Stakeholders</div>
              </div>
            </CardContent>
          </Card>
          
          <Card className="bg-white dark:bg-slate-800">
            <CardContent className="p-4 flex items-center gap-3">
              <div className="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
                <Target className="h-5 w-5 text-purple-600" />
              </div>
              <div>
                <div className="text-2xl font-bold text-slate-900 dark:text-white">
                  45m
                </div>
                <div className="text-sm text-slate-500">Target Time</div>
              </div>
            </CardContent>
          </Card>
        </div>
        
        {/* Phase-based Task View */}
        <Tabs defaultValue="timeline" className="mb-8">
          <TabsList className="mb-4">
            <TabsTrigger value="timeline" data-testid="tab-timeline">Timeline View</TabsTrigger>
            <TabsTrigger value="roles" data-testid="tab-roles">By Role</TabsTrigger>
            <TabsTrigger value="dependencies" data-testid="tab-dependencies">Dependencies</TabsTrigger>
          </TabsList>
          
          <TabsContent value="timeline">
            <div className="space-y-6">
              {sampleExecution.phases.map((phase, phaseIndex) => {
                const phaseTasks = phase.tasks;
                const completedCount = phaseTasks.filter(t => t.status === 'completed').length;
                const phaseComplete = completedCount === phaseTasks.length;
                
                return (
                  <Card 
                    key={phase.id} 
                    className={`${phaseComplete ? 'border-emerald-200 dark:border-emerald-800' : 'border-slate-200 dark:border-slate-700'}`}
                    data-testid={`card-phase-${phaseIndex}`}
                  >
                    <CardHeader className="pb-2">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className={`w-8 h-8 rounded-full flex items-center justify-center ${phaseComplete ? 'bg-emerald-500' : 'bg-slate-200 dark:bg-slate-700'}`}>
                            {phaseComplete ? (
                              <CheckCircle className="h-5 w-5 text-white" />
                            ) : (
                              <span className="text-sm font-bold text-slate-600 dark:text-slate-300">{phaseIndex + 1}</span>
                            )}
                          </div>
                          <div>
                            <CardTitle className="text-lg">{phase.name}</CardTitle>
                            <CardDescription>
                              {completedCount}/{phaseTasks.length} tasks complete
                            </CardDescription>
                          </div>
                        </div>
                        <Badge variant={phaseComplete ? 'default' : 'outline'} className={phaseComplete ? 'bg-emerald-500' : ''}>
                          {phaseComplete ? 'Complete' : 'In Progress'}
                        </Badge>
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-2">
                        {phaseTasks.map((task) => {
                          const config = statusConfig[task.status];
                          const StatusIcon = config.icon;
                          
                          return (
                            <div 
                              key={task.id}
                              className={`flex items-center justify-between p-3 rounded-lg border ${
                                task.status === 'in_progress' 
                                  ? 'border-amber-200 bg-amber-50 dark:border-amber-800 dark:bg-amber-900/10' 
                                  : 'border-slate-100 dark:border-slate-800'
                              }`}
                              data-testid={`task-${task.id}`}
                            >
                              <div className="flex items-center gap-3">
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center ${config.color}`}>
                                  <StatusIcon className="h-4 w-4" />
                                </div>
                                <div>
                                  <div className="font-medium text-slate-900 dark:text-white">
                                    {task.title}
                                  </div>
                                  <div className="text-sm text-slate-500">
                                    {task.assignee}  {task.role}
                                    {task.isParallel && (
                                      <Badge variant="outline" className="ml-2 text-xs">Parallel</Badge>
                                    )}
                                  </div>
                                </div>
                              </div>
                              <div className="flex items-center gap-4">
                                <div className="text-right text-sm">
                                  {task.actualMinutes ? (
                                    <span className="text-emerald-600">{task.actualMinutes}m</span>
                                  ) : (
                                    <span className="text-slate-400">~{task.estimatedMinutes}m</span>
                                  )}
                                </div>
                                {task.status === 'ready' && (
                                  <Button size="sm" className="bg-emerald-600 hover:bg-emerald-700" data-testid={`button-start-${task.id}`}>
                                    Start
                                  </Button>
                                )}
                                {task.status === 'in_progress' && (
                                  <Button size="sm" variant="outline" data-testid={`button-complete-${task.id}`}>
                                    Complete
                                  </Button>
                                )}
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </CardContent>
                  </Card>
                );
              })}
            </div>
          </TabsContent>
          
          <TabsContent value="roles">
            <Card>
              <CardContent className="p-6">
                <p className="text-slate-500 text-center py-8">
                  Role-based view coming soon - see tasks grouped by assignee
                </p>
              </CardContent>
            </Card>
          </TabsContent>
          
          <TabsContent value="dependencies">
            <Card>
              <CardContent className="p-6">
                <p className="text-slate-500 text-center py-8">
                  Dependency graph coming soon - visualize task dependencies and critical path
                </p>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
        
        {/* Key Insight Banner */}
        <Card className="bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800">
          <CardContent className="p-6">
            <div className="flex items-start gap-4">
              <div className="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center flex-shrink-0">
                <Clock className="h-6 w-6 text-blue-600" />
              </div>
              <div>
                <h3 className="text-lg font-semibold text-slate-900 dark:text-white mb-1">
                  Industry Comparison
                </h3>
                <p className="text-slate-600 dark:text-slate-400">
                  Without M Platform, this coordinated response would take <span className="font-bold text-red-600">72 hours to decide + 2 weeks to execute</span>. 
                  With M Platform, you're on track to complete in <span className="font-bold text-emerald-600">~45 minutes total</span>.
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
      
      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/ExecutiveAnalyticsDashboard.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Link } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import ROIDashboard from '@/components/ROIDashboard';
import { 
  BarChart3, 
  TrendingUp, 
  TrendingDown,
  DollarSign, 
  Users, 
  Target, 
  Activity, 
  AlertTriangle,
  CheckCircle,
  Clock,
  Globe,
  Zap,
  Eye,
  Brain,
  Download,
  Filter,
  Calendar,
  PieChart,
  LineChart,
  BarChart,
  ArrowLeft,
  Home
} from 'lucide-react';

interface ExecutiveMetric {
  id: string;
  name: string;
  value: string;
  change: string;
  trend: 'up' | 'down' | 'stable';
  category: string;
  description: string;
  benchmark?: string;
}

interface PerformanceInsight {
  id: string;
  title: string;
  category: 'opportunity' | 'risk' | 'achievement' | 'alert';
  priority: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  actionRequired: boolean;
  impact: string;
  recommendations: string[];
  confidence: number;
}

interface DepartmentPerformance {
  department: string;
  performance: number;
  budget: number;
  headcount: number;
  kpis: {
    name: string;
    value: number;
    target: number;
    trend: 'up' | 'down' | 'stable';
  }[];
}

export default function ExecutiveAnalyticsDashboard() {
  const [activeTab, setActiveTab] = useState('overview');
  const [timeRange, setTimeRange] = useState('quarter');
  const [executiveMetrics, setExecutiveMetrics] = useState<ExecutiveMetric[]>([]);
  const [performanceInsights, setPerformanceInsights] = useState<PerformanceInsight[]>([]);
  const [departmentData, setDepartmentData] = useState<DepartmentPerformance[]>([]);
  const [realTimeData, setRealTimeData] = useState({
    activeUsers: 2847,
    revenue: 2845000,
    conversionRate: 3.42,
    customerSat: 94.2,
    systemHealth: 99.1
  });

  useEffect(() => {
    // Load executive metrics
    const metrics: ExecutiveMetric[] = [
      {
        id: 'revenue',
        name: 'Quarterly Revenue',
        value: '$2.85M',
        change: '+12.4%',
        trend: 'up',
        category: 'Financial',
        description: 'Total revenue for current quarter vs previous quarter',
        benchmark: 'Industry avg: +8.2%'
      },
      {
        id: 'profit-margin',
        name: 'Profit Margin',
        value: '18.7%',
        change: '+2.1%',
        trend: 'up',
        category: 'Financial',
        description: 'Net profit margin improvement through operational efficiency',
        benchmark: 'Industry avg: 15.3%'
      },
      {
        id: 'customer-acquisition',
        name: 'Customer Acquisition',
        value: '1,247',
        change: '+23.6%',
        trend: 'up',
        category: 'Growth',
        description: 'New customers acquired this quarter',
        benchmark: 'Target: 1,200'
      },
      {
        id: 'customer-retention',
        name: 'Customer Retention',
        value: '94.2%',
        change: '+1.8%',
        trend: 'up',
        category: 'Growth',
        description: 'Customer retention rate improvement',
        benchmark: 'Industry avg: 89.5%'
      },
      {
        id: 'employee-satisfaction',
        name: 'Employee Satisfaction',
        value: '87.5%',
        change: '+5.2%',
        trend: 'up',
        category: 'Operations',
        description: 'Employee satisfaction survey results',
        benchmark: 'Target: 85%'
      },
      {
        id: 'market-share',
        name: 'Market Share',
        value: '23.8%',
        change: '+3.4%',
        trend: 'up',
        category: 'Market',
        description: 'Market share growth in core segments',
        benchmark: 'Competitor avg: 18.2%'
      },
      {
        id: 'operational-efficiency',
        name: 'Operational Efficiency',
        value: '92.1%',
        change: '+4.7%',
        trend: 'up',
        category: 'Operations',
        description: 'Overall operational efficiency rating',
        benchmark: 'Target: 90%'
      },
      {
        id: 'innovation-index',
        name: 'Innovation Index',
        value: '8.3/10',
        change: '+0.6',
        trend: 'up',
        category: 'Innovation',
        description: 'Innovation capability and R&D effectiveness',
        benchmark: 'Industry avg: 7.1/10'
      }
    ];

    const insights: PerformanceInsight[] = [
      {
        id: 'insight-1',
        title: 'Digital Transformation ROI Acceleration',
        category: 'achievement',
        priority: 'high',
        description: 'Digital transformation initiatives have exceeded ROI projections by 34%, delivering $1.2M additional value.',
        actionRequired: false,
        impact: '$1.2M additional value',
        recommendations: ['Accelerate Phase 2 implementation', 'Expand to additional business units', 'Document best practices'],
        confidence: 94
      },
      {
        id: 'insight-2',
        title: 'Supply Chain Optimization Opportunity',
        category: 'opportunity',
        priority: 'medium',
        description: 'AI analysis identifies 18% cost reduction potential through supplier consolidation and logistics optimization.',
        actionRequired: true,
        impact: '$450K annual savings',
        recommendations: ['Conduct supplier assessment', 'Implement logistics AI', 'Negotiate volume discounts'],
        confidence: 87
      },
      {
        id: 'insight-3',
        title: 'Customer Acquisition Cost Trend',
        category: 'alert',
        priority: 'medium',
        description: 'Customer acquisition costs have increased 15% due to competitive market conditions and ad spend inflation.',
        actionRequired: true,
        impact: '+$47 per acquisition',
        recommendations: ['Optimize marketing channels', 'Improve conversion funnels', 'Explore referral programs'],
        confidence: 91
      },
      {
        id: 'insight-4',
        title: 'Team Productivity Surge',
        category: 'achievement',
        priority: 'low',
        description: 'Implementation of new collaboration tools has increased team productivity by 28% across all departments.',
        actionRequired: false,
        impact: '28% productivity increase',
        recommendations: ['Share success metrics', 'Expand tool rollout', 'Recognition program'],
        confidence: 96
      }
    ];

    const departments: DepartmentPerformance[] = [
      {
        department: 'Sales',
        performance: 112,
        budget: 2400000,
        headcount: 24,
        kpis: [
          { name: 'Revenue Target', value: 112, target: 100, trend: 'up' },
          { name: 'Pipeline Health', value: 134, target: 120, trend: 'up' },
          { name: 'Conversion Rate', value: 98, target: 100, trend: 'stable' }
        ]
      },
      {
        department: 'Marketing',
        performance: 108,
        budget: 1800000,
        headcount: 18,
        kpis: [
          { name: 'Lead Generation', value: 124, target: 110, trend: 'up' },
          { name: 'Brand Awareness', value: 103, target: 105, trend: 'stable' },
          { name: 'Campaign ROI', value: 156, target: 130, trend: 'up' }
        ]
      },
      {
        department: 'Product',
        performance: 95,
        budget: 3200000,
        headcount: 32,
        kpis: [
          { name: 'Feature Delivery', value: 87, target: 95, trend: 'down' },
          { name: 'Quality Score', value: 94, target: 90, trend: 'up' },
          { name: 'User Satisfaction', value: 104, target: 100, trend: 'up' }
        ]
      },
      {
        department: 'Operations',
        performance: 104,
        budget: 1600000,
        headcount: 28,
        kpis: [
          { name: 'Efficiency Rating', value: 108, target: 100, trend: 'up' },
          { name: 'Cost Control', value: 96, target: 98, trend: 'stable' },
          { name: 'Process Optimization', value: 118, target: 110, trend: 'up' }
        ]
      }
    ];

    setExecutiveMetrics(metrics);
    setPerformanceInsights(insights);
    setDepartmentData(departments);

    // Update real-time data every 30 seconds
    const interval = setInterval(() => {
      setRealTimeData(prev => ({
        activeUsers: prev.activeUsers + Math.floor(Math.random() * 20 - 10),
        revenue: prev.revenue + Math.floor(Math.random() * 10000 - 5000),
        conversionRate: +(prev.conversionRate + (Math.random() * 0.2 - 0.1)).toFixed(2),
        customerSat: +(prev.customerSat + (Math.random() * 1 - 0.5)).toFixed(1),
        systemHealth: +(prev.systemHealth + (Math.random() * 0.5 - 0.25)).toFixed(1)
      }));
    }, 30000);

    return () => clearInterval(interval);
  }, []);

  const getTrendIcon = (trend: string) => {
    switch (trend) {
      case 'up': return <TrendingUp className="h-4 w-4 text-emerald-400" />;
      case 'down': return <TrendingDown className="h-4 w-4 text-red-400" />;
      default: return <Activity className="h-4 w-4 text-amber-400" />;
    }
  };

  const getInsightColor = (category: string) => {
    switch (category) {
      case 'achievement': return 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30';
      case 'opportunity': return 'bg-blue-500/20 text-blue-300 border-blue-500/30';
      case 'risk': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'alert': return 'bg-amber-500/20 text-amber-300 border-amber-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'critical': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'high': return 'bg-orange-500/20 text-orange-300 border-orange-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30';
      case 'low': return 'bg-green-500/20 text-green-300 border-green-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(amount);
  };

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-y-auto p-8 space-y-8">
        
        {/* Breadcrumb Navigation */}
        <div className="mb-6">
          <div className="flex items-center gap-2 text-sm text-gray-400">
            <Link to="/">
              <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                <Home className="h-4 w-4" />
              </Button>
            </Link>
            <span>/</span>
            <span>Analytics & Intelligence</span>
            <span>/</span>
            <span className="text-white">Executive Dashboard</span>
          </div>
        </div>

        {/* Executive Dashboard Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-white mb-2">Executive Analytics Dashboard</h1>
            <p className="text-slate-300">Fortune 1000-grade business intelligence and performance analytics</p>
          </div>
          <div className="flex items-center gap-4">
            <Link to="/">
              <Button variant="secondary" className="bg-slate-700 hover:bg-slate-600 text-slate-100 border-slate-600">
                <ArrowLeft className="h-4 w-4 mr-2" />
                Dashboard
              </Button>
            </Link>
            <Select value={timeRange} onValueChange={setTimeRange}>
              <SelectTrigger className="w-40 bg-slate-800 border-slate-600 text-white">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="week">This Week</SelectItem>
                <SelectItem value="month">This Month</SelectItem>
                <SelectItem value="quarter">This Quarter</SelectItem>
                <SelectItem value="year">This Year</SelectItem>
              </SelectContent>
            </Select>
            <Button className="bg-blue-600 hover:bg-blue-700">
              <Download className="w-4 h-4 mr-2" />
              Export Report
            </Button>
          </div>
        </div>

        {/* Real-Time Metrics */}
        <div className="grid grid-cols-1 md:grid-cols-5 gap-6">
          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Active Users</h3>
                <Users className="h-5 w-5 text-blue-400" />
              </div>
              <div className="text-2xl font-bold text-white">{realTimeData.activeUsers.toLocaleString()}</div>
              <div className="text-sm text-slate-400">Live concurrent users</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Revenue</h3>
                <DollarSign className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{formatCurrency(realTimeData.revenue)}</div>
              <div className="text-sm text-slate-400">Today's revenue</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Conversion</h3>
                <Target className="h-5 w-5 text-purple-400" />
              </div>
              <div className="text-2xl font-bold text-white">{realTimeData.conversionRate}%</div>
              <div className="text-sm text-slate-400">Conversion rate</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Customer Sat</h3>
                <CheckCircle className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{realTimeData.customerSat}%</div>
              <div className="text-sm text-slate-400">Satisfaction score</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">System Health</h3>
                <Activity className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{realTimeData.systemHealth}%</div>
              <div className="text-sm text-slate-400">Platform uptime</div>
            </CardContent>
          </Card>
        </div>

        {/* Main Analytics Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="bg-slate-800/50 border border-slate-700/50">
            <TabsTrigger value="overview" className="data-[state=active]:bg-slate-700">Executive Overview</TabsTrigger>
            <TabsTrigger value="performance" className="data-[state=active]:bg-slate-700">Performance</TabsTrigger>
            <TabsTrigger value="roi" className="data-[state=active]:bg-slate-700">ROI Analytics</TabsTrigger>
            <TabsTrigger value="insights" className="data-[state=active]:bg-slate-700">AI Insights</TabsTrigger>
            <TabsTrigger value="departments" className="data-[state=active]:bg-slate-700">Departments</TabsTrigger>
            <TabsTrigger value="forecasting" className="data-[state=active]:bg-slate-700">Forecasting</TabsTrigger>
          </TabsList>

          {/* Executive Overview */}
          <TabsContent value="overview" className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              {executiveMetrics.map((metric) => (
                <Card key={metric.id} className="bg-slate-900/50 border-slate-700/50 hover:bg-slate-800/50 transition-all duration-300">
                  <CardContent className="p-6">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="font-semibold text-white">{metric.name}</h3>
                      {getTrendIcon(metric.trend)}
                    </div>
                    <div className="text-2xl font-bold text-white mb-2">{metric.value}</div>
                    <div className={`text-sm mb-2 ${metric.trend === 'up' ? 'text-emerald-400' : metric.trend === 'down' ? 'text-red-400' : 'text-amber-400'}`}>
                      {metric.change} vs previous period
                    </div>
                    <div className="text-xs text-slate-400">{metric.description}</div>
                    {metric.benchmark && (
                      <div className="text-xs text-slate-500 mt-2">{metric.benchmark}</div>
                    )}
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Performance Analytics */}
          <TabsContent value="performance" className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              {/* Performance Chart Placeholder */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <BarChart3 className="h-5 w-5" />
                    Revenue Trend Analysis
                  </CardTitle>
                </CardHeader>
                <CardContent className="p-6">
                  <div className="h-64 flex items-center justify-center bg-slate-800/50 rounded-lg">
                    <div className="text-center">
                      <LineChart className="h-16 w-16 text-slate-400 mx-auto mb-4" />
                      <p className="text-slate-400">Interactive revenue chart</p>
                      <p className="text-xs text-slate-500">12.4% growth trajectory</p>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* KPI Performance */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Target className="h-5 w-5" />
                    KPI Performance
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  {[
                    { name: 'Revenue Growth', value: 112, target: 110, unit: '%' },
                    { name: 'Customer Retention', value: 94, target: 90, unit: '%' },
                    { name: 'Market Share', value: 24, target: 25, unit: '%' },
                    { name: 'Profit Margin', value: 19, target: 18, unit: '%' }
                  ].map((kpi, index) => (
                    <div key={index} className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span className="text-white">{kpi.name}</span>
                        <span className={`${kpi.value >= kpi.target ? 'text-emerald-400' : 'text-amber-400'}`}>
                          {kpi.value}{kpi.unit} / {kpi.target}{kpi.unit}
                        </span>
                      </div>
                      <Progress value={(kpi.value / kpi.target) * 100} className="h-2" />
                    </div>
                  ))}
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* ROI Analytics */}
          <TabsContent value="roi" className="space-y-6">
            <ROIDashboard />
          </TabsContent>

          {/* AI Insights */}
          <TabsContent value="insights" className="space-y-6">
            <div className="space-y-4">
              {performanceInsights.map((insight) => (
                <Card key={insight.id} className="bg-slate-900/50 border-slate-700/50">
                  <CardContent className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex-1 page-background">
                        <div className="flex items-center gap-3 mb-2">
                          <h3 className="text-lg font-semibold text-white">{insight.title}</h3>
                          <Badge className={getInsightColor(insight.category)}>
                            {insight.category.toUpperCase()}
                          </Badge>
                          <Badge className={getPriorityColor(insight.priority)}>
                            {insight.priority.toUpperCase()}
                          </Badge>
                        </div>
                        <p className="text-slate-300 mb-4">{insight.description}</p>
                      </div>
                      <div className="text-right">
                        <div className="text-sm text-slate-400">Confidence</div>
                        <div className="text-xl font-bold text-white">{insight.confidence}%</div>
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <div className="text-sm font-semibold text-white mb-2">Impact</div>
                        <div className="text-emerald-400 font-medium">{insight.impact}</div>
                      </div>
                      
                      <div>
                        <div className="text-sm font-semibold text-white mb-2">Recommendations</div>
                        <div className="space-y-1">
                          {insight.recommendations.map((rec, index) => (
                            <div key={index} className="text-sm text-slate-300 flex items-center gap-2">
                              <div className="w-1.5 h-1.5 bg-blue-400 rounded-full" />
                              {rec}
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                    
                    {insight.actionRequired && (
                      <div className="mt-4 pt-4 border-t border-slate-700">
                        <Button className="bg-blue-600 hover:bg-blue-700">
                          <Zap className="w-4 h-4 mr-2" />
                          Take Action
                        </Button>
                      </div>
                    )}
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Department Performance */}
          <TabsContent value="departments" className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {departmentData.map((dept) => (
                <Card key={dept.department} className="bg-slate-900/50 border-slate-700/50">
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-white">{dept.department}</CardTitle>
                      <Badge className={dept.performance >= 100 ? 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30' : 'bg-amber-500/20 text-amber-300 border-amber-500/30'}>
                        {dept.performance}% Performance
                      </Badge>
                    </div>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <div className="text-slate-400">Budget</div>
                        <div className="text-white font-medium">{formatCurrency(dept.budget)}</div>
                      </div>
                      <div>
                        <div className="text-slate-400">Headcount</div>
                        <div className="text-white font-medium">{dept.headcount} people</div>
                      </div>
                    </div>
                    
                    <div className="space-y-3">
                      {dept.kpis.map((kpi, index) => (
                        <div key={index} className="space-y-1">
                          <div className="flex justify-between text-sm">
                            <span className="text-white">{kpi.name}</span>
                            <div className="flex items-center gap-2">
                              <span className={`${kpi.value >= kpi.target ? 'text-emerald-400' : 'text-amber-400'}`}>
                                {kpi.value}% / {kpi.target}%
                              </span>
                              {getTrendIcon(kpi.trend)}
                            </div>
                          </div>
                          <Progress value={Math.min((kpi.value / kpi.target) * 100, 100)} className="h-1.5" />
                        </div>
                      ))}
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Forecasting */}
          <TabsContent value="forecasting" className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              {/* Revenue Forecast */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <TrendingUp className="h-5 w-5" />
                    Revenue Forecast
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="h-48 flex items-center justify-center bg-slate-800/50 rounded-lg">
                    <div className="text-center">
                      <BarChart className="h-12 w-12 text-slate-400 mx-auto mb-2" />
                      <p className="text-slate-400">Predictive revenue model</p>
                    </div>
                  </div>
                  <div className="grid grid-cols-2 gap-4 text-sm">
                    <div>
                      <div className="text-slate-400">Q2 Forecast</div>
                      <div className="text-white font-medium">$3.2M (+12.3%)</div>
                    </div>
                    <div>
                      <div className="text-slate-400">Confidence</div>
                      <div className="text-emerald-400 font-medium">87%</div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Market Trends */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Globe className="h-5 w-5" />
                    Market Intelligence
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="space-y-3">
                    <div className="p-3 bg-slate-800/50 rounded-lg">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-white font-medium">Market Growth</span>
                        <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">POSITIVE</Badge>
                      </div>
                      <div className="text-sm text-slate-400">Industry expanding 8.2% annually</div>
                    </div>
                    <div className="p-3 bg-slate-800/50 rounded-lg">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-white font-medium">Competitive Position</span>
                        <Badge className="bg-blue-500/20 text-blue-300 border-blue-500/30">STRONG</Badge>
                      </div>
                      <div className="text-sm text-slate-400">Top 3 market position maintained</div>
                    </div>
                    <div className="p-3 bg-slate-800/50 rounded-lg">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-white font-medium">Customer Demand</span>
                        <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">HIGH</Badge>
                      </div>
                      <div className="text-sm text-slate-400">23% increase in qualified leads</div>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/ExecutiveDashboard.tsx
========================================
import { useEffect, useState } from 'react';
import { useQuery } from '@tanstack/react-query';
import { updatePageMetadata } from '@/lib/seo';
import PageLayout from '@/components/layout/PageLayout';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Progress } from '@/components/ui/progress';
import DecisionVelocityDashboard from '@/components/DecisionVelocityDashboard';
import { 
  Shield, 
  Zap, 
  Target, 
  AlertTriangle,
  Activity,
  ArrowUpRight,
  ArrowDownRight,
  Minus,
  Brain,
  TrendingUp,
  Eye,
  Clock,
  BarChart3,
  RefreshCw,
  Sparkles,
  CheckCircle,
  Radio,
  ChevronRight,
  Layers
} from 'lucide-react';
import { Link } from 'wouter';
import { format } from 'date-fns';
import { queryClient } from '@/lib/queryClient';

function StatusIndicator({ status }: { status: 'good' | 'warning' | 'critical' }) {
  const config = {
    good: { bg: 'bg-emerald-500', className: 'text-emerald-600 dark:text-emerald-400', label: 'Healthy' },
    warning: { bg: 'bg-amber-500', className: 'text-amber-600 dark:text-amber-400', label: 'Attention' },
    critical: { bg: 'bg-red-500', className: 'text-red-600 dark:text-red-400', label: 'Critical' }
  };
  const c = config[status];
  
  return (
    <div className="flex items-center gap-2">
      <div className={`w-2.5 h-2.5 rounded-full ${c.bg}`} />
      <span className={`text-sm font-medium ${c.className}`}>{c.label}</span>
    </div>
  );
}

function MetricCard({ 
  title, 
  value, 
  unit,
  trend,
  trendDirection,
  status,
  icon: Icon,
  description
}: {
  title: string;
  value: string | number;
  unit?: string;
  trend?: string;
  trendDirection?: 'up' | 'down' | 'neutral';
  status: 'good' | 'warning' | 'critical';
  icon: any;
  description?: string;
}) {
  const statusBorders = {
    good: 'border-l-emerald-500',
    warning: 'border-l-amber-500',
    critical: 'border-l-red-500'
  };

  const trendIcons = {
    up: ArrowUpRight,
    down: ArrowDownRight,
    neutral: Minus
  };
  const TrendIcon = trendDirection ? trendIcons[trendDirection] : null;

  const trendClasses = {
    up: 'text-emerald-600 dark:text-emerald-400',
    down: 'text-red-600 dark:text-red-400',
    neutral: 'text-slate-500 dark:text-slate-400'
  };

  return (
    <Card className={`border-l-4 ${statusBorders[status]} hover:shadow-md transition-shadow`}>
      <CardContent className="pt-5 space-y-3">
        <div className="flex items-center justify-between">
          <div className="p-2 rounded-lg bg-blue-50 dark:bg-blue-900/30">
            <Icon className="h-5 w-5 text-blue-600 dark:text-blue-400" />
          </div>
          <StatusIndicator status={status} />
        </div>
        <div>
          <div className="text-sm font-medium text-slate-500 dark:text-slate-400 mb-1">{title}</div>
          <div className="flex items-baseline gap-1">
            <span className="text-3xl font-bold text-slate-900 dark:text-white">{value}</span>
            {unit && <span className="text-lg text-slate-400 dark:text-slate-500">{unit}</span>}
          </div>
        </div>
        {trend && trendDirection && TrendIcon && (
          <div className={`flex items-center gap-1 text-sm ${trendClasses[trendDirection]}`}>
            <TrendIcon className="h-4 w-4" />
            <span>{trend}</span>
          </div>
        )}
        {description && (
          <p className="text-xs text-slate-500 dark:text-slate-400">{description}</p>
        )}
      </CardContent>
    </Card>
  );
}

interface ReadinessMetric {
  id: string;
  organizationId: string;
  overallScore: string;
  playbookMaturity: string;
  executionVelocity: string;
  learningRate: string;
  signalDetection: string;
  insights: Record<string, any>;
  calculatedAt: string;
}

interface WeakSignal {
  id: string;
  title: string;
  urgency: string;
  confidence: string;
  description: string;
  detectedAt: string;
}

interface OraclePattern {
  id: string;
  title: string;
  impact: string;
  confidence: string;
  description: string;
}

export default function ExecutiveDashboard() {
  const [activeTab, setActiveTab] = useState('overview');

  useEffect(() => {
    updatePageMetadata({
      title: "Executive Dashboard | M Strategic Execution OS",
      description: "Your unified strategic command center. Monitor Future Readiness Index, decision velocity, and organizational preparedness in real-time.",
      ogTitle: "Executive Dashboard | M",
      ogDescription: "Real-time executive metrics for strategic execution performance.",
    });
  }, []);

  // Core metrics queries
  const { data: dynamicStatus } = useQuery<any>({
    queryKey: ['/api/dynamic-strategy/status'],
  });

  const { data: readiness } = useQuery<ReadinessMetric>({
    queryKey: ['/api/dynamic-strategy/readiness'],
  });

  const { data: weakSignalsData } = useQuery<WeakSignal[]>({
    queryKey: ['/api/dynamic-strategy/weak-signals'],
  });

  const { data: oraclePatternsData } = useQuery<OraclePattern[]>({
    queryKey: ['/api/dynamic-strategy/oracle-patterns'],
  });

  const { data: organizationsData } = useQuery<any[]>({ 
    queryKey: ['/api/organizations'] 
  });

  const weakSignals = weakSignalsData ?? [];
  const oraclePatterns = oraclePatternsData ?? [];
  const organizations = organizationsData ?? [];

  const { data: preparednessScore } = useQuery({
    queryKey: ['/api/preparedness-score'],
  });

  const { data: activeTriggers } = useQuery({
    queryKey: ['/api/triggers'],
  });

  const organizationId = organizations[0]?.id || 'demo-org-1';

  // Calculate metrics
  const friScore = parseFloat(readiness?.overallScore || '0') || dynamicStatus?.readinessScore || 0;
  const playbookMaturity = parseFloat(readiness?.playbookMaturity || '0');
  const executionVelocity = parseFloat(readiness?.executionVelocity || '0');
  const learningRate = parseFloat(readiness?.learningRate || '0');
  const signalDetection = parseFloat(readiness?.signalDetection || '0');
  
  const scoreValue = (preparednessScore as any)?.overall_score || 0;
  const triggerCount = Array.isArray(activeTriggers) ? activeTriggers.length : 0;
  const activeCount = Array.isArray(activeTriggers) ? activeTriggers.filter((t: any) => t.status === 'active').length : 0;

  const overallStatus: 'good' | 'warning' | 'critical' = 
    friScore >= 80 ? 'good' :
    friScore >= 60 ? 'warning' : 'critical';

  const handleRecalculate = async () => {
    try {
      await fetch('/api/dynamic-strategy/readiness/calculate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });
      queryClient.invalidateQueries({ queryKey: ['/api/dynamic-strategy/readiness'] });
      queryClient.invalidateQueries({ queryKey: ['/api/dynamic-strategy/status'] });
    } catch (error) {
      console.error('Failed to recalculate readiness:', error);
    }
  };

  const getScoreColor = (score: number) => {
    if (score >= 80) return 'text-green-600 dark:text-green-400';
    if (score >= 60) return 'text-yellow-600 dark:text-yellow-400';
    return 'text-red-600 dark:text-red-400';
  };

  const getUrgencyBadge = (urgency: string) => {
    switch (urgency) {
      case 'critical': return 'destructive';
      case 'high': return 'default';
      default: return 'secondary';
    }
  };

  return (
    <PageLayout>
      <div className="max-w-7xl mx-auto space-y-6 p-6" data-testid="executive-dashboard">
        
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <div className="flex items-center gap-3 mb-1">
              <h1 className="text-2xl font-bold text-slate-900 dark:text-white">Executive Dashboard</h1>
              <OnboardingTrigger 
                pageId="executive-dashboard" 
                autoStart={true} 
                className="bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800 text-blue-700 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/50" 
              />
            </div>
            <p className="text-slate-500 dark:text-slate-400 text-sm">
              Unified strategic command center for M
            </p>
          </div>
          <div className="flex items-center gap-3">
            <Badge className="bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-800">
              <Activity className="h-3 w-3 mr-1.5" />
              Live
            </Badge>
            <Button 
              onClick={handleRecalculate}
              variant="outline"
              size="sm"
              className="gap-2"
              data-testid="button-recalculate"
            >
              <RefreshCw className="h-4 w-4" />
              Refresh
            </Button>
          </div>
        </div>

        {/* Main Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          <TabsList className="grid w-full grid-cols-4 mb-6">
            <TabsTrigger value="overview" data-testid="tab-overview" className="gap-2">
              <BarChart3 className="h-4 w-4" />
              Overview
            </TabsTrigger>
            <TabsTrigger value="readiness" data-testid="tab-readiness" className="gap-2">
              <Brain className="h-4 w-4" />
              Readiness
            </TabsTrigger>
            <TabsTrigger value="velocity" data-testid="tab-velocity" className="gap-2">
              <Zap className="h-4 w-4" />
              Velocity
            </TabsTrigger>
            <TabsTrigger value="preparedness" data-testid="tab-preparedness" className="gap-2">
              <Shield className="h-4 w-4" />
              Preparedness
            </TabsTrigger>
          </TabsList>

          {/* Overview Tab */}
          <TabsContent value="overview" className="space-y-6">
            {/* Hero FRI Score */}
            <Card className="border-2 border-blue-200 dark:border-blue-800 bg-gradient-to-br from-blue-50 to-white dark:from-blue-950/20 dark:to-slate-900">
              <CardContent className="pt-6">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-6">
                    <div className="text-center">
                      <div className={`text-6xl font-bold ${getScoreColor(friScore)}`} data-testid="text-fri-score">
                        {friScore.toFixed(1)}%
                      </div>
                      <div className="text-sm text-slate-500 dark:text-slate-400 mt-1">Future Readiness Index</div>
                    </div>
                    <div className="h-20 w-px bg-slate-200 dark:bg-slate-700" />
                    <div className="space-y-2">
                      <StatusIndicator status={overallStatus} />
                      <p className="text-sm text-slate-600 dark:text-slate-400 max-w-md">
                        Your organization's strategic preparedness across playbooks, execution velocity, learning rate, and signal detection.
                      </p>
                    </div>
                  </div>
                  <Link href="/intelligence">
                    <Button variant="outline" className="gap-2" data-testid="link-intelligence">
                      <Radio className="h-4 w-4" />
                      View Signals
                      <ChevronRight className="h-4 w-4" />
                    </Button>
                  </Link>
                </div>
              </CardContent>
            </Card>

            {/* Key Metrics Grid */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <MetricCard
                title="Playbook Maturity"
                value={playbookMaturity.toFixed(0)}
                unit="%"
                trend="+2.3% this month"
                trendDirection="up"
                status={playbookMaturity >= 80 ? 'good' : playbookMaturity >= 60 ? 'warning' : 'critical'}
                icon={Target}
                description="Depth & completeness of playbooks"
              />
              <MetricCard
                title="Execution Velocity"
                value={executionVelocity.toFixed(0)}
                unit="%"
                trend="12 min avg response"
                trendDirection="up"
                status={executionVelocity >= 80 ? 'good' : executionVelocity >= 60 ? 'warning' : 'critical'}
                icon={Zap}
                description="Speed of coordinated response"
              />
              <MetricCard
                title="Active Triggers"
                value={activeCount}
                trend={`${triggerCount} configured`}
                trendDirection="neutral"
                status={activeCount >= 5 ? 'good' : activeCount >= 2 ? 'warning' : 'critical'}
                icon={AlertTriangle}
                description="Monitoring for opportunities & threats"
              />
              <MetricCard
                title="Signal Detection"
                value={signalDetection.toFixed(0)}
                unit="%"
                trend="24/7 AI monitoring"
                trendDirection="up"
                status={signalDetection >= 80 ? 'good' : signalDetection >= 60 ? 'warning' : 'critical'}
                icon={Eye}
                description="Pattern recognition accuracy"
              />
            </div>

            {/* Weak Signals & Patterns */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-lg">
                    <AlertTriangle className="h-5 w-5 text-amber-500" />
                    Weak Signals Detected
                  </CardTitle>
                  <CardDescription>Early indicators requiring attention</CardDescription>
                </CardHeader>
                <CardContent>
                  {weakSignals.length === 0 ? (
                    <div className="text-center py-8 text-slate-500 dark:text-slate-400">
                      <Eye className="h-8 w-8 mx-auto mb-2 opacity-50" />
                      <p>No weak signals detected</p>
                      <p className="text-sm">AI is continuously monitoring</p>
                    </div>
                  ) : (
                    <div className="space-y-3">
                      {weakSignals.slice(0, 4).map((signal) => (
                        <div key={signal.id} className="flex items-start gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50">
                          <Badge variant={getUrgencyBadge(signal.urgency) as any} className="mt-0.5">
                            {signal.urgency}
                          </Badge>
                          <div className="flex-1 min-w-0">
                            <div className="font-medium text-sm text-slate-900 dark:text-white">{signal.title}</div>
                            <p className="text-xs text-slate-500 dark:text-slate-400 truncate">{signal.description}</p>
                          </div>
                          <div className="text-xs text-slate-400">{signal.confidence}% conf</div>
                        </div>
                      ))}
                    </div>
                  )}
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-lg">
                    <Sparkles className="h-5 w-5 text-purple-500" />
                    Oracle Patterns
                  </CardTitle>
                  <CardDescription>AI-detected strategic opportunities</CardDescription>
                </CardHeader>
                <CardContent>
                  {oraclePatterns.length === 0 ? (
                    <div className="text-center py-8 text-slate-500 dark:text-slate-400">
                      <Brain className="h-8 w-8 mx-auto mb-2 opacity-50" />
                      <p>No patterns detected yet</p>
                      <p className="text-sm">Oracle is learning from your data</p>
                    </div>
                  ) : (
                    <div className="space-y-3">
                      {oraclePatterns.slice(0, 4).map((pattern) => (
                        <div key={pattern.id} className="flex items-start gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50">
                          <TrendingUp className="h-4 w-4 text-purple-500 mt-0.5" />
                          <div className="flex-1 min-w-0">
                            <div className="font-medium text-sm text-slate-900 dark:text-white">{pattern.title}</div>
                            <p className="text-xs text-slate-500 dark:text-slate-400 truncate">{pattern.description}</p>
                          </div>
                          <Badge variant="outline">{pattern.impact} impact</Badge>
                        </div>
                      ))}
                    </div>
                  )}
                </CardContent>
              </Card>
            </div>

            {/* Quick Actions */}
            <Card>
              <CardHeader>
                <CardTitle className="text-lg">Quick Actions</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <Link href="/playbook-library">
                    <Button variant="outline" className="w-full justify-start gap-2" data-testid="link-playbooks">
                      <Target className="h-4 w-4" />
                      Playbook Library
                    </Button>
                  </Link>
                  <Link href="/command-center">
                    <Button variant="outline" className="w-full justify-start gap-2" data-testid="link-command-center">
                      <Shield className="h-4 w-4" />
                      Command Center
                    </Button>
                  </Link>
                  <Link href="/intelligence">
                    <Button variant="outline" className="w-full justify-start gap-2" data-testid="link-intelligence-hub">
                      <Radio className="h-4 w-4" />
                      Intelligence Hub
                    </Button>
                  </Link>
                  <Link href="/settings">
                    <Button variant="outline" className="w-full justify-start gap-2" data-testid="link-settings">
                      <Activity className="h-4 w-4" />
                      Configuration
                    </Button>
                  </Link>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Readiness Tab */}
          <TabsContent value="readiness" className="space-y-6">
            <Card className="border-2 border-blue-200 dark:border-blue-800 bg-gradient-to-br from-blue-50 to-white dark:from-blue-950/20 dark:to-slate-900">
              <CardHeader>
                <div className="flex items-center justify-between">
                  <div>
                    <CardTitle className="text-2xl flex items-center gap-2">
                      <Brain className="h-6 w-6 text-blue-600" />
                      Future Readiness Index
                    </CardTitle>
                    <CardDescription>
                      {readiness?.calculatedAt 
                        ? `Last updated ${format(new Date(readiness.calculatedAt), 'PPp')}`
                        : 'Calculating...'}
                    </CardDescription>
                  </div>
                  <div className={`text-5xl font-bold ${getScoreColor(friScore)}`}>
                    {friScore.toFixed(1)}%
                  </div>
                </div>
              </CardHeader>
              <CardContent className="space-y-6">
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <div className="space-y-2">
                    <div className="flex justify-between text-sm">
                      <span className="text-slate-600 dark:text-slate-400">Playbook Maturity</span>
                      <span className={`font-medium ${getScoreColor(playbookMaturity)}`}>{playbookMaturity.toFixed(0)}%</span>
                    </div>
                    <Progress value={playbookMaturity} className="h-2" />
                  </div>
                  <div className="space-y-2">
                    <div className="flex justify-between text-sm">
                      <span className="text-slate-600 dark:text-slate-400">Execution Velocity</span>
                      <span className={`font-medium ${getScoreColor(executionVelocity)}`}>{executionVelocity.toFixed(0)}%</span>
                    </div>
                    <Progress value={executionVelocity} className="h-2" />
                  </div>
                  <div className="space-y-2">
                    <div className="flex justify-between text-sm">
                      <span className="text-slate-600 dark:text-slate-400">Learning Rate</span>
                      <span className={`font-medium ${getScoreColor(learningRate)}`}>{learningRate.toFixed(0)}%</span>
                    </div>
                    <Progress value={learningRate} className="h-2" />
                  </div>
                  <div className="space-y-2">
                    <div className="flex justify-between text-sm">
                      <span className="text-slate-600 dark:text-slate-400">Signal Detection</span>
                      <span className={`font-medium ${getScoreColor(signalDetection)}`}>{signalDetection.toFixed(0)}%</span>
                    </div>
                    <Progress value={signalDetection} className="h-2" />
                  </div>
                </div>

                <div className="bg-slate-50 dark:bg-slate-800/50 rounded-lg p-4">
                  <h4 className="font-medium text-slate-900 dark:text-white mb-2">What is the Future Readiness Index?</h4>
                  <p className="text-sm text-slate-600 dark:text-slate-400">
                    The FRI is M's proprietary metric measuring your organization's strategic preparedness. 
                    It combines playbook completeness, response speed, AI learning effectiveness, and signal detection accuracy 
                    to give you a single score reflecting your ability to respond to opportunities and threats.
                  </p>
                </div>
              </CardContent>
            </Card>

            {/* Improvement Recommendations */}
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <TrendingUp className="h-5 w-5 text-green-600" />
                  Improve Your Score
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="flex items-start gap-3 p-4 rounded-lg border border-slate-200 dark:border-slate-700">
                    <CheckCircle className="h-5 w-5 text-green-500 mt-0.5" />
                    <div>
                      <div className="font-medium text-slate-900 dark:text-white">Add more playbooks</div>
                      <p className="text-sm text-slate-500 dark:text-slate-400">Each configured playbook adds to your maturity score</p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3 p-4 rounded-lg border border-slate-200 dark:border-slate-700">
                    <CheckCircle className="h-5 w-5 text-green-500 mt-0.5" />
                    <div>
                      <div className="font-medium text-slate-900 dark:text-white">Run practice drills</div>
                      <p className="text-sm text-slate-500 dark:text-slate-400">Regular drills improve execution velocity</p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3 p-4 rounded-lg border border-slate-200 dark:border-slate-700">
                    <CheckCircle className="h-5 w-5 text-green-500 mt-0.5" />
                    <div>
                      <div className="font-medium text-slate-900 dark:text-white">Configure more triggers</div>
                      <p className="text-sm text-slate-500 dark:text-slate-400">More signal sources improve detection accuracy</p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3 p-4 rounded-lg border border-slate-200 dark:border-slate-700">
                    <CheckCircle className="h-5 w-5 text-green-500 mt-0.5" />
                    <div>
                      <div className="font-medium text-slate-900 dark:text-white">Review past activations</div>
                      <p className="text-sm text-slate-500 dark:text-slate-400">Learning from history improves the learning rate</p>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Velocity Tab */}
          <TabsContent value="velocity" className="space-y-6">
            <Card className="bg-gradient-to-br from-yellow-50 to-white dark:from-yellow-950/10 dark:to-slate-900 border-2 border-yellow-200 dark:border-yellow-800">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Zap className="h-6 w-6 text-yellow-500" />
                  Decision Velocity
                </CardTitle>
                <CardDescription>
                  The competitive advantage metric that Fortune 1000 leaders track
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="grid md:grid-cols-3 gap-4">
                  <div className="text-center p-4 bg-white dark:bg-slate-900 rounded-lg border">
                    <div className="text-3xl font-bold text-yellow-600 dark:text-yellow-400">12 min</div>
                    <div className="text-sm text-slate-500 dark:text-slate-400">Your Response Time</div>
                  </div>
                  <div className="text-center p-4 bg-white dark:bg-slate-900 rounded-lg border">
                    <div className="text-3xl font-bold text-slate-400">72 hrs</div>
                    <div className="text-sm text-slate-500 dark:text-slate-400">Industry Average</div>
                  </div>
                  <div className="text-center p-4 bg-white dark:bg-slate-900 rounded-lg border">
                    <div className="text-3xl font-bold text-green-600 dark:text-green-400">360x</div>
                    <div className="text-sm text-slate-500 dark:text-slate-400">Faster Than Competitors</div>
                  </div>
                </div>
                <p className="text-sm text-slate-600 dark:text-slate-400">
                  <strong>Decision Velocity</strong> measures how fast your organization moves from strategic signal 
                  to execution completion. While competitors coordinate through email chains and meetings, you execute instantly.
                </p>
              </CardContent>
            </Card>

            <DecisionVelocityDashboard organizationId={organizationId} />
          </TabsContent>

          {/* Preparedness Tab */}
          <TabsContent value="preparedness" className="space-y-6">
            <Card className="border-2 border-emerald-200 dark:border-emerald-800">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Shield className="h-6 w-6 text-emerald-600" />
                  Preparedness Score
                </CardTitle>
                <CardDescription>Your overall strategic readiness rating</CardDescription>
              </CardHeader>
              <CardContent>
                <div className="flex items-center gap-8">
                  <div className="text-center">
                    <div className="text-6xl font-bold text-emerald-600 dark:text-emerald-400" data-testid="score-preparedness">
                      {scoreValue || 0}
                    </div>
                    <div className="text-sm text-slate-500 dark:text-slate-400 mt-2">out of 100</div>
                  </div>
                  
                  <div className="flex-1 space-y-4">
                    <div>
                      <div className="flex justify-between text-sm mb-2">
                        <span className="font-medium">Playbooks Configured</span>
                        <span>{dynamicStatus?.playbooksReady || 0}</span>
                      </div>
                      <Progress value={(dynamicStatus?.playbooksReady || 0) / 10 * 100} className="h-2" />
                    </div>

                    <div>
                      <div className="flex justify-between text-sm mb-2">
                        <span className="font-medium">Triggers Active</span>
                        <span>{activeCount}</span>
                      </div>
                      <Progress value={activeCount / 10 * 100} className="h-2" />
                    </div>

                    <div>
                      <div className="flex justify-between text-sm mb-2">
                        <span className="font-medium">Drills Completed (30d)</span>
                        <span>{dynamicStatus?.drillsCompleted || 0}</span>
                      </div>
                      <Progress value={(dynamicStatus?.drillsCompleted || 0) / 5 * 100} className="h-2" />
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Recommendations */}
            <Card>
              <CardHeader>
                <CardTitle>Boost Your Preparedness</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-3">
                  <Link href="/playbook-library">
                    <div className="flex items-center justify-between p-4 rounded-lg border hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer transition-colors">
                      <div className="flex items-center gap-3">
                        <Target className="h-5 w-5 text-blue-600" />
                        <div>
                          <div className="font-medium">Configure More Playbooks</div>
                          <p className="text-sm text-slate-500">Add playbooks from our 166-template library</p>
                        </div>
                      </div>
                      <ChevronRight className="h-5 w-5 text-slate-400" />
                    </div>
                  </Link>
                  <Link href="/practice-drills">
                    <div className="flex items-center justify-between p-4 rounded-lg border hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer transition-colors">
                      <div className="flex items-center gap-3">
                        <Activity className="h-5 w-5 text-purple-600" />
                        <div>
                          <div className="font-medium">Run Practice Drills</div>
                          <p className="text-sm text-slate-500">Test your team's response capabilities</p>
                        </div>
                      </div>
                      <ChevronRight className="h-5 w-5 text-slate-400" />
                    </div>
                  </Link>
                  <Link href="/intelligence">
                    <div className="flex items-center justify-between p-4 rounded-lg border hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer transition-colors">
                      <div className="flex items-center gap-3">
                        <Radio className="h-5 w-5 text-amber-600" />
                        <div>
                          <div className="font-medium">Configure Triggers</div>
                          <p className="text-sm text-slate-500">Set up monitoring across 16 signal categories</p>
                        </div>
                      </div>
                      <ChevronRight className="h-5 w-5 text-slate-400" />
                    </div>
                  </Link>
                  <Link href="/operating-model">
                    <div className="flex items-center justify-between p-4 rounded-lg border hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer transition-colors" data-testid="link-operating-model">
                      <div className="flex items-center gap-3">
                        <Layers className="h-5 w-5 text-indigo-600" />
                        <div>
                          <div className="font-medium">Operating Model Alignment</div>
                          <p className="text-sm text-slate-500">Map your structure to M's 166 playbooks using McKinsey's framework</p>
                        </div>
                      </div>
                      <ChevronRight className="h-5 w-5 text-slate-400" />
                    </div>
                  </Link>
                </div>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/ExecutiveScorecard.tsx
========================================
import { useEffect } from 'react';
import { useQuery } from '@tanstack/react-query';
import { updatePageMetadata } from '@/lib/seo';
import PageLayout from '@/components/layout/PageLayout';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { 
  Shield, 
  Zap, 
  Target, 
  AlertTriangle,
  DollarSign,
  ChevronRight,
  Activity,
  ArrowUpRight,
  ArrowDownRight,
  Minus
} from 'lucide-react';
import { Link } from 'wouter';

function StatusIndicator({ status }: { status: 'good' | 'warning' | 'critical' }) {
  const config = {
    good: { bg: 'bg-emerald-500', className: 'status-success', label: 'Healthy' },
    warning: { bg: 'bg-amber-500', className: 'status-warning', label: 'Attention' },
    critical: { bg: 'bg-red-500', className: 'status-error', label: 'Critical' }
  };
  const c = config[status];
  
  return (
    <div className="flex items-center gap-2">
      <div className={`w-2.5 h-2.5 rounded-full ${c.bg}`} />
      <span className={`text-sm font-medium ${c.className}`}>{c.label}</span>
    </div>
  );
}

function MetricCard({ 
  title, 
  value, 
  unit,
  trend,
  trendDirection,
  status,
  icon: Icon,
  link,
  action
}: {
  title: string;
  value: string | number;
  unit?: string;
  trend: string;
  trendDirection: 'up' | 'down' | 'neutral';
  status: 'good' | 'warning' | 'critical';
  icon: any;
  link: string;
  action: string;
}) {
  const statusBorders = {
    good: 'border-l-emerald-500',
    warning: 'border-l-amber-500',
    critical: 'border-l-red-500'
  };

  const trendIcons = {
    up: ArrowUpRight,
    down: ArrowDownRight,
    neutral: Minus
  };
  const TrendIcon = trendIcons[trendDirection];

  const trendClasses = {
    up: 'status-success',
    down: 'status-error',
    neutral: 'text-slate-500 dark:text-slate-400'
  };

  return (
    <Card className={`metric-card border-l-4 ${statusBorders[status]} hover:shadow-md transition-shadow`}>
      <CardHeader className="pb-2">
        <div className="flex items-center justify-between">
          <div className="p-2 rounded-lg bg-blue-50 dark:bg-blue-900/30">
            <Icon className="h-5 w-5 text-blue-600 dark:text-blue-400" />
          </div>
          <StatusIndicator status={status} />
        </div>
      </CardHeader>
      <CardContent className="space-y-3">
        <div>
          <CardTitle className="text-sm font-medium text-slate-500 dark:text-slate-400 mb-1">{title}</CardTitle>
          <div className="flex items-baseline gap-1">
            <span className="text-3xl font-bold text-slate-900 dark:text-white">{value}</span>
            {unit && <span className="text-lg text-slate-400 dark:text-slate-500">{unit}</span>}
          </div>
        </div>
        
        <div className={`flex items-center gap-1 text-sm ${trendClasses[trendDirection]}`}>
          <TrendIcon className="h-4 w-4" />
          <span>{trend}</span>
        </div>

        <Link href={link}>
          <Button 
            variant="ghost" 
            size="sm"
            className="w-full justify-between text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 -mx-2"
          >
            {action}
            <ChevronRight className="h-4 w-4" />
          </Button>
        </Link>
      </CardContent>
    </Card>
  );
}

export default function ExecutiveScorecard() {
  useEffect(() => {
    updatePageMetadata({
      title: "Executive Scorecard | M Strategic Execution OS",
      description: "Track your strategic execution velocity with M's Executive Scorecard. Monitor preparedness scores, active triggers, response times, and decision outcomes.",
      ogTitle: "Executive Scorecard | M",
      ogDescription: "Real-time executive metrics for strategic execution performance.",
    });
  }, []);

  const { data: preparednessScore } = useQuery({
    queryKey: ['/api/preparedness-score'],
  });

  const { data: activeTriggers } = useQuery({
    queryKey: ['/api/triggers'],
  });

  const { data: recentActivations } = useQuery({
    queryKey: ['/api/playbook-activations/recent'],
  });

  const scoreValue = (preparednessScore as any)?.overall_score || 0;
  const triggerCount = Array.isArray(activeTriggers) ? activeTriggers.length : 0;
  const activeCount = Array.isArray(activeTriggers) ? activeTriggers.filter((t: any) => t.status === 'active').length : 0;
  
  const last30Days = Array.isArray(recentActivations) ? recentActivations.filter((a: any) => {
    const activatedAt = new Date(a.activated_at);
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
    return activatedAt >= thirtyDaysAgo;
  }) : [];
  
  const avgResponseTime = last30Days.length > 0
    ? last30Days.reduce((sum: number, a: any) => sum + (a.response_time_minutes || 0), 0) / last30Days.length
    : 0;

  const totalValueProtected = last30Days.reduce((sum: number, a: any) => sum + (a.value_protected || 0), 0);

  const overallStatus: 'good' | 'warning' | 'critical' = 
    scoreValue >= 80 && activeCount >= 5 ? 'good' :
    scoreValue >= 60 || activeCount >= 3 ? 'warning' : 'critical';

  return (
    <PageLayout>
      <div className="max-w-6xl mx-auto space-y-6 p-6">
        
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <div className="flex items-center gap-3 mb-1">
              <h1 className="text-2xl font-bold text-slate-900 dark:text-white">Executive Scorecard</h1>
              <OnboardingTrigger pageId="executive-scorecard" autoStart={true} className="bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800 text-blue-700 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/50" />
            </div>
            <p className="text-slate-500 dark:text-slate-400 text-sm">Strategic execution metrics at a glance</p>
          </div>
          <Badge className="bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-800">
            <Activity className="h-3 w-3 mr-1.5" />
            Live
          </Badge>
        </div>

        {/* Executive Summary Strip */}
        <Card className="card-bg">
          <CardContent className="p-4">
            <div className="flex items-center justify-between flex-wrap gap-4">
              <div className="flex items-center gap-6 flex-wrap">
                <div className="flex items-center gap-3">
                  <div className={`w-3 h-3 rounded-full ${
                    overallStatus === 'good' ? 'bg-emerald-500' :
                    overallStatus === 'warning' ? 'bg-amber-500' : 'bg-red-500'
                  }`} />
                  <div>
                    <div className="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wide">System Status</div>
                    <div className="text-slate-900 dark:text-white font-semibold">
                      {overallStatus === 'good' ? 'All Systems Operational' :
                       overallStatus === 'warning' ? 'Attention Needed' : 'Action Required'}
                    </div>
                  </div>
                </div>
                <div className="h-8 w-px bg-slate-200 dark:bg-slate-700 hidden sm:block" />
                <div>
                  <div className="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wide">Last Activation</div>
                  <div className="text-slate-900 dark:text-white font-semibold">
                    {last30Days.length > 0 ? 'Today' : 'No recent activity'}
                  </div>
                </div>
                <div className="h-8 w-px bg-slate-200 dark:bg-slate-700 hidden sm:block" />
                <div>
                  <div className="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wide">Response Time</div>
                  <div className="text-slate-900 dark:text-white font-semibold">
                    {avgResponseTime > 0 ? `${Math.round(avgResponseTime)} min avg` : ''}
                  </div>
                </div>
              </div>
              <Link href="/command-center">
                <Button variant="outline" size="sm" className="border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800">
                  Open Command Center
                  <ChevronRight className="h-4 w-4 ml-1" />
                </Button>
              </Link>
            </div>
          </CardContent>
        </Card>

        {/* Metrics Grid */}
        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
          <MetricCard
            title="Preparedness Score"
            value={scoreValue}
            unit="/100"
            trend="+12 vs last month"
            trendDirection={scoreValue >= 70 ? 'up' : 'down'}
            status={scoreValue >= 80 ? 'good' : scoreValue >= 60 ? 'warning' : 'critical'}
            icon={Shield}
            link="/preparedness-report"
            action="View Full Report"
          />
          
          <MetricCard
            title="Decision Velocity"
            value={Math.round(avgResponseTime) || ''}
            unit={avgResponseTime > 0 ? ' min' : ''}
            trend="vs 72hr industry avg"
            trendDirection={avgResponseTime <= 15 ? 'up' : avgResponseTime <= 30 ? 'neutral' : 'down'}
            status={avgResponseTime <= 15 ? 'good' : avgResponseTime <= 30 ? 'warning' : 'critical'}
            icon={Zap}
            link="/crisis-response-center"
            action="View Activations"
          />
          
          <MetricCard
            title="AI Trigger Coverage"
            value={activeCount}
            unit={`/${triggerCount}`}
            trend="24/7 monitoring active"
            trendDirection={activeCount >= 10 ? 'up' : activeCount >= 5 ? 'neutral' : 'down'}
            status={activeCount >= 10 ? 'good' : activeCount >= 5 ? 'warning' : 'critical'}
            icon={Target}
            link="/triggers-management"
            action="Manage Triggers"
          />
          
          <MetricCard
            title="Active Situations"
            value={last30Days.length}
            unit=" this month"
            trend={`${last30Days.filter((a: any) => a.status === 'completed').length} resolved`}
            trendDirection={last30Days.length === 0 ? 'up' : 'neutral'}
            status={last30Days.length === 0 ? 'good' : 'warning'}
            icon={AlertTriangle}
            link="/crisis-response-center"
            action="View Details"
          />
          
          <MetricCard
            title="Value Protected"
            value={`$${(totalValueProtected / 1000000).toFixed(1)}M`}
            trend="Last 30 days"
            trendDirection="up"
            status="good"
            icon={DollarSign}
            link="/advanced-analytics"
            action="View Analytics"
          />
        </div>

        {/* Footer note */}
        <p className="text-center text-xs text-slate-400 dark:text-slate-500 pt-4">
          Data refreshes automatically  Last updated just now
        </p>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/ExecutiveSimulationDemo.tsx
========================================
import { useState, useEffect, useCallback, useRef } from 'react';
import { useLocation } from 'wouter';
import { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Separator } from '@/components/ui/separator';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import { ScrollArea } from '@/components/ui/scroll-area';
import { 
  Play, 
  Pause, 
  RotateCcw, 
  AlertTriangle, 
  TrendingDown, 
  Shield, 
  Clock, 
  CheckCircle2, 
  Target,
  Radio,
  Activity,
  ArrowRight,
  Bell,
  Users,
  Building2,
  DollarSign,
  FileText,
  ChevronRight,
  Timer,
  Rocket,
  BarChart3,
  Briefcase,
  Globe,
  TrendingUp,
  AlertCircle,
  MessageSquare,
  Mail,
  Phone,
  Video,
  Zap,
  Eye,
  MapPin,
  Calendar,
  Star,
  Award,
  CircleDot,
  Send,
  Inbox,
  CheckCheck,
  XCircle
} from 'lucide-react';
import PageLayout from '@/components/layout/PageLayout';
import { useTimelineState, useTimelineOrchestrator } from '@/contexts/DemoTimelineContext';

type LucideIconType = typeof TrendingDown;

interface CompanyProfile {
  name: string;
  industry: string;
  revenue: string;
  employees: string;
  headquarters: string;
  role: string;
  persona: string;
}

interface TeamMember {
  id: string;
  name: string;
  role: string;
  department: string;
  avatar: string;
  status: 'available' | 'busy' | 'offline';
}

interface IntelligenceSignal {
  id: string;
  type: 'competitor' | 'market' | 'regulatory' | 'supply_chain' | 'customer';
  title: string;
  description: string;
  source: string;
  severity: 'critical' | 'high' | 'medium' | 'low';
  timestamp: Date;
  icon: LucideIconType;
  actionRequired: boolean;
}

interface PlaybookAction {
  id: string;
  name: string;
  assignee: string;
  department: string;
  status: 'pending' | 'in_progress' | 'completed' | 'blocked';
  duration: string;
  notes?: string;
}

interface Notification {
  id: string;
  type: 'signal' | 'task' | 'message' | 'system';
  title: string;
  message: string;
  timestamp: Date;
  read: boolean;
  actionUrl?: string;
}

const COMPANY_PROFILE: CompanyProfile = {
  name: 'Meridian Industries',
  industry: 'Advanced Manufacturing',
  revenue: '$4.2B',
  employees: '12,500',
  headquarters: 'Chicago, IL',
  role: 'Chief Strategy Officer',
  persona: 'Sarah Chen'
};

const TEAM_MEMBERS: TeamMember[] = [
  { id: '1', name: 'Michael Torres', role: 'CFO', department: 'Finance', avatar: 'MT', status: 'available' },
  { id: '2', name: 'Jennifer Walsh', role: 'CMO', department: 'Marketing', avatar: 'JW', status: 'available' },
  { id: '3', name: 'David Kim', role: 'VP Operations', department: 'Operations', avatar: 'DK', status: 'busy' },
  { id: '4', name: 'Amanda Foster', role: 'General Counsel', department: 'Legal', avatar: 'AF', status: 'available' },
  { id: '5', name: 'Robert Chen', role: 'VP Sales', department: 'Sales', avatar: 'RC', status: 'available' },
  { id: '6', name: 'Lisa Park', role: 'CHRO', department: 'HR', avatar: 'LP', status: 'offline' },
];

const INITIAL_SIGNALS: IntelligenceSignal[] = [
  {
    id: 'sig-1',
    type: 'market',
    title: 'Q4 demand forecast revised upward',
    description: 'Industry analysts project 15% higher demand in Q4 due to infrastructure bill passage',
    source: 'Bloomberg Terminal',
    severity: 'medium',
    timestamp: new Date(Date.now() - 3600000),
    icon: TrendingUp,
    actionRequired: false
  },
  {
    id: 'sig-2',
    type: 'customer',
    title: 'Enterprise client expansion opportunity',
    description: 'Caterpillar reviewing $45M multi-year contract renewal with potential 30% expansion',
    source: 'Salesforce CRM',
    timestamp: new Date(Date.now() - 7200000),
    severity: 'high',
    icon: Building2,
    actionRequired: true
  }
];

type SimulationPhase = 'intro' | 'dashboard' | 'signal_detected' | 'analyzing' | 'playbook_selection' | 'team_coordination' | 'execution' | 'monitoring' | 'complete';

export default function ExecutiveSimulationDemo() {
  const [, setLocation] = useLocation();
  const timelineState = useTimelineState();
  const orchestrator = useTimelineOrchestrator();
  const [phase, setPhase] = useState<SimulationPhase>('intro');
  const [isRunning, setIsRunning] = useState(false);
  const [signals, setSignals] = useState<IntelligenceSignal[]>(INITIAL_SIGNALS);
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [selectedPlaybook, setSelectedPlaybook] = useState<string | null>(null);
  const [playbookActions, setPlaybookActions] = useState<PlaybookAction[]>([]);
  const [activeTab, setActiveTab] = useState('radar');
  const [showCriticalAlert, setShowCriticalAlert] = useState(false);
  const [criticalSignal, setCriticalSignal] = useState<IntelligenceSignal | null>(null);
  
  const executionTimersRef = useRef<NodeJS.Timeout[]>([]);
  
  const elapsedTime = timelineState.elapsedMs;

  const clearAllTimers = useCallback(() => {
    executionTimersRef.current.forEach(timer => clearTimeout(timer));
    executionTimersRef.current = [];
  }, []);

  const startSimulation = useCallback(() => {
    clearAllTimers();
    setPhase('dashboard');
    setIsRunning(true);
    setSignals(INITIAL_SIGNALS);
    setNotifications([]);
    setSelectedPlaybook(null);
    setPlaybookActions([]);
    setShowCriticalAlert(false);
    setCriticalSignal(null);
    
    orchestrator.startOnce({ duration: 720000, speedMultiplier: 20 });
  }, [clearAllTimers, orchestrator]);

  const resetSimulation = useCallback(() => {
    clearAllTimers();
    setPhase('intro');
    setIsRunning(false);
    setSignals(INITIAL_SIGNALS);
    setNotifications([]);
    setSelectedPlaybook(null);
    setPlaybookActions([]);
    setShowCriticalAlert(false);
    setCriticalSignal(null);
    setActiveTab('radar');
    
    orchestrator.resetAll();
  }, [clearAllTimers, orchestrator]);

  useEffect(() => {
    return () => {
      clearAllTimers();
    };
  }, [clearAllTimers]);

  useEffect(() => {
    if (phase !== 'dashboard' || !isRunning) return;

    const criticalAlertTimer = setTimeout(() => {
      const newSignal: IntelligenceSignal = {
        id: 'sig-critical',
        type: 'competitor',
        title: 'URGENT: Competitor Acquisition Announced',
        description: 'TitanTech Industries announces acquisition of Precision Components Inc. for $890M - directly impacts our supply chain and market position',
        source: 'Reuters + SEC Filing',
        severity: 'critical',
        timestamp: new Date(),
        icon: AlertTriangle,
        actionRequired: true
      };

      setCriticalSignal(newSignal);
      setSignals(prev => [newSignal, ...prev]);
      setShowCriticalAlert(true);
      setPhase('signal_detected');

      const notification: Notification = {
        id: 'notif-1',
        type: 'signal',
        title: 'Critical Signal Detected',
        message: 'Competitor acquisition impacts your market position. Immediate response recommended.',
        timestamp: new Date(),
        read: false
      };
      setNotifications(prev => [notification, ...prev]);
    }, 5000);

    return () => clearTimeout(criticalAlertTimer);
  }, [phase, isRunning]);

  const handleAcknowledgeAlert = useCallback(() => {
    setShowCriticalAlert(false);
    setPhase('analyzing');
    setActiveTab('signals');

    const timer = setTimeout(() => {
      setPhase('playbook_selection');
    }, 2000);
    executionTimersRef.current.push(timer);
  }, []);

  const handleSelectPlaybook = useCallback((playbookId: string) => {
    setSelectedPlaybook(playbookId);
    setPhase('team_coordination');

    const actions: PlaybookAction[] = [
      { id: 'a1', name: 'Convene executive response team', assignee: 'Sarah Chen', department: 'Strategy', status: 'pending', duration: '5 min' },
      { id: 'a2', name: 'Assess supply chain exposure', assignee: 'David Kim', department: 'Operations', status: 'pending', duration: '15 min' },
      { id: 'a3', name: 'Analyze competitive positioning impact', assignee: 'Jennifer Walsh', department: 'Marketing', status: 'pending', duration: '20 min' },
      { id: 'a4', name: 'Review existing contracts and exclusivity clauses', assignee: 'Amanda Foster', department: 'Legal', status: 'pending', duration: '30 min' },
      { id: 'a5', name: 'Prepare customer retention messaging', assignee: 'Robert Chen', department: 'Sales', status: 'pending', duration: '25 min' },
      { id: 'a6', name: 'Model financial scenarios (best/worst case)', assignee: 'Michael Torres', department: 'Finance', status: 'pending', duration: '45 min' },
    ];
    setPlaybookActions(actions);
  }, []);

  const handleLaunchExecution = useCallback(() => {
    setPhase('execution');
    setActiveTab('command');
    
    playbookActions.forEach((action, index) => {
      const startDelay = index * 1500;
      const completeDelay = startDelay + 2000 + Math.random() * 1500;

      const startTimer = setTimeout(() => {
        setPlaybookActions(prev => prev.map(a => 
          a.id === action.id ? { ...a, status: 'in_progress' } : a
        ));
      }, startDelay);
      executionTimersRef.current.push(startTimer);

      const completeTimer = setTimeout(() => {
        setPlaybookActions(prev => prev.map(a => 
          a.id === action.id ? { ...a, status: 'completed' } : a
        ));
      }, completeDelay);
      executionTimersRef.current.push(completeTimer);
    });

    const monitoringTimer = setTimeout(() => {
      setPhase('monitoring');
    }, playbookActions.length * 1500 + 4000);
    executionTimersRef.current.push(monitoringTimer);

    const completeTimer = setTimeout(() => {
      setPhase('complete');
      setIsRunning(false);
    }, playbookActions.length * 1500 + 7000);
    executionTimersRef.current.push(completeTimer);
  }, [playbookActions]);

  const formatTime = (ms: number) => {
    const minutes = Math.floor(ms / 60000);
    const seconds = Math.floor((ms % 60000) / 1000);
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
  };

  const completedActions = playbookActions.filter(a => a.status === 'completed').length;
  const progressPercent = playbookActions.length > 0 ? (completedActions / playbookActions.length) * 100 : 0;

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case 'critical': return 'bg-red-500 text-white';
      case 'high': return 'bg-orange-500 text-white';
      case 'medium': return 'bg-yellow-500 text-black';
      case 'low': return 'bg-blue-500 text-white';
      default: return 'bg-gray-500 text-white';
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'completed': return 'text-green-600 dark:text-green-400';
      case 'in_progress': return 'text-blue-600 dark:text-blue-400';
      case 'blocked': return 'text-red-600 dark:text-red-400';
      default: return 'text-slate-400';
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'completed': return <CheckCircle2 className="w-5 h-5" />;
      case 'in_progress': return <Activity className="w-5 h-5 animate-pulse" />;
      case 'blocked': return <XCircle className="w-5 h-5" />;
      default: return <CircleDot className="w-5 h-5" />;
    }
  };

  if (phase === 'intro') {
    return (
      <PageLayout>
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-6">
          <Card className="max-w-3xl w-full border-0 bg-white/5 backdrop-blur-xl" data-testid="card-simulation-intro">
            <CardHeader className="text-center pb-2">
              <div className="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-blue-500 to-teal-400 rounded-2xl flex items-center justify-center">
                <Briefcase className="w-10 h-10 text-white" />
              </div>
              <Badge className="mx-auto mb-4 bg-blue-500/20 text-blue-300 border-blue-500/30">
                Executive Simulation
              </Badge>
              <CardTitle className="text-3xl font-bold text-white mb-2">
                Welcome to Your Day as CSO
              </CardTitle>
              <CardDescription className="text-lg text-slate-300">
                Experience M from the perspective of a Fortune 500 executive
              </CardDescription>
            </CardHeader>
            
            <CardContent className="space-y-6">
              <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                  <Building2 className="w-5 h-5 text-blue-400" />
                  Your Company Profile
                </h3>
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <span className="text-slate-400">Company:</span>
                    <span className="text-white ml-2 font-medium">{COMPANY_PROFILE.name}</span>
                  </div>
                  <div>
                    <span className="text-slate-400">Industry:</span>
                    <span className="text-white ml-2 font-medium">{COMPANY_PROFILE.industry}</span>
                  </div>
                  <div>
                    <span className="text-slate-400">Revenue:</span>
                    <span className="text-white ml-2 font-medium">{COMPANY_PROFILE.revenue}</span>
                  </div>
                  <div>
                    <span className="text-slate-400">Employees:</span>
                    <span className="text-white ml-2 font-medium">{COMPANY_PROFILE.employees}</span>
                  </div>
                </div>
              </div>

              <div className="bg-gradient-to-r from-blue-900/50 to-teal-900/50 rounded-xl p-6 border border-blue-700/30">
                <h3 className="text-lg font-semibold text-white mb-3 flex items-center gap-2">
                  <Users className="w-5 h-5 text-teal-400" />
                  Your Role
                </h3>
                <div className="flex items-center gap-4">
                  <Avatar className="w-16 h-16 border-2 border-teal-400">
                    <AvatarFallback className="bg-teal-600 text-white text-lg font-bold">SC</AvatarFallback>
                  </Avatar>
                  <div>
                    <p className="text-xl font-bold text-white">{COMPANY_PROFILE.persona}</p>
                    <p className="text-teal-300">{COMPANY_PROFILE.role}</p>
                    <p className="text-slate-400 text-sm mt-1">{COMPANY_PROFILE.headquarters}</p>
                  </div>
                </div>
              </div>

              <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                  <Target className="w-5 h-5 text-purple-400" />
                  What You'll Experience
                </h3>
                <ul className="space-y-3 text-slate-300">
                  <li className="flex items-start gap-3">
                    <CheckCircle2 className="w-5 h-5 text-green-400 mt-0.5 flex-shrink-0" />
                    <span>Monitor real-time intelligence signals from multiple sources</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <CheckCircle2 className="w-5 h-5 text-green-400 mt-0.5 flex-shrink-0" />
                    <span>Respond to a critical strategic event as it unfolds</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <CheckCircle2 className="w-5 h-5 text-green-400 mt-0.5 flex-shrink-0" />
                    <span>Activate a pre-built playbook and coordinate your team</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <CheckCircle2 className="w-5 h-5 text-green-400 mt-0.5 flex-shrink-0" />
                    <span>See how M compresses 72-hour responses to 12 minutes</span>
                  </li>
                </ul>
              </div>
            </CardContent>

            <CardFooter className="flex justify-center pt-4">
              <Button 
                size="lg" 
                onClick={startSimulation}
                className="bg-gradient-to-r from-blue-600 to-teal-500 hover:from-blue-700 hover:to-teal-600 text-white font-semibold px-12 py-6 text-lg"
                data-testid="button-start-simulation"
              >
                <Play className="w-5 h-5 mr-2" />
                Begin Simulation
              </Button>
            </CardFooter>
          </Card>
        </div>
      </PageLayout>
    );
  }

  if (phase === 'complete') {
    return (
      <PageLayout>
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-emerald-900/20 to-slate-900 flex items-center justify-center p-6">
          <Card className="max-w-3xl w-full border-0 bg-white/5 backdrop-blur-xl" data-testid="card-simulation-complete">
            <CardHeader className="text-center pb-2">
              <div className="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-emerald-500 to-green-400 rounded-2xl flex items-center justify-center">
                <Award className="w-10 h-10 text-white" />
              </div>
              <Badge className="mx-auto mb-4 bg-emerald-500/20 text-emerald-300 border-emerald-500/30">
                Simulation Complete
              </Badge>
              <CardTitle className="text-3xl font-bold text-white mb-2">
                Response Successfully Coordinated
              </CardTitle>
              <CardDescription className="text-lg text-slate-300">
                You just experienced the power of M
              </CardDescription>
            </CardHeader>
            
            <CardContent className="space-y-6">
              <div className="grid grid-cols-3 gap-4">
                <div className="bg-slate-800/50 rounded-xl p-6 text-center border border-slate-700">
                  <Clock className="w-8 h-8 text-blue-400 mx-auto mb-2" />
                  <p className="text-3xl font-bold text-white">{formatTime(elapsedTime)}</p>
                  <p className="text-slate-400 text-sm">Total Response Time</p>
                </div>
                <div className="bg-slate-800/50 rounded-xl p-6 text-center border border-slate-700">
                  <Users className="w-8 h-8 text-purple-400 mx-auto mb-2" />
                  <p className="text-3xl font-bold text-white">6</p>
                  <p className="text-slate-400 text-sm">Stakeholders Aligned</p>
                </div>
                <div className="bg-slate-800/50 rounded-xl p-6 text-center border border-slate-700">
                  <CheckCircle2 className="w-8 h-8 text-green-400 mx-auto mb-2" />
                  <p className="text-3xl font-bold text-white">{playbookActions.length}</p>
                  <p className="text-slate-400 text-sm">Actions Completed</p>
                </div>
              </div>

              <div className="bg-gradient-to-r from-emerald-900/50 to-green-900/50 rounded-xl p-6 border border-emerald-700/30">
                <h3 className="text-lg font-semibold text-white mb-4">Traditional vs M Response</h3>
                <div className="space-y-4">
                  <div>
                    <div className="flex justify-between text-sm mb-1">
                      <span className="text-slate-400">Traditional Approach</span>
                      <span className="text-red-400">48-72 hours</span>
                    </div>
                    <div className="h-3 bg-slate-700 rounded-full overflow-hidden">
                      <div className="h-full bg-red-500/50 rounded-full" style={{ width: '100%' }}></div>
                    </div>
                  </div>
                  <div>
                    <div className="flex justify-between text-sm mb-1">
                      <span className="text-slate-400">With M</span>
                      <span className="text-emerald-400">{formatTime(elapsedTime)}</span>
                    </div>
                    <div className="h-3 bg-slate-700 rounded-full overflow-hidden">
                      <div className="h-full bg-gradient-to-r from-emerald-500 to-green-400 rounded-full" style={{ width: '3%' }}></div>
                    </div>
                  </div>
                </div>
                <p className="text-emerald-300 text-center mt-4 font-semibold">
                  You responded {Math.round((72 * 60) / (elapsedTime / 60000))}x faster than traditional methods
                </p>
              </div>

              <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-semibold text-white mb-4">What Happened</h3>
                <ul className="space-y-3 text-slate-300 text-sm">
                  <li className="flex items-start gap-3">
                    <div className="w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                      <span className="text-blue-400 text-xs font-bold">1</span>
                    </div>
                    <span>M detected competitor acquisition via Reuters and SEC filing monitoring</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <div className="w-6 h-6 rounded-full bg-purple-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                      <span className="text-purple-400 text-xs font-bold">2</span>
                    </div>
                    <span>AI assessed impact and recommended "Competitor M&A Response" playbook</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <div className="w-6 h-6 rounded-full bg-teal-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                      <span className="text-teal-400 text-xs font-bold">3</span>
                    </div>
                    <span>You activated the playbook, triggering automatic stakeholder notification</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <div className="w-6 h-6 rounded-full bg-emerald-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                      <span className="text-emerald-400 text-xs font-bold">4</span>
                    </div>
                    <span>All 6 response workstreams were coordinated in parallel, not sequentially</span>
                  </li>
                </ul>
              </div>
            </CardContent>

            <CardFooter className="flex justify-center gap-4 pt-4">
              <Button 
                variant="outline"
                onClick={resetSimulation}
                className="border-slate-600 text-slate-300 hover:bg-slate-800"
                data-testid="button-restart-simulation"
              >
                <RotateCcw className="w-4 h-4 mr-2" />
                Try Again
              </Button>
              <Button 
                onClick={() => setLocation('/foresight-radar')}
                className="bg-gradient-to-r from-blue-600 to-teal-500 hover:from-blue-700 hover:to-teal-600 text-white"
                data-testid="button-explore-platform"
              >
                Explore Full Platform
                <ArrowRight className="w-4 h-4 ml-2" />
              </Button>
            </CardFooter>
          </Card>
        </div>
      </PageLayout>
    );
  }

  return (
    <PageLayout>
      <div className="min-h-screen bg-slate-50 dark:bg-slate-950">
        {/* Critical Alert Overlay */}
        {showCriticalAlert && criticalSignal && (
          <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4" data-testid="overlay-critical-alert">
            <Card className="max-w-2xl w-full border-2 border-red-500 bg-slate-900 animate-pulse">
              <CardHeader className="bg-red-500/20 border-b border-red-500/30">
                <div className="flex items-center gap-3">
                  <div className="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center animate-pulse">
                    <AlertTriangle className="w-7 h-7 text-white" />
                  </div>
                  <div>
                    <Badge className="bg-red-500 text-white mb-1">CRITICAL SIGNAL DETECTED</Badge>
                    <CardTitle className="text-xl text-white">{criticalSignal.title}</CardTitle>
                  </div>
                </div>
              </CardHeader>
              <CardContent className="p-6 space-y-4">
                <p className="text-slate-300">{criticalSignal.description}</p>
                <div className="flex items-center gap-4 text-sm text-slate-400">
                  <span className="flex items-center gap-1">
                    <Globe className="w-4 h-4" />
                    {criticalSignal.source}
                  </span>
                  <span className="flex items-center gap-1">
                    <Clock className="w-4 h-4" />
                    Just now
                  </span>
                </div>
                <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                  <p className="text-amber-400 font-medium flex items-center gap-2">
                    <Zap className="w-4 h-4" />
                    M Recommendation: Activate "Competitor M&A Response" playbook immediately
                  </p>
                </div>
              </CardContent>
              <CardFooter className="border-t border-slate-700 bg-slate-800/50">
                <Button 
                  className="w-full bg-red-600 hover:bg-red-700 text-white"
                  onClick={handleAcknowledgeAlert}
                  data-testid="button-acknowledge-alert"
                >
                  <Bell className="w-4 h-4 mr-2" />
                  Acknowledge & Respond
                </Button>
              </CardFooter>
            </Card>
          </div>
        )}

        {/* Top Bar */}
        <div className="border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 sticky top-0 z-40">
          <div className="container mx-auto px-4 py-3">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <div className="flex items-center gap-2">
                  <Avatar className="w-10 h-10 border-2 border-teal-500">
                    <AvatarFallback className="bg-teal-600 text-white font-bold">SC</AvatarFallback>
                  </Avatar>
                  <div>
                    <p className="font-semibold text-slate-900 dark:text-white text-sm">{COMPANY_PROFILE.persona}</p>
                    <p className="text-xs text-slate-500 dark:text-slate-400">{COMPANY_PROFILE.role}  {COMPANY_PROFILE.name}</p>
                  </div>
                </div>
                <Separator orientation="vertical" className="h-8" />
                <Badge variant="outline" className="text-xs">
                  <CircleDot className="w-3 h-3 mr-1 text-green-500" />
                  Simulation Active
                </Badge>
              </div>

              <div className="flex items-center gap-4">
                {/* Timer */}
                <div className="flex items-center gap-2 bg-slate-100 dark:bg-slate-800 px-4 py-2 rounded-lg">
                  <Timer className="w-4 h-4 text-blue-500" />
                  <span className="font-mono font-bold text-slate-900 dark:text-white" data-testid="text-elapsed-time">
                    {formatTime(elapsedTime)}
                  </span>
                </div>

                {/* Notifications */}
                <Button variant="ghost" size="icon" className="relative" data-testid="button-notifications">
                  <Bell className="w-5 h-5" />
                  {notifications.filter(n => !n.read).length > 0 && (
                    <span className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">
                      {notifications.filter(n => !n.read).length}
                    </span>
                  )}
                </Button>

                <Button 
                  variant="outline" 
                  size="sm"
                  onClick={resetSimulation}
                  data-testid="button-reset-simulation"
                >
                  <RotateCcw className="w-4 h-4 mr-1" />
                  Reset
                </Button>
              </div>
            </div>
          </div>
        </div>

        {/* Phase Indicator */}
        <div className="bg-gradient-to-r from-blue-600 to-teal-500 text-white py-2">
            <div className="container mx-auto px-4">
              <div className="flex items-center justify-between text-sm">
                <div className="flex items-center gap-2">
                  <Activity className="w-4 h-4" />
                  <span>Current Phase: <strong>{phase.replace('_', ' ').toUpperCase()}</strong></span>
                </div>
                <div className="flex items-center gap-4">
                  {phase === 'execution' && (
                    <span className="flex items-center gap-2">
                      <Progress value={progressPercent} className="w-32 h-2" />
                      <span>{completedActions}/{playbookActions.length} tasks</span>
                    </span>
                  )}
                </div>
              </div>
            </div>
          </div>

        {/* Main Content */}
        <div className="container mx-auto px-4 py-6">
          <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
            <TabsList className="grid grid-cols-4 w-full max-w-2xl mx-auto" data-testid="tabs-main-navigation">
              <TabsTrigger value="radar" className="flex items-center gap-2" data-testid="tab-radar">
                <Radio className="w-4 h-4" />
                Radar
              </TabsTrigger>
              <TabsTrigger value="signals" className="flex items-center gap-2" data-testid="tab-signals">
                <AlertTriangle className="w-4 h-4" />
                Signals
                {signals.filter(s => s.actionRequired).length > 0 && (
                  <Badge className="ml-1 bg-red-500 text-white h-5 w-5 p-0 flex items-center justify-center text-xs">
                    {signals.filter(s => s.actionRequired).length}
                  </Badge>
                )}
              </TabsTrigger>
              <TabsTrigger value="playbooks" className="flex items-center gap-2" data-testid="tab-playbooks">
                <FileText className="w-4 h-4" />
                Playbooks
              </TabsTrigger>
              <TabsTrigger value="command" className="flex items-center gap-2" data-testid="tab-command">
                <Radio className="w-4 h-4" />
                Command
              </TabsTrigger>
            </TabsList>

            {/* Radar Tab */}
            <TabsContent value="radar" className="space-y-6">
              <div className="grid lg:grid-cols-3 gap-6">
                {/* Main Radar Display */}
                <div className="lg:col-span-2">
                  <Card className="border-slate-200 dark:border-slate-800">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <Radio className="w-5 h-5 text-blue-500" />
                        Foresight Radar
                      </CardTitle>
                      <CardDescription>Real-time intelligence monitoring across 12 signal sources</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="aspect-square max-w-md mx-auto relative bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center">
                        <div className="absolute inset-4 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-full"></div>
                        <div className="absolute inset-12 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-full"></div>
                        <div className="absolute inset-20 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-full"></div>
                        
                        <div className="absolute inset-0 flex items-center justify-center">
                          <div className="w-4 h-4 bg-blue-500 rounded-full animate-ping"></div>
                        </div>
                        
                        {signals.map((signal, index) => {
                          const angle = (index * 72) * (Math.PI / 180);
                          const radius = signal.severity === 'critical' ? 60 : signal.severity === 'high' ? 100 : 140;
                          const x = Math.cos(angle) * radius;
                          const y = Math.sin(angle) * radius;
                          
                          return (
                            <div 
                              key={signal.id}
                              className={`absolute w-4 h-4 rounded-full ${
                                signal.severity === 'critical' ? 'bg-red-500 animate-pulse' :
                                signal.severity === 'high' ? 'bg-orange-500' :
                                signal.severity === 'medium' ? 'bg-yellow-500' : 'bg-blue-500'
                              }`}
                              style={{ 
                                transform: `translate(${x}px, ${y}px)`,
                                left: '50%',
                                top: '50%'
                              }}
                              title={signal.title}
                            ></div>
                          );
                        })}

                        <div className="text-center z-10">
                          <p className="text-2xl font-bold text-slate-900 dark:text-white">{signals.length}</p>
                          <p className="text-xs text-slate-500 dark:text-slate-400">Active Signals</p>
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {/* Team Status */}
                <Card className="border-slate-200 dark:border-slate-800">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-base">
                      <Users className="w-5 h-5 text-purple-500" />
                      Executive Team
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <ScrollArea className="h-80">
                      <div className="space-y-3">
                        {TEAM_MEMBERS.map(member => (
                          <div key={member.id} className="flex items-center gap-3 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                            <Avatar className="w-10 h-10">
                              <AvatarFallback className={`text-sm font-bold ${
                                member.status === 'available' ? 'bg-green-100 text-green-700' :
                                member.status === 'busy' ? 'bg-amber-100 text-amber-700' :
                                'bg-slate-100 text-slate-500'
                              }`}>
                                {member.avatar}
                              </AvatarFallback>
                            </Avatar>
                            <div className="flex-1 min-w-0">
                              <p className="font-medium text-sm text-slate-900 dark:text-white truncate">{member.name}</p>
                              <p className="text-xs text-slate-500 dark:text-slate-400">{member.role}</p>
                            </div>
                            <div className={`w-2 h-2 rounded-full ${
                              member.status === 'available' ? 'bg-green-500' :
                              member.status === 'busy' ? 'bg-amber-500' :
                              'bg-slate-300'
                            }`}></div>
                          </div>
                        ))}
                      </div>
                    </ScrollArea>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            {/* Signals Tab */}
            <TabsContent value="signals" className="space-y-6">
              <div className="grid gap-4">
                {signals.map(signal => (
                  <Card 
                    key={signal.id} 
                    className={`border-l-4 ${
                      signal.severity === 'critical' ? 'border-l-red-500 bg-red-50 dark:bg-red-950/20' :
                      signal.severity === 'high' ? 'border-l-orange-500' :
                      signal.severity === 'medium' ? 'border-l-yellow-500' : 'border-l-blue-500'
                    }`}
                    data-testid={`card-signal-${signal.id}`}
                  >
                    <CardContent className="p-4">
                      <div className="flex items-start justify-between gap-4">
                        <div className="flex items-start gap-3">
                          <div className={`p-2 rounded-lg ${
                            signal.severity === 'critical' ? 'bg-red-100 dark:bg-red-900/30' :
                            signal.severity === 'high' ? 'bg-orange-100 dark:bg-orange-900/30' :
                            'bg-blue-100 dark:bg-blue-900/30'
                          }`}>
                            <signal.icon className={`w-5 h-5 ${
                              signal.severity === 'critical' ? 'text-red-600' :
                              signal.severity === 'high' ? 'text-orange-600' :
                              'text-blue-600'
                            }`} />
                          </div>
                          <div>
                            <div className="flex items-center gap-2 mb-1">
                              <Badge className={getSeverityColor(signal.severity)}>
                                {signal.severity.toUpperCase()}
                              </Badge>
                              <span className="text-xs text-slate-500">{signal.source}</span>
                            </div>
                            <h3 className="font-semibold text-slate-900 dark:text-white">{signal.title}</h3>
                            <p className="text-sm text-slate-600 dark:text-slate-400 mt-1">{signal.description}</p>
                          </div>
                        </div>
                        {signal.actionRequired && phase === 'playbook_selection' && (
                          <Button 
                            size="sm" 
                            className="bg-blue-600 hover:bg-blue-700"
                            onClick={() => handleSelectPlaybook('competitor-ma-response')}
                            data-testid="button-respond-signal"
                          >
                            Respond
                            <ArrowRight className="w-4 h-4 ml-1" />
                          </Button>
                        )}
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </TabsContent>

            {/* Playbooks Tab */}
            <TabsContent value="playbooks" className="space-y-6">
              {phase === 'playbook_selection' ? (
                <div className="space-y-4">
                  <div className="bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4">
                    <p className="text-amber-800 dark:text-amber-200 flex items-center gap-2">
                      <Zap className="w-5 h-5" />
                      <strong>M Recommendation:</strong> Based on the detected signal, the following playbook is recommended
                    </p>
                  </div>
                  
                  <Card 
                    className="border-2 border-blue-500 bg-blue-50 dark:bg-blue-950/20 cursor-pointer hover:shadow-lg transition-all"
                    onClick={() => handleSelectPlaybook('competitor-ma-response')}
                    data-testid="card-recommended-playbook"
                  >
                    <CardHeader>
                      <div className="flex items-center justify-between">
                        <div>
                          <Badge className="mb-2 bg-blue-500 text-white">RECOMMENDED</Badge>
                          <CardTitle className="text-xl">Competitor M&A Response Protocol</CardTitle>
                          <CardDescription>Comprehensive response framework for competitor acquisition events</CardDescription>
                        </div>
                        <div className="text-right">
                          <p className="text-sm text-slate-500">Est. Coordination Time</p>
                          <p className="text-2xl font-bold text-blue-600">12 min</p>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="grid md:grid-cols-2 gap-4">
                        <div>
                          <h4 className="font-semibold text-sm text-slate-700 dark:text-slate-300 mb-2">Key Actions</h4>
                          <ul className="space-y-1 text-sm text-slate-600 dark:text-slate-400">
                            <li className="flex items-center gap-2">
                              <CheckCircle2 className="w-4 h-4 text-green-500" />
                              Executive team mobilization
                            </li>
                            <li className="flex items-center gap-2">
                              <CheckCircle2 className="w-4 h-4 text-green-500" />
                              Supply chain impact assessment
                            </li>
                            <li className="flex items-center gap-2">
                              <CheckCircle2 className="w-4 h-4 text-green-500" />
                              Competitive positioning analysis
                            </li>
                            <li className="flex items-center gap-2">
                              <CheckCircle2 className="w-4 h-4 text-green-500" />
                              Customer retention activation
                            </li>
                          </ul>
                        </div>
                        <div>
                          <h4 className="font-semibold text-sm text-slate-700 dark:text-slate-300 mb-2">Stakeholders</h4>
                          <div className="flex flex-wrap gap-2">
                            <Badge variant="outline">CFO</Badge>
                            <Badge variant="outline">CMO</Badge>
                            <Badge variant="outline">VP Ops</Badge>
                            <Badge variant="outline">Legal</Badge>
                            <Badge variant="outline">VP Sales</Badge>
                          </div>
                        </div>
                      </div>
                    </CardContent>
                    <CardFooter className="bg-blue-100 dark:bg-blue-900/30">
                      <Button className="w-full bg-blue-600 hover:bg-blue-700" data-testid="button-activate-playbook">
                        <Rocket className="w-4 h-4 mr-2" />
                        Activate This Playbook
                      </Button>
                    </CardFooter>
                  </Card>
                </div>
              ) : phase === 'team_coordination' ? (
                <div className="space-y-6">
                  <Card className="border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950/20">
                    <CardHeader>
                      <div className="flex items-center gap-3">
                        <CheckCircle2 className="w-8 h-8 text-green-600" />
                        <div>
                          <CardTitle>Playbook Activated: Competitor M&A Response</CardTitle>
                          <CardDescription>Team notifications sent. Review actions below and launch execution.</CardDescription>
                        </div>
                      </div>
                    </CardHeader>
                  </Card>

                  <Card>
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <Target className="w-5 h-5 text-purple-500" />
                        Coordinated Action Plan
                      </CardTitle>
                      <CardDescription>{playbookActions.length} actions across {new Set(playbookActions.map(a => a.department)).size} departments</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-3">
                        {playbookActions.map((action, index) => (
                          <div 
                            key={action.id} 
                            className="flex items-center gap-4 p-3 bg-slate-50 dark:bg-slate-800 rounded-lg"
                            data-testid={`action-${action.id}`}
                          >
                            <div className="w-8 h-8 bg-slate-200 dark:bg-slate-700 rounded-full flex items-center justify-center text-sm font-bold text-slate-600 dark:text-slate-300">
                              {index + 1}
                            </div>
                            <div className="flex-1">
                              <p className="font-medium text-slate-900 dark:text-white">{action.name}</p>
                              <p className="text-sm text-slate-500">{action.assignee}  {action.department}</p>
                            </div>
                            <Badge variant="outline">{action.duration}</Badge>
                          </div>
                        ))}
                      </div>
                    </CardContent>
                    <CardFooter>
                      <Button 
                        className="w-full bg-gradient-to-r from-blue-600 to-teal-500 hover:from-blue-700 hover:to-teal-600"
                        onClick={handleLaunchExecution}
                        data-testid="button-launch-execution"
                      >
                        <Rocket className="w-4 h-4 mr-2" />
                        Launch Coordinated Response
                      </Button>
                    </CardFooter>
                  </Card>
                </div>
              ) : (
                <div className="text-center py-12">
                  <FileText className="w-12 h-12 text-slate-400 mx-auto mb-4" />
                  <p className="text-slate-500 dark:text-slate-400">Playbooks will be recommended when a signal requires response</p>
                </div>
              )}
            </TabsContent>

            {/* Command Tab */}
            <TabsContent value="command" className="space-y-6">
              {(phase === 'execution' || phase === 'monitoring') ? (
                <div className="space-y-6">
                  <Card className="border-blue-200 dark:border-blue-800">
                    <CardHeader className="bg-gradient-to-r from-blue-600 to-teal-500 text-white rounded-t-lg">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <Radio className="w-6 h-6" />
                          <div>
                            <CardTitle className="text-white">Command Center Active</CardTitle>
                            <CardDescription className="text-blue-100">Coordinating response in real-time</CardDescription>
                          </div>
                        </div>
                        <div className="text-right">
                          <p className="text-blue-100 text-sm">Elapsed Time</p>
                          <p className="text-2xl font-mono font-bold">{formatTime(elapsedTime)}</p>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent className="p-6">
                      <div className="mb-6">
                        <div className="flex justify-between text-sm mb-2">
                          <span className="text-slate-600 dark:text-slate-400">Overall Progress</span>
                          <span className="font-medium text-slate-900 dark:text-white">{completedActions}/{playbookActions.length} Actions Complete</span>
                        </div>
                        <Progress value={progressPercent} className="h-3" />
                      </div>

                      <div className="space-y-3">
                        {playbookActions.map((action) => (
                          <div 
                            key={action.id} 
                            className={`flex items-center gap-4 p-4 rounded-lg border ${
                              action.status === 'completed' ? 'bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800' :
                              action.status === 'in_progress' ? 'bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800' :
                              'bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700'
                            }`}
                            data-testid={`execution-action-${action.id}`}
                          >
                            <div className={getStatusColor(action.status)}>
                              {getStatusIcon(action.status)}
                            </div>
                            <div className="flex-1">
                              <p className={`font-medium ${
                                action.status === 'completed' ? 'text-green-700 dark:text-green-400' :
                                action.status === 'in_progress' ? 'text-blue-700 dark:text-blue-400' :
                                'text-slate-700 dark:text-slate-300'
                              }`}>
                                {action.name}
                              </p>
                              <p className="text-sm text-slate-500">{action.assignee}  {action.department}</p>
                            </div>
                            <Badge variant="outline" className={
                              action.status === 'completed' ? 'border-green-500 text-green-600' :
                              action.status === 'in_progress' ? 'border-blue-500 text-blue-600' :
                              ''
                            }>
                              {action.status === 'completed' ? 'Done' : 
                               action.status === 'in_progress' ? 'Running' : 
                               action.duration}
                            </Badge>
                          </div>
                        ))}
                      </div>
                    </CardContent>
                  </Card>
                </div>
              ) : (
                <div className="text-center py-12">
                  <Radio className="w-12 h-12 text-slate-400 mx-auto mb-4" />
                  <p className="text-slate-500 dark:text-slate-400">Command Center activates when a playbook is launched</p>
                </div>
              )}
            </TabsContent>
          </Tabs>
        </div>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/ExecutiveSuite.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import PageLayout from '@/components/layout/PageLayout';
import { 
  Crown, 
  TrendingUp, 
  Users, 
  DollarSign, 
  Target, 
  Briefcase,
  BarChart3,
  AlertCircle,
  CheckCircle,
  Clock,
  FileText,
  Globe,
  Shield,
  Brain,
  Trophy
} from 'lucide-react';

export default function ExecutiveSuite() {
  const executiveMetrics = [
    { title: "Strategic Initiatives", value: "12 Active", change: "+3 this quarter", trend: "up" },
    { title: "Organizational Health", value: "92%", change: "+8% vs last quarter", trend: "up" },
    { title: "Crisis Readiness", value: "97%", change: "Protocols updated", trend: "stable" },
    { title: "Innovation Pipeline", value: "28 Projects", change: "+5 breakthrough opportunities", trend: "up" }
  ];

  const boardReports = [
    {
      title: "Q3 Strategic Performance Review",
      type: "Quarterly Board Report",
      status: "Ready for Review",
      date: "September 2025",
      icon: <FileText className="w-5 h-5 text-blue-400" />
    },
    {
      title: "Crisis Response Capabilities Assessment",
      type: "Risk Management Report",
      status: "Completed",
      date: "August 2025",
      icon: <Shield className="w-5 h-5 text-green-400" />
    },
    {
      title: "Organizational Intelligence ROI Analysis",
      type: "Investment Performance",
      status: "In Progress",
      date: "September 2025",
      icon: <TrendingUp className="w-5 h-5 text-orange-400" />
    }
  ];

  const executivePriorities = [
    "Digital transformation acceleration (+23% efficiency gains)",
    "Crisis response protocol optimization (4-minute activation time)",
    "AI-powered decision intelligence (85-92% accuracy rate)",
    "Cross-functional team collaboration enhancement",
    "Innovation pipeline management (28 active projects)"
  ];

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800">
        <div className="p-8">
          {/* Executive Header */}
          <div className="flex items-center justify-between mb-8">
            <div className="flex items-center space-x-4">
              <div className="w-12 h-12 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center">
                <Crown className="w-7 h-7 text-white" />
              </div>
              <div>
                <h1 className="text-3xl font-bold text-gray-900 dark:text-white">Executive Command Center</h1>
                <p className="text-gray-600 dark:text-gray-300">C-Suite Intelligence & Strategic Command</p>
              </div>
            </div>
            <div className="flex items-center space-x-3">
              <Badge variant="outline" className="text-green-600 border-green-500/50">
                <CheckCircle className="w-3 h-3 mr-1" />
                All Systems Operational
              </Badge>
              <Badge className="bg-purple-600 text-white">
                Executive Access
              </Badge>
            </div>
          </div>

          {/* Executive Value Benchmarks - Based on Fortune 1000 Customer Data */}
          <Card className="mb-8 bg-gradient-to-r from-blue-50 via-purple-50 to-blue-50 dark:from-blue-950/30 dark:via-purple-950/30 dark:to-blue-950/30 border-2 border-blue-400 dark:border-blue-600">
            <CardHeader className="pb-3">
              <CardTitle className="text-sm font-semibold text-blue-700 dark:text-blue-400 uppercase tracking-wider">
                Platform ROI Benchmarks (Avg Fortune 1000 Customer Results)
              </CardTitle>
            </CardHeader>
            <CardContent className="pt-0">
              <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div className="text-center">
                  <DollarSign className="h-8 w-8 text-green-600 dark:text-green-400 mx-auto mb-2" />
                  <div className="text-3xl font-bold text-green-600 dark:text-green-400">$5.8M</div>
                  <div className="text-sm text-muted-foreground">Avg Annual Value</div>
                  <div className="text-xs text-green-600 dark:text-green-400 mt-1">48x Avg ROI</div>
                </div>
                <div className="text-center">
                  <Shield className="h-8 w-8 text-blue-600 dark:text-blue-400 mx-auto mb-2" />
                  <div className="text-3xl font-bold text-blue-600 dark:text-blue-400">$4.2M</div>
                  <div className="text-sm text-muted-foreground">Avg Risk Mitigation</div>
                  <div className="text-xs text-blue-600 dark:text-blue-400 mt-1">Crisis Prevention Benchmark</div>
                </div>
                <div className="text-center">
                  <Clock className="h-8 w-8 text-purple-600 dark:text-purple-400 mx-auto mb-2" />
                  <div className="text-3xl font-bold text-purple-600 dark:text-purple-400">720 Hours</div>
                  <div className="text-sm text-muted-foreground">Avg Time Saved/Year</div>
                  <div className="text-xs text-purple-600 dark:text-purple-400 mt-1">Target: 12 min vs 72h industry</div>
                </div>
                <div className="text-center">
                  <Trophy className="h-8 w-8 text-orange-600 dark:text-orange-400 mx-auto mb-2" />
                  <div className="text-3xl font-bold text-orange-600 dark:text-orange-400">92%</div>
                  <div className="text-sm text-muted-foreground">Avg Board Confidence</div>
                  <div className="text-xs text-orange-600 dark:text-orange-400 mt-1">Decision Velocity Benchmark</div>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Executive Performance Dashboard */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            {executiveMetrics.map((metric, index) => (
              <Card key={index} className="bg-white/90 dark:bg-slate-800/90 backdrop-blur border-slate-200 dark:border-slate-700">
                <CardHeader className="pb-3">
                  <CardTitle className="text-sm font-medium text-gray-600 dark:text-gray-400">{metric.title}</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold text-gray-900 dark:text-white mb-1">{metric.value}</div>
                  <div className={`text-sm flex items-center ${
                    metric.trend === 'up' ? 'text-green-600' : 
                    metric.trend === 'down' ? 'text-red-600' : 'text-gray-500'
                  }`}>
                    {metric.trend === 'up' && <TrendingUp className="w-3 h-3 mr-1" />}
                    {metric.change}
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {/* Board Reports */}
            <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur border-slate-200 dark:border-slate-700">
              <CardHeader>
                <CardTitle className="flex items-center text-gray-900 dark:text-white">
                  <Briefcase className="w-5 h-5 mr-2 text-purple-500" />
                  Board Reports & Strategic Documentation
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {boardReports.map((report, index) => (
                  <div key={index} className="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                    <div className="flex items-center space-x-3">
                      {report.icon}
                      <div>
                        <h4 className="font-semibold text-gray-900 dark:text-white">{report.title}</h4>
                        <p className="text-sm text-gray-600 dark:text-gray-400">{report.type}  {report.date}</p>
                      </div>
                    </div>
                    <Badge variant={report.status === 'Completed' ? 'default' : 'secondary'}>
                      {report.status}
                    </Badge>
                  </div>
                ))}
                <Button className="w-full mt-4" data-testid="button-generate-board-report">
                  Generate Executive Summary
                </Button>
              </CardContent>
            </Card>

            {/* Strategic Priorities */}
            <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur border-slate-200 dark:border-slate-700">
              <CardHeader>
                <CardTitle className="flex items-center text-gray-900 dark:text-white">
                  <Target className="w-5 h-5 mr-2 text-blue-500" />
                  Current Strategic Priorities
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-3 mb-6">
                  {executivePriorities.map((priority, index) => (
                    <div key={index} className="flex items-start space-x-3 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                      <CheckCircle className="w-4 h-4 mt-0.5 text-green-500 flex-shrink-0" />
                      <span className="text-sm text-gray-700 dark:text-gray-300">{priority}</span>
                    </div>
                  ))}
                </div>
                <div className="flex space-x-3">
                  <Button size="sm" variant="outline" data-testid="button-update-priorities">
                    Update Priorities
                  </Button>
                  <Button size="sm" data-testid="button-strategic-review">
                    Schedule Strategic Review
                  </Button>
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Executive Command Actions */}
          <Card className="mt-8 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-purple-200 dark:border-purple-800">
            <CardHeader>
              <CardTitle className="flex items-center text-gray-900 dark:text-white">
                <Crown className="w-5 h-5 mr-2 text-purple-500" />
                Executive Command Actions
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <Button className="h-16 bg-red-600 hover:bg-red-700 text-white" data-testid="button-emergency-activation">
                  <AlertCircle className="w-5 h-5 mr-2" />
                  Emergency Crisis Activation
                </Button>
                <Button className="h-16 bg-blue-600 hover:bg-blue-700 text-white" data-testid="button-strategic-intelligence">
                  <Brain className="w-5 h-5 mr-2" />
                  AI Strategic Intelligence
                </Button>
                <Button className="h-16 bg-green-600 hover:bg-green-700 text-white" data-testid="button-board-presentation">
                  <Briefcase className="w-5 h-5 mr-2" />
                  Generate Board Presentation
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/ExecutiveWarRoomPage.tsx
========================================
import { ExecutiveWarRoom } from '@/components/ExecutiveWarRoom';
import PageLayout from '@/components/layout/PageLayout';

export default function ExecutiveWarRoomPage() {
  return (
    <PageLayout>
      <ExecutiveWarRoom />
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/FinancialRansomwareDemo.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useState } from "react";
import { Link } from "wouter";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { 
  Building2, 
  Users, 
  DollarSign, 
  Clock, 
  AlertTriangle,
  Shield,
  ArrowRight,
  CheckCircle2,
  RotateCcw,
  Library
} from "lucide-react";
import { financialDemoData } from "@shared/financial-demo-data";
import AIRadarSimulation from "@/components/demo/AIRadarSimulation";
import TwelveMinuteTimer from "@/components/demo/TwelveMinuteTimer";
import ROIComparison from "@/components/demo/ROIComparison";
import DemoNavHeader from "@/components/demo/DemoNavHeader";

type Act = "introduction" | "ai-detection" | "coordination" | "outcome" | "summary";

export default function FinancialRansomwareDemo() {
  const [currentAct, setCurrentAct] = useState<Act>("introduction");

  const handleStartDemo = () => {
    setCurrentAct("ai-detection");
  };

  const handleTriggerFired = () => {
    setCurrentAct("coordination");
  };

  const handleCoordinationComplete = () => {
    setCurrentAct("outcome");
  };

  const handleSeeSummary = () => {
    setCurrentAct("summary");
  };

  const handleRestart = () => {
    setCurrentAct("introduction");
  };

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900">
      <DemoNavHeader title="Financial Ransomware Demo" showBackButton={true} />

      {/* Progress Indicator */}
      <div className="border-b border-blue-800/20 bg-slate-950/30 pt-20">
        <div className="container mx-auto px-6 py-3">
          <div className="flex items-center gap-4 text-sm">
            <div className={`flex items-center gap-2 ${currentAct === "introduction" ? "text-blue-400" : "text-blue-600"}`}>
              <div className={`w-2 h-2 rounded-full ${currentAct === "introduction" ? "bg-blue-400" : "bg-blue-800"}`} />
              Introduction
            </div>
            <div className="flex-1 page-background h-px bg-blue-900" />
            <div className={`flex items-center gap-2 ${currentAct === "ai-detection" ? "text-blue-400" : "text-blue-600"}`}>
              <div className={`w-2 h-2 rounded-full ${currentAct === "ai-detection" ? "bg-blue-400" : "bg-blue-800"}`} />
              AI Detection
            </div>
            <div className="flex-1 page-background h-px bg-blue-900" />
            <div className={`flex items-center gap-2 ${currentAct === "coordination" ? "text-blue-400" : "text-blue-600"}`}>
              <div className={`w-2 h-2 rounded-full ${currentAct === "coordination" ? "bg-blue-400" : "bg-blue-800"}`} />
              Coordination
            </div>
            <div className="flex-1 page-background h-px bg-blue-900" />
            <div className={`flex items-center gap-2 ${currentAct === "outcome" || currentAct === "summary" ? "text-blue-400" : "text-blue-600"}`}>
              <div className={`w-2 h-2 rounded-full ${currentAct === "outcome" || currentAct === "summary" ? "bg-blue-400" : "bg-blue-800"}`} />
              Outcome
            </div>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-6 py-12">
        {/* Introduction Act */}
        {currentAct === "introduction" && (
          <div className="max-w-5xl mx-auto space-y-8 animate-fade-in">
            <div className="text-center space-y-4">
              <h2 className="text-4xl font-bold text-white">{financialDemoData.crisis.title}</h2>
              <p className="text-xl text-blue-200">{financialDemoData.crisis.subtitle}</p>
            </div>

            {/* Organization Info */}
            <Card className="bg-slate-900/50 border-blue-800/30 p-6">
              <div className="flex items-start gap-4 mb-4">
                <Building2 className="w-6 h-6 text-blue-400 mt-1" />
                <div>
                  <h3 className="text-lg font-semibold text-white mb-2">{financialDemoData.organization.name}</h3>
                  <p className="text-blue-200 mb-4">{financialDemoData.organization.type}</p>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    {Object.entries(financialDemoData.organization.stats).map(([key, value]) => (
                      <div key={key}>
                        <div className="text-2xl font-bold text-blue-400">{value}</div>
                        <div className="text-sm text-blue-300 capitalize">{key.replace(/([A-Z])/g, ' $1').trim()}</div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </Card>

            {/* Crisis Scenario */}
            <Card className="bg-slate-900/50 border-red-800/50 p-6">
              <div className="flex items-start gap-4">
                <AlertTriangle className="w-6 h-6 text-red-400 mt-1" />
                <div className="flex-1 page-background">
                  <h3 className="text-lg font-semibold text-white mb-3">The Crisis Scenario</h3>
                  <p className="text-blue-100 mb-4 leading-relaxed">{financialDemoData.crisis.description}</p>
                  
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="bg-slate-950/50 p-4 rounded-lg border border-red-800/30">
                      <DollarSign className="w-5 h-5 text-red-400 mb-2" />
                      <div className="text-xl font-bold text-white">{financialDemoData.crisis.impactMetrics.financialImpact}</div>
                      <div className="text-sm text-red-300">At Risk</div>
                    </div>
                    <div className="bg-slate-950/50 p-4 rounded-lg border border-blue-800/30">
                      <Clock className="w-5 h-5 text-blue-400 mb-2" />
                      <div className="text-xl font-bold text-white">{financialDemoData.crisis.impactMetrics.timeWindow}</div>
                      <div className="text-sm text-blue-300">Response Window</div>
                    </div>
                    <div className="bg-slate-950/50 p-4 rounded-lg border border-blue-800/30">
                      <Users className="w-5 h-5 text-blue-400 mb-2" />
                      <div className="text-xl font-bold text-white">{financialDemoData.crisis.impactMetrics.stakeholders}</div>
                      <div className="text-sm text-blue-300">Stakeholders</div>
                    </div>
                    <div className="bg-slate-950/50 p-4 rounded-lg border border-red-800/30">
                      <AlertTriangle className="w-5 h-5 text-red-400 mb-2" />
                      <div className="text-xl font-bold text-white">{financialDemoData.crisis.impactMetrics.affectedCustomers}</div>
                      <div className="text-sm text-red-300">Affected Customers</div>
                    </div>
                  </div>
                </div>
              </div>
            </Card>

            {/* Playbook Info */}
            <Card className="bg-gradient-to-r from-blue-950/50 to-purple-950/50 border-blue-800/30 p-6">
              <h3 className="text-lg font-semibold text-white mb-4">M Playbook: {financialDemoData.playbook.id} - {financialDemoData.playbook.name}</h3>
              <div className="flex items-center gap-6 mb-4">
                <div className="text-sm text-blue-200">Domain: <span className="text-white font-semibold">{financialDemoData.playbook.domain}</span></div>
                <div className="text-sm text-blue-200">Sections: <span className="text-white font-semibold">{financialDemoData.playbook.sections}</span></div>
                <div className="text-sm text-blue-200">
                  Preparedness: <span className="text-green-400 font-semibold">{financialDemoData.playbook.preparedness}%</span>
                </div>
              </div>
            </Card>

            <div className="text-center">
              <Button
                size="lg"
                onClick={handleStartDemo}
                className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-6 text-lg"
                data-testid="button-start-demo"
              >
                Begin Crisis Simulation
                <ArrowRight className="w-5 h-5 ml-2" />
              </Button>
            </div>
          </div>
        )}

        {/* Act 1: AI Detection */}
        {currentAct === "ai-detection" && (
          <div className="max-w-5xl mx-auto">
            <AIRadarSimulation
              title="AI Ransomware Detection System"
              subtitle="Real-time threat monitoring across banking infrastructure"
              dataStreams={financialDemoData.aiDataStreams}
              playbookId={financialDemoData.playbook.id}
              playbookName={financialDemoData.playbook.name}
              onTriggerFired={handleTriggerFired}
            />
          </div>
        )}

        {/* Act 2: 12-Minute Coordination */}
        {currentAct === "coordination" && (
          <div className="max-w-5xl mx-auto">
            <TwelveMinuteTimer
              title="12-Minute Coordinated Response"
              subtitle="Ransomware containment and recovery protocol executing"
              timelineEvents={financialDemoData.timelineEvents}
              onComplete={handleCoordinationComplete}
            />
          </div>
        )}

        {/* Act 3: ROI Outcome */}
        {currentAct === "outcome" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <div className="text-center mb-8">
              <h2 className="text-3xl font-bold text-white mb-2">Crisis Contained</h2>
              <p className="text-xl text-blue-200">Compare the traditional approach vs. M's coordinated response</p>
            </div>

            <ROIComparison
              traditional={financialDemoData.roiComparison.traditional}
              vexor={financialDemoData.roiComparison.vexor}
              bottomLine={financialDemoData.roiComparison.bottomLine}
            />

            <div className="text-center">
              <Button
                size="lg"
                onClick={handleSeeSummary}
                className="bg-blue-600 hover:bg-blue-700 text-white px-8"
                data-testid="button-see-summary"
              >
                See Final Summary
                <ArrowRight className="w-5 h-5 ml-2" />
              </Button>
            </div>
          </div>
        )}

        {/* Final Summary */}
        {currentAct === "summary" && (
          <div className="max-w-4xl mx-auto space-y-8">
            <div className="text-center">
              <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-500/20 mb-4">
                <CheckCircle2 className="w-10 h-10 text-green-400" />
              </div>
              <h2 className="text-3xl font-bold text-white mb-2">Demo Complete</h2>
              <p className="text-xl text-blue-200">Financial Services Ransomware Response</p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <Card className="bg-slate-900/50 border-green-800/30 p-6 text-center">
                <DollarSign className="w-8 h-8 text-green-400 mx-auto mb-3" />
                <div className="text-3xl font-bold text-white mb-2">{financialDemoData.roiComparison.bottomLine.value}</div>
                <div className="text-sm text-green-300">Value Preserved</div>
              </Card>

              <Card className="bg-slate-900/50 border-blue-800/30 p-6 text-center">
                <Clock className="w-8 h-8 text-blue-400 mx-auto mb-3" />
                <div className="text-3xl font-bold text-white mb-2">12 min</div>
                <div className="text-sm text-blue-300">Full Coordination</div>
              </Card>

              <Card className="bg-slate-900/50 border-purple-800/30 p-6 text-center">
                <Users className="w-8 h-8 text-purple-400 mx-auto mb-3" />
                <div className="text-3xl font-bold text-white mb-2">{financialDemoData.crisis.impactMetrics.stakeholders}</div>
                <div className="text-sm text-purple-300">Stakeholders Aligned</div>
              </Card>
            </div>

            <Card className="bg-gradient-to-r from-blue-950/50 to-purple-950/50 border-blue-800/30 p-8">
              <h3 className="text-xl font-semibold text-white mb-4 text-center">The M Difference</h3>
              <p className="text-blue-100 text-center leading-relaxed max-w-3xl mx-auto">
                Your AI detected the ransomware in milliseconds. But without M, coordinating your CEO, CISO, CTO, CFO, legal counsel, Board, and regulators would take 48-72 hours of email chains and emergency meetings. In that window, a $1M incident becomes a $27M disaster. M turns instant detection into 12-minute coordinated responsewe're not replacing your AI, we're the execution layer that makes it deliver ROI.
              </p>
            </Card>

            <div className="flex justify-center gap-4">
              <Button
                size="lg"
                variant="outline"
                onClick={handleRestart}
                className="border-blue-600 text-blue-400 hover:bg-blue-950"
                data-testid="button-restart-demo"
              >
                <RotateCcw className="w-5 h-5 mr-2" />
                Restart Demo
              </Button>
              <Link href="/playbook-library">
                <Button
                  size="lg"
                  className="bg-blue-600 hover:bg-blue-700 text-white"
                  data-testid="button-explore-playbooks"
                >
                  <Library className="w-5 h-5 mr-2" />
                  Explore All 166 Playbooks
                </Button>
              </Link>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/FluxAdaptations.tsx
========================================
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Link } from 'wouter';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';
import { 
  TrendingUp, 
  Zap, 
  Target,
  ArrowRight,
  Clock,
  Users,
  DollarSign,
  BarChart3,
  Brain,
  Lightbulb,
  Settings,
  Play,
  ArrowLeft,
  Home
} from 'lucide-react';

export default function FluxAdaptations() {
  const [selectedStrategy, setSelectedStrategy] = useState('active');

  const adaptationStrategies = [
    {
      id: 'digital-transformation',
      name: 'Digital Transformation Acceleration',
      category: 'technology',
      priority: 'high',
      impact: 95,
      effort: 78,
      timeline: '6-12 months',
      status: 'active',
      description: 'Comprehensive digital infrastructure overhaul to enhance agility and responsiveness',
      outcomes: ['40% faster decision-making', 'Real-time data analytics', 'Automated processes'],
      icon: <Zap className="h-5 w-5" />
    },
    {
      id: 'market-expansion',
      name: 'Adaptive Market Expansion',
      category: 'business',
      priority: 'medium',
      impact: 88,
      effort: 65,
      timeline: '9-15 months',
      status: 'planning',
      description: 'Dynamic market entry strategies with rapid pivot capabilities',
      outcomes: ['New revenue streams', 'Market diversification', 'Risk mitigation'],
      icon: <Target className="h-5 w-5" />
    },
    {
      id: 'workforce-evolution',
      name: 'Workforce Evolution Strategy',
      category: 'human-capital',
      priority: 'high',
      impact: 92,
      effort: 55,
      timeline: '3-6 months',
      status: 'active',
      description: 'Adaptive talent management and skill development programs',
      outcomes: ['Increased adaptability', 'Skills diversification', 'Higher retention'],
      icon: <Users className="h-5 w-5" />
    },
    {
      id: 'financial-flexibility',
      name: 'Financial Flexibility Framework',
      category: 'finance',
      priority: 'critical',
      impact: 97,
      effort: 45,
      timeline: '2-4 months',
      status: 'active',
      description: 'Dynamic resource allocation and financial risk management',
      outcomes: ['Improved cash flow', 'Crisis resilience', 'Investment agility'],
      icon: <DollarSign className="h-5 w-5" />
    }
  ];

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'critical': return 'bg-red-500/20 text-red-400 border-red-500/30';
      case 'high': return 'bg-orange-500/20 text-orange-400 border-orange-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30';
      case 'low': return 'bg-green-500/20 text-green-400 border-green-500/30';
      default: return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'active': return 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30';
      case 'planning': return 'bg-blue-500/20 text-blue-400 border-blue-500/30';
      case 'paused': return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
      default: return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
    }
  };

  const filteredStrategies = adaptationStrategies.filter(strategy => 
    selectedStrategy === 'all' || strategy.status === selectedStrategy
  );

  return (
    <div className="h-full bg-transparent p-4" data-testid="flux-adaptations">
        <div className="w-full max-w-none mx-auto space-y-4 h-full overflow-hidden flex flex-col">
          
          {/* Breadcrumb Navigation */}
          <div className="mb-2 flex-shrink-0">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>AI Intelligence</span>
              <span>/</span>
              <span className="text-white">Flux Adaptations</span>
            </div>
          </div>

          {/* ROI Value Context - Tier 2 Enhancement */}
          <Card className="mb-4 bg-blue-50 dark:bg-blue-950/20 border-blue-300 dark:border-blue-700 flex-shrink-0" data-testid="flux-roi-context">
            <CardContent className="p-3 flex items-center gap-3">
              <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                <Zap className="h-5 w-5 text-blue-600" />
              </div>
              <div>
                <div className="font-semibold text-blue-900 dark:text-blue-100 text-sm">How Flux Saves You Money</div>
                <div className="text-xs text-blue-700 dark:text-blue-300">Catches competitive threats 3 weeks earlier than manual tracking, preventing $850K+ in market share losses</div>
              </div>
            </CardContent>
          </Card>

          {/* Header */}
          <div className="bg-gradient-to-r from-blue-600 to-cyan-600 text-white p-4 rounded-lg flex-shrink-0">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <TrendingUp className="h-10 w-10" />
                <div>
                  <h1 className="text-3xl font-bold" data-testid="flux-title">
                    Flux Adaptations
                  </h1>
                  <p className="text-blue-100">Dynamic adaptation strategies and change management intelligence</p>
                </div>
              </div>
              <div className="flex items-center gap-4">
                <OnboardingTrigger pageId="flux-adaptations" autoStart={true} className="bg-white/10 border-white/30 text-white hover:bg-white/20" />
                <Link to="/">
                  <Button variant="secondary" className="bg-blue-700 hover:bg-blue-800 text-blue-100 border-blue-600" data-testid="back-to-dashboard">
                    <ArrowLeft className="h-4 w-4 mr-2" />
                    Dashboard
                  </Button>
                </Link>
                <Badge variant="secondary" className="bg-blue-700 text-blue-100 border-blue-600" data-testid="ai-powered-badge">
                  <Brain className="h-4 w-4 mr-2" />
                  AI POWERED
                </Badge>
                <Button variant="secondary" className="bg-cyan-600 hover:bg-cyan-700 text-white" data-testid="generate-strategy-button">
                  <Lightbulb className="h-4 w-4 mr-2" />
                  Generate New Strategy
                </Button>
              </div>
            </div>
          </div>

          <Tabs value={selectedStrategy} onValueChange={setSelectedStrategy} className="w-full flex-1 flex flex-col min-h-0">
            <TabsList className="grid w-full grid-cols-4 flex-shrink-0">
              <TabsTrigger value="active" data-testid="tab-active">Active Strategies</TabsTrigger>
              <TabsTrigger value="planning" data-testid="tab-planning">In Planning</TabsTrigger>
              <TabsTrigger value="all" data-testid="tab-all">All Strategies</TabsTrigger>
              <TabsTrigger value="analytics" data-testid="tab-analytics">Analytics</TabsTrigger>
            </TabsList>

            <TabsContent value={selectedStrategy} className="flex-1 overflow-y-auto p-4 space-y-4">
              {selectedStrategy !== 'analytics' ? (
                <>
                  {/* Adaptation Strategies Grid */}
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                    {filteredStrategies.map((strategy) => (
                      <Card key={strategy.id} className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm hover:border-blue-500/30 transition-colors" data-testid={`strategy-${strategy.id}`}>
                        <CardHeader>
                          <div className="flex items-start justify-between">
                            <div className="flex items-center gap-3">
                              <div className="p-2 rounded-lg bg-blue-500/10">
                                <div className="text-blue-400">
                                  {strategy.icon}
                                </div>
                              </div>
                              <div>
                                <h3 className="font-semibold text-white">{strategy.name}</h3>
                                <p className="text-sm text-gray-400 capitalize">{strategy.category}  {strategy.timeline}</p>
                              </div>
                            </div>
                            <div className="flex flex-col gap-2">
                              <Badge variant="outline" className={getPriorityColor(strategy.priority)}>
                                {strategy.priority.toUpperCase()}
                              </Badge>
                              <Badge variant="outline" className={getStatusColor(strategy.status)}>
                                {strategy.status.toUpperCase()}
                              </Badge>
                            </div>
                          </div>
                        </CardHeader>
                        <CardContent className="space-y-4">
                          <p className="text-sm text-gray-300">{strategy.description}</p>
                          
                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <div className="flex items-center justify-between text-sm mb-1">
                                <span className="text-gray-400">Impact</span>
                                <span className="text-emerald-400 font-medium">{strategy.impact}%</span>
                              </div>
                              <Progress value={strategy.impact} className="h-2" />
                            </div>
                            <div>
                              <div className="flex items-center justify-between text-sm mb-1">
                                <span className="text-gray-400">Effort</span>
                                <span className="text-orange-400 font-medium">{strategy.effort}%</span>
                              </div>
                              <Progress value={strategy.effort} className="h-2" />
                            </div>
                          </div>

                          <div>
                            <h4 className="text-sm font-medium text-white mb-2">Expected Outcomes:</h4>
                            <ul className="space-y-1">
                              {strategy.outcomes.map((outcome, index) => (
                                <li key={index} className="flex items-center gap-2 text-sm text-gray-300">
                                  <ArrowRight className="h-3 w-3 text-blue-400" />
                                  {outcome}
                                </li>
                              ))}
                            </ul>
                          </div>

                          <div className="flex gap-2 pt-2">
                            <Button size="sm" variant="outline" className="flex-1">
                              <Settings className="h-4 w-4 mr-2" />
                              Configure
                            </Button>
                            <Button size="sm" className="flex-1 bg-blue-600 hover:bg-blue-700">
                              <Play className="h-4 w-4 mr-2" />
                              Execute
                            </Button>
                          </div>
                        </CardContent>
                      </Card>
                    ))}
                  </div>

                  {/* Strategy Insights */}
                  <Card className="border-purple-500/30 bg-purple-950/30 backdrop-blur-sm">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-purple-300">
                        <Brain className="h-5 w-5" />
                        AI Strategy Recommendations
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-4">
                        <div className="p-4 bg-blue-950/30 rounded-lg border border-blue-500/30">
                          <p className="text-blue-300 font-medium mb-2">Prioritization Recommendation</p>
                          <p className="text-blue-200 text-sm">Focus on Financial Flexibility Framework first - high impact with low effort, providing foundation for other adaptations.</p>
                        </div>
                        <div className="p-4 bg-green-950/30 rounded-lg border border-green-500/30">
                          <p className="text-green-300 font-medium mb-2">Synergy Opportunity</p>
                          <p className="text-green-200 text-sm">Digital Transformation and Workforce Evolution strategies can be executed in parallel for 25% efficiency gain.</p>
                        </div>
                        <div className="p-4 bg-orange-950/30 rounded-lg border border-orange-500/30">
                          <p className="text-orange-300 font-medium mb-2">Risk Mitigation</p>
                          <p className="text-orange-200 text-sm">Market Expansion strategy shows high risk - consider phased approach or additional contingency planning.</p>
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </>
              ) : (
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="text-white">Strategy Analytics & Performance</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-center py-12">
                      <BarChart3 className="h-16 w-16 text-gray-400 mx-auto mb-4" />
                      <p className="text-gray-400">Advanced strategy analytics and performance tracking</p>
                      <p className="text-sm text-gray-500 mt-2">Real-time adaptation effectiveness measurement</p>
                    </div>
                  </CardContent>
                </Card>
              )}
            </TabsContent>
          </Tabs>
        </div>
    </div>
  );
}

========================================
FILE: client/src/pages/ForesightRadar.tsx
========================================
import PageLayout from '@/components/layout/PageLayout';
import { useState } from 'react';
import { useLocation, Link } from 'wouter';
import { useDynamicStrategy } from '@/contexts/DynamicStrategyContext';
import { useWebSocket } from '@/hooks/useWebSocket';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';
import { Radio, AlertTriangle, TrendingUp, Eye, Zap, Settings, Database, Grid3X3, Play, Target, Shield, Lightbulb, ArrowRight, CheckCircle2 } from 'lucide-react';
import { SignalControlCenter } from '@/components/intelligence/SignalControlCenter';

interface EnhancedWeakSignal {
  id: string;
  title: string;
  description: string;
  source: string;
  confidence: number;
  category: string;
  impact: 'critical' | 'high' | 'medium' | 'low';
  timeline: string;
  timestamp: Date;
  suggestedPlaybook?: string;
}

interface EnhancedOraclePattern {
  id: string;
  name: string;
  description: string;
  accuracy: number;
  signals: number;
  trend: string;
  recommendation: string;
}

const demoWeakSignals: EnhancedWeakSignal[] = [
  {
    id: 'ws-1',
    title: 'Competitor Price Movement',
    description: 'Major competitor reduced enterprise pricing by 15% across three product lines. Social sentiment indicates positive market reception.',
    source: 'Market Intelligence',
    confidence: 87,
    category: 'Competitive',
    impact: 'high',
    timeline: '2-4 weeks',
    timestamp: new Date(),
    suggestedPlaybook: 'Competitive Response'
  },
  {
    id: 'ws-2',
    title: 'Key Talent Departure Risk',
    description: 'LinkedIn activity suggests increased recruiter engagement with senior engineering team. Glassdoor sentiment trending negative.',
    source: 'HR Analytics',
    confidence: 72,
    category: 'Talent',
    impact: 'critical',
    timeline: '1-2 weeks',
    timestamp: new Date(),
    suggestedPlaybook: 'Talent Retention'
  },
  {
    id: 'ws-3',
    title: 'Supply Chain Disruption',
    description: 'Port congestion in key shipping routes detected. Similar pattern preceded Q3 2024 delays by 3 weeks.',
    source: 'Operations Intelligence',
    confidence: 68,
    category: 'Operations',
    impact: 'medium',
    timeline: '3-6 weeks',
    timestamp: new Date(),
    suggestedPlaybook: 'Supply Chain Resilience'
  },
  {
    id: 'ws-4',
    title: 'Regulatory Shift Indicator',
    description: 'Congressional committee scheduled hearings on data privacy. Industry lobbyist activity increased 40% in past 30 days.',
    source: 'Regulatory Watch',
    confidence: 65,
    category: 'Regulatory',
    impact: 'high',
    timeline: '4-8 weeks',
    timestamp: new Date(),
    suggestedPlaybook: 'Regulatory Compliance'
  }
];

const demoOraclePatterns: EnhancedOraclePattern[] = [
  {
    id: 'op-1',
    name: 'Market Entry Window',
    description: 'Pattern analysis indicates optimal expansion window opening in European markets. Historical accuracy: 89%.',
    accuracy: 89,
    signals: 12,
    trend: 'Opportunity emerging',
    recommendation: 'Consider accelerating EU market entry by 6-8 weeks'
  },
  {
    id: 'op-2',
    name: 'Customer Churn Predictor',
    description: 'Behavioral patterns match pre-churn signals in enterprise segment. 3 accounts showing early warning signs.',
    accuracy: 92,
    signals: 8,
    trend: 'Risk increasing',
    recommendation: 'Initiate proactive retention outreach within 5 days'
  },
  {
    id: 'op-3',
    name: 'Innovation Cycle Timing',
    description: 'Industry innovation cycles suggest competitor product launches in Q2. Patent filing patterns confirm.',
    accuracy: 78,
    signals: 15,
    trend: 'Cycle accelerating',
    recommendation: 'Accelerate roadmap items to maintain leadership position'
  }
];

export default function ForesightRadar() {
  const { weakSignals: apiSignals, oraclePatterns: apiPatterns, isLoading } = useDynamicStrategy();
  const { isConnected } = useWebSocket();
  const [, setLocation] = useLocation();
  const [selectedSignal, setSelectedSignal] = useState<EnhancedWeakSignal | null>(null);
  const [selectedPattern, setSelectedPattern] = useState<EnhancedOraclePattern | null>(null);
  const [highlightedSignal, setHighlightedSignal] = useState<string | null>(null);

  const weakSignals: EnhancedWeakSignal[] = apiSignals.length > 0 
    ? apiSignals.map(s => ({
        ...s,
        description: s.title + ' - Detected by AI monitoring',
        impact: 'medium' as const,
        timeline: '1-2 weeks'
      }))
    : demoWeakSignals;

  const oraclePatterns: EnhancedOraclePattern[] = apiPatterns.length > 0
    ? apiPatterns.map(p => ({
        ...p,
        description: `Pattern: ${p.name}`,
        recommendation: 'Review pattern details for recommended actions'
      }))
    : demoOraclePatterns;

  const handleInvestigateSignal = (signal: EnhancedWeakSignal) => {
    setSelectedSignal(signal);
  };

  const handleViewPattern = (pattern: EnhancedOraclePattern) => {
    setSelectedPattern(pattern);
  };

  const handleActivatePlaybook = (signal: EnhancedWeakSignal) => {
    setSelectedSignal(null);
    setLocation('/playbook-library');
  };

  if (isLoading) {
    return (
      <PageLayout>
        <div className="page-background min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-blue-950 p-8">
          <div className="max-w-7xl mx-auto">
            <div className="animate-pulse space-y-4">
              <div className="h-12 bg-slate-200 dark:bg-slate-800 rounded"></div>
              <div className="h-64 bg-slate-200 dark:bg-slate-800 rounded"></div>
            </div>
          </div>
        </div>
      </PageLayout>
    );
  }

  return (
    <PageLayout>
      <div className="bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-blue-950 p-8">
      <div className="max-w-7xl mx-auto space-y-8">
        {/* Header with Value Proposition */}
        <div>
          <div className="flex items-center justify-between mb-2">
            <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-600 to-violet-600 bg-clip-text text-transparent flex items-center gap-3">
              <Radio className="w-10 h-10 text-blue-600 animate-pulse" />
              Foresight Radar
            </h1>
            <div className="flex items-center gap-3">
              <Link href="/intelligence-demo">
                <Button variant="outline" className="border-blue-500 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-950" data-testid="button-try-demo">
                  <Play className="w-4 h-4 mr-2" />
                  Try Interactive Demo
                </Button>
              </Link>
              <Badge className={`flex items-center gap-1 ${isConnected ? 'bg-green-500' : 'bg-amber-500'}`}>
                <div className={`w-2 h-2 rounded-full ${isConnected ? 'bg-white animate-pulse' : 'bg-white'}`}></div>
                {isConnected ? 'Live Stream Active' : 'Demo Mode'}
              </Badge>
            </div>
          </div>
          <p className="text-slate-600 dark:text-slate-400 max-w-3xl">
            AI-powered continuous monitoring detects early signals of threats and opportunities before they become obvious. See what's coming so you can act first, not react late.
          </p>
        </div>

        {/* Value Proposition Cards */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <Card className="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/50 dark:to-blue-900/30 border-blue-200 dark:border-blue-800">
            <CardContent className="p-4 flex items-start gap-3">
              <div className="bg-blue-500 rounded-lg p-2">
                <Eye className="w-5 h-5 text-white" />
              </div>
              <div>
                <h4 className="font-semibold text-slate-900 dark:text-white">16 Signal Categories</h4>
                <p className="text-sm text-slate-600 dark:text-slate-400">Monitoring competitive, market, regulatory, and operational signals</p>
              </div>
            </CardContent>
          </Card>
          <Card className="bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-950/50 dark:to-amber-900/30 border-amber-200 dark:border-amber-800">
            <CardContent className="p-4 flex items-start gap-3">
              <div className="bg-amber-500 rounded-lg p-2">
                <Target className="w-5 h-5 text-white" />
              </div>
              <div>
                <h4 className="font-semibold text-slate-900 dark:text-white">Early Warning</h4>
                <p className="text-sm text-slate-600 dark:text-slate-400">Detect weak signals 2-6 weeks before they become obvious threats</p>
              </div>
            </CardContent>
          </Card>
          <Card className="bg-gradient-to-br from-violet-50 to-violet-100 dark:from-violet-950/50 dark:to-violet-900/30 border-violet-200 dark:border-violet-800">
            <CardContent className="p-4 flex items-start gap-3">
              <div className="bg-violet-500 rounded-lg p-2">
                <Lightbulb className="w-5 h-5 text-white" />
              </div>
              <div>
                <h4 className="font-semibold text-slate-900 dark:text-white">AI Pattern Recognition</h4>
                <p className="text-sm text-slate-600 dark:text-slate-400">Oracle engine identifies opportunities others miss</p>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Main Tabs */}
        <Tabs defaultValue="radar" className="w-full">
          <TabsList className="grid grid-cols-3 w-full max-w-lg">
            <TabsTrigger value="radar" className="flex items-center gap-2" data-testid="tab-radar-view">
              <Eye className="w-4 h-4" />
              Radar View
            </TabsTrigger>
            <TabsTrigger value="signals" className="flex items-center gap-2" data-testid="tab-signal-center">
              <Grid3X3 className="w-4 h-4" />
              Signal Center
            </TabsTrigger>
            <TabsTrigger value="configure" className="flex items-center gap-2" data-testid="tab-configure">
              <Settings className="w-4 h-4" />
              Configure
            </TabsTrigger>
          </TabsList>

          <TabsContent value="radar" className="mt-6">
            {/* Radar Visual Section */}
            <div className="space-y-8">
              {/* Radar Visual Representation */}
              <Card className="bg-gradient-to-br from-blue-50 to-violet-50 dark:from-blue-950/30 dark:to-violet-950/30 border-2 border-blue-200 dark:border-blue-800">
                <CardContent className="p-12">
                  <div className="relative w-full aspect-square max-w-2xl mx-auto">
                    {/* Radar Circles */}
                    <div className="absolute inset-0 flex items-center justify-center">
                      <div className="w-full h-full border-4 border-blue-300 dark:border-blue-700 rounded-full opacity-30"></div>
                    </div>
                    <div className="absolute inset-[15%] flex items-center justify-center">
                      <div className="w-full h-full border-4 border-blue-300 dark:border-blue-700 rounded-full opacity-50"></div>
                    </div>
                    <div className="absolute inset-[30%] flex items-center justify-center">
                      <div className="w-full h-full border-4 border-blue-300 dark:border-blue-700 rounded-full opacity-70"></div>
                    </div>
                    
                    {/* Center Icon */}
                    <div className="absolute inset-0 flex items-center justify-center">
                      <div className="bg-blue-600 dark:bg-blue-500 rounded-full p-6 shadow-xl">
                        <Eye className="w-12 h-12 text-white" />
                      </div>
                    </div>

                    {/* Weak Signals on Radar */}
                    {weakSignals.slice(0, 8).map((signal, index) => {
                      const angle = (index * 360) / Math.min(weakSignals.length, 8);
                      const distance = 35 + (signal.confidence / 100) * 25;
                      const x = 50 + distance * Math.cos((angle * Math.PI) / 180);
                      const y = 50 + distance * Math.sin((angle * Math.PI) / 180);
                      const isNew = highlightedSignal === signal.id;
                      const impactColor = signal.impact === 'critical' ? 'bg-red-500' : signal.impact === 'high' ? 'bg-amber-500' : 'bg-yellow-400';
                      
                      return (
                        <div
                          key={signal.id}
                          className={`absolute transform -translate-x-1/2 -translate-y-1/2 cursor-pointer group transition-all ${isNew ? 'scale-125' : ''}`}
                          style={{ left: `${x}%`, top: `${y}%` }}
                          onClick={() => handleInvestigateSignal(signal)}
                          data-testid={`radar-blip-${signal.id}`}
                        >
                          <div className={`w-4 h-4 rounded-full absolute ${impactColor} animate-ping`}></div>
                          <div className={`w-4 h-4 rounded-full relative ${impactColor}`}></div>
                          
                          {/* Tooltip */}
                          <div className="absolute hidden group-hover:block z-50 bg-white dark:bg-slate-800 p-3 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 min-w-64 top-6 left-0">
                            <div className="font-semibold text-sm mb-1">{signal.title}</div>
                            <div className="text-xs text-slate-600 dark:text-slate-400 mb-2">{signal.description}</div>
                            <div className="flex items-center gap-2 text-xs">
                              <Badge variant="outline">{signal.confidence}% confidence</Badge>
                              <Badge variant={signal.impact === 'critical' ? 'destructive' : 'secondary'}>
                                {signal.impact}
                              </Badge>
                            </div>
                            <p className="text-xs text-blue-600 dark:text-blue-400 mt-2">Click to investigate </p>
                          </div>
                        </div>
                      );
                    })}

                    {/* Rotating Scan Line */}
                    <div className="absolute inset-0 flex items-center justify-center overflow-hidden rounded-full">
                      <div 
                        className="absolute w-1/2 h-0.5 bg-gradient-to-r from-transparent via-blue-500 to-blue-500 origin-left animate-[spin_4s_linear_infinite]"
                        style={{ left: '50%' }}
                      ></div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Signal Cards Grid */}
              <div className="grid grid-cols-2 gap-6">
                {/* Weak Signals */}
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <AlertTriangle className="w-5 h-5 text-amber-600" />
                      Weak Signals Detected
                      <Badge variant="outline" className="ml-2">{weakSignals.length}</Badge>
                    </CardTitle>
                    <CardDescription>
                      Early indicators requiring executive attention
                    </CardDescription>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-3 max-h-[600px] overflow-y-auto">
                      {weakSignals.map((signal) => (
                        <div
                          key={signal.id}
                          className={`p-4 bg-amber-50 dark:bg-amber-950/30 rounded-lg border border-amber-200 dark:border-amber-900 hover:shadow-md transition-all cursor-pointer ${
                            highlightedSignal === signal.id ? 'ring-2 ring-blue-500 animate-pulse' : ''
                          }`}
                          onClick={() => handleInvestigateSignal(signal)}
                          data-testid={`weak-signal-card-${signal.id}`}
                        >
                          <div className="flex items-start justify-between mb-2">
                            <h4 className="font-semibold text-slate-900 dark:text-white">
                              {signal.title}
                            </h4>
                            <Badge variant={signal.impact === 'critical' ? 'destructive' : 'secondary'} className="text-xs">
                              {signal.impact}
                            </Badge>
                          </div>
                          <p className="text-sm text-slate-600 dark:text-slate-400 mb-3">
                            {signal.description}
                          </p>
                          <div className="flex items-center gap-4 text-xs text-slate-500 dark:text-slate-500">
                            <span className="flex items-center gap-1">
                              <TrendingUp className="w-3 h-3" />
                              {signal.confidence}% confidence
                            </span>
                            <span>Timeline: {signal.timeline}</span>
                          </div>
                          <Button 
                            size="sm" 
                            variant="outline" 
                            className="w-full mt-3"
                            onClick={(e) => {
                              e.stopPropagation();
                              handleInvestigateSignal(signal);
                            }}
                            data-testid={`button-investigate-${signal.id}`}
                          >
                            <Shield className="w-4 h-4 mr-2" />
                            Investigate Signal
                          </Button>
                        </div>
                      ))}
                    </div>
                  </CardContent>
                </Card>

                {/* Oracle Patterns */}
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Zap className="w-5 h-5 text-violet-600" />
                      Oracle Pattern Recognition
                      <Badge variant="outline" className="ml-2">{oraclePatterns.length}</Badge>
                    </CardTitle>
                    <CardDescription>
                      AI-identified strategic patterns and predictions
                    </CardDescription>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-3 max-h-[600px] overflow-y-auto">
                      {oraclePatterns.map((pattern) => (
                        <div
                          key={pattern.id}
                          className="p-4 bg-violet-50 dark:bg-violet-950/30 rounded-lg border border-violet-200 dark:border-violet-900 hover:shadow-md transition-shadow cursor-pointer"
                          onClick={() => handleViewPattern(pattern)}
                          data-testid={`oracle-pattern-card-${pattern.id}`}
                        >
                          <div className="flex items-start justify-between mb-2">
                            <h4 className="font-semibold text-slate-900 dark:text-white">
                              {pattern.name}
                            </h4>
                            <Badge variant="outline" className="text-xs bg-violet-100 dark:bg-violet-900">
                              {pattern.accuracy}% accurate
                            </Badge>
                          </div>
                          <p className="text-sm text-slate-600 dark:text-slate-400 mb-2">
                            {pattern.description}
                          </p>
                          <div className="flex items-center gap-4 text-sm text-slate-600 dark:text-slate-400">
                            <div className="flex items-center gap-1">
                              <TrendingUp className="w-4 h-4" />
                              <span>{pattern.trend}</span>
                            </div>
                            <div>
                              {pattern.signals} signals analyzed
                            </div>
                          </div>
                          <Button 
                            size="sm" 
                            variant="outline" 
                            className="w-full mt-3"
                            onClick={(e) => {
                              e.stopPropagation();
                              handleViewPattern(pattern);
                            }}
                            data-testid={`button-view-pattern-${pattern.id}`}
                          >
                            <Lightbulb className="w-4 h-4 mr-2" />
                            View Pattern Details
                          </Button>
                        </div>
                      ))}
                    </div>
                  </CardContent>
                </Card>
              </div>

              {/* Monitoring Status */}
              <Card className="border-2 border-green-500 dark:border-green-700">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-4">
                      <div className="bg-green-500 rounded-full p-3">
                        <Radio className="w-6 h-6 text-white animate-pulse" />
                      </div>
                      <div>
                        <h3 className="text-lg font-bold text-slate-900 dark:text-white">
                          Continuous Monitoring Active
                        </h3>
                        <p className="text-sm text-slate-600 dark:text-slate-400">
                          Scanning 16 intelligence signal categories in real-time
                        </p>
                      </div>
                    </div>
                    <div className="flex items-center gap-8">
                      <div className="text-center">
                        <div className="text-3xl font-bold text-amber-600 dark:text-amber-400">
                          {weakSignals.length}
                        </div>
                        <div className="text-xs text-slate-600 dark:text-slate-400 uppercase">
                          Weak Signals
                        </div>
                      </div>
                      <div className="text-center">
                        <div className="text-3xl font-bold text-violet-600 dark:text-violet-400">
                          {oraclePatterns.length}
                        </div>
                        <div className="text-xs text-slate-600 dark:text-slate-400 uppercase">
                          Patterns
                        </div>
                      </div>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          <TabsContent value="signals" className="mt-6">
            <SignalControlCenter />
          </TabsContent>

          <TabsContent value="configure" className="mt-6">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Settings className="w-5 h-5" />
                  Signal Configuration
                </CardTitle>
                <CardDescription>
                  Configure monitoring thresholds, data sources, and alert settings
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-3 gap-6">
                  <Link href="/triggers">
                    <Card className="cursor-pointer hover:border-blue-500 hover:shadow-md transition-all" data-testid="config-thresholds">
                      <CardContent className="p-6 text-center">
                        <Database className="w-8 h-8 mx-auto mb-3 text-blue-600" />
                        <h4 className="font-semibold mb-1">Monitoring Thresholds</h4>
                        <p className="text-sm text-muted-foreground mb-3">
                          Set custom alert thresholds for each signal category
                        </p>
                        <Button variant="ghost" size="sm" className="text-blue-600">
                          Configure <ArrowRight className="w-4 h-4 ml-1" />
                        </Button>
                      </CardContent>
                    </Card>
                  </Link>
                  <Link href="/integrations">
                    <Card className="cursor-pointer hover:border-purple-500 hover:shadow-md transition-all" data-testid="config-sources">
                      <CardContent className="p-6 text-center">
                        <Grid3X3 className="w-8 h-8 mx-auto mb-3 text-purple-600" />
                        <h4 className="font-semibold mb-1">Data Sources</h4>
                        <p className="text-sm text-muted-foreground mb-3">
                          Connect and manage enterprise data sources
                        </p>
                        <Button variant="ghost" size="sm" className="text-purple-600">
                          Configure <ArrowRight className="w-4 h-4 ml-1" />
                        </Button>
                      </CardContent>
                    </Card>
                  </Link>
                  <Link href="/triggers">
                    <Card className="cursor-pointer hover:border-amber-500 hover:shadow-md transition-all" data-testid="config-notifications">
                      <CardContent className="p-6 text-center">
                        <AlertTriangle className="w-8 h-8 mx-auto mb-3 text-amber-600" />
                        <h4 className="font-semibold mb-1">Alert Settings</h4>
                        <p className="text-sm text-muted-foreground mb-3">
                          Configure notification preferences and escalation
                        </p>
                        <Button variant="ghost" size="sm" className="text-amber-600">
                          Configure <ArrowRight className="w-4 h-4 ml-1" />
                        </Button>
                      </CardContent>
                    </Card>
                  </Link>
                </div>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
      </div>

      {/* Signal Investigation Modal */}
      <Dialog open={!!selectedSignal} onOpenChange={() => setSelectedSignal(null)}>
        <DialogContent className="max-w-lg" data-testid="dialog-investigate-signal">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2" data-testid="dialog-title-investigate">
              <AlertTriangle className="w-5 h-5 text-amber-600" />
              Signal Investigation
            </DialogTitle>
            <DialogDescription>
              Review signal details and recommended actions
            </DialogDescription>
          </DialogHeader>
          {selectedSignal && (
            <div className="space-y-4">
              <div>
                <h3 className="font-semibold text-lg">{selectedSignal.title}</h3>
                <p className="text-sm text-muted-foreground mt-1">{selectedSignal.description}</p>
              </div>
              
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg">
                  <div className="text-xs text-muted-foreground uppercase">Confidence</div>
                  <div className="text-xl font-bold text-blue-600">{selectedSignal.confidence}%</div>
                </div>
                <div className="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg">
                  <div className="text-xs text-muted-foreground uppercase">Timeline</div>
                  <div className="text-xl font-bold text-amber-600">{selectedSignal.timeline}</div>
                </div>
              </div>

              <div className="bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
                <div className="flex items-center gap-2 mb-2">
                  <Lightbulb className="w-4 h-4 text-blue-600" />
                  <span className="font-semibold text-sm">Recommended Action</span>
                </div>
                <p className="text-sm text-slate-600 dark:text-slate-400">
                  {selectedSignal.suggestedPlaybook 
                    ? `Activate the "${selectedSignal.suggestedPlaybook}" playbook to address this signal before it escalates.`
                    : 'Review related playbooks to determine the best response strategy.'}
                </p>
              </div>
            </div>
          )}
          <DialogFooter className="flex gap-2">
            <Button variant="outline" onClick={() => setSelectedSignal(null)}>
              Dismiss
            </Button>
            <Button onClick={() => selectedSignal && handleActivatePlaybook(selectedSignal)}>
              <CheckCircle2 className="w-4 h-4 mr-2" />
              Find Matching Playbook
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Pattern Details Modal */}
      <Dialog open={!!selectedPattern} onOpenChange={() => setSelectedPattern(null)}>
        <DialogContent className="max-w-lg" data-testid="dialog-pattern-analysis">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2" data-testid="dialog-title-pattern">
              <Zap className="w-5 h-5 text-violet-600" />
              Pattern Analysis
            </DialogTitle>
            <DialogDescription>
              AI-identified strategic pattern details
            </DialogDescription>
          </DialogHeader>
          {selectedPattern && (
            <div className="space-y-4">
              <div>
                <h3 className="font-semibold text-lg">{selectedPattern.name}</h3>
                <p className="text-sm text-muted-foreground mt-1">{selectedPattern.description}</p>
              </div>
              
              <div className="grid grid-cols-3 gap-3">
                <div className="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg text-center">
                  <div className="text-xs text-muted-foreground uppercase">Accuracy</div>
                  <div className="text-xl font-bold text-violet-600">{selectedPattern.accuracy}%</div>
                </div>
                <div className="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg text-center">
                  <div className="text-xs text-muted-foreground uppercase">Signals</div>
                  <div className="text-xl font-bold text-blue-600">{selectedPattern.signals}</div>
                </div>
                <div className="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg text-center">
                  <div className="text-xs text-muted-foreground uppercase">Trend</div>
                  <div className="text-sm font-semibold text-green-600">{selectedPattern.trend}</div>
                </div>
              </div>

              <div className="bg-violet-50 dark:bg-violet-950/30 p-4 rounded-lg border border-violet-200 dark:border-violet-800">
                <div className="flex items-center gap-2 mb-2">
                  <Lightbulb className="w-4 h-4 text-violet-600" />
                  <span className="font-semibold text-sm">Oracle Recommendation</span>
                </div>
                <p className="text-sm text-slate-600 dark:text-slate-400">
                  {selectedPattern.recommendation}
                </p>
              </div>
            </div>
          )}
          <DialogFooter className="flex gap-2">
            <Button variant="outline" onClick={() => setSelectedPattern(null)}>
              Close
            </Button>
            <Button onClick={() => {
              setSelectedPattern(null);
              setLocation('/playbook-library');
            }}>
              <Target className="w-4 h-4 mr-2" />
              Explore Related Playbooks
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/FutureGym.tsx
========================================
import { useLocation } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import { useDynamicStrategy } from '@/contexts/DynamicStrategyContext';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Dumbbell, Target, Trophy, TrendingUp, Play, Lock } from 'lucide-react';
import { useToast } from '@/hooks/use-toast';

const trainingScenarios = [
  {
    id: 1,
    name: 'Crisis Decision Speed',
    description: 'Practice making critical decisions under time pressure',
    difficulty: 'Advanced',
    duration: '45 min',
    completed: false,
    score: null,
  },
  {
    id: 2,
    name: 'Weak Signal Detection',
    description: 'Train your team to identify early warning signs',
    difficulty: 'Intermediate',
    duration: '30 min',
    completed: true,
    score: 87,
  },
  {
    id: 3,
    name: 'Multi-Team Coordination',
    description: 'Simulate complex cross-functional responses',
    difficulty: 'Advanced',
    duration: '60 min',
    completed: false,
    score: null,
  },
  {
    id: 4,
    name: 'Playbook Customization',
    description: 'Adapt standard playbooks to your context',
    difficulty: 'Beginner',
    duration: '20 min',
    completed: true,
    score: 92,
  },
];

const teamStats = {
  totalExercises: 127,
  avgScore: 84,
  hoursTraining: 342,
  certifications: 28,
};

export default function FutureGym() {
  const [, setLocation] = useLocation();
  const { toast } = useToast();
  const { readiness } = useDynamicStrategy();

  const handleCreateExercise = () => {
    setLocation('/practice-drills');
    toast({
      title: 'Create Custom Exercise',
      description: 'Use Practice Drills to design and customize your training scenarios.',
    });
  };

  const handleStartExercise = (scenario: typeof trainingScenarios[0]) => {
    setLocation('/executive-simulation');
    toast({
      title: `Starting: ${scenario.name}`,
      description: `${scenario.difficulty} level exercise - ${scenario.duration}`,
    });
  };

  return (
    <PageLayout>
      <div className="bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-blue-950 p-8">
      <div className="max-w-7xl mx-auto space-y-8">
        {/* Header */}
        <div className="flex items-start justify-between">
          <div>
            <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-600 to-violet-600 bg-clip-text text-transparent mb-2 flex items-center gap-3">
              <Dumbbell className="w-10 h-10 text-blue-600" />
              Future Gym
            </h1>
            <p className="text-slate-600 dark:text-slate-400">
              Build strategic muscle through simulated scenarios and practice drills
            </p>
          </div>
          <Button size="lg" onClick={handleCreateExercise} data-testid="button-create-exercise">
            <Target className="w-4 h-4 mr-2" />
            Create Custom Exercise
          </Button>
        </div>

        {/* Team Performance Stats */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <Card>
            <CardHeader>
              <CardDescription>Total Exercises</CardDescription>
              <CardTitle className="text-3xl text-blue-600">{teamStats.totalExercises}</CardTitle>
            </CardHeader>
          </Card>
          <Card>
            <CardHeader>
              <CardDescription>Average Score</CardDescription>
              <CardTitle className="text-3xl text-violet-600">{teamStats.avgScore}%</CardTitle>
            </CardHeader>
          </Card>
          <Card>
            <CardHeader>
              <CardDescription>Training Hours</CardDescription>
              <CardTitle className="text-3xl text-emerald-600">{teamStats.hoursTraining}</CardTitle>
            </CardHeader>
          </Card>
          <Card>
            <CardHeader>
              <CardDescription>Certifications</CardDescription>
              <CardTitle className="text-3xl text-orange-600">{teamStats.certifications}</CardTitle>
            </CardHeader>
          </Card>
        </div>

        {/* Readiness Improvement Tracker */}
        <Card>
          <CardHeader>
            <CardTitle>Readiness Improvement Tracker</CardTitle>
            <CardDescription>Your training impact on Future Readiness Index</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
              {Object.entries(readiness).filter(([key]) => key !== 'overall').map(([key, value]) => (
                <div key={key} className="text-center">
                  <div className="text-2xl font-bold text-blue-600 mb-1">{value}%</div>
                  <div className="text-xs uppercase tracking-wide text-slate-600 dark:text-slate-400 mb-2">
                    {key}
                  </div>
                  <Progress value={value} className="h-2" />
                </div>
              ))}
            </div>
          </CardContent>
        </Card>

        {/* Training Scenarios */}
        <div>
          <h2 className="text-2xl font-bold text-slate-900 dark:text-white mb-4">Training Scenarios</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {trainingScenarios.map((scenario) => (
              <Card key={scenario.id} data-testid={`card-training-${scenario.id}`}>
                <CardHeader>
                  <div className="flex items-start justify-between">
                    <div>
                      <CardTitle className="text-lg">{scenario.name}</CardTitle>
                      <CardDescription className="mt-1">{scenario.description}</CardDescription>
                    </div>
                    {scenario.completed && (
                      <Trophy className="w-5 h-5 text-yellow-500" />
                    )}
                  </div>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center gap-2">
                      <Badge variant={
                        scenario.difficulty === 'Advanced' ? 'destructive' :
                        scenario.difficulty === 'Intermediate' ? 'default' :
                        'secondary'
                      }>
                        {scenario.difficulty}
                      </Badge>
                      <span className="text-sm text-slate-600 dark:text-slate-400">
                        {scenario.duration}
                      </span>
                    </div>
                    {scenario.completed && scenario.score && (
                      <div className="p-3 bg-green-50 dark:bg-green-950/30 rounded border border-green-200 dark:border-green-900">
                        <div className="flex items-center justify-between">
                          <span className="text-sm font-medium text-green-900 dark:text-green-100">
                            Completed
                          </span>
                          <span className="text-lg font-bold text-green-600 dark:text-green-400">
                            {scenario.score}%
                          </span>
                        </div>
                      </div>
                    )}
                    <Button 
                      className="w-full" 
                      variant={scenario.completed ? "outline" : "default"}
                      onClick={() => handleStartExercise(scenario)}
                      data-testid={`button-start-${scenario.id}`}
                    >
                      {scenario.completed ? (
                        <>Retake Exercise</>
                      ) : (
                        <>
                          <Play className="w-4 h-4 mr-2" />
                          Start Exercise
                        </>
                      )}
                    </Button>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </div>
      </div>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/FutureReadinessDashboard.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Progress } from "@/components/ui/progress";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Separator } from "@/components/ui/separator";
import { 
  TrendingUp, 
  TrendingDown, 
  Activity, 
  AlertTriangle, 
  Lightbulb, 
  Brain, 
  Target,
  Sparkles,
  Zap,
  Eye,
  Clock,
  BarChart3,
  ArrowUpRight,
  RefreshCw
} from "lucide-react";
import { format } from "date-fns";
import { queryClient } from "@/lib/queryClient";

interface ReadinessMetric {
  id: string;
  organizationId: string;
  overallScore: string;
  playbookMaturity: string;
  executionVelocity: string;
  learningRate: string;
  signalDetection: string;
  insights: Record<string, any>;
  calculatedAt: string;
}

interface WeakSignal {
  id: string;
  organizationId: string;
  source: string;
  signalType: string;
  title: string;
  description: string;
  confidence: string;
  urgency: string;
  status: string;
  detectedAt: string;
  metadata: Record<string, any>;
}

interface OraclePattern {
  id: string;
  organizationId: string;
  patternType: string;
  title: string;
  description: string;
  confidence: string;
  impact: string;
  detectedAt: string;
  metadata: Record<string, any>;
}

interface ActivityFeedEvent {
  id: string;
  organizationId: string;
  eventType: string;
  title: string;
  description: string;
  timestamp: string;
  metadata: Record<string, any>;
}

export default function FutureReadinessDashboard() {
  const { data: readiness, isLoading: readinessLoading } = useQuery<ReadinessMetric>({
    queryKey: ['/api/dynamic-strategy/readiness'],
  });

  const { data: weakSignalsData, isLoading: signalsLoading } = useQuery<WeakSignal[]>({
    queryKey: ['/api/dynamic-strategy/weak-signals'],
  });

  const { data: oraclePatternsData, isLoading: patternsLoading } = useQuery<OraclePattern[]>({
    queryKey: ['/api/dynamic-strategy/oracle-patterns'],
  });

  const { data: activityFeedData, isLoading: activityLoading } = useQuery<ActivityFeedEvent[]>({
    queryKey: ['/api/dynamic-strategy/activity-feed'],
  });

  const weakSignals = weakSignalsData ?? [];
  const oraclePatterns = oraclePatternsData ?? [];
  const activityFeed = activityFeedData ?? [];

  const handleRecalculate = async () => {
    try {
      await fetch('/api/dynamic-strategy/readiness/calculate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });
      
      queryClient.invalidateQueries({ queryKey: ['/api/dynamic-strategy/readiness'] });
    } catch (error) {
      console.error('Failed to recalculate readiness:', error);
    }
  };

  const getScoreColor = (score: number) => {
    if (score >= 80) return 'text-green-600 dark:text-green-400';
    if (score >= 60) return 'text-yellow-600 dark:text-yellow-400';
    return 'text-red-600 dark:text-red-400';
  };

  const getUrgencyBadgeVariant = (urgency: string): "default" | "secondary" | "destructive" | "outline" => {
    switch (urgency) {
      case 'critical': return 'destructive';
      case 'high': return 'default';
      case 'medium': return 'secondary';
      default: return 'outline';
    }
  };

  const getImpactIcon = (impact: string) => {
    switch (impact) {
      case 'high': return <ArrowUpRight className="h-4 w-4 text-red-500" />;
      case 'medium': return <TrendingUp className="h-4 w-4 text-yellow-500" />;
      default: return <Activity className="h-4 w-4 text-blue-500" />;
    }
  };

  const overallScore = parseFloat(readiness?.overallScore || '0');
  const playbookMaturity = parseFloat(readiness?.playbookMaturity || '0');
  const executionVelocity = parseFloat(readiness?.executionVelocity || '0');
  const learningRate = parseFloat(readiness?.learningRate || '0');
  const signalDetection = parseFloat(readiness?.signalDetection || '0');

  return (
    <div className="page-background min-h-screen p-6">
      <div className="max-w-7xl mx-auto space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-title flex items-center gap-3">
              <Brain className="h-10 w-10 text-slate-900 dark:text-slate-100" />
              Future Readiness Index
            </h1>
            <p className="text-slate-600 dark:text-slate-400 mt-2">
              Real-time strategic preparedness and self-learning intelligence
            </p>
          </div>
          <Button 
            onClick={handleRecalculate}
            variant="outline"
            className="gap-2"
            data-testid="button-recalculate-readiness"
          >
            <RefreshCw className="h-4 w-4" />
            Recalculate
          </Button>
        </div>

        {/* Main Readiness Score */}
        <Card className="border-2 border-blue-200 dark:border-blue-800 bg-gradient-to-br from-blue-50 to-white dark:from-blue-950/20 dark:to-slate-900">
          <CardHeader>
            <div className="flex items-center justify-between">
              <div>
                <CardTitle className="text-2xl flex items-center gap-2">
                  <Target className="h-6 w-6 text-blue-600" />
                  Overall Readiness Score
                </CardTitle>
                <CardDescription>
                  {readiness?.calculatedAt 
                    ? `Last updated ${format(new Date(readiness.calculatedAt), 'PPp')}`
                    : 'Calculating...'}
                </CardDescription>
              </div>
              <div className={`text-6xl font-bold ${getScoreColor(overallScore)}`} data-testid="text-overall-score">
                {overallScore.toFixed(1)}%
              </div>
            </div>
          </CardHeader>
          <CardContent>
            <Progress value={overallScore} className="h-4" />
            
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
              <div className="space-y-2">
                <div className="flex items-center justify-between">
                  <span className="text-sm text-slate-600 dark:text-slate-400">Playbook Maturity</span>
                  <Sparkles className="h-4 w-4 text-purple-500" />
                </div>
                <div className={`text-2xl font-bold ${getScoreColor(playbookMaturity)}`}>
                  {playbookMaturity.toFixed(1)}%
                </div>
                <Progress value={playbookMaturity} className="h-2" />
              </div>

              <div className="space-y-2">
                <div className="flex items-center justify-between">
                  <span className="text-sm text-slate-600 dark:text-slate-400">Execution Velocity</span>
                  <Zap className="h-4 w-4 text-yellow-500" />
                </div>
                <div className={`text-2xl font-bold ${getScoreColor(executionVelocity)}`}>
                  {executionVelocity.toFixed(1)}%
                </div>
                <Progress value={executionVelocity} className="h-2" />
              </div>

              <div className="space-y-2">
                <div className="flex items-center justify-between">
                  <span className="text-sm text-slate-600 dark:text-slate-400">Learning Rate</span>
                  <Brain className="h-4 w-4 text-blue-500" />
                </div>
                <div className={`text-2xl font-bold ${getScoreColor(learningRate)}`}>
                  {learningRate.toFixed(1)}%
                </div>
                <Progress value={learningRate} className="h-2" />
              </div>

              <div className="space-y-2">
                <div className="flex items-center justify-between">
                  <span className="text-sm text-slate-600 dark:text-slate-400">Signal Detection</span>
                  <Eye className="h-4 w-4 text-green-500" />
                </div>
                <div className={`text-2xl font-bold ${getScoreColor(signalDetection)}`}>
                  {signalDetection.toFixed(1)}%
                </div>
                <Progress value={signalDetection} className="h-2" />
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Tabs for different intelligence feeds */}
        <Tabs defaultValue="weak-signals" className="space-y-4">
          <TabsList className="grid w-full grid-cols-3">
            <TabsTrigger value="weak-signals" className="gap-2" data-testid="tab-weak-signals">
              <AlertTriangle className="h-4 w-4" />
              Weak Signals ({weakSignals.length})
            </TabsTrigger>
            <TabsTrigger value="oracle-patterns" className="gap-2" data-testid="tab-oracle-patterns">
              <Lightbulb className="h-4 w-4" />
              Oracle Patterns ({oraclePatterns.length})
            </TabsTrigger>
            <TabsTrigger value="activity-feed" className="gap-2" data-testid="tab-activity-feed">
              <Activity className="h-4 w-4" />
              Activity Feed ({activityFeed.length})
            </TabsTrigger>
          </TabsList>

          {/* Weak Signals Tab */}
          <TabsContent value="weak-signals" className="space-y-4">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <AlertTriangle className="h-5 w-5 text-orange-500" />
                  Weak Signal Detection
                </CardTitle>
                <CardDescription>
                  Early indicators of emerging threats and opportunities
                </CardDescription>
              </CardHeader>
              <CardContent>
                <ScrollArea className="h-[500px]">
                  <div className="space-y-4">
                    {signalsLoading ? (
                      <p className="text-center text-slate-500">Loading signals...</p>
                    ) : weakSignals.length === 0 ? (
                      <p className="text-center text-slate-500">No weak signals detected</p>
                    ) : (
                      weakSignals.map((signal) => (
                        <Card key={signal.id} className="border-l-4 border-l-orange-500">
                          <CardContent className="pt-6">
                            <div className="flex items-start justify-between">
                              <div className="flex-1">
                                <div className="flex items-center gap-2 mb-2">
                                  <h3 className="font-semibold text-lg">{signal.title}</h3>
                                  <Badge variant={getUrgencyBadgeVariant(signal.urgency)}>
                                    {signal.urgency}
                                  </Badge>
                                  <Badge variant="outline">{signal.signalType}</Badge>
                                </div>
                                <p className="text-sm text-slate-600 dark:text-slate-400 mb-3">
                                  {signal.description}
                                </p>
                                <div className="flex items-center gap-4 text-xs text-slate-500">
                                  <span className="flex items-center gap-1">
                                    <BarChart3 className="h-3 w-3" />
                                    Confidence: {parseFloat(signal.confidence).toFixed(0)}%
                                  </span>
                                  <span className="flex items-center gap-1">
                                    <Clock className="h-3 w-3" />
                                    {format(new Date(signal.detectedAt), 'PPp')}
                                  </span>
                                  <span className="flex items-center gap-1">
                                    Source: {signal.source}
                                  </span>
                                </div>
                              </div>
                            </div>
                          </CardContent>
                        </Card>
                      ))
                    )}
                  </div>
                </ScrollArea>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Oracle Patterns Tab */}
          <TabsContent value="oracle-patterns" className="space-y-4">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Lightbulb className="h-5 w-5 text-purple-500" />
                  Oracle Intelligence Patterns
                </CardTitle>
                <CardDescription>
                  AI-detected strategic patterns and predictive insights
                </CardDescription>
              </CardHeader>
              <CardContent>
                <ScrollArea className="h-[500px]">
                  <div className="space-y-4">
                    {patternsLoading ? (
                      <p className="text-center text-slate-500">Loading patterns...</p>
                    ) : oraclePatterns.length === 0 ? (
                      <p className="text-center text-slate-500">No oracle patterns detected</p>
                    ) : (
                      oraclePatterns.map((pattern) => (
                        <Card key={pattern.id} className="border-l-4 border-l-purple-500">
                          <CardContent className="pt-6">
                            <div className="flex items-start justify-between">
                              <div className="flex-1">
                                <div className="flex items-center gap-2 mb-2">
                                  <h3 className="font-semibold text-lg">{pattern.title}</h3>
                                  <Badge variant="secondary">{pattern.patternType}</Badge>
                                  {getImpactIcon(pattern.impact)}
                                </div>
                                <p className="text-sm text-slate-600 dark:text-slate-400 mb-3">
                                  {pattern.description}
                                </p>
                                <div className="flex items-center gap-4 text-xs text-slate-500">
                                  <span className="flex items-center gap-1">
                                    <BarChart3 className="h-3 w-3" />
                                    Confidence: {parseFloat(pattern.confidence).toFixed(0)}%
                                  </span>
                                  <span className="flex items-center gap-1">
                                    <Clock className="h-3 w-3" />
                                    {format(new Date(pattern.detectedAt), 'PPp')}
                                  </span>
                                  <span>Impact: {pattern.impact}</span>
                                </div>
                              </div>
                            </div>
                          </CardContent>
                        </Card>
                      ))
                    )}
                  </div>
                </ScrollArea>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Activity Feed Tab */}
          <TabsContent value="activity-feed" className="space-y-4">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Activity className="h-5 w-5 text-blue-500" />
                  Real-Time Activity Feed
                </CardTitle>
                <CardDescription>
                  Live stream of strategic execution events
                </CardDescription>
              </CardHeader>
              <CardContent>
                <ScrollArea className="h-[500px]">
                  <div className="space-y-3">
                    {activityLoading ? (
                      <p className="text-center text-slate-500">Loading activity...</p>
                    ) : activityFeed.length === 0 ? (
                      <p className="text-center text-slate-500">No recent activity</p>
                    ) : (
                      activityFeed.map((event, idx) => (
                        <div key={event.id}>
                          <div className="flex gap-3">
                            <div className="flex flex-col items-center">
                              <div className="h-2 w-2 rounded-full bg-blue-500 mt-2" />
                              {idx < activityFeed.length - 1 && (
                                <div className="w-px h-full bg-slate-200 dark:bg-slate-700 mt-1" />
                              )}
                            </div>
                            <div className="flex-1 pb-4">
                              <div className="flex items-center justify-between mb-1">
                                <h4 className="font-medium">{event.title}</h4>
                                <span className="text-xs text-slate-500">
                                  {format(new Date(event.timestamp), 'PPp')}
                                </span>
                              </div>
                              <p className="text-sm text-slate-600 dark:text-slate-400">
                                {event.description}
                              </p>
                              <Badge variant="outline" className="mt-2 text-xs">
                                {event.eventType}
                              </Badge>
                            </div>
                          </div>
                        </div>
                      ))
                    )}
                  </div>
                </ScrollArea>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/Homepage.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { 
  ArrowRight, 
  Play,
  Clock,
  Target,
  Zap,
  BookOpen,
  Radar,
  Radio,
  BarChart3,
  Shield,
  Users,
  CheckCircle,
  Sparkles,
  Briefcase,
  Layers,
  AlertTriangle,
  TrendingUp,
  Lightbulb,
  Bot,
  Brain,
  Network,
  Activity,
  Check,
  X
} from "lucide-react";
import { useLocation } from "wouter";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";

export default function Homepage() {
  const [, setLocation] = useLocation();

  const phases = [
    {
      id: 'identify',
      phase: 'I',
      phaseName: 'Identify',
      title: 'Build Your Depth Chart',
      description: 'Map your operating model to 166 pre-staged playbooks across 9 strategic domains. Know every scenario before it happens.',
      aiPositioning: 'AI that pre-stages responsesthe training data for every strategic scenario.',
      icon: BookOpen,
      color: 'from-violet-500 to-purple-600',
      borderColor: 'border-violet-200 hover:border-violet-400',
      bgColor: 'bg-violet-50 dark:bg-violet-950/20',
      iconBg: 'bg-violet-100 dark:bg-violet-900/30',
      iconColor: 'text-violet-600 dark:text-violet-400',
      features: ['Operating Model Alignment', '166 Pre-built Playbooks', 'Stakeholder Accountability Mapping', 'Readiness Scoring'],
      primaryLink: '/playbook-library',
      primaryLabel: 'Browse Playbooks',
      mindsetQuote: 'Know every scenario before it happens.'
    },
    {
      id: 'detect',
      phase: 'D',
      phaseName: 'Detect',
      title: 'Monitor Signals',
      description: 'AI matches signals to playbooks and triggers execution. Not just analysisaction triggers that connect intelligence to execution.',
      aiPositioning: "AI that identifies which playbook to executenot just what's happening.",
      icon: Radar,
      color: 'from-blue-500 to-cyan-600',
      borderColor: 'border-blue-200 hover:border-blue-400',
      bgColor: 'bg-blue-50 dark:bg-blue-950/20',
      iconBg: 'bg-blue-100 dark:bg-blue-900/30',
      iconColor: 'text-blue-600 dark:text-blue-400',
      features: ['AI Signal-to-Playbook Matching', 'Competitive Intelligence Aggregation', 'Early Warning Dashboards', 'Human-Triggered Activation'],
      primaryLink: '/foresight-radar',
      primaryLabel: 'View Radar',
      mindsetQuote: 'See it coming before it arrives.'
    },
    {
      id: 'execute',
      phase: 'E',
      phaseName: 'Execute',
      title: 'Execute Response',
      description: 'AI orchestrates cross-functional coordination. Decision in 12 minutes, full execution of 47 tasks in 90 minutes. Autonomous blocker resolution.',
      aiPositioning: 'AI that orchestrates coordinationnot just assists individual work.',
      icon: Radio,
      color: 'from-emerald-500 to-green-600',
      borderColor: 'border-emerald-200 hover:border-emerald-400',
      bgColor: 'bg-emerald-50 dark:bg-emerald-950/20',
      iconBg: 'bg-emerald-100 dark:bg-emerald-900/30',
      iconColor: 'text-emerald-600 dark:text-emerald-400',
      features: ['AI Cross-Functional Orchestration', 'Autonomous Blocker Resolution', 'Real-time Play Clock', 'Two-Minute Drill Mode'],
      primaryLink: '/command-center',
      primaryLabel: 'Launch Command Center',
      mindsetQuote: 'No thinking. Just execution.'
    },
    {
      id: 'advance',
      phase: 'A',
      phaseName: 'Advance',
      title: 'Review the Film',
      description: 'AI captures lessons and auto-refines playbooks. Insights propagate across related playbooks. Get smarter every execution.',
      aiPositioning: 'AI that gets smarter every time you execute.',
      icon: BarChart3,
      color: 'from-amber-500 to-orange-600',
      borderColor: 'border-amber-200 hover:border-amber-400',
      bgColor: 'bg-amber-50 dark:bg-amber-950/20',
      iconBg: 'bg-amber-100 dark:bg-amber-900/30',
      iconColor: 'text-amber-600 dark:text-amber-400',
      features: ['AI Playbook Refinement', 'Cross-Playbook Learning', 'Performance Benchmarking', 'Autonomous Improvement'],
      primaryLink: '/executive-dashboard',
      primaryLabel: 'View Dashboard',
      mindsetQuote: 'Get better every time.'
    }
  ];
  
  const executionTimeline = [
    { time: '0:00', event: 'CEO selects Option A: Immediate Public Disclosure', type: 'decision' },
    { time: '0:01', event: 'Triggering 47 tasks across 12 stakeholders', type: 'ai' },
    { time: '0:02', event: 'Auto-populating breach disclosure template with incident data', type: 'ai' },
    { time: '0:05', event: 'Legal reviewing draft - AI detected blocker: missing breach scope', type: 'blocker' },
    { time: '0:06', event: 'AI auto-requested missing data from Security team', type: 'ai' },
    { time: '0:09', event: 'Security provided scope - Legal unblocked', type: 'resolved' },
    { time: '0:12', event: 'Legal approved disclosure', type: 'approval' },
    { time: '0:15', event: 'Comms reviewing AI-drafted statement', type: 'progress' },
    { time: '0:18', event: 'CFO approved budget allocation', type: 'approval' },
    { time: '0:20', event: 'AI detected: Media inquiry - adjusting timeline', type: 'ai' },
    { time: '0:27', event: 'CEO final approval on statement', type: 'decision' },
    { time: '0:28', event: 'Statement published', type: 'complete' },
    { time: '0:30', event: 'Regulatory notification sent', type: 'complete' },
    { time: '0:45', event: '45,000 customer emails sent (AI-personalized)', type: 'ai' },
    { time: '1:30', event: 'All 47 tasks complete', type: 'complete' }
  ];

  const stats = [
    { value: '12 min', label: 'Avg Decision Time', icon: Clock },
    { value: '340X', label: 'Faster Than Industry', icon: Zap },
    { value: '166', label: 'Pre-Staged Playbooks', icon: BookOpen },
    { value: '94%', label: 'On-Time Rate', icon: Target }
  ];

  return (
    <div className="min-h-screen bg-white dark:bg-slate-950">
      <StandardNav />
      
      {/* Hero Section - Survival-Level Stakes */}
      <section className="relative py-24 md:py-32 px-6 overflow-hidden bg-white dark:bg-slate-950">
        <div className="max-w-5xl mx-auto text-center relative z-10">
          
          {/* Urgency Badge */}
          <div className="mb-8 inline-block">
            <Badge className="text-lg px-6 py-2 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 border-2 border-red-300 dark:border-red-700 animate-pulse" data-testid="badge-urgency">
              The pace of change is accelerating
            </Badge>
          </div>
          
          {/* Main Headline */}
          <h1 className="text-5xl md:text-7xl font-bold text-slate-900 dark:text-white mb-6 leading-tight" data-testid="heading-mindset">
            The World Won't Wait
            <br />
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-red-600 to-orange-600">
              for You to Coordinate.
            </span>
          </h1>
          
          {/* Subheadline - Three Pain Points */}
          <div className="space-y-4 text-xl text-slate-600 dark:text-slate-400 mb-8 max-w-3xl mx-auto" data-testid="text-pain-points">
            <p>Markets shift while you're aligning stakeholders.</p>
            <p>Crises spread while you're scheduling meetings.</p>
            <p>Opportunities close while you're coordinating via email.</p>
          </div>
          
          {/* The Fatal Gap */}
          <div className="p-6 bg-slate-100 dark:bg-slate-800 rounded-xl max-w-3xl mx-auto mb-12" data-testid="fatal-gap">
            <p className="text-2xl font-bold text-slate-900 dark:text-white mb-4">
              The pace of change is accelerating. Your coordination speed isn't.
            </p>
            <p className="text-lg text-red-600 dark:text-red-400 font-semibold">
              That gap is fatal.
            </p>
          </div>
          
          {/* Solution Statement */}
          <p className="text-xl text-slate-600 dark:text-slate-400 mb-12 max-w-3xl mx-auto" data-testid="text-hero-description">
            <span className="font-bold text-slate-900 dark:text-white">
              M Platform closes it
            </span>
            giving you pre-staged responses for every strategic scenario.
            <br /><br />
            When change hits (and it will), you adapt at the speed it happens.
            <br />
            <span className="font-semibold text-emerald-600 dark:text-emerald-400">
              Not because you predicted it. Because you prepared for it.
            </span>
          </p>
          
          {/* CTA Buttons */}
          <div className="flex flex-col sm:flex-row gap-4 justify-center mb-16">
            <Button 
              size="lg" 
              onClick={() => setLocation('/how-it-works')}
              className="text-lg px-8 py-6 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700"
              data-testid="button-adaptation-proof"
            >
              See How We Make You Adaptation-Proof
              <ArrowRight className="ml-2 h-5 w-5" />
            </Button>
            <Button 
              size="lg" 
              variant="outline" 
              onClick={() => setLocation('/pilot-programs')}
              className="text-lg px-8 py-6 border-slate-300 dark:border-slate-600"
              data-testid="button-pilot-programs"
            >
              View Pilot Programs
            </Button>
          </div>
          
          {/* The Three Scenarios with Speed Stats */}
          <div className="grid md:grid-cols-3 gap-6 max-w-6xl mx-auto mb-12" data-testid="speed-scenarios">
            
            {/* Crisis */}
            <Card className="border-2 border-red-200 dark:border-red-800 bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-950/20 dark:to-orange-950/20" data-testid="scenario-crisis">
              <CardContent className="p-6">
                <div className="flex items-center justify-between mb-4">
                  <Badge className="bg-red-600 text-white">CRISIS</Badge>
                  <Shield className="h-6 w-6 text-red-600" />
                </div>
                <h3 className="text-lg font-bold text-slate-900 dark:text-white mb-4">When Crisis Hits</h3>
                <div className="space-y-3">
                  <div className="p-3 bg-white dark:bg-slate-900 rounded">
                    <div className="text-sm text-slate-500 mb-1">World moves at:</div>
                    <div className="text-2xl font-bold text-slate-900 dark:text-white">Minutes</div>
                  </div>
                  <div className="p-3 bg-red-100 dark:bg-red-900/30 rounded">
                    <div className="text-sm text-red-700 dark:text-red-400 mb-1">You respond in:</div>
                    <div className="text-2xl font-bold text-red-600">17 Days</div>
                  </div>
                  <div className="p-3 bg-emerald-100 dark:bg-emerald-900/30 rounded">
                    <div className="text-sm text-emerald-700 dark:text-emerald-400 mb-1">With M Platform:</div>
                    <div className="text-2xl font-bold text-emerald-600">90 Minutes</div>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            {/* Opportunity */}
            <Card className="border-2 border-emerald-200 dark:border-emerald-800 bg-gradient-to-br from-emerald-50 to-green-50 dark:from-emerald-950/20 dark:to-green-950/20" data-testid="scenario-opportunity">
              <CardContent className="p-6">
                <div className="flex items-center justify-between mb-4">
                  <Badge className="bg-emerald-600 text-white">OPPORTUNITY</Badge>
                  <Target className="h-6 w-6 text-emerald-600" />
                </div>
                <h3 className="text-lg font-bold text-slate-900 dark:text-white mb-4">When Opportunity Appears</h3>
                <div className="space-y-3">
                  <div className="p-3 bg-white dark:bg-slate-900 rounded">
                    <div className="text-sm text-slate-500 mb-1">Window closes in:</div>
                    <div className="text-2xl font-bold text-slate-900 dark:text-white">Days</div>
                  </div>
                  <div className="p-3 bg-red-100 dark:bg-red-900/30 rounded">
                    <div className="text-sm text-red-700 dark:text-red-400 mb-1">You mobilize in:</div>
                    <div className="text-2xl font-bold text-red-600">6 Weeks</div>
                  </div>
                  <div className="p-3 bg-emerald-100 dark:bg-emerald-900/30 rounded">
                    <div className="text-sm text-emerald-700 dark:text-emerald-400 mb-1">With M Platform:</div>
                    <div className="text-2xl font-bold text-emerald-600">1 Week</div>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            {/* Innovation */}
            <Card className="border-2 border-purple-200 dark:border-purple-800 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-950/20 dark:to-pink-950/20" data-testid="scenario-innovation">
              <CardContent className="p-6">
                <div className="flex items-center justify-between mb-4">
                  <Badge className="bg-purple-600 text-white">INNOVATION</Badge>
                  <Sparkles className="h-6 w-6 text-purple-600" />
                </div>
                <h3 className="text-lg font-bold text-slate-900 dark:text-white mb-4">When Change Disrupts</h3>
                <div className="space-y-3">
                  <div className="p-3 bg-white dark:bg-slate-900 rounded">
                    <div className="text-sm text-slate-500 mb-1">Competitors deploy in:</div>
                    <div className="text-2xl font-bold text-slate-900 dark:text-white">Weeks</div>
                  </div>
                  <div className="p-3 bg-red-100 dark:bg-red-900/30 rounded">
                    <div className="text-sm text-red-700 dark:text-red-400 mb-1">You deploy in:</div>
                    <div className="text-2xl font-bold text-red-600">9 Months</div>
                  </div>
                  <div className="p-3 bg-emerald-100 dark:bg-emerald-900/30 rounded">
                    <div className="text-sm text-emerald-700 dark:text-emerald-400 mb-1">With M Platform:</div>
                    <div className="text-2xl font-bold text-emerald-600">6 Weeks</div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
          
          {/* The Closing Punch */}
          <Card className="p-8 bg-gradient-to-r from-slate-900 to-slate-800 dark:from-slate-950 dark:to-slate-900 border-2 border-slate-700 max-w-4xl mx-auto" data-testid="closing-punch">
            <div className="text-center space-y-4">
              <p className="text-3xl font-bold text-white">
                Adaptive Execution Is No Longer Optional.
              </p>
              <p className="text-xl text-slate-300">
                It's the difference between companies that survive disruption
                <br />
                and companies that become case studies of what not to do.
              </p>
              <div className="pt-4">
                <p className="text-2xl font-bold text-emerald-400 mb-2">
                  M Platform. Adapt at the Speed of Change.
                </p>
                <p className="text-slate-400">
                  166 pre-staged playbooks  9 strategic domains  Execution in days, not months
                </p>
              </div>
            </div>
          </Card>
        </div>
      </section>

      {/* Stats Bar */}
      <section className="py-8 bg-slate-50 dark:bg-slate-900 border-y border-slate-200 dark:border-slate-800">
        <div className="max-w-6xl mx-auto px-6">
          <div className="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8">
            {stats.map((stat, index) => (
              <div key={index} className="text-center" data-testid={`stat-${index}`}>
                <div className="flex items-center justify-center gap-2 mb-1">
                  <stat.icon className="h-5 w-5 text-slate-500 dark:text-slate-400" />
                  <span className="text-2xl md:text-3xl font-bold text-slate-900 dark:text-white">{stat.value}</span>
                </div>
                <span className="text-sm text-slate-600 dark:text-slate-400">{stat.label}</span>
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* AI Coordination Gap Section */}
      <section className="py-20 bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-950/30 dark:to-purple-950/30" data-testid="ai-coordination-gap">
        <div className="container mx-auto px-4">
          <div className="max-w-5xl mx-auto">
            <div className="text-center mb-12">
              <Badge className="mb-4 bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 border-purple-300 dark:border-purple-700" data-testid="badge-ai-era">
                The AI Era Reality
              </Badge>
              <h2 className="text-4xl md:text-5xl font-bold text-slate-900 dark:text-white mb-6" data-testid="heading-ai-gap">
                Your Employees Have AI.
                <br />
                <span className="text-transparent bg-clip-text bg-gradient-to-r from-red-600 to-orange-600">
                  Your Organization Doesn't.
                </span>
              </h2>
              <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto">
                AI gave your team superhuman speed for individual tasks.
                But your organization still coordinates at meeting speed.
              </p>
            </div>
            
            <div className="grid md:grid-cols-3 gap-6 mb-12">
              {/* Individual Work - Solved */}
              <Card className="border-2 border-emerald-300 dark:border-emerald-700 bg-white dark:bg-slate-900" data-testid="ai-gap-individual">
                <CardContent className="p-6 text-center">
                  <div className="w-16 h-16 mx-auto mb-4 bg-emerald-100 dark:bg-emerald-900/30 rounded-2xl flex items-center justify-center">
                    <Bot className="h-8 w-8 text-emerald-600 dark:text-emerald-400" />
                  </div>
                  <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">Individual Work</h3>
                  <div className="mb-4">
                    <span className="text-3xl font-bold text-emerald-600">10X Faster</span>
                    <p className="text-sm text-slate-500">with AI assistants</p>
                  </div>
                  <div className="flex items-center justify-center gap-2 text-emerald-600">
                    <Check className="h-5 w-5" />
                    <span className="font-semibold">SOLVED</span>
                  </div>
                </CardContent>
              </Card>
              
              {/* Organizational Coordination - Broken */}
              <Card className="border-2 border-red-300 dark:border-red-700 bg-white dark:bg-slate-900" data-testid="ai-gap-coordination">
                <CardContent className="p-6 text-center">
                  <div className="w-16 h-16 mx-auto mb-4 bg-red-100 dark:bg-red-900/30 rounded-2xl flex items-center justify-center">
                    <Network className="h-8 w-8 text-red-600 dark:text-red-400" />
                  </div>
                  <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">Organizational Coordination</h3>
                  <div className="mb-4">
                    <span className="text-3xl font-bold text-red-600">Same Speed</span>
                    <p className="text-sm text-slate-500">as before AI</p>
                  </div>
                  <div className="flex items-center justify-center gap-2 text-red-600">
                    <X className="h-5 w-5" />
                    <span className="font-semibold">STILL BROKEN</span>
                  </div>
                </CardContent>
              </Card>
              
              {/* M Platform - Now Solved */}
              <Card className="border-2 border-purple-300 dark:border-purple-700 bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-950/50 dark:to-blue-950/50" data-testid="ai-gap-m-platform">
                <CardContent className="p-6 text-center">
                  <div className="w-16 h-16 mx-auto mb-4 bg-purple-100 dark:bg-purple-900/30 rounded-2xl flex items-center justify-center">
                    <Sparkles className="h-8 w-8 text-purple-600 dark:text-purple-400" />
                  </div>
                  <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">M Platform</h3>
                  <div className="mb-4">
                    <span className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600">AI Speed</span>
                    <p className="text-sm text-slate-500">for coordination</p>
                  </div>
                  <div className="flex items-center justify-center gap-2 text-purple-600">
                    <Sparkles className="h-5 w-5" />
                    <span className="font-semibold">NOW SOLVED</span>
                  </div>
                </CardContent>
              </Card>
            </div>
            
            <Card className="p-8 bg-slate-900 dark:bg-black border-2 border-slate-700" data-testid="ai-bottleneck-insight">
              <div className="text-center">
                <p className="text-2xl font-bold text-white mb-4">
                  AI made the work faster.
                </p>
                <p className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400 mb-4">
                  M Platform makes the COORDINATION faster.
                </p>
                <p className="text-xl text-slate-400">
                  That's where 95% of the time is wasted.
                </p>
              </div>
            </Card>
          </div>
        </div>
      </section>

      {/* Survival Question Section */}
      <section className="py-20 bg-slate-900 dark:bg-black text-white" data-testid="survival-section">
        <div className="container mx-auto px-4">
          <div className="max-w-4xl mx-auto text-center">
            
            <h2 className="text-4xl font-bold mb-6" data-testid="heading-survival">
              The Question Isn't "Do We Need This?"
            </h2>
            <p className="text-3xl font-bold text-red-400 mb-8">
              The Question Is "Can We Survive Without It?"
            </p>
            
            <div className="grid md:grid-cols-2 gap-8 mb-12 text-left">
              
              {/* Without */}
              <div className="p-6 bg-red-950/30 border-2 border-red-800 rounded-lg" data-testid="without-m">
                <h3 className="text-xl font-bold text-red-400 mb-4">
                  Without M Platform
                </h3>
                <ul className="space-y-3 text-slate-300">
                  <li className="flex items-start gap-2">
                    <AlertTriangle className="h-5 w-5 text-red-500 shrink-0 mt-0.5" />
                    <span>Markets shift while you align stakeholders (6 weeks)</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <AlertTriangle className="h-5 w-5 text-red-500 shrink-0 mt-0.5" />
                    <span>Crises spread while you coordinate response (17 days)</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <AlertTriangle className="h-5 w-5 text-red-500 shrink-0 mt-0.5" />
                    <span>Competitors capture opportunities while you schedule meetings</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <AlertTriangle className="h-5 w-5 text-red-500 shrink-0 mt-0.5" />
                    <span>Innovation stalls in coordination hell (9 months)</span>
                  </li>
                </ul>
              </div>
              
              {/* With */}
              <div className="p-6 bg-emerald-950/30 border-2 border-emerald-800 rounded-lg" data-testid="with-m">
                <h3 className="text-xl font-bold text-emerald-400 mb-4">
                  With M Platform
                </h3>
                <ul className="space-y-3 text-slate-300">
                  <li className="flex items-start gap-2">
                    <CheckCircle className="h-5 w-5 text-emerald-500 shrink-0 mt-0.5" />
                    <span>Execute market moves in 1 week (pre-staged playbooks)</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle className="h-5 w-5 text-emerald-500 shrink-0 mt-0.5" />
                    <span>Resolve crises in 90 minutes (automated coordination)</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle className="h-5 w-5 text-emerald-500 shrink-0 mt-0.5" />
                    <span>Capture opportunities before competitors see them</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle className="h-5 w-5 text-emerald-500 shrink-0 mt-0.5" />
                    <span>Deploy innovation in 6 weeks (coordinated rollout)</span>
                  </li>
                </ul>
              </div>
            </div>
            
            <div className="p-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl" data-testid="survival-cta">
              <p className="text-2xl font-bold mb-4">
                The answer gets clearer every day the world moves faster
                <br />
                and your organization still coordinates at the speed of meetings.
              </p>
              <Button 
                size="lg" 
                onClick={() => setLocation('/how-it-works')}
                className="text-lg px-8 py-4 bg-white text-slate-900 hover:bg-slate-100"
                data-testid="button-adaptation-proof-2"
              >
                Make Your Organization Adaptation-Proof
                <ArrowRight className="ml-2 h-5 w-5" />
              </Button>
            </div>
          </div>
        </div>
      </section>

      {/* 4-Phase Navigation Grid */}
      <section className="py-20 px-6 bg-slate-50 dark:bg-slate-900">
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-slate-200 text-slate-700 dark:bg-slate-700 dark:text-slate-300 border-slate-300 dark:border-slate-600" data-testid="badge-methodology">
              The Methodology
            </Badge>
            <h2 className="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-phases">
              The IDEA Framework
            </h2>
            <p className="text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto mb-6">
              The preparation mindset of elite teams, systematized for enterprise execution.
            </p>
            <div className="inline-block p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl mb-6">
              <p className="text-lg font-semibold text-slate-900 dark:text-white italic">
                "Comfortable and confident that we are prepared to execute. No matter the situation."
              </p>
            </div>
            <div className="flex items-center justify-center gap-2 text-xl font-bold">
              <span className="text-violet-600 dark:text-violet-400">I</span>
              <span className="text-slate-400"></span>
              <span className="text-blue-600 dark:text-blue-400">D</span>
              <span className="text-slate-400"></span>
              <span className="text-emerald-600 dark:text-emerald-400">E</span>
              <span className="text-slate-400"></span>
              <span className="text-amber-600 dark:text-amber-400">A</span>
            </div>
          </div>

          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {phases.map((phase) => (
              <Card 
                key={phase.id}
                className={`${phase.borderColor} ${phase.bgColor} cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1 group`}
                onClick={() => setLocation(phase.primaryLink)}
                data-testid={`card-phase-${phase.id}`}
              >
                <CardContent className="p-6">
                  <div className="flex items-center gap-3 mb-4">
                    <div className={`w-10 h-10 rounded-xl ${phase.iconBg} flex items-center justify-center`}>
                      <span className={`text-xl font-bold ${phase.iconColor}`}>{phase.phase}</span>
                    </div>
                    <div>
                      <Badge variant="outline" className={`${phase.iconColor} border-current text-xs font-bold`}>
                        {phase.phaseName}
                      </Badge>
                    </div>
                  </div>
                  
                  <h3 className="text-lg font-bold text-slate-900 dark:text-white mb-2 group-hover:text-slate-700 dark:group-hover:text-slate-200 transition-colors">
                    {phase.title}
                  </h3>
                  
                  <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                    {phase.description}
                  </p>
                  
                  <ul className="space-y-2 mb-4">
                    {phase.features.map((feature, idx) => (
                      <li key={idx} className="flex items-center gap-2 text-sm text-slate-700 dark:text-slate-300">
                        <CheckCircle className={`h-4 w-4 ${phase.iconColor}`} />
                        {feature}
                      </li>
                    ))}
                  </ul>
                  
                  <Button 
                    variant="ghost" 
                    className={`w-full justify-between ${phase.iconColor} hover:bg-white/50 dark:hover:bg-slate-800/50`}
                  >
                    {phase.primaryLabel}
                    <ArrowRight className="h-4 w-4 group-hover:translate-x-1 transition-transform" />
                  </Button>
                </CardContent>
              </Card>
            ))}
          </div>
          
          {/* IDEA Tagline */}
          <div className="mt-12 text-center">
            <Card className="inline-block p-6 md:p-8 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/50 dark:to-purple-950/50 border-2 border-blue-300 dark:border-blue-700">
              <p className="text-2xl md:text-3xl font-bold text-slate-900 dark:text-white mb-2" data-testid="idea-tagline">
                That's the <span className="bg-gradient-to-r from-violet-600 via-emerald-500 to-amber-500 bg-clip-text text-transparent">IDEA</span>.
              </p>
              <p className="text-lg text-slate-600 dark:text-slate-400">
                Prepare with precision. Execute with confidence.
              </p>
            </Card>
          </div>
        </div>
      </section>

      {/* Offense / Defense / Special Teams */}
      <section className="py-20 px-6 bg-slate-900 dark:bg-slate-950">
        <div className="max-w-6xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-slate-700 text-slate-300 border-slate-600" data-testid="badge-coverage">
              Complete Coverage
            </Badge>
            <h2 className="text-3xl md:text-4xl font-bold text-white mb-4" data-testid="heading-coverage">
              Offense. Defense. Special Teams.
            </h2>
            <p className="text-lg text-slate-400 max-w-2xl mx-auto">
              Great football programs are prepared for every situation before the game starts. 
              M brings this same complete preparedness to business leadership.
            </p>
          </div>

          <div className="grid md:grid-cols-3 gap-8">
            {/* Offense */}
            <Card className="bg-gradient-to-br from-emerald-900/50 to-emerald-800/30 border-emerald-700/50 hover:border-emerald-500/50 transition-all" data-testid="card-offense">
              <CardContent className="p-8">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-12 h-12 bg-emerald-500/20 rounded-xl flex items-center justify-center">
                    <ArrowRight className="h-6 w-6 text-emerald-400" />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold text-white">Offense</h3>
                    <p className="text-sm text-emerald-400">Seize Opportunities</p>
                  </div>
                </div>
                <p className="text-slate-300 mb-6">
                  M&A targets, market expansion, competitive movesplaybooks ready to capitalize.
                </p>
                <div className="space-y-2 mb-6">
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-400">Market Entry & Expansion</span>
                    <span className="text-emerald-400 font-medium">22</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-400">M&A Integration</span>
                    <span className="text-emerald-400 font-medium">16</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-400">Product Launch</span>
                    <span className="text-emerald-400 font-medium">20</span>
                  </div>
                </div>
                <div className="pt-4 border-t border-emerald-700/50">
                  <p className="text-2xl font-bold text-emerald-400">58 <span className="text-sm font-normal text-slate-400">playbooks</span></p>
                </div>
              </CardContent>
            </Card>

            {/* Defense */}
            <Card className="bg-gradient-to-br from-blue-900/50 to-blue-800/30 border-blue-700/50 hover:border-blue-500/50 transition-all" data-testid="card-defense">
              <CardContent className="p-8">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                    <Shield className="h-6 w-6 text-blue-400" />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold text-white">Defense</h3>
                    <p className="text-sm text-blue-400">Protect Value</p>
                  </div>
                </div>
                <p className="text-slate-300 mb-6">
                  Regulatory changes, supply chain disruptions, cyber incidentsresponses pre-staged.
                </p>
                <div className="space-y-2 mb-6">
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-400">Crisis Response</span>
                    <span className="text-blue-400 font-medium">24</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-400">Cyber Incidents</span>
                    <span className="text-blue-400 font-medium">18</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-400">Regulatory Compliance</span>
                    <span className="text-blue-400 font-medium">14</span>
                  </div>
                </div>
                <div className="pt-4 border-t border-blue-700/50">
                  <p className="text-2xl font-bold text-blue-400">56 <span className="text-sm font-normal text-slate-400">playbooks</span></p>
                </div>
              </CardContent>
            </Card>

            {/* Special Teams */}
            <Card className="bg-gradient-to-br from-purple-900/50 to-purple-800/30 border-purple-700/50 hover:border-purple-500/50 transition-all" data-testid="card-special-teams">
              <CardContent className="p-8">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                    <Zap className="h-6 w-6 text-purple-400" />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold text-white">Special Teams</h3>
                    <p className="text-sm text-purple-400">Change the Game</p>
                  </div>
                </div>
                <p className="text-slate-300 mb-6">
                  AI governance, ESG mandates, workforce transformationemerging plays ready.
                </p>
                <div className="space-y-2 mb-6">
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-400">Digital Transformation</span>
                    <span className="text-purple-400 font-medium">16</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-400">Competitive Response</span>
                    <span className="text-purple-400 font-medium">18</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-400">AI Governance</span>
                    <span className="text-purple-400 font-medium">18</span>
                  </div>
                </div>
                <div className="pt-4 border-t border-purple-700/50">
                  <p className="text-2xl font-bold text-purple-400">52 <span className="text-sm font-normal text-slate-400">playbooks</span></p>
                </div>
              </CardContent>
            </Card>
          </div>

          <div className="mt-12 text-center">
            <p className="text-lg text-slate-400">
              No matter the situation, executives using M are prepared to execute 
              <span className="text-white font-semibold"> swiftly, efficiently, and effectively.</span>
            </p>
          </div>
        </div>
      </section>

      {/* Full Execution Timeline Demo */}
      <section className="py-20 px-6 bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950/30" data-testid="execution-timeline-demo">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 border-emerald-300 dark:border-emerald-700" data-testid="badge-demo">
              Full Execution Demo
            </Badge>
            <h2 className="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-timeline">
              Data Breach Response: Complete in 90 Minutes
            </h2>
            <p className="text-lg text-slate-600 dark:text-slate-400 max-w-3xl mx-auto">
              Coordination starts in 12 minutes. Full execution of 47 tasks across 12 stakeholders completes in 90 minutes. Industry average: 17 days.
            </p>
          </div>
          
          <Card className="p-6 bg-slate-900 dark:bg-black border-2 border-slate-700" data-testid="timeline-container">
            <div className="flex justify-between items-center mb-6 text-sm text-slate-400">
              <span>AI COORDINATION LOG</span>
              <div className="flex gap-4">
                <span className="flex items-center gap-1"><span className="w-2 h-2 bg-purple-500 rounded-full"></span> AI Action</span>
                <span className="flex items-center gap-1"><span className="w-2 h-2 bg-blue-500 rounded-full"></span> Human Decision</span>
                <span className="flex items-center gap-1"><span className="w-2 h-2 bg-emerald-500 rounded-full"></span> Completed</span>
              </div>
            </div>
            
            <div className="space-y-2 max-h-96 overflow-y-auto pr-2">
              {executionTimeline.map((item, index) => (
                <div 
                  key={index} 
                  className={`flex items-start gap-4 p-3 rounded-lg transition-all ${
                    item.type === 'ai' ? 'bg-purple-900/30 border-l-4 border-purple-500' :
                    item.type === 'decision' ? 'bg-blue-900/30 border-l-4 border-blue-500' :
                    item.type === 'blocker' ? 'bg-red-900/30 border-l-4 border-red-500' :
                    item.type === 'resolved' ? 'bg-amber-900/30 border-l-4 border-amber-500' :
                    item.type === 'approval' ? 'bg-cyan-900/30 border-l-4 border-cyan-500' :
                    item.type === 'complete' ? 'bg-emerald-900/30 border-l-4 border-emerald-500' :
                    'bg-slate-800/50 border-l-4 border-slate-600'
                  }`}
                  data-testid={`timeline-item-${index}`}
                >
                  <span className="text-slate-400 font-mono text-sm min-w-[45px]">[{item.time}]</span>
                  <span className={`text-sm ${
                    item.type === 'ai' ? 'text-purple-300' :
                    item.type === 'decision' ? 'text-blue-300' :
                    item.type === 'blocker' ? 'text-red-300' :
                    item.type === 'resolved' ? 'text-amber-300' :
                    item.type === 'approval' ? 'text-cyan-300' :
                    item.type === 'complete' ? 'text-emerald-300' :
                    'text-slate-300'
                  }`}>
                    {item.event}
                  </span>
                </div>
              ))}
            </div>
            
            <div className="grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-slate-700">
              <div className="text-center">
                <p className="text-3xl font-bold text-emerald-400">90 min</p>
                <p className="text-sm text-slate-400">Total Time</p>
              </div>
              <div className="text-center">
                <p className="text-3xl font-bold text-blue-400">8</p>
                <p className="text-sm text-slate-400">Human Decisions</p>
              </div>
              <div className="text-center">
                <p className="text-3xl font-bold text-purple-400">12</p>
                <p className="text-sm text-slate-400">AI Blockers Resolved</p>
              </div>
            </div>
          </Card>
          
          <div className="mt-8 text-center">
            <p className="text-lg text-slate-600 dark:text-slate-400 mb-4">
              <span className="font-bold text-slate-900 dark:text-white">Decision in 12 minutes. Full execution in 90 minutes.</span> Industry average: 17 days.
            </p>
            <Button 
              size="lg"
              onClick={() => setLocation('/executive-simulation')}
              className="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700"
              data-testid="button-try-simulation"
            >
              Try the Full Simulation
              <ArrowRight className="ml-2 h-5 w-5" />
            </Button>
          </div>
        </div>
      </section>

      {/* Three Corporate AI Angles */}
      <section className="py-20 px-6 bg-white dark:bg-slate-950" data-testid="corporate-ai-angles">
        <div className="max-w-6xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 border-blue-300 dark:border-blue-700" data-testid="badge-ai-angles">
              AI-Era Positioning
            </Badge>
            <h2 className="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-ai-angles">
              Three Angles for the AI-Hungry Enterprise
            </h2>
            <p className="text-lg text-slate-600 dark:text-slate-400 max-w-3xl mx-auto">
              Every Fortune 500 is deploying AI. Here's why M Platform is the missing piece.
            </p>
          </div>
          
          <div className="grid md:grid-cols-3 gap-8">
            {/* AI Governance Angle */}
            <Card className="border-2 border-purple-200 dark:border-purple-800 bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-950/30 dark:to-indigo-950/30 hover:shadow-xl transition-all" data-testid="angle-governance">
              <CardContent className="p-6">
                <div className="w-14 h-14 mb-4 bg-purple-100 dark:bg-purple-900/30 rounded-2xl flex items-center justify-center">
                  <Shield className="h-7 w-7 text-purple-600 dark:text-purple-400" />
                </div>
                <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">AI Governance</h3>
                <p className="text-sm text-purple-600 dark:text-purple-400 font-semibold mb-4">18 Pre-Built Playbooks</p>
                <p className="text-slate-600 dark:text-slate-400 mb-6">
                  Every company is deploying AI. None have governance frameworks that can keep pace.
                </p>
                <div className="space-y-3 mb-6">
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-600 dark:text-slate-400">Model deployment approval</span>
                    <span className="font-medium text-purple-600 dark:text-purple-400">6 weeks  3 days</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-600 dark:text-slate-400">Bias incident response</span>
                    <span className="font-medium text-purple-600 dark:text-purple-400">2 weeks  90 min</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span className="text-slate-600 dark:text-slate-400">Vendor risk assessment</span>
                    <span className="font-medium text-purple-600 dark:text-purple-400">2 months  5 days</span>
                  </div>
                </div>
                <p className="text-sm font-medium text-slate-700 dark:text-slate-300">
                  Your AI governance moves at the speed your AI team does.
                </p>
              </CardContent>
            </Card>
            
            {/* AI Productivity Gap Angle */}
            <Card className="border-2 border-blue-200 dark:border-blue-800 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30 hover:shadow-xl transition-all" data-testid="angle-productivity">
              <CardContent className="p-6">
                <div className="w-14 h-14 mb-4 bg-blue-100 dark:bg-blue-900/30 rounded-2xl flex items-center justify-center">
                  <TrendingUp className="h-7 w-7 text-blue-600 dark:text-blue-400" />
                </div>
                <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">AI Productivity Gap</h3>
                <p className="text-sm text-blue-600 dark:text-blue-400 font-semibold mb-4">Unlock Your AI Investment</p>
                <p className="text-slate-600 dark:text-slate-400 mb-6">
                  You spent $5M on Copilot licenses. Your employees are 10X more productive. But strategic execution is still slow.
                </p>
                <div className="p-4 bg-white dark:bg-slate-900 rounded-lg mb-6">
                  <p className="text-sm text-slate-500 dark:text-slate-400 mb-2">The Missing Piece</p>
                  <p className="font-medium text-slate-900 dark:text-white">
                    Individual AI speed  Organizational AI speed
                  </p>
                </div>
                <p className="text-sm font-medium text-slate-700 dark:text-slate-300">
                  M Platform is the coordination layer that makes your AI investment pay off.
                </p>
              </CardContent>
            </Card>
            
            {/* AI-Native Operations Angle */}
            <Card className="border-2 border-emerald-200 dark:border-emerald-800 bg-gradient-to-br from-emerald-50 to-teal-50 dark:from-emerald-950/30 dark:to-teal-950/30 hover:shadow-xl transition-all" data-testid="angle-native">
              <CardContent className="p-6">
                <div className="w-14 h-14 mb-4 bg-emerald-100 dark:bg-emerald-900/30 rounded-2xl flex items-center justify-center">
                  <Brain className="h-7 w-7 text-emerald-600 dark:text-emerald-400" />
                </div>
                <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">AI-Native Operations</h3>
                <p className="text-sm text-emerald-600 dark:text-emerald-400 font-semibold mb-4">Operate at Machine Speed</p>
                <p className="text-slate-600 dark:text-slate-400 mb-6">
                  AI-native companies don't just use AI for tasks. They use AI for coordination. That's why they move 10X faster.
                </p>
                <div className="space-y-2 mb-6">
                  <div className="flex items-center gap-2 text-sm">
                    <CheckCircle className="h-4 w-4 text-emerald-500" />
                    <span className="text-slate-700 dark:text-slate-300">Pre-staged playbooks</span>
                  </div>
                  <div className="flex items-center gap-2 text-sm">
                    <CheckCircle className="h-4 w-4 text-emerald-500" />
                    <span className="text-slate-700 dark:text-slate-300">AI-powered coordination</span>
                  </div>
                  <div className="flex items-center gap-2 text-sm">
                    <CheckCircle className="h-4 w-4 text-emerald-500" />
                    <span className="text-slate-700 dark:text-slate-300">Execution at machine speed</span>
                  </div>
                </div>
                <p className="text-sm font-medium text-slate-700 dark:text-slate-300">
                  M Platform makes you AI-nativewhere AI doesn't just assist, it orchestrates.
                </p>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Value Proposition - The Solution */}
      <section className="py-20 px-6 bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800">
        <div className="max-w-5xl mx-auto text-center">
          <Badge className="mb-4 bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800" data-testid="badge-solution">
            The Solution
          </Badge>
          <h2 className="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-value">
            M Platform: The Execution Layer
          </h2>
          <p className="text-lg text-slate-600 dark:text-slate-400 max-w-3xl mx-auto mb-8">
            The first Strategic Execution Operating Systemsoftware that turns operating model design into coordinated action.
          </p>
          
          <div className="bg-white dark:bg-slate-800 rounded-2xl p-8 mb-12 shadow-lg">
            <div className="grid md:grid-cols-2 gap-8">
              <div className="text-left">
                <h3 className="text-lg font-bold text-slate-500 dark:text-slate-400 mb-4">Consultants Design</h3>
                <ul className="space-y-3">
                  <li className="flex items-start gap-3 text-slate-600 dark:text-slate-300">
                    <span className="w-2 h-2 mt-2 bg-slate-400 rounded-full flex-shrink-0"></span>
                    12 operating model elements
                  </li>
                  <li className="flex items-start gap-3 text-slate-600 dark:text-slate-300">
                    <span className="w-2 h-2 mt-2 bg-slate-400 rounded-full flex-shrink-0"></span>
                    Fingerprint on paper
                  </li>
                  <li className="flex items-start gap-3 text-slate-600 dark:text-slate-300">
                    <span className="w-2 h-2 mt-2 bg-slate-400 rounded-full flex-shrink-0"></span>
                    "Here's what to build"
                  </li>
                </ul>
              </div>
              <div className="text-left">
                <h3 className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-4">M Platform Executes</h3>
                <ul className="space-y-3">
                  <li className="flex items-start gap-3 text-slate-700 dark:text-slate-200">
                    <CheckCircle className="w-5 h-5 mt-0.5 text-emerald-500 flex-shrink-0" />
                    166 pre-staged playbooks
                  </li>
                  <li className="flex items-start gap-3 text-slate-700 dark:text-slate-200">
                    <CheckCircle className="w-5 h-5 mt-0.5 text-emerald-500 flex-shrink-0" />
                    Fingerprint in software
                  </li>
                  <li className="flex items-start gap-3 text-slate-700 dark:text-slate-200">
                    <CheckCircle className="w-5 h-5 mt-0.5 text-emerald-500 flex-shrink-0" />
                    "Here's how to run it"
                  </li>
                </ul>
              </div>
            </div>
            <p className="mt-8 text-lg font-medium text-slate-700 dark:text-slate-300">
              McKinsey gives you the blueprint. <span className="text-emerald-600 dark:text-emerald-400 font-bold">M Platform builds the house.</span>
            </p>
          </div>
          
          <div className="grid md:grid-cols-3 gap-8">
            <div className="text-center" data-testid="value-speed">
              <div className="w-16 h-16 mx-auto mb-4 bg-blue-100 dark:bg-blue-900/30 rounded-2xl flex items-center justify-center">
                <Zap className="h-8 w-8 text-blue-600 dark:text-blue-400" />
              </div>
              <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">72 Hours  12 Minutes</h3>
              <p className="text-slate-600 dark:text-slate-400">
                Coordinated response vs. industry average. Speed is strategy.
              </p>
            </div>
            
            <div className="text-center" data-testid="value-playbooks">
              <div className="w-16 h-16 mx-auto mb-4 bg-purple-100 dark:bg-purple-900/30 rounded-2xl flex items-center justify-center">
                <BookOpen className="h-8 w-8 text-purple-600 dark:text-purple-400" />
              </div>
              <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">9 Strategic Domains</h3>
              <p className="text-slate-600 dark:text-slate-400">
                From market dynamics to AI governance. Offense and defense covered.
              </p>
            </div>
            
            <div className="text-center" data-testid="value-ai">
              <div className="w-16 h-16 mx-auto mb-4 bg-emerald-100 dark:bg-emerald-900/30 rounded-2xl flex items-center justify-center">
                <Users className="h-8 w-8 text-emerald-600 dark:text-emerald-400" />
              </div>
              <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">Human-AI Partnership</h3>
              <p className="text-slate-600 dark:text-slate-400">
                AI monitors and recommends. Executives decide and execute.
              </p>
            </div>
          </div>
        </div>
      </section>

      {/* Operating Model Alignment Feature */}
      <section className="py-12 px-6 bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600">
        <div className="max-w-5xl mx-auto">
          <Card 
            className="border-0 bg-white/10 backdrop-blur-sm cursor-pointer transition-all hover:bg-white/20 group"
            onClick={() => setLocation('/operating-model')}
            data-testid="card-operating-model-featured"
          >
            <CardContent className="p-8 flex flex-col md:flex-row items-center gap-6">
              <div className="p-4 bg-white/20 rounded-2xl">
                <Layers className="h-10 w-10 text-white" />
              </div>
              <div className="flex-1 text-center md:text-left">
                <Badge className="mb-2 bg-white/20 text-white border-white/30">McKinsey Framework</Badge>
                <h3 className="text-2xl font-bold text-white mb-2">Operating Model Alignment</h3>
                <p className="text-white/80">
                  Map your organization's structure to M's 166 playbooks using McKinsey's "Organize to Value" 12-element framework. Get personalized playbook recommendations based on your unique operating model fingerprint.
                </p>
              </div>
              <Button 
                size="lg"
                className="bg-white text-indigo-600 hover:bg-white/90 font-semibold"
                data-testid="button-start-assessment"
              >
                Start Assessment
                <ArrowRight className="ml-2 h-5 w-5 group-hover:translate-x-1 transition-transform" />
              </Button>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Featured: Executive Simulation Demo */}
      <section className="py-12 px-6 bg-gradient-to-r from-purple-600 via-blue-600 to-teal-500">
        <div className="max-w-5xl mx-auto">
          <Card 
            className="border-0 bg-white/10 backdrop-blur-sm cursor-pointer transition-all hover:bg-white/20 group"
            onClick={() => setLocation('/executive-simulation')}
            data-testid="card-simulation-demo-featured"
          >
            <CardContent className="p-8 flex flex-col md:flex-row items-center gap-6">
              <div className="p-4 bg-white/20 rounded-2xl">
                <Briefcase className="h-10 w-10 text-white" />
              </div>
              <div className="flex-1 text-center md:text-left">
                <Badge className="mb-2 bg-white/20 text-white border-white/30">Interactive Experience</Badge>
                <h3 className="text-2xl font-bold text-white mb-2">Executive Simulation Demo</h3>
                <p className="text-white/80">
                  Step into the shoes of a Fortune 500 CSO. Experience real-time signal detection, playbook activation, and rapid coordinated response across your executive team. This is exactly how M works in production.
                </p>
              </div>
              <Button 
                size="lg"
                className="bg-white text-purple-600 hover:bg-white/90 font-semibold"
                data-testid="button-try-simulation-featured"
              >
                Start Simulation
                <ArrowRight className="ml-2 h-5 w-5 group-hover:translate-x-1 transition-transform" />
              </Button>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Interactive Sandbox Demo CTA */}
      <section className="py-12 px-6 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500">
        <div className="max-w-5xl mx-auto">
          <Card 
            className="border-0 bg-white/10 backdrop-blur-sm cursor-pointer transition-all hover:bg-white/20 group"
            onClick={() => setLocation('/sandbox-demo')}
            data-testid="card-sandbox-demo-featured"
          >
            <CardContent className="p-8 flex flex-col md:flex-row items-center gap-6">
              <div className="p-4 bg-white/20 rounded-2xl">
                <Play className="h-10 w-10 text-white" />
              </div>
              <div className="flex-1 text-center md:text-left">
                <Badge className="mb-2 bg-white/20 text-white border-white/30">Try It Yourself</Badge>
                <h3 className="text-2xl font-bold text-white mb-2">Interactive Sandbox Demo</h3>
                <p className="text-white/80">
                  Configure your own playbook, set triggers, define stakeholders, and watch your personalized scenario execute in real-time. See exactly how M Platform would work for your organization.
                </p>
              </div>
              <Button 
                size="lg"
                className="bg-white text-purple-600 hover:bg-white/90 font-semibold"
                data-testid="button-try-sandbox"
              >
                Try It Now
                <ArrowRight className="ml-2 h-5 w-5 group-hover:translate-x-1 transition-transform" />
              </Button>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Sales Toolkit Section */}
      <section className="py-20 px-6 bg-slate-100 dark:bg-slate-900">
        <div className="max-w-6xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800" data-testid="badge-sales-tools">
              Sales Toolkit
            </Badge>
            <h2 className="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-4">
              Tools to Close Deals Faster
            </h2>
            <p className="text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">
              Interactive demos, ROI calculators, and board-ready exportseverything you need to demonstrate value.
            </p>
          </div>
          
          <div className="grid md:grid-cols-3 gap-6">
            {/* Live Demo */}
            <Card 
              className="border-2 border-blue-200 dark:border-blue-800 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30 cursor-pointer transition-all hover:scale-105 hover:shadow-xl"
              onClick={() => setLocation('/live-demo')}
              data-testid="card-live-demo"
            >
              <CardContent className="p-6 text-center">
                <div className="w-14 h-14 mx-auto mb-4 rounded-xl bg-blue-500/20 flex items-center justify-center">
                  <Zap className="h-7 w-7 text-blue-600 dark:text-blue-400" />
                </div>
                <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">One-Click Live Demo</h3>
                <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                  Watch a data breach get contained in 12 minutes. Real-time task cascade, stakeholder coordination, and resolution.
                </p>
                <Badge className="bg-blue-500/20 text-blue-600 dark:text-blue-400 border-blue-500/30">
                  15-Second Interactive Demo
                </Badge>
              </CardContent>
            </Card>

            {/* ROI Calculator */}
            <Card 
              className="border-2 border-green-200 dark:border-green-800 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/30 dark:to-emerald-950/30 cursor-pointer transition-all hover:scale-105 hover:shadow-xl"
              onClick={() => setLocation('/roi-calculator')}
              data-testid="card-roi-calculator"
            >
              <CardContent className="p-6 text-center">
                <div className="w-14 h-14 mx-auto mb-4 rounded-xl bg-green-500/20 flex items-center justify-center">
                  <TrendingUp className="h-7 w-7 text-green-600 dark:text-green-400" />
                </div>
                <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">ROI Calculator</h3>
                <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                  Input company size, industry, and incident frequency. Get personalized time/cost savings projections.
                </p>
                <Badge className="bg-green-500/20 text-green-600 dark:text-green-400 border-green-500/30">
                  Personalized ROI Analysis
                </Badge>
              </CardContent>
            </Card>

            {/* Board Export */}
            <Card 
              className="border-2 border-purple-200 dark:border-purple-800 bg-gradient-to-br from-purple-50 to-violet-50 dark:from-purple-950/30 dark:to-violet-950/30 cursor-pointer transition-all hover:scale-105 hover:shadow-xl"
              onClick={() => setLocation('/board-export')}
              data-testid="card-board-export"
            >
              <CardContent className="p-6 text-center">
                <div className="w-14 h-14 mx-auto mb-4 rounded-xl bg-purple-500/20 flex items-center justify-center">
                  <Briefcase className="h-7 w-7 text-purple-600 dark:text-purple-400" />
                </div>
                <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">Board-Ready Export</h3>
                <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                  Generate executive briefings with one click. Active scenarios, response metrics, and financial summary.
                </p>
                <Badge className="bg-purple-500/20 text-purple-600 dark:text-purple-400 border-purple-500/30">
                  PDF / PPTX / DOCX
                </Badge>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Origin Story */}
      <section className="py-20 px-6 bg-white dark:bg-slate-950">
        <div className="max-w-5xl mx-auto">
          <div className="grid md:grid-cols-2 gap-12 items-center">
            <div>
              <Badge className="mb-4 bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 border-amber-200 dark:border-amber-800" data-testid="badge-origin">
                The Origin
              </Badge>
              <h2 className="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-6">
                From Sideline to Boardroom
              </h2>
              <p className="text-lg text-slate-700 dark:text-slate-300 mb-4 leading-relaxed">
                Before enterprise software, I spent 5 years coordinating elite athletes under pressureas a major college football coach.
              </p>
              <p className="text-slate-600 dark:text-slate-400 mb-4">
                When a play breaks down, you don't have 72 hours. You have 40 seconds. What makes that possible isn't superhuman speedit's <strong className="text-slate-900 dark:text-white">preparation</strong>.
              </p>
              <p className="text-slate-600 dark:text-slate-400 mb-6">
                I spent 20+ years at Ford, Toyota, Lockheed Martin, Eli Lilly, and Churchill Downs asking the same question:
              </p>
              <blockquote className="border-l-4 border-amber-500 pl-4 py-2 mb-6">
                <p className="text-xl font-medium text-slate-800 dark:text-slate-200 italic">
                  "Why can't the boardroom execute like the sideline?"
                </p>
              </blockquote>
              <p className="text-lg font-semibold text-slate-900 dark:text-white">
                M Platform is the answer. <span className="text-amber-600 dark:text-amber-400">That's the IDEA.</span>
              </p>
            </div>
            <div className="grid grid-cols-1 gap-6">
              <div className="bg-slate-50 dark:bg-slate-900 rounded-xl p-6 text-center" data-testid="origin-stat-1">
                <span className="text-4xl font-bold text-amber-600 dark:text-amber-400">5</span>
                <p className="text-slate-600 dark:text-slate-400 mt-2">Years coaching major college football</p>
              </div>
              <div className="bg-slate-50 dark:bg-slate-900 rounded-xl p-6 text-center" data-testid="origin-stat-2">
                <span className="text-4xl font-bold text-amber-600 dark:text-amber-400">20+</span>
                <p className="text-slate-600 dark:text-slate-400 mt-2">Years Fortune 500 experience</p>
              </div>
              <div className="bg-slate-50 dark:bg-slate-900 rounded-xl p-6 text-center" data-testid="origin-stat-3">
                <span className="text-4xl font-bold text-amber-600 dark:text-amber-400">7</span>
                <p className="text-slate-600 dark:text-slate-400 mt-2">Enterprise transformations led</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="py-20 px-6 bg-gradient-to-r from-slate-900 to-slate-800">
        <div className="max-w-4xl mx-auto text-center">
          <h2 className="text-3xl md:text-4xl font-bold text-white mb-6" data-testid="heading-cta">
            Ready to Close the Execution Gap?
          </h2>
          <p className="text-lg text-emerald-400 font-semibold mb-2">Success Favors the Prepared</p>
          <p className="text-xl text-slate-300 mb-8">
            Start with a 90-day pilot. See M Platform coordinate your first strategic response in 12 minutes instead of 72 hours.
          </p>
          <div className="flex flex-col sm:flex-row items-center justify-center gap-4">
            <Button 
              size="lg"
              onClick={() => setLocation('/contact')}
              className="bg-white text-slate-900 hover:bg-slate-100 font-semibold px-8 py-6 text-lg"
              data-testid="button-request-access"
            >
              Request Access
              <ArrowRight className="ml-2 h-5 w-5" />
            </Button>
            <Button 
              size="lg"
              variant="outline"
              onClick={() => setLocation('/our-story')}
              className="border-white/30 text-white hover:bg-white/10 font-semibold px-8 py-6 text-lg"
              data-testid="button-learn-more"
            >
              Learn More
            </Button>
          </div>
        </div>
      </section>

      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/HowItWorks.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { 
  Target, 
  Radio, 
  CheckCircle, 
  BookOpen,
  ArrowRight,
  Clock,
  Zap,
  Brain,
  Users,
  Shield,
  TrendingUp,
  Play
} from "lucide-react";
import { useLocation } from "wouter";

export default function HowItWorks() {
  const [, setLocation] = useLocation();

  const phases = [
    {
      number: "I",
      name: "IDENTIFY",
      tagline: "Build Your Depth Chart",
      icon: Target,
      color: "violet",
      bgGradient: "from-violet-500 to-purple-600",
      borderColor: "border-violet-500",
      bgLight: "bg-violet-50 dark:bg-violet-950/30",
      textColor: "text-violet-600 dark:text-violet-400",
      description: "Create and customize playbooks from our library of 166 battle-tested strategic responses across 9 domains.",
      capabilities: [
        "Access 166 pre-built playbooks covering crisis, competition, opportunity, AI governance, and more",
        "Customize response sequences for your organization's structure",
        "Define stakeholders, approval chains, and resource allocations",
        "Set up trigger conditions that activate each playbook"
      ],
      outcome: "Your organization has a ready response for any strategic scenario before it happens."
    },
    {
      number: "D",
      name: "DETECT",
      tagline: "Monitor Signals",
      icon: Radio,
      color: "blue",
      bgGradient: "from-blue-500 to-cyan-500",
      borderColor: "border-blue-500",
      bgLight: "bg-blue-50 dark:bg-blue-950/30",
      textColor: "text-blue-600 dark:text-blue-400",
      description: "Continuous AI monitoring across 16 intelligence categories and 92 data points to detect threats and opportunities.",
      capabilities: [
        "Real-time monitoring of market signals, competitor moves, and industry shifts",
        "AI pattern recognition identifies weak signals before they become crises",
        "Automatic trigger detection matches events to relevant playbooks",
        "Configurable alert thresholds and escalation paths"
      ],
      outcome: "You're always first to knowand first to acton strategic developments."
    },
    {
      number: "E",
      name: "EXECUTE",
      tagline: "Execute Response",
      icon: CheckCircle,
      color: "emerald",
      bgGradient: "from-emerald-500 to-green-500",
      borderColor: "border-emerald-500",
      bgLight: "bg-emerald-50 dark:bg-emerald-950/30",
      textColor: "text-emerald-600 dark:text-emerald-400",
      description: "When triggers fire, M orchestrates your entire responsestakeholders, resources, and communicationsin minutes, not weeks.",
      capabilities: [
        "Automatic stakeholder notification and task assignment",
        "Pre-approved budget release for rapid resource deployment",
        "Real-time coordination dashboard tracks execution progress",
        "Integration with enterprise tools (Slack, Jira, email, calendars)"
      ],
      outcome: "Your organization responds with the speed and precision of a championship team."
    },
    {
      number: "A",
      name: "ADVANCE",
      tagline: "Review the Film",
      icon: BookOpen,
      color: "amber",
      bgGradient: "from-amber-500 to-orange-500",
      borderColor: "border-amber-500",
      bgLight: "bg-amber-50 dark:bg-amber-950/30",
      textColor: "text-amber-600 dark:text-amber-400",
      description: "Every execution feeds back into the system, making your playbooks smarter and your organization more prepared.",
      capabilities: [
        "Automatic outcome capture and performance analysis",
        "AI-powered playbook refinement suggestions",
        "Institutional memory preserves lessons learned",
        "Board-ready briefings generated from execution data"
      ],
      outcome: "Your strategic capability compounds over timeevery response makes the next one better."
    }
  ];

  const differentiators = [
    {
      icon: Clock,
      title: "12-Minute Execution",
      description: "Industry average: 6-8 weeks. M delivers coordinated response in 12 minutes."
    },
    {
      icon: Brain,
      title: "Human-AI Partnership",
      description: "AI monitors and recommends. Executives decide. The best of both worlds."
    },
    {
      icon: Shield,
      title: "Pre-Approved Response",
      description: "Budgets, stakeholders, and actions pre-definedno bottlenecks when speed matters."
    },
    {
      icon: TrendingUp,
      title: "Compounding Advantage",
      description: "Every execution makes your playbooks smarter and your team faster."
    }
  ];

  return (
    <div className="page-background min-h-screen">
      <StandardNav />
      
      {/* Hero Section */}
      <div className="relative overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white">
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_30%_50%,rgba(59,130,246,0.1),transparent_50%)]" />
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_70%_80%,rgba(139,92,246,0.1),transparent_50%)]" />
        
        <div className="container mx-auto px-6 py-20 relative z-10">
          <div className="max-w-4xl mx-auto text-center">
            <Badge className="mb-6 bg-blue-500/20 text-blue-300 border-blue-500/30 text-sm px-4 py-2">
              The 4-Phase Methodology
            </Badge>
            <h1 className="text-4xl md:text-6xl font-bold mb-6">
              How M Works
            </h1>
            <p className="text-xl md:text-2xl text-slate-300 mb-8 leading-relaxed max-w-3xl mx-auto">
              A continuous cycle that transforms how Fortune 1000 companies detect, decide, and execute on strategic opportunities and threats.
            </p>
            
            {/* Visual Phase Flow */}
            <div className="flex items-center justify-center gap-2 md:gap-4 mt-12 flex-wrap">
              {phases.map((phase, index) => (
                <div key={phase.name} className="flex items-center">
                  <div className={`w-12 h-12 md:w-16 md:h-16 rounded-xl bg-gradient-to-br ${phase.bgGradient} flex items-center justify-center shadow-lg`}>
                    <phase.icon className="h-6 w-6 md:h-8 md:w-8 text-white" />
                  </div>
                  {index < phases.length - 1 && (
                    <ArrowRight className="h-5 w-5 md:h-6 md:w-6 text-slate-500 mx-1 md:mx-2" />
                  )}
                </div>
              ))}
              <ArrowRight className="h-5 w-5 md:h-6 md:w-6 text-slate-500 mx-1 md:mx-2 rotate-180 hidden md:block" />
            </div>
            <p className="text-sm text-slate-400 mt-4">Continuous cycle  ADVANCE feeds back into IDENTIFY</p>
          </div>
        </div>
      </div>

      {/* Phase Details */}
      <div className="container mx-auto px-6 py-20">
        <div className="max-w-5xl mx-auto space-y-16">
          {phases.map((phase, index) => (
            <div 
              key={phase.name}
              className={`relative ${index % 2 === 1 ? 'md:flex-row-reverse' : ''}`}
              data-testid={`phase-${phase.name.toLowerCase()}`}
            >
              {/* Phase Card */}
              <div className={`rounded-2xl border-2 ${phase.borderColor} overflow-hidden bg-white dark:bg-slate-900 shadow-xl`}>
                {/* Phase Header */}
                <div className={`bg-gradient-to-r ${phase.bgGradient} p-6 md:p-8`}>
                  <div className="flex items-center gap-4">
                    <div className="w-16 h-16 rounded-xl bg-white/20 backdrop-blur flex items-center justify-center">
                      <phase.icon className="h-8 w-8 text-white" />
                    </div>
                    <div>
                      <div className="text-white/70 text-sm font-medium">Phase {phase.number}</div>
                      <h2 className="text-2xl md:text-3xl font-bold text-white">{phase.name}</h2>
                      <p className="text-white/90 text-lg">{phase.tagline}</p>
                    </div>
                  </div>
                </div>
                
                {/* Phase Content */}
                <div className="p-6 md:p-8">
                  <p className="text-lg text-slate-700 dark:text-slate-300 mb-6">
                    {phase.description}
                  </p>
                  
                  {/* Capabilities */}
                  <div className="space-y-3 mb-6">
                    {phase.capabilities.map((capability, i) => (
                      <div key={i} className="flex items-start gap-3">
                        <div className={`w-6 h-6 rounded-full ${phase.bgLight} flex items-center justify-center flex-shrink-0 mt-0.5`}>
                          <CheckCircle className={`h-4 w-4 ${phase.textColor}`} />
                        </div>
                        <span className="text-slate-600 dark:text-slate-400">{capability}</span>
                      </div>
                    ))}
                  </div>
                  
                  {/* Outcome */}
                  <div className={`${phase.bgLight} rounded-xl p-4 border-l-4 ${phase.borderColor}`}>
                    <div className={`text-sm font-semibold ${phase.textColor} mb-1`}>Outcome</div>
                    <p className="text-slate-700 dark:text-slate-300 font-medium">{phase.outcome}</p>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Differentiators Section */}
      <div className="bg-slate-100 dark:bg-slate-800/50 py-20">
        <div className="container mx-auto px-6">
          <div className="max-w-5xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-4">
                What Makes This Different
              </h2>
              <p className="text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">
                M isn't just another planning tool. It's a complete operating system for strategic execution.
              </p>
            </div>
            
            <div className="grid md:grid-cols-2 gap-6">
              {differentiators.map((diff, index) => (
                <div 
                  key={index}
                  className="bg-white dark:bg-slate-900 rounded-xl p-6 border border-slate-200 dark:border-slate-700 hover:shadow-lg transition-shadow"
                  data-testid={`differentiator-${index}`}
                >
                  <div className="flex items-start gap-4">
                    <div className="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center flex-shrink-0">
                      <diff.icon className="h-6 w-6 text-blue-600 dark:text-blue-400" />
                    </div>
                    <div>
                      <h3 className="text-lg font-semibold text-slate-900 dark:text-white mb-2">{diff.title}</h3>
                      <p className="text-slate-600 dark:text-slate-400">{diff.description}</p>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>

      {/* CTA Section */}
      <div className="container mx-auto px-6 py-20">
        <div className="max-w-4xl mx-auto text-center">
          <h2 className="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-4">
            Ready to See It in Action?
          </h2>
          <p className="text-lg text-slate-600 dark:text-slate-400 mb-8 max-w-2xl mx-auto">
            Watch how M transforms a competitive threat into a coordinated 12-minute response.
          </p>
          <div className="flex flex-col sm:flex-row items-center justify-center gap-4">
            <Button 
              onClick={() => setLocation("/demo/live-activation")}
              className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-6 text-lg"
              data-testid="button-watch-demo"
            >
              <Play className="h-5 w-5 mr-2" />
              Watch Live Demo
            </Button>
            <Button 
              onClick={() => setLocation("/playbook-library")}
              variant="outline"
              className="border-slate-300 dark:border-slate-600 px-8 py-6 text-lg"
              data-testid="button-explore-playbooks"
            >
              Explore 166 Playbooks
              <ArrowRight className="h-5 w-5 ml-2" />
            </Button>
          </div>
        </div>
      </div>

      {/* Footer */}
      <footer className="bg-slate-900 text-white py-12">
        <div className="container mx-auto px-6 text-center">
          <div className="flex items-center justify-center gap-3 mb-4">
            <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
              <span className="text-white font-bold text-xl">M</span>
            </div>
            <span className="font-bold text-lg">Strategic Execution OS</span>
          </div>
          <p className="text-slate-400">
            Transforming how Fortune 1000 companies execute strategy.
          </p>
        </div>
      </footer>
    </div>
  );
}


========================================
FILE: client/src/pages/IndustryDemosHub.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { Link } from "wouter";
import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import DemoNavHeader from "@/components/demo/DemoNavHeader";
import { 
  Building2, 
  Pill, 
  Factory, 
  ShoppingCart, 
  Zap,
  Clock,
  DollarSign,
  Users,
  ArrowRight,
  Shield,
  AlertTriangle,
  TrendingUp,
  Crown,
  Rocket,
  Target,
  ShoppingBag
} from "lucide-react";

interface IndustryDemo {
  id: string;
  title: string;
  industry: string;
  icon: any;
  iconColor: string;
  bgGradient: string;
  borderColor: string;
  crisis: string;
  organization: string;
  playbook: string;
  impact: string;
  timeSaved: string;
  valueSaved: string;
  stakeholders: number;
  route: string;
  status: "live" | "coming-soon";
  type: "offensive" | "defensive"; // Strategic opportunity vs crisis response
}

const industryDemos: IndustryDemo[] = [
  // OFFENSIVE DEMOS (Strategic Opportunities)
  {
    id: "lvmh-market-entry",
    title: "Strategic Market Entry",
    industry: "Luxury Goods",
    icon: Crown,
    iconColor: "text-purple-400",
    bgGradient: "from-purple-950 to-indigo-950",
    borderColor: "border-purple-500",
    crisis: "China Luxury Renaissance - 10-Brand Simultaneous Launch",
    organization: "LVMH Mot Hennessy Louis Vuitton",
    playbook: "#145 Strategic Market Entry (Offensive)",
    impact: "10 brands, 15 cities, 47 retail locations, 580M capex",
    timeSaved: "6-9 months  12 minutes",
    valueSaved: "1.68B value creation",
    stakeholders: 1267,
    route: "/lvmh-demo",
    status: "live",
    type: "offensive"
  },
  {
    id: "shein-trend",
    title: "Viral Trend Capitalization",
    industry: "Fast Fashion",
    icon: TrendingUp,
    iconColor: "text-pink-400",
    bgGradient: "from-pink-950 to-rose-950",
    borderColor: "border-pink-500",
    crisis: "TikTok Cottage Core Trend - 200 SKUs in 7 Days",
    organization: "SHEIN (Global Fashion Marketplace)",
    playbook: "#146 Trend Capitalization (Offensive)",
    impact: "47M TikTok views, $180M opportunity, 21-day lifecycle",
    timeSaved: "48-72 hours  12 minutes",
    valueSaved: "$108M additional revenue",
    stakeholders: 5847,
    route: "/shein-demo",
    status: "live",
    type: "offensive"
  },
  {
    id: "spacex-launch",
    title: "Launch Schedule Acceleration",
    industry: "Aerospace",
    icon: Rocket,
    iconColor: "text-blue-400",
    bgGradient: "from-blue-950 to-cyan-950",
    borderColor: "border-blue-500",
    crisis: "Orbital Window Opportunity - 3-Day Launch Advancement",
    organization: "SpaceX (Space Transportation)",
    playbook: "#155 Launch Acceleration (Offensive)",
    impact: "Starlink Group 7-8, 23 satellites, optimal orbital geometry",
    timeSaved: "5-7 days  12 minutes",
    valueSaved: "$47M revenue + strategic position",
    stakeholders: 1847,
    route: "/spacex-demo",
    status: "live",
    type: "offensive"
  },
  
  // DEFENSIVE DEMOS (Crisis Response)
  {
    id: "luxury-crisis",
    title: "Luxury Brand Crisis",
    industry: "Luxury Goods",
    icon: Building2,
    iconColor: "text-purple-400",
    bgGradient: "from-purple-950 to-pink-950",
    borderColor: "border-purple-500",
    crisis: "China Luxury Spending Collapse",
    organization: "LVMH Maisons Group",
    playbook: "#044 Revenue Shortfall - Asia Pacific",
    impact: "400B market cap, 75 brands, 12 regions",
    timeSaved: "72 hours  12 minutes",
    valueSaved: "280M preserved",
    stakeholders: 193,
    route: "/luxury-demo",
    status: "live",
    type: "defensive"
  },
  {
    id: "financial",
    title: "Ransomware Attack",
    industry: "Financial Services",
    icon: Shield,
    iconColor: "text-blue-400",
    bgGradient: "from-blue-950 to-slate-950",
    borderColor: "border-blue-500",
    crisis: "Banking Infrastructure Breach",
    organization: "LoanDepot (Major Mortgage Lender)",
    playbook: "#065 Ransomware Attack Response",
    impact: "$2.3B market cap, 2M active borrowers",
    timeSaved: "72 hours  12 minutes",
    valueSaved: "$22M cost avoided",
    stakeholders: 150,
    route: "/financial-demo",
    status: "live",
    type: "defensive"
  },
  {
    id: "pharma",
    title: "Product Recall",
    industry: "Pharmaceutical",
    icon: Pill,
    iconColor: "text-red-400",
    bgGradient: "from-red-950 to-rose-950",
    borderColor: "border-red-500",
    crisis: "Class I Recall - Life-Threatening Defect",
    organization: "Glenmark Pharmaceuticals",
    playbook: "#095 Product Recall (Class I)",
    impact: "47M units affected, 50M+ patients worldwide",
    timeSaved: "6 weeks  12 minutes",
    valueSaved: "A life saved + $50M liability avoided",
    stakeholders: 2052,
    route: "/pharma-demo",
    status: "live",
    type: "defensive"
  },
  {
    id: "manufacturing",
    title: "Supplier Crisis",
    industry: "Manufacturing",
    icon: Factory,
    iconColor: "text-orange-400",
    bgGradient: "from-orange-950 to-amber-950",
    borderColor: "border-orange-500",
    crisis: "Critical Semiconductor Shortage",
    organization: "Toyota Motor Corporation",
    playbook: "#019 Supplier Failure Response",
    impact: "$250B market cap, 10M vehicles/year",
    timeSaved: "30 days  4 hours",
    valueSaved: "$450M production saved",
    stakeholders: 158,
    route: "/manufacturing-demo",
    status: "live",
    type: "defensive"
  },
  {
    id: "retail",
    title: "Food Contamination",
    industry: "Retail",
    icon: ShoppingCart,
    iconColor: "text-green-400",
    bgGradient: "from-green-950 to-emerald-950",
    borderColor: "border-green-500",
    crisis: "Salmonella Contamination Crisis",
    organization: "Walmart Inc. (Global Retailer)",
    playbook: "#095 Food Product Recall (Class I)",
    impact: "847 stores, 23 states, 12,847 customers affected",
    timeSaved: "7 days  1 hour",
    valueSaved: "$245M + lives saved",
    stakeholders: 5000,
    route: "/retail-demo",
    status: "live",
    type: "defensive"
  },
  {
    id: "energy",
    title: "Grid Infrastructure",
    industry: "Energy & Utilities",
    icon: Zap,
    iconColor: "text-yellow-400",
    bgGradient: "from-yellow-950 to-orange-950",
    borderColor: "border-yellow-500",
    crisis: "Cascading Grid Failure Crisis",
    organization: "Pacific Grid & Power",
    playbook: "#082 Grid Emergency Response (NERC Category 3)",
    impact: "8.2M customers, 247 substations, 3 states",
    timeSaved: "3-5 days  3 hours",
    valueSaved: "$2.5B + lives saved",
    stakeholders: 2500,
    route: "/energy-demo",
    status: "live",
    type: "defensive"
  }
];

export default function IndustryDemosHub() {
  const offensiveDemos = industryDemos.filter(d => d.type === "offensive" && d.status === "live");
  const defensiveDemos = industryDemos.filter(d => d.type === "defensive" && d.status === "live");
  const comingSoonDemos = industryDemos.filter(d => d.status === "coming-soon");

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900">
      <DemoNavHeader title="Industry Demos Hub" showBackButton={true} />
      
      {/* Header */}
      <div className="border-b border-blue-800/30 bg-slate-950/50 backdrop-blur-sm pt-20">
        <div className="container mx-auto px-6 py-6">
          <div className="text-center">
            <h1 className="text-4xl font-bold text-white mb-2">Strategic Execution Operating System</h1>
            <p className="text-xl text-blue-200 mb-4">
              Execute any strategic decision in 12 minutesopportunities and threats
            </p>
            <div className="flex justify-center gap-6 text-sm">
              <div className="flex items-center gap-2 text-green-300">
                <Target className="w-4 h-4" />
                <span>Strategic Opportunities</span>
              </div>
              <div className="flex items-center gap-2 text-amber-300">
                <AlertTriangle className="w-4 h-4" />
                <span>Crisis Response</span>
              </div>
              <div className="flex items-center gap-2 text-blue-300">
                <Clock className="w-4 h-4" />
                <span>12-Minute Coordination</span>
              </div>
              <div className="flex items-center gap-2 text-purple-300">
                <Users className="w-4 h-4" />
                <span>Live Orchestration</span>
              </div>
            </div>
            <div className="mt-4 max-w-3xl mx-auto">
              <p className="text-sm text-blue-300">
                M isn't just crisis insuranceit's the execution layer for strategic velocity. When you detect an opportunity or threat, 
                coordinate your entire organization in minutes, not days.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-6 py-12">
        {/* Strategic Opportunities (Offensive) */}
        <div className="mb-16">
          <div className="flex items-center gap-3 mb-6">
            <Target className="w-6 h-6 text-green-400" />
            <h2 className="text-2xl font-bold text-white">Strategic Opportunities (Offensive Coordination)</h2>
            <Badge className="bg-green-600">3 Live Demos</Badge>
          </div>
          <p className="text-blue-200 mb-6 max-w-4xl">
            When opportunities emergemarket shifts, competitive windows, strategic launches12-minute coordination enables your organization 
            to execute while competitors are still scheduling the kickoff meeting.
          </p>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {offensiveDemos.map((demo) => (
              <Card
                key={demo.id}
                className={`p-6 bg-gradient-to-br ${demo.bgGradient} border-2 ${demo.borderColor} hover:scale-[1.02] transition-transform cursor-pointer group`}
              >
                <div className="flex items-start justify-between mb-4">
                  <div className="flex items-center gap-3">
                    <div className={`p-3 rounded-lg bg-slate-950/50 ${demo.iconColor}`}>
                      <demo.icon className="w-6 h-6" />
                    </div>
                    <div>
                      <h3 className="text-xl font-bold text-white">{demo.title}</h3>
                      <p className="text-sm text-blue-200">{demo.industry}</p>
                    </div>
                  </div>
                  <Badge variant="outline" className="border-white/30 text-white">
                    {demo.playbook.split(' ')[0]}
                  </Badge>
                </div>

                <div className="space-y-3 mb-6">
                  <div>
                    <div className="text-sm text-blue-300 mb-1">Strategic Move</div>
                    <div className="font-semibold text-white">{demo.crisis}</div>
                  </div>

                  <div>
                    <div className="text-sm text-blue-300 mb-1">Organization</div>
                    <div className="text-white">{demo.organization}</div>
                  </div>

                  <div className="grid grid-cols-2 gap-4 pt-3 border-t border-white/10">
                    <div>
                      <div className="text-xs text-blue-300 mb-1">Coordination Speed</div>
                      <div className="text-sm font-bold text-white">{demo.timeSaved}</div>
                    </div>
                    <div>
                      <div className="text-xs text-blue-300 mb-1">Value Created</div>
                      <div className="text-sm font-bold text-green-400">{demo.valueSaved}</div>
                    </div>
                    <div className="col-span-2">
                      <div className="text-xs text-blue-300 mb-1">Stakeholders Coordinated</div>
                      <div className="text-sm font-bold text-white">{demo.stakeholders.toLocaleString()}</div>
                    </div>
                  </div>
                </div>

                <Link href={demo.route}>
                  <Button className="w-full bg-white/10 hover:bg-white/20 text-white border border-white/20 group-hover:bg-white/30" data-testid={`button-${demo.id}-demo`}>
                    Experience {demo.title} Demo
                    <ArrowRight className="w-4 h-4 ml-2" />
                  </Button>
                </Link>
              </Card>
            ))}
          </div>
        </div>

        {/* Crisis Response (Defensive) */}
        <div className="mb-16">
          <div className="flex items-center gap-3 mb-6">
            <AlertTriangle className="w-6 h-6 text-amber-400" />
            <h2 className="text-2xl font-bold text-white">Crisis Response (Defensive Coordination)</h2>
            <Badge className="bg-amber-600">6 Live Demos</Badge>
          </div>
          <p className="text-blue-200 mb-6 max-w-4xl">
            When crises hitransomware, recalls, supplier failurestraditional coordination takes days. M compresses response to minutes, 
            minimizing damage and protecting value before the situation escalates.
          </p>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {defensiveDemos.map((demo) => (
              <Card
                key={demo.id}
                className={`p-6 bg-gradient-to-br ${demo.bgGradient} border-2 ${demo.borderColor} hover:scale-[1.02] transition-transform cursor-pointer group`}
              >
                <div className="flex items-start justify-between mb-4">
                  <div className="flex items-center gap-3">
                    <div className={`p-3 rounded-lg bg-slate-950/50 ${demo.iconColor}`}>
                      <demo.icon className="w-6 h-6" />
                    </div>
                    <div>
                      <h3 className="text-xl font-bold text-white">{demo.title}</h3>
                      <p className="text-sm text-blue-200">{demo.industry}</p>
                    </div>
                  </div>
                  <Badge variant="outline" className="border-white/30 text-white">
                    {demo.playbook.split(' - ')[0]}
                  </Badge>
                </div>

                <div className="space-y-3 mb-6">
                  <div>
                    <div className="text-sm text-blue-300 mb-1">Crisis Scenario</div>
                    <div className="font-semibold text-white">{demo.crisis}</div>
                  </div>

                  <div>
                    <div className="text-sm text-blue-300 mb-1">Organization</div>
                    <div className="text-white">{demo.organization}</div>
                  </div>

                  <div className="grid grid-cols-2 gap-4 pt-3 border-t border-white/10">
                    <div>
                      <div className="text-xs text-blue-300 mb-1">Time Saved</div>
                      <div className="font-bold text-green-400 text-sm">{demo.timeSaved}</div>
                    </div>
                    <div>
                      <div className="text-xs text-blue-300 mb-1">Value Impact</div>
                      <div className="font-bold text-yellow-400 text-sm">{demo.valueSaved}</div>
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div className="flex items-center gap-2">
                      <Users className="w-4 h-4 text-purple-400" />
                      <span className="text-sm text-white">{demo.stakeholders} stakeholders</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <AlertTriangle className="w-4 h-4 text-orange-400" />
                      <span className="text-sm text-white">4-Act Demo</span>
                    </div>
                  </div>
                </div>

                <Link href={demo.route}>
                  <Button
                    className="w-full bg-white/10 hover:bg-white/20 text-white border border-white/30 group-hover:bg-white group-hover:text-slate-900 transition-colors"
                    data-testid={`button-demo-${demo.id}`}
                  >
                    Experience {demo.industry} Demo
                    <ArrowRight className="w-4 h-4 ml-2" />
                  </Button>
                </Link>
              </Card>
            ))}
          </div>
        </div>

        {/* Coming Soon */}
        {comingSoonDemos.length > 0 && (
          <div>
            <div className="flex items-center gap-3 mb-6">
              <div className="w-2 h-2 rounded-full bg-blue-500" />
              <h2 className="text-2xl font-bold text-white">Coming Soon</h2>
              <Badge variant="outline" className="border-blue-500 text-blue-400">
                In Development
              </Badge>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {comingSoonDemos.map((demo) => (
                <Card
                  key={demo.id}
                  className="p-6 bg-slate-900/30 border-slate-700 opacity-75"
                >
                  <div className="flex items-center gap-3 mb-4">
                    <div className={`p-2 rounded-lg bg-slate-950/50 ${demo.iconColor}`}>
                      <demo.icon className="w-5 h-5" />
                    </div>
                    <div>
                      <h3 className="font-bold text-white">{demo.title}</h3>
                      <p className="text-sm text-blue-300">{demo.industry}</p>
                    </div>
                  </div>

                  <div className="text-sm text-blue-200 mb-4">{demo.crisis}</div>

                  <div className="flex items-center justify-between text-xs">
                    <div className="text-blue-300">{demo.organization}</div>
                    <Badge variant="outline" className="border-blue-600 text-blue-400">
                      Coming Soon
                    </Badge>
                  </div>
                </Card>
              ))}
            </div>
          </div>
        )}

        {/* Value Proposition */}
        <Card className="mt-12 p-8 bg-gradient-to-r from-blue-950/50 to-purple-950/50 border-blue-800/30">
          <div className="text-center max-w-4xl mx-auto">
            <h3 className="text-2xl font-bold text-white mb-4">The Detection-Execution Gap</h3>
            <p className="text-lg text-blue-100 mb-6 leading-relaxed">
              Every industry has invested billions in AI for detectionfraud monitoring, quality control, supply chain visibility, threat intelligence. 
              But when crises hit, coordination still happens at email speed. M bridges that gap.
            </p>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div className="text-center">
                <div className="text-3xl font-bold text-red-400 mb-2">48-72 Hours</div>
                <div className="text-sm text-red-300">Traditional coordination delay</div>
              </div>
              <div className="text-center">
                <ArrowRight className="w-8 h-8 text-blue-400 mx-auto mb-2" />
                <div className="text-sm text-blue-300">M orchestration</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-green-400 mb-2">12 Minutes</div>
                <div className="text-sm text-green-300">Full stakeholder coordination</div>
              </div>
            </div>
          </div>
        </Card>

        {/* CTA */}
        <div className="text-center mt-12">
          <Link href="/playbook-library">
            <Button size="lg" className="bg-blue-600 hover:bg-blue-700 text-white px-8">
              Explore All 166 Playbooks
              <ArrowRight className="w-5 h-5 ml-2" />
            </Button>
          </Link>
        </div>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/InstitutionalMemory.tsx
========================================
import PageLayout from '@/components/layout/PageLayout';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Brain, BookOpen, TrendingUp, Award, AlertCircle, CheckCircle } from 'lucide-react';

export default function InstitutionalMemory() {
  const { data: decisionOutcomesData, isLoading: outcomesLoading } = useQuery<any[]>({
    queryKey: ['/api/decision-outcomes'],
  });

  const { data: learningPatternsData, isLoading: patternsLoading } = useQuery<any[]>({
    queryKey: ['/api/learning-patterns'],
  });

  const { data: institutionalKnowledgeData, isLoading: knowledgeLoading } = useQuery<any[]>({
    queryKey: ['/api/institutional-memory'],
  });

  const decisionOutcomes = decisionOutcomesData ?? [];
  const learningPatterns = learningPatternsData ?? [];
  const institutionalKnowledge = institutionalKnowledgeData ?? [];

  const getOutcomeIcon = (outcome: string) => {
    switch (outcome) {
      case 'successful': return <CheckCircle className="h-5 w-5 text-green-500" />;
      case 'partially_successful': return <AlertCircle className="h-5 w-5 text-yellow-500" />;
      case 'failed': return <AlertCircle className="h-5 w-5 text-red-500" />;
      default: return <AlertCircle className="h-5 w-5 text-gray-500" />;
    }
  };

  return (
    <PageLayout>
      <div className="space-y-6 p-6">
        {/* V2 Feature Banner */}
      <div className="bg-blue-50 dark:bg-blue-950/30 border-2 border-blue-300 dark:border-blue-700 rounded-lg p-4">
        <div className="flex items-center gap-3">
          <Badge variant="outline" className="bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 font-semibold">Coming in V2</Badge>
          <p className="text-sm text-gray-700 dark:text-gray-300">
            This feature launches after you run real crises. Institutional Memory learns from your outcomes to make smarter recommendations.
          </p>
        </div>
      </div>

      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold flex items-center gap-2" data-testid="page-title">
            <Brain className="h-8 w-8 text-purple-500" />
            Institutional Memory
          </h1>
          <p className="text-muted-foreground mt-1">
            Learn from past decisions and continuously improve AI recommendations
          </p>
        </div>
        <Button data-testid="button-record-learning">
          <BookOpen className="h-4 w-4 mr-2" />
          Record New Learning
        </Button>
      </div>

      {/* Key Metrics */}
      <div className="grid gap-4 md:grid-cols-3">
        <Card data-testid="card-decisions-tracked">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Decisions Tracked</CardTitle>
            <BookOpen className="h-4 w-4 text-blue-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{decisionOutcomes.length}</div>
            <p className="text-xs text-muted-foreground">
              Historical decision records
            </p>
          </CardContent>
        </Card>

        <Card data-testid="card-patterns-identified">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Patterns Identified</CardTitle>
            <TrendingUp className="h-4 w-4 text-green-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{learningPatterns.length}</div>
            <p className="text-xs text-muted-foreground">
              AI-discovered insights
            </p>
          </CardContent>
        </Card>

        <Card data-testid="card-knowledge-base">
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Knowledge Base</CardTitle>
            <Award className="h-4 w-4 text-purple-600" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{institutionalKnowledge.length}</div>
            <p className="text-xs text-muted-foreground">
              Documented learnings
            </p>
          </CardContent>
        </Card>
      </div>

      {/* Main Content Tabs */}
      <Tabs defaultValue="outcomes" className="space-y-4">
        <TabsList data-testid="tabs-memory-sections">
          <TabsTrigger value="outcomes" data-testid="tab-outcomes">Decision Outcomes</TabsTrigger>
          <TabsTrigger value="patterns" data-testid="tab-patterns">Learning Patterns</TabsTrigger>
          <TabsTrigger value="knowledge" data-testid="tab-knowledge">Knowledge Base</TabsTrigger>
        </TabsList>

        <TabsContent value="outcomes" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Decision Outcomes History</CardTitle>
              <CardDescription>
                Track effectiveness and lessons learned from past executive decisions
              </CardDescription>
            </CardHeader>
            <CardContent>
              {outcomesLoading ? (
                <div className="text-center py-8 text-muted-foreground">Loading outcomes...</div>
              ) : decisionOutcomes.length === 0 ? (
                <div className="text-center py-8 text-muted-foreground">
                  <BookOpen className="h-12 w-12 mx-auto mb-2 text-gray-400" />
                  <p>No decision outcomes recorded yet</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {decisionOutcomes.map((outcome: any) => (
                    <div 
                      key={outcome.id} 
                      className="border rounded-lg p-4 space-y-3"
                      data-testid={`outcome-${outcome.id}`}
                    >
                      <div className="flex items-start justify-between">
                        <div className="flex-1 page-background space-y-2">
                          <div className="flex items-center gap-2">
                            {getOutcomeIcon(outcome.outcomeType)}
                            <h3 className="font-semibold" data-testid={`text-outcome-type-${outcome.id}`}>
                              {outcome.decisionType}
                            </h3>
                            <Badge variant="outline">{outcome.outcomeType}</Badge>
                          </div>
                          <p className="text-sm">{outcome.decisionDescription}</p>
                          {outcome.lessonsLearned && (
                            <div className="bg-blue-50 dark:bg-blue-950 p-3 rounded-md">
                              <p className="text-sm font-medium mb-1">Lessons Learned:</p>
                              <p className="text-sm text-muted-foreground">{outcome.lessonsLearned}</p>
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="patterns" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>AI-Discovered Learning Patterns</CardTitle>
              <CardDescription>
                Patterns identified from historical data to improve future recommendations
              </CardDescription>
            </CardHeader>
            <CardContent>
              {patternsLoading ? (
                <div className="text-center py-8 text-muted-foreground">Loading patterns...</div>
              ) : learningPatterns.length === 0 ? (
                <div className="text-center py-8 text-muted-foreground">
                  <TrendingUp className="h-12 w-12 mx-auto mb-2 text-gray-400" />
                  <p>No patterns identified yet - Need more decision history</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {learningPatterns.map((pattern: any) => (
                    <div 
                      key={pattern.id} 
                      className="border rounded-lg p-4 space-y-2"
                      data-testid={`pattern-${pattern.id}`}
                    >
                      <div className="flex items-center gap-2">
                        <Badge variant="secondary">{pattern.patternType}</Badge>
                        <Badge variant="outline">{pattern.category}</Badge>
                      </div>
                      <h3 className="font-semibold" data-testid={`text-pattern-title-${pattern.id}`}>{pattern.title}</h3>
                      <p className="text-sm text-muted-foreground">{pattern.description}</p>
                      {pattern.confidenceLevel && (
                        <p className="text-sm">
                          <span className="font-medium">Confidence:</span> {pattern.confidenceLevel}
                        </p>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="knowledge" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Institutional Knowledge Base</CardTitle>
              <CardDescription>
                Documented organizational wisdom and best practices
              </CardDescription>
            </CardHeader>
            <CardContent>
              {knowledgeLoading ? (
                <div className="text-center py-8 text-muted-foreground">Loading knowledge base...</div>
              ) : institutionalKnowledge.length === 0 ? (
                <div className="text-center py-8 text-muted-foreground">
                  <Award className="h-12 w-12 mx-auto mb-2 text-gray-400" />
                  <p>Knowledge base is empty - Start documenting learnings</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {institutionalKnowledge.map((knowledge: any) => (
                    <div 
                      key={knowledge.id} 
                      className="border rounded-lg p-4 space-y-2"
                      data-testid={`knowledge-${knowledge.id}`}
                    >
                      <div className="flex items-center gap-2">
                        <Badge>{knowledge.memoryType}</Badge>
                        {knowledge.domain && <Badge variant="outline">{knowledge.domain}</Badge>}
                      </div>
                      <h3 className="font-semibold" data-testid={`text-knowledge-title-${knowledge.id}`}>{knowledge.title}</h3>
                      <p className="text-sm">{knowledge.summary}</p>
                    </div>
                  ))}
                </div>
              )}
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/IntegrationHub.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Switch } from '@/components/ui/switch';
import PageLayout from '@/components/layout/PageLayout';
import { useQuery } from '@tanstack/react-query';
import { Link as WouterLink } from 'wouter';
import { 
  Globe, 
  Zap, 
  Settings, 
  Key, 
  Database,
  Cloud,
  Shield,
  Activity,
  CheckCircle,
  AlertTriangle,
  Clock,
  BarChart3,
  Users,
  Link,
  Monitor,
  Code,
  FileText,
  Download,
  Upload,
  Play,
  Pause,
  RefreshCw,
  Plus,
  Edit,
  Trash2,
  Search,
  Filter
} from 'lucide-react';

interface Integration {
  id: string;
  name: string;
  category: 'crm' | 'erp' | 'analytics' | 'communication' | 'security' | 'productivity' | 'financial';
  status: 'active' | 'inactive' | 'error' | 'pending';
  description: string;
  provider: string;
  version: string;
  lastSync: string;
  health: number;
  endpoints: number;
  dailyRequests: number;
  monthlyRequests: number;
  errorRate: number;
  responseTime: number;
  features: string[];
  configuration: {
    apiKey?: string;
    webhook?: string;
    syncFrequency: string;
    dataMapping: string[];
  };
}

interface APIEndpoint {
  id: string;
  name: string;
  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';
  path: string;
  description: string;
  integration: string;
  status: 'active' | 'deprecated' | 'maintenance';
  requests24h: number;
  averageResponse: number;
  successRate: number;
  lastCalled: string;
  authentication: 'api_key' | 'oauth' | 'jwt' | 'basic';
}

interface DataFlow {
  id: string;
  name: string;
  source: string;
  destination: string;
  type: 'real_time' | 'batch' | 'scheduled';
  frequency: string;
  status: 'running' | 'stopped' | 'error';
  lastRun: string;
  recordsProcessed: number;
  errorCount: number;
  transformations: string[];
}

export default function IntegrationHub() {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [searchTerm, setSearchTerm] = useState('');
  const [filterCategory, setFilterCategory] = useState('all');
  
  // Fetch connected integrations from API (use correct endpoint)
  const { data: connectedIntegrations, isLoading: integrationsLoading } = useQuery<any[]>({
    queryKey: ['/api/enterprise-integrations'],
  });
  
  // Safely access connected integrations with fallback
  const safeIntegrations = connectedIntegrations ?? [];
  
  // Local state for integrations (initialized from API or defaults)
  const [integrations, setIntegrations] = useState<Integration[]>([]);
  const [apiEndpoints, setApiEndpoints] = useState<APIEndpoint[]>([]);
  const [dataFlows, setDataFlows] = useState<DataFlow[]>([]);
  
  // Calculate system metrics from connected integrations
  const systemMetrics = {
    totalIntegrations: safeIntegrations.length > 0 ? safeIntegrations.length : 12,
    activeConnections: safeIntegrations.filter((i: any) => i?.status === 'connected').length || 12,
    dailyApiCalls: 89247,
    systemHealth: 96.4,
    dataFlows: 15,
    errorRate: 0.014
  };

  useEffect(() => {
    // Initialize integration data
    const integrationData: Integration[] = [
      {
        id: 'int-001',
        name: 'Salesforce CRM',
        category: 'crm',
        status: 'active',
        description: 'Customer relationship management and sales pipeline integration',
        provider: 'Salesforce',
        version: '59.0',
        lastSync: new Date(Date.now() - 300000).toISOString(),
        health: 98,
        endpoints: 47,
        dailyRequests: 8947,
        monthlyRequests: 234567,
        errorRate: 0.02,
        responseTime: 245,
        features: ['Contacts', 'Opportunities', 'Accounts', 'Reports', 'Real-time Sync'],
        configuration: {
          syncFrequency: 'real-time',
          dataMapping: ['contacts', 'opportunities', 'accounts', 'activities']
        }
      },
      {
        id: 'int-002',
        name: 'Microsoft 365',
        category: 'productivity',
        status: 'active',
        description: 'Office productivity suite and collaboration platform',
        provider: 'Microsoft',
        version: '2.0',
        lastSync: new Date(Date.now() - 180000).toISOString(),
        health: 95,
        endpoints: 32,
        dailyRequests: 12456,
        monthlyRequests: 345678,
        errorRate: 0.01,
        responseTime: 189,
        features: ['Email', 'Calendar', 'Teams', 'SharePoint', 'OneDrive'],
        configuration: {
          syncFrequency: '15 minutes',
          dataMapping: ['emails', 'calendar_events', 'documents', 'team_messages']
        }
      },
      {
        id: 'int-003',
        name: 'AWS Infrastructure',
        category: 'analytics',
        status: 'active',
        description: 'Cloud infrastructure monitoring and resource management',
        provider: 'Amazon Web Services',
        version: '3.1',
        lastSync: new Date(Date.now() - 120000).toISOString(),
        health: 99,
        endpoints: 78,
        dailyRequests: 15789,
        monthlyRequests: 456789,
        errorRate: 0.005,
        responseTime: 156,
        features: ['EC2', 'S3', 'RDS', 'CloudWatch', 'Lambda'],
        configuration: {
          syncFrequency: '5 minutes',
          dataMapping: ['metrics', 'logs', 'billing', 'resources']
        }
      },
      {
        id: 'int-004',
        name: 'Slack Communications',
        category: 'communication',
        status: 'active',
        description: 'Team communication and workflow automation',
        provider: 'Slack Technologies',
        version: '1.9',
        lastSync: new Date(Date.now() - 600000).toISOString(),
        health: 92,
        endpoints: 23,
        dailyRequests: 5678,
        monthlyRequests: 167890,
        errorRate: 0.04,
        responseTime: 298,
        features: ['Channels', 'Direct Messages', 'Workflows', 'Apps', 'File Sharing'],
        configuration: {
          syncFrequency: 'real-time',
          dataMapping: ['messages', 'channels', 'users', 'files']
        }
      },
      {
        id: 'int-005',
        name: 'Okta Identity',
        category: 'security',
        status: 'active',
        description: 'Identity and access management platform',
        provider: 'Okta',
        version: '2.3',
        lastSync: new Date(Date.now() - 240000).toISOString(),
        health: 97,
        endpoints: 34,
        dailyRequests: 3456,
        monthlyRequests: 98765,
        errorRate: 0.01,
        responseTime: 167,
        features: ['SSO', 'MFA', 'User Provisioning', 'Access Policies', 'Audit Logs'],
        configuration: {
          syncFrequency: '10 minutes',
          dataMapping: ['users', 'groups', 'applications', 'events']
        }
      },
      {
        id: 'int-006',
        name: 'QuickBooks Financial',
        category: 'financial',
        status: 'active',
        description: 'Financial data and accounting integration',
        provider: 'Intuit',
        version: '3.0',
        lastSync: new Date(Date.now() - 480000).toISOString(),
        health: 94,
        endpoints: 28,
        dailyRequests: 2789,
        monthlyRequests: 78901,
        errorRate: 0.02,
        responseTime: 234,
        features: ['Invoices', 'Payments', 'Expenses', 'Reports', 'Tax Tracking'],
        configuration: {
          syncFrequency: 'hourly',
          dataMapping: ['transactions', 'customers', 'vendors', 'items']
        }
      },
      {
        id: 'int-007',
        name: 'Jira Project Management',
        category: 'productivity',
        status: 'active',
        description: 'Agile project management and execution plan tracking',
        provider: 'Atlassian',
        version: '9.12',
        lastSync: new Date(Date.now() - 240000).toISOString(),
        health: 96,
        endpoints: 42,
        dailyRequests: 6543,
        monthlyRequests: 189234,
        errorRate: 0.015,
        responseTime: 198,
        features: ['Issues', 'Sprints', 'Boards', 'Workflows', 'Automation', 'Reports'],
        configuration: {
          syncFrequency: 'real-time',
          dataMapping: ['issues', 'projects', 'workflows', 'users', 'sprints']
        }
      },
      {
        id: 'int-008',
        name: 'Google Workspace',
        category: 'productivity',
        status: 'active',
        description: 'Google Calendar, Drive, Gmail integration for triggers and coordination',
        provider: 'Google',
        version: '3.0',
        lastSync: new Date(Date.now() - 180000).toISOString(),
        health: 97,
        endpoints: 38,
        dailyRequests: 9876,
        monthlyRequests: 287654,
        errorRate: 0.01,
        responseTime: 167,
        features: ['Calendar', 'Gmail', 'Drive', 'Docs', 'Sheets', 'Meet'],
        configuration: {
          syncFrequency: 'real-time',
          dataMapping: ['calendar_events', 'emails', 'documents', 'contacts']
        }
      },
      {
        id: 'int-009',
        name: 'HubSpot CRM',
        category: 'crm',
        status: 'active',
        description: 'Marketing automation and customer relationship management',
        provider: 'HubSpot',
        version: '2.1',
        lastSync: new Date(Date.now() - 360000).toISOString(),
        health: 93,
        endpoints: 35,
        dailyRequests: 5432,
        monthlyRequests: 156789,
        errorRate: 0.025,
        responseTime: 289,
        features: ['Contacts', 'Deals', 'Marketing', 'Sales', 'Automation', 'Analytics'],
        configuration: {
          syncFrequency: '15 minutes',
          dataMapping: ['contacts', 'companies', 'deals', 'tickets', 'campaigns']
        }
      },
      {
        id: 'int-010',
        name: 'ServiceNow ITSM',
        category: 'productivity',
        status: 'active',
        description: 'IT Service Management and workflow orchestration',
        provider: 'ServiceNow',
        version: 'Tokyo',
        lastSync: new Date(Date.now() - 420000).toISOString(),
        health: 95,
        endpoints: 52,
        dailyRequests: 4321,
        monthlyRequests: 123456,
        errorRate: 0.02,
        responseTime: 245,
        features: ['Incidents', 'Change Management', 'Asset Management', 'Workflows', 'CMDB'],
        configuration: {
          syncFrequency: '10 minutes',
          dataMapping: ['incidents', 'changes', 'assets', 'users', 'workflows']
        }
      },
      {
        id: 'int-011',
        name: 'Workday HCM',
        category: 'financial',
        status: 'active',
        description: 'Human capital management and financial planning integration',
        provider: 'Workday',
        version: '2024R1',
        lastSync: new Date(Date.now() - 540000).toISOString(),
        health: 94,
        endpoints: 41,
        dailyRequests: 3210,
        monthlyRequests: 92345,
        errorRate: 0.018,
        responseTime: 312,
        features: ['HR', 'Payroll', 'Planning', 'Analytics', 'Recruiting', 'Time Tracking'],
        configuration: {
          syncFrequency: 'hourly',
          dataMapping: ['employees', 'positions', 'financials', 'time_entries', 'benefits']
        }
      },
      {
        id: 'int-012',
        name: 'Microsoft Active Directory',
        category: 'security',
        status: 'active',
        description: 'Enterprise identity and access management',
        provider: 'Microsoft',
        version: '2019',
        lastSync: new Date(Date.now() - 150000).toISOString(),
        health: 99,
        endpoints: 29,
        dailyRequests: 12345,
        monthlyRequests: 356789,
        errorRate: 0.005,
        responseTime: 134,
        features: ['User Authentication', 'Group Policy', 'LDAP', 'SSO', 'Access Control'],
        configuration: {
          syncFrequency: '5 minutes',
          dataMapping: ['users', 'groups', 'organizational_units', 'policies']
        }
      }
    ];

    const endpointData: APIEndpoint[] = [
      {
        id: 'ep-001',
        name: 'Get Organization Metrics',
        method: 'GET',
        path: '/api/organizations/{id}/metrics',
        description: 'Retrieve comprehensive organizational performance metrics',
        integration: 'M Core',
        status: 'active',
        requests24h: 1247,
        averageResponse: 234,
        successRate: 99.2,
        lastCalled: new Date(Date.now() - 120000).toISOString(),
        authentication: 'jwt'
      },
      {
        id: 'ep-002',
        name: 'Sync Salesforce Contacts',
        method: 'POST',
        path: '/api/integrations/salesforce/sync',
        description: 'Synchronize contact data from Salesforce CRM',
        integration: 'Salesforce CRM',
        status: 'active',
        requests24h: 456,
        averageResponse: 567,
        successRate: 98.7,
        lastCalled: new Date(Date.now() - 300000).toISOString(),
        authentication: 'oauth'
      },
      {
        id: 'ep-003',
        name: 'AI Intelligence Generation',
        method: 'POST',
        path: '/api/ai/{module}/generate',
        description: 'Generate AI insights from specified intelligence module',
        integration: 'AI Intelligence',
        status: 'active',
        requests24h: 2789,
        averageResponse: 1234,
        successRate: 96.8,
        lastCalled: new Date(Date.now() - 60000).toISOString(),
        authentication: 'api_key'
      },
      {
        id: 'ep-004',
        name: 'Crisis Response Activation',
        method: 'POST',
        path: '/api/crisis/activate',
        description: 'Activate crisis response protocols and notifications',
        integration: 'Crisis Response',
        status: 'active',
        requests24h: 12,
        averageResponse: 345,
        successRate: 100,
        lastCalled: new Date(Date.now() - 3600000).toISOString(),
        authentication: 'jwt'
      }
    ];

    const flowData: DataFlow[] = [
      {
        id: 'flow-001',
        name: 'CRM to Analytics Pipeline',
        source: 'Salesforce CRM',
        destination: 'Executive Analytics',
        type: 'real_time',
        frequency: 'continuous',
        status: 'running',
        lastRun: new Date(Date.now() - 180000).toISOString(),
        recordsProcessed: 15678,
        errorCount: 2,
        transformations: ['data_cleansing', 'field_mapping', 'enrichment']
      },
      {
        id: 'flow-002',
        name: 'Financial Reporting Sync',
        source: 'QuickBooks Financial',
        destination: 'Strategic Planning',
        type: 'scheduled',
        frequency: 'daily at 9:00 AM',
        status: 'running',
        lastRun: new Date(Date.now() - 86400000).toISOString(),
        recordsProcessed: 892,
        errorCount: 0,
        transformations: ['currency_conversion', 'aggregation', 'categorization']
      },
      {
        id: 'flow-003',
        name: 'Security Event Stream',
        source: 'Okta Identity',
        destination: 'Audit Logging',
        type: 'real_time',
        frequency: 'continuous',
        status: 'running',
        lastRun: new Date(Date.now() - 60000).toISOString(),
        recordsProcessed: 3456,
        errorCount: 1,
        transformations: ['log_parsing', 'threat_scoring', 'correlation']
      }
    ];

    setIntegrations(integrationData);
    setApiEndpoints(endpointData);
    setDataFlows(flowData);
  }, []);

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'active': return 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30';
      case 'inactive': return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
      case 'error': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'pending': return 'bg-amber-500/20 text-amber-300 border-amber-500/30';
      case 'running': return 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30';
      case 'stopped': return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
      case 'deprecated': return 'bg-orange-500/20 text-orange-300 border-orange-500/30';
      case 'maintenance': return 'bg-amber-500/20 text-amber-300 border-amber-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const getCategoryColor = (category: string) => {
    switch (category) {
      case 'crm': return 'bg-blue-500/20 text-blue-300 border-blue-500/30';
      case 'erp': return 'bg-purple-500/20 text-purple-300 border-purple-500/30';
      case 'analytics': return 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30';
      case 'communication': return 'bg-pink-500/20 text-pink-300 border-pink-500/30';
      case 'security': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'productivity': return 'bg-amber-500/20 text-amber-300 border-amber-500/30';
      case 'financial': return 'bg-indigo-500/20 text-indigo-300 border-indigo-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const formatNumber = (num: number) => {
    return new Intl.NumberFormat('en-US').format(num);
  };

  const filteredIntegrations = integrations.filter((integration) => {
    const matchesSearch = integration.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         integration.description.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesCategory = filterCategory === 'all' || integration.category === filterCategory;
    
    return matchesSearch && matchesCategory;
  });

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-y-auto p-8 space-y-8">
        
        {/* Ecosystem Connectors Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-white mb-2">Ecosystem Connectors</h1>
            <p className="text-slate-300">Connect 10-15 enterprise systems to create platform lock-in and prohibitive switching costs</p>
          </div>
          <div className="flex items-center gap-4">
            <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">
              <Activity className="w-4 h-4 mr-2" />
              System Health: {systemMetrics.systemHealth}%
            </Badge>
            <Button className="bg-blue-600 hover:bg-blue-700">
              <Plus className="w-4 h-4 mr-2" />
              Add Integration
            </Button>
          </div>
        </div>

        {/* System Metrics */}
        <div className="grid grid-cols-1 md:grid-cols-6 gap-6">
          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Integrations</h3>
                <Globe className="h-5 w-5 text-blue-400" />
              </div>
              <div className="text-2xl font-bold text-white">{systemMetrics.totalIntegrations}</div>
              <div className="text-sm text-slate-400">Total connected</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Active</h3>
                <CheckCircle className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{systemMetrics.activeConnections}</div>
              <div className="text-sm text-slate-400">Connections live</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">API Calls</h3>
                <Zap className="h-5 w-5 text-purple-400" />
              </div>
              <div className="text-2xl font-bold text-white">{formatNumber(systemMetrics.dailyApiCalls)}</div>
              <div className="text-sm text-slate-400">Today</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Health</h3>
                <Activity className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{systemMetrics.systemHealth}%</div>
              <div className="text-sm text-slate-400">Overall status</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Data Flows</h3>
                <Database className="h-5 w-5 text-amber-400" />
              </div>
              <div className="text-2xl font-bold text-white">{systemMetrics.dataFlows}</div>
              <div className="text-sm text-slate-400">Active pipelines</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Error Rate</h3>
                <AlertTriangle className="h-5 w-5 text-red-400" />
              </div>
              <div className="text-2xl font-bold text-white">{(systemMetrics.errorRate * 100).toFixed(2)}%</div>
              <div className="text-sm text-slate-400">Last 24h</div>
            </CardContent>
          </Card>
        </div>

        {/* Main Integration Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="bg-slate-800/50 border border-slate-700/50">
            <TabsTrigger value="dashboard" className="data-[state=active]:bg-slate-700">Dashboard</TabsTrigger>
            <TabsTrigger value="integrations" className="data-[state=active]:bg-slate-700">Integrations</TabsTrigger>
            <TabsTrigger value="apis" className="data-[state=active]:bg-slate-700">API Endpoints</TabsTrigger>
            <TabsTrigger value="dataflows" className="data-[state=active]:bg-slate-700">Data Flows</TabsTrigger>
            <TabsTrigger value="monitoring" className="data-[state=active]:bg-slate-700">Monitoring</TabsTrigger>
          </TabsList>

          {/* Dashboard */}
          <TabsContent value="dashboard" className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              {/* Top Integrations */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <BarChart3 className="h-5 w-5" />
                    Top Performing Integrations
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  {integrations.slice(0, 5).map((integration) => (
                    <div key={integration.id} className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                      <div className="flex items-center gap-3">
                        <div className="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                          <Globe className="w-5 h-5 text-white" />
                        </div>
                        <div>
                          <div className="font-semibold text-white">{integration.name}</div>
                          <div className="text-xs text-slate-400">{formatNumber(integration.dailyRequests)} requests today</div>
                        </div>
                      </div>
                      <div className="text-right">
                        <div className="text-sm font-medium text-white">{integration.health}%</div>
                        <Badge className={getStatusColor(integration.status)}>
                          {integration.status}
                        </Badge>
                      </div>
                    </div>
                  ))}
                </CardContent>
              </Card>

              {/* Recent Activity */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Clock className="h-5 w-5" />
                    Recent API Activity
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  {apiEndpoints.slice(0, 5).map((endpoint) => (
                    <div key={endpoint.id} className="p-3 bg-slate-800/50 rounded-lg">
                      <div className="flex items-center justify-between mb-2">
                        <Badge className="bg-blue-500/20 text-blue-300 border-blue-500/30">
                          {endpoint.method}
                        </Badge>
                        <span className="text-xs text-slate-400">
                          {new Date(endpoint.lastCalled).toLocaleTimeString()}
                        </span>
                      </div>
                      <h4 className="font-semibold text-white text-sm mb-1">{endpoint.name}</h4>
                      <p className="text-slate-300 text-xs mb-2">{endpoint.path}</p>
                      <div className="flex justify-between text-xs text-slate-500">
                        <span>{formatNumber(endpoint.requests24h)} calls</span>
                        <span>{endpoint.averageResponse}ms avg</span>
                        <span>{endpoint.successRate}% success</span>
                      </div>
                    </div>
                  ))}
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Integrations */}
          <TabsContent value="integrations" className="space-y-6">
            
            {/* Filters */}
            <div className="flex items-center gap-4 bg-slate-900/50 p-4 rounded-lg border border-slate-700/50">
              <div className="flex-1 page-background relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400" />
                <Input
                  placeholder="Search integrations..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="pl-10 bg-slate-800 border-slate-600 text-white"
                />
              </div>
              <Select value={filterCategory} onValueChange={setFilterCategory}>
                <SelectTrigger className="w-48 bg-slate-800 border-slate-600 text-white">
                  <SelectValue placeholder="Category" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">All Categories</SelectItem>
                  <SelectItem value="crm">CRM</SelectItem>
                  <SelectItem value="erp">ERP</SelectItem>
                  <SelectItem value="analytics">Analytics</SelectItem>
                  <SelectItem value="communication">Communication</SelectItem>
                  <SelectItem value="security">Security</SelectItem>
                  <SelectItem value="productivity">Productivity</SelectItem>
                  <SelectItem value="financial">Financial</SelectItem>
                </SelectContent>
              </Select>
            </div>

            {/* Integrations Grid */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {filteredIntegrations.map((integration) => (
                <Card key={integration.id} className="bg-slate-900/50 border-slate-700/50 hover:bg-slate-800/50 transition-all duration-300">
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-white flex items-center gap-3">
                        <div className="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                          <Globe className="w-5 h-5 text-white" />
                        </div>
                        {integration.name}
                      </CardTitle>
                      <div className="flex items-center gap-2">
                        <Badge className={getStatusColor(integration.status)}>
                          {integration.status.toUpperCase()}
                        </Badge>
                        <Badge className={getCategoryColor(integration.category)}>
                          {integration.category.toUpperCase()}
                        </Badge>
                      </div>
                    </div>
                    <p className="text-slate-400 text-sm">{integration.description}</p>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    
                    {/* Metrics */}
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <div className="text-slate-400">Health</div>
                        <div className="text-white font-medium">{integration.health}%</div>
                      </div>
                      <div>
                        <div className="text-slate-400">Response Time</div>
                        <div className="text-white font-medium">{integration.responseTime}ms</div>
                      </div>
                      <div>
                        <div className="text-slate-400">Daily Requests</div>
                        <div className="text-white font-medium">{formatNumber(integration.dailyRequests)}</div>
                      </div>
                      <div>
                        <div className="text-slate-400">Error Rate</div>
                        <div className="text-white font-medium">{(integration.errorRate * 100).toFixed(2)}%</div>
                      </div>
                    </div>

                    {/* Features */}
                    <div>
                      <div className="text-sm font-semibold text-white mb-2">Features</div>
                      <div className="flex flex-wrap gap-2">
                        {integration.features.slice(0, 3).map((feature, index) => (
                          <Badge key={index} variant="outline" className="border-slate-600 text-slate-300 text-xs">
                            {feature}
                          </Badge>
                        ))}
                        {integration.features.length > 3 && (
                          <Badge variant="outline" className="border-slate-600 text-slate-300 text-xs">
                            +{integration.features.length - 3} more
                          </Badge>
                        )}
                      </div>
                    </div>
                    
                    <div className="flex gap-2">
                      <Button size="sm" className="flex-1 bg-blue-600 hover:bg-blue-700">
                        <Settings className="w-4 h-4 mr-2" />
                        Configure
                      </Button>
                      <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <Monitor className="w-4 h-4" />
                      </Button>
                      <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <FileText className="w-4 h-4" />
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* API Endpoints */}
          <TabsContent value="apis" className="space-y-6">
            <Card className="bg-slate-900/50 border-slate-700/50">
              <CardContent className="p-0">
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead className="bg-slate-800/50 border-b border-slate-700">
                      <tr>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Endpoint</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Method</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Integration</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Requests (24h)</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Success Rate</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Avg Response</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Status</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-700">
                      {apiEndpoints.map((endpoint) => (
                        <tr key={endpoint.id} className="hover:bg-slate-800/30">
                          <td className="px-6 py-4">
                            <div>
                              <div className="text-sm font-medium text-white">{endpoint.name}</div>
                              <div className="text-xs text-slate-400 font-mono">{endpoint.path}</div>
                            </div>
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap">
                            <Badge className="bg-blue-500/20 text-blue-300 border-blue-500/30">
                              {endpoint.method}
                            </Badge>
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-white">
                            {endpoint.integration}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-white">
                            {formatNumber(endpoint.requests24h)}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm">
                            <span className={`${endpoint.successRate >= 99 ? 'text-emerald-400' : endpoint.successRate >= 95 ? 'text-amber-400' : 'text-red-400'}`}>
                              {endpoint.successRate}%
                            </span>
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-white">
                            {endpoint.averageResponse}ms
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap">
                            <Badge className={getStatusColor(endpoint.status)}>
                              {endpoint.status}
                            </Badge>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Data Flows */}
          <TabsContent value="dataflows" className="space-y-6">
            <div className="space-y-4">
              {dataFlows.map((flow) => (
                <Card key={flow.id} className="bg-slate-900/50 border-slate-700/50">
                  <CardContent className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex-1 page-background">
                        <div className="flex items-center gap-3 mb-2">
                          <h3 className="text-lg font-semibold text-white">{flow.name}</h3>
                          <Badge className={getStatusColor(flow.status)}>
                            {flow.status.toUpperCase()}
                          </Badge>
                          <Badge variant="outline" className="border-slate-600 text-slate-300">
                            {flow.type.replace('_', ' ').toUpperCase()}
                          </Badge>
                        </div>
                        <div className="flex items-center gap-4 text-sm text-slate-300">
                          <div className="flex items-center gap-2">
                            <Database className="w-4 h-4 text-blue-400" />
                            {flow.source}
                          </div>
                          <div></div>
                          <div className="flex items-center gap-2">
                            <Database className="w-4 h-4 text-emerald-400" />
                            {flow.destination}
                          </div>
                        </div>
                      </div>
                      <div className="text-right">
                        <div className="text-sm text-slate-400">Records Processed</div>
                        <div className="text-2xl font-bold text-white">{formatNumber(flow.recordsProcessed)}</div>
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                      <div>
                        <div className="text-sm text-slate-400">Frequency</div>
                        <div className="text-white font-medium">{flow.frequency}</div>
                      </div>
                      <div>
                        <div className="text-sm text-slate-400">Last Run</div>
                        <div className="text-white font-medium">{new Date(flow.lastRun).toLocaleString()}</div>
                      </div>
                      <div>
                        <div className="text-sm text-slate-400">Error Count</div>
                        <div className={`font-medium ${flow.errorCount === 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                          {flow.errorCount}
                        </div>
                      </div>
                      <div>
                        <div className="text-sm text-slate-400">Transformations</div>
                        <div className="text-white font-medium">{flow.transformations.length}</div>
                      </div>
                    </div>
                    
                    <div className="mt-4 flex gap-3">
                      <Button size="sm" className="bg-blue-600 hover:bg-blue-700">
                        <Monitor className="w-4 h-4 mr-2" />
                        Monitor
                      </Button>
                      <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <Settings className="w-4 h-4 mr-2" />
                        Configure
                      </Button>
                      <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        {flow.status === 'running' ? <Pause className="w-4 h-4" /> : <Play className="w-4 h-4" />}
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Monitoring */}
          <TabsContent value="monitoring" className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Uptime</h3>
                    <Activity className="h-5 w-5 text-emerald-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">99.9%</div>
                  <div className="text-sm text-slate-400">Last 30 days</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Throughput</h3>
                    <Zap className="h-5 w-5 text-blue-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">1.2K/s</div>
                  <div className="text-sm text-slate-400">Requests per second</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Latency</h3>
                    <Clock className="h-5 w-5 text-purple-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">234ms</div>
                  <div className="text-sm text-slate-400">P95 response time</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Data Volume</h3>
                    <Database className="h-5 w-5 text-amber-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">2.3TB</div>
                  <div className="text-sm text-slate-400">Processed today</div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/IntegrationsPage.tsx
========================================
import { useState } from "react";
import { useQuery, useMutation } from "@tanstack/react-query";
import PageLayout from "@/components/layout/PageLayout";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { queryClient, apiRequest } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";
import { 
  Cloud, 
  CheckCircle2, 
  Circle, 
  AlertCircle,
  Settings,
  Zap,
  MessageSquare,
  Calendar,
  Users,
  FileText,
  Database
} from "lucide-react";

interface Integration {
  id: string;
  name: string;
  vendor: string;
  category: string;
  description: string;
  capabilities: string[];
  logo: string;
  status: 'available' | 'coming_soon';
}

interface ConnectedIntegration {
  id: string;
  name: string;
  integrationType: string;
  vendor: string;
  status: string;
  lastSyncAt: string | null;
  createdAt: string;
}

const categoryIcons = {
  project_management: FileText,
  communication: MessageSquare,
  scheduling: Calendar,
  directory: Users,
  crm: Database,
};

const categoryColors = {
  project_management: "bg-blue-500/10 text-blue-600 dark:text-blue-400",
  communication: "bg-purple-500/10 text-purple-600 dark:text-purple-400",
  scheduling: "bg-green-500/10 text-green-600 dark:text-green-400",
  directory: "bg-orange-500/10 text-orange-600 dark:text-orange-400",
  crm: "bg-pink-500/10 text-pink-600 dark:text-pink-400",
};

export default function IntegrationsPage() {
  const { toast } = useToast();
  const [selectedIntegration, setSelectedIntegration] = useState<Integration | null>(null);
  const [isConnecting, setIsConnecting] = useState(false);
  const [connectionConfig, setConnectionConfig] = useState({
    apiKey: '',
    apiUrl: '',
  });

  // Get organization ID from user context
  const organizationId = "demo-org-1";

  // Fetch available integrations from marketplace
  const { data: marketplaceData } = useQuery<Integration[]>({
    queryKey: ['/api/integrations/marketplace'],
  });
  const marketplace = marketplaceData ?? [];

  // Fetch connected integrations
  const { data: connectedData } = useQuery<ConnectedIntegration[]>({
    queryKey: ['/api/integrations/enterprise', organizationId],
  });
  const connectedIntegrations = connectedData ?? [];

  // Connect integration mutation
  const connectMutation = useMutation({
    mutationFn: async (integration: Integration) => {
      return await apiRequest('POST', '/api/integrations/enterprise/connect', {
        organizationId,
        name: integration.name,
        integrationType: integration.category,
        vendor: integration.vendor,
        credentials: {
          type: 'api_key',
          data: {
            api_key: connectionConfig.apiKey,
            api_url: connectionConfig.apiUrl,
          },
        },
      });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/integrations/enterprise', organizationId] });
      toast({
        title: "Integration Connected",
        description: `${selectedIntegration?.name} has been successfully connected.`,
      });
      setSelectedIntegration(null);
      setConnectionConfig({ apiKey: '', apiUrl: '' });
    },
    onError: (error: Error) => {
      toast({
        title: "Connection Failed",
        description: error.message,
        variant: "destructive",
      });
    },
  });

  // Disconnect integration mutation
  const disconnectMutation = useMutation({
    mutationFn: async (integrationId: string) => {
      return await apiRequest('POST', `/api/integrations/enterprise/${integrationId}/disconnect`, {});
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/integrations/enterprise', organizationId] });
      toast({
        title: "Integration Disconnected",
        description: "The integration has been disconnected successfully.",
      });
    },
  });

  const isConnected = (integrationId: string) => {
    return connectedIntegrations.some(ci => ci.vendor === integrationId);
  };

  const getConnectedIntegration = (integrationId: string) => {
    return connectedIntegrations.find(ci => ci.vendor === integrationId);
  };

  const handleConnect = (integration: Integration) => {
    setSelectedIntegration(integration);
    setIsConnecting(true);
  };

  const handleDisconnect = (integrationId: string) => {
    const connected = connectedIntegrations.find(ci => ci.id === integrationId);
    if (connected) {
      disconnectMutation.mutate(connected.id);
    }
  };

  const handleSubmitConnection = () => {
    if (selectedIntegration) {
      connectMutation.mutate(selectedIntegration);
    }
  };

  return (
    <PageLayout>
      <div className="space-y-8">
        {/* Header */}
        <div>
          <Badge className="mb-4 bg-blue-500/20 text-blue-600 dark:text-blue-400 border-blue-500/30">
            Enterprise Integrations
          </Badge>
          <h1 className="text-3xl font-bold tracking-tight text-gray-900 dark:text-white">
            M Orchestrates Your Stack
          </h1>
          <p className="mt-2 text-lg text-gray-600 dark:text-gray-400">
            M doesn't replace your workflow tools  it coordinates them. When a playbook 
            activates, M tells each system exactly what to do.
          </p>
        </div>

        {/* Integration Philosophy */}
        <div className="grid md:grid-cols-3 gap-6">
          <Card className="p-6 text-center">
            <div className="w-12 h-12 mx-auto mb-4 bg-blue-500/20 rounded-xl flex items-center justify-center">
              <Zap className="w-6 h-6 text-blue-500" />
            </div>
            <h3 className="font-semibold text-gray-900 dark:text-white mb-2">M Orchestrates</h3>
            <p className="text-sm text-gray-600 dark:text-gray-400">Strategic playbooks trigger coordinated actions across your entire stack</p>
          </Card>
          <Card className="p-6 text-center">
            <div className="w-12 h-12 mx-auto mb-4 bg-purple-500/20 rounded-xl flex items-center justify-center">
              <Database className="w-6 h-6 text-purple-500" />
            </div>
            <h3 className="font-semibold text-gray-900 dark:text-white mb-2">Tools Execute</h3>
            <p className="text-sm text-gray-600 dark:text-gray-400">ServiceNow, Jira, Slack, and Teams carry out the operational work</p>
          </Card>
          <Card className="p-6 text-center">
            <div className="w-12 h-12 mx-auto mb-4 bg-emerald-500/20 rounded-xl flex items-center justify-center">
              <CheckCircle2 className="w-6 h-6 text-emerald-500" />
            </div>
            <h3 className="font-semibold text-gray-900 dark:text-white mb-2">Everything Syncs</h3>
            <p className="text-sm text-gray-600 dark:text-gray-400">Bi-directional updates keep M and your tools in perfect alignment</p>
          </Card>
        </div>

        {/* Stats */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          <Card className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">Connected</p>
                <p className="text-2xl font-bold text-gray-900 dark:text-white">
                  {connectedIntegrations.filter(i => i.status === 'active').length}
                </p>
              </div>
              <div className="w-12 h-12 bg-green-500/10 rounded-lg flex items-center justify-center">
                <CheckCircle2 className="w-6 h-6 text-green-600 dark:text-green-400" />
              </div>
            </div>
          </Card>

          <Card className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">Available</p>
                <p className="text-2xl font-bold text-gray-900 dark:text-white">
                  {marketplace.filter(i => i.status === 'available').length}
                </p>
              </div>
              <div className="w-12 h-12 bg-blue-500/10 rounded-lg flex items-center justify-center">
                <Cloud className="w-6 h-6 text-blue-600 dark:text-blue-400" />
              </div>
            </div>
          </Card>

          <Card className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">Coming Soon</p>
                <p className="text-2xl font-bold text-gray-900 dark:text-white">
                  {marketplace.filter(i => i.status === 'coming_soon').length}
                </p>
              </div>
              <div className="w-12 h-12 bg-gray-500/10 rounded-lg flex items-center justify-center">
                <Zap className="w-6 h-6 text-gray-600 dark:text-gray-400" />
              </div>
            </div>
          </Card>
        </div>

        {/* Integration Categories */}
        <Tabs defaultValue="all" className="w-full">
          <TabsList className="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800">
            <TabsTrigger value="all" data-testid="tab-all">All Integrations</TabsTrigger>
            <TabsTrigger value="connected" data-testid="tab-connected">Connected</TabsTrigger>
            <TabsTrigger value="available" data-testid="tab-available">Available</TabsTrigger>
          </TabsList>

          <TabsContent value="all" className="mt-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {marketplace.map((integration) => {
                const connected = isConnected(integration.id);
                const connectedData = getConnectedIntegration(integration.id);
                const Icon = categoryIcons[integration.category as keyof typeof categoryIcons];
                const colorClass = categoryColors[integration.category as keyof typeof categoryColors];

                return (
                  <Card key={integration.id} className="p-6 hover:shadow-lg transition-shadow" data-testid={`card-integration-${integration.id}`}>
                    <div className="flex items-start justify-between mb-4">
                      <div className={`w-12 h-12 rounded-lg flex items-center justify-center ${colorClass}`}>
                        {Icon && <Icon className="w-6 h-6" />}
                      </div>
                      {connected ? (
                        <Badge variant="outline" className="bg-green-500/10 text-green-600 dark:text-green-400 border-green-500/20">
                          <CheckCircle2 className="w-3 h-3 mr-1" />
                          Connected
                        </Badge>
                      ) : integration.status === 'coming_soon' ? (
                        <Badge variant="outline" className="bg-gray-500/10 text-gray-600 dark:text-gray-400 border-gray-500/20">
                          Coming Soon
                        </Badge>
                      ) : (
                        <Badge variant="outline" className="bg-blue-500/10 text-blue-600 dark:text-blue-400 border-blue-500/20">
                          <Circle className="w-3 h-3 mr-1" />
                          Available
                        </Badge>
                      )}
                    </div>

                    <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                      {integration.name}
                    </h3>
                    <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">
                      {integration.description}
                    </p>

                    <div className="flex flex-wrap gap-2 mb-4">
                      {integration.capabilities.slice(0, 3).map((capability) => (
                        <Badge key={capability} variant="secondary" className="text-xs">
                          {capability.replace(/_/g, ' ')}
                        </Badge>
                      ))}
                    </div>

                    {connected ? (
                      <div className="space-y-2">
                        <div className="flex items-center justify-between text-xs text-gray-600 dark:text-gray-400">
                          <span>Status:</span>
                          <span className="font-medium">{connectedData?.status}</span>
                        </div>
                        <div className="flex gap-2">
                          <Button
                            size="sm"
                            variant="outline"
                            className="flex-1"
                            data-testid={`button-settings-${integration.id}`}
                          >
                            <Settings className="w-4 h-4 mr-1" />
                            Settings
                          </Button>
                          <Button
                            size="sm"
                            variant="outline"
                            onClick={() => connectedData && handleDisconnect(connectedData.id)}
                            data-testid={`button-disconnect-${integration.id}`}
                          >
                            Disconnect
                          </Button>
                        </div>
                      </div>
                    ) : integration.status === 'available' ? (
                      <Button
                        className="w-full"
                        onClick={() => handleConnect(integration)}
                        data-testid={`button-connect-${integration.id}`}
                      >
                        <Zap className="w-4 h-4 mr-2" />
                        Connect
                      </Button>
                    ) : (
                      <Button className="w-full" disabled data-testid={`button-coming-soon-${integration.id}`}>
                        Coming Soon
                      </Button>
                    )}
                  </Card>
                );
              })}
            </div>
          </TabsContent>

          <TabsContent value="connected" className="mt-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {marketplace.filter(i => isConnected(i.id)).map((integration) => {
                const Icon = categoryIcons[integration.category as keyof typeof categoryIcons];
                const colorClass = categoryColors[integration.category as keyof typeof categoryColors];
                const connectedData = getConnectedIntegration(integration.id);

                return (
                  <Card key={integration.id} className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <div className={`w-12 h-12 rounded-lg flex items-center justify-center ${colorClass}`}>
                        {Icon && <Icon className="w-6 h-6" />}
                      </div>
                      <Badge variant="outline" className="bg-green-500/10 text-green-600 dark:text-green-400 border-green-500/20">
                        <CheckCircle2 className="w-3 h-3 mr-1" />
                        Active
                      </Badge>
                    </div>

                    <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                      {integration.name}
                    </h3>
                    <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">
                      {integration.description}
                    </p>

                    <div className="flex gap-2">
                      <Button size="sm" variant="outline" className="flex-1">
                        <Settings className="w-4 h-4 mr-1" />
                        Settings
                      </Button>
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => connectedData && handleDisconnect(connectedData.id)}
                      >
                        Disconnect
                      </Button>
                    </div>
                  </Card>
                );
              })}
            </div>
          </TabsContent>

          <TabsContent value="available" className="mt-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {marketplace.filter(i => !isConnected(i.id) && i.status === 'available').map((integration) => {
                const Icon = categoryIcons[integration.category as keyof typeof categoryIcons];
                const colorClass = categoryColors[integration.category as keyof typeof categoryColors];

                return (
                  <Card key={integration.id} className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <div className={`w-12 h-12 rounded-lg flex items-center justify-center ${colorClass}`}>
                        {Icon && <Icon className="w-6 h-6" />}
                      </div>
                      <Badge variant="outline" className="bg-blue-500/10 text-blue-600 dark:text-blue-400 border-blue-500/20">
                        Available
                      </Badge>
                    </div>

                    <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                      {integration.name}
                    </h3>
                    <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">
                      {integration.description}
                    </p>

                    <Button className="w-full" onClick={() => handleConnect(integration)}>
                      <Zap className="w-4 h-4 mr-2" />
                      Connect
                    </Button>
                  </Card>
                );
              })}
            </div>
          </TabsContent>
        </Tabs>

        {/* Connection Dialog */}
        <Dialog open={isConnecting} onOpenChange={setIsConnecting}>
          <DialogContent data-testid="dialog-connection">
            <DialogHeader>
              <DialogTitle>Connect {selectedIntegration?.name}</DialogTitle>
              <DialogDescription>
                Enter your credentials to connect {selectedIntegration?.name} to M.
              </DialogDescription>
            </DialogHeader>

            <div className="space-y-4">
              <div>
                <Label htmlFor="apiKey">API Key</Label>
                <Input
                  id="apiKey"
                  placeholder="Enter your API key"
                  value={connectionConfig.apiKey}
                  onChange={(e) => setConnectionConfig({ ...connectionConfig, apiKey: e.target.value })}
                  data-testid="input-api-key"
                />
              </div>

              <div>
                <Label htmlFor="apiUrl">API URL (optional)</Label>
                <Input
                  id="apiUrl"
                  placeholder="https://api.example.com"
                  value={connectionConfig.apiUrl}
                  onChange={(e) => setConnectionConfig({ ...connectionConfig, apiUrl: e.target.value })}
                  data-testid="input-api-url"
                />
              </div>

              <div className="bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                <div className="flex items-start gap-3">
                  <AlertCircle className="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5" />
                  <div className="text-sm text-blue-800 dark:text-blue-300">
                    <p className="font-medium mb-1">Secure Connection</p>
                    <p>Your credentials are encrypted and stored securely. They are only used to authenticate with {selectedIntegration?.name}.</p>
                  </div>
                </div>
              </div>
            </div>

            <DialogFooter>
              <Button variant="outline" onClick={() => setIsConnecting(false)} data-testid="button-cancel">
                Cancel
              </Button>
              <Button
                onClick={handleSubmitConnection}
                disabled={!connectionConfig.apiKey || connectMutation.isPending}
                data-testid="button-connect-submit"
              >
                {connectMutation.isPending ? 'Connecting...' : 'Connect'}
              </Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/IntelligenceControlCenter.tsx
========================================
import { useEffect, useState } from 'react';
import { Link } from 'wouter';
import StandardNav from '@/components/layout/StandardNav';
import Footer from '@/components/layout/Footer';
import { updatePageMetadata } from '@/lib/seo';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Button } from '@/components/ui/button';
import { useQuery } from '@tanstack/react-query';
import { 
  Radio, 
  Brain, 
  Activity, 
  Zap, 
  Target, 
  Users, 
  Sparkles,
  Bell,
  Settings,
  BarChart3,
  TrendingUp,
  AlertCircle,
  CheckCircle,
  Eye,
  Layers,
  ChevronRight,
  Clock,
  ArrowRight
} from 'lucide-react';

export default function IntelligenceControlCenter() {
  const [activeTab, setActiveTab] = useState('overview');

  useEffect(() => {
    updatePageMetadata({
      title: "Intelligence Control Center - M Strategic Execution OS",
      description: "Monitor 92+ data points across 16 signal categories. AI-powered pattern detection, trigger management, and strategic intelligence.",
      ogTitle: "M Intelligence Control Center",
      ogDescription: "Real-time strategic intelligence with AI-powered pattern detection and 12-minute response coordination.",
    });
  }, []);

  const { data: dynamicStatus } = useQuery<{
    readinessScore: number;
    activeScenarios: number;
    weakSignalsDetected: number;
    oraclePatternsActive: number;
  }>({
    queryKey: ['/api/dynamic-strategy/status'],
  });

  const intelligenceModules = [
    {
      id: 'ai-hub',
      title: 'AI Intelligence Hub',
      description: '5 AI co-pilots for strategic decision-making',
      path: '/ai',
      icon: Brain,
      color: 'purple',
      status: 'active',
      features: ['Pulse Intelligence', 'Flux Adaptations', 'Prism Insights', 'Echo Analytics', 'Nova Innovations'],
      badge: '5 MODULES'
    },
    {
      id: 'signal-hub',
      title: 'Signal Intelligence',
      description: 'Configure triggers and monitor data points',
      path: '/signal-intelligence',
      icon: Radio,
      color: 'blue',
      status: 'active',
      features: ['16 Signal Categories', '92+ Data Points', 'Custom Triggers', 'Alert Management'],
      badge: '92 DATA POINTS'
    },
    {
      id: 'foresight-radar',
      title: 'Foresight Radar',
      description: 'Visual intelligence scanning and pattern detection',
      path: '/foresight-radar',
      icon: Eye,
      color: 'cyan',
      status: 'active',
      features: ['Radar Visualization', 'Trend Detection', 'Early Warning System'],
      badge: 'REAL-TIME'
    },
    {
      id: 'triggers',
      title: 'Trigger Management',
      description: 'Create and manage automated triggers',
      path: '/triggers-management',
      icon: Bell,
      color: 'amber',
      status: 'active',
      features: ['Trigger Templates', 'Condition Builder', 'Playbook Mapping'],
      badge: 'CONFIGURE'
    },
  ];

  const getColorClasses = (color: string) => {
    const colors: Record<string, { bg: string; border: string; text: string; badge: string }> = {
      purple: { bg: 'from-purple-950/40 to-slate-950/40', border: 'border-purple-500/30 hover:border-purple-500/50', text: 'text-purple-400', badge: 'bg-purple-500/10 text-purple-300 border-purple-500/30' },
      blue: { bg: 'from-blue-950/40 to-slate-950/40', border: 'border-blue-500/30 hover:border-blue-500/50', text: 'text-blue-400', badge: 'bg-blue-500/10 text-blue-300 border-blue-500/30' },
      cyan: { bg: 'from-cyan-950/40 to-slate-950/40', border: 'border-cyan-500/30 hover:border-cyan-500/50', text: 'text-cyan-400', badge: 'bg-cyan-500/10 text-cyan-300 border-cyan-500/30' },
      amber: { bg: 'from-amber-950/40 to-slate-950/40', border: 'border-amber-500/30 hover:border-amber-500/50', text: 'text-amber-400', badge: 'bg-amber-500/10 text-amber-300 border-amber-500/30' },
      green: { bg: 'from-green-950/40 to-slate-950/40', border: 'border-green-500/30 hover:border-green-500/50', text: 'text-green-400', badge: 'bg-green-500/10 text-green-300 border-green-500/30' },
    };
    return colors[color] || colors.blue;
  };

  return (
    <div className="min-h-screen bg-slate-950" data-testid="intelligence-control-center">
      <StandardNav />
      
      <div className="max-w-7xl mx-auto px-6 py-8 space-y-8">
        {/* Header */}
        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <div className="flex items-center gap-3 mb-2">
              <div className="p-2 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg">
                <Radio className="h-5 w-5 text-white" />
              </div>
              <h1 className="text-2xl font-bold text-white" data-testid="page-title">Intelligence Control Center</h1>
            </div>
            <p className="text-slate-400">Real-time strategic intelligence and AI-powered pattern detection</p>
          </div>
          
          <div className="flex items-center gap-3">
            <Badge variant="outline" className="bg-green-500/10 text-green-300 border-green-500/30 px-3 py-1">
              <div className="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse" />
              All Systems Online
            </Badge>
          </div>
        </div>

        {/* Quick Stats */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4" data-testid="grid-quick-stats">
          <Card className="bg-slate-900/50 border-slate-800" data-testid="stat-data-points">
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-slate-400">Data Points Monitored</p>
                  <p className="text-2xl font-bold text-white" data-testid="value-data-points">92+</p>
                </div>
                <Activity className="h-8 w-8 text-blue-400 opacity-50" />
              </div>
            </CardContent>
          </Card>
          <Card className="bg-slate-900/50 border-slate-800" data-testid="stat-signal-categories">
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-slate-400">Signal Categories</p>
                  <p className="text-2xl font-bold text-white" data-testid="value-signal-categories">16</p>
                </div>
                <Layers className="h-8 w-8 text-purple-400 opacity-50" />
              </div>
            </CardContent>
          </Card>
          <Card className="bg-slate-900/50 border-slate-800" data-testid="stat-weak-signals">
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-slate-400">Weak Signals</p>
                  <p className="text-2xl font-bold text-white" data-testid="value-weak-signals">{dynamicStatus?.weakSignalsDetected ?? 0}</p>
                </div>
                <AlertCircle className="h-8 w-8 text-amber-400 opacity-50" />
              </div>
            </CardContent>
          </Card>
          <Card className="bg-slate-900/50 border-slate-800" data-testid="stat-active-patterns">
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-slate-400">Active Patterns</p>
                  <p className="text-2xl font-bold text-white">{dynamicStatus?.oraclePatternsActive ?? 0}</p>
                </div>
                <TrendingUp className="h-8 w-8 text-green-400 opacity-50" />
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Intelligence Modules Grid */}
        <div className="space-y-4" data-testid="section-modules">
          <h2 className="text-lg font-semibold text-white flex items-center gap-2">
            <Brain className="h-5 w-5 text-purple-400" />
            Intelligence Modules
          </h2>
          <div className="grid md:grid-cols-2 gap-4" data-testid="grid-modules">
            {intelligenceModules.map(module => {
              const colors = getColorClasses(module.color);
              const Icon = module.icon;
              return (
                <Link key={module.id} href={module.path} data-testid={`link-module-${module.id}`}>
                  <Card className={`${colors.border} bg-gradient-to-br ${colors.bg} transition-all cursor-pointer h-full`} data-testid={`card-module-${module.id}`}>
                    <CardHeader className="pb-3">
                      <div className="flex items-start justify-between">
                        <div className="flex items-center gap-3">
                          <div className={`p-2 ${colors.text.replace('text-', 'bg-')}/10 rounded-lg`}>
                            <Icon className={`h-6 w-6 ${colors.text}`} />
                          </div>
                          <div>
                            <CardTitle className="text-lg text-white">{module.title}</CardTitle>
                            <CardDescription className="text-slate-400 text-sm">
                              {module.description}
                            </CardDescription>
                          </div>
                        </div>
                        {module.badge && (
                          <Badge variant="outline" className={colors.badge}>
                            {module.badge}
                          </Badge>
                        )}
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center justify-between">
                        <div className="flex flex-wrap gap-2">
                          {module.features.slice(0, 3).map((feature, idx) => (
                            <span key={idx} className="text-xs text-slate-500 bg-slate-800/50 px-2 py-1 rounded">
                              {feature}
                            </span>
                          ))}
                        </div>
                        <ChevronRight className="h-5 w-5 text-slate-500" />
                      </div>
                    </CardContent>
                  </Card>
                </Link>
              );
            })}
          </div>
        </div>

        {/* Quick Actions */}
        <div className="grid md:grid-cols-3 gap-4 pt-4" data-testid="section-quick-actions">
          <Link href="/ai" data-testid="link-ai-copilots">
            <Card className="bg-slate-900/50 border-slate-700 hover:border-purple-500/50 transition-all cursor-pointer" data-testid="card-ai-copilots">
              <CardContent className="p-4 flex items-center gap-4">
                <div className="p-2 bg-purple-500/10 rounded-lg">
                  <Brain className="h-5 w-5 text-purple-400" />
                </div>
                <div className="flex-1">
                  <p className="font-medium text-white">Launch AI Co-Pilots</p>
                  <p className="text-sm text-slate-400">Strategic decision support</p>
                </div>
                <ArrowRight className="h-4 w-4 text-slate-500" />
              </CardContent>
            </Card>
          </Link>
          
          <Link href="/signal-intelligence" data-testid="link-configure-signals">
            <Card className="bg-slate-900/50 border-slate-700 hover:border-blue-500/50 transition-all cursor-pointer" data-testid="card-configure-signals">
              <CardContent className="p-4 flex items-center gap-4">
                <div className="p-2 bg-blue-500/10 rounded-lg">
                  <Radio className="h-5 w-5 text-blue-400" />
                </div>
                <div className="flex-1">
                  <p className="font-medium text-white">Configure Signals</p>
                  <p className="text-sm text-slate-400">Manage data sources</p>
                </div>
                <ArrowRight className="h-4 w-4 text-slate-500" />
              </CardContent>
            </Card>
          </Link>
          
          <Link href="/triggers-management" data-testid="link-manage-triggers">
            <Card className="bg-slate-900/50 border-slate-700 hover:border-amber-500/50 transition-all cursor-pointer" data-testid="card-manage-triggers">
              <CardContent className="p-4 flex items-center gap-4">
                <div className="p-2 bg-amber-500/10 rounded-lg">
                  <Bell className="h-5 w-5 text-amber-400" />
                </div>
                <div className="flex-1">
                  <p className="font-medium text-white">Set Up Triggers</p>
                  <p className="text-sm text-slate-400">Automate responses</p>
                </div>
                <ArrowRight className="h-4 w-4 text-slate-500" />
              </CardContent>
            </Card>
          </Link>
        </div>
      </div>

      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/InvestorDemo.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { 
  Play, 
  Pause, 
  RotateCcw, 
  Clock, 
  Users, 
  CheckCircle2, 
  AlertTriangle,
  Zap,
  ArrowRight,
  Target,
  Shield,
  TrendingUp,
  DollarSign,
  SkipForward,
  ChevronRight,
  BookOpen,
  FileCheck,
  Radar,
  Settings,
  Globe,
  Scale,
  Building2,
  Briefcase,
  Lock,
  GitBranch,
  Layers,
  Brain,
  LineChart
} from 'lucide-react';
import { useLocation } from 'wouter';
import StandardNav from '@/components/layout/StandardNav';
import Footer from '@/components/layout/Footer';
import { motion, AnimatePresence } from 'framer-motion';
import Confetti from 'react-confetti';

const DEMO_DURATION = 180;

const IDEA_STORY = [
  {
    id: 1,
    beat: "THE GAP",
    title: "The $270M-$900M Problem",
    subtitle: "Why 30% of strategy value is lost in execution",
    phase: "PROBLEM",
    phaseColor: "bg-red-500",
    icon: AlertTriangle,
    color: "text-red-400",
    bgColor: "bg-red-500/20",
    time: 0,
    description: "McKinsey research: Even high-performing companies lose 30% of their strategy's value in execution. For Fortune 500, that's $270M-$900M annually. The gap isn't intelligenceit's coordination. When a strategic event hits, teams spend 20-50 hours just getting organized.",
    investorHighlight: "This is a $15B+ market opportunity. No one owns the execution layer between strategy consulting and project management.",
    metrics: [
      { label: "Value Lost", value: "30%" },
      { label: "Fortune 500 Impact", value: "$270M-$900M" },
      { label: "Time to Organize", value: "20-50 hrs" }
    ],
    smartDefaults: null,
    pmSync: null
  },
  {
    id: 2,
    beat: "IDENTIFY",
    title: "166 Playbooks. Zero Blank Pages.",
    subtitle: "Build your depth chart before the game starts",
    phase: "IDENTIFY",
    phaseColor: "bg-violet-500",
    icon: BookOpen,
    color: "text-violet-400",
    bgColor: "bg-violet-500/20",
    time: 30,
    description: "Unlike crisis tools or PM platforms, M comes with 166 battle-tested playbooks across 9 domains. OFFENSE (M&A, Market Entry, Product Launch), DEFENSE (Crisis, Cyber, Regulatory), SPECIAL TEAMS (Digital Transformation, Competitive Response, AI Governance).",
    investorHighlight: "This is our moat. 166 playbooks = 20+ years of Fortune 500 execution experience. Competitors would need years to replicate.",
    metrics: [
      { label: "Playbooks", value: "166" },
      { label: "Domains", value: "9" },
      { label: "Categories", value: "3" }
    ],
    smartDefaults: {
      title: "Smart Defaults by Domain",
      items: [
        { domain: "Cyber Incidents", defaults: "ISO 27001, SOC2, NIST frameworks pre-selected" },
        { domain: "M&A Integration", defaults: "Hart-Scott-Rodino, SEC reporting, synergy tracking" },
        { domain: "Crisis Response", defaults: "Media protocols, stakeholder matrices, legal holds" }
      ]
    },
    pmSync: null
  },
  {
    id: 3,
    beat: "DETECT",
    title: "AI Monitors. You Decide.",
    subtitle: "Human-AI partnership for strategic velocity",
    phase: "DETECT",
    phaseColor: "bg-blue-500",
    icon: Radar,
    color: "text-blue-400",
    bgColor: "bg-blue-500/20",
    time: 60,
    description: "M's AI continuously monitors for strategic signalscompetitive moves, regulatory changes, supply chain disruptions, cyber threats. When it detects a pattern, it recommends the right playbook with confidence scoring. AI monitors and recommends. Executives decide.",
    investorHighlight: "The human-AI partnership is key to enterprise adoption. We augment executives, we don't replace them. This is how you sell to Fortune 1000 C-suites.",
    metrics: [
      { label: "Signals Monitored", value: "2,847" },
      { label: "Pattern Match", value: "94%" },
      { label: "Recommendation", value: "Playbook #018" }
    ],
    smartDefaults: null,
    pmSync: null
  },
  {
    id: 4,
    beat: "EXECUTE",
    title: "12 Minutes. Not 72 Hours.",
    subtitle: "One-click activation with 15-section executive data",
    phase: "EXECUTE",
    phaseColor: "bg-emerald-500",
    icon: Zap,
    color: "text-emerald-400",
    bgColor: "bg-emerald-500/20",
    time: 100,
    description: "When the CISO approves, M auto-creates your Jira project, assigns every task, stages every document, and unlocks pre-approved budgetsall in 12 minutes. 47 stakeholders notified instantly. Teams don't learn MM comes to them in tools they already use.",
    investorHighlight: "The integration layer IS the moat. Once 50 playbooks are syncing to Jira with bi-directional updates, switching costs are massive.",
    metrics: [
      { label: "Stakeholders", value: "47" },
      { label: "Tasks Created", value: "127" },
      { label: "Response Time", value: "12 min" }
    ],
    smartDefaults: {
      title: "15 Executive Data Sections",
      items: [
        { domain: "Compliance & Regulatory", defaults: "4 frameworks active, auto-populated" },
        { domain: "Risk Assessment", defaults: "Score: 8/10, mitigation plans staged" },
        { domain: "Geographic Scope", defaults: "Global, 12 regions configured" }
      ]
    },
    pmSync: {
      title: "Real-Time PM Sync",
      platforms: ["Jira", "Asana", "Monday.com", "ServiceNow"],
      actions: [
        "Project created: CYBER-2024-001",
        "127 tasks assigned with acceptance criteria",
        "Dependencies mapped, critical path calculated",
        "Pre-approved budget unlocked: $2.5M"
      ]
    }
  },
  {
    id: 5,
    beat: "ADVANCE",
    title: "Institutional Learning Captured",
    subtitle: "Every execution makes the next one better",
    phase: "ADVANCE",
    phaseColor: "bg-amber-500",
    icon: Brain,
    color: "text-amber-400",
    bgColor: "bg-amber-500/20",
    time: 150,
    description: "After resolution, M captures what worked, what didn't, and suggests playbook refinements. This institutional knowledge stays with the organizationnot in someone's head who might leave. The playbook library becomes a strategic asset.",
    investorHighlight: "Historical execution data + playbook refinements = recurring value that compounds. This is how we achieve 150%+ net revenue retention.",
    metrics: [
      { label: "Lessons Captured", value: "23" },
      { label: "Playbook Updates", value: "7" },
      { label: "Time Saved Next", value: "15%" }
    ],
    smartDefaults: null,
    pmSync: null
  }
];

const STAKEHOLDER_ACKNOWLEDGMENTS = [
  { name: "Sarah Chen", role: "Chief Information Security Officer", time: 105 },
  { name: "Michael Rodriguez", role: "VP Infrastructure", time: 108 },
  { name: "Jennifer Park", role: "General Counsel", time: 112 },
  { name: "David Thompson", role: "Chief Communications Officer", time: 115 },
  { name: "Lisa Wang", role: "VP Human Resources", time: 118 },
  { name: "Robert Kim", role: "Chief Financial Officer", time: 122 },
  { name: "Amanda Foster", role: "VP Customer Success", time: 128 },
  { name: "James Mitchell", role: "Chief Operating Officer", time: 135 },
];

const MOAT_COMPONENTS = [
  { icon: BookOpen, title: "166 Playbooks", description: "20+ years encoded" },
  { icon: GitBranch, title: "Integration Layer", description: "Bi-directional PM sync" },
  { icon: Brain, title: "Institutional Data", description: "Execution history" },
  { icon: Lock, title: "Switching Costs", description: "Deep workflow embed" }
];

export default function InvestorDemo() {
  const [, setLocation] = useLocation();
  const [isPlaying, setIsPlaying] = useState(false);
  const [elapsedTime, setElapsedTime] = useState(0);
  const [currentStageIndex, setCurrentStageIndex] = useState(0);
  const [acknowledgedStakeholders, setAcknowledgedStakeholders] = useState<typeof STAKEHOLDER_ACKNOWLEDGMENTS>([]);
  const [showConfetti, setShowConfetti] = useState(false);
  const [isComplete, setIsComplete] = useState(false);
  const [playbackSpeed, setPlaybackSpeed] = useState(1);
  const [manualMode, setManualMode] = useState(true);

  useEffect(() => {
    if (!isPlaying || manualMode) return;

    const interval = setInterval(() => {
      setElapsedTime(prev => {
        const next = prev + playbackSpeed;
        
        const nextStageIndex = IDEA_STORY.findIndex(s => s.time > next);
        if (nextStageIndex > 0) {
          setCurrentStageIndex(nextStageIndex - 1);
        } else if (nextStageIndex === -1) {
          setCurrentStageIndex(IDEA_STORY.length - 1);
        }
        
        const newAcks = STAKEHOLDER_ACKNOWLEDGMENTS.filter(s => s.time <= next && s.time > prev);
        if (newAcks.length > 0) {
          setAcknowledgedStakeholders(current => [...current, ...newAcks]);
        }
        
        if (next >= DEMO_DURATION) {
          setIsPlaying(false);
          setShowConfetti(true);
          setIsComplete(true);
          setTimeout(() => setShowConfetti(false), 5000);
        }
        
        return next;
      });
    }, 2500);

    return () => clearInterval(interval);
  }, [isPlaying, playbackSpeed, manualMode]);

  const handleNextStage = () => {
    if (currentStageIndex < IDEA_STORY.length - 1) {
      const nextIndex = currentStageIndex + 1;
      setCurrentStageIndex(nextIndex);
      setElapsedTime(IDEA_STORY[nextIndex].time);
      const newAcks = STAKEHOLDER_ACKNOWLEDGMENTS.filter(s => s.time <= IDEA_STORY[nextIndex].time);
      setAcknowledgedStakeholders(newAcks);
      
      if (nextIndex === IDEA_STORY.length - 1) {
        setIsComplete(true);
        setShowConfetti(true);
        setTimeout(() => setShowConfetti(false), 5000);
      }
    }
  };

  const handlePrevStage = () => {
    if (currentStageIndex > 0) {
      const prevIndex = currentStageIndex - 1;
      setCurrentStageIndex(prevIndex);
      setElapsedTime(IDEA_STORY[prevIndex].time);
      const newAcks = STAKEHOLDER_ACKNOWLEDGMENTS.filter(s => s.time <= IDEA_STORY[prevIndex].time);
      setAcknowledgedStakeholders(newAcks);
      setIsComplete(false);
    }
  };

  const handleReset = () => {
    setIsPlaying(false);
    setElapsedTime(0);
    setCurrentStageIndex(0);
    setAcknowledgedStakeholders([]);
    setShowConfetti(false);
    setIsComplete(false);
    setPlaybackSpeed(1);
  };

  const currentStage = IDEA_STORY[currentStageIndex];
  const progress = ((currentStageIndex + 1) / IDEA_STORY.length) * 100;
  const StageIcon = currentStage.icon;

  return (
    <div className="min-h-screen bg-slate-950 flex flex-col">
      <StandardNav />
      
      {showConfetti && <Confetti recycle={false} numberOfPieces={200} />}
      
      <main className="flex-1 py-8">
        <div className="max-w-6xl mx-auto px-6">
          <div className="text-center mb-6">
            <Badge className="bg-purple-500 text-white mb-3">
              Investor Demo  Market Creation Story
            </Badge>
            <h1 className="text-3xl md:text-4xl font-bold text-white mb-2" data-testid="heading-investor-demo">
              M: The Strategic Execution Operating System
            </h1>
            <p className="text-lg text-slate-400">
              First mover in $15B+ SEOS category. 166 playbooks. 12-minute execution.
            </p>
          </div>

          {/* Playback Controls */}
          <Card className="bg-slate-900/80 border-slate-700 mb-6">
            <CardContent className="p-4">
              <div className="flex items-center justify-between flex-wrap gap-4">
                <div className="flex items-center gap-3">
                  {!isPlaying ? (
                    <Button
                      onClick={() => { setManualMode(false); setIsPlaying(true); }}
                      className="bg-emerald-600 hover:bg-emerald-700"
                      data-testid="button-play-demo"
                    >
                      <Play className="h-4 w-4 mr-2" />
                      {elapsedTime > 0 ? 'Resume' : 'Auto Play'}
                    </Button>
                  ) : (
                    <Button
                      onClick={() => setIsPlaying(false)}
                      variant="outline"
                      className="border-slate-600"
                      data-testid="button-pause-demo"
                    >
                      <Pause className="h-4 w-4 mr-2" />
                      Pause
                    </Button>
                  )}
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={() => { setManualMode(true); setIsPlaying(false); }}
                    className={`text-sm ${manualMode ? 'text-emerald-400' : 'text-slate-400'}`}
                    data-testid="button-manual-mode"
                  >
                    Manual Mode
                  </Button>
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={handleReset}
                    className="text-slate-400"
                    data-testid="button-reset-demo"
                  >
                    <RotateCcw className="h-4 w-4" />
                  </Button>
                </div>
                
                <div className="flex items-center gap-4">
                  <div className="flex items-center gap-2">
                    <span className="text-xs text-slate-500">Speed:</span>
                    {[1, 2, 4].map((speed) => (
                      <Button
                        key={speed}
                        variant="ghost"
                        size="sm"
                        onClick={() => setPlaybackSpeed(speed)}
                        className={`text-xs px-2 ${playbackSpeed === speed ? 'text-emerald-400 bg-emerald-500/20' : 'text-slate-400'}`}
                        data-testid={`button-speed-${speed}x`}
                      >
                        {speed}x
                      </Button>
                    ))}
                  </div>
                  
                  <div className="flex items-center gap-2 bg-slate-800/50 px-3 py-1.5 rounded-lg">
                    <Clock className="h-4 w-4 text-slate-400" />
                    <span className="text-white font-mono text-sm">
                      {Math.floor(elapsedTime / 60)}:{(elapsedTime % 60).toString().padStart(2, '0')}
                    </span>
                    <span className="text-slate-500 text-xs">/ 3:00</span>
                  </div>
                </div>
              </div>
              <Progress value={(elapsedTime / DEMO_DURATION) * 100} className="h-1 mt-3" />
            </CardContent>
          </Card>

          {/* Story Beat Navigation */}
          <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
            {IDEA_STORY.map((stage, idx) => (
              <button
                key={stage.id}
                onClick={() => {
                  setCurrentStageIndex(idx);
                  setElapsedTime(stage.time);
                  const newAcks = STAKEHOLDER_ACKNOWLEDGMENTS.filter(s => s.time <= stage.time);
                  setAcknowledgedStakeholders(newAcks);
                  setIsComplete(idx === IDEA_STORY.length - 1);
                }}
                className={`flex-shrink-0 px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                  idx === currentStageIndex
                    ? `${stage.phaseColor} text-white`
                    : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                }`}
                data-testid={`button-stage-${idx}`}
              >
                {stage.beat}
              </button>
            ))}
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-2 space-y-6">
              <Card className="bg-slate-900 border-slate-700">
                <CardHeader className="border-b border-slate-700 pb-4">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <Badge className={`${currentStage.phaseColor} text-white`}>
                        {currentStage.phase}
                      </Badge>
                      <span className="text-slate-400 text-sm">
                        {currentStage.beat}  {currentStageIndex + 1} of {IDEA_STORY.length}
                      </span>
                    </div>
                    {manualMode && (
                      <div className="flex items-center gap-2">
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={handlePrevStage}
                          disabled={currentStageIndex === 0}
                          className="text-slate-400"
                          data-testid="button-prev-stage"
                        >
                           Back
                        </Button>
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => {
                            setElapsedTime(DEMO_DURATION);
                            setCurrentStageIndex(IDEA_STORY.length - 1);
                            setAcknowledgedStakeholders(STAKEHOLDER_ACKNOWLEDGMENTS);
                            setIsComplete(true);
                            setShowConfetti(true);
                            setTimeout(() => setShowConfetti(false), 5000);
                          }}
                          className="text-slate-400"
                          data-testid="button-skip-to-end"
                        >
                          <SkipForward className="h-4 w-4 mr-1" />
                          Skip
                        </Button>
                      </div>
                    )}
                  </div>
                  <Progress value={progress} className="h-1 mt-4" />
                </CardHeader>
                
                <CardContent className="p-6">
                  <AnimatePresence mode="wait">
                    <motion.div
                      key={currentStage.id}
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      exit={{ opacity: 0, y: -20 }}
                      transition={{ duration: 0.3 }}
                    >
                      <div className="flex items-start gap-4 mb-6">
                        <div className={`p-4 rounded-xl ${currentStage.bgColor}`}>
                          <StageIcon className={`h-8 w-8 ${currentStage.color}`} />
                        </div>
                        <div className="flex-1">
                          <h2 className="text-2xl font-bold text-white mb-1">
                            {currentStage.title}
                          </h2>
                          <p className={`text-lg ${currentStage.color} mb-3`}>
                            {currentStage.subtitle}
                          </p>
                          <p className="text-slate-400 leading-relaxed mb-4">
                            {currentStage.description}
                          </p>
                          
                          {/* Investor Highlight */}
                          <div className="bg-purple-900/30 border border-purple-500/30 rounded-lg p-3">
                            <div className="flex items-start gap-2">
                              <TrendingUp className="h-4 w-4 text-purple-400 mt-0.5 flex-shrink-0" />
                              <p className="text-sm text-purple-200">
                                <span className="font-medium text-purple-400">Investor Insight:</span> {currentStage.investorHighlight}
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                      
                      <div className="grid grid-cols-3 gap-4 mb-6">
                        {currentStage.metrics.map((metric, idx) => (
                          <div key={idx} className="bg-slate-800/50 rounded-lg p-4 text-center">
                            <div className="text-2xl font-bold text-white mb-1">{metric.value}</div>
                            <div className="text-xs text-slate-400">{metric.label}</div>
                          </div>
                        ))}
                      </div>

                      {/* Smart Defaults Panel */}
                      {currentStage.smartDefaults && (
                        <div className="bg-slate-800/50 rounded-lg p-4 mb-4">
                          <div className="flex items-center gap-2 mb-3">
                            <Settings className="h-4 w-4 text-violet-400" />
                            <span className="font-medium text-white">{currentStage.smartDefaults.title}</span>
                          </div>
                          <div className="space-y-2">
                            {currentStage.smartDefaults.items.map((item, idx) => (
                              <div key={idx} className="flex items-start gap-2 text-sm">
                                <CheckCircle2 className="h-4 w-4 text-emerald-400 mt-0.5 flex-shrink-0" />
                                <div>
                                  <span className="text-white">{item.domain}:</span>{' '}
                                  <span className="text-slate-400">{item.defaults}</span>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      {/* PM Sync Panel */}
                      {currentStage.pmSync && (
                        <div className="bg-emerald-900/20 border border-emerald-500/30 rounded-lg p-4 mb-4">
                          <div className="flex items-center gap-2 mb-3">
                            <GitBranch className="h-4 w-4 text-emerald-400" />
                            <span className="font-medium text-white">{currentStage.pmSync.title}</span>
                            <div className="flex gap-1 ml-auto">
                              {currentStage.pmSync.platforms.map((p, idx) => (
                                <Badge key={idx} variant="outline" className="text-xs border-emerald-500/50 text-emerald-300">
                                  {p}
                                </Badge>
                              ))}
                            </div>
                          </div>
                          <div className="space-y-1">
                            {currentStage.pmSync.actions.map((action, idx) => (
                              <div key={idx} className="flex items-center gap-2 text-sm">
                                <div className="w-1.5 h-1.5 rounded-full bg-emerald-400" />
                                <span className="text-slate-300">{action}</span>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                      
                      {!isComplete ? (
                        <Button
                          onClick={handleNextStage}
                          className="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-6 text-lg"
                          data-testid="button-next-stage"
                        >
                          {currentStageIndex === IDEA_STORY.length - 2 ? 'Complete Story' : 'Next Beat'}
                          <ArrowRight className="ml-2 h-5 w-5" />
                        </Button>
                      ) : (
                        <div className="space-y-3">
                          <div className="bg-emerald-900/30 border border-emerald-500/30 rounded-lg p-4 text-center">
                            <CheckCircle2 className="h-8 w-8 text-emerald-400 mx-auto mb-2" />
                            <p className="text-emerald-400 font-medium">Story Complete</p>
                            <p className="text-slate-400 text-sm">From signal to coordinated action: 12 minutes vs 72 hours</p>
                          </div>
                          <div className="flex gap-3">
                            <Button
                              onClick={() => setLocation('/customer-demo')}
                              className="flex-1 bg-blue-600 hover:bg-blue-700"
                              data-testid="button-customer-demo"
                            >
                              <Users className="mr-2 h-4 w-4" />
                              See Customer Demo
                            </Button>
                            <Button
                              onClick={() => setLocation('/investor-presentation')}
                              variant="outline"
                              className="flex-1 border-purple-500/50 text-purple-300"
                              data-testid="button-full-presentation"
                            >
                              Full Deck
                              <ChevronRight className="ml-2 h-4 w-4" />
                            </Button>
                          </div>
                        </div>
                      )}
                    </motion.div>
                  </AnimatePresence>
                </CardContent>
              </Card>
            </div>

            <div className="space-y-6">
              {/* Enterprise Moat */}
              <Card className="bg-gradient-to-br from-purple-900/40 to-slate-900 border-purple-500/30">
                <CardHeader className="pb-3">
                  <CardTitle className="text-lg text-white flex items-center gap-2">
                    <Lock className="h-5 w-5 text-purple-400" />
                    Enterprise Moat
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    {MOAT_COMPONENTS.map((item, idx) => (
                      <div key={idx} className="flex items-start gap-3">
                        <div className="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center flex-shrink-0">
                          <item.icon className="h-4 w-4 text-purple-400" />
                        </div>
                        <div>
                          <div className="text-sm font-medium text-white">{item.title}</div>
                          <div className="text-xs text-slate-400">{item.description}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </CardContent>
              </Card>

              {/* Stakeholder Response - only show during EXECUTE */}
              {currentStageIndex >= 3 && (
                <Card className="bg-slate-900 border-slate-700">
                  <CardHeader className="pb-3">
                    <CardTitle className="text-lg text-white flex items-center gap-2">
                      <Users className="h-5 w-5 text-blue-400" />
                      Live Stakeholder Response
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-2 max-h-48 overflow-y-auto">
                      {STAKEHOLDER_ACKNOWLEDGMENTS.map((stakeholder, idx) => {
                        const isAcknowledged = acknowledgedStakeholders.some(s => s.name === stakeholder.name);
                        return (
                          <div 
                            key={idx}
                            className={`p-2 rounded-lg flex items-center gap-2 transition-all ${
                              isAcknowledged ? 'bg-emerald-900/30' : 'bg-slate-800/30'
                            }`}
                          >
                            <div className={`w-2 h-2 rounded-full ${isAcknowledged ? 'bg-emerald-400' : 'bg-slate-600'}`} />
                            <div className="flex-1 min-w-0">
                              <div className="text-sm font-medium text-white truncate">{stakeholder.name}</div>
                              <div className="text-xs text-slate-400 truncate">{stakeholder.role}</div>
                            </div>
                            {isAcknowledged && <CheckCircle2 className="h-4 w-4 text-emerald-400 flex-shrink-0" />}
                          </div>
                        );
                      })}
                    </div>
                    <div className="mt-3 pt-3 border-t border-slate-700">
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-400">Acknowledged</span>
                        <span className="text-white font-medium">{acknowledgedStakeholders.length} / {STAKEHOLDER_ACKNOWLEDGMENTS.length}</span>
                      </div>
                      <Progress value={(acknowledgedStakeholders.length / STAKEHOLDER_ACKNOWLEDGMENTS.length) * 100} className="h-2 mt-2" />
                    </div>
                  </CardContent>
                </Card>
              )}

              {/* Investment Metrics */}
              <Card className="bg-slate-900 border-slate-700">
                <CardHeader className="pb-3">
                  <CardTitle className="text-lg text-white flex items-center gap-2">
                    <LineChart className="h-5 w-5 text-emerald-400" />
                    Investment Thesis
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex justify-between items-center">
                      <span className="text-sm text-slate-400">TAM</span>
                      <span className="text-sm font-medium text-white">$15B+</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm text-slate-400">Target ACV</span>
                      <span className="text-sm font-medium text-white">$500K-$2M</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm text-slate-400">Beachhead</span>
                      <span className="text-sm font-medium text-white">Gaming & Hospitality</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm text-slate-400">Category</span>
                      <span className="text-sm font-medium text-emerald-400">Category Creator</span>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
          </div>
        </div>
      </main>
      
      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/InvestorLanding.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import {
  TrendingUp,
  Target,
  Shield,
  Zap,
  Users,
  Globe,
  Rocket,
  DollarSign,
  BarChart3,
  Lock,
  Network,
  Lightbulb,
  CheckCircle2,
  ArrowRight
} from "lucide-react";
import { useLocation } from "wouter";
import StandardNav from "@/components/layout/StandardNav";
import { 
  BarChart, 
  Bar, 
  XAxis, 
  YAxis, 
  CartesianGrid, 
  Tooltip, 
  ResponsiveContainer,
  LineChart,
  Line,
  PieChart,
  Pie,
  Cell,
  Legend
} from "recharts";

// Market funnel data
const marketFunnelData = [
  { name: 'TAM', value: 127, label: '$127B', color: '#3B82F6' },
  { name: 'SAM', value: 38, label: '$38B', color: '#8B5CF6' },
  { name: 'SOM', value: 1.9, label: '$1.9B', color: '#10B981' }
];

// LTV:CAC trend over 5 years
const ltvCacTrendData = [
  { year: 'Y1', ratio: 3.2, ltv: 160, cac: 50 },
  { year: 'Y2', ratio: 5.1, ltv: 280, cac: 55 },
  { year: 'Y3', ratio: 6.8, ltv: 420, cac: 62 },
  { year: 'Y4', ratio: 7.9, ltv: 580, cac: 73 },
  { year: 'Y5', ratio: 8.4, ltv: 756, cac: 90 }
];

// ROI breakdown data
const roiBreakdownData = [
  { name: 'Cost Savings', value: 7.2, color: '#10B981' },
  { name: 'Time Recovery', value: 3.4, color: '#3B82F6' },
  { name: 'Risk Mitigation', value: 1.8, color: '#8B5CF6' }
];

export default function InvestorLanding() {
  const [, setLocation] = useLocation();

  return (
    <div className="page-background min-h-screen">
      <StandardNav />

        {/* Hero Section */}
        <section className="py-20 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white relative overflow-hidden">
          <div className="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAxMCAwIEwgMCAwIDAgMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIi8+PC9zdmc+')] opacity-20"></div>
          
          <div className="max-w-7xl mx-auto relative z-10">
            <Badge className="mb-6 bg-blue-600 text-white border-0 text-sm px-4 py-1.5" data-testid="badge-category">
              Category-Defining Opportunity
            </Badge>
            
            <h1 className="text-5xl md:text-7xl font-bold mb-6 leading-tight max-w-5xl bg-gradient-to-r from-white to-blue-200 bg-clip-text text-transparent" data-testid="heading-hero">
              The Salesforce Moment for Strategic Execution
            </h1>
            
            <p className="text-2xl md:text-3xl text-cyan-200 font-semibold mb-6" data-testid="text-tagline">
              M: First Strategic Execution Operating System
            </p>
            
            <p className="text-lg md:text-xl text-blue-100 mb-8 max-w-4xl" data-testid="text-description">
              Fortune 1000 companies spend $847B annually on strategic initiatives83% fail due to execution gaps. M creates a new software category worth $127B TAM, delivering 500x faster execution with complete 7-component ecosystem.
            </p>

            <div className="flex flex-wrap gap-4">
              <Button 
                size="lg"
                onClick={() => setLocation("/executive-demo-walkthrough")}
                className="bg-white text-slate-900 hover:bg-slate-100"
                data-testid="button-see-demo"
              >
                <Rocket className="mr-2 h-5 w-5" />
                See 8-Minute Demo
              </Button>
              <Button 
                size="lg"
                variant="outline"
                onClick={() => setLocation("/business-scenarios")}
                className="border-white text-white hover:bg-white/10"
                data-testid="button-explore-scenarios"
              >
                Explore Use Cases
                <ArrowRight className="ml-2 h-5 w-5" />
              </Button>
            </div>
          </div>
        </section>

        {/* Market Opportunity */}
        <section className="py-16 px-6 bg-white dark:bg-slate-900">
          <div className="max-w-7xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-4xl font-bold mb-4 text-slate-900 dark:text-white" data-testid="heading-market">
                Massive Market Opportunity
              </h2>
              <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto" data-testid="text-market-subtitle">
                Creating a new $127B software category at the intersection of strategic planning, AI intelligence, and execution automation
              </p>
            </div>

            <div className="grid md:grid-cols-3 gap-8 mb-12">
              <Card className="border-2" data-testid="card-tam">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-slate-900 dark:text-white">
                    <Globe className="h-6 w-6 text-blue-600" />
                    TAM (Total Addressable Market)
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-4xl font-bold text-blue-600 mb-2" data-testid="text-tam-value">$127B</div>
                  <p className="text-slate-600 dark:text-slate-400" data-testid="text-tam-description">
                    Fortune 1000 strategic execution software spend (15% of $847B total strategic initiatives budget)
                  </p>
                </CardContent>
              </Card>

              <Card className="border-2" data-testid="card-sam">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-slate-900 dark:text-white">
                    <Target className="h-6 w-6 text-purple-600" />
                    SAM (Serviceable Addressable)
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-4xl font-bold text-purple-600 mb-2" data-testid="text-sam-value">$38B</div>
                  <p className="text-slate-600 dark:text-slate-400" data-testid="text-sam-description">
                    Fortune 500 + high-growth enterprises with $1B+ revenue requiring executive decision velocity
                  </p>
                </CardContent>
              </Card>

              <Card className="border-2" data-testid="card-som">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-slate-900 dark:text-white">
                    <Rocket className="h-6 w-6 text-green-600" />
                    SOM (Serviceable Obtainable)
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-4xl font-bold text-green-600 mb-2" data-testid="text-som-value">$1.9B</div>
                  <p className="text-slate-600 dark:text-slate-400" data-testid="text-som-description">
                    5% market capture in Year 5 (50 Fortune 500 + 200 mid-market at $250K-$2M ACV)
                  </p>
                </CardContent>
              </Card>
            </div>

            {/* Market Funnel Visualization */}
            <Card className="border-2 mb-8" data-testid="card-market-funnel">
              <CardHeader>
                <CardTitle className="text-slate-900 dark:text-white">Market Opportunity Funnel</CardTitle>
              </CardHeader>
              <CardContent>
                <ResponsiveContainer width="100%" height={300}>
                  <BarChart data={marketFunnelData} layout="vertical">
                    <CartesianGrid strokeDasharray="3 3" className="stroke-slate-200 dark:stroke-slate-700" />
                    <XAxis type="number" />
                    <YAxis dataKey="name" type="category" />
                    <Tooltip 
                      formatter={(value: number) => `$${value}B`}
                      contentStyle={{ backgroundColor: 'rgba(15, 23, 42, 0.9)', border: 'none', borderRadius: '8px', color: 'white' }}
                    />
                    <Bar dataKey="value" radius={[0, 8, 8, 0]}>
                      {marketFunnelData.map((entry, index) => (
                        <Cell key={`cell-${index}`} fill={entry.color} />
                      ))}
                    </Bar>
                  </BarChart>
                </ResponsiveContainer>
                <div className="mt-4 text-center text-sm text-slate-600 dark:text-slate-400">
                  Progressive market capture: $127B TAM  $38B SAM  $1.9B SOM (Year 5)
                </div>
              </CardContent>
            </Card>

            <Card className="bg-gradient-to-br .section-background dark:from-slate-800 dark:to-slate-700 border-2" data-testid="card-why-now">
              <CardContent className="p-8">
                <h3 className="text-2xl font-bold mb-6 text-slate-900 dark:text-white" data-testid="heading-why-now">
                  Why Now? Perfect Market Timing
                </h3>
                <div className="grid md:grid-cols-2 gap-6">
                  <div className="flex items-start gap-3" data-testid="reason-1">
                    <CheckCircle2 className="h-6 w-6 text-green-600 flex-shrink-0 mt-1" />
                    <div>
                      <div className="font-semibold text-slate-900 dark:text-white mb-1">AI Maturity Reached</div>
                      <div className="text-slate-600 dark:text-slate-400">LLMs enable real-time strategic intelligence at scale (GPT-4, Claude, Gemini)</div>
                    </div>
                  </div>
                  <div className="flex items-start gap-3" data-testid="reason-2">
                    <CheckCircle2 className="h-6 w-6 text-green-600 flex-shrink-0 mt-1" />
                    <div>
                      <div className="font-semibold text-slate-900 dark:text-white mb-1">Execution Crisis</div>
                      <div className="text-slate-600 dark:text-slate-400">87% of strategic initiatives failexecutives desperate for execution velocity</div>
                    </div>
                  </div>
                  <div className="flex items-start gap-3" data-testid="reason-3">
                    <CheckCircle2 className="h-6 w-6 text-green-600 flex-shrink-0 mt-1" />
                    <div>
                      <div className="font-semibold text-slate-900 dark:text-white mb-1">Remote Work Complexity</div>
                      <div className="text-slate-600 dark:text-slate-400">Distributed teams make coordination harderneed automated orchestration</div>
                    </div>
                  </div>
                  <div className="flex items-start gap-3" data-testid="reason-4">
                    <CheckCircle2 className="h-6 w-6 text-green-600 flex-shrink-0 mt-1" />
                    <div>
                      <div className="font-semibold text-slate-900 dark:text-white mb-1">Competitive Velocity</div>
                      <div className="text-slate-600 dark:text-slate-400">Market windows shrinking from months to daysspeed is survival</div>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </section>

        {/* Competitive Moat */}
        <section className="py-16 px-6 bg-slate-50 dark:bg-slate-800">
          <div className="max-w-7xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-4xl font-bold mb-4 text-slate-900 dark:text-white" data-testid="heading-moat">
                Defensible Competitive Moat
              </h2>
              <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto" data-testid="text-moat-subtitle">
                Multi-layered advantages that compound over time, creating winner-take-most dynamics
              </p>
            </div>

            <div className="grid md:grid-cols-2 gap-8">
              <Card className="border-2" data-testid="card-moat-ecosystem">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-slate-900 dark:text-white">
                    <Shield className="h-6 w-6 text-primary" />
                    Complete 7-Component Ecosystem
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-slate-600 dark:text-slate-400 mb-4">
                    Competitors offer point solutions (BI tools, project management, chatbots). M integrates entire strategic execution workflowmassive switching costs once embedded.
                  </p>
                  <div className="text-sm font-semibold text-primary" data-testid="text-moat-ecosystem-advantage">
                    Advantage: 18-24 month integration lead vs. competitors
                  </div>
                </CardContent>
              </Card>

              <Card className="border-2" data-testid="card-moat-memory">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-slate-900 dark:text-white">
                    <Lightbulb className="h-6 w-6 text-purple-600" />
                    Institutional Memory Network Effects
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-slate-600 dark:text-slate-400 mb-4">
                    AI learns from every decision across all customers (anonymized). More customers = smarter recommendations = higher retention. Data moat compounds quarterly.
                  </p>
                  <div className="text-sm font-semibold text-primary" data-testid="text-moat-memory-advantage">
                    Advantage: Data flywheel creates 10x better AI vs. new entrants
                  </div>
                </CardContent>
              </Card>

              <Card className="border-2" data-testid="card-moat-templates">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-slate-900 dark:text-white">
                    <Network className="h-6 w-6 text-blue-600" />
                    Template Library Network Effects
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-slate-600 dark:text-slate-400 mb-4">
                    Start with 13+ templates, grows to 500+ as customers contribute. More templates = more use cases = more customers. Self-reinforcing growth loop.
                  </p>
                  <div className="text-sm font-semibold text-primary" data-testid="text-moat-templates-advantage">
                    Advantage: Content moatcompetitors can't replicate library scale
                  </div>
                </CardContent>
              </Card>

              <Card className="border-2" data-testid="card-moat-category">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-slate-900 dark:text-white">
                    <Rocket className="h-6 w-6 text-green-600" />
                    Category Leadership
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-slate-600 dark:text-slate-400 mb-4">
                    First mover defining "Strategic Execution Operating System" category (like Salesforce for CRM). Category creators capture 76% of market value (Gartner research).
                  </p>
                  <div className="text-sm font-semibold text-primary" data-testid="text-moat-category-advantage">
                    Advantage: Brand moat"M" becomes verb for strategic execution
                  </div>
                </CardContent>
              </Card>
            </div>
          </div>
        </section>

        {/* Business Model */}
        <section className="py-16 px-6 bg-white dark:bg-slate-900">
          <div className="max-w-7xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-4xl font-bold mb-4 text-slate-900 dark:text-white" data-testid="heading-model">
                High-Margin SaaS Business Model
              </h2>
              <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto" data-testid="text-model-subtitle">
                Enterprise pricing with expansion revenue and sticky product-led growth
              </p>
            </div>

            <div className="grid md:grid-cols-3 gap-8 mb-12">
              <Card className="border-2" data-testid="card-pricing-enterprise">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-slate-900 dark:text-white">
                    <DollarSign className="h-6 w-6 text-green-600" />
                    Enterprise
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-3xl font-bold text-green-600 mb-2" data-testid="text-price-enterprise">$250K-$2M</div>
                  <div className="text-sm text-slate-600 dark:text-slate-400 mb-4">Annual Contract Value</div>
                  <ul className="space-y-2 text-sm text-slate-600 dark:text-slate-400">
                    <li className="flex items-center gap-2">
                      <CheckCircle2 className="h-4 w-4 text-green-600" />
                      Unlimited users
                    </li>
                    <li className="flex items-center gap-2">
                      <CheckCircle2 className="h-4 w-4 text-green-600" />
                      Custom integrations
                    </li>
                    <li className="flex items-center gap-2">
                      <CheckCircle2 className="h-4 w-4 text-green-600" />
                      Dedicated CSM
                    </li>
                  </ul>
                </CardContent>
              </Card>

              <Card className="border-2" data-testid="card-pricing-team">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-slate-900 dark:text-white">
                    <Users className="h-6 w-6 text-blue-600" />
                    Team
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-3xl font-bold text-blue-600 mb-2" data-testid="text-price-team">$48K-$120K</div>
                  <div className="text-sm text-slate-600 dark:text-slate-400 mb-4">Annual ($4K-$10K/mo)</div>
                  <ul className="space-y-2 text-sm text-slate-600 dark:text-slate-400">
                    <li className="flex items-center gap-2">
                      <CheckCircle2 className="h-4 w-4 text-blue-600" />
                      Up to 50 users
                    </li>
                    <li className="flex items-center gap-2">
                      <CheckCircle2 className="h-4 w-4 text-blue-600" />
                      Standard integrations
                    </li>
                    <li className="flex items-center gap-2">
                      <CheckCircle2 className="h-4 w-4 text-blue-600" />
                      Email support
                    </li>
                  </ul>
                </CardContent>
              </Card>

              <Card className="border-2" data-testid="card-pricing-executive">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-slate-900 dark:text-white">
                    <TrendingUp className="h-6 w-6 text-purple-600" />
                    Executive
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-3xl font-bold text-purple-600 mb-2" data-testid="text-price-executive">$12K-$24K</div>
                  <div className="text-sm text-slate-600 dark:text-slate-400 mb-4">Annual ($1K-$2K/mo)</div>
                  <ul className="space-y-2 text-sm text-slate-600 dark:text-slate-400">
                    <li className="flex items-center gap-2">
                      <CheckCircle2 className="h-4 w-4 text-purple-600" />
                      1-5 executives
                    </li>
                    <li className="flex items-center gap-2">
                      <CheckCircle2 className="h-4 w-4 text-purple-600" />
                      Core features
                    </li>
                    <li className="flex items-center gap-2">
                      <CheckCircle2 className="h-4 w-4 text-purple-600" />
                      Self-serve
                    </li>
                  </ul>
                </CardContent>
              </Card>
            </div>

            <Card className="bg-gradient-to-br from-green-50 to-blue-50 dark:from-slate-800 dark:to-slate-700 border-2" data-testid="card-expansion">
              <CardContent className="p-8">
                <h3 className="text-2xl font-bold mb-6 text-slate-900 dark:text-white" data-testid="heading-expansion">
                  Expansion Revenue Streams
                </h3>
                <div className="grid md:grid-cols-3 gap-6">
                  <div data-testid="expansion-1">
                    <div className="flex items-center gap-2 mb-2">
                      <BarChart3 className="h-5 w-5 text-green-600" />
                      <div className="font-semibold text-slate-900 dark:text-white">Integration Marketplace</div>
                    </div>
                    <div className="text-slate-600 dark:text-slate-400">20% rev-share on third-party integrations (Salesforce, Jira, Slack)</div>
                  </div>
                  <div data-testid="expansion-2">
                    <div className="flex items-center gap-2 mb-2">
                      <Zap className="h-5 w-5 text-blue-600" />
                      <div className="font-semibold text-slate-900 dark:text-white">Premium Templates</div>
                    </div>
                    <div className="text-slate-600 dark:text-slate-400">Industry-specific playbooks ($5K-$50K per template pack)</div>
                  </div>
                  <div data-testid="expansion-3">
                    <div className="flex items-center gap-2 mb-2">
                      <Lock className="h-5 w-5 text-purple-600" />
                      <div className="font-semibold text-slate-900 dark:text-white">Advisory Services</div>
                    </div>
                    <div className="text-slate-600 dark:text-slate-400">Strategic workshops ($50K-$200K per engagement)</div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </section>

        {/* Unit Economics */}
        <section className="py-16 px-6 bg-slate-50 dark:bg-slate-800">
          <div className="max-w-7xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-4xl font-bold mb-4 text-slate-900 dark:text-white" data-testid="heading-economics">
                Best-in-Class Unit Economics
              </h2>
              <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto" data-testid="text-economics-subtitle">
                High LTV, low CAC, exceptional retentionSaaS metrics investors love
              </p>
            </div>

            <div className="grid md:grid-cols-4 gap-6">
              <Card className="border-2" data-testid="card-ltv-cac">
                <CardContent className="pt-6">
                  <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">LTV:CAC Ratio</div>
                  <div className="text-4xl font-bold text-green-600 mb-1" data-testid="text-ltv-cac">8.4:1</div>
                  <div className="text-xs text-slate-500">Target: &gt;3:1 (Exceptional)</div>
                </CardContent>
              </Card>

              <Card className="border-2" data-testid="card-payback">
                <CardContent className="pt-6">
                  <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">CAC Payback</div>
                  <div className="text-4xl font-bold text-blue-600 mb-1" data-testid="text-payback">7 months</div>
                  <div className="text-xs text-slate-500">Target: &lt;12mo (Excellent)</div>
                </CardContent>
              </Card>

              <Card className="border-2" data-testid="card-ndr">
                <CardContent className="pt-6">
                  <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">Net Dollar Retention</div>
                  <div className="text-4xl font-bold text-purple-600 mb-1" data-testid="text-ndr">142%</div>
                  <div className="text-xs text-slate-500">Target: &gt;120% (Best-in-class)</div>
                </CardContent>
              </Card>

              <Card className="border-2" data-testid="card-gross-margin">
                <CardContent className="pt-6">
                  <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">Gross Margin</div>
                  <div className="text-4xl font-bold text-indigo-600 mb-1" data-testid="text-gross-margin">87%</div>
                  <div className="text-xs text-slate-500">Target: &gt;80% (Premium SaaS)</div>
                </CardContent>
              </Card>
            </div>

            {/* LTV:CAC Trend Chart */}
            <Card className="border-2 mt-8" data-testid="card-ltv-cac-trend">
              <CardHeader>
                <CardTitle className="text-slate-900 dark:text-white">LTV:CAC Ratio Growth Trajectory</CardTitle>
              </CardHeader>
              <CardContent>
                <ResponsiveContainer width="100%" height={350}>
                  <LineChart data={ltvCacTrendData}>
                    <CartesianGrid strokeDasharray="3 3" className="stroke-slate-200 dark:stroke-slate-700" />
                    <XAxis dataKey="year" />
                    <YAxis yAxisId="left" />
                    <YAxis yAxisId="right" orientation="right" />
                    <Tooltip 
                      contentStyle={{ backgroundColor: 'rgba(15, 23, 42, 0.9)', border: 'none', borderRadius: '8px', color: 'white' }}
                    />
                    <Legend />
                    <Line yAxisId="left" type="monotone" dataKey="ratio" stroke="#10B981" strokeWidth={3} name="LTV:CAC Ratio" dot={{ fill: '#10B981', r: 6 }} />
                    <Line yAxisId="right" type="monotone" dataKey="ltv" stroke="#3B82F6" strokeWidth={2} name="LTV ($K)" />
                    <Line yAxisId="right" type="monotone" dataKey="cac" stroke="#8B5CF6" strokeWidth={2} name="CAC ($K)" />
                  </LineChart>
                </ResponsiveContainer>
                <div className="mt-4 text-center text-sm text-slate-600 dark:text-slate-400">
                  LTV:CAC improving from 3.2:1 (Y1) to 8.4:1 (Y5) as scale economics kick in
                </div>
              </CardContent>
            </Card>

            {/* ROI Breakdown Chart */}
            <Card className="border-2 mt-8" data-testid="card-roi-breakdown">
              <CardHeader>
                <CardTitle className="text-slate-900 dark:text-white">$12.4M Annual ROI Breakdown</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="flex flex-col md:flex-row gap-8 items-center">
                  <div className="flex-1">
                    <ResponsiveContainer width="100%" height={300}>
                      <PieChart>
                        <Pie
                          data={roiBreakdownData}
                          cx="50%"
                          cy="50%"
                          labelLine={false}
                          label={({ name, value }) => `${name}: $${value}M`}
                          outerRadius={100}
                          fill="#8884d8"
                          dataKey="value"
                        >
                          {roiBreakdownData.map((entry, index) => (
                            <Cell key={`cell-${index}`} fill={entry.color} />
                          ))}
                        </Pie>
                        <Tooltip 
                          formatter={(value: number) => `$${value}M`}
                          contentStyle={{ backgroundColor: 'rgba(15, 23, 42, 0.9)', border: 'none', borderRadius: '8px', color: 'white' }}
                        />
                      </PieChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="flex-1 space-y-4">
                    <div>
                      <div className="flex items-center gap-2 mb-2">
                        <div className="w-4 h-4 rounded" style={{ backgroundColor: '#10B981' }}></div>
                        <div className="font-semibold text-slate-900 dark:text-white">Cost Savings: $7.2M</div>
                      </div>
                      <div className="text-sm text-slate-600 dark:text-slate-400">
                        Eliminated coordination delays, reduced strategic initiative failures
                      </div>
                    </div>
                    <div>
                      <div className="flex items-center gap-2 mb-2">
                        <div className="w-4 h-4 rounded" style={{ backgroundColor: '#3B82F6' }}></div>
                        <div className="font-semibold text-slate-900 dark:text-white">Time Recovery: $3.4M</div>
                      </div>
                      <div className="text-sm text-slate-600 dark:text-slate-400">
                        342 hours saved monthly, valued at executive time rates
                      </div>
                    </div>
                    <div>
                      <div className="flex items-center gap-2 mb-2">
                        <div className="w-4 h-4 rounded" style={{ backgroundColor: '#8B5CF6' }}></div>
                        <div className="font-semibold text-slate-900 dark:text-white">Risk Mitigation: $1.8M</div>
                      </div>
                      <div className="text-sm text-slate-600 dark:text-slate-400">
                        Prevented strategic missteps through AI-powered early warnings
                      </div>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </section>

        {/* CTA Section */}
        <section className="py-20 px-6 bg-gradient-to-br from-primary to-blue-900 text-white">
          <div className="max-w-4xl mx-auto text-center">
            <h2 className="text-4xl md:text-5xl font-bold mb-6" data-testid="heading-cta">
              Join Us in Creating a New Software Category
            </h2>
            <p className="text-xl mb-8 text-blue-100" data-testid="text-cta-description">
              M is defining the Strategic Execution Operating System categorya $127B market opportunity with winner-take-most dynamics. Early investors gain exposure to category creation with defensible moats and exceptional unit economics.
            </p>
            <div className="flex flex-wrap gap-4 justify-center">
              <Button
                size="lg"
                onClick={() => setLocation("/executive-demo-walkthrough")}
                className="bg-white text-slate-900 hover:bg-slate-100"
                data-testid="button-cta-demo"
              >
                <Rocket className="mr-2 h-5 w-5" />
                Experience the Platform
              </Button>
              <Button
                size="lg"
                variant="outline"
                onClick={() => setLocation("/dashboard")}
                className="border-white text-white hover:bg-white/10"
                data-testid="button-cta-dashboard"
              >
                Explore Dashboard
                <ArrowRight className="ml-2 h-5 w-5" />
              </Button>
            </div>
          </div>
        </section>
    </div>
  );
}


========================================
FILE: client/src/pages/InvestorPresentation.tsx
========================================
import { useState, useEffect, useCallback } from 'react';
import { useLocation } from 'wouter';
import { motion, AnimatePresence } from 'framer-motion';
import StandardNav from '@/components/layout/StandardNav';
import { 
  ChevronLeft, 
  ChevronRight, 
  Play, 
  Maximize2,
  Monitor,
  FileText,
  Clock,
  Target,
  Zap,
  TrendingUp,
  Shield,
  Users,
  DollarSign,
  BarChart3,
  Rocket,
  CheckCircle2,
  AlertTriangle,
  Brain,
  Eye,
  Settings,
  BookOpen,
  Activity,
  ArrowRight
} from 'lucide-react';
import { Button } from '@/components/ui/button';

interface Slide {
  id: string;
  act: number;
  actName: string;
  title: string;
  subtitle?: string;
  content: 'slide' | 'demo-transition';
  demoTarget?: string;
  notes: string;
  visual: 'title' | 'problem' | 'market' | 'solution' | 'phase' | 'demo' | 'metrics' | 'competitive' | 'financial' | 'cta';
  data?: any;
}

const PRESENTATION_SLIDES: Slide[] = [
  // ACT 1: HOOK (2 min)
  {
    id: 'title',
    act: 1,
    actName: 'Hook',
    title: 'M',
    subtitle: 'Strategic Execution Operating System',
    content: 'slide',
    notes: 'Welcome everyone. Today I want to show you how we\'re transforming strategic execution for Fortune 1000 companies.',
    visual: 'title'
  },
  {
    id: 'mission',
    act: 1,
    actName: 'Hook',
    title: 'Success Favors the Prepared',
    subtitle: 'The Strategic Execution Operating System',
    content: 'slide',
    notes: 'M fundamentally changes how Fortune 1000 leaders workreplacing reactive scrambles with coordinated precision, turning emerging opportunities into decisive action, and transforming risk into competitive advantage.',
    visual: 'title',
    data: {
      tagline: 'From days to minutes.',
      description: 'Born from the split-second discipline that wins championships, built for the moments that define companies.'
    }
  },
  
  // ACT 2: PROBLEM & MARKET (4 min)
  {
    id: 'problem-1',
    act: 2,
    actName: 'Problem & Market',
    title: 'The Problem',
    subtitle: 'Strategic execution is broken',
    content: 'slide',
    notes: 'Right now, when a critical market signal appearsa competitor move, regulatory change, or customer shiftit takes enterprises 72+ hours just to get the information to decision-makers.',
    visual: 'problem',
    data: {
      stats: [
        { value: '72+', unit: 'Hours', label: 'Signal to Decision' },
        { value: '15+', unit: 'Meetings', label: 'To Align Stakeholders' },
        { value: '$10-50M', unit: '', label: 'Annual Revenue at Risk' }
      ]
    }
  },
  {
    id: 'problem-2',
    act: 2,
    actName: 'Problem & Market',
    title: 'The Cost of Slow',
    content: 'slide',
    notes: 'Every hour of delay means lost market share, revenue leakage, and reputation damage. Your competitors who move faster capture the opportunity.',
    visual: 'problem',
    data: {
      consequences: [
        { icon: 'target', text: 'Lost Market Share', desc: 'First-mover advantage goes to faster competitors' },
        { icon: 'dollar', text: 'Revenue Leakage', desc: 'Opportunities expire before you can act' },
        { icon: 'shield', text: 'Reputation Risk', desc: 'Reactive positioning signals weakness' }
      ]
    }
  },
  {
    id: 'market',
    act: 2,
    actName: 'Problem & Market',
    title: 'The Opportunity',
    subtitle: '$45-60 Billion Total Addressable Market',
    content: 'slide',
    notes: 'This is a massive market at the intersection of strategic planning, business intelligence, and workflow automation. No one owns this space yet.',
    visual: 'market',
    data: {
      tam: '$45-60B',
      sam: '$12B',
      som: '$2.4B',
      segments: [
        'Strategic Planning Software',
        'Business Intelligence',
        'Workflow Automation',
        'Decision Intelligence'
      ]
    }
  },
  
  // ACT 3: PRODUCT DEEP DIVE (8 min)
  {
    id: 'solution',
    act: 3,
    actName: 'Product Deep Dive',
    title: 'Introducing M',
    subtitle: 'The Strategic Execution Operating System',
    content: 'slide',
    notes: 'M is the first platform that connects signals to playbooks to execution to learning. A complete closed-loop system.',
    visual: 'solution',
    data: {
      phases: ['IDENTIFY', 'DETECT', 'EXECUTE', 'ADVANCE'],
      velocity: '12 minutes',
      playbooks: '166'
    }
  },
  {
    id: 'phase-identify',
    act: 3,
    actName: 'Product Deep Dive',
    title: 'IDENTIFY',
    subtitle: 'Build Your Depth Chart',
    content: 'slide',
    notes: '166 pre-built playbooks across 9 strategic domains. Customize with your stakeholders, budgets, and approval workflows. Be ready before signals arrive.',
    visual: 'phase',
    data: {
      phase: 'IDENTIFY',
      icon: 'book',
      color: 'violet',
      features: [
        '166 strategic playbooks across 9 domains',
        'Pre-approved budgets and stakeholders',
        'Customizable triggers and conditions',
        'Enterprise integration templates'
      ]
    }
  },
  {
    id: 'phase-detect',
    act: 3,
    actName: 'Product Deep Dive',
    title: 'DETECT',
    subtitle: 'Monitor Signals',
    content: 'slide',
    notes: 'Our AI continuously monitors 12 intelligence signal categories across 92 data points. It detects weak signals before they become crises and recommends the right playbook.',
    visual: 'phase',
    data: {
      phase: 'DETECT',
      icon: 'eye',
      color: 'blue',
      features: [
        '12 intelligence signal categories',
        '92 monitored data points',
        'Weak signal detection',
        'AI-powered playbook recommendations'
      ]
    }
  },
  {
    id: 'phase-execute',
    act: 3,
    actName: 'Product Deep Dive',
    title: 'EXECUTE',
    subtitle: '12-Minute Coordinated Response',
    content: 'slide',
    notes: 'When a playbook activates, M orchestrates everything: notifications, task assignments, approvals, and integrations. From signal to action in 12 minutes.',
    visual: 'phase',
    data: {
      phase: 'EXECUTE',
      icon: 'zap',
      color: 'amber',
      features: [
        'Real-time stakeholder coordination',
        'Automated task orchestration',
        'Pre-approved budget deployment',
        'Enterprise system integration'
      ]
    }
  },
  {
    id: 'phase-advance',
    act: 3,
    actName: 'Product Deep Dive',
    title: 'ADVANCE',
    subtitle: 'Review the Film',
    content: 'slide',
    notes: 'After each execution, M captures outcomes and uses AI to analyze what worked. It suggests playbook refinements that make you smarter every cycle.',
    visual: 'phase',
    data: {
      phase: 'ADVANCE',
      icon: 'brain',
      color: 'amber',
      features: [
        'Outcome tracking and analysis',
        'AI-powered pattern recognition',
        'Playbook optimization suggestions',
        'Institutional knowledge capture'
      ]
    }
  },
  {
    id: 'demo-transition',
    act: 3,
    actName: 'Product Deep Dive',
    title: 'Live Demo',
    subtitle: 'See M in Action',
    content: 'demo-transition',
    demoTarget: '/executive-simulation',
    notes: 'Now let me show you how this works in practice. I\'ll walk you through a real scenario where a competitor announces a major product launch.',
    visual: 'demo'
  },
  
  // ACT 4: PROOF & TRACTION (5 min)
  {
    id: 'metrics',
    act: 4,
    actName: 'Proof & Traction',
    title: 'The Results',
    subtitle: 'Measurable Impact',
    content: 'slide',
    notes: 'Our early customers are seeing dramatic improvements. 3,180 times faster response. From 72 hours to 12 minutes.',
    visual: 'metrics',
    data: {
      primary: { value: '3,180x', label: 'Faster Response' },
      secondary: [
        { value: '12', unit: 'min', label: 'Average Response Time' },
        { value: '84.4%', label: 'Future Readiness Index' },
        { value: '166', label: 'Strategic Playbooks' }
      ]
    }
  },
  {
    id: 'competitive',
    act: 4,
    actName: 'Proof & Traction',
    title: 'Why M?',
    subtitle: 'The Only Closed-Loop Platform',
    content: 'slide',
    notes: 'Unlike point solutions, M is the only platform that connects all four phases. Palantir does analytics. Anaplan does planning. Dataminr does signals. Only M does execution.',
    visual: 'competitive',
    data: {
      competitors: [
        { name: 'Palantir', has: ['Analytics'], missing: ['Playbooks', 'Execution', 'Learning'] },
        { name: 'Anaplan', has: ['Planning'], missing: ['Signals', 'Execution', 'Learning'] },
        { name: 'Dataminr', has: ['Signals'], missing: ['Playbooks', 'Execution', 'Learning'] },
        { name: 'M', has: ['Signals', 'Playbooks', 'Execution', 'Learning'], missing: [] }
      ]
    }
  },
  {
    id: 'roi',
    act: 4,
    actName: 'Proof & Traction',
    title: 'ROI Calculator',
    subtitle: 'The Business Case',
    content: 'slide',
    notes: 'For a typical Fortune 1000, we estimate $15-40M in annual value from faster response, avoided losses, and captured opportunities.',
    visual: 'metrics',
    data: {
      roi: [
        { category: 'Avoided Revenue Loss', value: '$8-15M', desc: 'Faster threat response' },
        { category: 'Captured Opportunities', value: '$5-20M', desc: 'First-mover advantage' },
        { category: 'Efficiency Gains', value: '$2-5M', desc: 'Reduced coordination time' }
      ],
      total: '$15-40M',
      payback: '< 3 months'
    }
  },
  
  // ACT 5: GROWTH & ASK (6 min)
  {
    id: 'business-model',
    act: 5,
    actName: 'Growth & Ask',
    title: 'Business Model',
    subtitle: 'Enterprise SaaS',
    content: 'slide',
    notes: 'Premium enterprise pricing for Fortune 1000. Three tiers from $250K to $1.5M+ based on company size and deployment scope. Strong land-and-expand motion.',
    visual: 'financial',
    data: {
      pricing: [
        { tier: 'Enterprise', price: '$250K', desc: '3 Business Units, 50 playbooks, Standard integrations' },
        { tier: 'Enterprise Plus', price: '$450K', desc: '10 Business Units, 100 playbooks, Full integration suite' },
        { tier: 'Global', price: '$750K-$1.5M+', desc: 'Unlimited scope, Custom AI, Multi-region' }
      ],
      metrics: [
        { label: 'ACV', value: '$450K' },
        { label: 'Gross Margin', value: '85%' },
        { label: 'NRR Target', value: '130%' }
      ]
    }
  },
  {
    id: 'roadmap',
    act: 5,
    actName: 'Growth & Ask',
    title: 'Growth Path',
    subtitle: '$300M ARR by Year 5',
    content: 'slide',
    notes: 'Land at $250K-$450K, expand to $750K+ as customers add business units. With 130%+ NRR, Year 5 average ACV reaches $750K across 400 enterprise accounts.',
    visual: 'financial',
    data: {
      milestones: [
        { year: 'Year 1', arr: '$12M', customers: 30, focus: 'Product-market fit' },
        { year: 'Year 2', arr: '$40M', customers: 70, focus: 'Scale sales team' },
        { year: 'Year 3', arr: '$100M', customers: 150, focus: 'International expansion' },
        { year: 'Year 5', arr: '$300M', customers: 400, focus: 'Market leadership' }
      ]
    }
  },
  {
    id: 'cta-investors',
    act: 5,
    actName: 'Growth & Ask',
    title: 'For Investors',
    subtitle: 'Join Us in Transforming Strategic Execution',
    content: 'slide',
    notes: 'We\'re raising our Series A to accelerate growth. We\'d love to have you as a partner on this journey.',
    visual: 'cta',
    data: {
      type: 'investor',
      actions: [
        { label: 'Schedule Diligence Session', icon: 'calendar' },
        { label: 'Access Data Room', icon: 'folder' },
        { label: 'Meet the Team', icon: 'users' }
      ]
    }
  },
  {
    id: 'cta-customers',
    act: 5,
    actName: 'Growth & Ask',
    title: 'For Enterprise Leaders',
    subtitle: 'Start Your Strategic Velocity Journey',
    content: 'slide',
    notes: 'For our enterprise customers, we offer a 30-day Strategic Velocity Assessment to prove value before full deployment.',
    visual: 'cta',
    data: {
      type: 'customer',
      actions: [
        { label: '30-Day Strategic Velocity Assessment', icon: 'zap' },
        { label: 'Custom Playbook Configuration', icon: 'settings' },
        { label: 'Executive Workshop', icon: 'presentation' }
      ]
    }
  },
  {
    id: 'closing',
    act: 5,
    actName: 'Growth & Ask',
    title: 'Thank You',
    subtitle: 'Questions?',
    content: 'slide',
    notes: 'Thank you for your time. I\'m happy to answer any questions or dive deeper into any area.',
    visual: 'title',
    data: {
      contact: {
        email: 'hello@m-platform.com',
        website: 'm-platform.com'
      }
    }
  }
];

function InvestorPresentation() {
  const [, setLocation] = useLocation();
  const [currentSlide, setCurrentSlide] = useState(0);
  const [showNotes, setShowNotes] = useState(false);
  const [isFullscreen, setIsFullscreen] = useState(false);

  const slide = PRESENTATION_SLIDES[currentSlide];
  const totalSlides = PRESENTATION_SLIDES.length;
  const progress = ((currentSlide + 1) / totalSlides) * 100;

  const goToNext = useCallback(() => {
    if (currentSlide < totalSlides - 1) {
      setCurrentSlide(prev => prev + 1);
    }
  }, [currentSlide, totalSlides]);

  const goToPrev = useCallback(() => {
    if (currentSlide > 0) {
      setCurrentSlide(prev => prev - 1);
    }
  }, [currentSlide]);

  const goToSlide = useCallback((index: number) => {
    setCurrentSlide(index);
  }, []);

  const toggleFullscreen = useCallback(() => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
      setIsFullscreen(true);
    } else {
      document.exitFullscreen();
      setIsFullscreen(false);
    }
  }, []);

  const launchDemo = useCallback(() => {
    if (slide.demoTarget) {
      window.open(slide.demoTarget, '_blank');
    }
  }, [slide]);

  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      switch (e.key) {
        case 'ArrowRight':
        case ' ':
        case 'Enter':
          e.preventDefault();
          goToNext();
          break;
        case 'ArrowLeft':
        case 'Backspace':
          e.preventDefault();
          goToPrev();
          break;
        case 'f':
          e.preventDefault();
          toggleFullscreen();
          break;
        case 'n':
          e.preventDefault();
          setShowNotes(prev => !prev);
          break;
        case 'Escape':
          if (!document.fullscreenElement) {
            setLocation('/');
          }
          break;
        case 'Home':
          e.preventDefault();
          setCurrentSlide(0);
          break;
        case 'End':
          e.preventDefault();
          setCurrentSlide(totalSlides - 1);
          break;
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [goToNext, goToPrev, toggleFullscreen, setLocation, totalSlides]);

  const renderSlideContent = () => {
    switch (slide.visual) {
      case 'title':
        return (
          <div className="flex flex-col items-center justify-center h-full text-center">
            <motion.div
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ duration: 0.5 }}
            >
              {slide.id === 'title' && (
                <div className="w-32 h-32 bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl flex items-center justify-center mb-8 mx-auto shadow-2xl">
                  <span className="text-6xl font-bold text-white">M</span>
                </div>
              )}
              <h1 className="text-6xl md:text-8xl font-bold text-white mb-6">{slide.title}</h1>
              {slide.subtitle && (
                <p className="text-2xl md:text-3xl text-slate-300">{slide.subtitle}</p>
              )}
              {slide.data?.tagline && (
                <motion.p 
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.3 }}
                  className="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400 mt-8"
                >
                  {slide.data.tagline}
                </motion.p>
              )}
              {slide.data?.description && (
                <motion.p 
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  transition={{ delay: 0.5 }}
                  className="text-xl text-slate-400 mt-4 max-w-2xl"
                >
                  {slide.data.description}
                </motion.p>
              )}
              {slide.data?.contact && (
                <motion.div 
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  transition={{ delay: 0.3 }}
                  className="mt-12 space-y-2"
                >
                  <p className="text-xl text-slate-400">{slide.data.contact.email}</p>
                  <p className="text-lg text-slate-500">{slide.data.contact.website}</p>
                </motion.div>
              )}
            </motion.div>
          </div>
        );

      case 'problem':
        return (
          <div className="flex flex-col items-center justify-center h-full">
            <motion.h2 
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              className="text-5xl font-bold text-white mb-4"
            >
              {slide.title}
            </motion.h2>
            {slide.subtitle && (
              <motion.p 
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                transition={{ delay: 0.2 }}
                className="text-2xl text-slate-400 mb-12"
              >
                {slide.subtitle}
              </motion.p>
            )}
            
            {slide.data?.stats && (
              <div className="grid grid-cols-3 gap-12">
                {slide.data.stats.map((stat: any, i: number) => (
                  <motion.div
                    key={i}
                    initial={{ opacity: 0, y: 30 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.3 + i * 0.15 }}
                    className="text-center"
                  >
                    <div className="w-28 h-28 mx-auto bg-red-500/20 rounded-full flex items-center justify-center mb-4 border border-red-500/30">
                      {i === 0 && <Clock className="w-12 h-12 text-red-400" />}
                      {i === 1 && <Users className="w-12 h-12 text-amber-400" />}
                      {i === 2 && <TrendingUp className="w-12 h-12 text-yellow-400" />}
                    </div>
                    <div className="text-4xl font-bold text-red-400">{stat.value}</div>
                    <div className="text-lg text-slate-400">{stat.unit}</div>
                    <div className="text-sm text-slate-500">{stat.label}</div>
                  </motion.div>
                ))}
              </div>
            )}

            {slide.data?.consequences && (
              <div className="grid grid-cols-3 gap-8 max-w-5xl">
                {slide.data.consequences.map((item: any, i: number) => (
                  <motion.div
                    key={i}
                    initial={{ opacity: 0, y: 30 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.3 + i * 0.15 }}
                    className="bg-slate-800/50 rounded-xl p-6 border border-slate-700"
                  >
                    <div className="w-14 h-14 bg-red-500/20 rounded-xl flex items-center justify-center mb-4">
                      {item.icon === 'target' && <Target className="w-7 h-7 text-red-400" />}
                      {item.icon === 'dollar' && <DollarSign className="w-7 h-7 text-red-400" />}
                      {item.icon === 'shield' && <Shield className="w-7 h-7 text-red-400" />}
                    </div>
                    <h3 className="text-xl font-semibold text-white mb-2">{item.text}</h3>
                    <p className="text-slate-400">{item.desc}</p>
                  </motion.div>
                ))}
              </div>
            )}
          </div>
        );

      case 'market':
        return (
          <div className="flex flex-col items-center justify-center h-full">
            <motion.h2 
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              className="text-5xl font-bold text-white mb-4"
            >
              {slide.title}
            </motion.h2>
            <motion.p 
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.2 }}
              className="text-2xl text-slate-400 mb-12"
            >
              {slide.subtitle}
            </motion.p>
            
            <div className="flex items-center gap-16">
              <motion.div
                initial={{ opacity: 0, scale: 0.8 }}
                animate={{ opacity: 1, scale: 1 }}
                transition={{ delay: 0.3 }}
                className="relative"
              >
                <div className="w-80 h-80 rounded-full bg-gradient-to-br from-blue-500/30 to-purple-500/30 flex items-center justify-center border border-blue-500/50">
                  <div className="w-56 h-56 rounded-full bg-gradient-to-br from-blue-500/40 to-purple-500/40 flex items-center justify-center border border-blue-500/50">
                    <div className="w-32 h-32 rounded-full bg-gradient-to-br from-blue-500/60 to-purple-500/60 flex items-center justify-center border border-blue-500/50">
                      <span className="text-2xl font-bold text-white">{slide.data?.som}</span>
                    </div>
                  </div>
                </div>
                <div className="absolute -top-4 left-1/2 -translate-x-1/2 bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                  <span className="text-lg font-semibold text-blue-400">{slide.data?.tam}</span>
                  <span className="text-sm text-slate-400 ml-2">TAM</span>
                </div>
                <div className="absolute top-16 -right-4 bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                  <span className="text-lg font-semibold text-purple-400">{slide.data?.sam}</span>
                  <span className="text-sm text-slate-400 ml-2">SAM</span>
                </div>
              </motion.div>

              <motion.div
                initial={{ opacity: 0, x: 30 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.5 }}
                className="space-y-4"
              >
                <h3 className="text-xl font-semibold text-white mb-4">Market Segments</h3>
                {slide.data?.segments.map((segment: string, i: number) => (
                  <div key={i} className="flex items-center gap-3">
                    <CheckCircle2 className="w-5 h-5 text-green-400" />
                    <span className="text-lg text-slate-300">{segment}</span>
                  </div>
                ))}
              </motion.div>
            </div>
          </div>
        );

      case 'solution':
        return (
          <div className="flex flex-col items-center justify-center h-full">
            <motion.div
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              className="flex items-center gap-4 mb-4"
            >
              <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center">
                <span className="text-3xl font-bold text-white">M</span>
              </div>
              <h2 className="text-5xl font-bold text-white">{slide.title}</h2>
            </motion.div>
            <motion.p 
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.2 }}
              className="text-2xl text-slate-400 mb-12"
            >
              {slide.subtitle}
            </motion.p>

            <motion.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.4 }}
              className="flex items-center gap-4 mb-12"
            >
              {slide.data?.phases.map((phase: string, i: number) => (
                <div key={phase} className="flex items-center">
                  <div className={`px-6 py-3 rounded-xl font-semibold text-lg ${
                    phase === 'IDENTIFY' ? 'bg-violet-500/20 text-violet-400 border border-violet-500/30' :
                    phase === 'DETECT' ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' :
                    phase === 'EXECUTE' ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30' :
                    'bg-amber-500/20 text-amber-400 border border-amber-500/30'
                  }`}>
                    {phase}
                  </div>
                  {i < 3 && <ArrowRight className="w-6 h-6 text-slate-500 mx-2" />}
                </div>
              ))}
            </motion.div>

            <motion.div
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ delay: 0.6 }}
              className="grid grid-cols-2 gap-8"
            >
              <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700 text-center">
                <div className="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">
                  {slide.data?.velocity}
                </div>
                <div className="text-slate-400 mt-2">Response Time</div>
              </div>
              <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700 text-center">
                <div className="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">
                  {slide.data?.playbooks}
                </div>
                <div className="text-slate-400 mt-2">Strategic Playbooks</div>
              </div>
            </motion.div>
          </div>
        );

      case 'phase':
        const phaseColors: Record<string, { bg: string, border: string, text: string, icon: string }> = {
          IDENTIFY: { bg: 'bg-violet-500/20', border: 'border-violet-500/30', text: 'text-violet-400', icon: 'text-violet-400' },
          DETECT: { bg: 'bg-blue-500/20', border: 'border-blue-500/30', text: 'text-blue-400', icon: 'text-blue-400' },
          EXECUTE: { bg: 'bg-emerald-500/20', border: 'border-emerald-500/30', text: 'text-emerald-400', icon: 'text-emerald-400' },
          ADVANCE: { bg: 'bg-amber-500/20', border: 'border-amber-500/30', text: 'text-amber-400', icon: 'text-amber-400' }
        };
        const colors = phaseColors[slide.data?.phase] || phaseColors.IDENTIFY;
        
        return (
          <div className="flex flex-col items-center justify-center h-full">
            <motion.div
              initial={{ opacity: 0, scale: 0.8 }}
              animate={{ opacity: 1, scale: 1 }}
              className={`w-24 h-24 ${colors.bg} rounded-2xl flex items-center justify-center mb-6 border ${colors.border}`}
            >
              {slide.data?.phase === 'IDENTIFY' && <BookOpen className={`w-12 h-12 ${colors.icon}`} />}
              {slide.data?.phase === 'DETECT' && <Eye className={`w-12 h-12 ${colors.icon}`} />}
              {slide.data?.phase === 'EXECUTE' && <Zap className={`w-12 h-12 ${colors.icon}`} />}
              {slide.data?.phase === 'ADVANCE' && <Brain className={`w-12 h-12 ${colors.icon}`} />}
            </motion.div>
            
            <motion.h2 
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              className={`text-5xl font-bold ${colors.text} mb-4`}
            >
              {slide.title}
            </motion.h2>
            <motion.p 
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.2 }}
              className="text-2xl text-slate-400 mb-12"
            >
              {slide.subtitle}
            </motion.p>

            <motion.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.4 }}
              className="grid grid-cols-2 gap-6 max-w-3xl"
            >
              {slide.data?.features.map((feature: string, i: number) => (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.5 + i * 0.1 }}
                  className="flex items-center gap-3"
                >
                  <CheckCircle2 className={`w-6 h-6 ${colors.text}`} />
                  <span className="text-lg text-slate-300">{feature}</span>
                </motion.div>
              ))}
            </motion.div>
          </div>
        );

      case 'demo':
        return (
          <div className="flex flex-col items-center justify-center h-full">
            <motion.div
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              className="text-center"
            >
              <div className="w-32 h-32 bg-gradient-to-br from-blue-500/20 to-purple-500/20 rounded-full flex items-center justify-center mb-8 mx-auto border border-blue-500/30">
                <Play className="w-16 h-16 text-blue-400" />
              </div>
              <h2 className="text-5xl font-bold text-white mb-4">{slide.title}</h2>
              <p className="text-2xl text-slate-400 mb-8">{slide.subtitle}</p>
              <Button 
                size="lg" 
                onClick={launchDemo}
                className="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white px-8 py-6 text-xl"
                data-testid="button-launch-demo"
              >
                <Play className="w-6 h-6 mr-3" />
                Launch Executive Simulation
              </Button>
              <p className="text-sm text-slate-500 mt-4">Opens in new tab  Return here after demo</p>
            </motion.div>
          </div>
        );

      case 'metrics':
        return (
          <div className="flex flex-col items-center justify-center h-full">
            <motion.h2 
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              className="text-5xl font-bold text-white mb-4"
            >
              {slide.title}
            </motion.h2>
            <motion.p 
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.2 }}
              className="text-2xl text-slate-400 mb-12"
            >
              {slide.subtitle}
            </motion.p>

            {slide.data?.primary && (
              <motion.div
                initial={{ opacity: 0, scale: 0.8 }}
                animate={{ opacity: 1, scale: 1 }}
                transition={{ delay: 0.3 }}
                className="mb-12"
              >
                <div className="text-8xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-400">
                  {slide.data.primary.value}
                </div>
                <div className="text-2xl text-slate-400">{slide.data.primary.label}</div>
              </motion.div>
            )}

            {slide.data?.secondary && (
              <div className="grid grid-cols-3 gap-8">
                {slide.data.secondary.map((metric: any, i: number) => (
                  <motion.div
                    key={i}
                    initial={{ opacity: 0, y: 30 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.5 + i * 0.1 }}
                    className="bg-slate-800/50 rounded-xl p-6 border border-slate-700 text-center"
                  >
                    <div className="text-4xl font-bold text-white">
                      {metric.value}
                      {metric.unit && <span className="text-2xl text-slate-400 ml-1">{metric.unit}</span>}
                    </div>
                    <div className="text-slate-400 mt-2">{metric.label}</div>
                  </motion.div>
                ))}
              </div>
            )}

            {slide.data?.roi && (
              <div className="space-y-6 max-w-2xl w-full">
                {slide.data.roi.map((item: any, i: number) => (
                  <motion.div
                    key={i}
                    initial={{ opacity: 0, x: -30 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: 0.3 + i * 0.15 }}
                    className="flex items-center justify-between bg-slate-800/50 rounded-xl p-5 border border-slate-700"
                  >
                    <div>
                      <div className="text-lg font-semibold text-white">{item.category}</div>
                      <div className="text-sm text-slate-400">{item.desc}</div>
                    </div>
                    <div className="text-2xl font-bold text-green-400">{item.value}</div>
                  </motion.div>
                ))}
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.7 }}
                  className="flex items-center justify-between bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-xl p-5 border border-green-500/30"
                >
                  <div className="text-xl font-semibold text-white">Total Annual Value</div>
                  <div>
                    <span className="text-3xl font-bold text-green-400">{slide.data.total}</span>
                    <span className="text-slate-400 ml-4">Payback: {slide.data.payback}</span>
                  </div>
                </motion.div>
              </div>
            )}
          </div>
        );

      case 'competitive':
        return (
          <div className="flex flex-col items-center justify-center h-full">
            <motion.h2 
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              className="text-5xl font-bold text-white mb-4"
            >
              {slide.title}
            </motion.h2>
            <motion.p 
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.2 }}
              className="text-2xl text-slate-400 mb-12"
            >
              {slide.subtitle}
            </motion.p>

            <motion.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.4 }}
              className="w-full max-w-4xl"
            >
              <div className="grid grid-cols-5 gap-4 mb-4 px-4">
                <div></div>
                <div className="text-center text-sm text-slate-400">Signals</div>
                <div className="text-center text-sm text-slate-400">Playbooks</div>
                <div className="text-center text-sm text-slate-400">Execution</div>
                <div className="text-center text-sm text-slate-400">Learning</div>
              </div>
              {slide.data?.competitors.map((comp: any, i: number) => (
                <motion.div
                  key={comp.name}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.5 + i * 0.1 }}
                  className={`grid grid-cols-5 gap-4 p-4 rounded-xl mb-2 ${
                    comp.name === 'M' 
                      ? 'bg-gradient-to-r from-blue-500/20 to-purple-500/20 border border-blue-500/30' 
                      : 'bg-slate-800/50 border border-slate-700'
                  }`}
                >
                  <div className={`font-semibold ${comp.name === 'M' ? 'text-blue-400' : 'text-white'}`}>
                    {comp.name}
                  </div>
                  {['Signals', 'Playbooks', 'Execution', 'Learning'].map((cap) => (
                    <div key={cap} className="flex justify-center">
                      {comp.has.includes(cap) ? (
                        <CheckCircle2 className="w-6 h-6 text-green-400" />
                      ) : (
                        <AlertTriangle className="w-6 h-6 text-slate-600" />
                      )}
                    </div>
                  ))}
                </motion.div>
              ))}
            </motion.div>
          </div>
        );

      case 'financial':
        return (
          <div className="flex flex-col items-center justify-center h-full">
            <motion.h2 
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              className="text-5xl font-bold text-white mb-4"
            >
              {slide.title}
            </motion.h2>
            <motion.p 
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.2 }}
              className="text-2xl text-slate-400 mb-12"
            >
              {slide.subtitle}
            </motion.p>

            {slide.data?.pricing && (
              <div className="grid grid-cols-3 gap-6 mb-8">
                {slide.data.pricing.map((tier: any, i: number) => (
                  <motion.div
                    key={tier.tier}
                    initial={{ opacity: 0, y: 30 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.3 + i * 0.1 }}
                    className={`bg-slate-800/50 rounded-xl p-6 border ${
                      i === 2 ? 'border-blue-500/50 ring-2 ring-blue-500/20' : 'border-slate-700'
                    }`}
                  >
                    <div className="text-lg font-semibold text-white mb-2">{tier.tier}</div>
                    <div className="text-3xl font-bold text-blue-400 mb-4">{tier.price}<span className="text-sm text-slate-400">/year</span></div>
                    <div className="text-sm text-slate-400">{tier.desc}</div>
                  </motion.div>
                ))}
              </div>
            )}

            {slide.data?.metrics && (
              <motion.div
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                transition={{ delay: 0.6 }}
                className="flex gap-12"
              >
                {slide.data.metrics.map((m: any) => (
                  <div key={m.label} className="text-center">
                    <div className="text-3xl font-bold text-white">{m.value}</div>
                    <div className="text-sm text-slate-400">{m.label}</div>
                  </div>
                ))}
              </motion.div>
            )}

            {slide.data?.milestones && (
              <div className="w-full max-w-4xl">
                <div className="flex items-end justify-between gap-4 mb-8">
                  {slide.data.milestones.map((m: any, i: number) => (
                    <motion.div
                      key={m.year}
                      initial={{ opacity: 0, height: 0 }}
                      animate={{ opacity: 1, height: 'auto' }}
                      transition={{ delay: 0.3 + i * 0.15 }}
                      className="flex-1"
                    >
                      <div 
                        className="bg-gradient-to-t from-blue-500/40 to-purple-500/40 rounded-t-lg border border-blue-500/30 flex items-end justify-center"
                        style={{ height: `${40 + i * 50}px` }}
                      >
                        <span className="text-white font-bold pb-2">{m.arr}</span>
                      </div>
                      <div className="bg-slate-800 rounded-b-lg p-3 border border-slate-700 border-t-0 text-center">
                        <div className="font-semibold text-white">{m.year}</div>
                        <div className="text-xs text-slate-400">{m.customers} customers</div>
                        <div className="text-xs text-blue-400">{m.focus}</div>
                      </div>
                    </motion.div>
                  ))}
                </div>
              </div>
            )}
          </div>
        );

      case 'cta':
        return (
          <div className="flex flex-col items-center justify-center h-full">
            <motion.h2 
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              className="text-5xl font-bold text-white mb-4"
            >
              {slide.title}
            </motion.h2>
            <motion.p 
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.2 }}
              className="text-2xl text-slate-400 mb-12"
            >
              {slide.subtitle}
            </motion.p>

            <motion.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.4 }}
              className="space-y-4"
            >
              {slide.data?.actions.map((action: any, i: number) => (
                <motion.div
                  key={action.label}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.5 + i * 0.1 }}
                  className="flex items-center gap-4 bg-slate-800/50 rounded-xl p-5 border border-slate-700 hover:border-blue-500/50 transition-colors cursor-pointer min-w-[400px]"
                >
                  <div className="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                    {action.icon === 'calendar' && <BarChart3 className="w-6 h-6 text-blue-400" />}
                    {action.icon === 'folder' && <FileText className="w-6 h-6 text-blue-400" />}
                    {action.icon === 'users' && <Users className="w-6 h-6 text-blue-400" />}
                    {action.icon === 'zap' && <Zap className="w-6 h-6 text-blue-400" />}
                    {action.icon === 'settings' && <Settings className="w-6 h-6 text-blue-400" />}
                    {action.icon === 'presentation' && <Monitor className="w-6 h-6 text-blue-400" />}
                  </div>
                  <span className="text-lg text-white">{action.label}</span>
                  <ArrowRight className="w-5 h-5 text-slate-400 ml-auto" />
                </motion.div>
              ))}
            </motion.div>
          </div>
        );

      default:
        return null;
    }
  };

  return (
    <div 
      className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex flex-col"
      data-testid="page-investor-presentation"
    >
      {/* Top Bar */}
      <div className="flex items-center justify-between px-6 py-3 bg-slate-900/80 border-b border-slate-700/50">
        <div className="flex items-center gap-4">
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setLocation('/')}
            className="text-slate-400 hover:text-white"
            data-testid="button-exit"
          >
            <ChevronLeft className="w-4 h-4 mr-1" />
            Exit
          </Button>
          <div className="text-sm text-slate-400">
            Act {slide.act}: <span className="text-white">{slide.actName}</span>
          </div>
        </div>

        <div className="flex items-center gap-4">
          <div className="text-sm text-slate-400">
            Slide {currentSlide + 1} of {totalSlides}
          </div>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setShowNotes(!showNotes)}
            className={showNotes ? 'text-blue-400' : 'text-slate-400'}
            data-testid="button-toggle-notes"
          >
            <FileText className="w-4 h-4 mr-1" />
            Notes
          </Button>
          <Button
            variant="ghost"
            size="sm"
            onClick={toggleFullscreen}
            className="text-slate-400 hover:text-white"
            data-testid="button-fullscreen"
          >
            <Maximize2 className="w-4 h-4" />
          </Button>
        </div>
      </div>

      {/* Progress Bar */}
      <div className="h-1 bg-slate-700">
        <div 
          className="h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300"
          style={{ width: `${progress}%` }}
        />
      </div>

      {/* Main Content */}
      <div className="flex-1 flex">
        {/* Slide Content */}
        <div className={`flex-1 p-8 ${showNotes ? 'pr-4' : ''}`}>
          <AnimatePresence mode="wait">
            <motion.div
              key={slide.id}
              initial={{ opacity: 0, x: 50 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -50 }}
              transition={{ duration: 0.3 }}
              className="h-full"
            >
              {renderSlideContent()}
            </motion.div>
          </AnimatePresence>
        </div>

        {/* Notes Panel */}
        <AnimatePresence>
          {showNotes && (
            <motion.div
              initial={{ width: 0, opacity: 0 }}
              animate={{ width: 320, opacity: 1 }}
              exit={{ width: 0, opacity: 0 }}
              className="bg-slate-800/50 border-l border-slate-700 overflow-hidden"
            >
              <div className="p-6 w-80">
                <h3 className="text-sm font-semibold text-slate-400 mb-3 flex items-center gap-2">
                  <FileText className="w-4 h-4" />
                  Speaker Notes
                </h3>
                <p className="text-sm text-slate-300 leading-relaxed">
                  {slide.notes}
                </p>

                {slide.content === 'demo-transition' && (
                  <div className="mt-6 p-4 bg-blue-500/10 rounded-lg border border-blue-500/20">
                    <p className="text-sm text-blue-400">
                      Click the button to launch the live demo in a new tab.
                    </p>
                  </div>
                )}
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>

      {/* Bottom Navigation */}
      <div className="px-6 py-4 bg-slate-900/80 border-t border-slate-700/50">
        <div className="flex items-center justify-between">
          {/* Act indicators */}
          <div className="flex items-center gap-2">
            {[1, 2, 3, 4, 5].map((act) => {
              const actSlides = PRESENTATION_SLIDES.filter(s => s.act === act);
              const firstIndex = PRESENTATION_SLIDES.findIndex(s => s.act === act);
              const isActive = slide.act === act;
              const actNames = ['Hook', 'Problem', 'Product', 'Proof', 'Ask'];
              
              return (
                <button
                  key={act}
                  onClick={() => goToSlide(firstIndex)}
                  className={`px-3 py-1.5 rounded-lg text-sm transition-colors ${
                    isActive 
                      ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' 
                      : 'text-slate-400 hover:text-white hover:bg-slate-700'
                  }`}
                  data-testid={`button-act-${act}`}
                >
                  {actNames[act - 1]}
                </button>
              );
            })}
          </div>

          {/* Navigation buttons */}
          <div className="flex items-center gap-4">
            <Button
              variant="outline"
              onClick={goToPrev}
              disabled={currentSlide === 0}
              className="border-slate-600"
              data-testid="button-prev"
            >
              <ChevronLeft className="w-4 h-4 mr-1" />
              Previous
            </Button>
            <Button
              onClick={goToNext}
              disabled={currentSlide === totalSlides - 1}
              className="bg-blue-500 hover:bg-blue-600"
              data-testid="button-next"
            >
              Next
              <ChevronRight className="w-4 h-4 ml-1" />
            </Button>
          </div>

          {/* Keyboard shortcuts hint */}
          <div className="text-xs text-slate-500">
            <span className="px-1.5 py-0.5 bg-slate-700 rounded mr-1"></span>
            <span className="px-1.5 py-0.5 bg-slate-700 rounded mr-2"></span>
            navigate
            <span className="px-1.5 py-0.5 bg-slate-700 rounded mx-1 ml-4">F</span>
            fullscreen
            <span className="px-1.5 py-0.5 bg-slate-700 rounded mx-1 ml-4">N</span>
            notes
          </div>
        </div>
      </div>
    </div>
  );
}

// Wrap component with navigation
const InvestorPresentationWithNav = () => {
  return (
    <div className="flex flex-col min-h-screen bg-slate-950">
      <StandardNav />
      <div className="flex-1">
        <InvestorPresentation />
      </div>
    </div>
  );
};

export default InvestorPresentationWithNav;


========================================
FILE: client/src/pages/InvestorResources.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { 
  TrendingUp, 
  Clock, 
  Users, 
  DollarSign, 
  Zap, 
  Target, 
  BookOpen, 
  Radio,
  ArrowRight,
  Download,
  CheckCircle2,
  BarChart3,
  Shield,
  Lightbulb
} from "lucide-react";
import { Link } from "wouter";
import StandardNav from "@/components/layout/StandardNav";
import { useEffect } from "react";
import { updatePageMetadata } from "@/lib/seo";

export default function InvestorResources() {
  useEffect(() => {
    updatePageMetadata({
      title: "Investor Resources | M Strategic Execution Operating System",
      description: "Investment overview for M, the first Strategic Execution Operating System. Creating a new $5B+ software category for Fortune 1000 strategic execution.",
      ogTitle: "Invest in M - Category-Defining Opportunity",
      ogDescription: "Transform 72-hour strategic coordination into 12-minute execution. First-mover in Strategic Execution Operating System (SEOS) category.",
    });
  }, []);

  return (
    <div className="min-h-screen bg-background text-foreground">
      <StandardNav />

      {/* Hero Section */}
      <section className="py-20 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
        <div className="max-w-5xl mx-auto text-center">
          <Badge className="mb-6 bg-blue-500 text-white border-0">
            Investor Overview
          </Badge>
          
          <h1 className="text-4xl md:text-6xl font-bold mb-6 leading-tight" data-testid="heading-investor">
            We're Creating a New Category
          </h1>
          
          <p className="text-xl md:text-2xl text-blue-100 mb-4 max-w-3xl mx-auto">
            <span className="font-bold">Strategic Execution Operating System (SEOS)</span>
          </p>
          
          <p className="text-lg text-blue-200 mb-8 max-w-2xl mx-auto">
            What Salesforce did for customer relationships, M does for strategic execution.
          </p>

          <div className="flex gap-4 justify-center flex-wrap">
            <Link href="/investor-presentation">
              <Button size="lg" className="bg-white text-slate-900 hover:bg-slate-100">
                View Presentation
                <ArrowRight className="ml-2 h-5 w-5" />
              </Button>
            </Link>
            <Link href="/demo-selector">
              <Button size="lg" variant="outline" className="border-white text-white hover:bg-white/10">
                Watch Demo
              </Button>
            </Link>
          </div>
        </div>
      </section>

      {/* Key Investment Thesis */}
      <section className="py-16 px-6 bg-slate-50 dark:bg-slate-900">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-3xl font-bold text-foreground mb-4">The Investment Thesis</h2>
          </div>

          <div className="grid md:grid-cols-2 gap-8 mb-12">
            {/* The Problem */}
            <Card className="border-2 border-red-500/30">
              <CardHeader>
                <CardTitle className="flex items-center gap-2 text-red-500">
                  <Clock className="h-6 w-6" />
                  The Problem: 72-Hour Gap
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <p className="text-muted-foreground">
                  When significant strategic events occur, most organizations experience:
                </p>
                <ul className="space-y-2 text-sm text-muted-foreground">
                  <li className="flex items-start gap-2">
                    <span className="text-red-400 font-medium">0-4 hrs:</span>
                    <span>Discovery and initial confusion</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-red-400 font-medium">4-12 hrs:</span>
                    <span>Ad-hoc calls to identify who should be involved</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-red-400 font-medium">12-24 hrs:</span>
                    <span>Scramble to find relevant documents and data</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-red-400 font-medium">24-48 hrs:</span>
                    <span>Debate about authority, budget, and approach</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-red-400 font-medium">48-72 hrs:</span>
                    <span>Finally begin coordinated response</span>
                  </li>
                </ul>
                <p className="text-foreground font-semibold pt-2">
                  This is how every Fortune 500 operates today.
                </p>
              </CardContent>
            </Card>

            {/* The Solution */}
            <Card className="border-2 border-green-500/30">
              <CardHeader>
                <CardTitle className="flex items-center gap-2 text-green-500">
                  <Zap className="h-6 w-6" />
                  M's Solution: 12-Minute Activation
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <p className="text-muted-foreground">
                  M fundamentally changes the operating model:
                </p>
                <ul className="space-y-2 text-sm">
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="h-4 w-4 text-green-500 mt-0.5" />
                    <span className="text-foreground">Signal detected  Pre-configured monitoring triggers alert</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="h-4 w-4 text-green-500 mt-0.5" />
                    <span className="text-foreground">Playbook activates  Pre-staged, pre-assigned, pre-approved</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="h-4 w-4 text-green-500 mt-0.5" />
                    <span className="text-foreground">Tasks deploy  Auto-created in Jira/ServiceNow/Asana</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="h-4 w-4 text-green-500 mt-0.5" />
                    <span className="text-foreground">Teams execute  Clear ownership, no ambiguity</span>
                  </li>
                </ul>
                <div className="pt-4 p-4 bg-green-500/10 rounded-lg text-center">
                  <p className="text-2xl font-bold text-green-500">12 minutes</p>
                  <p className="text-sm text-muted-foreground">Coordinated response underway</p>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Key Metrics */}
      <section className="py-16 px-6">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-3xl font-bold text-foreground mb-4">Platform Metrics</h2>
          </div>

          <div className="grid grid-cols-2 md:grid-cols-4 gap-6 mb-12">
            <Card className="text-center">
              <CardContent className="pt-6">
                <div className="text-4xl font-bold text-primary mb-2">166</div>
                <div className="text-sm text-muted-foreground">Strategic Playbooks</div>
                <div className="text-xs text-muted-foreground mt-1">Across 9 domains</div>
              </CardContent>
            </Card>
            <Card className="text-center">
              <CardContent className="pt-6">
                <div className="text-4xl font-bold text-primary mb-2">92+</div>
                <div className="text-sm text-muted-foreground">Data Points Monitored</div>
                <div className="text-xs text-muted-foreground mt-1">Real-time signals</div>
              </CardContent>
            </Card>
            <Card className="text-center">
              <CardContent className="pt-6">
                <div className="text-4xl font-bold text-primary mb-2">12 min</div>
                <div className="text-sm text-muted-foreground">Response Time</div>
                <div className="text-xs text-muted-foreground mt-1">vs 72 hrs industry avg</div>
              </CardContent>
            </Card>
            <Card className="text-center">
              <CardContent className="pt-6">
                <div className="text-4xl font-bold text-primary mb-2">24/7</div>
                <div className="text-sm text-muted-foreground">AI Intelligence</div>
                <div className="text-xs text-muted-foreground mt-1">Continuous monitoring</div>
              </CardContent>
            </Card>
          </div>

          {/* The 4-Phase Lifecycle */}
          <Card className="mb-12">
            <CardHeader>
              <CardTitle>The M Framework: 4-Phase Lifecycle</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid md:grid-cols-4 gap-4">
                <div className="p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
                  <div className="flex items-center gap-2 mb-3">
                    <Target className="h-5 w-5 text-blue-500" />
                    <span className="font-bold text-blue-500">PREPARE</span>
                  </div>
                  <p className="text-sm text-muted-foreground">
                    Stakeholders assigned, documents staged, budgets pre-approved, authorities delegated
                  </p>
                </div>
                <div className="p-4 rounded-lg bg-cyan-500/10 border border-cyan-500/30">
                  <div className="flex items-center gap-2 mb-3">
                    <Radio className="h-5 w-5 text-cyan-500" />
                    <span className="font-bold text-cyan-500">MONITOR</span>
                  </div>
                  <p className="text-sm text-muted-foreground">
                    92+ signals tracked, triggers configured, alerts routed
                  </p>
                </div>
                <div className="p-4 rounded-lg bg-green-500/10 border border-green-500/30">
                  <div className="flex items-center gap-2 mb-3">
                    <Zap className="h-5 w-5 text-green-500" />
                    <span className="font-bold text-green-500">EXECUTE</span>
                  </div>
                  <p className="text-sm text-muted-foreground">
                    One-click activation, auto-project creation, coordinated tasks
                  </p>
                </div>
                <div className="p-4 rounded-lg bg-purple-500/10 border border-purple-500/30">
                  <div className="flex items-center gap-2 mb-3">
                    <BookOpen className="h-5 w-5 text-purple-500" />
                    <span className="font-bold text-purple-500">LEARN</span>
                  </div>
                  <p className="text-sm text-muted-foreground">
                    Structured debriefs, metrics captured, playbooks improved
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Value Per Event */}
      <section className="py-16 px-6 bg-slate-50 dark:bg-slate-900">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-3xl font-bold text-foreground mb-4">ROI Per Strategic Event</h2>
            <p className="text-muted-foreground max-w-2xl mx-auto">
              M pays for itself on the first significant event
            </p>
          </div>

          <Card className="mb-8">
            <CardContent className="p-8">
              <div className="grid md:grid-cols-4 gap-6 text-center">
                <div className="p-4 border-r border-border">
                  <div className="text-2xl font-bold text-foreground mb-1">$10K-25K</div>
                  <div className="text-sm text-muted-foreground">Planning Elimination</div>
                  <div className="text-xs text-muted-foreground mt-1">20-50 hrs  $500/hr</div>
                </div>
                <div className="p-4 border-r border-border">
                  <div className="text-2xl font-bold text-foreground mb-1">$500K-2M</div>
                  <div className="text-sm text-muted-foreground">Revenue Protected</div>
                  <div className="text-xs text-muted-foreground mt-1">Faster execution</div>
                </div>
                <div className="p-4 border-r border-border">
                  <div className="text-2xl font-bold text-foreground mb-1">$50K+</div>
                  <div className="text-sm text-muted-foreground">Executive Time</div>
                  <div className="text-xs text-muted-foreground mt-1">50+ hrs  $1K/hr</div>
                </div>
                <div className="p-4">
                  <div className="text-2xl font-bold text-foreground mb-1">$50-100K</div>
                  <div className="text-sm text-muted-foreground">Tool Consolidation</div>
                  <div className="text-xs text-muted-foreground mt-1">Annual savings</div>
                </div>
              </div>
              <div className="mt-6 p-4 bg-primary/10 rounded-lg text-center">
                <div className="text-3xl font-bold text-primary mb-2">$60K - $2M+</div>
                <div className="text-sm text-muted-foreground">Total value per major event</div>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Competitive Differentiation */}
      <section className="py-16 px-6">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-3xl font-bold text-foreground mb-4">Competitive Differentiation</h2>
            <p className="text-muted-foreground">
              M owns the category between strategic preparation and operational execution
            </p>
          </div>

          <Card>
            <CardContent className="p-0">
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b border-border bg-muted/50">
                      <th className="text-left py-4 px-6 font-semibold">Capability</th>
                      <th className="text-center py-4 px-4 font-semibold">Crisis Tools</th>
                      <th className="text-center py-4 px-4 font-semibold">PM Tools</th>
                      <th className="text-center py-4 px-4 font-semibold text-primary">M</th>
                    </tr>
                  </thead>
                  <tbody className="text-muted-foreground">
                    <tr className="border-b border-border">
                      <td className="py-3 px-6">Alert/notify stakeholders</td>
                      <td className="py-3 px-4 text-center"><CheckCircle2 className="h-4 w-4 text-green-500 mx-auto" /></td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center"><CheckCircle2 className="h-4 w-4 text-primary mx-auto" /></td>
                    </tr>
                    <tr className="border-b border-border">
                      <td className="py-3 px-6">Pre-built response playbooks</td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center"><CheckCircle2 className="h-4 w-4 text-primary mx-auto" /></td>
                    </tr>
                    <tr className="border-b border-border">
                      <td className="py-3 px-6">Auto-create project structure</td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center"><CheckCircle2 className="h-4 w-4 text-primary mx-auto" /></td>
                    </tr>
                    <tr className="border-b border-border">
                      <td className="py-3 px-6">Assign tasks with acceptance criteria</td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center text-muted-foreground">Manual</td>
                      <td className="py-3 px-4 text-center font-medium text-primary">Auto</td>
                    </tr>
                    <tr className="border-b border-border">
                      <td className="py-3 px-6">Stage documents and templates</td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center"><CheckCircle2 className="h-4 w-4 text-primary mx-auto" /></td>
                    </tr>
                    <tr className="border-b border-border">
                      <td className="py-3 px-6">Unlock pre-approved budgets</td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center"><CheckCircle2 className="h-4 w-4 text-primary mx-auto" /></td>
                    </tr>
                    <tr className="border-b border-border">
                      <td className="py-3 px-6">Sync to existing PM tools</td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center text-muted-foreground">N/A</td>
                      <td className="py-3 px-4 text-center"><CheckCircle2 className="h-4 w-4 text-primary mx-auto" /></td>
                    </tr>
                    <tr>
                      <td className="py-3 px-6">Institutional learning loop</td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center text-red-400"></td>
                      <td className="py-3 px-4 text-center"><CheckCircle2 className="h-4 w-4 text-primary mx-auto" /></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Founder */}
      <section className="py-16 px-6 bg-slate-50 dark:bg-slate-900">
        <div className="max-w-4xl mx-auto">
          <Card className="border-2 border-primary/30">
            <CardContent className="p-8">
              <div className="flex flex-col md:flex-row items-center gap-8">
                <div className="w-24 h-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-3xl font-bold shrink-0">
                  MB
                </div>
                <div>
                  <div className="flex items-center gap-2 mb-2">
                    <Lightbulb className="h-5 w-5 text-primary" />
                    <span className="text-sm font-medium text-primary">Founder-Market Fit</span>
                  </div>
                  <h3 className="text-2xl font-bold text-foreground mb-2">Marty Brunke</h3>
                  <p className="text-muted-foreground mb-4">
                    5 years collegiate football coaching + 20+ years Fortune 500 strategic execution 
                    (Ford, Toyota, Lockheed Martin, Eli Lilly, Boyd Gaming, Charles Schwab)
                  </p>
                  <p className="text-foreground italic">
                    "Business has no operating system for coordinated response. We're building it."
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* CTA */}
      <section className="py-16 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
        <div className="max-w-3xl mx-auto text-center">
          <h2 className="text-3xl font-bold mb-6">
            Ready to Learn More?
          </h2>
          <p className="text-xl text-blue-100 mb-8">
            See M in action and explore the category-defining opportunity.
          </p>
          <div className="flex gap-4 justify-center flex-wrap">
            <Link href="/investor-presentation">
              <Button size="lg" className="bg-white text-slate-900 hover:bg-slate-100">
                <BarChart3 className="mr-2 h-5 w-5" />
                Full Presentation
              </Button>
            </Link>
            <Link href="/demo-selector">
              <Button size="lg" variant="outline" className="border-white text-white hover:bg-white/10">
                Watch Demo
              </Button>
            </Link>
            <Link href="/contact">
              <Button size="lg" variant="outline" className="border-white text-white hover:bg-white/10">
                Contact Marty
              </Button>
            </Link>
          </div>
        </div>
      </section>
    </div>
  );
}


========================================
FILE: client/src/pages/Landing.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Radio, Radar, Sparkles, BookMarked, Dumbbell, RefreshCw, Zap, Play, ArrowRight, Clock, Timer, ChevronRight, Users, Brain, Target, DollarSign, AlertTriangle, TrendingUp, Shield, Building2, CheckCircle2, X } from "lucide-react";
import { Link } from "wouter";
import StandardNav from "@/components/layout/StandardNav";

export default function Landing() {
  return (
    <div className="min-h-screen bg-background text-foreground flex flex-col">
      <StandardNav />
      
      {/* Hero Section */}
      <div className="flex-1 flex items-center justify-center py-24 px-4">
        <div className="max-w-5xl w-full">
          <div className="text-center mb-16">
            <Badge className="bg-primary text-primary-foreground mb-8 px-4 py-2 text-sm font-semibold inline-flex items-center" data-testid="badge-hero">
              <Radio className="w-4 h-4 mr-2 animate-pulse" />
              STRATEGIC EXECUTION OPERATING SYSTEM
            </Badge>
            
            {/* The Transformation Message */}
            <div className="mb-8">
              <div className="flex items-center justify-center gap-4 md:gap-8 mb-6">
                <div className="text-center">
                  <div className="text-4xl md:text-6xl font-bold text-red-500 line-through opacity-60">72 hrs</div>
                  <div className="text-sm text-muted-foreground mt-1">Industry Average</div>
                </div>
                <ChevronRight className="h-8 w-8 md:h-12 md:w-12 text-primary animate-pulse" />
                <div className="text-center">
                  <div className="text-4xl md:text-6xl font-bold text-primary">12 min</div>
                  <div className="text-sm text-muted-foreground mt-1">With M</div>
                </div>
              </div>
              <p className="text-lg text-muted-foreground max-w-2xl mx-auto">
                Pre-staged playbooks. Coordinated stakeholders. Instant activation.
              </p>
            </div>
            
            <h1 className="text-4xl md:text-5xl font-bold text-foreground mb-6 leading-tight" data-testid="heading-hero">
              From 72 Hours to 12 Minutes.{" "}
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary to-emerald-400">
                Deterministic Strategic Execution.
              </span>
            </h1>
            <p className="text-xl text-muted-foreground mb-4 leading-relaxed max-w-3xl mx-auto" data-testid="text-hero-subtitle">
              No fragmented tools. No experimental AI. Just battle-tested playbooks 
              that transform how Fortune 1000 companies respond to the moments that matter.
            </p>
            
            <div className="flex gap-4 justify-center flex-wrap">
              <Link href="/demo-selector">
                <Button size="lg" className="px-8 py-6 text-lg" data-testid="button-view-demo">
                  <Play className="mr-2 h-5 w-5" />
                  Watch Live Demo
                </Button>
              </Link>
              
              <Link href="/new-user-journey">
                <Button 
                  size="lg"
                  variant="outline"
                  className="px-8 py-6 text-lg"
                  data-testid="button-get-started"
                >
                  Get Started
                  <ArrowRight className="ml-2 h-5 w-5" />
                </Button>
              </Link>
            </div>
          </div>

          {/* Problem Statement Block - The 72-Hour Gap */}
          <div className="mb-16">
            <div className="text-center mb-8">
              <h2 className="text-3xl font-bold text-foreground mb-3">
                The 72-Hour Gap
              </h2>
              <p className="text-muted-foreground max-w-2xl mx-auto">
                When strategic disruptions hit  competitor moves, cyber incidents, 
                regulatory changes, executive departures  most organizations scramble. 
                Not because they lack talent. Because they lack a system.
              </p>
            </div>
            
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <Card className="bg-gradient-to-br from-red-500/10 to-red-600/5 border-red-500/20">
                <CardContent className="p-6 text-center">
                  <AlertTriangle className="h-8 w-8 text-red-500 mx-auto mb-3" />
                  <div className="text-4xl font-bold text-red-500 mb-2">91%</div>
                  <p className="text-sm text-muted-foreground">of organizations experienced at least one major disruption</p>
                  <p className="text-xs text-muted-foreground/60 mt-2">Source: PwC 2023</p>
                </CardContent>
              </Card>
              
              <Card className="bg-gradient-to-br from-orange-500/10 to-orange-600/5 border-orange-500/20">
                <CardContent className="p-6 text-center">
                  <Clock className="h-8 w-8 text-orange-500 mx-auto mb-3" />
                  <div className="text-4xl font-bold text-orange-500 mb-2">72 hrs</div>
                  <p className="text-sm text-muted-foreground">typical time to coordinate strategic response</p>
                  <p className="text-xs text-muted-foreground/60 mt-2">Source: McKinsey</p>
                </CardContent>
              </Card>
              
              <Card className="bg-gradient-to-br from-yellow-500/10 to-yellow-600/5 border-yellow-500/20">
                <CardContent className="p-6 text-center">
                  <DollarSign className="h-8 w-8 text-yellow-500 mx-auto mb-3" />
                  <div className="text-4xl font-bold text-yellow-500 mb-2">$4.88M</div>
                  <p className="text-sm text-muted-foreground">average cost per major incident</p>
                  <p className="text-xs text-muted-foreground/60 mt-2">Source: IBM 2024</p>
                </CardContent>
              </Card>
              
              <Card className="bg-gradient-to-br from-purple-500/10 to-purple-600/5 border-purple-500/20">
                <CardContent className="p-6 text-center">
                  <Timer className="h-8 w-8 text-purple-500 mx-auto mb-3" />
                  <div className="text-4xl font-bold text-purple-500 mb-2">194</div>
                  <p className="text-sm text-muted-foreground">days average time to even identify a breach</p>
                  <p className="text-xs text-muted-foreground/60 mt-2">Source: IBM 2024</p>
                </CardContent>
              </Card>
            </div>
          </div>

          {/* ROI / Value Proposition Block */}
          <div className="mb-16">
            <div className="text-center mb-8">
              <h2 className="text-3xl font-bold text-foreground mb-3">
                The Math is Simple: Faster Response = Lower Cost
              </h2>
              <p className="text-muted-foreground max-w-2xl mx-auto">
                Research proves that speed and preparation save millions. M delivers both.
              </p>
            </div>
            
            <div className="grid md:grid-cols-2 gap-6">
              <Card className="border-2 border-green-500/30 hover:border-green-500/50 transition-colors">
                <CardContent className="p-6">
                  <div className="flex items-start gap-4">
                    <div className="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center shrink-0">
                      <DollarSign className="h-6 w-6 text-green-500" />
                    </div>
                    <div>
                      <div className="text-3xl font-bold text-green-500 mb-2">$1.76M</div>
                      <p className="text-foreground font-medium mb-2">Saved by containing incidents within 30 days</p>
                      <p className="text-sm text-muted-foreground">M's pre-staged playbooks get you to coordinated response in minutes, not weeks.</p>
                      <p className="text-xs text-muted-foreground/60 mt-2">Source: IBM Cost of Data Breach 2024</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
              
              <Card className="border-2 border-green-500/30 hover:border-green-500/50 transition-colors">
                <CardContent className="p-6">
                  <div className="flex items-start gap-4">
                    <div className="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center shrink-0">
                      <Users className="h-6 w-6 text-green-500" />
                    </div>
                    <div>
                      <div className="text-3xl font-bold text-green-500 mb-2">35%</div>
                      <p className="text-foreground font-medium mb-2">Lower costs with pre-defined response teams</p>
                      <p className="text-sm text-muted-foreground">M provides 166 pre-built playbooks with pre-assigned stakeholders, pre-approved budgets, and pre-staged resources.</p>
                      <p className="text-xs text-muted-foreground/60 mt-2">Source: IBM/Ponemon 2024</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
              
              <Card className="border-2 border-green-500/30 hover:border-green-500/50 transition-colors">
                <CardContent className="p-6">
                  <div className="flex items-start gap-4">
                    <div className="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center shrink-0">
                      <Zap className="h-6 w-6 text-green-500" />
                    </div>
                    <div>
                      <div className="text-3xl font-bold text-green-500 mb-2">$2.2M</div>
                      <p className="text-foreground font-medium mb-2">Saved per incident with automation</p>
                      <p className="text-sm text-muted-foreground">M automatically creates projects in Jira, notifies stakeholders via Slack, and orchestrates coordinated execution.</p>
                      <p className="text-xs text-muted-foreground/60 mt-2">Source: IBM 2024</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
              
              <Card className="border-2 border-green-500/30 hover:border-green-500/50 transition-colors">
                <CardContent className="p-6">
                  <div className="flex items-start gap-4">
                    <div className="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center shrink-0">
                      <TrendingUp className="h-6 w-6 text-green-500" />
                    </div>
                    <div>
                      <div className="text-3xl font-bold text-green-500 mb-2">98 days</div>
                      <p className="text-foreground font-medium mb-2">Faster response with AI and automation</p>
                      <p className="text-sm text-muted-foreground">M's continuous monitoring and instant activation compress this even further.</p>
                      <p className="text-xs text-muted-foreground/60 mt-2">Source: IBM 2024</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
          </div>

          {/* Strategic Control Tower Section */}
          <div className="mb-16 py-12 bg-gradient-to-b from-slate-900/50 to-transparent rounded-2xl">
            <div className="text-center mb-12">
              <Badge className="mb-4 bg-blue-500/20 text-blue-400 border-blue-500/30">
                Command & Control
              </Badge>
              <h2 className="text-3xl font-bold text-foreground mb-4">
                The Strategic Control Tower
              </h2>
              <p className="text-lg text-muted-foreground max-w-2xl mx-auto">
                Real-time visibility into every active playbook, stakeholder status, 
                and execution metric  with full audit trail for compliance.
              </p>
            </div>
            
            <div className="grid md:grid-cols-4 gap-6">
              <Card className="bg-slate-800/50 border-violet-500/30 hover:border-violet-500/50 transition-colors">
                <CardContent className="p-6 text-center">
                  <div className="w-12 h-12 mx-auto mb-4 rounded-xl bg-violet-500/20 flex items-center justify-center">
                    <Target className="h-6 w-6 text-violet-400" />
                  </div>
                  <h3 className="text-lg font-bold text-foreground mb-2">IDENTIFY</h3>
                  <p className="text-sm text-muted-foreground">Build your depth chartpre-stage stakeholders and resources</p>
                </CardContent>
              </Card>
              
              <Card className="bg-slate-800/50 border-blue-500/30 hover:border-blue-500/50 transition-colors">
                <CardContent className="p-6 text-center">
                  <div className="w-12 h-12 mx-auto mb-4 rounded-xl bg-blue-500/20 flex items-center justify-center">
                    <Radio className="h-6 w-6 text-blue-400" />
                  </div>
                  <h3 className="text-lg font-bold text-foreground mb-2">DETECT</h3>
                  <p className="text-sm text-muted-foreground">Monitor signalscontinuous detection across 12 sources</p>
                </CardContent>
              </Card>
              
              <Card className="bg-slate-800/50 border-emerald-500/30 hover:border-emerald-500/50 transition-colors">
                <CardContent className="p-6 text-center">
                  <div className="w-12 h-12 mx-auto mb-4 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                    <Zap className="h-6 w-6 text-emerald-400" />
                  </div>
                  <h3 className="text-lg font-bold text-foreground mb-2">EXECUTE</h3>
                  <p className="text-sm text-muted-foreground">Execute responsecoordinated task deployment in 12 minutes</p>
                </CardContent>
              </Card>
              
              <Card className="bg-slate-800/50 border-amber-500/30 hover:border-amber-500/50 transition-colors">
                <CardContent className="p-6 text-center">
                  <div className="w-12 h-12 mx-auto mb-4 rounded-xl bg-amber-500/20 flex items-center justify-center">
                    <BookMarked className="h-6 w-6 text-amber-400" />
                  </div>
                  <h3 className="text-lg font-bold text-foreground mb-2">ADVANCE</h3>
                  <p className="text-sm text-muted-foreground">Review the filmstructured debrief and playbook improvement</p>
                </CardContent>
              </Card>
            </div>
          </div>

          {/* Deterministic Execution Section */}
          <div className="mb-16">
            <div className="grid md:grid-cols-2 gap-12 items-start">
              <div>
                <Badge className="mb-4 bg-red-500/20 text-red-400 border-red-500/30">
                  The Problem
                </Badge>
                <h2 className="text-3xl font-bold text-foreground mb-4">
                  Experimental AI Fails When Stakes Are High
                </h2>
                <div className="space-y-4 text-muted-foreground">
                  <p>
                    Fragmented copilots. Consumer-grade chatbots. AI that hallucinates 
                    when you need certainty.
                  </p>
                  <p>
                    When ransomware hits at 2 AM or a competitor announces a market move, 
                    you can't wait for AI to "figure it out."
                  </p>
                  <ul className="space-y-2 mt-4">
                    <li className="flex items-start gap-2">
                      <X className="h-5 w-5 text-red-400 mt-0.5 flex-shrink-0" />
                      <span>72+ hours of scrambling across disconnected tools</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <X className="h-5 w-5 text-red-400 mt-0.5 flex-shrink-0" />
                      <span>Stakeholders unclear on their responsibilities</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <X className="h-5 w-5 text-red-400 mt-0.5 flex-shrink-0" />
                      <span>No audit trail for board or regulatory review</span>
                    </li>
                  </ul>
                </div>
              </div>
              
              <div>
                <Badge className="mb-4 bg-emerald-500/20 text-emerald-400 border-emerald-500/30">
                  The M Difference
                </Badge>
                <h2 className="text-3xl font-bold text-foreground mb-4">
                  Deterministic Strategic Execution
                </h2>
                <div className="space-y-4 text-muted-foreground">
                  <p>
                    M delivers predictable outcomes. The same trigger activates the same 
                    coordinated response, every time.
                  </p>
                  <p>
                    No hallucinations. No randomness. Just battle-tested playbooks 
                    executed with precision.
                  </p>
                  <ul className="space-y-2 mt-4">
                    <li className="flex items-start gap-2">
                      <CheckCircle2 className="h-5 w-5 text-emerald-400 mt-0.5 flex-shrink-0" />
                      <span className="text-foreground">12-minute coordinated response across all stakeholders</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <CheckCircle2 className="h-5 w-5 text-emerald-400 mt-0.5 flex-shrink-0" />
                      <span className="text-foreground">Pre-assigned roles with task-level accountability</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <CheckCircle2 className="h-5 w-5 text-emerald-400 mt-0.5 flex-shrink-0" />
                      <span className="text-foreground">Complete audit trail with timestamp and ownership</span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          {/* Dynamic Strategy Features Grid */}
          <div className="grid md:grid-cols-3 gap-6 mb-16">
            <Card className="hover:shadow-lg transition-shadow">
              <CardContent className="p-8 text-center">
                <Radio className="h-12 w-12 text-primary mx-auto mb-4 animate-pulse" />
                <h3 className="font-bold text-lg text-foreground mb-2">Command Center</h3>
                <p className="text-sm text-muted-foreground">Real-time coordination hub</p>
              </CardContent>
            </Card>

            <Card className="hover:shadow-lg transition-shadow">
              <CardContent className="p-8 text-center">
                <Radar className="h-12 w-12 text-primary mx-auto mb-4" />
                <h3 className="font-bold text-lg text-foreground mb-2">Foresight Radar</h3>
                <p className="text-sm text-muted-foreground">Weak signal detection</p>
              </CardContent>
            </Card>

            <Card className="hover:shadow-lg transition-shadow">
              <CardContent className="p-8 text-center">
                <BookMarked className="h-12 w-12 text-primary mx-auto mb-4" />
                <h3 className="font-bold text-lg text-foreground mb-2">166 Playbooks</h3>
                <p className="text-sm text-muted-foreground">Every scenario covered</p>
              </CardContent>
            </Card>

            <Card className="hover:shadow-lg transition-shadow">
              <CardContent className="p-8 text-center">
                <Sparkles className="h-12 w-12 text-primary mx-auto mb-4 animate-pulse" />
                <h3 className="font-bold text-lg text-foreground mb-2">Living Playbooks</h3>
                <p className="text-sm text-muted-foreground">Self-learning AI</p>
              </CardContent>
            </Card>

            <Card className="hover:shadow-lg transition-shadow">
              <CardContent className="p-8 text-center">
                <Dumbbell className="h-12 w-12 text-primary mx-auto mb-4" />
                <h3 className="font-bold text-lg text-foreground mb-2">Future Gym</h3>
                <p className="text-sm text-muted-foreground">Strategic simulations</p>
              </CardContent>
            </Card>

            <Card className="hover:shadow-lg transition-shadow">
              <CardContent className="p-8 text-center">
                <RefreshCw className="h-12 w-12 text-primary mx-auto mb-4" />
                <h3 className="font-bold text-lg text-foreground mb-2">Continuous Mode</h3>
                <p className="text-sm text-muted-foreground">Always-on operations</p>
              </CardContent>
            </Card>
          </div>

          {/* Value Proposition */}
          <Card>
            <CardContent className="p-12 space-y-6">
              <div className="grid md:grid-cols-3 gap-8 text-center">
                <div data-testid="stat-0">
                  <div className="text-5xl font-bold text-primary mb-3" data-testid="value-speed">12 min</div>
                  <p className="text-base text-muted-foreground">Strategic coordination</p>
                </div>
                <div data-testid="stat-1">
                  <div className="text-5xl font-bold text-primary mb-3" data-testid="value-playbooks">166</div>
                  <p className="text-base text-muted-foreground">Strategic playbooks</p>
                </div>
                <div data-testid="stat-2">
                  <div className="text-5xl font-bold text-primary mb-3" data-testid="value-ai">24/7</div>
                  <p className="text-base text-muted-foreground">AI intelligence</p>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Three Transformations */}
          <div className="mt-16 mb-12">
            <h2 className="text-3xl font-bold text-center text-foreground mb-4">
              How M Transforms Your Organization
            </h2>
            <p className="text-center text-muted-foreground mb-10 max-w-2xl mx-auto">
              M changes how three critical groups workfrom reactive to ready.
            </p>
            
            <div className="grid md:grid-cols-3 gap-6">
              {/* Executives */}
              <Card className="border-2 border-blue-500/30 hover:border-blue-500/50 transition-colors">
                <CardContent className="p-6">
                  <div className="flex items-center gap-3 mb-4">
                    <div className="w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center">
                      <Target className="h-5 w-5 text-blue-500" />
                    </div>
                    <h3 className="font-bold text-lg text-foreground">Executives</h3>
                  </div>
                  <div className="space-y-3 text-sm">
                    <div className="flex items-start gap-2">
                      <span className="text-red-400 font-medium shrink-0">Before:</span>
                      <span className="text-muted-foreground">Learn about crises when they're already crises</span>
                    </div>
                    <div className="flex items-start gap-2">
                      <span className="text-green-400 font-medium shrink-0">After:</span>
                      <span className="text-foreground">See signals before they escalate</span>
                    </div>
                  </div>
                  <div className="mt-4 pt-4 border-t border-border">
                    <p className="text-xs text-primary font-medium">Shift: Crisis Managers  Readiness Leaders</p>
                  </div>
                </CardContent>
              </Card>

              {/* Strategy Teams */}
              <Card className="border-2 border-purple-500/30 hover:border-purple-500/50 transition-colors">
                <CardContent className="p-6">
                  <div className="flex items-center gap-3 mb-4">
                    <div className="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center">
                      <Brain className="h-5 w-5 text-purple-500" />
                    </div>
                    <h3 className="font-bold text-lg text-foreground">Strategy Teams</h3>
                  </div>
                  <div className="space-y-3 text-sm">
                    <div className="flex items-start gap-2">
                      <span className="text-red-400 font-medium shrink-0">Before:</span>
                      <span className="text-muted-foreground">Create plans that sit in SharePoint</span>
                    </div>
                    <div className="flex items-start gap-2">
                      <span className="text-green-400 font-medium shrink-0">After:</span>
                      <span className="text-foreground">Create playbooks that auto-activate</span>
                    </div>
                  </div>
                  <div className="mt-4 pt-4 border-t border-border">
                    <p className="text-xs text-primary font-medium">Shift: Document Creators  Capability Builders</p>
                  </div>
                </CardContent>
              </Card>

              {/* Operations */}
              <Card className="border-2 border-green-500/30 hover:border-green-500/50 transition-colors">
                <CardContent className="p-6">
                  <div className="flex items-center gap-3 mb-4">
                    <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
                      <Users className="h-5 w-5 text-green-500" />
                    </div>
                    <h3 className="font-bold text-lg text-foreground">Operations</h3>
                  </div>
                  <div className="space-y-3 text-sm">
                    <div className="flex items-start gap-2">
                      <span className="text-red-400 font-medium shrink-0">Before:</span>
                      <span className="text-muted-foreground">Wait for instructions during chaos</span>
                    </div>
                    <div className="flex items-start gap-2">
                      <span className="text-green-400 font-medium shrink-0">After:</span>
                      <span className="text-foreground">Get immediate, clear task assignments</span>
                    </div>
                  </div>
                  <div className="mt-4 pt-4 border-t border-border">
                    <p className="text-xs text-primary font-medium">Shift: Confusion  Clarity in Execution</p>
                  </div>
                </CardContent>
              </Card>
            </div>
          </div>

          {/* Industry-Specific Stats */}
          <div className="mb-16">
            <div className="text-center mb-8">
              <h2 className="text-3xl font-bold text-foreground mb-3">
                Industry Impact
              </h2>
              <p className="text-muted-foreground">
                The stakes are even higher in regulated industries
              </p>
            </div>
            
            <div className="grid md:grid-cols-2 gap-6">
              <Card className="border-2 border-blue-500/20">
                <CardContent className="p-6">
                  <div className="flex items-center gap-3 mb-4">
                    <Building2 className="h-8 w-8 text-blue-500" />
                    <h3 className="font-bold text-lg text-foreground">Financial Services</h3>
                  </div>
                  <div className="grid grid-cols-3 gap-4 text-center mb-4">
                    <div>
                      <div className="text-2xl font-bold text-blue-500">$6.08M</div>
                      <p className="text-xs text-muted-foreground">Avg breach cost</p>
                    </div>
                    <div>
                      <div className="text-2xl font-bold text-blue-500">168</div>
                      <p className="text-xs text-muted-foreground">Days to identify</p>
                    </div>
                    <div>
                      <div className="text-2xl font-bold text-blue-500">51</div>
                      <p className="text-xs text-muted-foreground">Days to contain</p>
                    </div>
                  </div>
                  <p className="text-sm text-muted-foreground">22% above global average. M cuts this timeline to minutes.</p>
                  <p className="text-xs text-muted-foreground/60 mt-2">Source: IBM 2024 - Financial Industry</p>
                </CardContent>
              </Card>
              
              <Card className="border-2 border-red-500/20">
                <CardContent className="p-6">
                  <div className="flex items-center gap-3 mb-4">
                    <Shield className="h-8 w-8 text-red-500" />
                    <h3 className="font-bold text-lg text-foreground">Healthcare</h3>
                  </div>
                  <div className="grid grid-cols-3 gap-4 text-center mb-4">
                    <div>
                      <div className="text-2xl font-bold text-red-500">$9.77M</div>
                      <p className="text-xs text-muted-foreground">Avg breach cost</p>
                    </div>
                    <div>
                      <div className="text-2xl font-bold text-red-500">213</div>
                      <p className="text-xs text-muted-foreground">Days to discover</p>
                    </div>
                    <div>
                      <div className="text-2xl font-bold text-red-500">14</div>
                      <p className="text-xs text-muted-foreground">Years as #1 cost</p>
                    </div>
                  </div>
                  <p className="text-sm text-muted-foreground">The costliest industry for 14 years running. M ensures you're ready.</p>
                  <p className="text-xs text-muted-foreground/60 mt-2">Source: IBM 2024</p>
                </CardContent>
              </Card>
            </div>
          </div>

          {/* Category Creation */}
          <Card className="bg-gradient-to-br from-slate-900 to-slate-800 border-primary/30">
            <CardContent className="p-8 text-center">
              <h3 className="text-2xl font-bold text-white mb-4">
                We're Creating a New Category
              </h3>
              <p className="text-slate-300 mb-6 max-w-2xl mx-auto">
                What Salesforce did for customer relationships, M does for strategic execution. 
                We're not competing with project tools or crisis softwarewe're the orchestration layer above them all.
              </p>
              <Link href="/why-m">
                <Button variant="outline" className="border-primary text-primary hover:bg-primary/10">
                  Learn Our Story
                  <ArrowRight className="ml-2 h-4 w-4" />
                </Button>
              </Link>
            </CardContent>
          </Card>

          {/* Research Trust Bar */}
          <div className="mt-16 py-8 border-t border-border">
            <p className="text-center text-sm text-muted-foreground mb-6">
              Research and methodology informed by industry leaders
            </p>
            <div className="flex flex-wrap justify-center items-center gap-8 opacity-60">
              <div className="text-center">
                <p className="font-semibold text-foreground">McKinsey & Company</p>
                <p className="text-xs text-muted-foreground">Crisis Framework</p>
              </div>
              <div className="h-8 w-px bg-border hidden md:block" />
              <div className="text-center">
                <p className="font-semibold text-foreground">PwC</p>
                <p className="text-xs text-muted-foreground">Global Crisis Survey</p>
              </div>
              <div className="h-8 w-px bg-border hidden md:block" />
              <div className="text-center">
                <p className="font-semibold text-foreground">IBM Security</p>
                <p className="text-xs text-muted-foreground">Cost of Data Breach</p>
              </div>
              <div className="h-8 w-px bg-border hidden md:block" />
              <div className="text-center">
                <p className="font-semibold text-foreground">Ponemon Institute</p>
                <p className="text-xs text-muted-foreground">Security Research</p>
              </div>
            </div>
            <div className="text-center mt-6">
              <Link href="/research">
                <Button variant="ghost" size="sm" className="text-muted-foreground hover:text-foreground">
                  View Research Sources
                  <ArrowRight className="ml-2 h-4 w-4" />
                </Button>
              </Link>
            </div>
          </div>

          <div className="text-center mt-8 pb-8">
            <p className="text-base text-muted-foreground font-medium">
              Success Favors the Prepared.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/LiveDrillExecution.tsx
========================================
import { useState, useEffect } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { useRoute, useLocation } from 'wouter';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { 
  Play,
  Pause,
  CheckCircle,
  Clock,
  Users,
  Target,
  AlertTriangle,
  ChevronRight,
  Activity
} from 'lucide-react';
import PageLayout from '@/components/layout/PageLayout';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';

export default function LiveDrillExecution() {
  const [, params] = useRoute('/practice-drills/:drillId/live');
  const [, setLocation] = useLocation();
  const { toast } = useToast();
  const drillId = params?.drillId;

  // State for countdown timer
  const [elapsedSeconds, setElapsedSeconds] = useState(0);
  const [isRunning, setIsRunning] = useState(true);
  const [selectedDecisions, setSelectedDecisions] = useState<Record<string, string>>({});

  // Fetch drill details with playbook data
  const { data: drillDetails, isLoading } = useQuery<any>({
    queryKey: [`/api/practice-drills/drill/${drillId}`],
    enabled: !!drillId,
  });

  const drill = drillDetails?.drill;
  const playbook = drillDetails?.playbook;
  const domain = drillDetails?.domain;

  // Fetch decision trees for this playbook
  const { data: decisionTreesData } = useQuery<any[]>({
    queryKey: [`/api/playbook-library/${drill?.playbookId}/decision-trees`],
    enabled: !!drill?.playbookId,
  });
  const decisionTrees = decisionTreesData ?? [];

  // Fetch task sequences for this playbook
  const { data: taskSequencesData } = useQuery<any[]>({
    queryKey: [`/api/playbook-library/${drill?.playbookId}/task-sequences`],
    enabled: !!drill?.playbookId,
  });
  const taskSequences = taskSequencesData ?? [];

  // Complete drill mutation
  const completeDrillMutation = useMutation({
    mutationFn: async (performanceData: any) => {
      const response = await apiRequest('POST', `/api/practice-drills/${drillId}/complete`, performanceData);
      return response.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/practice-drills'] });
      toast({
        title: 'Drill Completed',
        description: 'Performance data recorded successfully',
      });
      setLocation('/practice-drills');
    },
  });

  // Countdown timer effect
  useEffect(() => {
    if (!isRunning || !drill?.startedAt) return;

    const interval = setInterval(() => {
      const start = new Date(drill.startedAt).getTime();
      const now = Date.now();
      const elapsed = Math.floor((now - start) / 1000);
      setElapsedSeconds(elapsed);
    }, 1000);

    return () => clearInterval(interval);
  }, [isRunning, drill?.startedAt]);

  // Format seconds to HH:MM:SS
  const formatTime = (seconds: number) => {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  // Calculate progress (target is 12 minutes = 720 seconds)
  const targetSeconds = 720;
  const progress = Math.min((elapsedSeconds / targetSeconds) * 100, 100);

  // Determine which checkpoints have been reached
  const getCheckpointStatus = (timing: string) => {
    // Parse timing like "T+3:00" to seconds
    const match = timing.match(/T\+(\d+):(\d+)/);
    if (!match) return 'pending';
    
    const minutes = parseInt(match[1]);
    const seconds = parseInt(match[2]);
    const checkpointSeconds = minutes * 60 + seconds;
    
    if (elapsedSeconds >= checkpointSeconds) return 'active';
    return 'pending';
  };

  const handleCompleteDrill = () => {
    const performanceData = {
      actualExecutionTime: Math.floor(elapsedSeconds / 60),
      executionSpeedScore: progress >= 100 ? 95 : Math.floor((100 - progress) * 0.8 + 60),
      triggerToAlert: 30,
      alertToActivation: 60,
      activationToWarRoom: 120,
      warRoomToDecision: 180,
      decisionToExecution: 180,
      tier1Participation: 1.0,
      tier2Participation: 0.95,
      tier3Acknowledgment: 0.90,
      roleClarity: 0.95,
      bottlenecks: [],
      communicationsSent: taskSequences.length,
      communicationsDelivered: taskSequences.length,
      communicationEffectiveness: 0.95,
      overallScore: 90,
      passed: progress <= 100,
      whatWorked: 'Strong coordination and communication',
      whatDidntWork: '',
      recommendations: [],
      actualParticipants: [],
    };

    completeDrillMutation.mutate(performanceData);
  };

  if (isLoading) {
    return (
      <PageLayout>
        <div className="p-6">
          <div className="animate-pulse">Loading drill execution...</div>
        </div>
      </PageLayout>
    );
  }

  if (!drill) {
    return (
      <PageLayout>
        <div className="p-6">
          <Card>
            <CardContent className="pt-6">
              <div className="text-center text-muted-foreground">
                Drill not found
              </div>
            </CardContent>
          </Card>
        </div>
      </PageLayout>
    );
  }

  return (
    <PageLayout>
      <div className="p-6 space-y-6" data-testid="live-drill-execution-page">
        {/* Header with countdown */}
        <div className="flex items-center justify-between">
          <div>
            <div className="flex items-center gap-3">
              <Activity className="h-8 w-8 text-red-600 animate-pulse" />
              <h1 className="text-3xl font-bold" data-testid="page-title">
                LIVE DRILL EXECUTION
              </h1>
            </div>
            <p className="text-muted-foreground mt-1">
              {playbook?.name || drill.drillName}
            </p>
          </div>
          <div className="flex items-center gap-4">
            <Badge variant="destructive" className="text-lg px-4 py-2 animate-pulse">
              ACTIVE
            </Badge>
          </div>
        </div>

        {/* Countdown Timer */}
        <Card className="border-2 border-red-600 dark:border-red-400">
          <CardHeader>
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Clock className="h-6 w-6" />
                <CardTitle>Elapsed Time</CardTitle>
              </div>
              <div className="flex items-center gap-2">
                {isRunning ? (
                  <Button
                    size="sm"
                    variant="outline"
                    onClick={() => setIsRunning(false)}
                    data-testid="button-pause-timer"
                  >
                    <Pause className="h-4 w-4 mr-2" />
                    Pause
                  </Button>
                ) : (
                  <Button
                    size="sm"
                    onClick={() => setIsRunning(true)}
                    data-testid="button-resume-timer"
                  >
                    <Play className="h-4 w-4 mr-2" />
                    Resume
                  </Button>
                )}
              </div>
            </div>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="text-center">
              <div className="text-6xl font-mono font-bold" data-testid="text-elapsed-time">
                {formatTime(elapsedSeconds)}
              </div>
              <div className="text-sm text-muted-foreground mt-2">
                Target: 12:00 minutes
              </div>
            </div>
            <Progress value={progress} className="h-3" data-testid="progress-execution" />
            <div className="flex justify-between text-xs text-muted-foreground">
              <span>Started: {new Date(drill.startedAt).toLocaleTimeString()}</span>
              <span>{Math.floor(elapsedSeconds / 60)}m {elapsedSeconds % 60}s elapsed</span>
            </div>
          </CardContent>
        </Card>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* Decision Checkpoints */}
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Target className="h-5 w-5" />
                Decision Checkpoints
              </CardTitle>
              <CardDescription>
                Critical decisions during execution
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              {decisionTrees.length === 0 ? (
                <div className="text-center py-8 text-muted-foreground text-sm">
                  No decision checkpoints defined for this playbook
                </div>
              ) : (
                decisionTrees.map((checkpoint: any) => {
                  const status = getCheckpointStatus(checkpoint.checkpointTiming || 'T+0:00');
                  return (
                    <div 
                      key={checkpoint.id}
                      className={`p-4 rounded-lg border-2 ${
                        status === 'active' 
                          ? 'border-green-500 bg-green-50 dark:bg-green-950' 
                          : 'border-gray-200 dark:border-gray-800'
                      }`}
                      data-testid={`checkpoint-${checkpoint.id}`}
                    >
                      <div className="flex items-start justify-between mb-2">
                        <div>
                          <div className="font-semibold">{checkpoint.checkpointName}</div>
                          <div className="text-xs text-muted-foreground">
                            {checkpoint.checkpointTiming}  {checkpoint.decisionAuthority}
                          </div>
                        </div>
                        {status === 'active' && (
                          <Badge variant="default" className="bg-green-600">
                            <Activity className="h-3 w-3 mr-1 animate-pulse" />
                            NOW
                          </Badge>
                        )}
                      </div>
                      <p className="text-sm mb-3">{checkpoint.decisionQuestion}</p>
                      {status === 'active' && (
                        <div className="space-y-1">
                          {(checkpoint.decisionOptions as any[])?.map((option: any, idx: number) => (
                            <Button
                              key={idx}
                              variant={selectedDecisions[checkpoint.id] === option.label ? 'default' : 'outline'}
                              size="sm"
                              className="w-full justify-start text-left"
                              onClick={() => setSelectedDecisions({...selectedDecisions, [checkpoint.id]: option.label})}
                              data-testid={`decision-option-${checkpoint.id}-${idx}`}
                            >
                              <ChevronRight className="h-4 w-4 mr-2" />
                              {option.label}: {option.description}
                            </Button>
                          ))}
                        </div>
                      )}
                    </div>
                  );
                })
              )}
            </CardContent>
          </Card>

          {/* Task Timeline */}
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Users className="h-5 w-5" />
                Execution Timeline
              </CardTitle>
              <CardDescription>
                Minute-by-minute task sequences
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-3 max-h-[600px] overflow-y-auto">
                {taskSequences.length === 0 ? (
                  <div className="text-center py-8 text-muted-foreground text-sm">
                    No task sequences defined for this playbook
                  </div>
                ) : (
                  taskSequences.map((task: any, idx: number) => {
                    // Parse timing to determine if task is due
                    const match = task.timing?.match(/T\+(\d+):(\d+)/);
                    let taskSeconds = 0;
                    if (match) {
                      const minutes = parseInt(match[1]);
                      const seconds = parseInt(match[2]);
                      taskSeconds = minutes * 60 + seconds;
                    }
                    const isActive = elapsedSeconds >= taskSeconds && elapsedSeconds < taskSeconds + 300; // Active for 5 min window
                    const isCompleted = elapsedSeconds > taskSeconds + 300;

                    return (
                      <div
                        key={task.id}
                        className={`p-3 rounded-lg border ${
                          isActive 
                            ? 'border-blue-500 bg-blue-50 dark:bg-blue-950' 
                            : isCompleted 
                            ? 'border-gray-300 dark:border-gray-700 opacity-50'
                            : 'border-gray-200 dark:border-gray-800'
                        }`}
                        data-testid={`task-${task.id}`}
                      >
                        <div className="flex items-start justify-between">
                          <div className="flex-1 page-background">
                            <div className="flex items-center gap-2 mb-1">
                              <span className="text-xs font-mono text-muted-foreground">
                                {task.timing}
                              </span>
                              {isCompleted && <CheckCircle className="h-4 w-4 text-green-600" />}
                              {isActive && <AlertTriangle className="h-4 w-4 text-blue-600 animate-pulse" />}
                            </div>
                            <div className="font-medium text-sm">{task.taskName}</div>
                            <div className="text-xs text-muted-foreground mt-1">
                              Owner: {task.taskOwner}
                            </div>
                          </div>
                        </div>
                      </div>
                    );
                  })
                )}
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Complete Drill Button */}
        <Card className="border-2 border-green-600 dark:border-green-400">
          <CardContent className="pt-6">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="font-semibold text-lg">Ready to complete drill?</h3>
                <p className="text-sm text-muted-foreground">
                  Your performance will be recorded and analyzed
                </p>
              </div>
              <Button
                size="lg"
                onClick={handleCompleteDrill}
                disabled={completeDrillMutation.isPending}
                className="bg-green-600 hover:bg-green-700"
                data-testid="button-complete-drill"
              >
                <CheckCircle className="h-5 w-5 mr-2" />
                Complete Drill
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/LivingPlaybooks.tsx
========================================
import { useLocation } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { BookOpen, Brain, TrendingUp, Sparkles, History, Target } from 'lucide-react';
import { useToast } from '@/hooks/use-toast';

const livingPlaybooks = [
  {
    id: 1,
    name: 'Ransomware Response',
    version: '4.2',
    activations: 127,
    successRate: 94,
    aiLearnings: 23,
    lastImproved: '2 days ago',
    improvements: [
      'Response time reduced from 6h to 2h',
      'Added 3 new stakeholder notification templates',
      'Improved IT team coordination checklist',
    ],
  },
  {
    id: 2,
    name: 'Supply Chain Disruption',
    version: '3.8',
    activations: 203,
    successRate: 91,
    aiLearnings: 41,
    lastImproved: '1 week ago',
    improvements: [
      'Enhanced supplier communication protocols',
      'Added alternative vendor matrix',
      'Updated risk assessment framework',
    ],
  },
  {
    id: 3,
    name: 'M&A Integration',
    version: '5.1',
    activations: 78,
    successRate: 88,
    aiLearnings: 15,
    lastImproved: '3 days ago',
    improvements: [
      'Cultural integration best practices',
      'Day-1 coordination improvements',
      'HR integration timeline optimization',
    ],
  },
];

export default function LivingPlaybooks() {
  const [, setLocation] = useLocation();
  const { toast } = useToast();

  const handleViewHistory = (playbook: typeof livingPlaybooks[0]) => {
    setLocation('/institutional-memory');
    toast({
      title: `Learning History: ${playbook.name}`,
      description: `Version ${playbook.version} - ${playbook.aiLearnings} AI learnings tracked`,
    });
  };

  const handleActivatePlaybook = (playbook: typeof livingPlaybooks[0]) => {
    setLocation('/command-center');
    toast({
      title: `Activating: ${playbook.name}`,
      description: `${playbook.successRate}% success rate across ${playbook.activations} activations`,
    });
  };

  return (
    <PageLayout>
      <div className="bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-blue-950 p-8">
      <div className="max-w-7xl mx-auto space-y-8">
        {/* Header */}
        <div>
          <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-600 to-violet-600 bg-clip-text text-transparent mb-2 flex items-center gap-3">
            <Brain className="w-10 h-10 text-blue-600" />
            Living Playbooks
          </h1>
          <p className="text-slate-600 dark:text-slate-400">
            Self-learning strategic playbooks that evolve with every execution through AI-powered analysis
          </p>
        </div>

        {/* System Stats */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <Card className="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/50 dark:to-blue-900/50 border-blue-200 dark:border-blue-800">
            <CardContent className="p-6 text-center">
              <div className="text-4xl font-bold text-blue-600 dark:text-blue-400 mb-1">
                166
              </div>
              <div className="text-sm text-slate-700 dark:text-slate-300">Living Playbooks</div>
            </CardContent>
          </Card>
          <Card className="bg-gradient-to-br from-violet-50 to-violet-100 dark:from-violet-950/50 dark:to-violet-900/50 border-violet-200 dark:border-violet-800">
            <CardContent className="p-6 text-center">
              <div className="text-4xl font-bold text-violet-600 dark:text-violet-400 mb-1">
                892
              </div>
              <div className="text-sm text-slate-700 dark:text-slate-300">AI Learnings Applied</div>
            </CardContent>
          </Card>
          <Card className="bg-gradient-to-br from-emerald-50 to-emerald-100 dark:from-emerald-950/50 dark:to-emerald-900/50 border-emerald-200 dark:border-emerald-800">
            <CardContent className="p-6 text-center">
              <div className="text-4xl font-bold text-emerald-600 dark:text-emerald-400 mb-1">
                91%
              </div>
              <div className="text-sm text-slate-700 dark:text-slate-300">Avg Success Rate</div>
            </CardContent>
          </Card>
          <Card className="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-950/50 dark:to-orange-900/50 border-orange-200 dark:border-orange-800">
            <CardContent className="p-6 text-center">
              <div className="text-4xl font-bold text-orange-600 dark:text-orange-400 mb-1">
                42%
              </div>
              <div className="text-sm text-slate-700 dark:text-slate-300">Speed Improvement</div>
            </CardContent>
          </Card>
        </div>

        {/* Playbook Learning Feed */}
        <div>
          <h2 className="text-2xl font-bold text-slate-900 dark:text-white mb-4">Self-Learning Playbooks</h2>
          <div className="space-y-6">
            {livingPlaybooks.map((playbook) => (
              <Card key={playbook.id} className="border-l-4 border-l-violet-500" data-testid={`card-playbook-${playbook.id}`}>
                <CardHeader>
                  <div className="flex items-start justify-between">
                    <div className="flex items-start gap-3">
                      <div className="bg-violet-100 dark:bg-violet-900 p-3 rounded-lg">
                        <BookOpen className="w-6 h-6 text-violet-600 dark:text-violet-400" />
                      </div>
                      <div>
                        <CardTitle className="text-xl">{playbook.name}</CardTitle>
                        <CardDescription className="mt-1">
                          Version {playbook.version}  {playbook.aiLearnings} AI learnings applied
                        </CardDescription>
                      </div>
                    </div>
                    <Badge className="bg-violet-600">
                      <Sparkles className="w-3 h-3 mr-1" />
                      Self-Learning
                    </Badge>
                  </div>
                </CardHeader>
                <CardContent className="space-y-4">
                  {/* Metrics */}
                  <div className="grid grid-cols-3 gap-4">
                    <div>
                      <div className="text-xs text-slate-600 dark:text-slate-400 mb-1">Activations</div>
                      <div className="text-2xl font-bold text-slate-900 dark:text-white">
                        {playbook.activations}
                      </div>
                    </div>
                    <div>
                      <div className="text-xs text-slate-600 dark:text-slate-400 mb-1">Success Rate</div>
                      <div className="text-2xl font-bold text-emerald-600 dark:text-emerald-400">
                        {playbook.successRate}%
                      </div>
                    </div>
                    <div>
                      <div className="text-xs text-slate-600 dark:text-slate-400 mb-1">Last Improved</div>
                      <div className="text-sm font-semibold text-slate-700 dark:text-slate-300">
                        {playbook.lastImproved}
                      </div>
                    </div>
                  </div>

                  {/* Recent AI Improvements */}
                  <div className="bg-violet-50 dark:bg-violet-950/30 p-4 rounded-lg border border-violet-200 dark:border-violet-900">
                    <h4 className="font-semibold text-sm text-slate-900 dark:text-white mb-3 flex items-center gap-2">
                      <Brain className="w-4 h-4 text-violet-600" />
                      Recent AI-Driven Improvements
                    </h4>
                    <ul className="space-y-2">
                      {playbook.improvements.map((improvement, index) => (
                        <li key={index} className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                          <TrendingUp className="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5" />
                          <span>{improvement}</span>
                        </li>
                      ))}
                    </ul>
                  </div>

                  {/* Actions */}
                  <div className="flex items-center gap-3">
                    <Button variant="outline" size="sm" onClick={() => handleViewHistory(playbook)} data-testid={`button-view-history-${playbook.id}`}>
                      <History className="w-4 h-4 mr-2" />
                      View Learning History
                    </Button>
                    <Button size="sm" onClick={() => handleActivatePlaybook(playbook)} data-testid={`button-activate-${playbook.id}`}>
                      <Target className="w-4 h-4 mr-2" />
                      Activate Playbook
                    </Button>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </div>

        {/* How It Works */}
        <Card className="bg-gradient-to-r from-blue-600 to-violet-600 text-white border-0">
          <CardHeader>
            <CardTitle className="text-2xl">How Self-Learning Works</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
              <div>
                <div className="bg-white/20 rounded-full w-12 h-12 flex items-center justify-center mb-3">
                  <span className="text-2xl font-bold">1</span>
                </div>
                <h4 className="font-semibold mb-1">Execute</h4>
                <p className="text-sm text-blue-100">Playbook activated for real scenario</p>
              </div>
              <div>
                <div className="bg-white/20 rounded-full w-12 h-12 flex items-center justify-center mb-3">
                  <span className="text-2xl font-bold">2</span>
                </div>
                <h4 className="font-semibold mb-1">Capture</h4>
                <p className="text-sm text-blue-100">AI analyzes execution data and outcomes</p>
              </div>
              <div>
                <div className="bg-white/20 rounded-full w-12 h-12 flex items-center justify-center mb-3">
                  <span className="text-2xl font-bold">3</span>
                </div>
                <h4 className="font-semibold mb-1">Learn</h4>
                <p className="text-sm text-blue-100">Generate improvement recommendations</p>
              </div>
              <div>
                <div className="bg-white/20 rounded-full w-12 h-12 flex items-center justify-center mb-3">
                  <span className="text-2xl font-bold">4</span>
                </div>
                <h4 className="font-semibold mb-1">Evolve</h4>
                <p className="text-sm text-blue-100">Playbook auto-updates for next execution</p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/LuxuryCrisisDemo.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useState } from 'react';
import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { ChevronRight, PlayCircle, BarChart3, Clock, Target, Award } from 'lucide-react';
import AIRadarSimulation from '@/components/demo/AIRadarSimulation';
import TwelveMinuteTimer from '@/components/demo/TwelveMinuteTimer';
import ROIComparison from '@/components/demo/ROIComparison';
import DemoNavHeader from '@/components/demo/DemoNavHeader';
import { crisisScenario, luxuryOrg, playbookTemplate, roiComparisonData, twelveMinuteTimeline } from '@shared/luxury-demo-data';

const luxuryDemoData = {
  timelineEvents: twelveMinuteTimeline
};

type DemoAct = 'intro' | 'detection' | 'coordination' | 'outcome' | 'complete';

export default function LuxuryCrisisDemo() {
  const [currentAct, setCurrentAct] = useState<DemoAct>('intro');

  const proceedToNextAct = () => {
    const actSequence: DemoAct[] = ['intro', 'detection', 'coordination', 'outcome', 'complete'];
    const currentIndex = actSequence.indexOf(currentAct);
    if (currentIndex < actSequence.length - 1) {
      setCurrentAct(actSequence[currentIndex + 1]);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  };

  const renderActIndicator = () => {
    const acts = [
      { id: 'intro', label: 'Introduction' },
      { id: 'detection', label: 'Act 1: Detection' },
      { id: 'coordination', label: 'Act 2: Coordination' },
      { id: 'outcome', label: 'Act 3: Outcome' }
    ];

    return (
      <div className="flex items-center justify-center gap-2 mb-8">
        {acts.map((act, index) => (
          <div key={act.id} className="flex items-center">
            <Badge 
              variant={currentAct === act.id ? 'default' : 'outline'}
              className={currentAct === act.id ? 'animate-pulse' : ''}
            >
              {act.label}
            </Badge>
            {index < acts.length - 1 && <ChevronRight className="h-4 w-4 mx-2 text-muted-foreground" />}
          </div>
        ))}
      </div>
    );
  };

  return (
    <div className="page-background min-h-screen bg-gradient-to-b from-gray-50 to-white dark:from-gray-950 dark:to-gray-900">
      <DemoNavHeader title="Luxury Crisis Demo" showBackButton={true} />
      <div className="container mx-auto px-4 py-12 pt-24 max-w-6xl">
        {/* Header */}
        <div className="text-center mb-12">
          <Badge className="mb-4" data-testid="badge-demo-type">Interactive Demo</Badge>
          <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
            {crisisScenario.title}
          </h1>
          <p className="text-xl text-muted-foreground mb-2">
            {crisisScenario.subtitle}
          </p>
          <p className="text-sm text-muted-foreground max-w-2xl mx-auto">
            Experience how M transforms AI detection into coordinated execution
            turning a $280M crisis into a strategic advantage in just 12 minutes.
          </p>
        </div>

        {renderActIndicator()}

        {/* ACT: Introduction */}
        {currentAct === 'intro' && (
          <div className="space-y-8 animate-in fade-in duration-500">
            {/* Organization Card */}
            <Card className="p-8 bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-950 dark:to-blue-950">
              <div className="text-center mb-6">
                <h2 className="text-3xl font-bold mb-2">{luxuryOrg.name}</h2>
                <Badge variant="outline" className="mb-4">{luxuryOrg.industry}</Badge>
                <div className="grid md:grid-cols-4 gap-6 mt-6">
                  <div>
                    <div className="text-3xl font-bold text-purple-700 dark:text-purple-400">{luxuryOrg.marketCap}</div>
                    <div className="text-sm text-muted-foreground">Market Cap</div>
                  </div>
                  <div>
                    <div className="text-3xl font-bold text-blue-700 dark:text-blue-400">{luxuryOrg.brands}</div>
                    <div className="text-sm text-muted-foreground">Maisons</div>
                  </div>
                  <div>
                    <div className="text-3xl font-bold text-green-700 dark:text-green-400">{luxuryOrg.regions}</div>
                    <div className="text-sm text-muted-foreground">Regions</div>
                  </div>
                  <div>
                    <div className="text-3xl font-bold text-orange-700 dark:text-orange-400">
                      {(luxuryOrg.employees / 1000).toFixed(0)}K
                    </div>
                    <div className="text-sm text-muted-foreground">Employees</div>
                  </div>
                </div>
              </div>
            </Card>

            {/* The Scenario */}
            <Card className="p-8">
              <div className="flex items-start gap-4 mb-6">
                <div className="p-3 bg-red-100 dark:bg-red-900 rounded-full">
                  <Target className="h-6 w-6 text-red-600 dark:text-red-400" />
                </div>
                <div>
                  <h3 className="text-2xl font-bold mb-2">The Crisis Event</h3>
                  <p className="text-lg text-muted-foreground mb-4">
                    {crisisScenario.triggerEvent}
                  </p>
                  <div className="grid md:grid-cols-3 gap-4 mt-4">
                    <div className="bg-gray-50 dark:bg-gray-900 p-4 rounded">
                      <div className="text-sm text-muted-foreground mb-1">Financial Impact</div>
                      <div className="text-2xl font-bold text-red-600">{crisisScenario.financialImpact}</div>
                    </div>
                    <div className="bg-gray-50 dark:bg-gray-900 p-4 rounded">
                      <div className="text-sm text-muted-foreground mb-1">Response Window</div>
                      <div className="text-2xl font-bold text-yellow-600">{crisisScenario.timeWindow}</div>
                    </div>
                    <div className="bg-gray-50 dark:bg-gray-900 p-4 rounded">
                      <div className="text-sm text-muted-foreground mb-1">Stakeholders</div>
                      <div className="text-2xl font-bold text-blue-600">{crisisScenario.stakeholdersInvolved}</div>
                    </div>
                  </div>
                </div>
              </div>
            </Card>

            {/* The Playbook */}
            <Card className="p-8 bg-blue-50 dark:bg-blue-950 border-blue-500 border-2">
              <div className="flex items-start gap-4">
                <div className="p-3 bg-blue-500 rounded-full">
                  <Award className="h-6 w-6 text-white" />
                </div>
                <div className="flex-1 page-background">
                  <h3 className="text-2xl font-bold mb-2">
                    Playbook {playbookTemplate.number}: {playbookTemplate.name}
                  </h3>
                  <Badge className="mb-4">{playbookTemplate.domain}</Badge>
                  <p className="text-sm text-muted-foreground mb-4">
                    This playbook is {playbookTemplate.preparedness}% prepared with pre-filled stakeholders, 
                    communication templates, and execution plans ready to activate.
                  </p>
                  <div className="grid md:grid-cols-4 gap-3">
                    {playbookTemplate.sections.slice(0, 4).map(section => (
                      <div key={section.name} className="bg-white dark:bg-gray-900 p-3 rounded text-center">
                        <div className="text-xs text-muted-foreground mb-1">{section.name}</div>
                        <div className="text-lg font-bold text-blue-600">{section.prefill}%</div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </Card>

            <div className="text-center">
              <Button 
                size="lg" 
                onClick={proceedToNextAct}
                className="gap-2"
                data-testid="button-start-demo"
              >
                <PlayCircle className="h-5 w-5" />
                Begin Crisis Simulation
              </Button>
            </div>
          </div>
        )}

        {/* ACT 1: Detection */}
        {currentAct === 'detection' && (
          <div className="space-y-8 animate-in fade-in duration-500">
            <Card className="p-8 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-950 dark:to-orange-950">
              <h2 className="text-3xl font-bold mb-4">Act 1: AI Detection</h2>
              <p className="text-lg text-muted-foreground mb-2">
                {crisisScenario.narrative.detection}
              </p>
              <Badge variant="outline" className="mt-2">
                Watch the AI confidence score climb in real-time
              </Badge>
            </Card>

            <AIRadarSimulation 
              onTriggerFired={proceedToNextAct}
              autoStart={true}
            />

            <div className="text-center text-sm text-muted-foreground">
              The AI will automatically proceed when trigger threshold is reached...
            </div>
          </div>
        )}

        {/* ACT 2: Coordination */}
        {currentAct === 'coordination' && (
          <div className="space-y-8 animate-in fade-in duration-500">
            <Card className="p-8 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950 dark:to-indigo-950">
              <h2 className="text-3xl font-bold mb-4">Act 2: The 12-Minute Coordination</h2>
              <p className="text-lg text-muted-foreground mb-2">
                {crisisScenario.narrative.coordination}
              </p>
              <Badge variant="outline" className="mt-2">
                <Clock className="h-3 w-3 mr-1 inline" />
                Watch 193 stakeholders coordinate in real-time
              </Badge>
            </Card>

            <TwelveMinuteTimer 
              timelineEvents={luxuryDemoData.timelineEvents}
              onComplete={proceedToNextAct}
              autoStart={true}
            />

            <div className="text-center text-sm text-muted-foreground">
              The timer will automatically proceed when coordination is complete...
            </div>
          </div>
        )}

        {/* ACT 3: Outcome */}
        {currentAct === 'outcome' && (
          <div className="space-y-8 animate-in fade-in duration-500">
            <Card className="p-8 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-950 dark:to-emerald-950">
              <h2 className="text-3xl font-bold mb-4">Act 3: The Outcome</h2>
              <p className="text-lg text-muted-foreground mb-2">
                {crisisScenario.narrative.outcome}
              </p>
              <Badge variant="outline" className="mt-2">
                <BarChart3 className="h-3 w-3 mr-1 inline" />
                See the ROI comparison
              </Badge>
            </Card>

            <ROIComparison
              traditional={{
                label: roiComparisonData.traditional.title,
                duration: roiComparisonData.traditional.timeline,
                approach: roiComparisonData.traditional.approach,
                outcome: roiComparisonData.traditional.outcome,
                points: roiComparisonData.traditional.points
              }}
              vexor={{
                label: roiComparisonData.vexor.title,
                duration: roiComparisonData.vexor.timeline,
                approach: roiComparisonData.vexor.approach,
                outcome: roiComparisonData.vexor.outcome,
                points: roiComparisonData.vexor.points
              }}
              bottomLine={roiComparisonData.bottomLine}
            />

            <div className="text-center">
              <Button 
                size="lg" 
                onClick={proceedToNextAct}
                className="gap-2"
                data-testid="button-see-summary"
              >
                See Final Summary
                <ChevronRight className="h-5 w-5" />
              </Button>
            </div>
          </div>
        )}

        {/* Final Summary */}
        {currentAct === 'complete' && (
          <div className="space-y-8 animate-in fade-in duration-500">
            <Card className="p-12 bg-gradient-to-br from-purple-50 via-blue-50 to-green-50 dark:from-purple-950 dark:via-blue-950 dark:to-green-950 text-center">
              <Award className="h-16 w-16 mx-auto mb-6 text-green-600" />
              <h2 className="text-4xl font-bold mb-4">Demo Complete</h2>
              <p className="text-xl text-muted-foreground mb-8 max-w-2xl mx-auto">
                You've just experienced how M transforms the gap between AI detection 
                and human executionfrom 72 hours of coordination chaos to 12 minutes of 
                orchestrated response.
              </p>

              <div className="grid md:grid-cols-3 gap-6 mb-8">
                <Card className="p-6 border-2 border-green-500">
                  <div className="text-4xl font-bold text-green-600 mb-2">$280M</div>
                  <div className="text-sm text-muted-foreground">Value Preserved</div>
                </Card>
                <Card className="p-6 border-2 border-blue-500">
                  <div className="text-4xl font-bold text-blue-600 mb-2">12 min</div>
                  <div className="text-sm text-muted-foreground">Full Coordination</div>
                </Card>
                <Card className="p-6 border-2 border-purple-500">
                  <div className="text-4xl font-bold text-purple-600 mb-2">193</div>
                  <div className="text-sm text-muted-foreground">Stakeholders Aligned</div>
                </Card>
              </div>

              <div className="bg-white dark:bg-gray-900 p-6 rounded-lg border-2 border-blue-500 mb-8">
                <p className="font-semibold mb-2">The Strategic Insight</p>
                <p className="text-sm text-muted-foreground">
                  Luxury brands are spending billions on AI for detection. But without M's 
                  execution layer, they're still losing 72 hoursand hundreds of millionsto 
                  coordination chaos. M is the missing piece that turns AI insights into 
                  coordinated action at Fortune 1000 speed and scale.
                </p>
              </div>

              <div className="flex gap-4 justify-center">
                <Button 
                  size="lg"
                  onClick={() => setCurrentAct('intro')}
                  variant="outline"
                  data-testid="button-restart-demo"
                >
                  Restart Demo
                </Button>
                <Button 
                  size="lg"
                  onClick={() => window.location.href = '/playbook-library'}
                  data-testid="button-explore-playbooks"
                >
                  Explore All 166 Playbooks
                  <ChevronRight className="h-5 w-5 ml-2" />
                </Button>
              </div>
            </Card>
          </div>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/LVMHMarketEntryDemo.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useState } from "react";
import { Link } from "wouter";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Crown, Target, TrendingUp, Globe, CheckCircle, Users, DollarSign, ArrowLeft, Play } from "lucide-react";
import AIRadarSimulation from "@/components/demo/AIRadarSimulation";
import TwelveMinuteTimer from "@/components/demo/TwelveMinuteTimer";
import ROIComparison from "@/components/demo/ROIComparison";
import DemoNavHeader from "@/components/demo/DemoNavHeader";
import { lvmhMarketEntryDemoData } from "@shared/lvmh-market-entry-data";

type DemoAct = "intro" | "detection" | "coordination" | "outcome";

export default function LVMHMarketEntryDemo() {
  const [currentAct, setCurrentAct] = useState<DemoAct>("intro");
  const [coordinationComplete, setCoordinationComplete] = useState(false);

  const goToAct = (act: DemoAct) => {
    setCurrentAct(act);
    if (act === "intro") {
      setCoordinationComplete(false);
    }
  };

  const resetDemo = () => {
    setCurrentAct("intro");
    setCoordinationComplete(false);
  };

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-950 via-purple-950 to-slate-900">
      <DemoNavHeader title="LVMH Market Entry Demo" showBackButton={true} />

      {/* Act Navigation */}
      <div className="border-b border-purple-800/20 bg-slate-950/30 pt-20">
        <div className="container mx-auto px-6 py-3">
          <div className="flex justify-between items-center">
            {[
              { id: "intro", label: "1. Introduction", icon: Play },
              { id: "detection", label: "2. AI Detection @ 91%", icon: Target },
              { id: "coordination", label: "3. 12-Minute Response", icon: TrendingUp },
              { id: "outcome", label: "4. Market Leadership", icon: Crown }
            ].map((act) => (
              <button
                key={act.id}
                onClick={() => goToAct(act.id as DemoAct)}
                className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
                  currentAct === act.id
                    ? "bg-purple-600 text-white"
                    : "text-purple-300 hover:bg-purple-950/50"
                }`}
                data-testid={`button-act-${act.id}`}
              >
                <act.icon className="w-4 h-4" />
                <span className="text-sm font-medium">{act.label}</span>
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="container mx-auto px-6 py-12">
        {/* ACT 1: INTRODUCTION */}
        {currentAct === "intro" && (
          <div className="max-w-5xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-purple-800/30">
              <div className="text-center mb-8">
                <Crown className="w-16 h-16 text-purple-400 mx-auto mb-4" />
                <h2 className="text-3xl font-bold text-white mb-3">{lvmhMarketEntryDemoData.crisis.title}</h2>
                <p className="text-xl text-purple-200">{lvmhMarketEntryDemoData.crisis.subtitle}</p>
              </div>

              <div className="grid md:grid-cols-2 gap-6 mb-8">
                <div className="p-6 bg-purple-950/30 rounded-lg border border-purple-800/30">
                  <h3 className="font-bold text-white mb-4 flex items-center gap-2">
                    <Globe className="w-5 h-5 text-purple-400" />
                    The Opportunity
                  </h3>
                  <div className="space-y-3 text-sm">
                    <div>
                      <div className="text-purple-300 mb-1">Organization</div>
                      <div className="text-white font-semibold">{lvmhMarketEntryDemoData.organization.name}</div>
                    </div>
                    <div>
                      <div className="text-purple-300 mb-1">Opportunity</div>
                      <div className="text-white">China luxury market +47% rebound</div>
                    </div>
                    <div>
                      <div className="text-purple-300 mb-1">Strategic Move</div>
                      <div className="text-white">10 brands  15 cities  47 retail locations</div>
                    </div>
                    <div>
                      <div className="text-purple-300 mb-1">Investment</div>
                      <div className="text-white font-bold">580M capex  1.68B value creation</div>
                    </div>
                  </div>
                </div>

                <div className="p-6 bg-slate-900/50 rounded-lg border border-purple-800/30">
                  <h3 className="font-bold text-white mb-4">Traditional Coordination Timeline</h3>
                  <ul className="space-y-2 text-sm text-purple-200">
                    <li> Month 1-2: Sequential brand planning (10 brands independently)</li>
                    <li> Month 3-4: Real estate negotiations drag out</li>
                    <li className="text-amber-400 font-semibold"> During gap: Kering and Herms capture premium locations</li>
                    <li className="text-red-400 font-bold"> During gap: Golden Week launch window missed</li>
                    <li> Month 5-6: Fragmented launches begin</li>
                    <li className="text-purple-300"> Result: 420M opportunity cost + market leadership lost</li>
                  </ul>
                </div>
              </div>

              <div className="bg-gradient-to-r from-purple-950/50 to-indigo-950/50 border border-purple-700 rounded-lg p-6 mb-8">
                <div className="flex items-start gap-4">
                  <Target className="w-8 h-8 text-purple-400 flex-shrink-0 mt-1" />
                  <div>
                    <h3 className="font-bold text-white mb-2">Strategic Execution, Not Crisis Response</h3>
                    <p className="text-purple-100 leading-relaxed">
                      This isn't a crisisit's a strategic offensive move. China's luxury market rebounds 47%, creating 
                      a 90-day window to capture market leadership. But coordinating 10 brands (Louis Vuitton, Dior, Fendi, 
                      Givenchy, Celine, Loewe, Loro Piana, Rimowa, Berluti, Kenzo) across 15 cities traditionally takes 
                      <strong> 6-9 months</strong>. M compresses coordination to <strong>12 minutes</strong>, enabling 
                      simultaneous launch during Golden Week while competitors are still planning.
                    </p>
                  </div>
                </div>
              </div>

              <div className="grid md:grid-cols-3 gap-4 mb-8">
                <div className="p-4 bg-purple-950/30 rounded-lg border border-purple-800/30 text-center">
                  <Users className="w-8 h-8 text-purple-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">1,267</div>
                  <div className="text-sm text-purple-300">Stakeholders Coordinated</div>
                </div>
                <div className="p-4 bg-purple-950/30 rounded-lg border border-purple-800/30 text-center">
                  <TrendingUp className="w-8 h-8 text-purple-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">12 Minutes</div>
                  <div className="text-sm text-purple-300">Full Coordination</div>
                </div>
                <div className="p-4 bg-purple-950/30 rounded-lg border border-purple-800/30 text-center">
                  <DollarSign className="w-8 h-8 text-purple-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">1.68B</div>
                  <div className="text-sm text-purple-300">Value Created</div>
                </div>
              </div>

              <div className="text-center">
                <Button
                  size="lg"
                  onClick={() => goToAct("detection")}
                  className="bg-purple-600 hover:bg-purple-700 text-white px-8 py-6 text-lg"
                  data-testid="button-begin-simulation"
                >
                  <Play className="w-5 h-5 mr-2" />
                  Begin Opportunity Simulation
                </Button>
                <p className="text-sm text-purple-400 mt-3">Experience how M enables strategic velocity</p>
              </div>
            </Card>
          </div>
        )}

        {/* ACT 2: AI DETECTION */}
        {currentAct === "detection" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-purple-800/30">
              <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                <Target className="w-8 h-8 text-purple-400" />
                Act 2: AI Market Intelligence Detection
              </h2>
              <p className="text-lg text-purple-200 mb-4">
                9:00 AM Paris - LVMH AI Intelligence detects massive luxury market opportunity: China consumer spending surges 47%. 
                Competitive window: 90 days before Kering and Herms respond. Six AI systems recommend Playbook #145 activation.
              </p>
              <div className="mt-6 p-4 bg-purple-900/50 border border-purple-500 rounded">
                <div className="flex items-center gap-3">
                  <CheckCircle className="h-6 w-6 text-purple-400 animate-pulse" />
                  <div>
                    <p className="font-bold text-white">Strategic Opportunity Criteria Met</p>
                    <p className="text-sm text-purple-200">
                      Market conditions optimal - Playbook #145 (Strategic Market Entry) recommended
                    </p>
                  </div>
                </div>
              </div>
            </Card>

            <AIRadarSimulation
              dataStreams={lvmhMarketEntryDemoData.aiDataStreams}
              title="Market Intelligence Signals"
              playbookId="#145"
              playbookName="Strategic Market Entry"
              autoStart={true}
            />

            <div className="text-center mt-8">
              <Button
                size="lg"
                onClick={() => goToAct("coordination")}
                className="gap-2 bg-purple-600 hover:bg-purple-700 text-white"
                data-testid="button-activate-playbook"
              >
                <Crown className="h-5 w-5" />
                Activate Playbook #145 - Market Entry
              </Button>
              <p className="text-sm text-purple-300 mt-2">
                Bernard Arnault approves - Execute coordinated launch
              </p>
            </div>
          </div>
        )}

        {/* ACT 3: COORDINATED RESPONSE */}
        {currentAct === "coordination" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-purple-800/30">
              <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                <TrendingUp className="w-8 h-8 text-purple-400" />
                Act 3: 12-Minute Coordinated Execution
              </h2>
              <p className="text-lg text-purple-200 mb-6">
                M coordinates all 1,267 stakeholders in 12 minutes. Bernard Arnault's decision triggers instant alignment across 
                28 executives, 347 operational specialists, and 892 external partnersenabling simultaneous 10-brand launch.
              </p>

              <div className="grid md:grid-cols-3 gap-6 mb-8">
                <div className="p-6 bg-purple-950/30 rounded-lg border border-purple-800/30">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold">1</div>
                    <h3 className="font-bold text-white">Executive Leadership</h3>
                  </div>
                  <p className="text-sm text-purple-200 mb-2">28 executives receive unified brief and approve 580M investment in 4 minutes</p>
                  <div className="text-2xl font-bold text-purple-400">28 Leaders</div>
                </div>
                <div className="p-6 bg-purple-950/30 rounded-lg border border-purple-800/30">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold">2</div>
                    <h3 className="font-bold text-white">Operations Teams</h3>
                  </div>
                  <p className="text-sm text-purple-200 mb-2">Real estate, legal, supply chain, marketing, HR executing simultaneously</p>
                  <div className="text-2xl font-bold text-purple-400">347 Specialists</div>
                </div>
                <div className="p-6 bg-purple-950/30 rounded-lg border border-purple-800/30">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold">3</div>
                    <h3 className="font-bold text-white">External Partners</h3>
                  </div>
                  <p className="text-sm text-purple-200 mb-2">Developers, contractors, agencies, logisticsall activated</p>
                  <div className="text-2xl font-bold text-purple-400">892 Partners</div>
                </div>
              </div>
            </Card>

            <TwelveMinuteTimer
              timelineEvents={lvmhMarketEntryDemoData.timelineEvents}
              onComplete={() => setCoordinationComplete(true)}
              autoStart={true}
            />

            {coordinationComplete && (
              <div className="text-center animate-in fade-in duration-500">
                <Button
                  size="lg"
                  onClick={() => goToAct("outcome")}
                  className="gap-2 bg-purple-600 hover:bg-purple-700 text-white"
                  data-testid="button-view-outcome"
                >
                  <Crown className="h-5 w-5" />
                  View Strategic Outcome
                </Button>
              </div>
            )}
          </div>
        )}

        {/* ACT 4: ROI OUTCOME */}
        {currentAct === "outcome" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-purple-800/30 text-center">
              <Crown className="w-16 h-16 text-purple-400 mx-auto mb-4" />
              <h2 className="text-3xl font-bold text-white mb-3">
                1.68B Value Creation Through Strategic Velocity
              </h2>
              <p className="text-xl text-purple-200 mb-6">
                LVMH coordinates 10-brand simultaneous launch in 12 minutes, captures Golden Week timing, 
                secures 47 premium locations, and establishes market leadership before Kering/Herms respond.
              </p>

              <div className="grid md:grid-cols-3 gap-6 mb-8">
                <div className="p-4 bg-purple-950/30 rounded-lg">
                  <div className="text-3xl font-bold text-purple-400 mb-2">1.68B</div>
                  <div className="text-sm text-purple-300">Total Value Creation</div>
                </div>
                <div className="p-4 bg-purple-950/30 rounded-lg">
                  <div className="text-3xl font-bold text-purple-400 mb-2">12 Min</div>
                  <div className="text-sm text-purple-300">vs 6-9 Months Traditional</div>
                </div>
                <div className="p-4 bg-purple-950/30 rounded-lg">
                  <div className="text-3xl font-bold text-purple-400 mb-2">1,267</div>
                  <div className="text-sm text-purple-300">Stakeholders Aligned</div>
                </div>
              </div>
            </Card>

            <ROIComparison
              traditional={lvmhMarketEntryDemoData.roiComparisonData.traditional}
              vexor={lvmhMarketEntryDemoData.roiComparisonData.vexor}
              bottomLine={lvmhMarketEntryDemoData.roiComparisonData.bottomLine}
            />

            <div className="flex justify-center gap-4">
              <Button onClick={resetDemo} variant="outline" className="border-purple-500 text-purple-300 hover:bg-purple-950" data-testid="button-replay">
                Replay Demo
              </Button>
              <Link href="/industry-demos">
                <Button className="bg-purple-600 hover:bg-purple-700 text-white" data-testid="button-all-demos">
                  View All Industry Demos
                </Button>
              </Link>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/ManufacturingSupplierDemo.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useState, useEffect } from "react";
import { Link } from "wouter";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Factory, Cpu, AlertTriangle, CheckCircle, Clock, TrendingUp, DollarSign, ShieldAlert, ArrowLeft, Play } from "lucide-react";
import AIRadarSimulation from "@/components/demo/AIRadarSimulation";
import TwelveMinuteTimer from "@/components/demo/TwelveMinuteTimer";
import ROIComparison from "@/components/demo/ROIComparison";
import DemoNavHeader from "@/components/demo/DemoNavHeader";
import { manufacturingDemoData } from "@shared/manufacturing-demo-data";

type DemoAct = "intro" | "detection" | "coordination" | "outcome";

export default function ManufacturingSupplierDemo() {
  const [currentAct, setCurrentAct] = useState<DemoAct>("intro");
  const [detectionProgress, setDetectionProgress] = useState(0);
  const [coordinationComplete, setCoordinationComplete] = useState(false);

  // Auto-progress detection
  useEffect(() => {
    if (currentAct === "detection" && detectionProgress < 100) {
      const interval = setInterval(() => {
        setDetectionProgress(prev => {
          if (prev >= 100) {
            clearInterval(interval);
            return 100;
          }
          return prev + 2;
        });
      }, 100);
      return () => clearInterval(interval);
    }
  }, [currentAct, detectionProgress]);

  const resetDemo = () => {
    setCurrentAct("intro");
    setDetectionProgress(0);
    setCoordinationComplete(false);
  };

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-950 via-orange-950 to-slate-900">
      <DemoNavHeader title="Manufacturing Supplier Demo" showBackButton={true} />

      {/* Act Navigation */}
      <div className="border-b border-orange-800/20 bg-slate-950/30 pt-20">
        <div className="container mx-auto px-6 py-3">
          <div className="flex justify-between items-center">
            {[
              { id: "intro", label: "1. Introduction", icon: Play },
              { id: "detection", label: "2. AI Detection @ 89%", icon: ShieldAlert },
              { id: "coordination", label: "3. 4-Hour Response", icon: Clock },
              { id: "outcome", label: "4. $450M Saved", icon: DollarSign }
            ].map((act) => (
              <button
                key={act.id}
                onClick={() => setCurrentAct(act.id as DemoAct)}
                className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
                  currentAct === act.id
                    ? "bg-orange-600 text-white"
                    : "text-orange-300 hover:bg-orange-950/50"
                }`}
                data-testid={`button-act-${act.id}`}
              >
                <act.icon className="w-4 h-4" />
                <span className="text-sm font-medium">{act.label}</span>
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="container mx-auto px-6 py-12">
        {/* ACT 1: INTRODUCTION */}
        {currentAct === "intro" && (
          <div className="max-w-5xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-orange-800/30">
              <div className="text-center mb-8">
                <Cpu className="w-16 h-16 text-orange-400 mx-auto mb-4" />
                <h2 className="text-3xl font-bold text-white mb-3">{manufacturingDemoData.crisis.title}</h2>
                <p className="text-xl text-orange-200">{manufacturingDemoData.crisis.subtitle}</p>
              </div>

              <div className="grid md:grid-cols-2 gap-6 mb-8">
                <div className="p-6 bg-orange-950/30 rounded-lg border border-orange-800/30">
                  <h3 className="font-bold text-white mb-4 flex items-center gap-2">
                    <AlertTriangle className="w-5 h-5 text-orange-400" />
                    The Crisis
                  </h3>
                  <div className="space-y-3 text-sm">
                    <div>
                      <div className="text-orange-300 mb-1">Organization</div>
                      <div className="text-white font-semibold">Toyota Motor Corporation</div>
                    </div>
                    <div>
                      <div className="text-orange-300 mb-1">Component</div>
                      <div className="text-white">Critical Semiconductor Chips</div>
                    </div>
                    <div>
                      <div className="text-orange-300 mb-1">Impact</div>
                      <div className="text-white">50,000 chip shortage discovered</div>
                    </div>
                    <div>
                      <div className="text-orange-300 mb-1">At Risk</div>
                      <div className="text-white font-bold">10,000 vehicles ($500M production)</div>
                    </div>
                  </div>
                </div>

                <div className="p-6 bg-slate-900/50 rounded-lg border border-orange-800/30">
                  <h3 className="font-bold text-white mb-4">Traditional Response (30 Days)</h3>
                  <ul className="space-y-2 text-sm text-orange-200">
                    <li> Day 1-2: Assess which suppliers affected</li>
                    <li> Day 3: Discover 50,000 chip shortage</li>
                    <li> Day 4-5: Emergency meetings to find alternatives</li>
                    <li> Week 2: Alternative supplier can't meet quality specs</li>
                    <li> Week 3: Engineering scrambles to re-qualify parts</li>
                    <li className="text-orange-400 font-semibold"> Week 4: Production lines shut down</li>
                    <li className="text-orange-400 font-bold"> Month 2: Customers buying from competitors</li>
                  </ul>
                </div>
              </div>

              <div className="bg-gradient-to-r from-orange-950/50 to-amber-950/50 border border-orange-700 rounded-lg p-6 mb-8">
                <div className="flex items-start gap-4">
                  <ShieldAlert className="w-8 h-8 text-orange-400 flex-shrink-0 mt-1" />
                  <div>
                    <h3 className="font-bold text-white mb-2">Just-In-Time Manufacturing Needs Just-In-Time Coordination</h3>
                    <p className="text-orange-100 leading-relaxed">
                      Toyota pioneered Just-In-Time manufacturing to eliminate waste. But when suppliers fail, coordination still takes 
                      <strong> 30 days</strong> of meetings, emails, and qualification delays. M brings Just-In-Time principles to 
                      crisis coordination: pre-vetted backup suppliers, pre-negotiated contracts, pre-approved budgets. Result: 
                      <strong> 4-hour response</strong> instead of 30-day production halt.
                    </p>
                  </div>
                </div>
              </div>

              <div className="text-center">
                <Button
                  size="lg"
                  onClick={() => setCurrentAct("detection")}
                  className="bg-orange-600 hover:bg-orange-700 text-white px-8"
                  data-testid="button-start-demo"
                >
                  Begin Crisis Simulation
                  <Play className="w-5 h-5 ml-2" />
                </Button>
              </div>
            </Card>
          </div>
        )}

        {/* ACT 2: AI DETECTION */}
        {currentAct === "detection" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-orange-800/30">
              <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                <ShieldAlert className="w-8 h-8 text-orange-400" />
                Supply Chain AI Detects Critical Supplier Failure
              </h2>

              <div className="mb-8">
                <div className="flex items-center justify-between mb-3">
                  <span className="text-orange-200">AI Confidence Level</span>
                  <span className="text-2xl font-bold text-orange-400">{detectionProgress}%</span>
                </div>
                <Progress value={detectionProgress} className="h-3" />
                {detectionProgress >= 89 && (
                  <div className="mt-4 p-4 bg-orange-950/50 border border-orange-600 rounded-lg">
                    <p className="text-orange-200 font-semibold">
                       ALERT: Critical supplier failure detected - 10,000 vehicle production at risk ($500M)
                    </p>
                  </div>
                )}
              </div>

              <AIRadarSimulation
                dataStreams={manufacturingDemoData.aiDataStreams}
                title="Supply Chain Intelligence Signals"
                playbookId="#019"
                playbookName="Supplier Failure Response"
                autoStart={true}
              />

              {detectionProgress >= 89 && (
                <div className="mt-8 text-center">
                  <Button
                    size="lg"
                    onClick={() => setCurrentAct("coordination")}
                    className="bg-orange-600 hover:bg-orange-700 text-white px-8"
                    data-testid="button-activate-playbook"
                  >
                    Activate Playbook #019 - Supplier Failure
                    <CheckCircle className="w-5 h-5 ml-2" />
                  </Button>
                </div>
              )}
            </Card>
          </div>
        )}

        {/* ACT 3: 4-HOUR COORDINATION */}
        {currentAct === "coordination" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-orange-800/30">
              <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                <Clock className="w-8 h-8 text-orange-400" />
                4-Hour Coordinated Response Across 158 Stakeholders
              </h2>

              <TwelveMinuteTimer
                timelineEvents={manufacturingDemoData.timelineEvents}
                stakeholderTiers={manufacturingDemoData.stakeholderTiers}
                onComplete={() => setCoordinationComplete(true)}
                autoStart={true}
              />

              {coordinationComplete && (
                <div className="mt-8">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    {manufacturingDemoData.stakeholderTiers && (
                      <>
                        <Card className="p-6 bg-orange-950/30 border-orange-700">
                          <div className="text-orange-300 text-sm mb-2">Tier 1: Decision Makers</div>
                          <div className="text-3xl font-bold text-white mb-3">{manufacturingDemoData.stakeholderTiers.tier1.count}</div>
                          <div className="text-xs text-orange-200">
                            {manufacturingDemoData.stakeholderTiers.tier1.members.join(", ")}
                          </div>
                        </Card>
                        <Card className="p-6 bg-orange-950/30 border-orange-700">
                          <div className="text-orange-300 text-sm mb-2">Tier 2: Execution Teams</div>
                          <div className="text-3xl font-bold text-white mb-3">{manufacturingDemoData.stakeholderTiers.tier2.count}</div>
                          <div className="text-xs text-orange-200">
                            {manufacturingDemoData.stakeholderTiers.tier2.members.join(", ")}
                          </div>
                        </Card>
                        <Card className="p-6 bg-orange-950/30 border-orange-700">
                          <div className="text-orange-300 text-sm mb-2">Tier 3: External Partners</div>
                          <div className="text-3xl font-bold text-white mb-3">{manufacturingDemoData.stakeholderTiers.tier3.count}</div>
                          <div className="text-xs text-orange-200">
                            {manufacturingDemoData.stakeholderTiers.tier3.members.join(", ")}
                          </div>
                        </Card>
                      </>
                    )}
                  </div>

                  <div className="text-center">
                    <Button
                      size="lg"
                      onClick={() => setCurrentAct("outcome")}
                      className="bg-green-600 hover:bg-green-700 text-white px-8"
                      data-testid="button-view-outcome"
                    >
                      View Impact & ROI
                      <DollarSign className="w-5 h-5 ml-2" />
                    </Button>
                  </div>
                </div>
              )}
            </Card>
          </div>
        )}

        {/* ACT 4: ROI OUTCOME */}
        {currentAct === "outcome" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-green-800/30">
              <div className="text-center mb-8">
                <TrendingUp className="w-16 h-16 text-green-400 mx-auto mb-4" />
                <h2 className="text-3xl font-bold text-white mb-3">$450M Production Saved</h2>
                <p className="text-xl text-green-200">2-day pause vs 30-day production halt</p>
              </div>

              <ROIComparison
                traditional={manufacturingDemoData.roiComparison.traditional}
                vexor={manufacturingDemoData.roiComparison.vexor}
                bottomLine={manufacturingDemoData.roiComparison.bottomLine}
              />

              <div className="mt-8 grid grid-cols-1 md:grid-cols-4 gap-4">
                <Card className="p-4 bg-green-950/30 border-green-800">
                  <div className="text-green-300 text-sm mb-1">Production Saved</div>
                  <div className="text-2xl font-bold text-green-400">$450M</div>
                </Card>
                <Card className="p-4 bg-blue-950/30 border-blue-800">
                  <div className="text-blue-300 text-sm mb-1">Response Time</div>
                  <div className="text-2xl font-bold text-blue-400">4 hours</div>
                </Card>
                <Card className="p-4 bg-purple-950/30 border-purple-800">
                  <div className="text-purple-300 text-sm mb-1">Vehicles Protected</div>
                  <div className="text-2xl font-bold text-purple-400">10,000</div>
                </Card>
                <Card className="p-4 bg-orange-950/30 border-orange-800">
                  <div className="text-orange-300 text-sm mb-1">Production Pause</div>
                  <div className="text-2xl font-bold text-orange-400">2 days</div>
                </Card>
              </div>

              <div className="mt-8 flex justify-center gap-4">
                <Button
                  size="lg"
                  onClick={resetDemo}
                  variant="outline"
                  className="border-orange-500 text-orange-400 hover:bg-orange-950/50"
                  data-testid="button-replay-demo"
                >
                  Replay Demo
                </Button>
                <Link href="/industry-demos">
                  <Button size="lg" className="bg-blue-600 hover:bg-blue-700" data-testid="button-explore-more">
                    Explore More Industry Demos
                  </Button>
                </Link>
              </div>
            </Card>
          </div>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/MarketingLanding.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { 
  Shield, 
  Zap, 
  Target, 
  TrendingUp, 
  Clock, 
  Brain, 
  ChevronRight,
  CheckCircle2,
  BarChart3,
  ArrowRight,
  Rocket,
  Radio,
  FileText,
  Layers,
  Plug,
  Users
} from "lucide-react";
import { useLocation } from "wouter";
import { useEffect, useState } from "react";
import { updatePageMetadata } from "@/lib/seo";
import StandardNav from "@/components/layout/StandardNav";
import CreateScenarioButton from "@/components/scenario/CreateScenarioButton";
import DemoWelcomeScreen from "@/components/demo/DemoWelcomeScreen";
import ExecutionTimelineDemo from "@/components/demo/ExecutionTimelineDemo";
import InteractiveROICalculator from "@/components/demo/InteractiveROICalculator";

export default function MarketingLanding() {
  const [, setLocation] = useLocation();

  useEffect(() => {
    updatePageMetadata({
      title: "M - Strategic Execution Operating System | Transform Strategy into 12-Minute Execution",
      description: "Your competitor just launched. Your board meeting is in 3 days. M is the first Strategic Execution Operating System that transforms 72-hour strategic coordination into 12-minute coordinated execution. 166 playbooks, 5 AI modules, 24/7 monitoring, institutional memorybuilt for Fortune 1000 strategic dominance.",
      ogTitle: "M - When Your Competitor Moves, Will You Be Ready?",
      ogDescription: "The category-defining Strategic Execution Operating System. Limited Q1 2025 pilot: 10 Fortune 1000 design partners. Prepare  Monitor  Execute  Learn.",
    });
  }, []);

  return (
    <div className="page-background min-h-screen">
      <StandardNav onViewDemo={() => setLocation('/demo')} />

      {/* Hero Section */}
      <section className="py-20 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white relative overflow-hidden">
        <div className="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAxMCAwIEwgMCAwIDAgMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIi8+PC9zdmc+')] opacity-20"></div>
        
        <div className="max-w-7xl mx-auto text-center relative z-10">
          {/* High-Stakes Competitive Scenario */}
          <div className="mb-8">
            <Badge className="mb-4 bg-red-600 text-white border-0 text-sm px-4 py-1.5 animate-pulse" data-testid="badge-alert">
               COMPETITIVE ALERT
            </Badge>
            <h1 className="text-4xl md:text-7xl font-bold mb-6 leading-tight max-w-6xl mx-auto text-white" data-testid="heading-hero">
              Monday 9:15 AM:<br />
              <span className="text-red-300">Your Competitor Just Launched.</span>
            </h1>
            <div className="max-w-3xl mx-auto mb-6">
              <div className="bg-red-900/30 border-2 border-red-500/50 rounded-lg p-6 mb-4">
                <p className="text-xl md:text-2xl text-white font-semibold mb-3">
                  Their product is 15% cheaper. Social sentiment is tanking. 12 deals worth $2.4M are at risk.
                </p>
                <p className="text-lg text-red-200">
                  Your next board meeting? <span className="font-bold text-white">Thursday 2 PM.</span>
                </p>
              </div>
              <p className="text-xl md:text-2xl text-yellow-200 font-bold">
                By then, you'll have lost market share.<br />
                <span className="text-white">Unless you have M.</span>
              </p>
            </div>
          </div>

          {/* Solution - Category Definition */}
          <div className="mb-10">
            <div className="max-w-5xl mx-auto mb-8">
              <Badge className="mb-4 bg-cyan-500 text-white border-0 text-base px-6 py-2">
                Category-Defining Platform
              </Badge>
              <h2 className="text-3xl md:text-4xl font-bold text-cyan-400 mb-4">
                The First Strategic Execution Operating System
              </h2>
              <p className="text-xl md:text-2xl text-white mb-4 leading-relaxed">
                Transform 72-hour strategic coordination into <span className="text-cyan-300 font-bold">12-minute coordinated execution</span>
              </p>
              <div className="flex items-center justify-center gap-6 text-lg text-blue-100 mb-6">
                <div className="flex items-center gap-2">
                  <CheckCircle2 className="h-5 w-5 text-green-400" />
                  <span>166 Strategic Playbooks</span>
                </div>
                <div className="flex items-center gap-2">
                  <CheckCircle2 className="h-5 w-5 text-green-400" />
                  <span>5 AI Intelligence Modules</span>
                </div>
                <div className="flex items-center gap-2">
                  <CheckCircle2 className="h-5 w-5 text-green-400" />
                  <span>24/7 Monitoring</span>
                </div>
              </div>
            </div>

            {/* Methodology Card - Rebranded */}
            <Card className="max-w-4xl mx-auto bg-gradient-to-br from-blue-900/40 to-purple-900/40 backdrop-blur-sm border-2 border-blue-400/50">
              <CardContent className="p-6">
                <div className="text-center mb-4">
                  <h3 className="text-2xl font-bold text-white mb-2">
                    Prepare  Monitor  Execute  Learn
                  </h3>
                  <p className="text-blue-200 text-sm">
                    Championship-level execution methodology proven at enterprise scale
                  </p>
                </div>
                <div className="grid md:grid-cols-2 gap-6 text-left">
                  <div className="bg-white/5 rounded-lg p-4 border border-white/10">
                    <div className="text-cyan-300 font-semibold mb-2 flex items-center gap-2">
                      <Shield className="h-5 w-5" />
                      Preparation-Driven Execution
                    </div>
                    <p className="text-blue-100 text-sm">
                      Pre-configured playbooks with 80% templates ready. When triggers fire, 
                      stakeholders know exactly what to dono meetings, no delays.
                    </p>
                  </div>
                  <div className="bg-white/5 rounded-lg p-4 border border-white/10">
                    <div className="text-cyan-300 font-semibold mb-2 flex items-center gap-2">
                      <Brain className="h-5 w-5" />
                      Dynamic Strategy Methodology
                    </div>
                    <p className="text-blue-100 text-sm">
                      Living systems that sense market shifts, adapt playbooks, and learn from 
                      every executionbuilding institutional memory that compounds over time.
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Interactive ROI Calculator */}
          <div className="max-w-4xl mx-auto mb-12">
            <InteractiveROICalculator persona="general" industry="general" />
          </div>

          {/* Urgency & Exclusivity - Pilot Slots */}
          <div className="mb-10 max-w-5xl mx-auto">
            <Card className="bg-gradient-to-br from-red-900/40 to-orange-900/40 border-3 border-yellow-400/70 backdrop-blur-sm shadow-2xl" data-testid="card-pilot-urgency">
              <CardContent className="p-8">
                <div className="text-center mb-6">
                  <Badge className="mb-4 bg-yellow-500 text-black font-bold text-base px-6 py-2 animate-pulse">
                     LIMITED AVAILABILITY
                  </Badge>
                  <h3 className="text-3xl md:text-4xl font-bold text-white mb-3">
                    Q1 2025 Design Partner Program
                  </h3>
                  <p className="text-xl text-yellow-200 mb-6">
                    Join 10 Fortune 1000 companies building the future of executive decision operations
                  </p>
                  
                  {/* Urgency Counter */}
                  <div className="bg-black/40 rounded-lg p-6 mb-6 border-2 border-yellow-500/50">
                    <div className="flex items-center justify-center gap-8 mb-4">
                      <div>
                        <div className="text-5xl font-bold text-red-400">7</div>
                        <div className="text-sm text-gray-300">Slots Filled</div>
                      </div>
                      <div className="text-4xl text-yellow-400">/</div>
                      <div>
                        <div className="text-5xl font-bold text-green-400">10</div>
                        <div className="text-sm text-gray-300">Total Slots</div>
                      </div>
                    </div>
                    <div className="flex items-center justify-center gap-2 text-yellow-200 text-sm">
                      <Clock className="h-4 w-4" />
                      <span className="font-semibold">Only 3 design partner slots remaining</span>
                    </div>
                  </div>

                  {/* What Design Partners Get */}
                  <div className="grid md:grid-cols-3 gap-4 mb-8 text-left">
                    <div className="bg-white/5 rounded-lg p-4 border border-white/10">
                      <CheckCircle2 className="h-6 w-6 text-green-400 mb-2" />
                      <div className="font-semibold text-white mb-1">90-Day Validation</div>
                      <div className="text-sm text-gray-300">Full platform access with dedicated success team</div>
                    </div>
                    <div className="bg-white/5 rounded-lg p-4 border border-white/10">
                      <CheckCircle2 className="h-6 w-6 text-green-400 mb-2" />
                      <div className="font-semibold text-white mb-1">Priority Roadmap</div>
                      <div className="text-sm text-gray-300">Shape product features for your industry</div>
                    </div>
                    <div className="bg-white/5 rounded-lg p-4 border border-white/10">
                      <CheckCircle2 className="h-6 w-6 text-green-400 mb-2" />
                      <div className="font-semibold text-white mb-1">Founding Pricing</div>
                      <div className="text-sm text-gray-300">Lock in lifetime partnership rates</div>
                    </div>
                  </div>

                  {/* Single Exclusive CTA */}
                  <Button 
                    size="lg"
                    onClick={() => setLocation("/contact")}
                    className="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-400 hover:to-orange-400 text-black font-bold text-xl px-12 py-8 shadow-2xl transform hover:scale-105 transition-all"
                    data-testid="button-design-partner"
                  >
                    <Target className="mr-3 h-6 w-6" />
                    Apply for Design Partner Program
                    <ArrowRight className="ml-3 h-6 w-6" />
                  </Button>
                  
                  <p className="text-sm text-gray-300 mt-4">
                    Executive intake form  72-hour response  No commitment required
                  </p>
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Prominent Demo and Playbook Links */}
          <div className="text-center mb-8">
            {/* Featured: Live Demo Selector */}
            <div className="mb-6">
              <Button 
                onClick={() => setLocation("/demo/selector")}
                size="lg"
                className="bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-400 hover:to-emerald-400 text-white font-bold text-lg px-10 py-6 shadow-2xl transform hover:scale-105 transition-all border-2 border-green-300"
                data-testid="button-live-demo-selector"
              >
                <Radio className="mr-3 h-6 w-6 animate-pulse" />
                Choose Your Live Demo
                <ArrowRight className="ml-3 h-6 w-6" />
              </Button>
              <p className="text-xs text-green-300 mt-2 font-semibold">
                 7 Interactive Scenarios  12-minute live coordination  Perfect for presentations
              </p>
            </div>

            <div className="flex flex-col sm:flex-row items-center justify-center gap-4 mb-4">
              <Button 
                onClick={() => setLocation("/industry-demos")}
                variant="outline"
                size="lg"
                className="border-2 border-cyan-400 text-cyan-300 hover:bg-cyan-400/10 font-semibold px-8"
                data-testid="button-view-demos"
              >
                <Rocket className="mr-2 h-5 w-5" />
                View 9 Industry Demos
                <ArrowRight className="ml-2 h-5 w-5" />
              </Button>
              
              <Button 
                onClick={() => setLocation("/playbook-library")}
                variant="outline"
                size="lg"
                className="border-2 border-purple-400 text-purple-300 hover:bg-purple-400/10 font-semibold px-8"
                data-testid="button-view-playbooks"
              >
                <FileText className="mr-2 h-5 w-5" />
                Explore 166 Playbooks
                <ArrowRight className="ml-2 h-5 w-5" />
              </Button>
            </div>
            
            <p className="text-sm text-blue-400">
              Or{" "}
              <button 
                onClick={() => setLocation("/demo")}
                className="underline hover:text-cyan-300 transition-colors"
                data-testid="link-watch-demo"
              >
                watch the 12-minute execution demo
              </button>
            </p>
          </div>
        </div>
      </section>

      {/* Complete Product Features - All Capabilities */}
      <section className="py-20 px-6 bg-gradient-to-b from-white to-slate-50 dark:from-slate-900 dark:to-slate-800">
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-16">
            <Badge className="mb-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white border-0 text-base px-6 py-2">
              Complete Platform Access
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-4 text-slate-900 dark:text-white">
              Explore All Product Features
            </h2>
            <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto">
              Complete platform ecosystem for championship-level execution. Click any feature to explore.
            </p>
          </div>

          {/* Feature Grid */}
          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
            {/* 1. Create Playbook - PROMINENT */}
            <Card className="border-2 border-purple-500 bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 hover:shadow-2xl transition-all duration-300 col-span-full lg:col-span-1" data-testid="card-create-playbook">
              <CardContent className="p-6">
                <div className="flex items-start gap-4 mb-4">
                  <div className="w-12 h-12 rounded-lg bg-gradient-to-r from-purple-600 to-blue-600 flex items-center justify-center flex-shrink-0">
                    <Rocket className="w-6 h-6 text-white" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">
                      Create Strategic Playbook
                    </h3>
                    <Badge className="bg-purple-600 text-white mb-3">Start Here</Badge>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                      Build complete decision operations playbook in 5 phases: Context, Stakeholders, Triggers, Metrics, Review
                    </p>
                  </div>
                </div>
                <CreateScenarioButton organizationId="default-org" className="w-full" />
              </CardContent>
            </Card>

            {/* 2. AI Intelligence (5 Modules) */}
            <Card className="border-2 border-cyan-300 dark:border-cyan-700 hover:shadow-xl transition-all duration-300" data-testid="card-ai-intelligence">
              <CardContent className="p-6">
                <div className="flex items-start gap-4 mb-4">
                  <div className="w-12 h-12 rounded-lg bg-cyan-100 dark:bg-cyan-900 flex items-center justify-center flex-shrink-0">
                    <Brain className="w-6 h-6 text-cyan-600 dark:text-cyan-400" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">
                      AI Intelligence Layer
                    </h3>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                      5 specialized AI modules: Pulse, Flux, Prism, Echo, Nova for strategic insights
                    </p>
                  </div>
                </div>
                <Button onClick={() => setLocation('/ai')} variant="outline" className="w-full border-cyan-500 text-cyan-600 hover:bg-cyan-50 dark:hover:bg-cyan-900/20" data-testid="button-ai-intelligence">
                  Explore AI Modules <ChevronRight className="ml-2 h-4 w-4" />
                </Button>
              </CardContent>
            </Card>

            {/* 3. 24/7 Monitoring */}
            <Card className="border-2 border-blue-300 dark:border-blue-700 hover:shadow-xl transition-all duration-300" data-testid="card-monitoring">
              <CardContent className="p-6">
                <div className="flex items-start gap-4 mb-4">
                  <div className="w-12 h-12 rounded-lg bg-blue-100 dark:bg-blue-900 flex items-center justify-center flex-shrink-0">
                    <Radio className="w-6 h-6 text-blue-600 dark:text-blue-400" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">
                      24/7 Monitoring System
                    </h3>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                      Track 12 intelligence signals with AI-powered pattern recognition and proactive alerts
                    </p>
                  </div>
                </div>
                <Button onClick={() => setLocation('/ai-radar')} variant="outline" className="w-full border-blue-500 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20" data-testid="button-monitoring">
                  View AI Radar <ChevronRight className="ml-2 h-4 w-4" />
                </Button>
              </CardContent>
            </Card>

            {/* 4. Playbook Library */}
            <Card className="border-2 border-green-300 dark:border-green-700 hover:shadow-xl transition-all duration-300" data-testid="card-scenarios">
              <CardContent className="p-6">
                <div className="flex items-start gap-4 mb-4">
                  <div className="w-12 h-12 rounded-lg bg-green-100 dark:bg-green-900 flex items-center justify-center flex-shrink-0">
                    <FileText className="w-6 h-6 text-green-600 dark:text-green-400" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">
                      Playbook Library
                    </h3>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                      166 strategic playbooks across 9 operational domains covering growth, defense, transformation, and AI governance
                    </p>
                  </div>
                </div>
                <Button onClick={() => setLocation('/playbook-library')} variant="outline" className="w-full border-green-500 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20" data-testid="button-scenarios">
                  Browse Playbooks <ChevronRight className="ml-2 h-4 w-4" />
                </Button>
              </CardContent>
            </Card>

            {/* 5. What-If Analyzer */}
            <Card className="border-2 border-orange-300 dark:border-orange-700 hover:shadow-xl transition-all duration-300" data-testid="card-what-if">
              <CardContent className="p-6">
                <div className="flex items-start gap-4 mb-4">
                  <div className="w-12 h-12 rounded-lg bg-orange-100 dark:bg-orange-900 flex items-center justify-center flex-shrink-0">
                    <Layers className="w-6 h-6 text-orange-600 dark:text-orange-400" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">
                      What-If Analyzer
                    </h3>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                      Test strategic approaches, simulate outcomes, and optimize execution plans
                    </p>
                  </div>
                </div>
                <Button onClick={() => setLocation('/what-if-analyzer')} variant="outline" className="w-full border-orange-500 text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20" data-testid="button-what-if">
                  Run Simulations <ChevronRight className="ml-2 h-4 w-4" />
                </Button>
              </CardContent>
            </Card>

            {/* 6. Command Center */}
            <Card className="border-2 border-red-300 dark:border-red-700 hover:shadow-xl transition-all duration-300" data-testid="card-command-center">
              <CardContent className="p-6">
                <div className="flex items-start gap-4 mb-4">
                  <div className="w-12 h-12 rounded-lg bg-red-100 dark:bg-red-900 flex items-center justify-center flex-shrink-0">
                    <Shield className="w-6 h-6 text-red-600 dark:text-red-400" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">
                      Executive Command Center
                    </h3>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                      Real-time strategic coordination hub for 12-minute execution
                    </p>
                  </div>
                </div>
                <Button onClick={() => setLocation('/command-center')} variant="outline" className="w-full border-red-500 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20" data-testid="button-command-center">
                  Open War Room <ChevronRight className="ml-2 h-4 w-4" />
                </Button>
              </CardContent>
            </Card>

            {/* 7. Triggers Management */}
            <Card className="border-2 border-yellow-300 dark:border-yellow-700 hover:shadow-xl transition-all duration-300" data-testid="card-triggers">
              <CardContent className="p-6">
                <div className="flex items-start gap-4 mb-4">
                  <div className="w-12 h-12 rounded-lg bg-yellow-100 dark:bg-yellow-900 flex items-center justify-center flex-shrink-0">
                    <Zap className="w-6 h-6 text-yellow-600 dark:text-yellow-400" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">
                      Trigger Management
                    </h3>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                      Define conditions, activate playbooks, monitor execution status
                    </p>
                  </div>
                </div>
                <Button onClick={() => setLocation('/triggers-management')} variant="outline" className="w-full border-yellow-600 text-yellow-600 hover:bg-yellow-50 dark:hover:bg-yellow-900/20" data-testid="button-triggers">
                  Manage Triggers <ChevronRight className="ml-2 h-4 w-4" />
                </Button>
              </CardContent>
            </Card>

            {/* 8. Integration Hub */}
            <Card className="border-2 border-indigo-300 dark:border-indigo-700 hover:shadow-xl transition-all duration-300" data-testid="card-integrations">
              <CardContent className="p-6">
                <div className="flex items-start gap-4 mb-4">
                  <div className="w-12 h-12 rounded-lg bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center flex-shrink-0">
                    <Plug className="w-6 h-6 text-indigo-600 dark:text-indigo-400" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">
                      Integration Hub
                    </h3>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                      Connect Jira, Slack, Teams, Salesforce, and 50+ enterprise tools
                    </p>
                  </div>
                </div>
                <Button onClick={() => setLocation('/integrations')} variant="outline" className="w-full border-indigo-500 text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/20" data-testid="button-integrations">
                  View Integrations <ChevronRight className="ml-2 h-4 w-4" />
                </Button>
              </CardContent>
            </Card>

            {/* 9. Institutional Memory */}
            <Card className="border-2 border-teal-300 dark:border-teal-700 hover:shadow-xl transition-all duration-300" data-testid="card-memory">
              <CardContent className="p-6">
                <div className="flex items-start gap-4 mb-4">
                  <div className="w-12 h-12 rounded-lg bg-teal-100 dark:bg-teal-900 flex items-center justify-center flex-shrink-0">
                    <Brain className="w-6 h-6 text-teal-600 dark:text-teal-400" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-xl font-bold text-slate-900 dark:text-white mb-2">
                      Institutional Memory
                    </h3>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                      Capture decision outcomes, refine playbooks, build organizational wisdom
                    </p>
                  </div>
                </div>
                <Button onClick={() => setLocation('/institutional-memory')} variant="outline" className="w-full border-teal-500 text-teal-600 hover:bg-teal-50 dark:hover:bg-teal-900/20" data-testid="button-memory">
                  Explore Memory <ChevronRight className="ml-2 h-4 w-4" />
                </Button>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* The Four-Phase Framework */}
      <section className="py-20 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-16">
            <Badge className="mb-4 bg-cyan-500 text-slate-900 border-0 text-base px-6 py-2" data-testid="badge-framework">
              The Core Workflow
            </Badge>
            <h2 className="text-4xl md:text-6xl font-bold mb-6 text-white">
              IDENTIFY  DETECT  EXECUTE  ADVANCE
            </h2>
            <p className="text-xl text-blue-200 max-w-4xl mx-auto leading-relaxed">
              This is the framework that wins championshipswhether in Eugene, Oregon or in Fortune 1000 boardrooms. Four phases that transform strategic intent into coordinated organizational execution.
            </p>
          </div>

          <div className="grid md:grid-cols-4 gap-6 mb-12">
            {/* Phase 1: IDENTIFY */}
            <Card className="bg-gradient-to-br from-violet-600/20 to-purple-600/20 border-2 border-violet-500" data-testid="card-phase-identify">
              <CardContent className="p-6">
                <div className="text-center mb-4">
                  <div className="inline-flex items-center justify-center h-16 w-16 rounded-full bg-violet-500 text-white text-2xl font-bold mb-3">
                    I
                  </div>
                  <h3 className="text-2xl font-bold text-white mb-2">IDENTIFY</h3>
                  <div className="text-violet-300 text-sm font-semibold mb-4">Build Your Depth Chart</div>
                </div>
                <p className="text-blue-100 text-sm mb-4">
                  Build playbooks for scenarios you might never face. Study the competitive landscape. Define every stakeholder's role. Set trigger conditions.
                </p>
                <div className="bg-violet-950/30 rounded-lg p-3 border border-violet-500/30">
                  <p className="text-violet-200 text-xs italic">
                    "We're never going to see this defense."
                  </p>
                  <p className="text-violet-300 text-xs font-semibold mt-1">
                    "Maybe. But if we do, we'll be ready."
                  </p>
                </div>
              </CardContent>
            </Card>

            {/* Phase 2: DETECT */}
            <Card className="bg-gradient-to-br from-blue-600/20 to-cyan-600/20 border-2 border-blue-500" data-testid="card-phase-detect">
              <CardContent className="p-6">
                <div className="text-center mb-4">
                  <div className="inline-flex items-center justify-center h-16 w-16 rounded-full bg-blue-500 text-white text-2xl font-bold mb-3">
                    D
                  </div>
                  <h3 className="text-2xl font-bold text-white mb-2">DETECT</h3>
                  <div className="text-blue-300 text-sm font-semibold mb-4">Monitor Signals</div>
                </div>
                <p className="text-blue-100 text-sm mb-4">
                  AI monitors competitive signals, customer patterns, operational metrics, and market shifts. Pattern recognition spots trigger conditions in real-time.
                </p>
                <div className="space-y-2">
                  <div className="flex items-start gap-2 text-xs text-blue-200">
                    <CheckCircle2 className="h-3 w-3 text-cyan-400 mt-0.5 flex-shrink-0" />
                    <span>Competitive moves detected</span>
                  </div>
                  <div className="flex items-start gap-2 text-xs text-blue-200">
                    <CheckCircle2 className="h-3 w-3 text-cyan-400 mt-0.5 flex-shrink-0" />
                    <span>Customer sentiment analyzed</span>
                  </div>
                  <div className="flex items-start gap-2 text-xs text-blue-200">
                    <CheckCircle2 className="h-3 w-3 text-cyan-400 mt-0.5 flex-shrink-0" />
                    <span>Market triggers identified</span>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Phase 3: EXECUTE */}
            <Card className="bg-gradient-to-br from-emerald-600/20 to-green-600/20 border-2 border-emerald-500" data-testid="card-phase-execute">
              <CardContent className="p-6">
                <div className="text-center mb-4">
                  <div className="inline-flex items-center justify-center h-16 w-16 rounded-full bg-emerald-500 text-white text-2xl font-bold mb-3">
                    E
                  </div>
                  <h3 className="text-2xl font-bold text-white mb-2">EXECUTE</h3>
                  <div className="text-emerald-300 text-sm font-semibold mb-4">Execute Response</div>
                </div>
                <p className="text-blue-100 text-sm mb-4">
                  One-click playbook activation. Every stakeholder receives coordinated assignments simultaneously. No meetings. No delays. Just execution.
                </p>
                <div className="bg-emerald-950/30 rounded-lg p-3 border border-emerald-500/30">
                  <div className="text-emerald-200 text-xs space-y-1">
                    <div><strong>0-2 min:</strong> System validation</div>
                    <div><strong>2-5 min:</strong> Stakeholder distribution</div>
                    <div><strong>5-12 min:</strong> Coordinated execution begins</div>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Phase 4: ADVANCE */}
            <Card className="bg-gradient-to-br from-amber-600/20 to-orange-600/20 border-2 border-amber-500" data-testid="card-phase-advance">
              <CardContent className="p-6">
                <div className="text-center mb-4">
                  <div className="inline-flex items-center justify-center h-16 w-16 rounded-full bg-amber-500 text-white text-2xl font-bold mb-3">
                    A
                  </div>
                  <h3 className="text-2xl font-bold text-white mb-2">ADVANCE</h3>
                  <div className="text-amber-300 text-sm font-semibold mb-4">Review the Film</div>
                </div>
                <p className="text-blue-100 text-sm mb-4">
                  Capture what worked. Measure performance across all 12 operating model elements. Refine playbooks. Get better every execution.
                </p>
                <div className="space-y-2">
                  <div className="flex items-start gap-2 text-xs text-blue-200">
                    <CheckCircle2 className="h-3 w-3 text-amber-400 mt-0.5 flex-shrink-0" />
                    <span>Decision outcomes documented</span>
                  </div>
                  <div className="flex items-start gap-2 text-xs text-blue-200">
                    <CheckCircle2 className="h-3 w-3 text-amber-400 mt-0.5 flex-shrink-0" />
                    <span>Playbooks continuously improved</span>
                  </div>
                  <div className="flex items-start gap-2 text-xs text-blue-200">
                    <CheckCircle2 className="h-3 w-3 text-amber-400 mt-0.5 flex-shrink-0" />
                    <span>Organization gets smarter</span>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          <div className="max-w-4xl mx-auto">
            <Card className="bg-gradient-to-r from-cyan-500/10 to-blue-500/10 border-2 border-cyan-500/50">
              <CardContent className="p-8 text-center">
                <p className="text-2xl font-bold text-white mb-3">
                  Elite organizations succeed through preparation, not improvisation.
                </p>
                <p className="text-xl text-blue-200">
                  M brings championship-level preparation to Fortune 1000 strategic operations: transforming 72-hour coordination into 12-minute execution.
                </p>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Business Scenarios Preview */}
      <section className="py-20 px-6 bg-gradient-to-br from-slate-900 to-blue-900 dark:from-slate-950 dark:to-blue-950">
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-6 bg-cyan-500 text-white border-0" data-testid="badge-scenarios">
              See It In Action
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-6 text-white">
              166 Strategic Playbook Library
            </h2>
            <p className="text-xl text-blue-100 mb-8 max-w-3xl mx-auto">
              Enterprise-ready playbook templates across 9 operational domains. From market dynamics to technology innovation, talent leadership to AI governancetransform any strategic initiative from a 72-hour process into a 12-minute coordinated response.
            </p>
          </div>

          <div className="grid md:grid-cols-4 gap-4 mb-12">
            <Card className="bg-green-600/10 border-2 border-green-500" data-testid="card-market-dynamics">
              <CardContent className="pt-6 pb-6">
                <div className="text-center">
                  <TrendingUp className="h-10 w-10 text-green-400 mx-auto mb-3" />
                  <h3 className="text-lg font-bold text-white mb-1">Market Dynamics</h3>
                  <p className="text-green-200 text-xs">Competitive threats & opportunities</p>
                </div>
              </CardContent>
            </Card>

            <Card className="bg-emerald-600/10 border-2 border-emerald-500" data-testid="card-financial-strategy">
              <CardContent className="pt-6 pb-6">
                <div className="text-center">
                  <BarChart3 className="h-10 w-10 text-emerald-400 mx-auto mb-3" />
                  <h3 className="text-lg font-bold text-white mb-1">Financial Strategy</h3>
                  <p className="text-emerald-200 text-xs">Capital allocation & risk management</p>
                </div>
              </CardContent>
            </Card>

            <Card className="bg-blue-600/10 border-2 border-blue-500" data-testid="card-operational-excellence">
              <CardContent className="pt-6 pb-6">
                <div className="text-center">
                  <Shield className="h-10 w-10 text-blue-400 mx-auto mb-3" />
                  <h3 className="text-lg font-bold text-white mb-1">Operational Excellence</h3>
                  <p className="text-blue-200 text-xs">Supply chain & process optimization</p>
                </div>
              </CardContent>
            </Card>

            <Card className="bg-purple-600/10 border-2 border-purple-500" data-testid="card-technology-innovation">
              <CardContent className="pt-6 pb-6">
                <div className="text-center">
                  <Zap className="h-10 w-10 text-purple-400 mx-auto mb-3" />
                  <h3 className="text-lg font-bold text-white mb-1">Technology & Innovation</h3>
                  <p className="text-purple-200 text-xs">Digital transformation & AI adoption</p>
                </div>
              </CardContent>
            </Card>

            <Card className="bg-amber-600/10 border-2 border-amber-500" data-testid="card-talent-leadership">
              <CardContent className="pt-6 pb-6">
                <div className="text-center">
                  <Users className="h-10 w-10 text-amber-400 mx-auto mb-3" />
                  <h3 className="text-lg font-bold text-white mb-1">Talent & Leadership</h3>
                  <p className="text-amber-200 text-xs">Culture, workforce & succession</p>
                </div>
              </CardContent>
            </Card>

            <Card className="bg-pink-600/10 border-2 border-pink-500" data-testid="card-brand-reputation">
              <CardContent className="pt-6 pb-6">
                <div className="text-center">
                  <Target className="h-10 w-10 text-pink-400 mx-auto mb-3" />
                  <h3 className="text-lg font-bold text-white mb-1">Brand & Reputation</h3>
                  <p className="text-pink-200 text-xs">PR crises & stakeholder trust</p>
                </div>
              </CardContent>
            </Card>

            <Card className="bg-cyan-600/10 border-2 border-cyan-500" data-testid="card-regulatory-compliance">
              <CardContent className="pt-6 pb-6">
                <div className="text-center">
                  <Shield className="h-10 w-10 text-cyan-400 mx-auto mb-3" />
                  <h3 className="text-lg font-bold text-white mb-1">Regulatory & Compliance</h3>
                  <p className="text-cyan-200 text-xs">Legal, regulatory & governance</p>
                </div>
              </CardContent>
            </Card>

            <Card className="bg-indigo-600/10 border-2 border-indigo-500" data-testid="card-market-opportunities">
              <CardContent className="pt-6 pb-6">
                <div className="text-center">
                  <Rocket className="h-10 w-10 text-indigo-400 mx-auto mb-3" />
                  <h3 className="text-lg font-bold text-white mb-1">Market Opportunities</h3>
                  <p className="text-indigo-200 text-xs">M&A, expansion & new markets</p>
                </div>
              </CardContent>
            </Card>
          </div>

          <div className="text-center">
            <Button 
              size="lg" 
              className="bg-white text-blue-900 hover:bg-blue-50 text-lg px-8 py-6 h-auto font-semibold"
              onClick={() => setLocation("/playbook-library")}
              data-testid="button-explore-scenarios"
            >
              Explore Playbook Library
              <ArrowRight className="ml-2 h-5 w-5" />
            </Button>
          </div>
        </div>
      </section>

      {/* Execution Plan Demo - 12-Minute Playbook Example */}
      <section id="execution-demo-section" className="py-20 px-6 bg-slate-100 dark:bg-slate-900">
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white border-0 text-base px-6 py-2">
              See 12-Minute Execution in Action
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-4 text-slate-900 dark:text-white">
              Complete Playbook: Competitive Response
            </h2>
            <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto">
              When your competitor launches a 15% price cut, here's how M coordinates your entire response team in 12 minutesinstead of the 72-hour industry standard.
            </p>
          </div>

          <div className="max-w-6xl mx-auto">
            <ExecutionTimelineDemo planType="competitive_response" />
          </div>

          <div className="mt-12 text-center">
            <Card className="bg-gradient-to-r from-blue-600/10 to-cyan-600/10 border-2 border-cyan-500/50 max-w-4xl mx-auto">
              <CardContent className="p-8">
                <h3 className="text-2xl font-bold text-slate-900 dark:text-white mb-4">
                  From 72 Hours to 12 Minutes = 360x Faster
                </h3>
                <p className="text-lg text-slate-700 dark:text-slate-300 mb-6">
                  This is preparation-driven execution at enterprise scale. Build your playbooks once. Trigger them instantly. Execute with precision. Learn systematically.
                </p>
                <Button 
                  size="lg" 
                  className="bg-cyan-600 hover:bg-cyan-500 text-white text-lg px-10 py-6"
                  onClick={() => setLocation("/how-it-works")}
                  data-testid="button-see-execution-demo"
                >
                  See Full Interactive Demo <ChevronRight className="ml-2 h-5 w-5" />
                </Button>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Social Proof - Research & Credibility */}
      <section className="py-20 px-6 bg-slate-100 dark:bg-slate-900">
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-blue-600 text-white border-0" data-testid="badge-problem-research">
              The Research
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-6 text-slate-900 dark:text-white">
              The Fortune 1000 Execution Gap
            </h2>
            <p className="text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">
              The gap between strategic planning and coordinated execution costs enterprises billions annually
            </p>
          </div>

          <div className="grid md:grid-cols-3 gap-8 mb-12">
            <Card data-testid="card-stat-coordination-time">
              <CardContent className="pt-6 text-center">
                <div className="text-5xl font-bold text-red-600 mb-2">72 hours</div>
                <div className="text-lg font-semibold mb-2 text-slate-900 dark:text-white">Industry Standard</div>
                <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">
                  Average coordination time for strategic initiatives in Fortune 1000 companies
                </div>
                <div className="text-xs text-slate-500 italic">Source: HBR "Why Strategy Execution Unravels" (2015), McKinsey "Decision Making in the Age of Urgency" (2023)</div>
              </CardContent>
            </Card>

            <Card data-testid="card-stat-missed-opportunities">
              <CardContent className="pt-6 text-center">
                <div className="text-5xl font-bold text-red-600 mb-2">87%</div>
                <div className="text-lg font-semibold mb-2 text-slate-900 dark:text-white">Missed Windows</div>
                <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">
                  Strategic initiatives that miss execution windows due to coordination delays
                </div>
                <div className="text-xs text-slate-500 italic">Source: Bain & Company "The Execution Premium" study (2022)</div>
              </CardContent>
            </Card>

            <Card data-testid="card-stat-vexor-target">
              <CardContent className="pt-6 text-center">
                <div className="text-5xl font-bold text-green-600 mb-2">12 min</div>
                <div className="text-lg font-semibold mb-2 text-slate-900 dark:text-white">M Target</div>
                <div className="text-sm text-slate-600 dark:text-slate-400">
                  Design goal: Coordinated execution with pre-built playbooks and AI orchestration
                </div>
              </CardContent>
            </Card>
          </div>

          <Card className="bg-blue-50 dark:bg-blue-950/30 border-2 border-blue-200 dark:border-blue-800" data-testid="card-founding-vision">
            <CardContent className="pt-8 pb-8">
              <p className="text-xl italic text-slate-700 dark:text-slate-300 mb-4 text-center max-w-3xl mx-auto">
                "When strategic opportunities emerge, the companies that execute in days beat the companies that plan in weeks. M is purpose-built to close that gap."
              </p>
              <div className="text-center">
                <div className="font-semibold text-slate-900 dark:text-white">M Founding Team</div>
                <div className="text-sm text-slate-600 dark:text-slate-400">Bringing championship-level execution to enterprise strategy</div>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Final CTA */}
      <section className="py-24 px-6 bg-gradient-to-br from-blue-600 via-cyan-600 to-teal-600 text-white">
        <div className="max-w-4xl mx-auto text-center">
          <h2 className="text-4xl md:text-5xl font-bold mb-6">
            Ready to Transform Strategic Execution?
          </h2>
          <p className="text-xl text-blue-100 mb-8">
            Join 10 Fortune 1000 pilot companies in Q1 2025. 90-day validation partnership. Risk-free strategic implementation support.
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <Button 
              size="lg"
              onClick={() => setLocation("/contact")}
              className="bg-white text-blue-600 hover:bg-blue-50 text-lg px-10 py-6 font-semibold"
              data-testid="button-cta-contact"
            >
              Request Early Access
            </Button>
            <Button 
              size="lg"
              onClick={() => setLocation("/executive-demo")}
              variant="outline"
              className="border-2 border-white text-white hover:bg-white/10 text-lg px-10 py-6"
              data-testid="button-cta-demo"
            >
              Experience Full Demo
            </Button>
          </div>
        </div>
      </section>
    </div>
  );
}


========================================
FILE: client/src/pages/NewUserJourney.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Switch } from '@/components/ui/switch';
import { Checkbox } from '@/components/ui/checkbox';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Separator } from '@/components/ui/separator';
import { useToast } from '@/hooks/use-toast';
import { useQuery, useMutation } from '@tanstack/react-query';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useLocation } from 'wouter';
import { motion, AnimatePresence } from 'framer-motion';
import { SIGNAL_CATEGORIES } from '@shared/intelligence-signals';
import { 
  Rocket,
  Building2,
  Users,
  Target,
  BarChart3,
  CheckCircle,
  ChevronRight,
  ChevronLeft,
  Sparkles,
  Zap,
  Shield,
  Clock,
  Bell,
  Layers,
  ArrowRight,
  Settings,
  AlertTriangle,
  TrendingUp,
  Globe,
  DollarSign,
  Briefcase,
  Play,
  Radio,
  Activity,
  Eye,
  Timer,
  Award,
  CircleDot,
  Check,
  X,
  MessageSquare,
  Mail,
  Cpu,
  Home
} from 'lucide-react';

const INDUSTRIES = [
  { id: 'technology', name: 'Technology', icon: Cpu, description: 'Software, Hardware, SaaS, Cloud' },
  { id: 'financial', name: 'Financial Services', icon: DollarSign, description: 'Banking, Insurance, Investment' },
  { id: 'healthcare', name: 'Healthcare & Life Sciences', icon: Shield, description: 'Pharma, Biotech, Medical Devices' },
  { id: 'retail', name: 'Retail & Consumer', icon: Briefcase, description: 'E-commerce, CPG, Luxury' },
  { id: 'manufacturing', name: 'Manufacturing', icon: Settings, description: 'Industrial, Automotive, Aerospace' },
  { id: 'energy', name: 'Energy & Utilities', icon: Zap, description: 'Oil & Gas, Renewables, Utilities' },
  { id: 'media', name: 'Media & Entertainment', icon: Play, description: 'Streaming, Gaming, Publishing' },
  { id: 'telecom', name: 'Telecommunications', icon: Radio, description: 'Carriers, Infrastructure, 5G' },
];

const EXECUTIVE_ROLES = [
  { id: 'ceo', name: 'CEO / President', description: 'Enterprise-wide strategic oversight' },
  { id: 'coo', name: 'COO / Operations', description: 'Operational execution & efficiency' },
  { id: 'cfo', name: 'CFO / Finance', description: 'Financial strategy & risk management' },
  { id: 'cto', name: 'CTO / CIO / Technology', description: 'Technology strategy & innovation' },
  { id: 'cmo', name: 'CMO / Marketing', description: 'Brand & market positioning' },
  { id: 'chro', name: 'CHRO / People', description: 'Talent & organizational development' },
  { id: 'cso', name: 'CSO / Strategy', description: 'Corporate strategy & planning' },
  { id: 'cro', name: 'CRO / Revenue', description: 'Revenue growth & customer success' },
];

const STRATEGIC_PRIORITIES = [
  { id: 'growth', name: 'Revenue Growth', icon: TrendingUp, description: 'Accelerate top-line growth and market expansion' },
  { id: 'efficiency', name: 'Operational Efficiency', icon: Settings, description: 'Optimize operations and reduce costs' },
  { id: 'innovation', name: 'Innovation & Disruption', icon: Sparkles, description: 'Drive product innovation and digital transformation' },
  { id: 'risk', name: 'Risk Mitigation', icon: Shield, description: 'Proactively manage threats and build resilience' },
  { id: 'talent', name: 'Talent & Culture', icon: Users, description: 'Attract, retain, and develop top talent' },
  { id: 'customer', name: 'Customer Experience', icon: Award, description: 'Improve satisfaction and reduce churn' },
  { id: 'market', name: 'Market Positioning', icon: Target, description: 'Strengthen competitive positioning' },
  { id: 'sustainability', name: 'Sustainability & ESG', icon: Globe, description: 'Environmental and social responsibility' },
];

const PLAYBOOK_RECOMMENDATIONS: Record<string, { playbooks: { id: string; name: string; domain: string; description: string; triggers: string[] }[] }> = {
  'technology': {
    playbooks: [
      { id: 'cyber-incident', name: 'Cybersecurity Incident Response', domain: 'Crisis', description: 'Rapid response to security breaches and ransomware', triggers: ['Security breach detected', 'Anomalous network activity'] },
      { id: 'product-launch', name: 'Product Launch Acceleration', domain: 'Market', description: 'Coordinate rapid market entry and GTM execution', triggers: ['Competitor product announcement', 'Market window opening'] },
      { id: 'talent-retention', name: 'Key Talent Retention', domain: 'People', description: 'Respond to attrition risks and competitive poaching', triggers: ['Executive resignation', 'Competitor hiring spree'] },
      { id: 'regulatory-compliance', name: 'Tech Regulatory Response', domain: 'Regulatory', description: 'Navigate evolving tech regulations and privacy laws', triggers: ['New regulation announced', 'Compliance gap identified'] },
    ]
  },
  'financial': {
    playbooks: [
      { id: 'market-volatility', name: 'Market Volatility Response', domain: 'Crisis', description: 'Navigate market disruptions and protect portfolios', triggers: ['Market drop >5%', 'Volatility index spike'] },
      { id: 'regulatory-change', name: 'Regulatory Change Response', domain: 'Regulatory', description: 'Rapid compliance with new financial regulations', triggers: ['Regulatory announcement', 'Audit finding'] },
      { id: 'fraud-response', name: 'Fraud Incident Response', domain: 'Crisis', description: 'Coordinate response to fraud detection', triggers: ['Fraud detected', 'Suspicious activity alert'] },
      { id: 'ma-integration', name: 'M&A Integration Playbook', domain: 'Strategic', description: 'Orchestrate post-merger integration', triggers: ['Deal close', 'Integration milestone'] },
    ]
  },
  'healthcare': {
    playbooks: [
      { id: 'product-recall', name: 'Product Recall Execution', domain: 'Crisis', description: 'Coordinate FDA recalls and patient safety', triggers: ['Safety signal detected', 'FDA notification'] },
      { id: 'clinical-trial', name: 'Clinical Trial Response', domain: 'Regulatory', description: 'Respond to trial outcomes and regulatory decisions', triggers: ['Trial data readout', 'FDA decision'] },
      { id: 'supply-disruption', name: 'Supply Chain Disruption', domain: 'Operations', description: 'Maintain drug supply during shortages', triggers: ['Supplier issue', 'Inventory alert'] },
      { id: 'patent-expiry', name: 'Patent Cliff Response', domain: 'Strategic', description: 'Prepare for generic competition', triggers: ['Patent expiry approaching', 'Generic filing detected'] },
    ]
  },
  'retail': {
    playbooks: [
      { id: 'competitive-pricing', name: 'Competitive Pricing Response', domain: 'Market', description: 'React to aggressive competitor pricing', triggers: ['Competitor price drop', 'Market share shift'] },
      { id: 'supply-chain', name: 'Supply Chain Crisis', domain: 'Operations', description: 'Navigate logistics and inventory disruptions', triggers: ['Supplier failure', 'Port delay'] },
      { id: 'brand-crisis', name: 'Brand Reputation Crisis', domain: 'Crisis', description: 'Manage PR incidents and social media storms', triggers: ['Negative sentiment spike', 'Viral complaint'] },
      { id: 'seasonal-surge', name: 'Seasonal Demand Surge', domain: 'Operations', description: 'Capitalize on peak selling periods', triggers: ['Demand forecast exceeded', 'Inventory running low'] },
    ]
  },
  'manufacturing': {
    playbooks: [
      { id: 'supplier-crisis', name: 'Supplier Failure Response', domain: 'Operations', description: 'Activate backup suppliers and maintain production', triggers: ['Supplier default', 'Quality issue'] },
      { id: 'safety-incident', name: 'Safety Incident Response', domain: 'Crisis', description: 'Manage workplace safety events', triggers: ['Safety incident', 'OSHA notification'] },
      { id: 'quality-recall', name: 'Quality Issue / Recall', domain: 'Crisis', description: 'Coordinate product quality responses', triggers: ['Defect rate spike', 'Customer complaint surge'] },
      { id: 'automation', name: 'Automation Transition', domain: 'Strategic', description: 'Manage workforce and process automation', triggers: ['ROI threshold met', 'Technology available'] },
    ]
  },
  'energy': {
    playbooks: [
      { id: 'grid-failure', name: 'Grid Failure Response', domain: 'Crisis', description: 'Restore service during outages', triggers: ['Grid instability', 'Weather event'] },
      { id: 'price-volatility', name: 'Commodity Price Response', domain: 'Market', description: 'Navigate energy price fluctuations', triggers: ['Price swing >10%', 'OPEC announcement'] },
      { id: 'environmental', name: 'Environmental Incident', domain: 'Crisis', description: 'Respond to spills and environmental events', triggers: ['Leak detected', 'EPA alert'] },
      { id: 'transition', name: 'Energy Transition Acceleration', domain: 'Strategic', description: 'Accelerate renewable energy initiatives', triggers: ['Policy change', 'Technology breakthrough'] },
    ]
  },
  'media': {
    playbooks: [
      { id: 'content-crisis', name: 'Content Crisis Response', domain: 'Crisis', description: 'Manage controversial content situations', triggers: ['Viral complaint', 'Advertiser concern'] },
      { id: 'piracy-response', name: 'Piracy / IP Theft Response', domain: 'Legal', description: 'Combat content piracy and protect IP', triggers: ['Piracy detected', 'IP infringement'] },
      { id: 'talent-dispute', name: 'Talent Dispute Resolution', domain: 'People', description: 'Navigate talent contract issues', triggers: ['Contract dispute', 'Talent departure'] },
      { id: 'platform-launch', name: 'Platform Launch Acceleration', domain: 'Market', description: 'Coordinate new platform/service launches', triggers: ['Competitor launch', 'Market opportunity'] },
    ]
  },
  'telecom': {
    playbooks: [
      { id: 'network-outage', name: 'Network Outage Response', domain: 'Crisis', description: 'Restore service during major outages', triggers: ['Network failure', 'Service degradation'] },
      { id: 'spectrum-auction', name: 'Spectrum Auction Response', domain: 'Strategic', description: 'Navigate regulatory spectrum decisions', triggers: ['Auction announced', 'Spectrum availability'] },
      { id: 'competitive-response', name: 'Competitive Plan Response', domain: 'Market', description: 'React to competitor pricing/plans', triggers: ['Competitor announcement', 'Churn spike'] },
      { id: '5g-rollout', name: '5G Rollout Acceleration', domain: 'Strategic', description: 'Accelerate network technology deployment', triggers: ['Technology milestone', 'Competitor advancement'] },
    ]
  },
};

interface JourneyState {
  step: number;
  organizationName: string;
  industry: string;
  employeeCount: string;
  executiveRole: string;
  executiveName: string;
  executiveEmail: string;
  priorities: string[];
  selectedPlaybooks: string[];
  enabledSignals: string[];
  friTarget: number;
  velocityTarget: number;
  coverageTarget: number;
}

const STEPS = [
  { id: 'welcome', title: 'Welcome', icon: Rocket },
  { id: 'organization', title: 'Your Organization', icon: Building2 },
  { id: 'priorities', title: 'Strategic Priorities', icon: Target },
  { id: 'playbooks', title: 'Select Playbooks', icon: Layers },
  { id: 'signals', title: 'Configure Signals', icon: Radio },
  { id: 'metrics', title: 'Success Metrics', icon: BarChart3 },
  { id: 'preview', title: 'See M in Action', icon: Play },
  { id: 'activated', title: 'System Active', icon: CheckCircle },
];

export default function NewUserJourney() {
  const { toast } = useToast();
  const [, setLocation] = useLocation();
  
  const [state, setState] = useState<JourneyState>({
    step: 0,
    organizationName: '',
    industry: '',
    employeeCount: '',
    executiveRole: '',
    executiveName: '',
    executiveEmail: '',
    priorities: [],
    selectedPlaybooks: [],
    enabledSignals: [],
    friTarget: 84.4,
    velocityTarget: 12,
    coverageTarget: 95,
  });


  const updateState = (updates: Partial<JourneyState>) => {
    setState(prev => ({ ...prev, ...updates }));
  };

  const progress = ((state.step + 1) / STEPS.length) * 100;
  const currentStepInfo = STEPS[state.step];

  const canProceed = () => {
    switch (state.step) {
      case 0: return true;
      case 1: return state.organizationName && state.industry && state.executiveRole;
      case 2: return state.priorities.length >= 2;
      case 3: return state.selectedPlaybooks.length >= 1;
      case 4: return state.enabledSignals.length >= 3;
      case 5: return true;
      case 6: return true;
      case 7: return true;
      default: return false;
    }
  };

  const getRecommendedPlaybooks = () => {
    const industryPlaybooks = PLAYBOOK_RECOMMENDATIONS[state.industry]?.playbooks || [];
    return industryPlaybooks;
  };

  const getRecommendedSignals = () => {
    const priorityToSignals: Record<string, string[]> = {
      'growth': ['competitive', 'market', 'customer'],
      'efficiency': ['execution', 'supplychain', 'financial'],
      'innovation': ['technology', 'innovation', 'market'],
      'risk': ['regulatory', 'geopolitical', 'economic'],
      'talent': ['talent', 'behavior', 'competitive'],
      'customer': ['customer', 'behavior', 'media'],
      'market': ['competitive', 'market', 'media'],
      'sustainability': ['esg', 'regulatory', 'media'],
    };

    const recommendedCategories = new Set<string>();
    state.priorities.forEach(priority => {
      const signals = priorityToSignals[priority] || [];
      signals.forEach(s => recommendedCategories.add(s));
    });

    return Array.from(recommendedCategories);
  };

  const completeJourneyMutation = useMutation({
    mutationFn: async () => {
      const promises = [];
      
      promises.push(
        apiRequest('POST', '/api/config/departments', { name: 'Executive', description: 'Executive leadership' }).catch(() => {}),
        apiRequest('POST', '/api/config/departments', { name: 'Operations', description: 'Operations team' }).catch(() => {}),
        apiRequest('POST', '/api/config/departments', { name: 'Strategy', description: 'Strategy team' }).catch(() => {})
      );

      for (const signalId of state.enabledSignals) {
        const category = SIGNAL_CATEGORIES.find(c => c.id === signalId);
        if (category && category.dataPoints.length > 0) {
          const dataPoint = category.dataPoints[0];
          promises.push(
            apiRequest('POST', '/api/executive-triggers', {
              name: `${category.name} Monitor`,
              description: `Auto-configured during onboarding`,
              category: signalId,
              triggerType: 'threshold',
              conditions: {
                dataPointId: dataPoint.id,
                operator: dataPoint.defaultThreshold?.operator || 'gt',
                value: String(dataPoint.defaultThreshold?.value || 0)
              },
              alertThreshold: 'high',
              isActive: true,
              autoActivate: false,
              recommendedPlaybooks: category.recommendedPlaybooks || []
            }).catch(() => {})
          );
        }
      }

      promises.push(
        apiRequest('POST', '/api/config/success-metrics', {
          name: 'Future Readiness Index',
          metricType: 'fri',
          targetValue: state.friTarget,
          currentValue: 72.3,
          baselineValue: 58.1,
          unit: '%',
        }).catch(() => {}),
        apiRequest('POST', '/api/config/success-metrics', {
          name: 'Decision Velocity',
          metricType: 'velocity',
          targetValue: state.velocityTarget,
          currentValue: 45,
          baselineValue: 72,
          unit: 'minutes',
        }).catch(() => {})
      );

      await Promise.all(promises);
      return { success: true };
    },
    onSuccess: () => {
      queryClient.refetchQueries({ queryKey: ['/api/config'], exact: false });
      queryClient.refetchQueries({ queryKey: ['/api/executive-triggers'], exact: false });
      updateState({ step: 7 });
    },
  });

  const handleNext = () => {
    if (state.step === 7) {
      setLocation('/executive-dashboard');
    } else if (state.step === 6) {
      completeJourneyMutation.mutate();
    } else {
      updateState({ step: state.step + 1 });
    }
  };
  
  const goToCommandCenter = () => {
    setLocation('/command-center');
  };

  const handleBack = () => {
    if (state.step > 0) {
      updateState({ step: state.step - 1 });
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-indigo-950">
      <div className="fixed top-0 left-0 right-0 z-50 bg-slate-900/90 backdrop-blur-sm border-b border-slate-700/50">
        <div className="max-w-5xl mx-auto px-6 py-4">
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                <span className="text-white font-bold text-lg">M</span>
              </div>
              <div>
                <h1 className="text-lg font-semibold text-white">Getting Started with M</h1>
                <p className="text-xs text-slate-400">Your first playbook will be ready in under 15 minutes</p>
              </div>
            </div>
            <div className="flex items-center gap-3">
              <Badge variant="outline" className="text-slate-300 border-slate-600">
                Step {state.step + 1} of {STEPS.length}
              </Badge>
              <Button
                variant="ghost"
                size="sm"
                onClick={() => setLocation('/')}
                className="text-slate-400 hover:text-white hover:bg-slate-800"
                data-testid="button-home"
              >
                <Home className="h-4 w-4 mr-1" />
                Home
              </Button>
            </div>
          </div>
          
          <div className="flex items-center gap-1">
            {STEPS.map((step, index) => {
              const isCompleted = index < state.step;
              const isCurrent = index === state.step;
              const Icon = step.icon;
              
              return (
                <div key={step.id} className="flex-1 flex items-center">
                  <div className={`
                    flex items-center justify-center w-8 h-8 rounded-full transition-all
                    ${isCurrent ? 'bg-indigo-600 ring-2 ring-indigo-400 ring-offset-2 ring-offset-slate-900' : ''}
                    ${isCompleted ? 'bg-green-600' : ''}
                    ${!isCurrent && !isCompleted ? 'bg-slate-700' : ''}
                  `}>
                    {isCompleted ? (
                      <Check className="h-4 w-4 text-white" />
                    ) : (
                      <Icon className={`h-4 w-4 ${isCurrent ? 'text-white' : 'text-slate-400'}`} />
                    )}
                  </div>
                  {index < STEPS.length - 1 && (
                    <div className={`flex-1 h-0.5 mx-1 ${isCompleted ? 'bg-green-600' : 'bg-slate-700'}`} />
                  )}
                </div>
              );
            })}
          </div>
        </div>
      </div>

      <div className="pt-32 pb-24 px-6">
        <div className="max-w-4xl mx-auto">
          <AnimatePresence mode="wait">
            <motion.div
              key={state.step}
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              transition={{ duration: 0.2 }}
            >
              {state.step === 0 && (
                <div className="text-center space-y-8">
                  <div className="w-24 h-24 mx-auto rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mb-6">
                    <Rocket className="h-12 w-12 text-white" />
                  </div>
                  
                  <div>
                    <h2 className="text-4xl font-bold text-white mb-4">
                      Success Favors the Prepared
                    </h2>
                    <p className="text-xl text-slate-300 max-w-2xl mx-auto">
                      M replaces reactive scrambles with coordinated precision, turning emerging opportunities 
                      into decisive action in <span className="text-indigo-400 font-semibold">12 minutes, not 72 hours</span>
                    </p>
                  </div>

                  <div className="grid grid-cols-3 gap-6 max-w-3xl mx-auto mt-12">
                    <Card className="bg-slate-800/50 border-slate-700 text-center p-6">
                      <div className="w-12 h-12 mx-auto rounded-lg bg-indigo-500/20 flex items-center justify-center mb-4">
                        <Clock className="h-6 w-6 text-indigo-400" />
                      </div>
                      <div className="text-2xl font-bold text-white mb-1">15 min</div>
                      <div className="text-sm text-slate-400">Time to your first playbook</div>
                    </Card>
                    <Card className="bg-slate-800/50 border-slate-700 text-center p-6">
                      <div className="w-12 h-12 mx-auto rounded-lg bg-green-500/20 flex items-center justify-center mb-4">
                        <Layers className="h-6 w-6 text-green-400" />
                      </div>
                      <div className="text-2xl font-bold text-white mb-1">166</div>
                      <div className="text-sm text-slate-400">Ready-to-use playbooks</div>
                    </Card>
                    <Card className="bg-slate-800/50 border-slate-700 text-center p-6">
                      <div className="w-12 h-12 mx-auto rounded-lg bg-purple-500/20 flex items-center justify-center mb-4">
                        <Radio className="h-6 w-6 text-purple-400" />
                      </div>
                      <div className="text-2xl font-bold text-white mb-1">92</div>
                      <div className="text-sm text-slate-400">Intelligence signals</div>
                    </Card>
                  </div>

                  <div className="bg-gradient-to-r from-indigo-900/30 to-purple-900/30 border border-indigo-500/30 rounded-xl p-6 max-w-2xl mx-auto mt-8">
                    <div className="flex items-start gap-4">
                      <div className="w-10 h-10 rounded-lg bg-indigo-500/30 flex items-center justify-center flex-shrink-0">
                        <Sparkles className="h-5 w-5 text-indigo-400" />
                      </div>
                      <div className="text-left">
                        <h3 className="font-semibold text-white mb-1">What you'll accomplish</h3>
                        <ul className="text-sm text-slate-300 space-y-1">
                          <li className="flex items-center gap-2">
                            <Check className="h-4 w-4 text-green-400" />
                            Configure M for your industry and role
                          </li>
                          <li className="flex items-center gap-2">
                            <Check className="h-4 w-4 text-green-400" />
                            Select and customize your first playbook
                          </li>
                          <li className="flex items-center gap-2">
                            <Check className="h-4 w-4 text-green-400" />
                            Enable AI monitoring for key signals
                          </li>
                          <li className="flex items-center gap-2">
                            <Check className="h-4 w-4 text-green-400" />
                            See a live simulation of M in action
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {state.step === 1 && (
                <div className="space-y-8">
                  <div className="text-center mb-8">
                    <h2 className="text-3xl font-bold text-white mb-2">Tell us about your organization</h2>
                    <p className="text-slate-400">This helps us personalize your playbooks and intelligence signals</p>
                  </div>

                  <div className="grid gap-6">
                    <div className="grid grid-cols-2 gap-6">
                      <div className="space-y-2">
                        <Label className="text-slate-300">Organization Name *</Label>
                        <Input
                          value={state.organizationName}
                          onChange={(e) => updateState({ organizationName: e.target.value })}
                          placeholder="Enter your company name"
                          className="bg-slate-800/50 border-slate-700 h-12 text-white placeholder:text-slate-500"
                          data-testid="input-org-name"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label className="text-slate-300">Employee Count</Label>
                        <Select value={state.employeeCount} onValueChange={(v) => updateState({ employeeCount: v })}>
                          <SelectTrigger className="bg-slate-800/50 border-slate-700 h-12 text-white" data-testid="select-employees">
                            <SelectValue placeholder="Select company size" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="1000-5000">1,000 - 5,000</SelectItem>
                            <SelectItem value="5000-10000">5,000 - 10,000</SelectItem>
                            <SelectItem value="10000-50000">10,000 - 50,000</SelectItem>
                            <SelectItem value="50000+">50,000+</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    <div className="space-y-3">
                      <Label className="text-slate-300">Industry *</Label>
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                        {INDUSTRIES.map((industry) => {
                          const Icon = industry.icon;
                          const isSelected = state.industry === industry.id;
                          return (
                            <Card
                              key={industry.id}
                              className={`cursor-pointer transition-all ${
                                isSelected 
                                  ? 'bg-indigo-600/20 border-indigo-500 ring-1 ring-indigo-500' 
                                  : 'bg-slate-800/50 border-slate-700 hover:border-slate-600'
                              }`}
                              onClick={() => updateState({ industry: industry.id, selectedPlaybooks: [] })}
                              data-testid={`industry-${industry.id}`}
                            >
                              <CardContent className="p-4 text-center">
                                <Icon className={`h-6 w-6 mx-auto mb-2 ${isSelected ? 'text-indigo-400' : 'text-slate-400'}`} />
                                <div className={`text-sm font-medium ${isSelected ? 'text-white' : 'text-slate-300'}`}>
                                  {industry.name}
                                </div>
                              </CardContent>
                            </Card>
                          );
                        })}
                      </div>
                    </div>

                    <Separator className="bg-slate-700" />

                    <div className="grid grid-cols-2 gap-6">
                      <div className="space-y-3">
                        <Label className="text-slate-300">Your Role *</Label>
                        <Select value={state.executiveRole} onValueChange={(v) => updateState({ executiveRole: v })}>
                          <SelectTrigger className="bg-slate-800/50 border-slate-700 h-12 text-white" data-testid="select-role">
                            <SelectValue placeholder="Select your role" />
                          </SelectTrigger>
                          <SelectContent>
                            {EXECUTIVE_ROLES.map((role) => (
                              <SelectItem key={role.id} value={role.id}>
                                <div className="flex flex-col">
                                  <span>{role.name}</span>
                                </div>
                              </SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label className="text-slate-300">Your Name</Label>
                        <Input
                          value={state.executiveName}
                          onChange={(e) => updateState({ executiveName: e.target.value })}
                          placeholder="Enter your name"
                          className="bg-slate-800/50 border-slate-700 h-12 text-white placeholder:text-slate-500"
                          data-testid="input-exec-name"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {state.step === 2 && (
                <div className="space-y-8">
                  <div className="text-center mb-8">
                    <h2 className="text-3xl font-bold text-white mb-2">What are your strategic priorities?</h2>
                    <p className="text-slate-400">Select at least 2 priorities to personalize your playbook recommendations</p>
                  </div>

                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    {STRATEGIC_PRIORITIES.map((priority) => {
                      const Icon = priority.icon;
                      const isSelected = state.priorities.includes(priority.id);
                      return (
                        <Card
                          key={priority.id}
                          className={`cursor-pointer transition-all ${
                            isSelected 
                              ? 'bg-indigo-600/20 border-indigo-500 ring-1 ring-indigo-500' 
                              : 'bg-slate-800/50 border-slate-700 hover:border-slate-600'
                          }`}
                          onClick={() => {
                            if (isSelected) {
                              updateState({ priorities: state.priorities.filter(p => p !== priority.id) });
                            } else {
                              updateState({ priorities: [...state.priorities, priority.id] });
                            }
                          }}
                          data-testid={`priority-${priority.id}`}
                        >
                          <CardContent className="p-4">
                            <div className="flex items-center justify-between mb-3">
                              <Icon className={`h-6 w-6 ${isSelected ? 'text-indigo-400' : 'text-slate-400'}`} />
                              {isSelected && <Check className="h-5 w-5 text-green-400" />}
                            </div>
                            <div className={`font-medium mb-1 ${isSelected ? 'text-white' : 'text-slate-300'}`}>
                              {priority.name}
                            </div>
                            <div className="text-xs text-slate-500">
                              {priority.description}
                            </div>
                          </CardContent>
                        </Card>
                      );
                    })}
                  </div>

                  {state.priorities.length > 0 && (
                    <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                      <div className="flex items-center gap-2 text-sm text-slate-300">
                        <CheckCircle className="h-4 w-4 text-green-400" />
                        <span>
                          Selected: {state.priorities.map(p => 
                            STRATEGIC_PRIORITIES.find(sp => sp.id === p)?.name
                          ).join(', ')}
                        </span>
                      </div>
                    </div>
                  )}
                </div>
              )}

              {state.step === 3 && (
                <div className="space-y-8">
                  <div className="text-center mb-8">
                    <h2 className="text-3xl font-bold text-white mb-2">Choose your first playbooks</h2>
                    <p className="text-slate-400">
                      Based on your industry ({INDUSTRIES.find(i => i.id === state.industry)?.name}), 
                      we recommend these playbooks
                    </p>
                  </div>

                  <div className="grid gap-4">
                    {getRecommendedPlaybooks().map((playbook) => {
                      const isSelected = state.selectedPlaybooks.includes(playbook.id);
                      return (
                        <Card
                          key={playbook.id}
                          className={`cursor-pointer transition-all ${
                            isSelected 
                              ? 'bg-indigo-600/20 border-indigo-500 ring-1 ring-indigo-500' 
                              : 'bg-slate-800/50 border-slate-700 hover:border-slate-600'
                          }`}
                          onClick={() => {
                            if (isSelected) {
                              updateState({ selectedPlaybooks: state.selectedPlaybooks.filter(p => p !== playbook.id) });
                            } else {
                              updateState({ selectedPlaybooks: [...state.selectedPlaybooks, playbook.id] });
                            }
                          }}
                          data-testid={`playbook-${playbook.id}`}
                        >
                          <CardContent className="p-5">
                            <div className="flex items-start justify-between">
                              <div className="flex-1">
                                <div className="flex items-center gap-3 mb-2">
                                  <h3 className={`font-semibold text-lg ${isSelected ? 'text-white' : 'text-slate-200'}`}>
                                    {playbook.name}
                                  </h3>
                                  <Badge variant="outline" className="text-xs">
                                    {playbook.domain}
                                  </Badge>
                                </div>
                                <p className="text-sm text-slate-400 mb-3">{playbook.description}</p>
                                <div className="flex items-center gap-2">
                                  <span className="text-xs text-slate-500">Triggers:</span>
                                  {playbook.triggers.map((trigger, idx) => (
                                    <Badge key={idx} variant="secondary" className="text-xs bg-slate-700">
                                      {trigger}
                                    </Badge>
                                  ))}
                                </div>
                              </div>
                              <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${
                                isSelected ? 'bg-green-500' : 'bg-slate-700'
                              }`}>
                                {isSelected ? (
                                  <Check className="h-5 w-5 text-white" />
                                ) : (
                                  <Layers className="h-5 w-5 text-slate-400" />
                                )}
                              </div>
                            </div>
                          </CardContent>
                        </Card>
                      );
                    })}
                  </div>

                  <div className="bg-slate-800/30 rounded-xl p-4 border border-slate-700/50">
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 rounded-lg bg-slate-700 flex items-center justify-center">
                        <Sparkles className="h-5 w-5 text-slate-400" />
                      </div>
                      <div>
                        <p className="text-sm text-slate-300">
                          You'll have access to all <span className="text-white font-semibold">166 playbooks</span> after setup.
                          These are just recommended starting points.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {state.step === 4 && (
                <div className="space-y-8">
                  <div className="text-center mb-8">
                    <h2 className="text-3xl font-bold text-white mb-2">Enable intelligence monitoring</h2>
                    <p className="text-slate-400">
                      Turn on the signals that matter most to your strategic priorities
                    </p>
                  </div>

                  <div className="bg-gradient-to-r from-indigo-900/30 to-purple-900/30 border border-indigo-500/30 rounded-xl p-4 mb-6">
                    <div className="flex items-center gap-3">
                      <Activity className="h-5 w-5 text-indigo-400" />
                      <span className="text-sm text-slate-300">
                        Based on your priorities, we recommend these signal categories. Toggle them on to enable 24/7 AI monitoring.
                      </span>
                    </div>
                  </div>

                  <div className="grid gap-4">
                    {SIGNAL_CATEGORIES.filter(cat => 
                      getRecommendedSignals().includes(cat.id) || state.enabledSignals.includes(cat.id)
                    ).slice(0, 8).map((category) => {
                      const isEnabled = state.enabledSignals.includes(category.id);
                      const isRecommended = getRecommendedSignals().includes(category.id);
                      
                      return (
                        <Card
                          key={category.id}
                          className={`transition-all ${
                            isEnabled 
                              ? 'bg-green-600/10 border-green-500/50' 
                              : 'bg-slate-800/50 border-slate-700'
                          }`}
                          data-testid={`signal-${category.id}`}
                        >
                          <CardContent className="p-4">
                            <div className="flex items-center justify-between">
                              <div className="flex items-center gap-4">
                                <div 
                                  className="w-10 h-10 rounded-lg flex items-center justify-center"
                                  style={{ backgroundColor: `${category.color}20` }}
                                >
                                  <Radio 
                                    className="h-5 w-5" 
                                    style={{ color: category.color }}
                                  />
                                </div>
                                <div>
                                  <div className="flex items-center gap-2">
                                    <h3 className="font-medium text-white">{category.name}</h3>
                                    {isRecommended && (
                                      <Badge variant="secondary" className="text-xs bg-indigo-500/20 text-indigo-300">
                                        Recommended
                                      </Badge>
                                    )}
                                  </div>
                                  <p className="text-sm text-slate-400">{category.description}</p>
                                  <p className="text-xs text-slate-500 mt-1">
                                    {category.dataPoints.length} data points monitored
                                  </p>
                                </div>
                              </div>
                              <Switch
                                checked={isEnabled}
                                onCheckedChange={(checked) => {
                                  if (checked) {
                                    updateState({ enabledSignals: [...state.enabledSignals, category.id] });
                                  } else {
                                    updateState({ enabledSignals: state.enabledSignals.filter(s => s !== category.id) });
                                  }
                                }}
                                data-testid={`switch-signal-${category.id}`}
                              />
                            </div>
                          </CardContent>
                        </Card>
                      );
                    })}
                  </div>

                  <div className="text-center text-sm text-slate-500">
                    {state.enabledSignals.length} of {SIGNAL_CATEGORIES.length} signal categories enabled
                  </div>
                </div>
              )}

              {state.step === 5 && (
                <div className="space-y-8">
                  <div className="text-center mb-8">
                    <h2 className="text-3xl font-bold text-white mb-2">Set your success targets</h2>
                    <p className="text-slate-400">
                      Define what success looks like for your organization
                    </p>
                  </div>

                  <div className="grid gap-6">
                    <Card className="bg-slate-800/50 border-slate-700">
                      <CardContent className="p-6">
                        <div className="flex items-start gap-4">
                          <div className="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center flex-shrink-0">
                            <Target className="h-6 w-6 text-indigo-400" />
                          </div>
                          <div className="flex-1">
                            <h3 className="font-semibold text-white mb-1">Future Readiness Index Target</h3>
                            <p className="text-sm text-slate-400 mb-4">
                              Your organization's strategic preparedness score across 5 dimensions
                            </p>
                            <div className="flex items-center gap-4">
                              <Input
                                type="number"
                                value={state.friTarget}
                                onChange={(e) => updateState({ friTarget: Number(e.target.value) })}
                                className="w-24 bg-slate-900 border-slate-600 text-white"
                                min={0}
                                max={100}
                                step={0.1}
                                data-testid="input-fri-target"
                              />
                              <span className="text-slate-400">%</span>
                              <Badge variant="secondary" className="bg-green-500/20 text-green-300">
                                Best-in-class: 84.4%
                              </Badge>
                            </div>
                          </div>
                        </div>
                      </CardContent>
                    </Card>

                    <Card className="bg-slate-800/50 border-slate-700">
                      <CardContent className="p-6">
                        <div className="flex items-start gap-4">
                          <div className="w-12 h-12 rounded-xl bg-green-500/20 flex items-center justify-center flex-shrink-0">
                            <Timer className="h-6 w-6 text-green-400" />
                          </div>
                          <div className="flex-1">
                            <h3 className="font-semibold text-white mb-1">Decision Velocity Target</h3>
                            <p className="text-sm text-slate-400 mb-4">
                              Target time from signal detection to coordinated response
                            </p>
                            <div className="flex items-center gap-4">
                              <Input
                                type="number"
                                value={state.velocityTarget}
                                onChange={(e) => updateState({ velocityTarget: Number(e.target.value) })}
                                className="w-24 bg-slate-900 border-slate-600 text-white"
                                min={1}
                                max={60}
                                data-testid="input-velocity-target"
                              />
                              <span className="text-slate-400">minutes</span>
                              <Badge variant="secondary" className="bg-green-500/20 text-green-300">
                                Industry avg: 72 hours
                              </Badge>
                            </div>
                          </div>
                        </div>
                      </CardContent>
                    </Card>

                    <Card className="bg-slate-800/50 border-slate-700">
                      <CardContent className="p-6">
                        <div className="flex items-start gap-4">
                          <div className="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center flex-shrink-0">
                            <Shield className="h-6 w-6 text-purple-400" />
                          </div>
                          <div className="flex-1">
                            <h3 className="font-semibold text-white mb-1">Playbook Coverage Target</h3>
                            <p className="text-sm text-slate-400 mb-4">
                              Percentage of critical scenarios with ready playbooks
                            </p>
                            <div className="flex items-center gap-4">
                              <Input
                                type="number"
                                value={state.coverageTarget}
                                onChange={(e) => updateState({ coverageTarget: Number(e.target.value) })}
                                className="w-24 bg-slate-900 border-slate-600 text-white"
                                min={50}
                                max={100}
                                data-testid="input-coverage-target"
                              />
                              <span className="text-slate-400">%</span>
                            </div>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  </div>
                </div>
              )}

              {state.step === 6 && (
                <div className="space-y-8">
                  <div className="text-center mb-6">
                    <h2 className="text-3xl font-bold text-white mb-2">Your Command Center is Ready</h2>
                    <p className="text-slate-400">
                      Here's what M will monitor and execute for {state.organizationName || 'your organization'}
                    </p>
                  </div>

                  {/* Live Configuration Summary */}
                  <div className="grid grid-cols-3 gap-4 mb-6">
                    <Card className="bg-gradient-to-br from-indigo-900/30 to-indigo-800/20 border-indigo-500/30">
                      <CardContent className="p-4 text-center">
                        <div className="text-3xl font-bold text-indigo-400 mb-1">{state.enabledSignals.length}</div>
                        <div className="text-sm text-slate-400">Signal Categories</div>
                        <div className="text-xs text-indigo-400 mt-1">Monitoring {state.enabledSignals.length * 6}+ data points</div>
                      </CardContent>
                    </Card>
                    <Card className="bg-gradient-to-br from-purple-900/30 to-purple-800/20 border-purple-500/30">
                      <CardContent className="p-4 text-center">
                        <div className="text-3xl font-bold text-purple-400 mb-1">{state.selectedPlaybooks.length}</div>
                        <div className="text-sm text-slate-400">Active Playbooks</div>
                        <div className="text-xs text-purple-400 mt-1">Ready for instant activation</div>
                      </CardContent>
                    </Card>
                    <Card className="bg-gradient-to-br from-green-900/30 to-green-800/20 border-green-500/30">
                      <CardContent className="p-4 text-center">
                        <div className="text-3xl font-bold text-green-400 mb-1">{state.velocityTarget}m</div>
                        <div className="text-sm text-slate-400">Target Response</div>
                        <div className="text-xs text-green-400 mt-1">vs 72hr industry average</div>
                      </CardContent>
                    </Card>
                  </div>

                  {/* Live Signal Monitoring Preview */}
                  <Card className="bg-slate-900 border-slate-700 overflow-hidden">
                    <CardHeader className="bg-gradient-to-r from-slate-800 to-slate-900 border-b border-slate-700 py-3">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse" />
                          <span className="font-semibold text-white text-sm">LIVE SIGNAL MONITORING</span>
                        </div>
                        <Badge variant="outline" className="text-green-400 border-green-500/50 text-xs">
                          <Activity className="w-3 h-3 mr-1" /> Active
                        </Badge>
                      </div>
                    </CardHeader>
                    <CardContent className="p-4">
                      <div className="space-y-3">
                        {state.enabledSignals.slice(0, 4).map((signalId, index) => {
                          const category = SIGNAL_CATEGORIES.find(c => c.id === signalId);
                          return (
                            <motion.div 
                              key={signalId}
                              initial={{ opacity: 0, x: -20 }}
                              animate={{ opacity: 1, x: 0 }}
                              transition={{ delay: index * 0.1 }}
                              className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700/50"
                            >
                              <div className="flex items-center gap-3">
                                <div className="w-8 h-8 rounded-lg bg-indigo-500/20 flex items-center justify-center">
                                  <Radio className="w-4 h-4 text-indigo-400" />
                                </div>
                                <div>
                                  <div className="text-sm font-medium text-white">{category?.name || signalId}</div>
                                  <div className="text-xs text-slate-500">{category?.dataPoints.length || 0} data points active</div>
                                </div>
                              </div>
                              <div className="flex items-center gap-2">
                                <div className="w-16 h-1.5 bg-slate-700 rounded-full overflow-hidden">
                                  <motion.div 
                                    className="h-full bg-green-500"
                                    initial={{ width: 0 }}
                                    animate={{ width: '100%' }}
                                    transition={{ duration: 2, delay: index * 0.2 }}
                                  />
                                </div>
                                <span className="text-xs text-green-400">Connected</span>
                              </div>
                            </motion.div>
                          );
                        })}
                        {state.enabledSignals.length > 4 && (
                          <div className="text-center text-xs text-slate-500 py-2">
                            + {state.enabledSignals.length - 4} more signal categories monitoring
                          </div>
                        )}
                      </div>
                    </CardContent>
                  </Card>

                  {/* Playbook Ready Status */}
                  <Card className="bg-slate-900 border-slate-700 overflow-hidden">
                    <CardHeader className="bg-gradient-to-r from-slate-800 to-slate-900 border-b border-slate-700 py-3">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <Layers className="w-4 h-4 text-purple-400" />
                          <span className="font-semibold text-white text-sm">PLAYBOOKS ARMED & READY</span>
                        </div>
                        <Badge className="bg-purple-500/20 text-purple-300 border-purple-500/50 text-xs">
                          {state.selectedPlaybooks.length} Active
                        </Badge>
                      </div>
                    </CardHeader>
                    <CardContent className="p-4">
                      <div className="grid gap-3">
                        {state.selectedPlaybooks.map((playbookId, index) => {
                          const playbook = getRecommendedPlaybooks().find(p => p.id === playbookId);
                          return (
                            <motion.div 
                              key={playbookId}
                              initial={{ opacity: 0, y: 10 }}
                              animate={{ opacity: 1, y: 0 }}
                              transition={{ delay: index * 0.1 }}
                              className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700/50"
                            >
                              <div className="flex items-center gap-3">
                                <div className="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center">
                                  <Shield className="w-4 h-4 text-purple-400" />
                                </div>
                                <div>
                                  <div className="text-sm font-medium text-white">{playbook?.name || playbookId}</div>
                                  <div className="text-xs text-slate-500">Triggers: {playbook?.triggers.join(', ')}</div>
                                </div>
                              </div>
                              <Badge className="bg-green-500/20 text-green-300 text-xs">Ready</Badge>
                            </motion.div>
                          );
                        })}
                      </div>
                    </CardContent>
                  </Card>

                  {/* ROI Projection */}
                  <Card className="bg-gradient-to-br from-green-900/20 to-emerald-900/20 border-green-500/30">
                    <CardContent className="p-6">
                      <div className="flex items-start gap-4">
                        <div className="w-12 h-12 rounded-xl bg-green-500/30 flex items-center justify-center flex-shrink-0">
                          <TrendingUp className="h-6 w-6 text-green-400" />
                        </div>
                        <div className="flex-1">
                          <h3 className="font-semibold text-white mb-2">Projected Annual Value</h3>
                          <p className="text-sm text-slate-400 mb-4">
                            Based on {INDUSTRIES.find(i => i.id === state.industry)?.name || 'your industry'} benchmarks and your configuration
                          </p>
                          <div className="grid grid-cols-3 gap-4">
                            <div className="text-center p-3 bg-slate-900/50 rounded-lg">
                              <div className="text-xl font-bold text-green-400">$2.4M</div>
                              <div className="text-xs text-slate-500">Risk Mitigation</div>
                            </div>
                            <div className="text-center p-3 bg-slate-900/50 rounded-lg">
                              <div className="text-xl font-bold text-green-400">847hrs</div>
                              <div className="text-xs text-slate-500">Executive Time Saved</div>
                            </div>
                            <div className="text-center p-3 bg-slate-900/50 rounded-lg">
                              <div className="text-xl font-bold text-green-400">12x</div>
                              <div className="text-xs text-slate-500">Faster Response</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  {/* What Happens Next */}
                  <div className="bg-slate-800/30 rounded-xl p-4 border border-slate-700/50">
                    <h4 className="font-semibold text-white mb-3 flex items-center gap-2">
                      <Sparkles className="w-4 h-4 text-indigo-400" />
                      What happens when you complete setup:
                    </h4>
                    <div className="grid grid-cols-2 gap-3">
                      <div className="flex items-center gap-2 text-sm text-slate-300">
                        <CheckCircle className="w-4 h-4 text-green-400" />
                        {state.enabledSignals.length} triggers go live immediately
                      </div>
                      <div className="flex items-center gap-2 text-sm text-slate-300">
                        <CheckCircle className="w-4 h-4 text-green-400" />
                        {state.selectedPlaybooks.length} playbooks ready for activation
                      </div>
                      <div className="flex items-center gap-2 text-sm text-slate-300">
                        <CheckCircle className="w-4 h-4 text-green-400" />
                        Real-time monitoring begins
                      </div>
                      <div className="flex items-center gap-2 text-sm text-slate-300">
                        <CheckCircle className="w-4 h-4 text-green-400" />
                        Dashboard reflects your configuration
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {state.step === 7 && (
                <div className="space-y-8">
                  {/* Success Hero */}
                  <div className="text-center">
                    <motion.div
                      initial={{ scale: 0 }}
                      animate={{ scale: 1 }}
                      transition={{ type: "spring", duration: 0.6 }}
                      className="w-24 h-24 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center mx-auto mb-6"
                    >
                      <CheckCircle className="h-12 w-12 text-white" />
                    </motion.div>
                    <motion.h2 
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.3 }}
                      className="text-3xl font-bold text-white mb-2"
                    >
                      M is Now Active
                    </motion.h2>
                    <motion.p 
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.4 }}
                      className="text-slate-400 text-lg"
                    >
                      Your strategic execution system is monitoring and ready
                    </motion.p>
                  </div>

                  {/* Activation Summary */}
                  <motion.div
                    initial={{ opacity: 0, y: 30 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.5 }}
                  >
                    <Card className="bg-gradient-to-br from-slate-800/80 to-slate-900/80 border-slate-700">
                      <CardHeader className="pb-2">
                        <CardTitle className="text-lg text-white flex items-center gap-2">
                          <Activity className="w-5 h-5 text-green-400" />
                          What's Now Active
                        </CardTitle>
                      </CardHeader>
                      <CardContent className="space-y-4">
                        <div className="grid grid-cols-3 gap-4">
                          <div className="bg-slate-900/50 rounded-xl p-4 border border-slate-700/50 text-center">
                            <div className="text-3xl font-bold text-green-400">{state.enabledSignals.length}</div>
                            <div className="text-sm text-slate-400">Signal Categories</div>
                            <div className="text-xs text-green-400/70 mt-1">Monitoring 24/7</div>
                          </div>
                          <div className="bg-slate-900/50 rounded-xl p-4 border border-slate-700/50 text-center">
                            <div className="text-3xl font-bold text-purple-400">{state.selectedPlaybooks.length}</div>
                            <div className="text-sm text-slate-400">Playbooks</div>
                            <div className="text-xs text-purple-400/70 mt-1">Armed & Ready</div>
                          </div>
                          <div className="bg-slate-900/50 rounded-xl p-4 border border-slate-700/50 text-center">
                            <div className="text-3xl font-bold text-blue-400">{state.friTarget}%</div>
                            <div className="text-sm text-slate-400">FRI Target</div>
                            <div className="text-xs text-blue-400/70 mt-1">Tracking Active</div>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  </motion.div>

                  {/* Your Configuration */}
                  <motion.div
                    initial={{ opacity: 0, y: 30 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.6 }}
                    className="grid gap-4"
                  >
                    <h3 className="font-semibold text-white flex items-center gap-2">
                      <Settings className="w-4 h-4 text-slate-400" />
                      Your Configuration
                    </h3>
                    
                    <div className="grid grid-cols-2 gap-4">
                      <div className="bg-slate-800/50 rounded-lg p-4 border border-slate-700/50">
                        <div className="text-xs text-slate-500 uppercase tracking-wider mb-1">Organization</div>
                        <div className="text-white font-medium">{state.organizationName}</div>
                        <div className="text-sm text-slate-400">{INDUSTRIES.find(i => i.id === state.industry)?.name}</div>
                      </div>
                      <div className="bg-slate-800/50 rounded-lg p-4 border border-slate-700/50">
                        <div className="text-xs text-slate-500 uppercase tracking-wider mb-1">Strategic Focus</div>
                        <div className="text-white font-medium">{state.priorities.length} Priorities</div>
                        <div className="text-sm text-slate-400 truncate">
                          {state.priorities.slice(0, 2).map(p => STRATEGIC_PRIORITIES.find(sp => sp.id === p)?.name).join(', ')}
                          {state.priorities.length > 2 && ` +${state.priorities.length - 2} more`}
                        </div>
                      </div>
                    </div>
                  </motion.div>

                  {/* Next Steps */}
                  <motion.div
                    initial={{ opacity: 0, y: 30 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.7 }}
                  >
                    <Card className="bg-gradient-to-br from-indigo-900/20 to-purple-900/20 border-indigo-500/30">
                      <CardContent className="p-6">
                        <h3 className="font-semibold text-white mb-4 flex items-center gap-2">
                          <Sparkles className="w-5 h-5 text-indigo-400" />
                          Your First Actions in the Platform
                        </h3>
                        <div className="space-y-3">
                          <div className="flex items-center gap-3 p-3 bg-slate-900/50 rounded-lg">
                            <div className="w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 font-bold">1</div>
                            <div>
                              <div className="text-white font-medium">Review Your Dashboard</div>
                              <div className="text-sm text-slate-400">See your Future Readiness Index and active monitoring status</div>
                            </div>
                          </div>
                          <div className="flex items-center gap-3 p-3 bg-slate-900/50 rounded-lg">
                            <div className="w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 font-bold">2</div>
                            <div>
                              <div className="text-white font-medium">Explore Your Playbooks</div>
                              <div className="text-sm text-slate-400">Customize response protocols for your specific organization</div>
                            </div>
                          </div>
                          <div className="flex items-center gap-3 p-3 bg-slate-900/50 rounded-lg">
                            <div className="w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 font-bold">3</div>
                            <div>
                              <div className="text-white font-medium">Visit Command Center</div>
                              <div className="text-sm text-slate-400">When a trigger fires, this is where 12-minute responses are orchestrated</div>
                            </div>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  </motion.div>

                  {/* System Status */}
                  <motion.div
                    initial={{ opacity: 0, y: 30 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.8 }}
                    className="flex items-center justify-center gap-3 py-4"
                  >
                    <div className="flex items-center gap-2 px-4 py-2 bg-green-500/10 rounded-full border border-green-500/30">
                      <div className="w-2 h-2 rounded-full bg-green-400 animate-pulse" />
                      <span className="text-sm text-green-400 font-medium">All Systems Operational</span>
                    </div>
                    <div className="flex items-center gap-2 px-4 py-2 bg-blue-500/10 rounded-full border border-blue-500/30">
                      <Radio className="w-3 h-3 text-blue-400" />
                      <span className="text-sm text-blue-400 font-medium">Intelligence Monitoring Active</span>
                    </div>
                  </motion.div>
                </div>
              )}
            </motion.div>
          </AnimatePresence>
        </div>
      </div>

      <div className="fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur-sm border-t border-slate-700/50 px-6 py-4">
        <div className="max-w-4xl mx-auto flex items-center justify-between">
          {state.step !== 7 ? (
            <Button
              variant="ghost"
              onClick={handleBack}
              disabled={state.step === 0}
              className="text-slate-400 hover:text-white"
              data-testid="button-back"
            >
              <ChevronLeft className="h-4 w-4 mr-2" />
              Back
            </Button>
          ) : (
            <div className="text-slate-500 text-sm">
              Setup complete - your system is now active
            </div>
          )}

          <div className="flex items-center gap-4">
            {state.step === 7 ? (
              <div className="flex items-center gap-3">
                <Button
                  size="lg"
                  variant="outline"
                  onClick={goToCommandCenter}
                  className="border-blue-500/50 text-blue-400 hover:bg-blue-500/10 min-w-[180px]"
                  data-testid="button-command-center"
                >
                  <Radio className="h-4 w-4 mr-2" />
                  Command Center
                </Button>
                <Button
                  size="lg"
                  onClick={handleNext}
                  className="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 min-w-[220px]"
                  data-testid="button-enter-platform"
                >
                  <Rocket className="h-4 w-4 mr-2" />
                  Enter Dashboard
                  <ArrowRight className="h-4 w-4 ml-2" />
                </Button>
              </div>
            ) : state.step === 6 ? (
              <Button
                size="lg"
                onClick={handleNext}
                disabled={!canProceed() || completeJourneyMutation.isPending}
                className="bg-green-600 hover:bg-green-700 min-w-[200px]"
                data-testid="button-complete"
              >
                {completeJourneyMutation.isPending ? (
                  <>
                    <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2" />
                    Activating M...
                  </>
                ) : (
                  <>
                    Activate M
                    <Zap className="h-4 w-4 ml-2" />
                  </>
                )}
              </Button>
            ) : (
              <Button
                size="lg"
                onClick={handleNext}
                disabled={!canProceed()}
                className="bg-indigo-600 hover:bg-indigo-700 min-w-[160px]"
                data-testid="button-next"
              >
                Continue
                <ChevronRight className="h-4 w-4 ml-2" />
              </Button>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/NFLLearningDashboard.tsx
========================================
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { 
  TrendingUp, 
  Lightbulb,
  Target,
  Award,
  AlertCircle,
  CheckCircle,
  Clock,
  Zap,
  Brain,
  BarChart3
} from 'lucide-react';
import PageLayout from '@/components/layout/PageLayout';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';

export default function NFLLearningDashboard() {
  const { toast } = useToast();

  // Fetch organizations
  const { data: organizationsData } = useQuery<any[]>({ 
    queryKey: ['/api/organizations'] 
  });
  const organizations = organizationsData ?? [];
  const organizationId = organizations[0]?.id;

  // Fetch AI suggestions
  const { data: aiSuggestionsData, isLoading: suggestionsLoading } = useQuery<any[]>({
    queryKey: ['/api/playbook-library/ai-suggestions', organizationId],
    enabled: !!organizationId,
  });
  const aiSuggestions = aiSuggestionsData ?? [];

  // Fetch playbook activations for learning
  const { data: activationsData } = useQuery<any[]>({
    queryKey: ['/api/playbook-library/activations', organizationId],
    enabled: !!organizationId,
  });
  const activations = activationsData ?? [];

  // Fetch drill performance data
  const { data: drillPerformancesData } = useQuery<any[]>({
    queryKey: [`/api/practice-drills/performance`, organizationId],
    enabled: !!organizationId,
  });
  const drillPerformances = drillPerformancesData ?? [];

  // Fetch playbook library for context
  const { data: libraryDataRaw } = useQuery<any>({
    queryKey: ['/api/playbook-library'],
  });
  const libraryData = libraryDataRaw ?? { playbooks: [] };

  // Update AI suggestion status mutation
  const updateSuggestionMutation = useMutation({
    mutationFn: async ({ suggestionId, status, reviewedBy }: any) => {
      return apiRequest('PATCH', `/api/playbook-library/ai-suggestions/${suggestionId}`, {
        status,
        reviewedBy,
      });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library/ai-suggestions'] });
      toast({
        title: 'Suggestion Updated',
        description: 'AI optimization suggestion has been processed',
      });
    },
  });

  const handleAcceptSuggestion = (suggestion: any) => {
    updateSuggestionMutation.mutate({
      suggestionId: suggestion.id,
      status: 'accepted',
      reviewedBy: organizationId, // In real app, would be user ID
    });
  };

  const handleRejectSuggestion = (suggestion: any) => {
    updateSuggestionMutation.mutate({
      suggestionId: suggestion.id,
      status: 'rejected',
      reviewedBy: organizationId,
    });
  };

  // Calculate insights
  const pendingSuggestions = aiSuggestions.filter((s: any) => s.suggestion?.status === 'pending');
  const acceptedSuggestions = aiSuggestions.filter((s: any) => s.suggestion?.status === 'accepted');
  
  const avgDrillTime = drillPerformances.length > 0
    ? Math.round(drillPerformances.reduce((sum, p) => sum + (p.timeToComplete || 0), 0) / drillPerformances.length)
    : 0;

  const avgSuccessRate = drillPerformances.length > 0
    ? Math.round(drillPerformances.reduce((sum, p) => sum + (p.successRate || 0), 0) / drillPerformances.length)
    : 0;

  const improvementRate = acceptedSuggestions.length > 0 
    ? Math.min(15, acceptedSuggestions.length * 3) 
    : 0;

  if (suggestionsLoading) {
    return (
      <PageLayout>
        <div className="p-6">
          <div className="animate-pulse">Loading learning dashboard...</div>
        </div>
      </PageLayout>
    );
  }

  return (
    <PageLayout>
      <div className="p-6 space-y-6" data-testid="nfl-learning-dashboard-page">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold" data-testid="page-title">
              Strategic Learning Center
            </h1>
            <p className="text-muted-foreground mt-1">
              Performance intelligence and continuous optimization
            </p>
          </div>
          <Brain className="h-12 w-12 text-[#0A1F44] dark:text-[#D4AF37]" />
        </div>

        {/* Key Metrics */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <Card>
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-2xl font-bold" data-testid="stat-pending-suggestions">
                    {pendingSuggestions.length}
                  </div>
                  <div className="text-xs text-muted-foreground mt-1">Pending Insights</div>
                </div>
                <Lightbulb className="h-8 w-8 text-yellow-600 dark:text-yellow-400" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-2xl font-bold" data-testid="stat-avg-time">
                    {avgDrillTime}m
                  </div>
                  <div className="text-xs text-muted-foreground mt-1">Avg. Response Time</div>
                </div>
                <Clock className="h-8 w-8 text-blue-600 dark:text-blue-400" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-2xl font-bold" data-testid="stat-success-rate">
                    {avgSuccessRate}%
                  </div>
                  <div className="text-xs text-muted-foreground mt-1">Success Rate</div>
                </div>
                <Target className="h-8 w-8 text-green-600 dark:text-green-400" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-2xl font-bold" data-testid="stat-improvement">
                    +{improvementRate}%
                  </div>
                  <div className="text-xs text-muted-foreground mt-1">Improvement Rate</div>
                </div>
                <TrendingUp className="h-8 w-8 text-purple-600 dark:text-purple-400" />
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Tabs for different views */}
        <Tabs defaultValue="suggestions" className="w-full">
          <TabsList>
            <TabsTrigger value="suggestions" data-testid="tab-suggestions">
              AI Suggestions ({pendingSuggestions.length})
            </TabsTrigger>
            <TabsTrigger value="performance" data-testid="tab-performance">
              Performance Trends
            </TabsTrigger>
            <TabsTrigger value="insights" data-testid="tab-insights">
              Cross-Playbook Insights
            </TabsTrigger>
            <TabsTrigger value="velocity" data-testid="tab-velocity">
              Execution Velocity
            </TabsTrigger>
          </TabsList>

          {/* AI Suggestions Tab */}
          <TabsContent value="suggestions" className="space-y-4 mt-6">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Lightbulb className="h-5 w-5" />
                  AI-Powered Optimization Suggestions
                </CardTitle>
                <CardDescription>
                  Machine learning insights from your drill performance and real activations
                </CardDescription>
              </CardHeader>
              <CardContent>
                {pendingSuggestions.length === 0 ? (
                  <div className="text-center py-12 text-muted-foreground">
                    <CheckCircle className="h-12 w-12 mx-auto mb-3 text-green-600" />
                    <p className="font-medium">All suggestions reviewed</p>
                    <p className="text-sm mt-1">You're up to date with AI recommendations</p>
                  </div>
                ) : (
                  <div className="space-y-4">
                    {pendingSuggestions.map((item: any) => {
                      const suggestion = item.suggestion;
                      const playbook = libraryData.playbooks.find((p: any) => p.id === suggestion.playbookId);
                      
                      const severityColors = {
                        high: 'bg-red-100 dark:bg-red-950 text-red-700 dark:text-red-300',
                        medium: 'bg-yellow-100 dark:bg-yellow-950 text-yellow-700 dark:text-yellow-300',
                        low: 'bg-blue-100 dark:bg-blue-950 text-blue-700 dark:text-blue-300',
                      };

                      return (
                        <Card 
                          key={suggestion.id} 
                          className="border-l-4 border-l-[#D4AF37]"
                          data-testid={`card-suggestion-${suggestion.id}`}
                        >
                          <CardHeader>
                            <div className="flex items-start justify-between">
                              <div className="flex-1 page-background">
                                <div className="flex items-center gap-2 mb-2">
                                  <Badge className={severityColors[suggestion.severity as keyof typeof severityColors] || ''}>
                                    {suggestion.severity} priority
                                  </Badge>
                                  <Badge variant="outline">
                                    {suggestion.suggestionType}
                                  </Badge>
                                </div>
                                <CardTitle className="text-lg" data-testid={`text-suggestion-title-${suggestion.id}`}>
                                  {suggestion.suggestionTitle}
                                </CardTitle>
                                {playbook && (
                                  <CardDescription className="mt-1">
                                    For playbook: {playbook.name}
                                  </CardDescription>
                                )}
                              </div>
                            </div>
                          </CardHeader>
                          <CardContent className="space-y-4">
                            <div>
                              <h4 className="font-medium text-sm mb-2">Recommendation</h4>
                              <p className="text-sm text-muted-foreground">
                                {suggestion.recommendation}
                              </p>
                            </div>

                            {suggestion.expectedImpact && (
                              <div>
                                <h4 className="font-medium text-sm mb-2">Expected Impact</h4>
                                <p className="text-sm text-muted-foreground">
                                  {suggestion.expectedImpact}
                                </p>
                              </div>
                            )}

                            {suggestion.implementationSteps && (
                              <div>
                                <h4 className="font-medium text-sm mb-2">Implementation Steps</h4>
                                <p className="text-sm text-muted-foreground whitespace-pre-line">
                                  {suggestion.implementationSteps}
                                </p>
                              </div>
                            )}

                            <div className="flex gap-2 pt-2 border-t">
                              <Button
                                size="sm"
                                onClick={() => handleAcceptSuggestion(suggestion)}
                                disabled={updateSuggestionMutation.isPending}
                                data-testid={`button-accept-${suggestion.id}`}
                              >
                                <CheckCircle className="h-4 w-4 mr-2" />
                                Accept & Implement
                              </Button>
                              <Button
                                size="sm"
                                variant="outline"
                                onClick={() => handleRejectSuggestion(suggestion)}
                                disabled={updateSuggestionMutation.isPending}
                                data-testid={`button-reject-${suggestion.id}`}
                              >
                                Dismiss
                              </Button>
                            </div>

                            <div className="text-xs text-muted-foreground">
                              Generated: {new Date(suggestion.generatedAt).toLocaleString()}
                            </div>
                          </CardContent>
                        </Card>
                      );
                    })}
                  </div>
                )}
              </CardContent>
            </Card>
          </TabsContent>

          {/* Performance Trends Tab */}
          <TabsContent value="performance" className="space-y-4 mt-6">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <BarChart3 className="h-5 w-5" />
                  Drill Performance Trends
                </CardTitle>
                <CardDescription>Track your team's execution improvement over time</CardDescription>
              </CardHeader>
              <CardContent>
                {drillPerformances.length === 0 ? (
                  <div className="text-center py-12 text-muted-foreground">
                    <BarChart3 className="h-12 w-12 mx-auto mb-3 opacity-50" />
                    <p className="font-medium">No performance data yet</p>
                    <p className="text-sm mt-1">Complete practice drills to see trends</p>
                  </div>
                ) : (
                  <div className="space-y-6">
                    <div className="grid grid-cols-3 gap-6">
                      <div className="space-y-2">
                        <h4 className="font-medium text-sm">Response Time Trend</h4>
                        <div className="text-3xl font-bold" data-testid="text-response-trend">
                          {avgDrillTime}m
                        </div>
                        <div className="flex items-center gap-1 text-sm text-green-600 dark:text-green-400">
                          <TrendingUp className="h-4 w-4" />
                          <span>Improving</span>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <h4 className="font-medium text-sm">Success Rate Trend</h4>
                        <div className="text-3xl font-bold" data-testid="text-success-trend">
                          {avgSuccessRate}%
                        </div>
                        <div className="flex items-center gap-1 text-sm text-green-600 dark:text-green-400">
                          <TrendingUp className="h-4 w-4" />
                          <span>Improving</span>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <h4 className="font-medium text-sm">Total Drills</h4>
                        <div className="text-3xl font-bold" data-testid="text-total-drills">
                          {drillPerformances.length}
                        </div>
                        <div className="text-sm text-muted-foreground">Completed</div>
                      </div>
                    </div>

                    <div className="pt-4 border-t">
                      <h4 className="font-medium mb-3">Recent Performance History</h4>
                      <div className="space-y-2">
                        {drillPerformances.slice(0, 5).map((perf: any, index: number) => (
                          <div key={index} className="flex items-center justify-between p-3 bg-muted/50 rounded-lg">
                            <div className="flex items-center gap-3">
                              <Award className="h-5 w-5 text-[#D4AF37]" />
                              <div>
                                <div className="font-medium text-sm">Drill #{drillPerformances.length - index}</div>
                                <div className="text-xs text-muted-foreground">
                                  {new Date(perf.completedAt || Date.now()).toLocaleDateString()}
                                </div>
                              </div>
                            </div>
                            <div className="flex items-center gap-6 text-sm">
                              <div>
                                <span className="text-muted-foreground">Time:</span>
                                <span className="font-medium ml-2">{perf.timeToComplete}m</span>
                              </div>
                              <div>
                                <span className="text-muted-foreground">Success:</span>
                                <span className="font-medium ml-2">{perf.successRate}%</span>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                )}
              </CardContent>
            </Card>
          </TabsContent>

          {/* Cross-Playbook Insights Tab */}
          <TabsContent value="insights" className="space-y-4 mt-6">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Brain className="h-5 w-5" />
                  Cross-Playbook Learning Patterns
                </CardTitle>
                <CardDescription>Insights derived from multiple scenarios</CardDescription>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  {activations.length > 0 && (
                    <div className="p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg">
                      <div className="flex items-start gap-3">
                        <Zap className="h-5 w-5 text-blue-600 mt-0.5" />
                        <div>
                          <h4 className="font-medium text-blue-700 dark:text-blue-300">
                            Real Activation Insight
                          </h4>
                          <p className="text-sm text-blue-600 dark:text-blue-400 mt-1">
                            You've had {activations.length} real playbook activation{activations.length !== 1 ? 's' : ''}. 
                            Teams that practice monthly respond 3x faster to real crises.
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {drillPerformances.length >= 3 && (
                    <div className="p-4 bg-green-50 dark:bg-green-950/20 rounded-lg">
                      <div className="flex items-start gap-3">
                        <TrendingUp className="h-5 w-5 text-green-600 mt-0.5" />
                        <div>
                          <h4 className="font-medium text-green-700 dark:text-green-300">
                            Practice Momentum
                          </h4>
                          <p className="text-sm text-green-600 dark:text-green-400 mt-1">
                            Your team has completed {drillPerformances.length} drills. 
                            Organizations with 10+ drills show 40% better crisis outcomes.
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {acceptedSuggestions.length > 0 && (
                    <div className="p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg">
                      <div className="flex items-start gap-3">
                        <Lightbulb className="h-5 w-5 text-purple-600 mt-0.5" />
                        <div>
                          <h4 className="font-medium text-purple-700 dark:text-purple-300">
                            AI-Driven Improvement
                          </h4>
                          <p className="text-sm text-purple-600 dark:text-purple-400 mt-1">
                            You've implemented {acceptedSuggestions.length} AI suggestion{acceptedSuggestions.length !== 1 ? 's' : ''}. 
                            This typically leads to {improvementRate}% faster response times.
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {drillPerformances.length === 0 && activations.length === 0 && (
                    <div className="text-center py-12 text-muted-foreground">
                      <Brain className="h-12 w-12 mx-auto mb-3 opacity-50" />
                      <p className="font-medium">No cross-playbook insights yet</p>
                      <p className="text-sm mt-1">Complete drills and activations to unlock patterns</p>
                    </div>
                  )}
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Execution Velocity Tab */}
          <TabsContent value="velocity" className="space-y-4 mt-6">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Zap className="h-5 w-5" />
                  Execution Velocity Dashboard
                </CardTitle>
                <CardDescription>How fast can your team execute when it matters?</CardDescription>
              </CardHeader>
              <CardContent>
                <div className="space-y-6">
                  <div className="grid grid-cols-2 gap-6">
                    <div className="p-6 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/20 dark:to-blue-900/20 rounded-lg">
                      <div className="text-sm font-medium text-blue-700 dark:text-blue-300 mb-2">
                        Decision Velocity Score
                      </div>
                      <div className="text-4xl font-bold text-blue-900 dark:text-blue-100" data-testid="text-velocity-score">
                        {Math.max(65, avgSuccessRate)}
                      </div>
                      <div className="text-xs text-blue-600 dark:text-blue-400 mt-2">
                        out of 100
                      </div>
                    </div>

                    <div className="p-6 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950/20 dark:to-green-900/20 rounded-lg">
                      <div className="text-sm font-medium text-green-700 dark:text-green-300 mb-2">
                        Target: 12-Minute Response
                      </div>
                      <div className="text-4xl font-bold text-green-900 dark:text-green-100" data-testid="text-target-vs-actual">
                        {avgDrillTime || 'N/A'}m
                      </div>
                      <div className="text-xs text-green-600 dark:text-green-400 mt-2">
                        {avgDrillTime && avgDrillTime <= 12 ? 'Meeting NFL Standard' : 'Room for improvement'}
                      </div>
                    </div>
                  </div>

                  <div className="pt-4 border-t">
                    <h4 className="font-medium mb-3">Velocity Factors</h4>
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-2">
                          <CheckCircle className="h-4 w-4 text-green-600" />
                          <span className="text-sm">Practice Frequency</span>
                        </div>
                        <Badge variant="outline">
                          {drillPerformances.length >= 5 ? 'Excellent' : 'Needs Work'}
                        </Badge>
                      </div>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-2">
                          <CheckCircle className="h-4 w-4 text-green-600" />
                          <span className="text-sm">AI Optimization</span>
                        </div>
                        <Badge variant="outline">
                          {acceptedSuggestions.length > 0 ? 'Active' : 'Inactive'}
                        </Badge>
                      </div>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-2">
                          {avgSuccessRate >= 80 ? (
                            <CheckCircle className="h-4 w-4 text-green-600" />
                          ) : (
                            <AlertCircle className="h-4 w-4 text-yellow-600" />
                          )}
                          <span className="text-sm">Execution Quality</span>
                        </div>
                        <Badge variant="outline">
                          {avgSuccessRate >= 80 ? 'High' : 'Medium'}
                        </Badge>
                      </div>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/not-found.tsx
========================================
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { AlertCircle, ArrowLeft, Home } from "lucide-react";
import { useLocation } from "wouter";
import StandardNav from "@/components/layout/StandardNav";

export default function NotFound() {
  const [, setLocation] = useLocation();

  return (
    <div className="flex flex-col min-h-screen">
      <StandardNav variant="default" />
      <div className="page-background flex-1 w-full flex items-center justify-center bg-gray-50 dark:bg-slate-950">
        <Card className="w-full max-w-md mx-4 dark:bg-slate-900 dark:border-slate-800">
          <CardContent className="pt-6">
            <div className="flex mb-4 gap-2">
              <AlertCircle className="h-8 w-8 text-red-500" />
              <h1 className="text-2xl font-bold text-gray-900 dark:text-white">404 Page Not Found</h1>
            </div>

            <p className="mt-4 text-sm text-gray-600 dark:text-gray-400 mb-6">
              The page you're looking for doesn't exist. Let's get you back on track.
            </p>

            <div className="flex gap-3">
              <Button
                onClick={() => setLocation('/')}
                className="flex-1 bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 hover:bg-slate-800 dark:hover:bg-slate-200"
              >
                <Home className="mr-2 h-4 w-4" />
                Go Home
              </Button>
              <Button
                onClick={() => window.history.back()}
                variant="outline"
                className="flex-1 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800"
              >
                <ArrowLeft className="mr-2 h-4 w-4" />
                Go Back
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/NovaInnovations.tsx
========================================
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Link } from 'wouter';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';
import { 
  Brain, 
  Rocket, 
  Lightbulb,
  TrendingUp,
  Target,
  DollarSign,
  Users,
  Clock,
  Star,
  Zap,
  Layers,
  BarChart3,
  PlusCircle,
  Eye,
  ArrowLeft,
  Home
} from 'lucide-react';

export default function NovaInnovations() {
  const [selectedPipeline, setSelectedPipeline] = useState('discovery');

  const innovationProjects = [
    {
      id: 'ai-automation',
      name: 'AI-Powered Process Automation',
      stage: 'development',
      priority: 'high',
      potential: 95,
      investment: 2.4,
      timeline: '6-9 months',
      description: 'Revolutionary AI system to automate complex business processes',
      impact: {
        efficiency: 85,
        cost: 78,
        revenue: 92,
        risk: 34
      },
      team: ['AI/ML Team', 'Process Engineering', 'QA'],
      milestones: [
        { name: 'Proof of Concept', status: 'completed', date: '2024-Q4' },
        { name: 'MVP Development', status: 'in-progress', date: '2025-Q1' },
        { name: 'Pilot Testing', status: 'planned', date: '2025-Q2' },
        { name: 'Full Deployment', status: 'planned', date: '2025-Q3' }
      ],
      icon: <Brain className="h-5 w-5" />,
      color: 'blue'
    },
    {
      id: 'quantum-security',
      name: 'Quantum-Resistant Security Protocol',
      stage: 'research',
      priority: 'critical',
      potential: 89,
      investment: 3.8,
      timeline: '12-18 months',
      description: 'Next-generation security framework resistant to quantum computing threats',
      impact: {
        efficiency: 67,
        cost: 45,
        revenue: 73,
        risk: 12
      },
      team: ['Security Research', 'Cryptography', 'Platform'],
      milestones: [
        { name: 'Research Phase', status: 'in-progress', date: '2025-Q1' },
        { name: 'Algorithm Development', status: 'planned', date: '2025-Q2' },
        { name: 'Security Testing', status: 'planned', date: '2025-Q3' },
        { name: 'Implementation', status: 'planned', date: '2025-Q4' }
      ],
      icon: <Zap className="h-5 w-5" />,
      color: 'purple'
    },
    {
      id: 'sustainable-tech',
      name: 'Carbon-Neutral Computing Infrastructure',
      stage: 'ideation',
      priority: 'medium',
      potential: 76,
      investment: 1.9,
      timeline: '9-12 months',
      description: 'Innovative green computing solutions with zero carbon footprint',
      impact: {
        efficiency: 71,
        cost: 82,
        revenue: 65,
        risk: 28
      },
      team: ['Sustainability', 'Infrastructure', 'R&D'],
      milestones: [
        { name: 'Feasibility Study', status: 'in-progress', date: '2025-Q1' },
        { name: 'Prototype Development', status: 'planned', date: '2025-Q2' },
        { name: 'Pilot Implementation', status: 'planned', date: '2025-Q3' },
        { name: 'Scale-up', status: 'planned', date: '2025-Q4' }
      ],
      icon: <Layers className="h-5 w-5" />,
      color: 'emerald'
    },
    {
      id: 'market-intelligence',
      name: 'Predictive Market Intelligence Platform',
      stage: 'discovery',
      priority: 'high',
      potential: 93,
      investment: 2.1,
      timeline: '8-10 months',
      description: 'AI-driven market analysis and prediction system for strategic advantage',
      impact: {
        efficiency: 88,
        cost: 61,
        revenue: 96,
        risk: 22
      },
      team: ['Data Science', 'Business Intelligence', 'Strategy'],
      milestones: [
        { name: 'Market Research', status: 'completed', date: '2024-Q4' },
        { name: 'Data Architecture', status: 'planned', date: '2025-Q1' },
        { name: 'AI Model Training', status: 'planned', date: '2025-Q2' },
        { name: 'Platform Launch', status: 'planned', date: '2025-Q3' }
      ],
      icon: <Target className="h-5 w-5" />,
      color: 'orange'
    }
  ];

  const getColorClasses = (color: string) => {
    const colors = {
      blue: 'text-blue-400 bg-blue-500/10 border-blue-500/30',
      purple: 'text-purple-400 bg-purple-500/10 border-purple-500/30',
      emerald: 'text-emerald-400 bg-emerald-500/10 border-emerald-500/30',
      orange: 'text-orange-400 bg-orange-500/10 border-orange-500/30'
    };
    return colors[color as keyof typeof colors] || colors.blue;
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'critical': return 'bg-red-500/20 text-red-400 border-red-500/30';
      case 'high': return 'bg-orange-500/20 text-orange-400 border-orange-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30';
      case 'low': return 'bg-green-500/20 text-green-400 border-green-500/30';
      default: return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
    }
  };

  const getStageColor = (stage: string) => {
    switch (stage) {
      case 'development': return 'bg-blue-500/20 text-blue-400 border-blue-500/30';
      case 'research': return 'bg-purple-500/20 text-purple-400 border-purple-500/30';
      case 'ideation': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30';
      case 'discovery': return 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30';
      default: return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
    }
  };

  const filteredProjects = innovationProjects.filter(project =>
    selectedPipeline === 'all' || project.stage === selectedPipeline
  );

  return (
    <>
      <div className="page-background min-h-screen bg-transparent p-6" data-testid="nova-innovations">
        <div className="max-w-7xl mx-auto space-y-8">
          
          {/* Breadcrumb Navigation */}
          <div className="mb-6">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>AI Intelligence</span>
              <span>/</span>
              <span className="text-white">Nova Innovations</span>
            </div>
          </div>

          {/* ROI Value Context - Tier 2 Enhancement */}
          <Card className="mb-4 bg-indigo-50 dark:bg-indigo-950/20 border-indigo-300 dark:border-indigo-700" data-testid="nova-roi-context">
            <CardContent className="p-3 flex items-center gap-3">
              <div className="p-2 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg">
                <Brain className="h-5 w-5 text-indigo-600" />
              </div>
              <div>
                <div className="font-semibold text-indigo-900 dark:text-indigo-100 text-sm">How Nova Saves You Money</div>
                <div className="text-xs text-indigo-700 dark:text-indigo-300">Identifies breakthrough opportunities 6 months ahead of competitors, capturing $3.2M+ in first-mover advantage</div>
              </div>
            </CardContent>
          </Card>

          {/* Header */}
          <div className="bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6 rounded-lg">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <Brain className="h-10 w-10" />
                <div>
                  <h1 className="text-3xl font-bold" data-testid="nova-title">
                    Nova Innovations
                  </h1>
                  <p className="text-purple-100">Innovation pipeline management and breakthrough opportunity identification</p>
                </div>
              </div>
              <div className="flex items-center gap-4">
                <OnboardingTrigger pageId="nova-innovations" autoStart={true} className="bg-white/10 border-white/30 text-white hover:bg-white/20" />
                <Link to="/">
                  <Button variant="secondary" className="bg-purple-700 hover:bg-purple-800 text-purple-100 border-purple-600" data-testid="back-to-dashboard">
                    <ArrowLeft className="h-4 w-4 mr-2" />
                    Dashboard
                  </Button>
                </Link>
                <Badge variant="secondary" className="bg-purple-700 text-purple-100 border-purple-600" data-testid="ai-discovery-badge">
                  <Rocket className="h-4 w-4 mr-2" />
                  AI DISCOVERY
                </Badge>
                <Button variant="secondary" className="bg-indigo-600 hover:bg-indigo-700 text-white" data-testid="new-innovation-button">
                  <PlusCircle className="h-4 w-4 mr-2" />
                  New Innovation
                </Button>
              </div>
            </div>
          </div>

          {/* Innovation Metrics */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
            <Card className="border-blue-500/30 bg-blue-950/30 backdrop-blur-sm">
              <CardContent className="p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-blue-300 text-sm font-medium">Active Projects</p>
                    <p className="text-2xl font-bold text-white">{innovationProjects.length}</p>
                  </div>
                  <Rocket className="h-8 w-8 text-blue-400" />
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-emerald-500/30 bg-emerald-950/30 backdrop-blur-sm">
              <CardContent className="p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-emerald-300 text-sm font-medium">Total Investment</p>
                    <p className="text-2xl font-bold text-white">$10.2M</p>
                  </div>
                  <DollarSign className="h-8 w-8 text-emerald-400" />
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-purple-500/30 bg-purple-950/30 backdrop-blur-sm">
              <CardContent className="p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-purple-300 text-sm font-medium">Avg Potential</p>
                    <p className="text-2xl font-bold text-white">88.3%</p>
                  </div>
                  <Star className="h-8 w-8 text-purple-400" />
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-orange-500/30 bg-orange-950/30 backdrop-blur-sm">
              <CardContent className="p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-orange-300 text-sm font-medium">Expected ROI</p>
                    <p className="text-2xl font-bold text-white">340%</p>
                  </div>
                  <TrendingUp className="h-8 w-8 text-orange-400" />
                </div>
              </CardContent>
            </Card>
          </div>

          <Tabs value={selectedPipeline} onValueChange={setSelectedPipeline} className="w-full">
            <TabsList className="grid w-full grid-cols-5">
              <TabsTrigger value="discovery" data-testid="tab-discovery">Discovery</TabsTrigger>
              <TabsTrigger value="ideation" data-testid="tab-ideation">Ideation</TabsTrigger>
              <TabsTrigger value="research" data-testid="tab-research">Research</TabsTrigger>
              <TabsTrigger value="development" data-testid="tab-development">Development</TabsTrigger>
              <TabsTrigger value="all" data-testid="tab-all">All Projects</TabsTrigger>
            </TabsList>

            <TabsContent value={selectedPipeline} className="space-y-6">
              {/* Innovation Projects Grid */}
              <div className="space-y-6">
                {filteredProjects.map((project) => (
                  <Card key={project.id} className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm hover:border-purple-500/30 transition-colors" data-testid={project.id === 'ai-automation' ? 'innovation-project-ai' : `project-${project.id}`}>
                    <CardHeader>
                      <div className="flex items-start justify-between">
                        <div className="flex items-center gap-3">
                          <div className={`p-3 rounded-lg ${getColorClasses(project.color)}`}>
                            {project.icon}
                          </div>
                          <div>
                            <h3 className="text-xl font-semibold text-white">{project.name}</h3>
                            <p className="text-gray-400">{project.description}</p>
                            <div className="flex items-center gap-2 mt-2">
                              <span className="text-sm text-gray-400">Timeline: {project.timeline}</span>
                              <span className="text-gray-600"></span>
                              <span className="text-sm text-gray-400">Investment: ${project.investment}M</span>
                            </div>
                          </div>
                        </div>
                        <div className="flex flex-col gap-2">
                          <Badge variant="outline" className={getPriorityColor(project.priority)}>
                            {project.priority.toUpperCase()}
                          </Badge>
                          <Badge variant="outline" className={getStageColor(project.stage)}>
                            {project.stage.toUpperCase()}
                          </Badge>
                          <div className="text-right">
                            <div className="text-sm text-gray-400">Potential</div>
                            <div className="text-lg font-bold text-white">{project.potential}%</div>
                          </div>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent className="space-y-6">
                      {/* Impact Metrics */}
                      <div className="grid grid-cols-4 gap-4">
                        <div>
                          <div className="flex items-center justify-between text-sm mb-1">
                            <span className="text-gray-400">Efficiency</span>
                            <span className="text-blue-400 font-medium">{project.impact.efficiency}%</span>
                          </div>
                          <Progress value={project.impact.efficiency} className="h-2" />
                        </div>
                        <div>
                          <div className="flex items-center justify-between text-sm mb-1">
                            <span className="text-gray-400">Cost Impact</span>
                            <span className="text-emerald-400 font-medium">{project.impact.cost}%</span>
                          </div>
                          <Progress value={project.impact.cost} className="h-2" />
                        </div>
                        <div>
                          <div className="flex items-center justify-between text-sm mb-1">
                            <span className="text-gray-400">Revenue</span>
                            <span className="text-purple-400 font-medium">{project.impact.revenue}%</span>
                          </div>
                          <Progress value={project.impact.revenue} className="h-2" />
                        </div>
                        <div>
                          <div className="flex items-center justify-between text-sm mb-1">
                            <span className="text-gray-400">Risk</span>
                            <span className="text-orange-400 font-medium">{project.impact.risk}%</span>
                          </div>
                          <Progress value={project.impact.risk} className="h-2" />
                        </div>
                      </div>

                      {/* Team and Milestones */}
                      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                          <h4 className="font-semibold text-white mb-3 flex items-center gap-2">
                            <Users className="h-4 w-4 text-blue-400" />
                            Project Team
                          </h4>
                          <div className="flex flex-wrap gap-2">
                            {project.team.map((member, index) => (
                              <Badge key={index} variant="outline" className="bg-gray-800/50 text-gray-300 border-gray-600">
                                {member}
                              </Badge>
                            ))}
                          </div>
                        </div>
                        
                        <div>
                          <h4 className="font-semibold text-white mb-3 flex items-center gap-2">
                            <Clock className="h-4 w-4 text-purple-400" />
                            Key Milestones
                          </h4>
                          <div className="space-y-2">
                            {project.milestones.slice(0, 2).map((milestone, index) => (
                              <div key={index} className="flex items-center justify-between text-sm">
                                <span className="text-gray-300">{milestone.name}</span>
                                <div className="flex items-center gap-2">
                                  <span className="text-gray-400">{milestone.date}</span>
                                  <Badge 
                                    variant="outline" 
                                    className={
                                      milestone.status === 'completed' ? 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30' :
                                      milestone.status === 'in-progress' ? 'bg-blue-500/20 text-blue-400 border-blue-500/30' :
                                      'bg-gray-500/20 text-gray-400 border-gray-500/30'
                                    }
                                  >
                                    {milestone.status}
                                  </Badge>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      </div>

                      <div className="flex gap-3 pt-4 border-t border-gray-700/50">
                        <Button size="sm" variant="outline" className="flex-1">
                          <Eye className="h-4 w-4 mr-2" />
                          View Details
                        </Button>
                        <Button size="sm" variant="outline" className="flex-1">
                          <BarChart3 className="h-4 w-4 mr-2" />
                          Analytics
                        </Button>
                        <Button size="sm" className="flex-1 bg-purple-600 hover:bg-purple-700">
                          <Rocket className="h-4 w-4 mr-2" />
                          Accelerate
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>

              {/* AI Recommendations */}
              <Card className="border-indigo-500/30 bg-indigo-950/30 backdrop-blur-sm">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-indigo-300">
                    <Brain className="h-5 w-5" />
                    AI Innovation Recommendations
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="p-4 bg-purple-950/30 rounded-lg border border-purple-500/30">
                      <p className="text-purple-300 font-medium mb-2">Priority Alignment</p>
                      <p className="text-purple-200 text-sm">Focus on AI-Powered Process Automation and Predictive Market Intelligence for maximum ROI in Q1-Q2.</p>
                    </div>
                    <div className="p-4 bg-blue-950/30 rounded-lg border border-blue-500/30">
                      <p className="text-blue-300 font-medium mb-2">Resource Optimization</p>
                      <p className="text-blue-200 text-sm">Cross-project synergies identified: AI/ML expertise can accelerate both automation and market intelligence initiatives.</p>
                    </div>
                    <div className="p-4 bg-emerald-950/30 rounded-lg border border-emerald-500/30">
                      <p className="text-emerald-300 font-medium mb-2">Breakthrough Opportunity</p>
                      <p className="text-emerald-200 text-sm">Quantum-Resistant Security shows potential for industry disruption - consider fast-track development with additional resources.</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>
          </Tabs>
        </div>
      </div>
    </>
  );
}

========================================
FILE: client/src/pages/OnboardingWizard.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Switch } from '@/components/ui/switch';
import { useToast } from '@/hooks/use-toast';
import { useQuery, useMutation } from '@tanstack/react-query';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useLocation } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import { 
  Building2,
  Users,
  Target,
  BarChart3,
  CheckCircle,
  ChevronRight,
  ChevronLeft,
  Sparkles,
  Zap,
  Shield,
  Clock,
  Bell,
  Layers,
  ArrowRight,
  Rocket,
  Settings,
  AlertTriangle
} from 'lucide-react';

const ONBOARDING_STEPS = [
  {
    id: 'organization',
    title: 'Organization Setup',
    description: 'Define your organizational structure',
    icon: Building2,
    color: 'text-blue-500',
    bgColor: 'bg-blue-500/10',
    borderColor: 'border-blue-500/30',
  },
  {
    id: 'triggers',
    title: 'Trigger Configuration',
    description: 'Set up intelligence monitoring thresholds',
    icon: Target,
    color: 'text-amber-500',
    bgColor: 'bg-amber-500/10',
    borderColor: 'border-amber-500/30',
  },
  {
    id: 'playbooks',
    title: 'Playbook Customization',
    description: 'Customize strategic response playbooks',
    icon: Layers,
    color: 'text-green-500',
    bgColor: 'bg-green-500/10',
    borderColor: 'border-green-500/30',
  },
  {
    id: 'metrics',
    title: 'Success Metrics',
    description: 'Define your KPIs and targets',
    icon: BarChart3,
    color: 'text-purple-500',
    bgColor: 'bg-purple-500/10',
    borderColor: 'border-purple-500/30',
  },
];

export default function OnboardingWizard() {
  const { toast } = useToast();
  const [, setLocation] = useLocation();
  const [currentStep, setCurrentStep] = useState(0);
  const [completedSteps, setCompletedSteps] = useState<Set<number>>(new Set());
  
  // Organization data
  const [orgData, setOrgData] = useState({
    companyName: '',
    industry: '',
    employeeCount: '',
    departments: ['Executive', 'Operations', 'Finance', 'Legal', 'Communications'],
    primaryContact: '',
    primaryEmail: '',
  });
  
  // Trigger data
  const [triggerData, setTriggerData] = useState({
    revenueThreshold: 5,
    marketShareThreshold: 3,
    sentimentThreshold: -15,
    competitorAlertEnabled: true,
    regulatoryAlertEnabled: true,
    mediaAlertEnabled: true,
  });
  
  // Playbook data
  const [playbookData, setPlaybookData] = useState({
    selectedPlaybooks: ['Crisis Response', 'Market Opportunity', 'Competitive Response'],
    responseTimeTarget: 12,
    autoEscalationEnabled: true,
    defaultBudgetThreshold: 100000,
  });
  
  // Metrics data
  const [metricsData, setMetricsData] = useState({
    friTarget: 84.4,
    velocityTarget: 12,
    coverageTarget: 95,
    reviewCadence: 'weekly',
  });

  // Fetch existing progress
  const { data: existingProgress } = useQuery({
    queryKey: ['/api/config/setup-progress', 'default'],
  });

  // Save progress mutation
  const saveProgressMutation = useMutation({
    mutationFn: async (data: { step: string; completed: boolean; data: any }) => {
      return apiRequest('PATCH', '/api/config/setup-progress/default', {
        currentStep: currentStep,
        completedSteps: Array.from(completedSteps),
        orgData,
        triggerData,
        playbookData,
        metricsData,
      });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/config/setup-progress'] });
    },
  });

  // Complete onboarding mutation
  const completeOnboardingMutation = useMutation({
    mutationFn: async () => {
      // Save all configuration data
      const promises = [
        // Save departments
        ...orgData.departments.map(dept => 
          apiRequest('POST', '/api/config/departments', { name: dept, description: `${dept} department` }).catch(() => {})
        ),
        // Save success metrics
        apiRequest('POST', '/api/config/success-metrics', {
          name: 'Future Readiness Index',
          metricType: 'fri',
          targetValue: metricsData.friTarget,
          currentValue: 72.3,
          baselineValue: 58.1,
          unit: '%',
          reviewCadence: metricsData.reviewCadence,
        }).catch(() => {}),
        apiRequest('POST', '/api/config/success-metrics', {
          name: 'Decision Velocity',
          metricType: 'velocity',
          targetValue: metricsData.velocityTarget,
          currentValue: 18,
          baselineValue: 45,
          unit: 'minutes',
          reviewCadence: 'daily',
        }).catch(() => {}),
      ];
      
      await Promise.all(promises);
      return { success: true };
    },
    onSuccess: () => {
      toast({
        title: 'Onboarding Complete!',
        description: 'Your M platform is now configured and ready to use.',
      });
      setLocation('/dashboard');
    },
    onError: () => {
      toast({
        title: 'Setup Complete',
        description: 'Your configuration has been saved. Welcome to M!',
      });
      setLocation('/dashboard');
    },
  });

  const handleNext = () => {
    // Mark current step as completed
    const newCompleted = new Set(completedSteps);
    newCompleted.add(currentStep);
    setCompletedSteps(newCompleted);
    
    // Save progress
    saveProgressMutation.mutate({
      step: ONBOARDING_STEPS[currentStep].id,
      completed: true,
      data: currentStep === 0 ? orgData : currentStep === 1 ? triggerData : currentStep === 2 ? playbookData : metricsData,
    });
    
    if (currentStep < ONBOARDING_STEPS.length - 1) {
      setCurrentStep(currentStep + 1);
    } else {
      // Complete onboarding
      completeOnboardingMutation.mutate();
    }
  };

  const handleBack = () => {
    if (currentStep > 0) {
      setCurrentStep(currentStep - 1);
    }
  };

  const progress = ((currentStep + 1) / ONBOARDING_STEPS.length) * 100;
  const currentStepInfo = ONBOARDING_STEPS[currentStep];
  const StepIcon = currentStepInfo.icon;

  return (
    <PageLayout>
      <div className="max-w-4xl mx-auto space-y-8 py-8">
        {/* Progress Header */}
        <Card className="bg-slate-900 border-slate-700">
          <CardContent className="pt-6">
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-3">
                <div className={`w-12 h-12 rounded-xl ${currentStepInfo.bgColor} flex items-center justify-center`}>
                  <StepIcon className={`h-6 w-6 ${currentStepInfo.color}`} />
                </div>
                <div>
                  <h2 className="text-xl font-bold text-white">{currentStepInfo.title}</h2>
                  <p className="text-sm text-slate-400">{currentStepInfo.description}</p>
                </div>
              </div>
              <Badge variant="outline" className="text-slate-300">
                Step {currentStep + 1} of {ONBOARDING_STEPS.length}
              </Badge>
            </div>
            
            <Progress value={progress} className="h-2" />
            
            {/* Step indicators */}
            <div className="flex justify-between mt-4">
              {ONBOARDING_STEPS.map((step, index) => {
                const Icon = step.icon;
                const isCompleted = completedSteps.has(index);
                const isCurrent = index === currentStep;
                
                return (
                  <div 
                    key={step.id}
                    className={`flex items-center gap-2 ${
                      isCurrent ? step.color : isCompleted ? 'text-green-500' : 'text-slate-500'
                    }`}
                  >
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center ${
                      isCurrent ? step.bgColor : isCompleted ? 'bg-green-500/10' : 'bg-slate-800'
                    }`}>
                      {isCompleted ? (
                        <CheckCircle className="h-4 w-4" />
                      ) : (
                        <Icon className="h-4 w-4" />
                      )}
                    </div>
                    <span className="text-xs hidden md:block">{step.title}</span>
                  </div>
                );
              })}
            </div>
          </CardContent>
        </Card>

        {/* Step Content */}
        <Card className="bg-slate-900 border-slate-700 min-h-[400px]">
          <CardContent className="pt-6">
            {/* Step 1: Organization Setup */}
            {currentStep === 0 && (
              <div className="space-y-6">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div className="space-y-2">
                    <Label htmlFor="companyName" className="text-slate-300">Company Name</Label>
                    <Input
                      id="companyName"
                      value={orgData.companyName}
                      onChange={(e) => setOrgData({ ...orgData, companyName: e.target.value })}
                      placeholder="Enter your company name"
                      className="bg-slate-800 border-slate-700"
                      data-testid="input-company-name"
                    />
                  </div>
                  
                  <div className="space-y-2">
                    <Label htmlFor="industry" className="text-slate-300">Industry</Label>
                    <Select value={orgData.industry} onValueChange={(v) => setOrgData({ ...orgData, industry: v })}>
                      <SelectTrigger className="bg-slate-800 border-slate-700" data-testid="select-industry">
                        <SelectValue placeholder="Select industry" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="technology">Technology</SelectItem>
                        <SelectItem value="financial">Financial Services</SelectItem>
                        <SelectItem value="healthcare">Healthcare</SelectItem>
                        <SelectItem value="retail">Retail & Consumer</SelectItem>
                        <SelectItem value="manufacturing">Manufacturing</SelectItem>
                        <SelectItem value="energy">Energy & Utilities</SelectItem>
                        <SelectItem value="other">Other</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  <div className="space-y-2">
                    <Label htmlFor="employeeCount" className="text-slate-300">Employee Count</Label>
                    <Select value={orgData.employeeCount} onValueChange={(v) => setOrgData({ ...orgData, employeeCount: v })}>
                      <SelectTrigger className="bg-slate-800 border-slate-700" data-testid="select-employees">
                        <SelectValue placeholder="Select size" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="1000-5000">1,000 - 5,000</SelectItem>
                        <SelectItem value="5000-10000">5,000 - 10,000</SelectItem>
                        <SelectItem value="10000-50000">10,000 - 50,000</SelectItem>
                        <SelectItem value="50000+">50,000+</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  <div className="space-y-2">
                    <Label htmlFor="primaryContact" className="text-slate-300">Primary Contact</Label>
                    <Input
                      id="primaryContact"
                      value={orgData.primaryContact}
                      onChange={(e) => setOrgData({ ...orgData, primaryContact: e.target.value })}
                      placeholder="Name of primary executive sponsor"
                      className="bg-slate-800 border-slate-700"
                      data-testid="input-primary-contact"
                    />
                  </div>
                </div>
                
                <div className="pt-4 border-t border-slate-700">
                  <Label className="text-slate-300 mb-3 block">Key Departments (will be included in playbook coordination)</Label>
                  <div className="flex flex-wrap gap-2">
                    {['Executive', 'Operations', 'Finance', 'Legal', 'Communications', 'IT', 'HR', 'Sales', 'Marketing'].map((dept) => (
                      <Badge
                        key={dept}
                        variant={orgData.departments.includes(dept) ? 'default' : 'outline'}
                        className={`cursor-pointer ${
                          orgData.departments.includes(dept) 
                            ? 'bg-blue-600 hover:bg-blue-700' 
                            : 'hover:bg-slate-700'
                        }`}
                        onClick={() => {
                          if (orgData.departments.includes(dept)) {
                            setOrgData({ ...orgData, departments: orgData.departments.filter(d => d !== dept) });
                          } else {
                            setOrgData({ ...orgData, departments: [...orgData.departments, dept] });
                          }
                        }}
                        data-testid={`badge-dept-${dept.toLowerCase()}`}
                      >
                        {dept}
                      </Badge>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {/* Step 2: Trigger Configuration */}
            {currentStep === 1 && (
              <div className="space-y-6">
                <p className="text-slate-400 mb-4">
                  Configure the thresholds that will trigger strategic alerts and playbook recommendations.
                </p>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <Card className="bg-slate-800 border-slate-700">
                    <CardHeader className="pb-3">
                      <CardTitle className="text-sm flex items-center gap-2 text-amber-400">
                        <BarChart3 className="h-4 w-4" />
                        Revenue Impact Threshold
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center gap-4">
                        <Input
                          type="number"
                          value={triggerData.revenueThreshold}
                          onChange={(e) => setTriggerData({ ...triggerData, revenueThreshold: Number(e.target.value) })}
                          className="bg-slate-900 border-slate-600 w-24"
                          data-testid="input-revenue-threshold"
                        />
                        <span className="text-slate-400">% change triggers alert</span>
                      </div>
                    </CardContent>
                  </Card>
                  
                  <Card className="bg-slate-800 border-slate-700">
                    <CardHeader className="pb-3">
                      <CardTitle className="text-sm flex items-center gap-2 text-purple-400">
                        <Target className="h-4 w-4" />
                        Market Share Threshold
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center gap-4">
                        <Input
                          type="number"
                          value={triggerData.marketShareThreshold}
                          onChange={(e) => setTriggerData({ ...triggerData, marketShareThreshold: Number(e.target.value) })}
                          className="bg-slate-900 border-slate-600 w-24"
                          data-testid="input-market-threshold"
                        />
                        <span className="text-slate-400">% shift triggers alert</span>
                      </div>
                    </CardContent>
                  </Card>
                  
                  <Card className="bg-slate-800 border-slate-700">
                    <CardHeader className="pb-3">
                      <CardTitle className="text-sm flex items-center gap-2 text-red-400">
                        <AlertTriangle className="h-4 w-4" />
                        Sentiment Threshold
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center gap-4">
                        <Input
                          type="number"
                          value={triggerData.sentimentThreshold}
                          onChange={(e) => setTriggerData({ ...triggerData, sentimentThreshold: Number(e.target.value) })}
                          className="bg-slate-900 border-slate-600 w-24"
                          data-testid="input-sentiment-threshold"
                        />
                        <span className="text-slate-400">% negative swing</span>
                      </div>
                    </CardContent>
                  </Card>
                </div>
                
                <div className="pt-4 border-t border-slate-700 space-y-4">
                  <h3 className="font-semibold text-white">Alert Categories</h3>
                  
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <Shield className="h-5 w-5 text-blue-400" />
                      <div>
                        <p className="text-white">Competitor Alerts</p>
                        <p className="text-xs text-slate-400">Monitor competitor moves and market positioning</p>
                      </div>
                    </div>
                    <Switch 
                      checked={triggerData.competitorAlertEnabled}
                      onCheckedChange={(v) => setTriggerData({ ...triggerData, competitorAlertEnabled: v })}
                      data-testid="switch-competitor-alerts"
                    />
                  </div>
                  
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <AlertTriangle className="h-5 w-5 text-amber-400" />
                      <div>
                        <p className="text-white">Regulatory Alerts</p>
                        <p className="text-xs text-slate-400">Track regulatory changes and compliance risks</p>
                      </div>
                    </div>
                    <Switch 
                      checked={triggerData.regulatoryAlertEnabled}
                      onCheckedChange={(v) => setTriggerData({ ...triggerData, regulatoryAlertEnabled: v })}
                      data-testid="switch-regulatory-alerts"
                    />
                  </div>
                  
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <Bell className="h-5 w-5 text-green-400" />
                      <div>
                        <p className="text-white">Media & PR Alerts</p>
                        <p className="text-xs text-slate-400">Monitor brand mentions and sentiment shifts</p>
                      </div>
                    </div>
                    <Switch 
                      checked={triggerData.mediaAlertEnabled}
                      onCheckedChange={(v) => setTriggerData({ ...triggerData, mediaAlertEnabled: v })}
                      data-testid="switch-media-alerts"
                    />
                  </div>
                </div>
              </div>
            )}

            {/* Step 3: Playbook Customization */}
            {currentStep === 2 && (
              <div className="space-y-6">
                <p className="text-slate-400 mb-4">
                  Select and configure the strategic playbooks your organization will use.
                </p>
                
                <div className="space-y-4">
                  <Label className="text-slate-300">Selected Playbook Categories</Label>
                  <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                    {[
                      { id: 'Crisis Response', icon: AlertTriangle, color: 'text-red-400' },
                      { id: 'Market Opportunity', icon: Rocket, color: 'text-green-400' },
                      { id: 'Competitive Response', icon: Target, color: 'text-blue-400' },
                      { id: 'M&A Integration', icon: Layers, color: 'text-purple-400' },
                      { id: 'Regulatory Compliance', icon: Shield, color: 'text-amber-400' },
                      { id: 'Digital Transformation', icon: Zap, color: 'text-cyan-400' },
                    ].map((playbook) => (
                      <Card
                        key={playbook.id}
                        className={`cursor-pointer transition-all ${
                          playbookData.selectedPlaybooks.includes(playbook.id)
                            ? 'bg-slate-700 border-green-500/50'
                            : 'bg-slate-800 border-slate-700 hover:border-slate-600'
                        }`}
                        onClick={() => {
                          if (playbookData.selectedPlaybooks.includes(playbook.id)) {
                            setPlaybookData({
                              ...playbookData,
                              selectedPlaybooks: playbookData.selectedPlaybooks.filter(p => p !== playbook.id)
                            });
                          } else {
                            setPlaybookData({
                              ...playbookData,
                              selectedPlaybooks: [...playbookData.selectedPlaybooks, playbook.id]
                            });
                          }
                        }}
                        data-testid={`card-playbook-${playbook.id.toLowerCase().replace(/\s+/g, '-')}`}
                      >
                        <CardContent className="pt-4 pb-4 flex items-center gap-3">
                          <playbook.icon className={`h-5 w-5 ${playbook.color}`} />
                          <span className="text-sm text-white">{playbook.id}</span>
                          {playbookData.selectedPlaybooks.includes(playbook.id) && (
                            <CheckCircle className="h-4 w-4 text-green-500 ml-auto" />
                          )}
                        </CardContent>
                      </Card>
                    ))}
                  </div>
                </div>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t border-slate-700">
                  <div className="space-y-2">
                    <Label className="text-slate-300 flex items-center gap-2">
                      <Clock className="h-4 w-4" />
                      Target Response Time
                    </Label>
                    <div className="flex items-center gap-3">
                      <Input
                        type="number"
                        value={playbookData.responseTimeTarget}
                        onChange={(e) => setPlaybookData({ ...playbookData, responseTimeTarget: Number(e.target.value) })}
                        className="bg-slate-800 border-slate-700 w-24"
                        data-testid="input-response-time"
                      />
                      <span className="text-slate-400">minutes</span>
                    </div>
                    <p className="text-xs text-slate-500">Industry benchmark: 12 minutes</p>
                  </div>
                  
                  <div className="space-y-2">
                    <Label className="text-slate-300">Default Budget Threshold</Label>
                    <div className="flex items-center gap-3">
                      <span className="text-slate-400">$</span>
                      <Input
                        type="number"
                        value={playbookData.defaultBudgetThreshold}
                        onChange={(e) => setPlaybookData({ ...playbookData, defaultBudgetThreshold: Number(e.target.value) })}
                        className="bg-slate-800 border-slate-700"
                        data-testid="input-budget-threshold"
                      />
                    </div>
                    <p className="text-xs text-slate-500">Pre-approved spend per activation</p>
                  </div>
                </div>
                
                <div className="flex items-center justify-between pt-4">
                  <div className="flex items-center gap-3">
                    <Zap className="h-5 w-5 text-amber-400" />
                    <div>
                      <p className="text-white">Auto-Escalation</p>
                      <p className="text-xs text-slate-400">Automatically escalate if response time exceeds target</p>
                    </div>
                  </div>
                  <Switch 
                    checked={playbookData.autoEscalationEnabled}
                    onCheckedChange={(v) => setPlaybookData({ ...playbookData, autoEscalationEnabled: v })}
                    data-testid="switch-auto-escalation"
                  />
                </div>
              </div>
            )}

            {/* Step 4: Success Metrics */}
            {currentStep === 3 && (
              <div className="space-y-6">
                <p className="text-slate-400 mb-4">
                  Define the key performance indicators that will measure your strategic execution success.
                </p>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <Card className="bg-slate-800 border-slate-700">
                    <CardHeader className="pb-3">
                      <CardTitle className="text-sm flex items-center gap-2 text-blue-400">
                        <Sparkles className="h-4 w-4" />
                        Future Readiness Index Target
                      </CardTitle>
                      <CardDescription className="text-xs">Overall organizational preparedness score</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center gap-4">
                        <Input
                          type="number"
                          step="0.1"
                          value={metricsData.friTarget}
                          onChange={(e) => setMetricsData({ ...metricsData, friTarget: Number(e.target.value) })}
                          className="bg-slate-900 border-slate-600 w-24"
                          data-testid="input-fri-target"
                        />
                        <span className="text-slate-400">%</span>
                      </div>
                      <p className="text-xs text-slate-500 mt-2">Recommended: 84.4% (top quartile)</p>
                    </CardContent>
                  </Card>
                  
                  <Card className="bg-slate-800 border-slate-700">
                    <CardHeader className="pb-3">
                      <CardTitle className="text-sm flex items-center gap-2 text-green-400">
                        <Zap className="h-4 w-4" />
                        Decision Velocity Target
                      </CardTitle>
                      <CardDescription className="text-xs">Time from trigger to coordinated response</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center gap-4">
                        <Input
                          type="number"
                          value={metricsData.velocityTarget}
                          onChange={(e) => setMetricsData({ ...metricsData, velocityTarget: Number(e.target.value) })}
                          className="bg-slate-900 border-slate-600 w-24"
                          data-testid="input-velocity-target"
                        />
                        <span className="text-slate-400">minutes</span>
                      </div>
                      <p className="text-xs text-slate-500 mt-2">Industry average: 45 minutes</p>
                    </CardContent>
                  </Card>
                  
                  <Card className="bg-slate-800 border-slate-700">
                    <CardHeader className="pb-3">
                      <CardTitle className="text-sm flex items-center gap-2 text-purple-400">
                        <Shield className="h-4 w-4" />
                        Scenario Coverage Target
                      </CardTitle>
                      <CardDescription className="text-xs">Percentage of risks with active playbooks</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center gap-4">
                        <Input
                          type="number"
                          value={metricsData.coverageTarget}
                          onChange={(e) => setMetricsData({ ...metricsData, coverageTarget: Number(e.target.value) })}
                          className="bg-slate-900 border-slate-600 w-24"
                          data-testid="input-coverage-target"
                        />
                        <span className="text-slate-400">%</span>
                      </div>
                      <p className="text-xs text-slate-500 mt-2">Recommended: 95% coverage</p>
                    </CardContent>
                  </Card>
                  
                  <Card className="bg-slate-800 border-slate-700">
                    <CardHeader className="pb-3">
                      <CardTitle className="text-sm flex items-center gap-2 text-amber-400">
                        <Clock className="h-4 w-4" />
                        Review Cadence
                      </CardTitle>
                      <CardDescription className="text-xs">How often metrics are reviewed</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <Select 
                        value={metricsData.reviewCadence} 
                        onValueChange={(v) => setMetricsData({ ...metricsData, reviewCadence: v })}
                      >
                        <SelectTrigger className="bg-slate-900 border-slate-600" data-testid="select-review-cadence">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="daily">Daily</SelectItem>
                          <SelectItem value="weekly">Weekly</SelectItem>
                          <SelectItem value="monthly">Monthly</SelectItem>
                          <SelectItem value="quarterly">Quarterly</SelectItem>
                        </SelectContent>
                      </Select>
                    </CardContent>
                  </Card>
                </div>
              </div>
            )}
          </CardContent>
        </Card>

        {/* Navigation Buttons */}
        <div className="flex justify-between">
          <Button
            variant="outline"
            onClick={handleBack}
            disabled={currentStep === 0}
            className="gap-2"
            data-testid="button-back"
          >
            <ChevronLeft className="h-4 w-4" />
            Back
          </Button>
          
          <Button
            onClick={handleNext}
            className="gap-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700"
            disabled={completeOnboardingMutation.isPending}
            data-testid="button-next"
          >
            {currentStep === ONBOARDING_STEPS.length - 1 ? (
              <>
                Complete Setup
                <Rocket className="h-4 w-4" />
              </>
            ) : (
              <>
                Continue
                <ChevronRight className="h-4 w-4" />
              </>
            )}
          </Button>
        </div>

        {/* Skip Option */}
        <div className="text-center">
          <Button
            variant="link"
            onClick={() => setLocation('/dashboard')}
            className="text-slate-500 hover:text-slate-300"
            data-testid="button-skip"
          >
            Skip for now and explore the platform
          </Button>
        </div>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/OneClickDemo.tsx
========================================
import { useState, useEffect, useCallback } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { 
  Play, 
  Pause, 
  RotateCcw, 
  Clock, 
  Users, 
  CheckCircle2, 
  AlertCircle, 
  Zap,
  Shield,
  DollarSign,
  TrendingUp,
  ArrowRight,
  X,
  Bot,
  FileText,
  Bell,
  Lock,
  Globe,
  Mail,
  Phone,
  MessageSquare
} from 'lucide-react';
import Confetti from 'react-confetti';
import { useLocation } from 'wouter';
import StandardNav from '@/components/layout/StandardNav';
import Footer from '@/components/layout/Footer';

interface Task {
  id: string;
  time: number;
  title: string;
  stakeholder: string;
  type: 'task' | 'ai' | 'approval' | 'blocker' | 'resolved' | 'complete';
  completed: boolean;
}

interface Stakeholder {
  id: string;
  name: string;
  role: string;
  department: string;
  acknowledged: boolean;
  acknowledgedAt?: number;
  tasksAssigned: number;
  tasksCompleted: number;
}

const DEMO_SCENARIO = {
  name: 'Critical Data Breach Response',
  trigger: 'Unauthorized access detected in customer database',
  severity: 'Critical',
  impactedCustomers: '2.4M',
  potentialFine: '$50M',
  playbook: 'SEC-001: Data Breach Incident Response',
  targetTime: 720, // 12 minutes in seconds for display, but we'll accelerate
  demoSpeed: 15, // Demo runs in 15 seconds for demo purposes
};

const STAKEHOLDERS: Stakeholder[] = [
  { id: 'ceo', name: 'Sarah Chen', role: 'CEO', department: 'Executive', acknowledged: false, tasksAssigned: 3, tasksCompleted: 0 },
  { id: 'ciso', name: 'Marcus Williams', role: 'CISO', department: 'Security', acknowledged: false, tasksAssigned: 8, tasksCompleted: 0 },
  { id: 'cfo', name: 'Jennifer Park', role: 'CFO', department: 'Finance', acknowledged: false, tasksAssigned: 4, tasksCompleted: 0 },
  { id: 'gc', name: 'Robert Chen', role: 'General Counsel', department: 'Legal', acknowledged: false, tasksAssigned: 6, tasksCompleted: 0 },
  { id: 'cmo', name: 'Amanda Foster', role: 'CMO', department: 'Communications', acknowledged: false, tasksAssigned: 5, tasksCompleted: 0 },
  { id: 'chro', name: 'David Kim', role: 'CHRO', department: 'HR', acknowledged: false, tasksAssigned: 3, tasksCompleted: 0 },
  { id: 'coo', name: 'Lisa Thompson', role: 'COO', department: 'Operations', acknowledged: false, tasksAssigned: 4, tasksCompleted: 0 },
  { id: 'ir', name: 'Michael Santos', role: 'VP Investor Relations', department: 'Finance', acknowledged: false, tasksAssigned: 2, tasksCompleted: 0 },
];

const TASKS: Task[] = [
  { id: '1', time: 0, title: 'Breach detected - playbook activated', stakeholder: 'System', type: 'ai', completed: false },
  { id: '2', time: 1, title: 'Notifying 8 stakeholders simultaneously', stakeholder: 'M Platform', type: 'ai', completed: false },
  { id: '3', time: 2, title: 'CISO acknowledged - reviewing threat assessment', stakeholder: 'Marcus Williams', type: 'task', completed: false },
  { id: '4', time: 3, title: 'Legal team activated - compliance review initiated', stakeholder: 'Robert Chen', type: 'task', completed: false },
  { id: '5', time: 4, title: 'CEO briefing package auto-generated', stakeholder: 'M Platform', type: 'ai', completed: false },
  { id: '6', time: 5, title: 'Regulatory notification template populated', stakeholder: 'M Platform', type: 'ai', completed: false },
  { id: '7', time: 6, title: 'CFO approved emergency budget ($500K)', stakeholder: 'Jennifer Park', type: 'approval', completed: false },
  { id: '8', time: 7, title: 'BLOCKER: Missing breach scope data', stakeholder: 'Legal', type: 'blocker', completed: false },
  { id: '9', time: 8, title: 'AI auto-requested data from Security team', stakeholder: 'M Platform', type: 'ai', completed: false },
  { id: '10', time: 9, title: 'Security provided scope - Legal unblocked', stakeholder: 'Marcus Williams', type: 'resolved', completed: false },
  { id: '11', time: 10, title: 'Communications draft ready for CEO review', stakeholder: 'Amanda Foster', type: 'task', completed: false },
  { id: '12', time: 11, title: 'CEO approved public statement', stakeholder: 'Sarah Chen', type: 'approval', completed: false },
  { id: '13', time: 12, title: 'Customer notification initiated (2.4M emails)', stakeholder: 'M Platform', type: 'ai', completed: false },
  { id: '14', time: 13, title: 'Regulatory notification filed (72-hour deadline met)', stakeholder: 'Robert Chen', type: 'complete', completed: false },
  { id: '15', time: 14, title: 'All 47 tasks completed - breach contained', stakeholder: 'M Platform', type: 'complete', completed: false },
];

export default function OneClickDemo() {
  const [, setLocation] = useLocation();
  const [demoState, setDemoState] = useState<'idle' | 'running' | 'paused' | 'complete'>('idle');
  const [elapsedTime, setElapsedTime] = useState(0);
  const [displayTime, setDisplayTime] = useState(0);
  const [tasks, setTasks] = useState<Task[]>(TASKS.map(t => ({ ...t, completed: false })));
  const [stakeholders, setStakeholders] = useState<Stakeholder[]>(STAKEHOLDERS.map(s => ({ ...s, acknowledged: false, tasksCompleted: 0 })));
  const [showConfetti, setShowConfetti] = useState(false);
  const [isFullscreen, setIsFullscreen] = useState(false);

  const progress = (elapsedTime / DEMO_SCENARIO.demoSpeed) * 100;
  const acknowledgedCount = stakeholders.filter(s => s.acknowledged).length;
  const completedTasks = tasks.filter(t => t.completed).length;

  const startDemo = useCallback(() => {
    setDemoState('running');
    setElapsedTime(0);
    setDisplayTime(0);
    setTasks(TASKS.map(t => ({ ...t, completed: false })));
    setStakeholders(STAKEHOLDERS.map(s => ({ ...s, acknowledged: false, tasksCompleted: 0 })));
    setIsFullscreen(true);
  }, []);

  const pauseDemo = useCallback(() => {
    setDemoState('paused');
  }, []);

  const resumeDemo = useCallback(() => {
    setDemoState('running');
  }, []);

  const resetDemo = useCallback(() => {
    setDemoState('idle');
    setElapsedTime(0);
    setDisplayTime(0);
    setTasks(TASKS.map(t => ({ ...t, completed: false })));
    setStakeholders(STAKEHOLDERS.map(s => ({ ...s, acknowledged: false, tasksCompleted: 0 })));
    setShowConfetti(false);
    setIsFullscreen(false);
  }, []);

  useEffect(() => {
    if (demoState !== 'running') return;

    const interval = setInterval(() => {
      setElapsedTime(prev => {
        const newTime = prev + 0.1;
        
        // Update display time (scaled to 12 minutes)
        const scaledTime = (newTime / DEMO_SCENARIO.demoSpeed) * 720;
        setDisplayTime(Math.floor(scaledTime));
        
        // Complete tasks based on elapsed time
        const taskIndex = Math.floor(newTime);
        if (taskIndex < TASKS.length) {
          setTasks(currentTasks => 
            currentTasks.map((t, i) => i <= taskIndex ? { ...t, completed: true } : t)
          );
        }
        
        // Acknowledge stakeholders progressively
        const ackProgress = newTime / DEMO_SCENARIO.demoSpeed;
        const stakeholdersToAck = Math.floor(ackProgress * STAKEHOLDERS.length);
        setStakeholders(current =>
          current.map((s, i) => i < stakeholdersToAck ? { ...s, acknowledged: true, acknowledgedAt: Math.floor(scaledTime) } : s)
        );
        
        // Complete demo
        if (newTime >= DEMO_SCENARIO.demoSpeed) {
          setDemoState('complete');
          setShowConfetti(true);
          setTimeout(() => setShowConfetti(false), 8000);
          return DEMO_SCENARIO.demoSpeed;
        }
        
        return newTime;
      });
    }, 100);

    return () => clearInterval(interval);
  }, [demoState]);

  const formatDisplayTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const getTaskIcon = (type: Task['type']) => {
    switch (type) {
      case 'ai': return <Bot className="h-4 w-4 text-blue-400" />;
      case 'approval': return <CheckCircle2 className="h-4 w-4 text-green-400" />;
      case 'blocker': return <AlertCircle className="h-4 w-4 text-red-400" />;
      case 'resolved': return <Zap className="h-4 w-4 text-amber-400" />;
      case 'complete': return <Shield className="h-4 w-4 text-emerald-400" />;
      default: return <FileText className="h-4 w-4 text-slate-400" />;
    }
  };

  const getTaskBorderColor = (type: Task['type']) => {
    switch (type) {
      case 'ai': return 'border-l-blue-500';
      case 'approval': return 'border-l-green-500';
      case 'blocker': return 'border-l-red-500';
      case 'resolved': return 'border-l-amber-500';
      case 'complete': return 'border-l-emerald-500';
      default: return 'border-l-slate-500';
    }
  };

  // Idle state - show the start button
  if (demoState === 'idle' && !isFullscreen) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-950">
        <StandardNav />
        
        <div className="container mx-auto px-4 py-20">
          <div className="max-w-4xl mx-auto text-center">
            <Badge className="mb-6 bg-red-500/20 text-red-400 border-red-500/30 text-sm px-4 py-1">
              <AlertCircle className="h-4 w-4 mr-2" />
              Live Interactive Demo
            </Badge>
            
            <h1 className="text-5xl font-bold text-white mb-6">
              See M in Action
            </h1>
            
            <p className="text-xl text-slate-300 mb-8 max-w-2xl mx-auto">
              Watch a critical data breach get detected, coordinated across 8 executives, 
              and fully contained in 12 minutes instead of 17 days.
            </p>

            <div className="grid md:grid-cols-3 gap-6 mb-12">
              <Card className="bg-slate-800/50 border-slate-700">
                <CardContent className="p-6 text-center">
                  <div className="text-4xl font-bold text-red-400 mb-2">2.4M</div>
                  <div className="text-sm text-slate-400">Customers Impacted</div>
                </CardContent>
              </Card>
              <Card className="bg-slate-800/50 border-slate-700">
                <CardContent className="p-6 text-center">
                  <div className="text-4xl font-bold text-amber-400 mb-2">$50M</div>
                  <div className="text-sm text-slate-400">Potential Fine</div>
                </CardContent>
              </Card>
              <Card className="bg-slate-800/50 border-slate-700">
                <CardContent className="p-6 text-center">
                  <div className="text-4xl font-bold text-green-400 mb-2">12 min</div>
                  <div className="text-sm text-slate-400">Target Response Time</div>
                </CardContent>
              </Card>
            </div>

            <Button 
              size="lg" 
              onClick={startDemo}
              className="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white px-12 py-6 text-xl rounded-xl shadow-2xl shadow-blue-500/30 transition-all hover:scale-105"
              data-testid="button-start-demo"
            >
              <Play className="h-6 w-6 mr-3" />
              Start Live Demo
            </Button>
            
            <p className="text-sm text-slate-500 mt-4">
              15-second accelerated simulation of 12-minute response
            </p>
          </div>
        </div>
        
        <Footer />
      </div>
    );
  }

  // Running/Paused/Complete state - fullscreen demo view
  return (
    <div className="fixed inset-0 bg-slate-950 z-50 overflow-auto">
      {showConfetti && <Confetti recycle={false} numberOfPieces={500} />}
      
      {/* Header */}
      <div className="bg-slate-900/90 border-b border-slate-800 sticky top-0 z-10">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <Badge className={`${demoState === 'complete' ? 'bg-green-500/20 text-green-400 border-green-500/30' : 'bg-red-500/20 text-red-400 border-red-500/30 animate-pulse'}`}>
                {demoState === 'complete' ? 'CONTAINED' : 'ACTIVE INCIDENT'}
              </Badge>
              <span className="text-white font-semibold">{DEMO_SCENARIO.name}</span>
            </div>
            
            <div className="flex items-center gap-4">
              <div className="text-right">
                <div className="text-3xl font-mono font-bold text-white">{formatDisplayTime(displayTime)}</div>
                <div className="text-xs text-slate-400">Elapsed Time</div>
              </div>
              
              <div className="flex gap-2">
                {demoState === 'running' && (
                  <Button variant="outline" size="sm" onClick={pauseDemo} data-testid="button-pause-demo">
                    <Pause className="h-4 w-4" />
                  </Button>
                )}
                {demoState === 'paused' && (
                  <Button variant="outline" size="sm" onClick={resumeDemo} data-testid="button-resume-demo">
                    <Play className="h-4 w-4" />
                  </Button>
                )}
                <Button variant="outline" size="sm" onClick={resetDemo} data-testid="button-reset-demo">
                  <RotateCcw className="h-4 w-4" />
                </Button>
                <Button variant="ghost" size="sm" onClick={resetDemo} data-testid="button-close-demo">
                  <X className="h-4 w-4" />
                </Button>
              </div>
            </div>
          </div>
          
          {/* Progress Bar */}
          <div className="mt-3">
            <Progress value={Math.min(progress, 100)} className="h-2" />
            <div className="flex justify-between text-xs text-slate-500 mt-1">
              <span>0:00</span>
              <span>Target: 12:00</span>
            </div>
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="container mx-auto px-4 py-6">
        <div className="grid lg:grid-cols-3 gap-6">
          
          {/* Left Column - Task Feed */}
          <div className="lg:col-span-2 space-y-4">
            <Card className="bg-slate-900/50 border-slate-800">
              <CardContent className="p-4">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                    <Zap className="h-5 w-5 text-amber-400" />
                    Live Execution Feed
                  </h3>
                  <Badge variant="outline" className="text-slate-400">
                    {completedTasks}/{tasks.length} Tasks
                  </Badge>
                </div>
                
                <div className="space-y-2 max-h-[500px] overflow-y-auto">
                  {tasks.map((task, index) => (
                    <div 
                      key={task.id}
                      className={`border-l-4 ${getTaskBorderColor(task.type)} pl-4 py-2 rounded-r transition-all duration-300 ${
                        task.completed 
                          ? 'bg-slate-800/50 opacity-100' 
                          : 'bg-slate-900/30 opacity-40'
                      }`}
                      data-testid={`task-${task.id}`}
                    >
                      <div className="flex items-start gap-3">
                        {getTaskIcon(task.type)}
                        <div className="flex-1">
                          <div className="text-sm text-white">{task.title}</div>
                          <div className="text-xs text-slate-500">{task.stakeholder}</div>
                        </div>
                        {task.completed && (
                          <CheckCircle2 className="h-4 w-4 text-green-400 flex-shrink-0" />
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Right Column - Stakeholders & Stats */}
          <div className="space-y-4">
            {/* Stakeholder Status */}
            <Card className="bg-slate-900/50 border-slate-800">
              <CardContent className="p-4">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                    <Users className="h-5 w-5 text-blue-400" />
                    Stakeholder Status
                  </h3>
                  <Badge variant="outline" className="text-green-400">
                    {acknowledgedCount}/{stakeholders.length} Acknowledged
                  </Badge>
                </div>
                
                <div className="space-y-2">
                  {stakeholders.map((stakeholder) => (
                    <div 
                      key={stakeholder.id}
                      className={`flex items-center justify-between p-2 rounded transition-all duration-300 ${
                        stakeholder.acknowledged 
                          ? 'bg-green-500/10 border border-green-500/30' 
                          : 'bg-slate-800/30'
                      }`}
                      data-testid={`stakeholder-${stakeholder.id}`}
                    >
                      <div className="flex items-center gap-2">
                        {stakeholder.acknowledged ? (
                          <CheckCircle2 className="h-4 w-4 text-green-400" />
                        ) : (
                          <div className="h-4 w-4 rounded-full border-2 border-slate-600" />
                        )}
                        <div>
                          <div className="text-sm text-white">{stakeholder.name}</div>
                          <div className="text-xs text-slate-500">{stakeholder.role}</div>
                        </div>
                      </div>
                      {stakeholder.acknowledged && (
                        <Badge variant="outline" className="text-xs text-green-400">
                          {formatDisplayTime(stakeholder.acknowledgedAt || 0)}
                        </Badge>
                      )}
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>

            {/* Live Metrics */}
            <Card className="bg-slate-900/50 border-slate-800">
              <CardContent className="p-4 space-y-4">
                <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                  <TrendingUp className="h-5 w-5 text-emerald-400" />
                  Live Metrics
                </h3>
                
                <div className="grid grid-cols-2 gap-3">
                  <div className="bg-slate-800/50 rounded-lg p-3 text-center">
                    <div className="text-2xl font-bold text-blue-400">{completedTasks}</div>
                    <div className="text-xs text-slate-500">Tasks Complete</div>
                  </div>
                  <div className="bg-slate-800/50 rounded-lg p-3 text-center">
                    <div className="text-2xl font-bold text-green-400">{acknowledgedCount}</div>
                    <div className="text-xs text-slate-500">Stakeholders Active</div>
                  </div>
                  <div className="bg-slate-800/50 rounded-lg p-3 text-center">
                    <div className="text-2xl font-bold text-amber-400">$500K</div>
                    <div className="text-xs text-slate-500">Budget Released</div>
                  </div>
                  <div className="bg-slate-800/50 rounded-lg p-3 text-center">
                    <div className="text-2xl font-bold text-purple-400">2.4M</div>
                    <div className="text-xs text-slate-500">Customers Notified</div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>

        {/* Completion Card */}
        {demoState === 'complete' && (
          <Card className="mt-6 bg-gradient-to-r from-green-950/50 to-emerald-950/50 border-green-500/30">
            <CardContent className="p-8 text-center">
              <div className="flex justify-center mb-4">
                <div className="w-20 h-20 rounded-full bg-green-500/20 flex items-center justify-center">
                  <Shield className="h-10 w-10 text-green-400" />
                </div>
              </div>
              
              <h2 className="text-3xl font-bold text-white mb-2">Breach Contained in 12 Minutes</h2>
              <p className="text-slate-300 mb-6">
                Traditional response time: 17 days. M Platform response: 12 minutes.
              </p>
              
              <div className="grid md:grid-cols-4 gap-4 mb-8">
                <div className="bg-slate-800/50 rounded-lg p-4">
                  <div className="text-3xl font-bold text-green-400">340X</div>
                  <div className="text-sm text-slate-400">Faster Response</div>
                </div>
                <div className="bg-slate-800/50 rounded-lg p-4">
                  <div className="text-3xl font-bold text-blue-400">$47M</div>
                  <div className="text-sm text-slate-400">Fine Avoided</div>
                </div>
                <div className="bg-slate-800/50 rounded-lg p-4">
                  <div className="text-3xl font-bold text-amber-400">47</div>
                  <div className="text-sm text-slate-400">Tasks Coordinated</div>
                </div>
                <div className="bg-slate-800/50 rounded-lg p-4">
                  <div className="text-3xl font-bold text-purple-400">8</div>
                  <div className="text-sm text-slate-400">Executives Aligned</div>
                </div>
              </div>
              
              <div className="flex justify-center gap-4">
                <Button 
                  onClick={resetDemo}
                  variant="outline"
                  size="lg"
                  data-testid="button-run-again"
                >
                  <RotateCcw className="h-5 w-5 mr-2" />
                  Run Demo Again
                </Button>
                <Button 
                  onClick={() => { resetDemo(); setLocation('/contact'); }}
                  size="lg"
                  className="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700"
                  data-testid="button-schedule-demo"
                >
                  Schedule Live Demo
                  <ArrowRight className="h-5 w-5 ml-2" />
                </Button>
              </div>
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/OperatingModelAlignment.tsx
========================================
import { useState, useMemo } from 'react';
import StandardNav from '@/components/layout/StandardNav';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Progress } from "@/components/ui/progress";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group";
import { Label } from "@/components/ui/label";
import { 
  Activity, 
  Target, 
  Building2, 
  Network, 
  Crown, 
  Scale, 
  Workflow, 
  Cpu, 
  Users, 
  Award, 
  MapPin, 
  GraduationCap,
  TrendingUp,
  AlertCircle,
  CheckCircle2,
  ArrowRight,
  ChevronRight,
  ChevronLeft,
  BarChart3,
  Zap,
  BookOpen,
  Play,
  RotateCcw,
  Lightbulb,
  ExternalLink
} from "lucide-react";
import { OPERATING_MODEL_ELEMENTS, OperatingModelElement } from "@shared/scenarios";
import { Link } from 'wouter';

const elementIcons: Record<string, any> = {
  'Purpose': Activity,
  'Value Agenda': Target,
  'Structure': Building2,
  'Ecosystem': Network,
  'Leadership': Crown,
  'Governance': Scale,
  'Processes': Workflow,
  'Technology': Cpu,
  'Behaviors': Users,
  'Rewards': Award,
  'Footprint': MapPin,
  'Talent': GraduationCap
};

const elementCategories: Record<string, { name: string; color: string; elements: OperatingModelElement[] }> = {
  'foundation': { name: 'Foundation', color: 'blue', elements: ['Purpose', 'Value Agenda'] },
  'organization': { name: 'Organization', color: 'purple', elements: ['Structure', 'Ecosystem'] },
  'governance': { name: 'Governance', color: 'amber', elements: ['Leadership', 'Governance'] },
  'execution': { name: 'Execution', color: 'green', elements: ['Processes', 'Technology'] },
  'people': { name: 'People', color: 'rose', elements: ['Behaviors', 'Rewards', 'Footprint', 'Talent'] }
};

const operatingModelQuestions: Record<OperatingModelElement, { questions: string[]; playbookDomains: string[] }> = {
  'Purpose': {
    questions: [
      'Is your purpose clearly articulated and understood across the organization?',
      'Does your purpose guide strategic decision-making?',
      'How well does your purpose resonate with employees and stakeholders?'
    ],
    playbookDomains: ['transformation', 'market-entry']
  },
  'Value Agenda': {
    questions: [
      'Is your value creation strategy clearly defined?',
      'Are resources optimally allocated to highest-value activities?',
      'How well do you measure value creation across business units?'
    ],
    playbookDomains: ['competitive-response', 'ma-integration', 'product-launch']
  },
  'Structure': {
    questions: [
      'Is accountability clear across the organization?',
      'Are spans of control appropriate for your strategy?',
      'How effectively does your structure support cross-functional work?'
    ],
    playbookDomains: ['transformation', 'ma-integration']
  },
  'Ecosystem': {
    questions: [
      'Do you have strategic partnerships that extend your capabilities?',
      'How well do you integrate external partners into your operations?',
      'Is your partner ecosystem a source of competitive advantage?'
    ],
    playbookDomains: ['market-entry', 'product-launch', 'competitive-response']
  },
  'Leadership': {
    questions: [
      'Are decision rights clear across leadership levels?',
      'Is your leadership style aligned to strategy?',
      'How quickly can leaders mobilize resources for new initiatives?'
    ],
    playbookDomains: ['crisis-response', 'transformation', 'ma-integration']
  },
  'Governance': {
    questions: [
      'Are governance mechanisms effective at setting enterprise priorities?',
      'Is resource allocation transparent and aligned to strategy?',
      'How well does your governance support rapid reallocation when needed?'
    ],
    playbookDomains: ['crisis-response', 'regulatory-change', 'transformation']
  },
  'Processes': {
    questions: [
      'Are core processes standardized where appropriate?',
      'How well do your processes balance control with agility?',
      'Are workflows optimized for speed and quality?'
    ],
    playbookDomains: ['product-launch', 'regulatory-change', 'ma-integration']
  },
  'Technology': {
    questions: [
      'Is your technology stack enabling or constraining your strategy?',
      'How well are you leveraging AI and automation?',
      'Is data accessible and actionable across the organization?'
    ],
    playbookDomains: ['cyber-incidents', 'product-launch', 'competitive-response']
  },
  'Behaviors': {
    questions: [
      'Is there a distinctive culture that creates competitive advantage?',
      'Are desired behaviors consistently reinforced?',
      'How well does your culture support change and adaptation?'
    ],
    playbookDomains: ['transformation', 'ma-integration']
  },
  'Rewards': {
    questions: [
      'Are incentives aligned to strategic priorities?',
      'Do rewards support collaboration or individual performance?',
      'How well do rewards drive desired behaviors?'
    ],
    playbookDomains: ['transformation', 'competitive-response']
  },
  'Footprint': {
    questions: [
      'Is your geographic footprint optimized for your strategy?',
      'How effectively do you deploy talent across locations?',
      'Are location decisions supporting cost and capability goals?'
    ],
    playbookDomains: ['market-entry', 'ma-integration', 'transformation']
  },
  'Talent': {
    questions: [
      'Do you have the capabilities needed for your strategy?',
      'How effective is your talent development pipeline?',
      'Are you winning the competition for critical skills?'
    ],
    playbookDomains: ['transformation', 'competitive-response', 'market-entry']
  }
};

const playbookDomainInfo: Record<string, { name: string; count: number; description: string }> = {
  'crisis-response': { name: 'Crisis Response', count: 24, description: 'Rapid mobilization for unexpected events' },
  'cyber-incidents': { name: 'Cyber Incidents', count: 18, description: 'Security threat detection and recovery' },
  'market-entry': { name: 'Market Entry', count: 22, description: 'Entering new markets or segments' },
  'ma-integration': { name: 'M&A Integration', count: 16, description: 'Post-merger integration and synergy' },
  'product-launch': { name: 'Product Launch', count: 20, description: 'Bringing products to market' },
  'competitive-response': { name: 'Competitive Response', count: 18, description: 'Responding to market threats' },
  'regulatory-change': { name: 'Regulatory Change', count: 14, description: 'Adapting to new regulations' },
  'transformation': { name: 'Transformation', count: 16, description: 'Large-scale organizational change' }
};

const structureTypes = [
  {
    id: 'business-unit',
    name: 'Business Unit / Holding Company',
    category: 'traditional',
    description: 'Decentralized units with high autonomy',
    strengths: ['Clear P&L accountability', 'Entrepreneurial culture', 'Fast local decisions'],
    challenges: ['Duplication of capabilities', 'Limited synergies']
  },
  {
    id: 'matrix',
    name: 'Matrix Management',
    category: 'traditional',
    description: 'Dual reporting lines balancing priorities',
    strengths: ['Balances local and global', 'Shares resources', 'Develops broad talent'],
    challenges: ['Slow decisions', 'Unclear accountability']
  },
  {
    id: 'functional',
    name: 'Functional Organization',
    category: 'traditional',
    description: 'Organized by specialized functions',
    strengths: ['Deep expertise', 'Economies of scale', 'Clear career paths'],
    challenges: ['Siloed thinking', 'Slow cross-functional work']
  },
  {
    id: 'product-platform',
    name: 'Product Platform Model',
    category: 'emerging',
    description: 'Platform teams provide shared capabilities',
    strengths: ['Reusable components', 'Fast iteration', 'Clear ownership'],
    challenges: ['Platform/product tension', 'Requires strong architecture']
  },
  {
    id: 'enterprise-agile',
    name: 'Enterprise Agile',
    category: 'emerging',
    description: 'Cross-functional squads around outcomes',
    strengths: ['Speed to market', 'Customer focus', 'High engagement'],
    challenges: ['Scaling coordination', 'Enterprise governance']
  },
  {
    id: 'decentralized-network',
    name: 'Decentralized Network',
    category: 'emerging',
    description: 'Autonomous nodes with shared purpose',
    strengths: ['Maximum agility', 'Resilience', 'Innovation at edges'],
    challenges: ['Coherence', 'Quality control']
  }
];

type AssessmentAnswers = Record<OperatingModelElement, number[]>;

function RadarChart({ scores, targetScores }: { scores: Record<OperatingModelElement, number>; targetScores?: Record<OperatingModelElement, number> }) {
  const elements = Object.keys(scores) as OperatingModelElement[];
  const centerX = 150;
  const centerY = 150;
  const maxRadius = 120;
  
  const angleStep = (2 * Math.PI) / elements.length;
  
  const getPoint = (index: number, value: number) => {
    const angle = (index * angleStep) - (Math.PI / 2);
    const radius = (value / 100) * maxRadius;
    return {
      x: centerX + radius * Math.cos(angle),
      y: centerY + radius * Math.sin(angle)
    };
  };
  
  const currentPath = elements.map((_, i) => {
    const point = getPoint(i, scores[elements[i]]);
    return `${i === 0 ? 'M' : 'L'} ${point.x} ${point.y}`;
  }).join(' ') + ' Z';
  
  const targetPath = targetScores ? elements.map((_, i) => {
    const point = getPoint(i, targetScores[elements[i]]);
    return `${i === 0 ? 'M' : 'L'} ${point.x} ${point.y}`;
  }).join(' ') + ' Z' : null;
  
  return (
    <svg viewBox="0 0 300 300" className="w-full max-w-md mx-auto">
      {[20, 40, 60, 80, 100].map(level => (
        <polygon
          key={level}
          points={elements.map((_, i) => {
            const point = getPoint(i, level);
            return `${point.x},${point.y}`;
          }).join(' ')}
          fill="none"
          stroke="currentColor"
          strokeOpacity={0.1}
          className="text-slate-400"
        />
      ))}
      
      {elements.map((_, i) => {
        const point = getPoint(i, 100);
        return (
          <line
            key={i}
            x1={centerX}
            y1={centerY}
            x2={point.x}
            y2={point.y}
            stroke="currentColor"
            strokeOpacity={0.1}
            className="text-slate-400"
          />
        );
      })}
      
      {targetPath && (
        <path
          d={targetPath}
          fill="rgba(59, 130, 246, 0.1)"
          stroke="rgb(59, 130, 246)"
          strokeWidth={2}
          strokeDasharray="4 2"
        />
      )}
      
      <path
        d={currentPath}
        fill="rgba(16, 185, 129, 0.2)"
        stroke="rgb(16, 185, 129)"
        strokeWidth={2}
      />
      
      {elements.map((element, i) => {
        const labelPoint = getPoint(i, 115);
        const Icon = elementIcons[element];
        return (
          <g key={element}>
            <circle
              cx={getPoint(i, scores[element]).x}
              cy={getPoint(i, scores[element]).y}
              r={4}
              fill="rgb(16, 185, 129)"
            />
            <foreignObject
              x={labelPoint.x - 12}
              y={labelPoint.y - 12}
              width={24}
              height={24}
            >
              <div className="flex items-center justify-center w-6 h-6 rounded-full bg-slate-100 dark:bg-slate-800">
                <Icon className="w-3 h-3 text-slate-600 dark:text-slate-400" />
              </div>
            </foreignObject>
          </g>
        );
      })}
    </svg>
  );
}

function AssessmentStep({ 
  element, 
  answers, 
  onAnswer,
  onNext,
  onPrevious,
  currentIndex,
  totalElements
}: { 
  element: OperatingModelElement;
  answers: number[];
  onAnswer: (questionIndex: number, value: number) => void;
  onNext: () => void;
  onPrevious: () => void;
  currentIndex: number;
  totalElements: number;
}) {
  const Icon = elementIcons[element];
  const questions = operatingModelQuestions[element].questions;
  const allAnswered = answers.length === questions.length && answers.every(a => a > 0);
  
  const category = Object.entries(elementCategories).find(([_, cat]) => 
    cat.elements.includes(element)
  );
  
  return (
    <Card className="border-2">
      <CardHeader>
        <div className="flex items-center justify-between mb-4">
          <Badge variant="outline" className={`text-${category?.[1].color}-600`}>
            {category?.[1].name}
          </Badge>
          <span className="text-sm text-muted-foreground">
            {currentIndex + 1} of {totalElements}
          </span>
        </div>
        <div className="flex items-center gap-3">
          <div className={`w-12 h-12 rounded-xl bg-${category?.[1].color}-500/10 flex items-center justify-center`}>
            <Icon className={`w-6 h-6 text-${category?.[1].color}-500`} />
          </div>
          <div>
            <CardTitle className="text-xl">{element}</CardTitle>
            <CardDescription>
              {OPERATING_MODEL_ELEMENTS.find(e => e.id === element)?.description}
            </CardDescription>
          </div>
        </div>
      </CardHeader>
      <CardContent className="space-y-6">
        {questions.map((question, qIndex) => (
          <div key={qIndex} className="space-y-3">
            <p className="font-medium text-foreground">{question}</p>
            <RadioGroup
              value={answers[qIndex]?.toString() || ''}
              onValueChange={(value) => onAnswer(qIndex, parseInt(value))}
              className="flex gap-2"
            >
              {[1, 2, 3, 4, 5].map((value) => (
                <div key={value} className="flex items-center">
                  <RadioGroupItem
                    value={value.toString()}
                    id={`${element}-${qIndex}-${value}`}
                    className="peer sr-only"
                    data-testid={`radio-${element.toLowerCase().replace(/\s+/g, '-')}-q${qIndex}-${value}`}
                  />
                  <Label
                    htmlFor={`${element}-${qIndex}-${value}`}
                    data-testid={`label-${element.toLowerCase().replace(/\s+/g, '-')}-q${qIndex}-${value}`}
                    className={`flex items-center justify-center w-10 h-10 rounded-lg border-2 cursor-pointer transition-all
                      ${answers[qIndex] === value 
                        ? 'bg-primary text-primary-foreground border-primary' 
                        : 'bg-muted/30 border-muted-foreground/20 hover:border-primary/50'
                      }`}
                  >
                    {value}
                  </Label>
                </div>
              ))}
            </RadioGroup>
            <div className="flex justify-between text-xs text-muted-foreground px-1">
              <span>Strongly Disagree</span>
              <span>Strongly Agree</span>
            </div>
          </div>
        ))}
        
        <div className="flex justify-between pt-4">
          <Button
            variant="outline"
            onClick={onPrevious}
            disabled={currentIndex === 0}
            data-testid="button-assessment-previous"
          >
            <ChevronLeft className="w-4 h-4 mr-1" />
            Previous
          </Button>
          <Button
            onClick={onNext}
            disabled={!allAnswered}
            data-testid="button-assessment-next"
          >
            {currentIndex === totalElements - 1 ? 'Complete Assessment' : 'Next'}
            <ChevronRight className="w-4 h-4 ml-1" />
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}

export default function OperatingModelAlignment() {
  const [activeTab, setActiveTab] = useState('overview');
  const [assessmentStarted, setAssessmentStarted] = useState(false);
  const [assessmentComplete, setAssessmentComplete] = useState(false);
  const [currentElementIndex, setCurrentElementIndex] = useState(0);
  const [answers, setAnswers] = useState<AssessmentAnswers>({} as AssessmentAnswers);
  const [selectedStructure, setSelectedStructure] = useState<string | null>(null);
  
  const elements = OPERATING_MODEL_ELEMENTS.map(e => e.id) as OperatingModelElement[];
  
  const scores = useMemo(() => {
    if (!assessmentComplete) return null;
    const result: Record<OperatingModelElement, number> = {} as Record<OperatingModelElement, number>;
    elements.forEach(element => {
      const elementAnswers = answers[element] || [];
      const avg = elementAnswers.length > 0 
        ? elementAnswers.reduce((a, b) => a + b, 0) / elementAnswers.length 
        : 0;
      result[element] = Math.round((avg / 5) * 100);
    });
    return result;
  }, [assessmentComplete, answers]);
  
  const targetScores = useMemo(() => {
    const result: Record<OperatingModelElement, number> = {} as Record<OperatingModelElement, number>;
    elements.forEach(element => {
      result[element] = 85;
    });
    return result;
  }, []);
  
  const overallScore = scores 
    ? Math.round(Object.values(scores).reduce((a, b) => a + b, 0) / Object.values(scores).length)
    : 0;
  
  const priorityElements = scores
    ? elements.filter(e => scores[e] < 70).sort((a, b) => scores[a] - scores[b]).slice(0, 3)
    : [];
  
  const recommendedPlaybooks = useMemo(() => {
    if (!scores) return [];
    const domainScores: Record<string, number> = {};
    
    elements.forEach(element => {
      const domains = operatingModelQuestions[element].playbookDomains;
      const gap = 85 - scores[element];
      domains.forEach(domain => {
        domainScores[domain] = (domainScores[domain] || 0) + gap;
      });
    });
    
    return Object.entries(domainScores)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 5)
      .map(([domain, score]) => ({
        domain,
        info: playbookDomainInfo[domain],
        relevance: Math.min(100, Math.round(score / 3))
      }));
  }, [scores]);
  
  const handleAnswer = (questionIndex: number, value: number) => {
    const element = elements[currentElementIndex];
    setAnswers(prev => ({
      ...prev,
      [element]: [...(prev[element] || []).slice(0, questionIndex), value, ...(prev[element] || []).slice(questionIndex + 1)]
    }));
  };
  
  const handleNext = () => {
    if (currentElementIndex < elements.length - 1) {
      setCurrentElementIndex(prev => prev + 1);
    } else {
      setAssessmentComplete(true);
      setAssessmentStarted(false);
      setActiveTab('fingerprint');
    }
  };
  
  const handlePrevious = () => {
    if (currentElementIndex > 0) {
      setCurrentElementIndex(prev => prev - 1);
    }
  };
  
  const resetAssessment = () => {
    setAnswers({} as AssessmentAnswers);
    setAssessmentComplete(false);
    setCurrentElementIndex(0);
    setAssessmentStarted(false);
    setActiveTab('overview');
  };
  
  return (
    <div className="min-h-screen bg-background">
      <StandardNav />
      
      <div className="max-w-7xl mx-auto px-6 py-8">
        <div className="mb-8">
          <div className="flex items-center gap-2 text-sm text-muted-foreground mb-2">
            <Link href="/executive-dashboard" className="hover:text-foreground" data-testid="link-breadcrumb-dashboard">Dashboard</Link>
            <ChevronRight className="w-4 h-4" />
            <span className="text-foreground">Operating Model Alignment</span>
          </div>
          <div className="flex items-start justify-between">
            <div>
              <h1 className="text-3xl font-bold text-foreground mb-2">Operating Model Alignment</h1>
              <p className="text-muted-foreground max-w-2xl">
                Map your operating model to execution playbooks using McKinsey's 12-element "Organize to Value" framework.
              </p>
            </div>
            {assessmentComplete && (
              <Button variant="outline" onClick={resetAssessment} data-testid="button-retake-assessment">
                <RotateCcw className="w-4 h-4 mr-2" />
                Retake Assessment
              </Button>
            )}
          </div>
        </div>
        
        {assessmentStarted ? (
          <div className="max-w-2xl mx-auto">
            <div className="mb-6">
              <Progress value={((currentElementIndex + 1) / elements.length) * 100} className="h-2" />
            </div>
            <AssessmentStep
              element={elements[currentElementIndex]}
              answers={answers[elements[currentElementIndex]] || []}
              onAnswer={handleAnswer}
              onNext={handleNext}
              onPrevious={handlePrevious}
              currentIndex={currentElementIndex}
              totalElements={elements.length}
            />
          </div>
        ) : (
          <>
            <div className="grid grid-cols-4 gap-4 mb-8">
              <Card data-testid="card-alignment-score">
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
                      <BarChart3 className="w-5 h-5 text-blue-500" />
                    </div>
                    <div>
                      <p className="text-2xl font-bold" data-testid="text-alignment-score">{assessmentComplete ? `${overallScore}%` : ''}</p>
                      <p className="text-xs text-muted-foreground">Alignment Score</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
              <Card data-testid="card-priority-elements">
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-lg bg-amber-500/10 flex items-center justify-center">
                      <AlertCircle className="w-5 h-5 text-amber-500" />
                    </div>
                    <div>
                      <p className="text-2xl font-bold" data-testid="text-priority-count">{assessmentComplete ? priorityElements.length : ''}</p>
                      <p className="text-xs text-muted-foreground">Priority Elements</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
              <Card data-testid="card-recommended-playbooks">
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-lg bg-green-500/10 flex items-center justify-center">
                      <BookOpen className="w-5 h-5 text-green-500" />
                    </div>
                    <div>
                      <p className="text-2xl font-bold" data-testid="text-playbook-count">{assessmentComplete ? recommendedPlaybooks.reduce((sum, p) => sum + (p.info?.count || 0), 0) : ''}</p>
                      <p className="text-xs text-muted-foreground">Recommended Playbooks</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
              <Card data-testid="card-industry-gap">
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center">
                      <TrendingUp className="w-5 h-5 text-purple-500" />
                    </div>
                    <div>
                      <p className="text-2xl font-bold" data-testid="text-industry-gap">30%</p>
                      <p className="text-xs text-muted-foreground">Industry Gap Avg</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
            
            <Tabs value={activeTab} onValueChange={setActiveTab}>
              <TabsList className="mb-6">
                <TabsTrigger value="overview" data-testid="tab-overview">Overview</TabsTrigger>
                <TabsTrigger value="fingerprint" disabled={!assessmentComplete} data-testid="tab-fingerprint">Fingerprint</TabsTrigger>
                <TabsTrigger value="playbooks" disabled={!assessmentComplete} data-testid="tab-playbooks">Playbook Recommendations</TabsTrigger>
                <TabsTrigger value="gap" disabled={!assessmentComplete} data-testid="tab-gap">Gap Analysis</TabsTrigger>
              </TabsList>
              
              <TabsContent value="overview">
                <div className="grid lg:grid-cols-2 gap-8">
                  <Card className="border-2 border-primary/20">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <Play className="w-5 h-5 text-primary" />
                        Start Assessment
                      </CardTitle>
                      <CardDescription>
                        Answer questions about your operating model across 12 elements to generate your organizational fingerprint.
                      </CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-4 mb-6">
                        <div className="flex items-center gap-3">
                          <CheckCircle2 className="w-5 h-5 text-green-500" />
                          <span className="text-sm">12 elements, 3 questions each</span>
                        </div>
                        <div className="flex items-center gap-3">
                          <CheckCircle2 className="w-5 h-5 text-green-500" />
                          <span className="text-sm">Takes approximately 10-15 minutes</span>
                        </div>
                        <div className="flex items-center gap-3">
                          <CheckCircle2 className="w-5 h-5 text-green-500" />
                          <span className="text-sm">Generates personalized playbook recommendations</span>
                        </div>
                      </div>
                      <Button 
                        className="w-full" 
                        size="lg"
                        onClick={() => setAssessmentStarted(true)}
                        data-testid="button-begin-assessment"
                      >
                        Begin Assessment
                        <ArrowRight className="w-4 h-4 ml-2" />
                      </Button>
                    </CardContent>
                  </Card>
                  
                  <Card>
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <Lightbulb className="w-5 h-5 text-amber-500" />
                        McKinsey's 12 Elements
                      </CardTitle>
                      <CardDescription>
                        The "Organize to Value" framework transforms strategy into execution.
                      </CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-3">
                        {Object.entries(elementCategories).map(([key, category]) => (
                          <div key={key} className="flex items-center gap-3">
                            <Badge variant="outline" className={`text-${category.color}-600 border-${category.color}-200`}>
                              {category.name}
                            </Badge>
                            <span className="text-sm text-muted-foreground">
                              {category.elements.join(', ')}
                            </span>
                          </div>
                        ))}
                      </div>
                      <div className="mt-6 p-4 bg-muted/30 rounded-lg">
                        <p className="text-sm text-muted-foreground italic">
                          "Companies achieve only 70% of their strategies' potentiallargely due to operating model shortcomings."
                        </p>
                        <p className="text-xs text-muted-foreground mt-2"> McKinsey Research, 2024</p>
                      </div>
                    </CardContent>
                  </Card>
                </div>
                
                <div className="mt-8">
                  <h3 className="text-lg font-semibold mb-4">Structure Types</h3>
                  <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {structureTypes.map(structure => (
                      <Card 
                        key={structure.id}
                        className={`cursor-pointer transition-all hover:border-primary/50 ${selectedStructure === structure.id ? 'border-primary' : ''}`}
                        onClick={() => setSelectedStructure(structure.id)}
                        data-testid={`card-structure-${structure.id}`}
                      >
                        <CardContent className="p-4">
                          <div className="flex items-center justify-between mb-2">
                            <h4 className="font-medium text-sm">{structure.name}</h4>
                            <Badge variant={structure.category === 'emerging' ? 'default' : 'secondary'} className="text-xs">
                              {structure.category}
                            </Badge>
                          </div>
                          <p className="text-xs text-muted-foreground mb-3">{structure.description}</p>
                          <div className="space-y-1">
                            <div className="flex items-start gap-2">
                              <CheckCircle2 className="w-3 h-3 text-green-500 mt-0.5 shrink-0" />
                              <span className="text-xs text-muted-foreground">{structure.strengths[0]}</span>
                            </div>
                            <div className="flex items-start gap-2">
                              <AlertCircle className="w-3 h-3 text-amber-500 mt-0.5 shrink-0" />
                              <span className="text-xs text-muted-foreground">{structure.challenges[0]}</span>
                            </div>
                          </div>
                        </CardContent>
                      </Card>
                    ))}
                  </div>
                </div>
              </TabsContent>
              
              <TabsContent value="fingerprint">
                {scores && (
                  <div className="grid lg:grid-cols-2 gap-8">
                    <Card>
                      <CardHeader>
                        <CardTitle>Your Operating Model Fingerprint</CardTitle>
                        <CardDescription>
                          Current state (green) vs. target state (blue dashed)
                        </CardDescription>
                      </CardHeader>
                      <CardContent>
                        <RadarChart scores={scores} targetScores={targetScores} />
                        <div className="flex justify-center gap-6 mt-4">
                          <div className="flex items-center gap-2">
                            <div className="w-3 h-3 rounded-full bg-emerald-500" />
                            <span className="text-sm text-muted-foreground">Current</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="w-3 h-3 rounded-full bg-blue-500 border-2 border-dashed border-blue-500" />
                            <span className="text-sm text-muted-foreground">Target</span>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                    
                    <Card>
                      <CardHeader>
                        <CardTitle>Element Scores</CardTitle>
                        <CardDescription>
                          Detailed breakdown by element
                        </CardDescription>
                      </CardHeader>
                      <CardContent>
                        <div className="space-y-3">
                          {elements.map(element => {
                            const score = scores[element];
                            const Icon = elementIcons[element];
                            const elementId = element.toLowerCase().replace(/\s+/g, '-');
                            return (
                              <div key={element} className="flex items-center gap-3" data-testid={`row-element-${elementId}`}>
                                <Icon className="w-4 h-4 text-muted-foreground shrink-0" />
                                <span className="text-sm w-24 shrink-0">{element}</span>
                                <Progress value={score} className="flex-1 h-2" data-testid={`progress-${elementId}`} />
                                <span className={`text-sm font-medium w-12 text-right ${
                                  score >= 80 ? 'text-green-600' :
                                  score >= 60 ? 'text-amber-600' : 'text-red-600'
                                }`} data-testid={`score-${elementId}`}>
                                  {score}%
                                </span>
                              </div>
                            );
                          })}
                        </div>
                      </CardContent>
                    </Card>
                  </div>
                )}
              </TabsContent>
              
              <TabsContent value="playbooks">
                <div className="grid lg:grid-cols-3 gap-6">
                  <div className="lg:col-span-2">
                    <Card>
                      <CardHeader>
                        <CardTitle className="flex items-center gap-2">
                          <Zap className="w-5 h-5 text-primary" />
                          Recommended Playbook Domains
                        </CardTitle>
                        <CardDescription>
                          Based on your operating model gaps, these playbook domains will have the highest impact
                        </CardDescription>
                      </CardHeader>
                      <CardContent>
                        <div className="space-y-4">
                          {recommendedPlaybooks.map(({ domain, info, relevance }, index) => (
                            <div 
                              key={domain}
                              className="flex items-center gap-4 p-4 rounded-lg bg-muted/30 hover:bg-muted/50 transition-colors"
                              data-testid={`card-recommendation-${domain}`}
                            >
                              <div className="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold">
                                {index + 1}
                              </div>
                              <div className="flex-1">
                                <div className="flex items-center gap-2 mb-1">
                                  <h4 className="font-medium">{info?.name}</h4>
                                  <Badge variant="secondary">{info?.count} playbooks</Badge>
                                </div>
                                <p className="text-sm text-muted-foreground">{info?.description}</p>
                              </div>
                              <div className="text-right">
                                <div className="text-lg font-bold text-primary">{relevance}%</div>
                                <p className="text-xs text-muted-foreground">relevance</p>
                              </div>
                              <Link href="/playbook-library" data-testid={`link-playbook-${domain}`}>
                                <Button variant="ghost" size="sm" data-testid={`button-view-${domain}`}>
                                  <ExternalLink className="w-4 h-4" />
                                </Button>
                              </Link>
                            </div>
                          ))}
                        </div>
                      </CardContent>
                    </Card>
                  </div>
                  
                  <div>
                    <Card className="bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20">
                      <CardContent className="p-6">
                        <h3 className="font-semibold text-lg mb-2">McKinsey  M Connection</h3>
                        <p className="text-sm text-muted-foreground mb-4">
                          "McKinsey gives you the operating model fingerprint. M gives you the playbooks to execute it."
                        </p>
                        <div className="space-y-3 mb-6">
                          <div className="flex items-center gap-2">
                            <CheckCircle2 className="w-4 h-4 text-green-500" />
                            <span className="text-sm">Strategy  Execution bridge</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <CheckCircle2 className="w-4 h-4 text-green-500" />
                            <span className="text-sm">12-minute activation</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <CheckCircle2 className="w-4 h-4 text-green-500" />
                            <span className="text-sm">Pre-built playbooks</span>
                          </div>
                        </div>
                        <Link href="/playbook-library" data-testid="link-explore-playbooks">
                          <Button className="w-full" data-testid="button-explore-playbooks">
                            Explore Playbooks
                            <ArrowRight className="w-4 h-4 ml-2" />
                          </Button>
                        </Link>
                      </CardContent>
                    </Card>
                  </div>
                </div>
              </TabsContent>
              
              <TabsContent value="gap">
                {scores && (
                  <div className="space-y-6">
                    <Card>
                      <CardHeader>
                        <CardTitle>Strategy-Execution Gap Analysis</CardTitle>
                        <CardDescription>
                          Elements requiring attention to close the gap between strategy and execution
                        </CardDescription>
                      </CardHeader>
                      <CardContent>
                        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                          {priorityElements.map(element => {
                            const Icon = elementIcons[element];
                            const gap = 85 - scores[element];
                            const domains = operatingModelQuestions[element].playbookDomains;
                            return (
                              <Card key={element} className="border-amber-500/30" data-testid={`card-gap-${element.toLowerCase().replace(/\s+/g, '-')}`}>
                                <CardContent className="p-4">
                                  <div className="flex items-center gap-3 mb-3">
                                    <div className="w-10 h-10 rounded-lg bg-amber-500/10 flex items-center justify-center">
                                      <Icon className="w-5 h-5 text-amber-600" />
                                    </div>
                                    <div>
                                      <h4 className="font-medium">{element}</h4>
                                      <p className="text-xs text-muted-foreground">{gap}% gap to close</p>
                                    </div>
                                  </div>
                                  <Progress value={scores[element]} className="h-2 mb-3" />
                                  <div className="flex flex-wrap gap-1">
                                    {domains.map(domain => (
                                      <Badge key={domain} variant="outline" className="text-xs">
                                        {playbookDomainInfo[domain]?.name}
                                      </Badge>
                                    ))}
                                  </div>
                                </CardContent>
                              </Card>
                            );
                          })}
                        </div>
                        
                        {priorityElements.length === 0 && (
                          <div className="text-center py-8">
                            <CheckCircle2 className="w-12 h-12 text-green-500 mx-auto mb-3" />
                            <h3 className="font-semibold text-lg mb-2">Excellent Alignment</h3>
                            <p className="text-muted-foreground">
                              All elements are scoring above 70%. Your operating model is well-aligned.
                            </p>
                          </div>
                        )}
                      </CardContent>
                    </Card>
                    
                    <div className="grid lg:grid-cols-2 gap-6">
                      <Card>
                        <CardHeader>
                          <CardTitle className="text-lg">Quick Wins</CardTitle>
                          <CardDescription>Improvements achievable in 30 days</CardDescription>
                        </CardHeader>
                        <CardContent>
                          <div className="space-y-3">
                            <div className="flex items-start gap-3 p-3 rounded-lg bg-green-500/5">
                              <Zap className="w-5 h-5 text-green-500 mt-0.5" />
                              <div>
                                <p className="font-medium text-sm">Clarify decision rights</p>
                                <p className="text-xs text-muted-foreground">Map RACI for top 10 cross-functional processes</p>
                              </div>
                            </div>
                            <div className="flex items-start gap-3 p-3 rounded-lg bg-green-500/5">
                              <Zap className="w-5 h-5 text-green-500 mt-0.5" />
                              <div>
                                <p className="font-medium text-sm">Activate 3 priority playbooks</p>
                                <p className="text-xs text-muted-foreground">Start with highest-relevance domain recommendations</p>
                              </div>
                            </div>
                            <div className="flex items-start gap-3 p-3 rounded-lg bg-green-500/5">
                              <Zap className="w-5 h-5 text-green-500 mt-0.5" />
                              <div>
                                <p className="font-medium text-sm">Run a tabletop exercise</p>
                                <p className="text-xs text-muted-foreground">Test one playbook with executive team</p>
                              </div>
                            </div>
                          </div>
                        </CardContent>
                      </Card>
                      
                      <Card>
                        <CardHeader>
                          <CardTitle className="text-lg">Strategic Initiatives</CardTitle>
                          <CardDescription>90-day transformation roadmap</CardDescription>
                        </CardHeader>
                        <CardContent>
                          <div className="space-y-3">
                            <div className="flex items-start gap-3 p-3 rounded-lg bg-blue-500/5">
                              <Target className="w-5 h-5 text-blue-500 mt-0.5" />
                              <div>
                                <p className="font-medium text-sm">Operating model redesign</p>
                                <p className="text-xs text-muted-foreground">Address lowest-scoring elements systematically</p>
                              </div>
                            </div>
                            <div className="flex items-start gap-3 p-3 rounded-lg bg-blue-500/5">
                              <Target className="w-5 h-5 text-blue-500 mt-0.5" />
                              <div>
                                <p className="font-medium text-sm">Build playbook library</p>
                                <p className="text-xs text-muted-foreground">Customize 20+ playbooks to your context</p>
                              </div>
                            </div>
                            <div className="flex items-start gap-3 p-3 rounded-lg bg-blue-500/5">
                              <Target className="w-5 h-5 text-blue-500 mt-0.5" />
                              <div>
                                <p className="font-medium text-sm">Leadership alignment program</p>
                                <p className="text-xs text-muted-foreground">Train executives on playbook activation</p>
                              </div>
                            </div>
                          </div>
                        </CardContent>
                      </Card>
                    </div>
                  </div>
                )}
              </TabsContent>
            </Tabs>
          </>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/OperatingModelHealthReport.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Progress } from "@/components/ui/progress";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { 
  Activity, 
  Target, 
  Building2, 
  Network, 
  Crown, 
  Scale, 
  Workflow, 
  Cpu, 
  Users, 
  Award, 
  MapPin, 
  GraduationCap,
  TrendingUp,
  AlertCircle,
  CheckCircle2,
  ArrowRight
} from "lucide-react";
import { OPERATING_MODEL_ELEMENTS, OperatingModelElement, Scenario } from "@shared/scenarios";
import { scenarios } from "@shared/scenarios";

// Health score simulation data (in real app, this would come from backend analytics)
const elementHealthScores = {
  'Purpose': 82,
  'Value Agenda': 75,
  'Structure': 68,
  'Ecosystem': 71,
  'Leadership': 85,
  'Governance': 73,
  'Processes': 65,
  'Technology': 78,
  'Behaviors': 70,
  'Rewards': 62,
  'Footprint': 69,
  'Talent': 80
};

const elementIcons = {
  'Purpose': Activity,
  'Value Agenda': Target,
  'Structure': Building2,
  'Ecosystem': Network,
  'Leadership': Crown,
  'Governance': Scale,
  'Processes': Workflow,
  'Technology': Cpu,
  'Behaviors': Users,
  'Rewards': Award,
  'Footprint': MapPin,
  'Talent': GraduationCap
};

function getHealthStatus(score: number) {
  if (score >= 80) return { label: 'Excellent', color: 'bg-green-500', textColor: 'text-green-600' };
  if (score >= 70) return { label: 'Good', color: 'bg-blue-500', textColor: 'text-blue-600' };
  if (score >= 60) return { label: 'Fair', color: 'bg-yellow-500', textColor: 'text-yellow-600' };
  return { label: 'Needs Attention', color: 'bg-red-500', textColor: 'text-red-600' };
}

function getElementActivationCount(elementId: OperatingModelElement) {
  return scenarios.filter((s: Scenario) => s.elementsActivated?.includes(elementId)).length;
}

export default function OperatingModelHealthReport() {
  const overallScore = Math.round(
    Object.values(elementHealthScores).reduce((a, b) => a + b, 0) / 
    Object.values(elementHealthScores).length
  );
  
  const excellentCount = Object.values(elementHealthScores).filter(s => s >= 80).length;
  const needsAttentionCount = Object.values(elementHealthScores).filter(s => s < 60).length;

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800">
      <div className="container mx-auto px-6 py-8">
        {/* Header */}
        <div className="mb-8">
          <div className="flex items-center gap-3 mb-4">
            <div className="h-12 w-12 rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 flex items-center justify-center">
              <Activity className="h-6 w-6 text-white" />
            </div>
            <div>
              <h1 className="text-4xl font-bold text-slate-900 dark:text-white">
                Operating Model Health Report
              </h1>
              <p className="text-lg text-slate-600 dark:text-slate-400">
                McKinsey's 12 Elements Framework Assessment
              </p>
            </div>
          </div>
        </div>

        {/* Overall Health Score */}
        <Card className="mb-8 border-2 shadow-lg bg-white dark:bg-slate-800">
          <CardHeader>
            <CardTitle className="text-2xl">Organization Readiness Score</CardTitle>
            <CardDescription>
              Composite health across all 12 Operating Model Elements
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="grid md:grid-cols-2 gap-8">
              <div>
                <div className="flex items-center justify-between mb-4">
                  <span className="text-6xl font-bold text-slate-900 dark:text-white">
                    {overallScore}
                    <span className="text-3xl text-slate-500 dark:text-slate-400">/100</span>
                  </span>
                  <Badge className={`${getHealthStatus(overallScore).color} text-white text-lg px-4 py-2`}>
                    {getHealthStatus(overallScore).label}
                  </Badge>
                </div>
                <Progress value={overallScore} className="h-3 mb-6" data-testid="progress-overall-score" />
                <div className="grid grid-cols-3 gap-4 text-center">
                  <div>
                    <div className="text-3xl font-bold text-green-600" data-testid="text-excellent-count">{excellentCount}</div>
                    <div className="text-sm text-slate-600 dark:text-slate-400">Excellent</div>
                  </div>
                  <div>
                    <div className="text-3xl font-bold text-blue-600" data-testid="text-good-count">
                      {Object.values(elementHealthScores).filter(s => s >= 70 && s < 80).length}
                    </div>
                    <div className="text-sm text-slate-600 dark:text-slate-400">Good</div>
                  </div>
                  <div>
                    <div className="text-3xl font-bold text-yellow-600" data-testid="text-needs-attention-count">{needsAttentionCount}</div>
                    <div className="text-sm text-slate-600 dark:text-slate-400">Needs Focus</div>
                  </div>
                </div>
              </div>
              <div className="card-bg rounded-lg p-6">
                <h3 className="font-semibold text-lg mb-4 flex items-center gap-2">
                  <TrendingUp className="h-5 w-5 text-blue-600" />
                  Key Insights
                </h3>
                <ul className="space-y-3 text-sm">
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="h-5 w-5 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>Leadership and Purpose are your strongest elements, driving strategic clarity</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <AlertCircle className="h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0" />
                    <span>Rewards and Processes need improvement to unlock full transformation potential</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <TrendingUp className="h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0" />
                    <span>Technology investments are paying off with 78% health score</span>
                  </li>
                </ul>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Elements Grid */}
        <Tabs defaultValue="all" className="mb-8">
          <TabsList className="mb-6">
            <TabsTrigger value="all" data-testid="tab-all-elements">All Elements (12)</TabsTrigger>
            <TabsTrigger value="strong" data-testid="tab-strong">Strong ({excellentCount})</TabsTrigger>
            <TabsTrigger value="focus" data-testid="tab-focus">Needs Focus ({needsAttentionCount})</TabsTrigger>
          </TabsList>

          <TabsContent value="all">
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              {OPERATING_MODEL_ELEMENTS.map((element) => {
                const score = elementHealthScores[element.id as keyof typeof elementHealthScores];
                const status = getHealthStatus(score);
                const Icon = elementIcons[element.id as keyof typeof elementIcons];
                const activationCount = getElementActivationCount(element.id);

                return (
                  <Card 
                    key={element.id} 
                    className="hover:shadow-lg transition-shadow duration-200 bg-white dark:bg-slate-800"
                    data-testid={`card-element-${element.id.toLowerCase().replace(' ', '-')}`}
                  >
                    <CardHeader>
                      <div className="flex items-start justify-between mb-2">
                        <div className={`h-10 w-10 rounded-lg ${status.color} bg-opacity-10 flex items-center justify-center`}>
                          <Icon className={`h-5 w-5 ${status.textColor}`} />
                        </div>
                        <Badge className={`${status.color} text-white`}>
                          {score}
                        </Badge>
                      </div>
                      <CardTitle className="text-lg">{element.id}</CardTitle>
                      <CardDescription>{element.description}</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <Progress value={score} className="mb-4 h-2" />
                      <div className="flex items-center justify-between text-sm">
                        <span className="text-slate-600 dark:text-slate-400">
                          Status: <span className={`font-semibold ${status.textColor}`}>{status.label}</span>
                        </span>
                        <span className="text-slate-600 dark:text-slate-400">
                          {activationCount} scenarios
                        </span>
                      </div>
                    </CardContent>
                  </Card>
                );
              })}
            </div>
          </TabsContent>

          <TabsContent value="strong">
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              {OPERATING_MODEL_ELEMENTS.filter((element: { id: OperatingModelElement; description: string }) => 
                elementHealthScores[element.id as keyof typeof elementHealthScores] >= 80
              ).map((element) => {
                const score = elementHealthScores[element.id as keyof typeof elementHealthScores];
                const status = getHealthStatus(score);
                const Icon = elementIcons[element.id as keyof typeof elementIcons];
                const activationCount = getElementActivationCount(element.id);

                return (
                  <Card 
                    key={element.id} 
                    className="hover:shadow-lg transition-shadow duration-200 bg-white dark:bg-slate-800"
                    data-testid={`card-strong-${element.id.toLowerCase().replace(' ', '-')}`}
                  >
                    <CardHeader>
                      <div className="flex items-start justify-between mb-2">
                        <div className={`h-10 w-10 rounded-lg ${status.color} bg-opacity-10 flex items-center justify-center`}>
                          <Icon className={`h-5 w-5 ${status.textColor}`} />
                        </div>
                        <Badge className={`${status.color} text-white`}>
                          {score}
                        </Badge>
                      </div>
                      <CardTitle className="text-lg">{element.id}</CardTitle>
                      <CardDescription>{element.description}</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <Progress value={score} className="mb-4 h-2" />
                      <div className="flex items-center justify-between text-sm">
                        <span className="text-slate-600 dark:text-slate-400">
                          Status: <span className={`font-semibold ${status.textColor}`}>{status.label}</span>
                        </span>
                        <span className="text-slate-600 dark:text-slate-400">
                          {activationCount} scenarios
                        </span>
                      </div>
                    </CardContent>
                  </Card>
                );
              })}
            </div>
          </TabsContent>

          <TabsContent value="focus">
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              {OPERATING_MODEL_ELEMENTS.filter((element: { id: OperatingModelElement; description: string }) => 
                elementHealthScores[element.id as keyof typeof elementHealthScores] < 60
              ).map((element) => {
                const score = elementHealthScores[element.id as keyof typeof elementHealthScores];
                const status = getHealthStatus(score);
                const Icon = elementIcons[element.id as keyof typeof elementIcons];
                const activationCount = getElementActivationCount(element.id);

                return (
                  <Card 
                    key={element.id} 
                    className="hover:shadow-lg transition-shadow duration-200 bg-white dark:bg-slate-800 border-red-200 dark:border-red-900"
                    data-testid={`card-focus-${element.id.toLowerCase().replace(' ', '-')}`}
                  >
                    <CardHeader>
                      <div className="flex items-start justify-between mb-2">
                        <div className={`h-10 w-10 rounded-lg ${status.color} bg-opacity-10 flex items-center justify-center`}>
                          <Icon className={`h-5 w-5 ${status.textColor}`} />
                        </div>
                        <Badge className={`${status.color} text-white`}>
                          {score}
                        </Badge>
                      </div>
                      <CardTitle className="text-lg">{element.id}</CardTitle>
                      <CardDescription>{element.description}</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <Progress value={score} className="mb-4 h-2" />
                      <div className="flex items-center justify-between text-sm mb-4">
                        <span className="text-slate-600 dark:text-slate-400">
                          Status: <span className={`font-semibold ${status.textColor}`}>{status.label}</span>
                        </span>
                        <span className="text-slate-600 dark:text-slate-400">
                          {activationCount} scenarios
                        </span>
                      </div>
                      <Button 
                        size="sm" 
                        variant="outline" 
                        className="w-full"
                        data-testid={`button-improve-${element.id.toLowerCase().replace(' ', '-')}`}
                      >
                        View Improvement Plan
                        <ArrowRight className="h-4 w-4 ml-2" />
                      </Button>
                    </CardContent>
                  </Card>
                );
              })}
            </div>
          </TabsContent>
        </Tabs>

        {/* Recommendations Section */}
        <Card className="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-slate-800 dark:to-slate-900 border-2">
          <CardHeader>
            <CardTitle className="text-2xl flex items-center gap-2">
              <TrendingUp className="h-6 w-6 text-blue-600" />
              Strategic Recommendations
            </CardTitle>
            <CardDescription>
              Prioritized actions to strengthen your operating model
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              <div className="bg-white dark:bg-slate-800 rounded-lg p-4 border-l-4 border-red-500">
                <div className="flex items-start gap-3">
                  <AlertCircle className="h-5 w-5 text-red-600 mt-0.5 flex-shrink-0" />
                  <div>
                    <h4 className="font-semibold text-lg mb-1">Priority 1: Strengthen Rewards System</h4>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-2">
                      Current score: 62. Misaligned incentives are limiting transformation velocity.
                    </p>
                    <p className="text-sm text-slate-700 dark:text-slate-300">
                      <strong>Action:</strong> Launch the Organizational Restructuring scenario to redesign rewards 
                      to align with strategic outcomes. Expected improvement: +15 points in 90 days.
                    </p>
                  </div>
                </div>
              </div>

              <div className="bg-white dark:bg-slate-800 rounded-lg p-4 border-l-4 border-yellow-500">
                <div className="flex items-start gap-3">
                  <AlertCircle className="h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0" />
                  <div>
                    <h4 className="font-semibold text-lg mb-1">Priority 2: Optimize Core Processes</h4>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-2">
                      Current score: 65. Process inefficiencies are creating execution drag.
                    </p>
                    <p className="text-sm text-slate-700 dark:text-slate-300">
                      <strong>Action:</strong> Activate the Process Improvement playbook to streamline workflows 
                      and eliminate bottlenecks. Expected ROI: $8M annually.
                    </p>
                  </div>
                </div>
              </div>

              <div className="bg-white dark:bg-slate-800 rounded-lg p-4 border-l-4 border-green-500">
                <div className="flex items-start gap-3">
                  <CheckCircle2 className="h-5 w-5 text-green-600 mt-0.5 flex-shrink-0" />
                  <div>
                    <h4 className="font-semibold text-lg mb-1">Opportunity: Leverage Leadership Strength</h4>
                    <p className="text-sm text-slate-600 dark:text-slate-400 mb-2">
                      Current score: 85. Strong leadership is your competitive advantage.
                    </p>
                    <p className="text-sm text-slate-700 dark:text-slate-300">
                      <strong>Action:</strong> Use your leadership strength to drive Culture Transformation 
                      and cascade strategic clarity across the organization.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/OrganizationSetup.tsx
========================================
import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Textarea } from '@/components/ui/textarea';
import { Switch } from '@/components/ui/switch';
import { Progress } from '@/components/ui/progress';
import { Separator } from '@/components/ui/separator';
import { useToast } from '@/hooks/use-toast';
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
import { apiRequest } from '@/lib/queryClient';
import { Link } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import { 
  Building2,
  Users,
  UserCircle,
  Network,
  Settings,
  Plus,
  Edit,
  Trash2,
  Check,
  ChevronRight,
  Mail,
  MessageSquare,
  Shield,
  Clock,
  DollarSign,
  ArrowLeft,
  Home,
  Save,
  AlertTriangle,
  CheckCircle,
  Workflow,
  Layers
} from 'lucide-react';

interface Department {
  id: string;
  name: string;
  description?: string;
  parentDepartmentId?: string;
  leaderId?: string;
  leaderName?: string;
  budget?: number;
  headcount?: number;
  costCenter?: string;
}

interface Stakeholder {
  id: string;
  name: string;
  email: string;
  role: string;
  department: string;
  approvalLimit?: number;
  canApproveActivations: boolean;
  notificationPreferences: {
    email: boolean;
    slack: boolean;
    inApp: boolean;
  };
}

interface EscalationPolicy {
  id: string;
  name: string;
  description?: string;
  triggerType: string;
  levels: Array<{
    level: number;
    approvers: string[];
    timeoutMinutes: number;
    actions: string[];
  }>;
}

interface CommunicationChannel {
  id: string;
  channelType: 'email' | 'slack' | 'teams' | 'webhook';
  name: string;
  configuration: Record<string, any>;
  isDefault: boolean;
  isActive: boolean;
}

export default function OrganizationSetup() {
  const { toast } = useToast();
  const queryClient = useQueryClient();
  const [activeTab, setActiveTab] = useState('departments');
  
  // Dialog states
  const [isDepartmentDialogOpen, setIsDepartmentDialogOpen] = useState(false);
  const [isStakeholderDialogOpen, setIsStakeholderDialogOpen] = useState(false);
  const [isEscalationDialogOpen, setIsEscalationDialogOpen] = useState(false);
  const [isChannelDialogOpen, setIsChannelDialogOpen] = useState(false);
  
  // Form states for departments
  const [newDepartment, setNewDepartment] = useState<Partial<Department>>({
    name: '',
    description: '',
  });
  
  // Form states for stakeholders
  const [newStakeholder, setNewStakeholder] = useState<Partial<Stakeholder>>({
    name: '',
    email: '',
    role: '',
    department: '',
    canApproveActivations: false,
    notificationPreferences: { email: true, slack: false, inApp: true },
  });
  
  // Form states for escalation
  const [newEscalation, setNewEscalation] = useState<Partial<EscalationPolicy>>({
    name: '',
    description: '',
    triggerType: 'time_elapsed',
    levels: [{ level: 1, approvers: [], timeoutMinutes: 30, actions: ['email'] }],
  });
  
  // Form states for channels
  const [newChannel, setNewChannel] = useState<Partial<CommunicationChannel>>({
    channelType: 'email',
    name: '',
    configuration: {},
    isDefault: false,
    isActive: true,
  });
  
  // Fetch departments from API
  const { data: apiDepartments, isLoading: deptLoading } = useQuery<any[]>({
    queryKey: ['/api/config/departments'],
  });
  
  // Default departments - empty to prompt user configuration
  const defaultDepartments: Department[] = [];
  
  // Use API data if available, otherwise use defaults
  const departments: Department[] = (apiDepartments && apiDepartments.length > 0) 
    ? apiDepartments.map((d: any) => ({
        id: d.id?.toString() || d.id,
        name: d.name,
        description: d.description,
        parentDepartmentId: d.parent_department_id || d.parentDepartmentId,
        leaderId: d.leader_id || d.leaderId,
        leaderName: d.leader_name || d.leaderName,
        budget: d.budget,
        headcount: d.headcount,
        costCenter: d.cost_center || d.costCenter,
      }))
    : defaultDepartments;
  
  // Create department mutation
  const createDeptMutation = useMutation({
    mutationFn: async (dept: Partial<Department>) => {
      return apiRequest('POST', '/api/config/departments', dept);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/config/departments'] });
      toast({ title: 'Success', description: 'Department created successfully' });
      setIsDepartmentDialogOpen(false);
      setNewDepartment({ name: '', description: '' });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to create department', variant: 'destructive' });
    },
  });
  
  // Delete department mutation
  const deleteDeptMutation = useMutation({
    mutationFn: async (id: string) => {
      return apiRequest('DELETE', `/api/config/departments/${id}`);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/config/departments'] });
      toast({ title: 'Deleted', description: 'Department removed' });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to delete department', variant: 'destructive' });
    },
  });
  
  // Stakeholders - empty by default, prompting user to add their own
  const stakeholders: Stakeholder[] = [];
  
  // Fetch escalation policies from API
  const { data: apiEscalationPolicies } = useQuery<any[]>({
    queryKey: ['/api/config/escalation-policies'],
  });
  
  // Default escalation policies
  const defaultEscalationPolicies: EscalationPolicy[] = [
    { 
      id: '1', 
      name: 'Standard Escalation', 
      description: 'Default escalation for non-critical issues',
      triggerType: 'time_elapsed',
      levels: [
        { level: 1, approvers: ['Manager'], timeoutMinutes: 60, actions: ['email'] },
        { level: 2, approvers: ['Director'], timeoutMinutes: 120, actions: ['email', 'slack'] },
        { level: 3, approvers: ['VP'], timeoutMinutes: 240, actions: ['email', 'slack', 'phone'] },
      ]
    },
    { 
      id: '2', 
      name: 'Critical Response', 
      description: 'Fast escalation for critical issues',
      triggerType: 'severity_escalation',
      levels: [
        { level: 1, approvers: ['Director'], timeoutMinutes: 15, actions: ['email', 'slack'] },
        { level: 2, approvers: ['VP', 'C-Suite'], timeoutMinutes: 30, actions: ['email', 'slack', 'phone'] },
      ]
    },
  ];
  
  // Use API data if available, otherwise use defaults
  const escalationPolicies: EscalationPolicy[] = (apiEscalationPolicies && apiEscalationPolicies.length > 0)
    ? apiEscalationPolicies.map((e: any) => ({
        id: e.id?.toString() || e.id,
        name: e.name,
        description: e.description,
        triggerType: e.trigger_type || e.triggerType || 'time_elapsed',
        levels: e.levels || [],
      }))
    : defaultEscalationPolicies;
  
  // Create escalation policy mutation
  const createEscalationMutation = useMutation({
    mutationFn: async (policy: Partial<EscalationPolicy>) => {
      return apiRequest('POST', '/api/config/escalation-policies', policy);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/config/escalation-policies'] });
      toast({ title: 'Success', description: 'Escalation policy created successfully' });
      setIsEscalationDialogOpen(false);
      setNewEscalation({ name: '', description: '', triggerType: 'time_elapsed', levels: [] });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to create escalation policy', variant: 'destructive' });
    },
  });
  
  // Delete escalation policy mutation
  const deleteEscalationMutation = useMutation({
    mutationFn: async (id: string) => {
      return apiRequest('DELETE', `/api/config/escalation-policies/${id}`);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/config/escalation-policies'] });
      toast({ title: 'Deleted', description: 'Escalation policy removed' });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to delete escalation policy', variant: 'destructive' });
    },
  });
  
  // Fetch communication channels from API
  const { data: apiChannels } = useQuery<any[]>({
    queryKey: ['/api/config/communication-channels'],
  });
  
  // Default communication channels
  const defaultChannels: CommunicationChannel[] = [
    { id: '1', channelType: 'email', name: 'Corporate Email', configuration: { smtpServer: 'smtp.company.com' }, isDefault: true, isActive: true },
    { id: '2', channelType: 'slack', name: 'Slack - Crisis Channel', configuration: { webhookUrl: 'https://hooks.slack.com/...' }, isDefault: false, isActive: true },
    { id: '3', channelType: 'teams', name: 'MS Teams - Leadership', configuration: { webhookUrl: 'https://outlook.office.com/...' }, isDefault: false, isActive: true },
  ];
  
  // Use API data if available, otherwise use defaults
  const communicationChannels: CommunicationChannel[] = (apiChannels && apiChannels.length > 0)
    ? apiChannels.map((c: any) => ({
        id: c.id?.toString() || c.id,
        channelType: c.channel_type || c.channelType || 'email',
        name: c.name,
        configuration: c.configuration || {},
        isDefault: c.is_default ?? c.isDefault ?? false,
        isActive: c.is_active ?? c.isActive ?? true,
      }))
    : defaultChannels;
  
  // Create channel mutation
  const createChannelMutation = useMutation({
    mutationFn: async (channel: Partial<CommunicationChannel>) => {
      return apiRequest('POST', '/api/config/communication-channels', channel);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/config/communication-channels'] });
      toast({ title: 'Success', description: 'Communication channel added successfully' });
      setIsChannelDialogOpen(false);
      setNewChannel({ channelType: 'email', name: '', configuration: {}, isDefault: false, isActive: true });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to add communication channel', variant: 'destructive' });
    },
  });
  
  // Delete channel mutation
  const deleteChannelMutation = useMutation({
    mutationFn: async (id: string) => {
      return apiRequest('DELETE', `/api/config/communication-channels/${id}`);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/config/communication-channels'] });
      toast({ title: 'Deleted', description: 'Communication channel removed' });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to delete communication channel', variant: 'destructive' });
    },
  });
  
  // Handler functions that use mutations
  const handleAddDepartment = () => {
    if (!newDepartment.name) {
      toast({ title: 'Error', description: 'Department name is required', variant: 'destructive' });
      return;
    }
    createDeptMutation.mutate(newDepartment);
  };
  
  const handleDeleteDepartment = (id: string) => {
    deleteDeptMutation.mutate(id);
  };
  
  const handleAddEscalationPolicy = () => {
    if (!newEscalation.name) {
      toast({ title: 'Error', description: 'Policy name is required', variant: 'destructive' });
      return;
    }
    createEscalationMutation.mutate(newEscalation);
  };
  
  const handleDeleteEscalationPolicy = (id: string) => {
    deleteEscalationMutation.mutate(id);
  };
  
  const handleAddChannel = () => {
    if (!newChannel.name) {
      toast({ title: 'Error', description: 'Channel name is required', variant: 'destructive' });
      return;
    }
    createChannelMutation.mutate(newChannel);
  };
  
  const handleDeleteChannel = (id: string) => {
    deleteChannelMutation.mutate(id);
  };
  
  
  // Calculate setup progress
  const setupProgress = {
    departments: departments.length >= 3,
    stakeholders: stakeholders.length >= 3,
    escalation: escalationPolicies.length >= 1,
    channels: communicationChannels.length >= 2,
  };
  const progressPercent = (Object.values(setupProgress).filter(Boolean).length / 4) * 100;
  
  // Handler for adding stakeholder (local state for now)
  const handleAddStakeholder = () => {
    if (!newStakeholder.name || !newStakeholder.email) {
      toast({ title: 'Error', description: 'Name and email are required', variant: 'destructive' });
      return;
    }
    toast({ title: 'Success', description: 'Stakeholder added successfully' });
    setNewStakeholder({ name: '', email: '', role: '', department: '', canApproveActivations: false, notificationPreferences: { email: true, slack: false, inApp: true } });
    setIsStakeholderDialogOpen(false);
  };
  
  const getChannelIcon = (type: string) => {
    switch (type) {
      case 'email': return <Mail className="h-4 w-4" />;
      case 'slack': return <MessageSquare className="h-4 w-4" />;
      case 'teams': return <Users className="h-4 w-4" />;
      case 'webhook': return <Network className="h-4 w-4" />;
      default: return <Mail className="h-4 w-4" />;
    }
  };

  return (
    <PageLayout>
      <div className="page-background min-h-screen bg-transparent p-6">
        <div className="max-w-7xl mx-auto space-y-8">
          
          {/* Breadcrumb Navigation */}
          <div className="mb-6">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>Configuration</span>
              <span>/</span>
              <span className="text-white">Organization Setup</span>
            </div>
          </div>

          {/* Header */}
          <div className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6 rounded-lg">
            <div className="flex items-center justify-between">
              <div className="flex items-center space-x-4">
                <div className="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                  <Building2 className="w-7 h-7 text-white" />
                </div>
                <div>
                  <h1 className="text-3xl font-bold" data-testid="org-setup-title">Organization Setup</h1>
                  <p className="text-indigo-100 mt-1">Configure YOUR team structure, stakeholders, and approval workflows</p>
                  <p className="text-indigo-200 mt-1 text-sm">M will use these settings to coordinate execution across your organization</p>
                </div>
              </div>
              <div className="flex items-center gap-4">
                <Link to="/">
                  <Button variant="secondary" className="bg-indigo-700 hover:bg-indigo-800 text-indigo-100 border-indigo-600">
                    <ArrowLeft className="h-4 w-4 mr-2" />
                    Dashboard
                  </Button>
                </Link>
              </div>
            </div>
          </div>

          {/* Setup Progress */}
          <Card className="border-indigo-500/30 bg-indigo-950/20">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <div>
                  <h3 className="text-lg font-semibold text-white">Setup Progress</h3>
                  <p className="text-sm text-gray-400">Complete all sections to enable full strategic execution capabilities</p>
                </div>
                <div className="text-right">
                  <div className="text-3xl font-bold text-indigo-400">{Math.round(progressPercent)}%</div>
                  <div className="text-sm text-gray-400">Complete</div>
                </div>
              </div>
              <Progress value={progressPercent} className="h-3 mb-4" />
              <div className="grid grid-cols-4 gap-4">
                <div className={`flex items-center gap-2 p-3 rounded-lg ${setupProgress.departments ? 'bg-green-500/20' : 'bg-gray-700/30'}`}>
                  {setupProgress.departments ? <CheckCircle className="h-5 w-5 text-green-500" /> : <AlertTriangle className="h-5 w-5 text-yellow-500" />}
                  <span className="text-sm text-white">Departments</span>
                </div>
                <div className={`flex items-center gap-2 p-3 rounded-lg ${setupProgress.stakeholders ? 'bg-green-500/20' : 'bg-gray-700/30'}`}>
                  {setupProgress.stakeholders ? <CheckCircle className="h-5 w-5 text-green-500" /> : <AlertTriangle className="h-5 w-5 text-yellow-500" />}
                  <span className="text-sm text-white">Stakeholders</span>
                </div>
                <div className={`flex items-center gap-2 p-3 rounded-lg ${setupProgress.escalation ? 'bg-green-500/20' : 'bg-gray-700/30'}`}>
                  {setupProgress.escalation ? <CheckCircle className="h-5 w-5 text-green-500" /> : <AlertTriangle className="h-5 w-5 text-yellow-500" />}
                  <span className="text-sm text-white">Escalation</span>
                </div>
                <div className={`flex items-center gap-2 p-3 rounded-lg ${setupProgress.channels ? 'bg-green-500/20' : 'bg-gray-700/30'}`}>
                  {setupProgress.channels ? <CheckCircle className="h-5 w-5 text-green-500" /> : <AlertTriangle className="h-5 w-5 text-yellow-500" />}
                  <span className="text-sm text-white">Channels</span>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Main Content Tabs */}
          <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
            <TabsList className="bg-gray-800/50 p-1 h-auto flex-wrap">
              <TabsTrigger value="departments" className="gap-2 data-[state=active]:bg-indigo-600">
                <Layers className="h-4 w-4" />
                Departments
              </TabsTrigger>
              <TabsTrigger value="stakeholders" className="gap-2 data-[state=active]:bg-indigo-600">
                <Users className="h-4 w-4" />
                Stakeholders
              </TabsTrigger>
              <TabsTrigger value="escalation" className="gap-2 data-[state=active]:bg-indigo-600">
                <Workflow className="h-4 w-4" />
                Escalation Policies
              </TabsTrigger>
              <TabsTrigger value="channels" className="gap-2 data-[state=active]:bg-indigo-600">
                <MessageSquare className="h-4 w-4" />
                Communication Channels
              </TabsTrigger>
            </TabsList>

            {/* Departments Tab */}
            <TabsContent value="departments" className="space-y-6">
              <div className="flex items-center justify-between">
                <div>
                  <h2 className="text-xl font-semibold text-white">Department Structure</h2>
                  <p className="text-sm text-gray-400">Define your organization's departments and reporting structure</p>
                </div>
                <Button onClick={() => setIsDepartmentDialogOpen(true)} data-testid="button-add-department">
                  <Plus className="h-4 w-4 mr-2" />
                  Add Department
                </Button>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {departments.map((dept) => (
                  <Card key={dept.id} className="bg-gray-800/50 border-gray-700 hover:border-indigo-500/50 transition-all">
                    <CardContent className="p-4">
                      <div className="flex items-start justify-between">
                        <div>
                          <h3 className="font-semibold text-white">{dept.name}</h3>
                          <p className="text-sm text-gray-400 mt-1">{dept.description}</p>
                        </div>
                        <div className="flex gap-1">
                          <Button variant="ghost" size="icon" className="h-8 w-8 text-gray-400 hover:text-white">
                            <Edit className="h-4 w-4" />
                          </Button>
                          <Button variant="ghost" size="icon" className="h-8 w-8 text-gray-400 hover:text-red-500">
                            <Trash2 className="h-4 w-4" />
                          </Button>
                        </div>
                      </div>
                      <div className="mt-4 flex items-center gap-4 text-sm">
                        {dept.headcount && (
                          <div className="flex items-center gap-1 text-gray-400">
                            <Users className="h-4 w-4" />
                            <span>{dept.headcount}</span>
                          </div>
                        )}
                        {dept.leaderName && (
                          <div className="flex items-center gap-1 text-gray-400">
                            <UserCircle className="h-4 w-4" />
                            <span>{dept.leaderName}</span>
                          </div>
                        )}
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </TabsContent>

            {/* Stakeholders Tab */}
            <TabsContent value="stakeholders" className="space-y-6">
              <div className="flex items-center justify-between">
                <div>
                  <h2 className="text-xl font-semibold text-white">Key Stakeholders</h2>
                  <p className="text-sm text-gray-400">Define executives and decision-makers for playbook coordination</p>
                </div>
                <Button onClick={() => setIsStakeholderDialogOpen(true)} data-testid="button-add-stakeholder">
                  <Plus className="h-4 w-4 mr-2" />
                  Add Stakeholder
                </Button>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {stakeholders.map((sh) => (
                  <Card key={sh.id} className="bg-gray-800/50 border-gray-700 hover:border-indigo-500/50 transition-all">
                    <CardContent className="p-4">
                      <div className="flex items-start justify-between">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-medium">
                            {sh.name.split(' ').map(n => n[0]).join('')}
                          </div>
                          <div>
                            <h3 className="font-semibold text-white">{sh.name}</h3>
                            <p className="text-sm text-indigo-400">{sh.role}</p>
                          </div>
                        </div>
                        <div className="flex gap-1">
                          <Button variant="ghost" size="icon" className="h-8 w-8 text-gray-400 hover:text-white">
                            <Edit className="h-4 w-4" />
                          </Button>
                        </div>
                      </div>
                      <div className="mt-4 space-y-2">
                        <div className="flex items-center gap-2 text-sm text-gray-400">
                          <Mail className="h-4 w-4" />
                          <span>{sh.email}</span>
                        </div>
                        <div className="flex items-center gap-2 text-sm text-gray-400">
                          <Building2 className="h-4 w-4" />
                          <span>{sh.department}</span>
                        </div>
                        {sh.approvalLimit && (
                          <div className="flex items-center gap-2 text-sm text-gray-400">
                            <DollarSign className="h-4 w-4" />
                            <span>Approval limit: ${sh.approvalLimit.toLocaleString()}</span>
                          </div>
                        )}
                      </div>
                      <div className="mt-4 flex items-center gap-2">
                        {sh.canApproveActivations && (
                          <Badge className="bg-green-500/20 text-green-400 border-green-500/30">
                            Can Approve Activations
                          </Badge>
                        )}
                        <div className="flex gap-1">
                          {sh.notificationPreferences.email && <Badge variant="outline" className="text-xs">Email</Badge>}
                          {sh.notificationPreferences.slack && <Badge variant="outline" className="text-xs">Slack</Badge>}
                          {sh.notificationPreferences.inApp && <Badge variant="outline" className="text-xs">In-App</Badge>}
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </TabsContent>

            {/* Escalation Policies Tab */}
            <TabsContent value="escalation" className="space-y-6">
              <div className="flex items-center justify-between">
                <div>
                  <h2 className="text-xl font-semibold text-white">Escalation Policies</h2>
                  <p className="text-sm text-gray-400">Define how unacknowledged alerts escalate through your organization</p>
                </div>
                <Button onClick={() => setIsEscalationDialogOpen(true)} data-testid="button-add-escalation">
                  <Plus className="h-4 w-4 mr-2" />
                  Add Policy
                </Button>
              </div>
              
              <div className="space-y-4">
                {escalationPolicies.map((policy) => (
                  <Card key={policy.id} className="bg-gray-800/50 border-gray-700">
                    <CardContent className="p-6">
                      <div className="flex items-start justify-between mb-4">
                        <div>
                          <h3 className="font-semibold text-white text-lg">{policy.name}</h3>
                          <p className="text-sm text-gray-400 mt-1">{policy.description}</p>
                          <Badge className="mt-2 bg-indigo-500/20 text-indigo-400 border-indigo-500/30">
                            {policy.triggerType.replace('_', ' ')}
                          </Badge>
                        </div>
                        <div className="flex gap-1">
                          <Button variant="ghost" size="icon" className="h-8 w-8 text-gray-400 hover:text-white">
                            <Edit className="h-4 w-4" />
                          </Button>
                          <Button variant="ghost" size="icon" className="h-8 w-8 text-gray-400 hover:text-red-500">
                            <Trash2 className="h-4 w-4" />
                          </Button>
                        </div>
                      </div>
                      
                      <div className="relative">
                        <div className="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-700"></div>
                        <div className="space-y-4">
                          {policy.levels.map((level, idx) => (
                            <div key={level.level} className="relative flex items-start gap-4 pl-8">
                              <div className={`absolute left-2 w-4 h-4 rounded-full ${
                                idx === 0 ? 'bg-green-500' : idx === 1 ? 'bg-yellow-500' : 'bg-red-500'
                              } ring-4 ring-gray-800`}></div>
                              <div className="flex-1 p-3 bg-gray-700/50 rounded-lg">
                                <div className="flex items-center justify-between">
                                  <span className="font-medium text-white">Level {level.level}</span>
                                  <div className="flex items-center gap-1 text-sm text-gray-400">
                                    <Clock className="h-4 w-4" />
                                    <span>{level.timeoutMinutes} min</span>
                                  </div>
                                </div>
                                <div className="mt-2 flex items-center gap-2">
                                  <span className="text-sm text-gray-400">Approvers:</span>
                                  {level.approvers.map((approver) => (
                                    <Badge key={approver} variant="outline" className="text-xs">
                                      {approver}
                                    </Badge>
                                  ))}
                                </div>
                                <div className="mt-2 flex items-center gap-2">
                                  <span className="text-sm text-gray-400">Actions:</span>
                                  {level.actions.map((action) => (
                                    <Badge key={action} className="text-xs bg-blue-500/20 text-blue-400 border-blue-500/30">
                                      {action}
                                    </Badge>
                                  ))}
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </TabsContent>

            {/* Communication Channels Tab */}
            <TabsContent value="channels" className="space-y-6">
              <div className="flex items-center justify-between">
                <div>
                  <h2 className="text-xl font-semibold text-white">Communication Channels</h2>
                  <p className="text-sm text-gray-400">Configure how M will notify stakeholders during activations</p>
                </div>
                <Button onClick={() => setIsChannelDialogOpen(true)} data-testid="button-add-channel">
                  <Plus className="h-4 w-4 mr-2" />
                  Add Channel
                </Button>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {communicationChannels.map((channel) => (
                  <Card key={channel.id} className={`bg-gray-800/50 border-gray-700 ${channel.isActive ? '' : 'opacity-50'}`}>
                    <CardContent className="p-4">
                      <div className="flex items-start justify-between">
                        <div className="flex items-center gap-3">
                          <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${
                            channel.channelType === 'email' ? 'bg-blue-500/20 text-blue-400' :
                            channel.channelType === 'slack' ? 'bg-purple-500/20 text-purple-400' :
                            channel.channelType === 'teams' ? 'bg-indigo-500/20 text-indigo-400' :
                            'bg-orange-500/20 text-orange-400'
                          }`}>
                            {getChannelIcon(channel.channelType)}
                          </div>
                          <div>
                            <h3 className="font-semibold text-white">{channel.name}</h3>
                            <p className="text-sm text-gray-400 capitalize">{channel.channelType}</p>
                          </div>
                        </div>
                        <div className="flex items-center gap-2">
                          {channel.isDefault && (
                            <Badge className="bg-green-500/20 text-green-400 border-green-500/30">
                              Default
                            </Badge>
                          )}
                          <Switch checked={channel.isActive} />
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </TabsContent>
          </Tabs>

          {/* Add Department Dialog */}
          <Dialog open={isDepartmentDialogOpen} onOpenChange={setIsDepartmentDialogOpen}>
            <DialogContent className="max-w-md">
              <DialogHeader>
                <DialogTitle>Add Department</DialogTitle>
                <DialogDescription>Add a new department to your organization structure</DialogDescription>
              </DialogHeader>
              <div className="space-y-4">
                <div className="space-y-2">
                  <Label>Department Name *</Label>
                  <Input 
                    placeholder="e.g., Marketing" 
                    value={newDepartment.name}
                    onChange={(e) => setNewDepartment({ ...newDepartment, name: e.target.value })}
                    data-testid="input-department-name"
                  />
                </div>
                <div className="space-y-2">
                  <Label>Description</Label>
                  <Textarea 
                    placeholder="Brief description of the department..."
                    value={newDepartment.description}
                    onChange={(e) => setNewDepartment({ ...newDepartment, description: e.target.value })}
                    data-testid="input-department-description"
                  />
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label>Headcount</Label>
                    <Input 
                      type="number"
                      placeholder="0"
                      value={newDepartment.headcount || ''}
                      onChange={(e) => setNewDepartment({ ...newDepartment, headcount: parseInt(e.target.value) || undefined })}
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Cost Center</Label>
                    <Input 
                      placeholder="e.g., CC-001"
                      value={newDepartment.costCenter || ''}
                      onChange={(e) => setNewDepartment({ ...newDepartment, costCenter: e.target.value })}
                    />
                  </div>
                </div>
              </div>
              <DialogFooter>
                <Button variant="outline" onClick={() => setIsDepartmentDialogOpen(false)}>Cancel</Button>
                <Button onClick={handleAddDepartment} data-testid="button-save-department">
                  <Save className="h-4 w-4 mr-2" />
                  Save Department
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>

          {/* Add Stakeholder Dialog */}
          <Dialog open={isStakeholderDialogOpen} onOpenChange={setIsStakeholderDialogOpen}>
            <DialogContent className="max-w-md">
              <DialogHeader>
                <DialogTitle>Add Stakeholder</DialogTitle>
                <DialogDescription>Add a key stakeholder for playbook coordination</DialogDescription>
              </DialogHeader>
              <div className="space-y-4">
                <div className="space-y-2">
                  <Label>Full Name *</Label>
                  <Input 
                    placeholder="e.g., John Smith" 
                    value={newStakeholder.name}
                    onChange={(e) => setNewStakeholder({ ...newStakeholder, name: e.target.value })}
                    data-testid="input-stakeholder-name"
                  />
                </div>
                <div className="space-y-2">
                  <Label>Email *</Label>
                  <Input 
                    type="email"
                    placeholder="john.smith@company.com"
                    value={newStakeholder.email}
                    onChange={(e) => setNewStakeholder({ ...newStakeholder, email: e.target.value })}
                    data-testid="input-stakeholder-email"
                  />
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label>Role</Label>
                    <Input 
                      placeholder="e.g., VP Operations"
                      value={newStakeholder.role}
                      onChange={(e) => setNewStakeholder({ ...newStakeholder, role: e.target.value })}
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Department</Label>
                    <Select 
                      value={newStakeholder.department}
                      onValueChange={(value) => setNewStakeholder({ ...newStakeholder, department: value })}
                    >
                      <SelectTrigger>
                        <SelectValue placeholder="Select..." />
                      </SelectTrigger>
                      <SelectContent>
                        {departments.map((dept) => (
                          <SelectItem key={dept.id} value={dept.name}>{dept.name}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                </div>
                <div className="space-y-2">
                  <Label>Approval Limit ($)</Label>
                  <Input 
                    type="number"
                    placeholder="100000"
                    value={newStakeholder.approvalLimit || ''}
                    onChange={(e) => setNewStakeholder({ ...newStakeholder, approvalLimit: parseInt(e.target.value) || undefined })}
                  />
                </div>
                <div className="flex items-center justify-between">
                  <Label>Can Approve Playbook Activations</Label>
                  <Switch 
                    checked={newStakeholder.canApproveActivations}
                    onCheckedChange={(checked) => setNewStakeholder({ ...newStakeholder, canApproveActivations: checked })}
                  />
                </div>
              </div>
              <DialogFooter>
                <Button variant="outline" onClick={() => setIsStakeholderDialogOpen(false)}>Cancel</Button>
                <Button onClick={handleAddStakeholder} data-testid="button-save-stakeholder">
                  <Save className="h-4 w-4 mr-2" />
                  Save Stakeholder
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>

          {/* Add Communication Channel Dialog */}
          <Dialog open={isChannelDialogOpen} onOpenChange={setIsChannelDialogOpen}>
            <DialogContent className="max-w-md">
              <DialogHeader>
                <DialogTitle>Add Communication Channel</DialogTitle>
                <DialogDescription>Configure a new notification channel</DialogDescription>
              </DialogHeader>
              <div className="space-y-4">
                <div className="space-y-2">
                  <Label>Channel Type</Label>
                  <Select 
                    value={newChannel.channelType}
                    onValueChange={(value: any) => setNewChannel({ ...newChannel, channelType: value })}
                  >
                    <SelectTrigger>
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="email">Email</SelectItem>
                      <SelectItem value="slack">Slack</SelectItem>
                      <SelectItem value="teams">Microsoft Teams</SelectItem>
                      <SelectItem value="webhook">Webhook</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label>Channel Name *</Label>
                  <Input 
                    placeholder="e.g., Crisis Response Slack" 
                    value={newChannel.name}
                    onChange={(e) => setNewChannel({ ...newChannel, name: e.target.value })}
                    data-testid="input-channel-name"
                  />
                </div>
                {newChannel.channelType === 'slack' && (
                  <div className="space-y-2">
                    <Label>Webhook URL</Label>
                    <Input 
                      placeholder="https://hooks.slack.com/services/..."
                      onChange={(e) => setNewChannel({ ...newChannel, configuration: { webhookUrl: e.target.value } })}
                    />
                  </div>
                )}
                {newChannel.channelType === 'webhook' && (
                  <div className="space-y-2">
                    <Label>Endpoint URL</Label>
                    <Input 
                      placeholder="https://api.yourcompany.com/webhooks/..."
                      onChange={(e) => setNewChannel({ ...newChannel, configuration: { endpointUrl: e.target.value } })}
                    />
                  </div>
                )}
                <div className="flex items-center justify-between">
                  <Label>Set as Default Channel</Label>
                  <Switch 
                    checked={newChannel.isDefault}
                    onCheckedChange={(checked) => setNewChannel({ ...newChannel, isDefault: checked })}
                  />
                </div>
              </div>
              <DialogFooter>
                <Button variant="outline" onClick={() => setIsChannelDialogOpen(false)}>Cancel</Button>
                <Button onClick={handleAddChannel} data-testid="button-save-channel">
                  <Save className="h-4 w-4 mr-2" />
                  Save Channel
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>
          
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/OurStory.tsx
========================================
import { useRef, useState, useEffect } from "react";
import { motion, useInView } from "framer-motion";
import StandardNav from '@/components/layout/StandardNav';
import { Button } from "@/components/ui/button";
import { 
  Trophy, 
  Building2, 
  TrendingDown, 
  Lightbulb, 
  Rocket,
  ArrowRight,
  Play,
  Quote
} from "lucide-react";
import { useLocation } from "wouter";

function AnimatedSection({ children, className = "" }: { children: React.ReactNode; className?: string }) {
  const ref = useRef(null);
  const isInView = useInView(ref, { once: true, margin: "-100px" });
  
  return (
    <motion.div
      ref={ref}
      initial={{ opacity: 0, y: 40 }}
      animate={isInView ? { opacity: 1, y: 0 } : { opacity: 0, y: 40 }}
      transition={{ duration: 0.6, ease: "easeOut" }}
      className={className}
    >
      {children}
    </motion.div>
  );
}

function PullQuote({ children, author }: { children: React.ReactNode; author?: string }) {
  return (
    <div className="relative my-16 py-8">
      <Quote className="absolute -top-2 left-0 h-12 w-12 text-blue-200 dark:text-blue-800" />
      <blockquote className="text-2xl md:text-3xl font-medium text-slate-800 dark:text-slate-200 italic pl-8 md:pl-12 leading-relaxed">
        {children}
      </blockquote>
      {author && (
        <p className="mt-4 pl-8 md:pl-12 text-slate-500 dark:text-slate-400 font-medium"> {author}</p>
      )}
    </div>
  );
}

function TimelineChapter({ 
  number, 
  title, 
  color,
  children 
}: { 
  number: string; 
  title: string; 
  color: string;
  children: React.ReactNode;
}) {
  const colorClasses: Record<string, { bg: string; border: string; text: string; dot: string }> = {
    amber: { bg: "bg-amber-500", border: "border-amber-500", text: "text-amber-600 dark:text-amber-400", dot: "bg-amber-500" },
    green: { bg: "bg-green-500", border: "border-green-500", text: "text-green-600 dark:text-green-400", dot: "bg-green-500" },
    red: { bg: "bg-red-500", border: "border-red-500", text: "text-red-600 dark:text-red-400", dot: "bg-red-500" },
    orange: { bg: "bg-orange-500", border: "border-orange-500", text: "text-orange-600 dark:text-orange-400", dot: "bg-orange-500" },
    blue: { bg: "bg-blue-500", border: "border-blue-500", text: "text-blue-600 dark:text-blue-400", dot: "bg-blue-500" },
    purple: { bg: "bg-purple-500", border: "border-purple-500", text: "text-purple-600 dark:text-purple-400", dot: "bg-purple-500" },
  };

  const c = colorClasses[color] || colorClasses.blue;

  return (
    <AnimatedSection className="mb-20">
      <div className="relative pl-8 md:pl-16 pb-8 border-l-2 border-slate-200 dark:border-slate-700 ml-2">
        {/* Timeline dot */}
        <div className={`absolute -left-[9px] top-2 w-4 h-4 rounded-full ${c.dot} ring-4 ring-white dark:ring-slate-900`} />
        
        {/* Chapter header */}
        <div className="mb-6">
          <span className={`text-sm font-bold uppercase tracking-widest ${c.text}`}>
            {number}
          </span>
          <h2 className="text-2xl md:text-4xl font-bold text-slate-900 dark:text-white mt-1">
            {title}
          </h2>
        </div>
        
        {/* Chapter content */}
        <div className="space-y-6 text-lg text-slate-600 dark:text-slate-300 leading-relaxed">
          {children}
        </div>
      </div>
    </AnimatedSection>
  );
}

function MetricCard({ value, label, color = "blue" }: { value: string; label: string; color?: string }) {
  const colorClasses: Record<string, string> = {
    green: "from-green-500 to-emerald-600",
    red: "from-red-500 to-rose-600",
    orange: "from-orange-500 to-amber-600",
    blue: "from-blue-500 to-indigo-600",
  };

  return (
    <div className={`bg-gradient-to-br ${colorClasses[color]} rounded-2xl p-6 text-white text-center`}>
      <div className="text-4xl md:text-5xl font-bold">{value}</div>
      <div className="text-sm md:text-base opacity-90 mt-1">{label}</div>
    </div>
  );
}

export default function OurStory() {
  const [, setLocation] = useLocation();
  const [showStickyCta, setShowStickyCta] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      const scrolled = window.scrollY > 600;
      setShowStickyCta(scrolled);
    };
    
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  return (
    <div className="page-background min-h-screen overflow-x-hidden">
      <StandardNav />
      
      {/* Hero Section - Clean and Impactful */}
      <div className="relative bg-slate-900 text-white overflow-hidden">
        <div className="absolute inset-0 bg-gradient-to-br from-blue-900/20 via-transparent to-purple-900/20" />
        
        <div className="container mx-auto px-6 py-24 md:py-32 relative z-10">
          <motion.div 
            className="max-w-4xl mx-auto text-center"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
          >
            <p className="text-blue-400 font-medium tracking-wide mb-4">THE ORIGIN STORY</p>
            <h1 className="text-4xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight">
              40-Second Decisions.<br />
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">
                Years of Preparation.
              </span>
            </h1>
            <p className="text-xl md:text-2xl text-slate-300 max-w-2xl mx-auto">
              How one coach's championship methodology became the execution engine for Fortune 1000 companies.
            </p>
          </motion.div>
        </div>
      </div>

      {/* Timeline Container */}
      <div className="container mx-auto px-6 py-20">
        <div className="max-w-3xl mx-auto relative">
          {/* Timeline line - removed absolute positioning that was causing scroll issues */}

          {/* Prologue */}
          <TimelineChapter number="Prologue" title="The Moment Everything Changed" color="amber">
            <p className="font-semibold text-slate-800 dark:text-white text-xl">
              Saturday afternoon. Eugene, Oregon. 2001.
            </p>
            <p>
              Down by 14 points. Ten minutes remaining. 80,000 fans watching. 
              National television cameras rolling.
            </p>
            <p>
              I'm in the coaches' box when my head coach says two words over the headset:
            </p>
            
            <div className="bg-amber-50 dark:bg-amber-950/30 border-l-4 border-amber-500 p-6 rounded-r-xl my-8">
              <p className="text-2xl font-bold text-amber-700 dark:text-amber-300 italic">
                "Momentum change."
              </p>
            </div>

            <p className="font-semibold text-slate-800 dark:text-white">
              In the next 40 seconds, we made a critical decision and executed:
            </p>
            <ul className="space-y-2 ml-4">
              <li> We had practiced this exact scenario dozens of times</li>
              <li> The trigger firedeveryone knew their play</li>
              <li> 11 players received the signal and adjusted instantly</li>
              <li> No huddle. No meeting. No debate. Just execution.</li>
            </ul>

            <div className="bg-green-50 dark:bg-green-950/30 border-l-4 border-green-500 p-6 rounded-r-xl my-8">
              <p className="font-semibold text-green-800 dark:text-green-200">
                Blocked punt. Immediate score. Onside kick recovery. Another touchdown. 
                Defensive interception. <span className="font-bold">Game won.</span>
              </p>
            </div>
          </TimelineChapter>

          <PullQuote>
            This wasn't luck. This was preparation meeting opportunitypracticed plays ready to execute the instant the trigger fired.
          </PullQuote>

          {/* The Contrast */}
          <TimelineChapter number="Chapter 1" title="The Monday Morning Paradox" color="red">
            <p className="font-semibold text-slate-800 dark:text-white text-xl">
              Same week. Fortune 500 boardroom. Same type of crisis.
            </p>
            
            <div className="bg-red-50 dark:bg-red-950/30 border-l-4 border-red-500 p-6 rounded-r-xl my-8">
              <p className="text-lg mb-2">"Our competitor just launched a similar product."</p>
              <p className="text-2xl font-bold text-red-700 dark:text-red-300 italic">
                "Let me schedule a meeting to discuss our response."
              </p>
              <p className="text-sm text-slate-600 dark:text-slate-400 mt-3">
                That meeting was scheduled three days later.
              </p>
            </div>

            {/* The Comparison */}
            <div className="grid md:grid-cols-2 gap-6 my-12">
              <MetricCard value="40 sec" label="Saturday Crisis Response" color="green" />
              <MetricCard value="72 hrs" label="Monday Crisis Response" color="red" />
            </div>

            <p className="text-xl font-medium text-slate-800 dark:text-white">
              Same competitive threat. Same need for coordinated action. 
              <span className="text-orange-600 dark:text-orange-400"> Vastly different outcomes.</span>
            </p>
          </TimelineChapter>

          <PullQuote>
            Why do Fortune 1000 enterprises take 72 hours for decisions that championship teams make in 40 seconds?
          </PullQuote>

          {/* The Problem */}
          <TimelineChapter number="Chapter 2" title="The 10,000x Speed Gap" color="orange">
            <p>
              We spent years studying this gap. The data was staggering:
            </p>

            <div className="grid grid-cols-3 gap-4 my-8">
              <div className="text-center p-4 bg-slate-100 dark:bg-slate-800 rounded-xl">
                <div className="text-3xl font-bold text-orange-600">$144M</div>
                <div className="text-sm text-slate-600 dark:text-slate-400">Annual Value Gap</div>
              </div>
              <div className="text-center p-4 bg-slate-100 dark:bg-slate-800 rounded-xl">
                <div className="text-3xl font-bold text-orange-600">87%</div>
                <div className="text-sm text-slate-600 dark:text-slate-400">Transformations Fail</div>
              </div>
              <div className="text-center p-4 bg-slate-100 dark:bg-slate-800 rounded-xl">
                <div className="text-3xl font-bold text-orange-600">10,000x</div>
                <div className="text-sm text-slate-600 dark:text-slate-400">Speed Difference</div>
              </div>
            </div>

            <p>
              While competitors moved at game speed, enterprises were stuck in quarterly planning cycles, 
              endless alignment meetings, and reactive crisis management.
            </p>
          </TimelineChapter>

          {/* The Solution */}
          <TimelineChapter number="Chapter 3" title="Reverse-Engineering the Playbook" color="blue">
            <p>
              We studied what makes NFL coaches so effective. Four principles emerged:
            </p>

            <div className="grid md:grid-cols-2 gap-4 my-8">
              {[
                { icon: Trophy, title: "Pre-Game Preparation", desc: "Every scenario pre-planned. No improvisation under pressure." },
                { icon: Building2, title: "24/7 Monitoring", desc: "Film study. Pattern recognition. Triggers identified before game day." },
                { icon: TrendingDown, title: "One-Click Execution", desc: "Everyone knows their role. Execute immediately on signal." },
                { icon: Lightbulb, title: "Institutional Memory", desc: "Learn from every play. Refine playbooks. Get better every season." },
              ].map((item, i) => (
                <div key={i} className="bg-blue-50 dark:bg-blue-950/30 rounded-xl p-5">
                  <item.icon className="h-6 w-6 text-blue-600 mb-2" />
                  <h4 className="font-semibold text-slate-900 dark:text-white">{item.title}</h4>
                  <p className="text-sm text-slate-600 dark:text-slate-400">{item.desc}</p>
                </div>
              ))}
            </div>

            <p>
              These weren't just coaching techniques. They were the foundation of a 
              new operating model for strategic execution.
            </p>
          </TimelineChapter>

          {/* The Vision */}
          <TimelineChapter number="Chapter 4" title="M Was Born" color="purple">
            <p>
              We translated 15 years of research into a platform that gives every 
              Fortune 1000 executive the same strategic advantage as an NFL coach:
            </p>

            <ul className="space-y-3 my-8">
              <li className="flex items-start gap-3">
                <Rocket className="h-6 w-6 text-purple-600 flex-shrink-0 mt-1" />
                <span><strong>166 battle-tested playbooks</strong> across 9 strategic domains</span>
              </li>
              <li className="flex items-start gap-3">
                <Rocket className="h-6 w-6 text-purple-600 flex-shrink-0 mt-1" />
                <span><strong>AI-powered monitoring</strong> across 92 intelligence signals</span>
              </li>
              <li className="flex items-start gap-3">
                <Rocket className="h-6 w-6 text-purple-600 flex-shrink-0 mt-1" />
                <span><strong>12-minute coordinated response</strong> when triggers fire</span>
              </li>
              <li className="flex items-start gap-3">
                <Rocket className="h-6 w-6 text-purple-600 flex-shrink-0 mt-1" />
                <span><strong>Institutional memory</strong> that makes every response smarter</span>
              </li>
            </ul>
          </TimelineChapter>

          {/* Enterprise Validation */}
          <TimelineChapter number="Chapter 5" title="Built on Proven Methodology" color="green">
            <p>
              M isn't theoretical. It's built on <strong>Dynamic Strategy</strong>the methodology 
              trusted by the world's most demanding organizations:
            </p>

            {/* Enterprise Logos */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-6 my-10">
              {[
                { name: "Microsoft", desc: "Azure strategic ops" },
                { name: "Amazon", desc: "AWS incident response" },
                { name: "DBS Bank", desc: "Digital transformation" },
                { name: "Salesforce", desc: "Enterprise adoption" },
              ].map((company, i) => (
                <div key={i} className="text-center p-4 bg-slate-100 dark:bg-slate-800/50 rounded-xl">
                  <div className="text-lg font-bold text-slate-800 dark:text-white">{company.name}</div>
                  <div className="text-xs text-slate-500">{company.desc}</div>
                </div>
              ))}
            </div>

            <p className="font-medium text-slate-800 dark:text-white">
              Dynamic Strategy's 10 principles operationalized into software:
            </p>

            <div className="grid md:grid-cols-2 gap-3 my-6">
              {[
                "Sense, Adapt, Learn: AI monitors 12 intelligence signals 24/7",
                "Pre-Committed Resources: Budgets pre-approved for rapid deployment",
                "Distributed Decision Rights: Right people empowered to act instantly",
                "Scenario-Based Planning: 166 playbooks covering strategic landscape",
                "Continuous Calibration: Learning loops refine every response",
                "Modular Execution: Plug-and-play components for any situation"
              ].map((principle, i) => (
                <div key={i} className="flex items-start gap-2 text-sm">
                  <div className="w-5 h-5 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center flex-shrink-0 mt-0.5">
                    <span className="text-green-600 text-xs font-bold"></span>
                  </div>
                  <span className="text-slate-600 dark:text-slate-400">{principle}</span>
                </div>
              ))}
            </div>

            {/* Research Validation */}
            <div className="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/30 dark:to-emerald-950/30 rounded-xl p-6 border border-green-200 dark:border-green-800 my-8">
              <div className="text-sm font-semibold text-green-700 dark:text-green-400 mb-2">Research Foundation</div>
              <p className="text-slate-700 dark:text-slate-300">
                Validated through McKinsey research on strategic agility, MIT Sloan studies on 
                organizational decision-making, and 15+ years of real-world implementation 
                across Fortune 500 companies.
              </p>
            </div>
          </TimelineChapter>

          <PullQuote author="The M Philosophy">
            Championship teams don't improvise under pressure. They execute prepared playbooks at competitive speed.
          </PullQuote>
        </div>
      </div>

      {/* CTA Section */}
      <div className="bg-gradient-to-br from-slate-900 via-blue-950 to-slate-900 text-white py-20">
        <div className="container mx-auto px-6">
          <motion.div 
            className="max-w-3xl mx-auto text-center"
            initial={{ opacity: 0 }}
            whileInView={{ opacity: 1 }}
            viewport={{ once: true }}
          >
            <h2 className="text-3xl md:text-5xl font-bold mb-6">
              Success Favors the Prepared.
              <span className="block text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400 mt-2">
                Are You?
              </span>
            </h2>
            <p className="text-xl text-slate-300 mb-10">
              Replace reactive scrambles with coordinated precision. See how M transforms 
              strategic response from 72 hours to 12 minutes.
            </p>
            <div className="flex flex-col sm:flex-row items-center justify-center gap-4">
              <Button 
                onClick={() => setLocation("/demo/live-activation")}
                className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-6 text-lg w-full sm:w-auto"
                data-testid="button-watch-demo"
              >
                <Play className="h-5 w-5 mr-2" />
                Watch Live Demo
              </Button>
              <Button 
                onClick={() => setLocation("/how-it-works")}
                variant="outline"
                className="border-slate-500 text-white hover:bg-slate-800 px-8 py-6 text-lg w-full sm:w-auto"
                data-testid="button-how-it-works"
              >
                See How It Works
                <ArrowRight className="h-5 w-5 ml-2" />
              </Button>
            </div>
          </motion.div>
        </div>
      </div>

      {/* Footer */}
      <footer className="bg-slate-950 text-white py-12">
        <div className="container mx-auto px-6 text-center">
          <div className="flex items-center justify-center gap-3 mb-4">
            <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
              <span className="text-white font-bold text-xl">M</span>
            </div>
            <span className="font-bold text-lg">Strategic Execution OS</span>
          </div>
          <p className="text-slate-400">
            From the sidelines to the boardroom.
          </p>
        </div>
      </footer>

      {/* Sticky CTA - appears after scrolling */}
      <motion.div 
        className="fixed bottom-6 right-6 z-50"
        initial={{ opacity: 0, scale: 0.8, y: 20 }}
        animate={showStickyCta ? { opacity: 1, scale: 1, y: 0 } : { opacity: 0, scale: 0.8, y: 20 }}
        transition={{ duration: 0.3 }}
      >
        <Button 
          onClick={() => setLocation("/contact")}
          className="bg-blue-600 hover:bg-blue-700 text-white shadow-2xl shadow-blue-500/25 px-6 py-3 rounded-full"
          data-testid="button-sticky-cta"
        >
          Request Demo
          <ArrowRight className="h-4 w-4 ml-2" />
        </Button>
      </motion.div>
    </div>
  );
}


========================================
FILE: client/src/pages/PharmaceuticalRecallDemo.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useState, useEffect } from "react";
import { Link } from "wouter";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Pill, Heart, AlertTriangle, CheckCircle, Clock, Users, DollarSign, ShieldAlert, ArrowLeft, Play } from "lucide-react";
import AIRadarSimulation from "@/components/demo/AIRadarSimulation";
import TwelveMinuteTimer from "@/components/demo/TwelveMinuteTimer";
import ROIComparison from "@/components/demo/ROIComparison";
import DemoNavHeader from "@/components/demo/DemoNavHeader";
import { pharmaDemoData } from "@shared/pharma-demo-data";

type DemoAct = "intro" | "detection" | "coordination" | "outcome";

export default function PharmaceuticalRecallDemo() {
  const [currentAct, setCurrentAct] = useState<DemoAct>("intro");
  const [detectionProgress, setDetectionProgress] = useState(0);
  const [coordinationComplete, setCoordinationComplete] = useState(false);

  // Auto-progress detection
  useEffect(() => {
    if (currentAct === "detection" && detectionProgress < 100) {
      const interval = setInterval(() => {
        setDetectionProgress(prev => {
          if (prev >= 100) {
            clearInterval(interval);
            return 100;
          }
          return prev + 2;
        });
      }, 100);
      return () => clearInterval(interval);
    }
  }, [currentAct, detectionProgress]);

  const resetDemo = () => {
    setCurrentAct("intro");
    setDetectionProgress(0);
    setCoordinationComplete(false);
  };

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-950 via-red-950 to-slate-900">
      <DemoNavHeader title="Pharmaceutical Recall Demo" showBackButton={true} />

      {/* Act Navigation */}
      <div className="border-b border-red-800/20 bg-slate-950/30 pt-20">
        <div className="container mx-auto px-6 py-3">
          <div className="flex justify-between items-center">
            {[
              { id: "intro", label: "1. Introduction", icon: Play },
              { id: "detection", label: "2. AI Detection @ 92%", icon: ShieldAlert },
              { id: "coordination", label: "3. 12-Min Coordination", icon: Clock },
              { id: "outcome", label: "4. Life Saved", icon: Heart }
            ].map((act) => (
              <button
                key={act.id}
                onClick={() => setCurrentAct(act.id as DemoAct)}
                className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
                  currentAct === act.id
                    ? "bg-red-600 text-white"
                    : "text-red-300 hover:bg-red-950/50"
                }`}
                data-testid={`button-act-${act.id}`}
              >
                <act.icon className="w-4 h-4" />
                <span className="text-sm font-medium">{act.label}</span>
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="container mx-auto px-6 py-12">
        {/* ACT 1: INTRODUCTION */}
        {currentAct === "intro" && (
          <div className="max-w-5xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-red-800/30">
              <div className="text-center mb-8">
                <Heart className="w-16 h-16 text-red-400 mx-auto mb-4" />
                <h2 className="text-3xl font-bold text-white mb-3">{pharmaDemoData.crisis.title}</h2>
                <p className="text-xl text-red-200">{pharmaDemoData.crisis.subtitle}</p>
              </div>

              <div className="grid md:grid-cols-2 gap-6 mb-8">
                <div className="p-6 bg-red-950/30 rounded-lg border border-red-800/30">
                  <h3 className="font-bold text-white mb-4 flex items-center gap-2">
                    <AlertTriangle className="w-5 h-5 text-red-400" />
                    The Crisis
                  </h3>
                  <div className="space-y-3 text-sm">
                    <div>
                      <div className="text-red-300 mb-1">Organization</div>
                      <div className="text-white font-semibold">Glenmark Pharmaceuticals</div>
                    </div>
                    <div>
                      <div className="text-red-300 mb-1">Product</div>
                      <div className="text-white">Potassium Chloride Capsules</div>
                    </div>
                    <div>
                      <div className="text-red-300 mb-1">Defect</div>
                      <div className="text-white">Capsules failed to dissolve - potentially deadly</div>
                    </div>
                    <div>
                      <div className="text-red-300 mb-1">Scale</div>
                      <div className="text-white font-bold">47 Million Units Recalled</div>
                    </div>
                  </div>
                </div>

                <div className="p-6 bg-slate-900/50 rounded-lg border border-red-800/30">
                  <h3 className="font-bold text-white mb-4">What Happened (May-June 2024)</h3>
                  <ul className="space-y-2 text-sm text-red-200">
                    <li> Week 1-3: Internal investigation</li>
                    <li> Week 4 (May): Quietly notified wholesalers only</li>
                    <li className="text-red-400 font-semibold"> Week 5: 91-year-old patient takes defective capsules</li>
                    <li className="text-red-400 font-bold"> Week 5: Patient dies from lethal potassium levels</li>
                    <li> Week 6 (June): Public announcement</li>
                    <li className="text-red-300"> Family learns weeks later medication killed their loved one</li>
                  </ul>
                </div>
              </div>

              <div className="bg-gradient-to-r from-red-950/50 to-rose-950/50 border border-red-700 rounded-lg p-6 mb-8">
                <div className="flex items-start gap-4">
                  <ShieldAlert className="w-8 h-8 text-red-400 flex-shrink-0 mt-1" />
                  <div>
                    <h3 className="font-bold text-white mb-2">The Detection-Execution Gap</h3>
                    <p className="text-red-100 leading-relaxed">
                      Glenmark had the technology to detect the dissolution problem. But coordinating 2,052 stakeholders 
                      across FDA, wholesalers, pharmacies, and patients took <strong>6 weeks</strong>. In that gap, 
                      a patient died. This demo shows how M would have compressed that 6-week coordination into 12 minutes,
                      ensuring the patient <strong>never received the deadly capsules</strong>.
                    </p>
                  </div>
                </div>
              </div>

              <div className="text-center">
                <Button
                  size="lg"
                  onClick={() => setCurrentAct("detection")}
                  className="bg-red-600 hover:bg-red-700 text-white px-8"
                  data-testid="button-start-demo"
                >
                  Begin Crisis Simulation
                  <Play className="w-5 h-5 ml-2" />
                </Button>
              </div>
            </Card>
          </div>
        )}

        {/* ACT 2: AI DETECTION */}
        {currentAct === "detection" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-red-800/30">
              <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                <ShieldAlert className="w-8 h-8 text-red-400" />
                AI Quality Monitoring Detects Critical Failure
              </h2>

              <div className="mb-8">
                <div className="flex items-center justify-between mb-3">
                  <span className="text-red-200">AI Confidence Level</span>
                  <span className="text-2xl font-bold text-red-400">{detectionProgress}%</span>
                </div>
                <Progress value={detectionProgress} className="h-3" />
                {detectionProgress >= 92 && (
                  <div className="mt-4 p-4 bg-red-950/50 border border-red-600 rounded-lg">
                    <p className="text-red-200 font-semibold">
                       ALERT: Class I recall criteria detected - Reasonable probability of serious adverse health consequences or death
                    </p>
                  </div>
                )}
              </div>

              <AIRadarSimulation
                dataStreams={pharmaDemoData.aiDataStreams}
                title="Quality Intelligence Signals"
                playbookId="#095"
                playbookName="Product Recall (Class I)"
                autoStart={true}
              />

              {detectionProgress >= 92 && (
                <div className="mt-8 text-center">
                  <Button
                    size="lg"
                    onClick={() => setCurrentAct("coordination")}
                    className="bg-red-600 hover:bg-red-700 text-white px-8"
                    data-testid="button-activate-playbook"
                  >
                    Activate Playbook #095 - Product Recall
                    <CheckCircle className="w-5 h-5 ml-2" />
                  </Button>
                </div>
              )}
            </Card>
          </div>
        )}

        {/* ACT 3: 12-MINUTE COORDINATION */}
        {currentAct === "coordination" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-red-800/30">
              <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                <Clock className="w-8 h-8 text-red-400" />
                12-Minute Coordinated Response Across 2,052 Stakeholders
              </h2>

              <TwelveMinuteTimer
                timelineEvents={pharmaDemoData.timelineEvents}
                stakeholderTiers={pharmaDemoData.stakeholderTiers}
                onComplete={() => setCoordinationComplete(true)}
                autoStart={true}
              />

              {coordinationComplete && (
                <div className="mt-8">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    {pharmaDemoData.stakeholderTiers && (
                      <>
                        <Card className="p-6 bg-red-950/30 border-red-700">
                          <div className="text-red-300 text-sm mb-2">Tier 1: Decision Makers</div>
                          <div className="text-3xl font-bold text-white mb-3">{pharmaDemoData.stakeholderTiers.tier1.count}</div>
                          <div className="text-xs text-red-200">
                            {pharmaDemoData.stakeholderTiers.tier1.members.join(", ")}
                          </div>
                        </Card>
                        <Card className="p-6 bg-red-950/30 border-red-700">
                          <div className="text-red-300 text-sm mb-2">Tier 2: Execution Teams</div>
                          <div className="text-3xl font-bold text-white mb-3">{pharmaDemoData.stakeholderTiers.tier2.count}</div>
                          <div className="text-xs text-red-200">
                            {pharmaDemoData.stakeholderTiers.tier2.members.join(", ")}
                          </div>
                        </Card>
                        <Card className="p-6 bg-red-950/30 border-red-700">
                          <div className="text-red-300 text-sm mb-2">Tier 3: Public Notification</div>
                          <div className="text-3xl font-bold text-white mb-3">{pharmaDemoData.stakeholderTiers.tier3.count}</div>
                          <div className="text-xs text-red-200">
                            {pharmaDemoData.stakeholderTiers.tier3.members.join(", ")}
                          </div>
                        </Card>
                      </>
                    )}
                  </div>

                  <div className="text-center">
                    <Button
                      size="lg"
                      onClick={() => setCurrentAct("outcome")}
                      className="bg-green-600 hover:bg-green-700 text-white px-8"
                      data-testid="button-view-outcome"
                    >
                      View Impact & ROI
                      <Heart className="w-5 h-5 ml-2" />
                    </Button>
                  </div>
                </div>
              )}
            </Card>
          </div>
        )}

        {/* ACT 4: ROI OUTCOME */}
        {currentAct === "outcome" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-green-800/30">
              <div className="text-center mb-8">
                <Heart className="w-16 h-16 text-green-400 mx-auto mb-4" />
                <h2 className="text-3xl font-bold text-white mb-3">A Life Saved</h2>
                <p className="text-xl text-green-200">The patient never received the deadly capsules</p>
              </div>

              <ROIComparison
                traditional={pharmaDemoData.roiComparison.traditional}
                vexor={pharmaDemoData.roiComparison.vexor}
                bottomLine={pharmaDemoData.roiComparison.bottomLine}
              />

              <div className="mt-8 grid grid-cols-1 md:grid-cols-4 gap-4">
                <Card className="p-4 bg-green-950/30 border-green-800">
                  <div className="text-green-300 text-sm mb-1">Lives Saved</div>
                  <div className="text-2xl font-bold text-green-400">1+</div>
                </Card>
                <Card className="p-4 bg-blue-950/30 border-blue-800">
                  <div className="text-blue-300 text-sm mb-1">Liability Avoided</div>
                  <div className="text-2xl font-bold text-blue-400">$50M+</div>
                </Card>
                <Card className="p-4 bg-purple-950/30 border-purple-800">
                  <div className="text-purple-300 text-sm mb-1">Stakeholders Coordinated</div>
                  <div className="text-2xl font-bold text-purple-400">2,052</div>
                </Card>
                <Card className="p-4 bg-orange-950/30 border-orange-800">
                  <div className="text-orange-300 text-sm mb-1">Coordination Time</div>
                  <div className="text-2xl font-bold text-orange-400">12 min</div>
                </Card>
              </div>

              <div className="mt-8 flex justify-center gap-4">
                <Button
                  size="lg"
                  onClick={resetDemo}
                  variant="outline"
                  className="border-red-500 text-red-400 hover:bg-red-950/50"
                  data-testid="button-replay-demo"
                >
                  Replay Demo
                </Button>
                <Link href="/industry-demos">
                  <Button size="lg" className="bg-blue-600 hover:bg-blue-700" data-testid="button-explore-more">
                    Explore More Industry Demos
                  </Button>
                </Link>
              </div>
            </Card>
          </div>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/PilotMonitoring.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { 
  Activity,
  AlertCircle,
  CheckCircle2,
  TrendingUp,
  Users,
  Zap,
  Clock,
  BarChart3
} from "lucide-react";
import { useEffect } from "react";
import { updatePageMetadata } from "@/lib/seo";
import StandardNav from "@/components/layout/StandardNav";
import { useQuery } from "@tanstack/react-query";

export default function PilotMonitoring() {
  useEffect(() => {
    updatePageMetadata({
      title: "Pilot Program Monitoring - M | System Health Dashboard",
      description: "Real-time monitoring dashboard for M Early Access Program. Track system health, pilot company activity, and platform performance.",
      ogTitle: "M Pilot Monitoring Dashboard",
      ogDescription: "Monitor system health and pilot program success metrics in real-time.",
    });
  }, []);

  // Fetch real-time data from backend
  const { data: systemHealth, isLoading: healthLoading, isError: healthError } = useQuery({
    queryKey: ['/api/pilot-monitoring/system-health'],
    refetchInterval: 30000, // Refresh every 30 seconds
  });

  const { data: pilotMetrics, isLoading: metricsLoading, isError: metricsError } = useQuery({
    queryKey: ['/api/pilot-monitoring/pilot-metrics'],
    refetchInterval: 60000, // Refresh every minute
  });

  const { data: recentActivity, isLoading: activityLoading, isError: activityError } = useQuery({
    queryKey: ['/api/pilot-monitoring/recent-activity'],
    refetchInterval: 30000, // Refresh every 30 seconds
  });

  // Show loading state while initial data loads
  if (healthLoading || metricsLoading || activityLoading) {
    return (
      <div className="page-background min-h-screen bg-slate-50 dark:bg-slate-950">
        <StandardNav />
        <div className="max-w-7xl mx-auto px-6 py-8">
          <div className="text-center py-12">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
            <p className="mt-4 text-slate-600 dark:text-slate-400">Loading monitoring dashboard...</p>
          </div>
        </div>
      </div>
    );
  }

  // Show error state if any queries failed
  if (healthError || metricsError || activityError) {
    return (
      <div className="page-background min-h-screen bg-slate-50 dark:bg-slate-950">
        <StandardNav />
        <div className="max-w-7xl mx-auto px-6 py-8">
          <div className="text-center py-12">
            <AlertCircle className="w-16 h-16 text-red-600 mx-auto mb-4" />
            <h2 className="text-2xl font-bold text-slate-900 dark:text-white mb-2">
              Unable to Load Monitoring Data
            </h2>
            <p className="text-slate-600 dark:text-slate-400">
              Please check your connection and try again. If the problem persists, contact support.
            </p>
          </div>
        </div>
      </div>
    );
  }

  // Guard against undefined data
  if (!systemHealth || !pilotMetrics || !recentActivity) {
    return (
      <div className="page-background min-h-screen bg-slate-50 dark:bg-slate-950">
        <StandardNav />
        <div className="max-w-7xl mx-auto px-6 py-8">
          <div className="text-center py-12">
            <p className="text-slate-600 dark:text-slate-400">No monitoring data available.</p>
          </div>
        </div>
      </div>
    );
  }

  const performanceMetrics = [
    { label: 'Avg Scenario Creation Time', value: '4.2 min', target: '< 5 min', status: 'good' },
    { label: 'Trigger Activation Success Rate', value: '98.3%', target: '> 95%', status: 'good' },
    { label: 'Execution Completion Rate', value: '94.1%', target: '> 90%', status: 'good' },
    { label: 'User Satisfaction Score', value: '8.7/10', target: '> 8.0', status: 'good' },
  ];

  return (
    <div className="page-background min-h-screen bg-slate-50 dark:bg-slate-950">
      <StandardNav />

      <div className="max-w-7xl mx-auto px-6 py-8">
        {/* Header */}
        <div className="mb-8">
          <div className="flex items-center justify-between mb-2">
            <h1 className="text-4xl font-bold text-slate-900 dark:text-white" data-testid="heading-pilot-monitoring">
              Pilot Program Monitoring
            </h1>
            <Badge className={`text-base px-4 py-2 ${
              systemHealth.status === 'healthy' 
                ? 'bg-green-600 text-white' 
                : 'bg-yellow-600 text-white'
            }`} data-testid="badge-system-status">
              <Activity className="w-4 h-4 mr-2" />
              System {systemHealth.status === 'healthy' ? 'Healthy' : 'Warning'}
            </Badge>
          </div>
          <p className="text-lg text-slate-600 dark:text-slate-400">
            Real-time monitoring for Q1 2025 Early Access Program
          </p>
        </div>

        {/* System Health Overview */}
        <div className="grid md:grid-cols-4 gap-6 mb-8">
          <Card data-testid="card-uptime">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-2">
                <div className="text-sm text-slate-600 dark:text-slate-400">Uptime</div>
                <CheckCircle2 className="w-5 h-5 text-green-600" />
              </div>
              <div className="text-3xl font-bold text-slate-900 dark:text-white mb-1">
                {systemHealth.uptime}%
              </div>
              <div className="text-xs text-slate-500">Last 30 days</div>
            </CardContent>
          </Card>

          <Card data-testid="card-response-time">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-2">
                <div className="text-sm text-slate-600 dark:text-slate-400">Avg Response</div>
                <Clock className="w-5 h-5 text-blue-600" />
              </div>
              <div className="text-3xl font-bold text-slate-900 dark:text-white mb-1">
                {systemHealth.avgResponseTime}ms
              </div>
              <div className="text-xs text-slate-500">Target: {'<'} 200ms</div>
            </CardContent>
          </Card>

          <Card data-testid="card-active-users">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-2">
                <div className="text-sm text-slate-600 dark:text-slate-400">Active Users</div>
                <Users className="w-5 h-5 text-purple-600" />
              </div>
              <div className="text-3xl font-bold text-slate-900 dark:text-white mb-1">
                {systemHealth.activeUsers}
              </div>
              <div className="text-xs text-slate-500">Currently online</div>
            </CardContent>
          </Card>

          <Card data-testid="card-executions">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-2">
                <div className="text-sm text-slate-600 dark:text-slate-400">Executions</div>
                <Zap className="w-5 h-5 text-cyan-600" />
              </div>
              <div className="text-3xl font-bold text-slate-900 dark:text-white mb-1">
                {pilotMetrics.executionsCompleted}
              </div>
              <div className="text-xs text-slate-500">Total completed</div>
            </CardContent>
          </Card>
        </div>

        {/* Pilot Company Status */}
        <div className="grid md:grid-cols-2 gap-6 mb-8">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Users className="w-5 h-5 text-blue-600" />
                Pilot Company Status
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-3 gap-4 mb-6">
                <div>
                  <div className="text-2xl font-bold text-slate-900 dark:text-white">
                    {pilotMetrics.totalPilots}
                  </div>
                  <div className="text-sm text-slate-600 dark:text-slate-400">Total Pilots</div>
                </div>
                <div>
                  <div className="text-2xl font-bold text-green-600">
                    {pilotMetrics.activePilots}
                  </div>
                  <div className="text-sm text-slate-600 dark:text-slate-400">Active</div>
                </div>
                <div>
                  <div className="text-2xl font-bold text-slate-500">
                    {pilotMetrics.totalPilots - pilotMetrics.activePilots}
                  </div>
                  <div className="text-sm text-slate-600 dark:text-slate-400">Onboarding</div>
                </div>
              </div>
              
              <div className="space-y-3">
                <div>
                  <div className="flex justify-between text-sm mb-1">
                    <span className="text-slate-600 dark:text-slate-400">Adoption Rate</span>
                    <span className="font-semibold text-slate-900 dark:text-white">70%</span>
                  </div>
                  <div className="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2">
                    <div className="bg-green-600 h-2 rounded-full" style={{ width: '70%' }}></div>
                  </div>
                </div>
                <div>
                  <div className="flex justify-between text-sm mb-1">
                    <span className="text-slate-600 dark:text-slate-400">Average Engagement</span>
                    <span className="font-semibold text-slate-900 dark:text-white">85%</span>
                  </div>
                  <div className="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2">
                    <div className="bg-blue-600 h-2 rounded-full" style={{ width: '85%' }}></div>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <BarChart3 className="w-5 h-5 text-purple-600" />
                Platform Usage
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                <div className="flex justify-between items-center">
                  <div>
                    <div className="text-sm text-slate-600 dark:text-slate-400">Scenarios Created</div>
                    <div className="text-2xl font-bold text-slate-900 dark:text-white">{pilotMetrics.scenariosCreated}</div>
                  </div>
                  <TrendingUp className="w-8 h-8 text-green-600" />
                </div>
                <div className="flex justify-between items-center">
                  <div>
                    <div className="text-sm text-slate-600 dark:text-slate-400">Triggers Configured</div>
                    <div className="text-2xl font-bold text-slate-900 dark:text-white">{pilotMetrics.triggersConfigured}</div>
                  </div>
                  <TrendingUp className="w-8 h-8 text-blue-600" />
                </div>
                <div className="flex justify-between items-center">
                  <div>
                    <div className="text-sm text-slate-600 dark:text-slate-400">Avg Execution Time</div>
                    <div className="text-2xl font-bold text-slate-900 dark:text-white">{pilotMetrics.avgExecutionTime} min</div>
                  </div>
                  <Badge className="bg-green-600 text-white">
                    Target: 12 min
                  </Badge>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Performance Metrics */}
        <Card className="mb-8">
          <CardHeader>
            <CardTitle>Performance Metrics</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid md:grid-cols-2 gap-4">
              {performanceMetrics.map((metric, index) => (
                <div key={index} className="card-bg rounded-lg p-4">
                  <div className="flex items-center justify-between mb-2">
                    <div className="text-sm font-semibold text-slate-700 dark:text-slate-300">
                      {metric.label}
                    </div>
                    <CheckCircle2 className={`w-5 h-5 ${
                      metric.status === 'good' ? 'text-green-600' : 'text-yellow-600'
                    }`} />
                  </div>
                  <div className="text-2xl font-bold text-slate-900 dark:text-white mb-1">
                    {metric.value}
                  </div>
                  <div className="text-xs text-slate-500">
                    Target: {metric.target}
                  </div>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>

        {/* Recent Activity */}
        <Card>
          <CardHeader>
            <CardTitle>Recent Activity</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              {recentActivity.map((activity, index) => (
                <div key={index} className="flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-900 rounded-lg">
                  <div className="flex-shrink-0 mt-1">
                    {activity.success ? (
                      <CheckCircle2 className="w-5 h-5 text-green-600" />
                    ) : (
                      <AlertCircle className="w-5 h-5 text-yellow-600" />
                    )}
                  </div>
                  <div className="flex-1 page-background">
                    <div className="font-semibold text-slate-900 dark:text-white text-sm">
                      {activity.pilot}
                    </div>
                    <div className="text-sm text-slate-600 dark:text-slate-400">
                      {activity.action}
                    </div>
                  </div>
                  <div className="text-xs text-slate-500 whitespace-nowrap">
                    {activity.time}
                  </div>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/PilotProgram.tsx
========================================
import { useLocation } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { 
  CheckCircle,
  ArrowRight,
  Clock,
  Users,
  Zap,
  Target,
  BookOpen,
  Settings,
  BarChart3,
  Shield,
  Building2,
  Calendar,
  Award,
  DollarSign,
  TrendingUp,
  MessageSquare,
  Layers,
  Play,
  Star,
  FileText,
  Rocket
} from 'lucide-react';
import { useEffect } from 'react';
import { updatePageMetadata } from '@/lib/seo';

const pilotPhases = [
  {
    phase: 'Phase 0',
    name: 'Readiness & Setup',
    duration: 'Weeks 1-2',
    color: 'bg-slate-600',
    activities: [
      'Executive sponsor alignment session',
      'Integration setup (Jira, Slack/Teams)',
      'Select 3-5 pilot playbooks from 166 library',
      'Configure signal monitoring for pilot triggers',
      'Baseline current response metrics'
    ],
    deliverables: ['Integration complete', 'Playbooks configured', 'Baseline metrics documented'],
    successMetrics: 'All integrations tested and operational'
  },
  {
    phase: 'Phase 1',
    name: 'Dry Runs & Training',
    duration: 'Weeks 3-6',
    color: 'bg-blue-600',
    activities: [
      'Conduct 2-3 tabletop exercises with M',
      'Measure activation time (target: <12 min)',
      'Train response team leads on M workflow',
      'Refine playbooks based on dry run feedback',
      'Establish KPI tracking dashboard'
    ],
    deliverables: ['Dry run reports', 'Training completion', 'Refined playbooks'],
    successMetrics: 'Activation time under 15 minutes in dry runs'
  },
  {
    phase: 'Phase 2',
    name: 'Live Activation',
    duration: 'Weeks 7-10',
    color: 'bg-emerald-600',
    activities: [
      'Enable live signal monitoring',
      'First live playbook activation',
      'Track all coordination metrics',
      'Document lessons learned',
      'Capture stakeholder feedback'
    ],
    deliverables: ['Live activation data', 'ROI evidence', 'User testimonials'],
    successMetrics: 'At least 1 live activation with measured 12-minute response'
  },
  {
    phase: 'Phase 3',
    name: 'Executive Readout',
    duration: 'Weeks 11-12',
    color: 'bg-purple-600',
    activities: [
      'Compile ROI scorecard',
      'Present results to executive sponsor',
      'Define production rollout plan',
      'Negotiate enterprise agreement',
      'Plan Phase 2 expansion'
    ],
    deliverables: ['Executive presentation', 'ROI scorecard', 'Expansion proposal'],
    successMetrics: 'Clear go/no-go decision with quantified value'
  }
];

const pilotInclusions = [
  {
    category: 'Platform Access',
    icon: Layers,
    items: [
      'Full M platform access for pilot team (up to 25 users)',
      '5 customizable playbooks from 166 library',
      'Signal monitoring for 3 intelligence categories',
      'Command Center with real-time coordination'
    ]
  },
  {
    category: 'Integrations',
    icon: Settings,
    items: [
      'Bi-directional Jira or Asana sync',
      'Slack or Microsoft Teams notifications',
      'Email notification integration',
      'SSO configuration (if needed)'
    ]
  },
  {
    category: 'Support',
    icon: Users,
    items: [
      'Dedicated Customer Success Manager',
      'Weekly check-in calls',
      'Priority support response (4hr SLA)',
      'Executive sponsor alignment sessions'
    ]
  },
  {
    category: 'Training',
    icon: BookOpen,
    items: [
      '2-hour platform training session',
      'Playbook customization workshop',
      'Tabletop exercise facilitation (2-3 sessions)',
      'Documentation and quick-start guides'
    ]
  }
];

const idealCandidates = [
  {
    criteria: 'Organization Size',
    description: 'Fortune 1000 or equivalent ($1B+ revenue)',
    icon: Building2,
    importance: 'Required'
  },
  {
    criteria: 'Executive Sponsor',
    description: 'C-level or SVP champion with budget authority',
    icon: Star,
    importance: 'Required'
  },
  {
    criteria: 'PM Tool',
    description: 'Active Jira, Asana, or Monday.com deployment',
    icon: Settings,
    importance: 'Required'
  },
  {
    criteria: 'Recent Pain Point',
    description: 'Experienced slow response to strategic event in past 12 months',
    icon: Target,
    importance: 'Preferred'
  },
  {
    criteria: 'Multi-Department',
    description: 'Strategic events require 4+ departments to coordinate',
    icon: Users,
    importance: 'Preferred'
  },
  {
    criteria: 'Growth Intent',
    description: 'Committed to enterprise rollout if pilot succeeds',
    icon: TrendingUp,
    importance: 'Preferred'
  }
];

const roiCalculator = [
  {
    metric: 'Hours Saved per Event',
    baseline: '20-50 hours',
    withM: '0 hours (pre-planned)',
    calculation: '20-50  $500/hr executive time',
    value: '$10,000-$25,000'
  },
  {
    metric: 'Response Time',
    baseline: '72+ hours to full coordination',
    withM: '12 minutes to full coordination',
    calculation: 'Revenue protected by faster response',
    value: '$500K-$2M per major event'
  },
  {
    metric: 'C-Suite Time Recovery',
    baseline: '50+ hours per event',
    withM: '5 hours oversight only',
    calculation: '45 hours  $1,000/hr',
    value: '$45,000+ per event'
  },
  {
    metric: 'Tool Consolidation',
    baseline: 'Multiple point solutions',
    withM: 'Single execution platform',
    calculation: 'Reduced platform licensing',
    value: '$50-100K annually'
  }
];

const conversionTerms = [
  {
    term: '100% Pilot Credit',
    description: 'Full pilot investment applies to enterprise contract',
    icon: DollarSign
  },
  {
    term: 'Preferred Pricing',
    description: 'Founding partner rates locked for 3 years',
    icon: Star
  },
  {
    term: 'Priority Roadmap',
    description: 'Input on feature development priorities',
    icon: Target
  },
  {
    term: 'Enterprise SLA',
    description: '99.9% uptime, 2-hour priority support',
    icon: Shield
  }
];

export default function PilotProgram() {
  const [, setLocation] = useLocation();

  useEffect(() => {
    updatePageMetadata({
      title: "90-Day Pilot Program - M | Strategic Execution OS",
      description: "Validate M's 12-minute coordination claim with a structured 90-day pilot. Includes 5 playbooks, Jira integration, and dedicated success manager. 100% credit applies to enterprise contract.",
      ogTitle: "M Pilot Program | 90 Days to Transform Strategic Execution",
      ogDescription: "Fortune 1000 pilot program with ROI measurement, live activation, and clear conversion path.",
    });
  }, []);

  return (
    <PageLayout>
      <div className="bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-950 dark:via-slate-900 dark:to-blue-950">
        
        {/* Hero Section */}
        <section className="py-16 px-6 bg-gradient-to-br from-slate-900 via-slate-800 to-emerald-900">
          <div className="max-w-6xl mx-auto text-center">
            <Badge className="mb-6 bg-emerald-600/20 text-emerald-300 border-emerald-500/30" data-testid="badge-pilot">
              Fortune 1000 Design Partner Program
            </Badge>
            <h1 className="text-4xl md:text-5xl font-bold text-white mb-6" data-testid="heading-pilot-program">
              90-Day Pilot Program
              <span className="block text-emerald-400 mt-2">Validate Before You Commit</span>
            </h1>
            <p className="text-xl text-slate-300 max-w-3xl mx-auto mb-8">
              Prove M's 12-minute coordination claim with real activations in your environment. 
              Structured phases, measurable outcomes, and a clear path to enterprise deployment.
            </p>
            
            {/* Key Stats */}
            <div className="flex flex-wrap justify-center gap-6 mb-8">
              <div className="bg-white/10 backdrop-blur-sm rounded-lg px-6 py-3 text-center">
                <div className="text-2xl font-bold text-white">90</div>
                <div className="text-xs text-slate-300">Days</div>
              </div>
              <div className="bg-white/10 backdrop-blur-sm rounded-lg px-6 py-3 text-center">
                <div className="text-2xl font-bold text-white">5</div>
                <div className="text-xs text-slate-300">Playbooks</div>
              </div>
              <div className="bg-white/10 backdrop-blur-sm rounded-lg px-6 py-3 text-center">
                <div className="text-2xl font-bold text-white">25</div>
                <div className="text-xs text-slate-300">Users</div>
              </div>
              <div className="bg-white/10 backdrop-blur-sm rounded-lg px-6 py-3 text-center">
                <div className="text-2xl font-bold text-white">100%</div>
                <div className="text-xs text-slate-300">Credit Applied</div>
              </div>
            </div>

            <div className="flex flex-wrap justify-center gap-4">
              <Button 
                size="lg" 
                className="bg-emerald-600 hover:bg-emerald-700"
                onClick={() => setLocation('/contact')}
                data-testid="button-apply-pilot"
              >
                <Rocket className="w-5 h-5 mr-2" />
                Apply for Pilot Program
              </Button>
              <Button 
                size="lg" 
                variant="outline" 
                className="border-white/30 text-white hover:bg-white/10"
                onClick={() => setLocation('/demo/live-activation')}
                data-testid="button-see-demo"
              >
                <Play className="w-5 h-5 mr-2" />
                See Demo First
              </Button>
            </div>
          </div>
        </section>

        {/* 4-Phase Timeline */}
        <section className="py-16 px-6">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-phases">
                Structured 90-Day Journey
              </h2>
              <p className="text-lg text-slate-600 dark:text-slate-400">
                Crawl, walk, run methodology with clear milestones and success criteria
              </p>
            </div>

            {/* Timeline Visual */}
            <div className="relative mb-12">
              <div className="absolute left-0 right-0 top-1/2 h-1 bg-slate-200 dark:bg-slate-700 -translate-y-1/2 hidden md:block"></div>
              <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                {pilotPhases.map((phase, i) => (
                  <div key={i} className="relative" data-testid={`phase-${i}`}>
                    <div className="flex flex-col items-center">
                      <div className={`w-12 h-12 rounded-full ${phase.color} flex items-center justify-center text-white font-bold z-10 mb-4`}>
                        {i + 1}
                      </div>
                      <Card className="w-full">
                        <CardHeader className="pb-2 text-center">
                          <Badge className={`${phase.color} text-white mb-2`}>{phase.duration}</Badge>
                          <CardTitle className="text-lg">{phase.name}</CardTitle>
                        </CardHeader>
                        <CardContent className="text-sm">
                          <ul className="space-y-1 mb-4">
                            {phase.activities.slice(0, 3).map((activity, j) => (
                              <li key={j} className="text-slate-600 dark:text-slate-400 flex items-start gap-2">
                                <CheckCircle className="w-3 h-3 text-emerald-500 mt-1 flex-shrink-0" />
                                <span className="text-xs">{activity}</span>
                              </li>
                            ))}
                          </ul>
                          <div className="border-t pt-3">
                            <div className="text-xs font-semibold text-blue-600 dark:text-blue-400 mb-1">Success Metric</div>
                            <p className="text-xs text-slate-500 dark:text-slate-500">{phase.successMetrics}</p>
                          </div>
                        </CardContent>
                      </Card>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </section>

        {/* What's Included */}
        <section className="py-16 px-6 bg-slate-100 dark:bg-slate-900/50">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-inclusions">
                What's Included
              </h2>
              <p className="text-lg text-slate-600 dark:text-slate-400">
                Everything you need to validate M in your environment
              </p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              {pilotInclusions.map((inclusion, i) => (
                <Card key={i} className="hover:shadow-lg transition-shadow" data-testid={`card-inclusion-${i}`}>
                  <CardHeader className="pb-2">
                    <div className="flex items-center gap-3">
                      <div className="p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30">
                        <inclusion.icon className="w-5 h-5 text-blue-600 dark:text-blue-400" />
                      </div>
                      <CardTitle className="text-base">{inclusion.category}</CardTitle>
                    </div>
                  </CardHeader>
                  <CardContent>
                    <ul className="space-y-2">
                      {inclusion.items.map((item, j) => (
                        <li key={j} className="text-sm text-slate-600 dark:text-slate-400 flex items-start gap-2">
                          <CheckCircle className="w-4 h-4 text-emerald-500 mt-0.5 flex-shrink-0" />
                          {item}
                        </li>
                      ))}
                    </ul>
                  </CardContent>
                </Card>
              ))}
            </div>
          </div>
        </section>

        {/* Ideal Candidates */}
        <section className="py-16 px-6">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-candidates">
                Ideal Pilot Candidates
              </h2>
              <p className="text-lg text-slate-600 dark:text-slate-400">
                Organizations positioned to maximize pilot value
              </p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {idealCandidates.map((candidate, i) => (
                <Card key={i} className="hover:shadow-lg transition-shadow" data-testid={`card-candidate-${i}`}>
                  <CardContent className="p-6">
                    <div className="flex items-start gap-4">
                      <div className="p-2 rounded-lg bg-slate-100 dark:bg-slate-800">
                        <candidate.icon className="w-5 h-5 text-slate-600 dark:text-slate-400" />
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center justify-between mb-2">
                          <h3 className="font-semibold text-slate-900 dark:text-white">{candidate.criteria}</h3>
                          <Badge variant={candidate.importance === 'Required' ? 'default' : 'outline'} className={candidate.importance === 'Required' ? 'bg-blue-600' : ''}>
                            {candidate.importance}
                          </Badge>
                        </div>
                        <p className="text-sm text-slate-600 dark:text-slate-400">{candidate.description}</p>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </div>
        </section>

        {/* ROI Measurement Framework */}
        <section className="py-16 px-6 bg-gradient-to-br from-blue-900 to-purple-900">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl font-bold text-white mb-4" data-testid="heading-roi">
                ROI Measurement Framework
              </h2>
              <p className="text-lg text-blue-200">
                Quantified value capture at every milestone
              </p>
            </div>

            <Card className="bg-white/10 backdrop-blur-sm border-white/20" data-testid="card-roi-framework">
              <CardContent className="p-0 overflow-x-auto">
                <table className="w-full min-w-[800px]">
                  <thead>
                    <tr className="border-b border-white/20">
                      <th className="text-left p-4 font-semibold text-white">Value Metric</th>
                      <th className="text-left p-4 font-semibold text-red-300">Before M</th>
                      <th className="text-left p-4 font-semibold text-emerald-300">With M</th>
                      <th className="text-left p-4 font-semibold text-blue-300">Calculation</th>
                      <th className="text-right p-4 font-semibold text-amber-300">Value Captured</th>
                    </tr>
                  </thead>
                  <tbody>
                    {roiCalculator.map((row, i) => (
                      <tr key={i} className="border-b border-white/10 last:border-0">
                        <td className="p-4 text-white font-medium">{row.metric}</td>
                        <td className="p-4 text-red-200">{row.baseline}</td>
                        <td className="p-4 text-emerald-200">{row.withM}</td>
                        <td className="p-4 text-blue-200 text-sm">{row.calculation}</td>
                        <td className="p-4 text-amber-300 font-bold text-right">{row.value}</td>
                      </tr>
                    ))}
                  </tbody>
                  <tfoot>
                    <tr className="bg-white/10">
                      <td colSpan={4} className="p-4 text-white font-bold text-right">Total Value per Major Event:</td>
                      <td className="p-4 text-2xl font-bold text-amber-300 text-right">$60K - $2M+</td>
                    </tr>
                  </tfoot>
                </table>
              </CardContent>
            </Card>
          </div>
        </section>

        {/* Conversion Terms */}
        <section className="py-16 px-6">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-conversion">
                Pilot to Production Path
              </h2>
              <p className="text-lg text-slate-600 dark:text-slate-400">
                Founding partner benefits for pilot participants
              </p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              {conversionTerms.map((term, i) => (
                <Card key={i} className="bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-800 dark:to-slate-900 border-2 border-emerald-200 dark:border-emerald-900 hover:border-emerald-400 dark:hover:border-emerald-700 transition-colors" data-testid={`card-term-${i}`}>
                  <CardContent className="p-6 text-center">
                    <div className="p-3 rounded-xl bg-emerald-100 dark:bg-emerald-900/30 inline-block mb-4">
                      <term.icon className="w-6 h-6 text-emerald-600 dark:text-emerald-400" />
                    </div>
                    <h3 className="font-bold text-slate-900 dark:text-white mb-2">{term.term}</h3>
                    <p className="text-sm text-slate-600 dark:text-slate-400">{term.description}</p>
                  </CardContent>
                </Card>
              ))}
            </div>
          </div>
        </section>

        {/* Success Stories Preview */}
        <section className="py-16 px-6 bg-slate-100 dark:bg-slate-900/50">
          <div className="max-w-4xl mx-auto">
            <Card className="overflow-hidden" data-testid="card-success-preview">
              <CardContent className="p-8">
                <div className="flex items-start gap-6">
                  <div className="p-4 rounded-xl bg-blue-100 dark:bg-blue-900/30">
                    <Award className="w-10 h-10 text-blue-600 dark:text-blue-400" />
                  </div>
                  <div>
                    <Badge className="mb-3 bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300">
                      Pilot Success Target
                    </Badge>
                    <h3 className="text-2xl font-bold text-slate-900 dark:text-white mb-4">
                      What Success Looks Like
                    </h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="flex items-center gap-3">
                        <CheckCircle className="w-5 h-5 text-emerald-500" />
                        <span className="text-slate-700 dark:text-slate-300">At least 1 live activation under 15 minutes</span>
                      </div>
                      <div className="flex items-center gap-3">
                        <CheckCircle className="w-5 h-5 text-emerald-500" />
                        <span className="text-slate-700 dark:text-slate-300">5+ playbooks customized and operational</span>
                      </div>
                      <div className="flex items-center gap-3">
                        <CheckCircle className="w-5 h-5 text-emerald-500" />
                        <span className="text-slate-700 dark:text-slate-300">Quantified ROI with executive sign-off</span>
                      </div>
                      <div className="flex items-center gap-3">
                        <CheckCircle className="w-5 h-5 text-emerald-500" />
                        <span className="text-slate-700 dark:text-slate-300">Clear expansion plan for enterprise rollout</span>
                      </div>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </section>

        {/* CTA Section */}
        <section className="py-16 px-6">
          <div className="max-w-4xl mx-auto text-center">
            <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4" data-testid="heading-cta">
              Ready to Validate Strategic Execution?
            </h2>
            <p className="text-lg text-slate-600 dark:text-slate-400 mb-8">
              Limited to 5 design partners in Q1 2025. Priority given to organizations with recent strategic event pain.
            </p>
            <div className="flex flex-wrap justify-center gap-4">
              <Button 
                size="lg" 
                className="bg-emerald-600 hover:bg-emerald-700"
                onClick={() => setLocation('/contact')}
                data-testid="button-cta-apply"
              >
                <Rocket className="w-5 h-5 mr-2" />
                Apply for Pilot Program
              </Button>
              <Button 
                size="lg" 
                variant="outline"
                onClick={() => setLocation('/competitive-positioning')}
                data-testid="button-cta-positioning"
              >
                <FileText className="w-5 h-5 mr-2" />
                View Competitive Positioning
              </Button>
            </div>
            <p className="text-sm text-slate-500 dark:text-slate-500 mt-6">
              Questions? Contact us at <span className="text-blue-600 dark:text-blue-400">pilots@m-strategic.com</span>
            </p>
          </div>
        </section>

      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/PlaybookActivationConsole.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useEffect, useState } from "react";
import { useRoute, Link } from "wouter";
import { useQuery, useMutation } from "@tanstack/react-query";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Textarea } from "@/components/ui/textarea";
import { 
  Clock, 
  AlertTriangle, 
  Target, 
  Users, 
  CheckCircle2, 
  Circle, 
  PlayCircle,
  PauseCircle,
  Trophy,
  MessageSquare,
  Zap
} from "lucide-react";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";
import DecisionConfidenceScore from "@/components/DecisionConfidenceScore";
import StakeholderAlignmentDashboard from "@/components/StakeholderAlignmentDashboard";
import ExecutionValidationReport from "@/components/ExecutionValidationReport";
import PlaybookLearningsPanel from "@/components/playbook/PlaybookLearningsPanel";

interface ExecutionCheckpoint {
  id: string;
  title: string;
  description: string;
  assignedRole: string;
  status: 'pending' | 'in_progress' | 'completed';
  estimatedMinutes: number;
  completedAt?: Date;
}

export default function PlaybookActivationConsole() {
  const [, params] = useRoute("/playbook-activation/:triggerId/:playbookId");
  const { toast } = useToast();
  const [executionStartTime] = useState(new Date());
  const [elapsedSeconds, setElapsedSeconds] = useState(0);
  const [notes, setNotes] = useState("");
  const [executionStatus, setExecutionStatus] = useState<'active' | 'paused' | 'completed'>('active');
  const [executionId] = useState(`exec-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`);

  // Fetch trigger details (skip for manual executions)
  const isManualExecution = params?.triggerId === 'manual';
  const { data: trigger } = useQuery<any>({
    queryKey: ['/api/executive-triggers', params?.triggerId],
    enabled: !!params?.triggerId && !isManualExecution,
  });

  // Fetch playbook details
  const { data: playbook } = useQuery<any>({
    queryKey: ['/api/scenarios', params?.playbookId],
    enabled: !!params?.playbookId,
  });

  // Fetch tasks for this playbook
  const { data: tasks = [] } = useQuery<any[]>({
    queryKey: [`/api/tasks?playbookId=${params?.playbookId}`],
    enabled: !!params?.playbookId,
  });

  // Countdown timer
  useEffect(() => {
    if (executionStatus !== 'active') return;
    
    const interval = setInterval(() => {
      setElapsedSeconds(Math.floor((new Date().getTime() - executionStartTime.getTime()) / 1000));
    }, 1000);

    return () => clearInterval(interval);
  }, [executionStartTime, executionStatus]);

  // Complete execution mutation
  const completeExecutionMutation = useMutation({
    mutationFn: async () => {
      const executionTime = Math.floor(elapsedSeconds / 60);
      const prevCount = playbook?.executionCount || 0;
      const prevAvg = playbook?.averageExecutionTime || 0;
      
      // Calculate weighted rolling average: (prevAvg * prevCount + newTime) / (prevCount + 1)
      const newAverage = prevCount > 0
        ? Math.round((prevAvg * prevCount + executionTime) / (prevCount + 1))
        : executionTime;
      
      // Update scenario with execution data
      const response1 = await fetch(`/api/scenarios/${params?.playbookId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          executionCount: prevCount + 1,
          averageExecutionTime: newAverage,
          lastTriggered: new Date().toISOString(),
        }),
      });
      
      if (!response1.ok) throw new Error('Failed to update scenario');

      // Update trigger status back to green (only for trigger-based executions)
      if (!isManualExecution) {
        const response2 = await fetch(`/api/executive-triggers/${params?.triggerId}/status`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            status: 'green',
            currentValue: null,
          }),
        });
        
        if (!response2.ok) throw new Error('Failed to update trigger status');
      }
    },
    onSuccess: () => {
      queryClient.refetchQueries({ queryKey: ['/api/scenarios'], exact: false });
      queryClient.refetchQueries({ queryKey: ['/api/executive-triggers'], exact: false });
      setExecutionStatus('completed');
      toast({
        title: " Playbook Execution Completed",
        description: `Executed in ${formatTime(elapsedSeconds)}`,
      });
    },
  });

  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}m ${secs}s`;
  };

  const safeTasks = tasks || [];
  const completedTasks = safeTasks.filter((t: any) => t.status === 'completed').length;
  const progressPercent = safeTasks.length > 0 ? (completedTasks / safeTasks.length) * 100 : 0;
  
  // Decision Velocity Metrics
  const targetTime = 12; // 12 minutes target
  const elapsedMinutes = elapsedSeconds / 60;
  const isOnTrack = elapsedMinutes <= targetTime;
  const industryStandard = 72 * 60; // 72 hours in minutes
  const timeSaved = industryStandard - elapsedMinutes;

  // For manual executions, only wait for playbook. For trigger-based, wait for both.
  if (!playbook || (!isManualExecution && !trigger)) {
    return <div className="p-6">Loading activation console...</div>;
  }

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900">
      <div className="container mx-auto p-6 space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3">
              <AlertTriangle className="h-8 w-8 text-red-600" />
              Execute Your Playbook
            </h1>
            <p className="text-gray-600 dark:text-gray-300 mt-1">
              Make the call. Rally your team. Win the moment.
            </p>
          </div>
          <Link href="/triggers-management">
            <Button variant="outline" data-testid="button-back-triggers">
              Back to Triggers
            </Button>
          </Link>
        </div>

        {/* Time Compression Banner - Shows benchmark comparison */}
        <Card className="bg-gradient-to-r from-blue-50 via-purple-50 to-blue-50 dark:from-blue-950/30 dark:via-purple-950/30 dark:to-blue-950/30 border-2 border-blue-400 dark:border-blue-600">
          <CardContent className="p-4">
            <div className="flex items-center justify-between">
              <div className="text-sm text-muted-foreground">
                <strong>Industry Benchmark:</strong> Traditional coordination takes 72 hours on average.
                <strong className="ml-2">M Target:</strong> 12 minutes or less.
              </div>
              <div className="flex items-center gap-2 text-sm">
                {elapsedMinutes > 0 && (
                  <Badge variant={isOnTrack ? "default" : "secondary"} className={isOnTrack ? "bg-green-600" : "bg-yellow-600"}>
                    {isOnTrack ? ' On Track for 12 Min Target' : ' Exceeding 12 Min Target'}
                  </Badge>
                )}
                {elapsedMinutes === 0 && (
                  <Badge variant="outline">Execution will start when you begin</Badge>
                )}
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Execution Timer & Status */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <Card className="bg-gradient-to-br from-red-500 to-orange-600 text-white">
            <CardHeader className="pb-3">
              <CardTitle className="text-sm font-medium flex items-center gap-2">
                <Clock className="h-4 w-4" />
                Execution Time
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-4xl font-bold" data-testid="text-execution-time">
                {formatTime(elapsedSeconds)}
              </div>
              <p className="text-xs mt-1 opacity-90">
                {executionStatus === 'active' ? 'In Progress' : executionStatus === 'paused' ? 'Paused' : 'Completed'}
              </p>
            </CardContent>
          </Card>

          <Card className={isOnTrack ? 'bg-gradient-to-br from-green-500 to-emerald-600 text-white' : 'bg-gradient-to-br from-yellow-500 to-amber-600 text-white'}>
            <CardHeader className="pb-3">
              <CardTitle className="text-sm font-medium flex items-center gap-2">
                <Target className="h-4 w-4" />
                Target: 12 Minutes
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-4xl font-bold" data-testid="text-target-status">
                {isOnTrack ? 'On Track' : 'Behind'}
              </div>
              <p className="text-xs mt-1 opacity-90">
                {Math.max(0, targetTime - elapsedMinutes).toFixed(1)} min remaining
              </p>
            </CardContent>
          </Card>

          <Card className="bg-gradient-to-br from-blue-500 to-cyan-600 text-white">
            <CardHeader className="pb-3">
              <CardTitle className="text-sm font-medium flex items-center gap-2">
                <Zap className="h-4 w-4" />
                Decision Velocity Target
              </CardTitle>
            </CardHeader>
            <CardContent>
              {elapsedMinutes > 0 ? (
                <>
                  <div className="text-4xl font-bold" data-testid="text-velocity-multiplier">
                    {(industryStandard / elapsedMinutes).toFixed(0)}x
                  </div>
                  <p className="text-xs mt-1 opacity-90">
                    faster than 72hr standard
                  </p>
                </>
              ) : (
                <>
                  <div className="text-2xl font-bold" data-testid="text-velocity-target">
                    360x+
                  </div>
                  <p className="text-xs mt-1 opacity-90">
                    target vs 72hr standard
                  </p>
                </>
              )}
            </CardContent>
          </Card>

          <Card className="bg-gradient-to-br from-purple-500 to-pink-600 text-white">
            <CardHeader className="pb-3">
              <CardTitle className="text-sm font-medium flex items-center gap-2">
                <Trophy className="h-4 w-4" />
                Time Savings Target
              </CardTitle>
            </CardHeader>
            <CardContent>
              {elapsedMinutes > 0 ? (
                <>
                  <div className="text-4xl font-bold" data-testid="text-time-saved">
                    {Math.floor(timeSaved / 60)}h
                  </div>
                  <p className="text-xs mt-1 opacity-90">
                    {(timeSaved % 60).toFixed(0)} min saved so far
                  </p>
                </>
              ) : (
                <>
                  <div className="text-2xl font-bold" data-testid="text-time-saved-target">
                    ~72 Hours
                  </div>
                  <p className="text-xs mt-1 opacity-90">
                    target savings vs industry
                  </p>
                </>
              )}
            </CardContent>
          </Card>
        </div>

        {/* Trigger & Playbook Info */}
        <div className={`grid grid-cols-1 ${isManualExecution ? 'md:grid-cols-1' : 'md:grid-cols-2'} gap-6`}>
          {!isManualExecution && trigger && (
            <Card className="border-2 border-red-200 dark:border-red-800">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <AlertTriangle className="h-5 w-5 text-red-600" />
                  Trigger Alert
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-3">
                <div>
                  <div className="text-sm text-gray-600 dark:text-gray-400">Trigger Name</div>
                  <div className="font-semibold" data-testid="text-trigger-name">{trigger.name}</div>
                </div>
                <div>
                  <div className="text-sm text-gray-600 dark:text-gray-400">Description</div>
                  <div className="text-sm">{trigger.description}</div>
                </div>
                <div>
                  <div className="text-sm text-gray-600 dark:text-gray-400">Current Status</div>
                  <Badge variant={trigger?.currentStatus === 'red' ? 'destructive' : 'secondary'} data-testid="badge-trigger-status">
                    {(trigger?.currentStatus || 'active').toUpperCase()}
                  </Badge>
                </div>
                <div>
                  <div className="text-sm text-gray-600 dark:text-gray-400">Severity</div>
                  <Badge variant={trigger.severity === 'high' || trigger.severity === 'critical' ? 'destructive' : 'default'}>
                    {trigger.severity}
                  </Badge>
                </div>
              </CardContent>
            </Card>
          )}

          <Card className="border-2 border-blue-200 dark:border-blue-800">
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <PlayCircle className="h-5 w-5 text-blue-600" />
                Active Playbook
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-3">
              <div>
                <div className="text-sm text-gray-600 dark:text-gray-400">Playbook Name</div>
                <div className="font-semibold" data-testid="text-playbook-name">{playbook.title || playbook.name}</div>
              </div>
              <div>
                <div className="text-sm text-gray-600 dark:text-gray-400">Description</div>
                <div className="text-sm">{playbook.description}</div>
              </div>
              <div>
                <div className="text-sm text-gray-600 dark:text-gray-400">Readiness</div>
                <Badge 
                  variant={playbook.readinessState === 'green' ? 'default' : playbook.readinessState === 'yellow' ? 'secondary' : 'destructive'}
                  data-testid="badge-playbook-readiness"
                >
                  {playbook.readinessState === 'green' ? ' Ready' : playbook.readinessState === 'yellow' ? ' Needs Review' : ' Requires Setup'}
                </Badge>
              </div>
              <div>
                <div className="text-sm text-gray-600 dark:text-gray-400">Average Execution</div>
                <div className="font-semibold">
                  {playbook.averageExecutionTime ? `${playbook.averageExecutionTime} minutes` : 'First execution'}
                </div>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Decision Confidence Score */}
        {params?.playbookId && (
          <DecisionConfidenceScore 
            scenarioId={params.playbookId}
            stakeholderCount={5}
            dataSourcesConnected={3}
          />
        )}

        {/* Stakeholder Alignment Dashboard - shown during active execution */}
        {executionStatus !== 'completed' && params?.playbookId && (
          <StakeholderAlignmentDashboard 
            scenarioId={params.playbookId}
            executionId={executionId}
          />
        )}

        {/* Progress Checkpoints */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center justify-between">
              <span className="flex items-center gap-2">
                <CheckCircle2 className="h-5 w-5 text-green-600" />
                Execution Progress
              </span>
              <span className="text-sm font-normal text-gray-600 dark:text-gray-400">
                {completedTasks} of {safeTasks.length} tasks completed
              </span>
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <Progress value={progressPercent} className="h-3" data-testid="progress-execution" />
            
            <div className="space-y-3">
              {safeTasks.length === 0 ? (
                <div className="text-center py-8 text-gray-500 dark:text-gray-400">
                  No tasks defined for this playbook
                </div>
              ) : (
                safeTasks.map((task: any, index: number) => (
                  <div 
                    key={task.id} 
                    className={`flex items-start gap-3 p-4 rounded-lg border-2 ${
                      task.status === 'completed' 
                        ? 'bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800' 
                        : task.status === 'in_progress'
                        ? 'bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800'
                        : 'bg-gray-50 border-gray-200 dark:bg-gray-800 dark:border-gray-700'
                    }`}
                    data-testid={`task-item-${index}`}
                  >
                    {task.status === 'completed' ? (
                      <CheckCircle2 className="h-5 w-5 text-green-600 mt-0.5 flex-shrink-0" />
                    ) : (
                      <Circle className="h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0" />
                    )}
                    <div className="flex-1 page-background">
                      <div className="font-semibold">{task.description}</div>
                      <div className="text-sm text-gray-600 dark:text-gray-400 mt-1 flex items-center gap-3">
                        {task.assignedTo && (
                          <span className="flex items-center gap-1">
                            <Users className="h-3 w-3" />
                            Assigned to: {task.assignedTo}
                          </span>
                        )}
                        {task.estimatedHours && (
                          <span className="flex items-center gap-1">
                            <Clock className="h-3 w-3" />
                            Est: {task.estimatedHours}h
                          </span>
                        )}
                      </div>
                    </div>
                    <Badge variant={task.status === 'completed' ? 'default' : task.status === 'in_progress' ? 'secondary' : 'outline'}>
                      {task.status}
                    </Badge>
                  </div>
                ))
              )}
            </div>
          </CardContent>
        </Card>

        {/* Execution Notes */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <MessageSquare className="h-5 w-5" />
              Execution Notes
            </CardTitle>
          </CardHeader>
          <CardContent>
            <Textarea 
              placeholder="Document key decisions, actions taken, or important observations during this execution..."
              value={notes}
              onChange={(e) => setNotes(e.target.value)}
              rows={4}
              className="w-full"
              data-testid="textarea-execution-notes"
            />
          </CardContent>
        </Card>

        {/* Action Buttons */}
        <div className="flex items-center justify-between gap-4">
          <div className="flex gap-3">
            {executionStatus === 'active' ? (
              <Button 
                variant="outline" 
                onClick={() => setExecutionStatus('paused')}
                data-testid="button-pause-execution"
              >
                <PauseCircle className="h-4 w-4 mr-2" />
                Pause Execution
              </Button>
            ) : executionStatus === 'paused' ? (
              <Button 
                variant="outline" 
                onClick={() => setExecutionStatus('active')}
                data-testid="button-resume-execution"
              >
                <PlayCircle className="h-4 w-4 mr-2" />
                Resume Execution
              </Button>
            ) : null}
          </div>

          <Button 
            size="lg"
            className="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700"
            disabled={executionStatus === 'completed' || completeExecutionMutation.isPending}
            onClick={() => completeExecutionMutation.mutate()}
            data-testid="button-complete-execution"
          >
            <CheckCircle2 className="h-5 w-5 mr-2" />
            {completeExecutionMutation.isPending ? 'Completing...' : 'Complete Execution'}
          </Button>
        </div>

        {/* Success Message */}
        {executionStatus === 'completed' && (
          <>
            <Card className="bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0">
              <CardContent className="pt-6">
                <div className="text-center space-y-3">
                  <Trophy className="h-16 w-16 mx-auto" />
                  <h2 className="text-3xl font-bold">Playbook Executed Successfully!</h2>
                  <p className="text-lg">
                    Completed in {formatTime(elapsedSeconds)}  {(industryStandard / Math.max(elapsedMinutes, 1)).toFixed(0)}x faster than industry standard
                  </p>
                  <p className="text-sm opacity-90">
                    You saved {Math.floor(timeSaved / 60)} hours and {(timeSaved % 60).toFixed(0)} minutes of coordination time
                  </p>
                </div>
              </CardContent>
            </Card>

            {/* Post-Execution Validation Report */}
            {params?.playbookId && (
              <>
                <ExecutionValidationReport 
                  scenarioId={params.playbookId}
                  executionId={executionId}
                  executionCompleted={true}
                />
                
                {/* AI-Powered Learning Extraction */}
                <PlaybookLearningsPanel scenarioId={params.playbookId} />
              </>
            )}
          </>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/PlaybookCommand.tsx
========================================
import { useParams, useLocation } from "wouter";
import { useMutation, useQuery } from "@tanstack/react-query";

import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { useCustomer } from "@/contexts/CustomerContext";
import { useAuth } from "@/hooks/useAuth";

import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Skeleton } from "@/components/ui/skeleton";
import { 
  Clock, 
  Play, 
  Users, 
  Sparkles, 
  DollarSign, 
  AlertTriangle,
  CheckCircle,
  ArrowLeft,
  Target,
} from "lucide-react";

import { apiRequest, queryClient } from "@/lib/queryClient";
import type { PlaybookLibrary } from "@shared/schema";

interface PlaybookDetailResponse {
  playbook: PlaybookLibrary;
  domain: { name: string; color: string } | null;
  category: { name: string } | null;
  communicationTemplates: unknown[];
  decisionTrees: unknown[];
}

export default function PlaybookCommand() {
  const { id } = useParams<{ id: string }>();
  const [, setLocation] = useLocation();
  const { organization } = useCustomer();
  const { isAuthenticated, login } = useAuth();

  const { data, isLoading } = useQuery<PlaybookDetailResponse>({
    queryKey: ["/api/playbook-library", id],
  });

  const playbook = data?.playbook;
  const domain = data?.domain;

  const startExecution = useMutation({
    mutationFn: async () => {
      const res = await apiRequest(
        "POST",
        `/api/playbook-library/${id}/execute`,
        {
          organizationId: organization?.id,
          reason: "Manual execution from Command Center",
        }
      );
      return res.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({
        queryKey: ["/api/playbook-library/telemetry"],
      });
    },
  });

  if (isLoading) {
    return (
      <>
        <StandardNav />
        <main className="max-w-4xl mx-auto px-6 py-16">
          <Card>
            <CardHeader>
              <Skeleton className="h-8 w-2/3" />
              <Skeleton className="h-4 w-1/3 mt-2" />
            </CardHeader>
            <CardContent className="space-y-4">
              <Skeleton className="h-20 w-full" />
              <Skeleton className="h-12 w-40" />
            </CardContent>
          </Card>
        </main>
        <Footer />
      </>
    );
  }

  if (!playbook) {
    return (
      <>
        <StandardNav />
        <main className="max-w-4xl mx-auto px-6 py-16 text-center">
          <AlertTriangle className="h-12 w-12 mx-auto text-amber-500 mb-4" />
          <h1 className="text-2xl font-bold mb-2">Playbook Not Found</h1>
          <p className="text-slate-600 mb-6">The requested playbook could not be located.</p>
          <Button onClick={() => setLocation("/playbooks")}>
            <ArrowLeft className="h-4 w-4 mr-2" />
            Back to Library
          </Button>
        </main>
        <Footer />
      </>
    );
  }

  return (
    <>
      <StandardNav />

      <main className="max-w-4xl mx-auto px-6 py-16">
        <Button 
          variant="ghost" 
          className="mb-6"
          onClick={() => setLocation("/playbooks")}
          data-testid="button-back"
        >
          <ArrowLeft className="h-4 w-4 mr-2" />
          Back to Library
        </Button>

        <Card className="mb-8">
          <CardHeader>
            <div className="flex items-start justify-between">
              <div>
                <CardTitle className="text-2xl" data-testid="text-playbook-name">
                  {playbook.name}
                </CardTitle>
                {domain && (
                  <CardDescription className="mt-2" data-testid="text-domain">
                    {domain.name}
                  </CardDescription>
                )}
              </div>
              {playbook.playbookNumber && (
                <Badge variant="outline" className="text-lg px-3 py-1">
                  #{playbook.playbookNumber}
                </Badge>
              )}
            </div>
          </CardHeader>

          <CardContent className="space-y-6">
            {playbook.triggerCriteria && (
              <div className="bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg p-4">
                <div className="flex items-start gap-3">
                  <Target className="h-5 w-5 text-amber-600 mt-0.5" />
                  <div>
                    <div className="font-medium text-amber-800 dark:text-amber-400 mb-1">
                      Trigger Criteria
                    </div>
                    <p className="text-amber-700 dark:text-amber-300 text-sm">
                      {playbook.triggerCriteria}
                    </p>
                  </div>
                </div>
              </div>
            )}

            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="flex items-center gap-2 text-slate-600 dark:text-slate-400">
                <Clock className="h-5 w-5" />
                <span>~12 min execution</span>
              </div>
              <div className="flex items-center gap-2 text-slate-600 dark:text-slate-400">
                <Users className="h-5 w-5" />
                <span>Human-led</span>
              </div>
              <div className="flex items-center gap-2 text-slate-600 dark:text-slate-400">
                <Sparkles className="h-5 w-5" />
                <span>AI-assisted</span>
              </div>
              {playbook.preApprovedBudget && (
                <div className="flex items-center gap-2 text-slate-600 dark:text-slate-400">
                  <DollarSign className="h-5 w-5" />
                  <span>${Number(playbook.preApprovedBudget).toLocaleString()}</span>
                </div>
              )}
            </div>

            {playbook.primaryResponseStrategy && (
              <div>
                <h3 className="font-medium mb-2">Response Strategy</h3>
                <p className="text-slate-600 dark:text-slate-400 text-sm">
                  {playbook.primaryResponseStrategy}
                </p>
              </div>
            )}

            <div className="pt-4 border-t">
              {!isAuthenticated ? (
                <div className="text-center py-4">
                  <p className="text-slate-600 mb-4">Sign in to execute this playbook</p>
                  <Button onClick={login} data-testid="button-login">
                    Sign In
                  </Button>
                </div>
              ) : !organization?.id ? (
                <div className="text-center py-4">
                  <p className="text-slate-600 mb-4">No organization configured</p>
                  <Button disabled>Configure Organization</Button>
                </div>
              ) : startExecution.isSuccess ? (
                <div className="bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800 rounded-lg p-4 flex items-center gap-3">
                  <CheckCircle className="h-6 w-6 text-green-600" />
                  <div>
                    <div className="font-medium text-green-800 dark:text-green-400">
                      Execution Started
                    </div>
                    <p className="text-green-700 dark:text-green-300 text-sm">
                      Playbook activation has been recorded. 12-minute timer started.
                    </p>
                  </div>
                </div>
              ) : (
                <Button
                  size="lg"
                  className="w-full md:w-auto"
                  onClick={() => startExecution.mutate()}
                  disabled={startExecution.isPending}
                  data-testid="button-start-execution"
                >
                  <Play className="h-5 w-5 mr-2" />
                  {startExecution.isPending ? "Starting..." : "Start Execution"}
                </Button>
              )}
            </div>
          </CardContent>
        </Card>

        {Array.isArray(playbook.tier1Stakeholders) && playbook.tier1Stakeholders.length > 0 && (
          <Card>
            <CardHeader>
              <CardTitle className="text-lg">Stakeholder Tiers</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              {Array.isArray(playbook.tier1Stakeholders) && playbook.tier1Stakeholders.length > 0 && (
                <div>
                  <Badge className="bg-red-100 text-red-700 mb-2">Tier 1 - Immediate</Badge>
                  <p className="text-sm text-slate-600">{(playbook.tier1Stakeholders as string[]).join(", ")}</p>
                </div>
              )}
              {Array.isArray(playbook.tier2Stakeholders) && playbook.tier2Stakeholders.length > 0 && (
                <div>
                  <Badge className="bg-amber-100 text-amber-700 mb-2">Tier 2 - Within 2 Hours</Badge>
                  <p className="text-sm text-slate-600">{(playbook.tier2Stakeholders as string[]).join(", ")}</p>
                </div>
              )}
              {Array.isArray(playbook.tier3Stakeholders) && playbook.tier3Stakeholders.length > 0 && (
                <div>
                  <Badge className="bg-blue-100 text-blue-700 mb-2">Tier 3 - Within 24 Hours</Badge>
                  <p className="text-sm text-slate-600">{(playbook.tier3Stakeholders as string[]).join(", ")}</p>
                </div>
              )}
            </CardContent>
          </Card>
        )}
      </main>

      <Footer />
    </>
  );
}


========================================
FILE: client/src/pages/PlaybookCustomization.tsx
========================================
import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Textarea } from '@/components/ui/textarea';
import { Switch } from '@/components/ui/switch';
import { Progress } from '@/components/ui/progress';
import { Separator } from '@/components/ui/separator';
import { useToast } from '@/hooks/use-toast';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { apiRequest } from '@/lib/queryClient';
import { Link } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import { 
  BookOpen,
  Copy,
  Edit,
  Users,
  DollarSign,
  Clock,
  Shield,
  Target,
  ArrowLeft,
  Home,
  Save,
  Check,
  ChevronRight,
  Play,
  Settings,
  AlertTriangle,
  Plus,
  Trash2,
  Search,
  Filter,
  Zap,
  TrendingUp
} from 'lucide-react';

interface PlaybookTemplate {
  id: string;
  name: string;
  category: string;
  domain: string;
  description: string;
  estimatedDuration: string;
  complexity: 'low' | 'medium' | 'high';
  stakeholderCount: number;
  tasks: number;
}

interface CustomizedPlaybook {
  id: string;
  templateId: string;
  name: string;
  description: string;
  budgetLimit: number;
  approvalRequired: boolean;
  stakeholderAssignments: Array<{
    role: string;
    assignedTo: string;
    approvalAuthority: number;
  }>;
  customTasks: string[];
  notificationPreferences: {
    onActivation: boolean;
    onTaskComplete: boolean;
    onEscalation: boolean;
  };
}

const PLAYBOOK_DOMAINS = [
  { id: 'crisis', name: 'Crisis Management', icon: AlertTriangle, color: 'text-red-500' },
  { id: 'competitive', name: 'Competitive Response', icon: Target, color: 'text-purple-500' },
  { id: 'market', name: 'Market Opportunity', icon: TrendingUp, color: 'text-blue-500' },
  { id: 'regulatory', name: 'Regulatory Compliance', icon: Shield, color: 'text-orange-500' },
  { id: 'technology', name: 'Technology', icon: Zap, color: 'text-cyan-500' },
  { id: 'talent', name: 'Talent & Workforce', icon: Users, color: 'text-pink-500' },
  { id: 'financial', name: 'Financial Response', icon: DollarSign, color: 'text-green-500' },
  { id: 'operational', name: 'Operational Excellence', icon: Settings, color: 'text-indigo-500' },
];

const SAMPLE_TEMPLATES: PlaybookTemplate[] = [
  { id: '1', name: 'Supply Chain Disruption Response', category: 'crisis', domain: 'operations', description: 'Rapid response playbook for supply chain disruptions including supplier failure, logistics issues, or natural disasters', estimatedDuration: '4-12 hours', complexity: 'high', stakeholderCount: 12, tasks: 24 },
  { id: '2', name: 'Competitive Pricing Response', category: 'competitive', domain: 'market', description: 'Quick response to aggressive competitor pricing moves or market share threats', estimatedDuration: '2-4 hours', complexity: 'medium', stakeholderCount: 8, tasks: 16 },
  { id: '3', name: 'Cybersecurity Incident Response', category: 'crisis', domain: 'technology', description: 'Comprehensive response to security breaches, ransomware, or data compromise', estimatedDuration: '1-24 hours', complexity: 'high', stakeholderCount: 15, tasks: 32 },
  { id: '4', name: 'Product Recall Execution', category: 'crisis', domain: 'operations', description: 'Coordinated product recall with regulatory notification, customer communication, and logistics', estimatedDuration: '24-72 hours', complexity: 'high', stakeholderCount: 20, tasks: 45 },
  { id: '5', name: 'Market Entry Acceleration', category: 'market', domain: 'strategy', description: 'Rapid deployment playbook for entering new markets or launching products', estimatedDuration: '2-4 weeks', complexity: 'high', stakeholderCount: 18, tasks: 38 },
  { id: '6', name: 'Regulatory Compliance Response', category: 'regulatory', domain: 'compliance', description: 'Response to new regulations, audit findings, or compliance gaps', estimatedDuration: '1-2 weeks', complexity: 'medium', stakeholderCount: 10, tasks: 20 },
  { id: '7', name: 'Talent Retention Crisis', category: 'talent', domain: 'hr', description: 'Response to key talent departures or retention challenges', estimatedDuration: '1-4 weeks', complexity: 'medium', stakeholderCount: 8, tasks: 18 },
  { id: '8', name: 'Financial Liquidity Response', category: 'financial', domain: 'finance', description: 'Emergency response to cash flow challenges or financial stress', estimatedDuration: '24-48 hours', complexity: 'high', stakeholderCount: 12, tasks: 25 },
];

export default function PlaybookCustomization() {
  const { toast } = useToast();
  const queryClient = useQueryClient();
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedDomain, setSelectedDomain] = useState<string>('all');
  const [isCustomizationDialogOpen, setIsCustomizationDialogOpen] = useState(false);
  const [selectedTemplate, setSelectedTemplate] = useState<PlaybookTemplate | null>(null);
  
  // Customization form state
  const [customName, setCustomName] = useState('');
  const [customDescription, setCustomDescription] = useState('');
  const [budgetLimit, setBudgetLimit] = useState('');
  const [approvalRequired, setApprovalRequired] = useState(true);
  const [customizationStep, setCustomizationStep] = useState(1);
  
  // Stakeholder assignments
  const [stakeholderAssignments, setStakeholderAssignments] = useState<Array<{role: string; assignedTo: string; approvalAuthority: number}>>([]);
  
  // Fetch playbooks from API
  const { data: playbooks, isLoading } = useQuery({
    queryKey: ['/api/playbooks'],
  });
  
  // Mutation for saving customized playbooks
  const savePlaybookMutation = useMutation({
    mutationFn: async (customizedPlaybook: CustomizedPlaybook) => {
      return apiRequest('POST', '/api/scenarios', {
        title: customizedPlaybook.name,
        description: customizedPlaybook.description,
        category: selectedTemplate?.category || 'custom',
        status: 'preparing',
        budgetLimit: customizedPlaybook.budgetLimit,
        approvalRequired: customizedPlaybook.approvalRequired,
        stakeholderAssignments: customizedPlaybook.stakeholderAssignments,
        notificationPreferences: customizedPlaybook.notificationPreferences,
        templateId: customizedPlaybook.templateId,
      });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbooks'] });
      queryClient.invalidateQueries({ queryKey: ['/api/scenarios'] });
      toast({ 
        title: 'Playbook Customized', 
        description: `"${customName}" has been saved to your organization's playbook library`,
      });
      setIsCustomizationDialogOpen(false);
      setSelectedTemplate(null);
    },
    onError: () => {
      toast({ 
        title: 'Error', 
        description: 'Failed to save playbook customization. Please try again.',
        variant: 'destructive',
      });
    },
  });
  
  const templates = Array.isArray(playbooks) && playbooks.length > 0 
    ? playbooks.map((p: any) => ({
        id: p.id,
        name: p.name || p.title,
        category: p.category || 'general',
        domain: p.domain || 'general',
        description: p.description || '',
        estimatedDuration: p.estimatedDuration || '4-12 hours',
        complexity: p.complexity || 'medium',
        stakeholderCount: p.stakeholderCount || 10,
        tasks: p.tasksCount || 20,
      }))
    : SAMPLE_TEMPLATES;
  
  const filteredTemplates = templates.filter((template: PlaybookTemplate) => {
    const matchesSearch = template.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                          template.description.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesDomain = selectedDomain === 'all' || template.category === selectedDomain;
    return matchesSearch && matchesDomain;
  });
  
  const handleStartCustomization = (template: PlaybookTemplate) => {
    setSelectedTemplate(template);
    setCustomName(template.name);
    setCustomDescription(template.description);
    setStakeholderAssignments([
      { role: 'Executive Sponsor', assignedTo: '', approvalAuthority: 1000000 },
      { role: 'Decision Maker', assignedTo: '', approvalAuthority: 500000 },
      { role: 'Primary Executor', assignedTo: '', approvalAuthority: 100000 },
    ]);
    setCustomizationStep(1);
    setIsCustomizationDialogOpen(true);
  };
  
  const handleSaveCustomization = () => {
    if (!customName) {
      toast({ title: 'Error', description: 'Playbook name is required', variant: 'destructive' });
      return;
    }
    
    const customizedPlaybook: CustomizedPlaybook = {
      id: `custom-${Date.now()}`,
      templateId: selectedTemplate?.id || '',
      name: customName,
      description: customDescription,
      budgetLimit: budgetLimit ? parseFloat(budgetLimit) : 0,
      approvalRequired,
      stakeholderAssignments,
      customTasks: [],
      notificationPreferences: {
        onActivation: true,
        onTaskComplete: true,
        onEscalation: true,
      },
    };
    
    savePlaybookMutation.mutate(customizedPlaybook);
  };
  
  const addStakeholderRole = () => {
    setStakeholderAssignments([
      ...stakeholderAssignments,
      { role: '', assignedTo: '', approvalAuthority: 50000 }
    ]);
  };
  
  const removeStakeholderRole = (index: number) => {
    setStakeholderAssignments(stakeholderAssignments.filter((_, i) => i !== index));
  };
  
  const getComplexityColor = (complexity: string) => {
    switch (complexity) {
      case 'low': return 'bg-green-500/20 text-green-400 border-green-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30';
      case 'high': return 'bg-red-500/20 text-red-400 border-red-500/30';
      default: return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
    }
  };

  return (
    <PageLayout>
      <div className="page-background min-h-screen bg-transparent p-6">
        <div className="max-w-7xl mx-auto space-y-8">
          
          {/* Breadcrumb Navigation */}
          <div className="mb-6">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>Configuration</span>
              <span>/</span>
              <span className="text-white">Playbook Customization</span>
            </div>
          </div>

          {/* Header */}
          <div className="bg-gradient-to-r from-emerald-600 to-teal-600 text-white p-6 rounded-lg">
            <div className="flex items-center justify-between">
              <div className="flex items-center space-x-4">
                <div className="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                  <BookOpen className="w-7 h-7 text-white" />
                </div>
                <div>
                  <h1 className="text-3xl font-bold" data-testid="playbook-customization-title">Playbook Customization</h1>
                  <p className="text-emerald-100 mt-1">Clone templates and customize for YOUR organization</p>
                  <p className="text-emerald-200 mt-1 text-sm">Assign your stakeholders, set budgets, and configure execution parameters</p>
                </div>
              </div>
              <div className="flex items-center gap-4">
                <Link to="/">
                  <Button variant="secondary" className="bg-emerald-700 hover:bg-emerald-800 text-emerald-100 border-emerald-600">
                    <ArrowLeft className="h-4 w-4 mr-2" />
                    Dashboard
                  </Button>
                </Link>
              </div>
            </div>
          </div>

          {/* Stats */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <Card className="bg-gray-800/50 border-gray-700">
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm text-gray-400">Total Templates</p>
                    <p className="text-2xl font-bold text-white">{templates.length}</p>
                  </div>
                  <BookOpen className="h-8 w-8 text-emerald-500" />
                </div>
              </CardContent>
            </Card>
            <Card className="bg-gray-800/50 border-gray-700">
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm text-gray-400">Customized</p>
                    <p className="text-2xl font-bold text-white">3</p>
                  </div>
                  <Edit className="h-8 w-8 text-blue-500" />
                </div>
              </CardContent>
            </Card>
            <Card className="bg-gray-800/50 border-gray-700">
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm text-gray-400">Active</p>
                    <p className="text-2xl font-bold text-white">2</p>
                  </div>
                  <Play className="h-8 w-8 text-green-500" />
                </div>
              </CardContent>
            </Card>
            <Card className="bg-gray-800/50 border-gray-700">
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm text-gray-400">Domains</p>
                    <p className="text-2xl font-bold text-white">8</p>
                  </div>
                  <Target className="h-8 w-8 text-purple-500" />
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Search and Filter */}
          <div className="flex flex-col md:flex-row gap-4">
            <div className="relative flex-1">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
              <Input 
                placeholder="Search playbook templates..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="pl-10 bg-gray-800/50 border-gray-700"
                data-testid="input-search-playbooks"
              />
            </div>
            <Select value={selectedDomain} onValueChange={setSelectedDomain}>
              <SelectTrigger className="w-48 bg-gray-800/50 border-gray-700">
                <Filter className="h-4 w-4 mr-2" />
                <SelectValue placeholder="All Domains" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">All Domains</SelectItem>
                {PLAYBOOK_DOMAINS.map((domain) => (
                  <SelectItem key={domain.id} value={domain.id}>{domain.name}</SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Domain Quick Filters */}
          <div className="flex flex-wrap gap-2">
            <Button 
              variant={selectedDomain === 'all' ? 'default' : 'outline'}
              size="sm"
              onClick={() => setSelectedDomain('all')}
              className="gap-2"
            >
              All
            </Button>
            {PLAYBOOK_DOMAINS.map((domain) => {
              const Icon = domain.icon;
              return (
                <Button 
                  key={domain.id}
                  variant={selectedDomain === domain.id ? 'default' : 'outline'}
                  size="sm"
                  onClick={() => setSelectedDomain(domain.id)}
                  className="gap-2"
                >
                  <Icon className={`h-4 w-4 ${domain.color}`} />
                  {domain.name}
                </Button>
              );
            })}
          </div>

          {/* Playbook Templates Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {filteredTemplates.map((template: PlaybookTemplate) => (
              <Card key={template.id} className="bg-gray-800/50 border-gray-700 hover:border-emerald-500/50 transition-all">
                <CardHeader className="pb-2">
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <CardTitle className="text-white text-lg">{template.name}</CardTitle>
                      <CardDescription className="mt-1 text-gray-400 line-clamp-2">
                        {template.description}
                      </CardDescription>
                    </div>
                  </div>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex flex-wrap gap-2">
                    <Badge className={getComplexityColor(template.complexity)}>
                      {template.complexity} complexity
                    </Badge>
                    <Badge variant="outline" className="text-gray-400">
                      {template.category}
                    </Badge>
                  </div>
                  
                  <div className="grid grid-cols-3 gap-2 text-sm">
                    <div className="flex items-center gap-1 text-gray-400">
                      <Clock className="h-4 w-4" />
                      <span>{template.estimatedDuration}</span>
                    </div>
                    <div className="flex items-center gap-1 text-gray-400">
                      <Users className="h-4 w-4" />
                      <span>{template.stakeholderCount}</span>
                    </div>
                    <div className="flex items-center gap-1 text-gray-400">
                      <Target className="h-4 w-4" />
                      <span>{template.tasks} tasks</span>
                    </div>
                  </div>
                  
                  <Button 
                    className="w-full bg-emerald-600 hover:bg-emerald-700"
                    onClick={() => handleStartCustomization(template)}
                    data-testid={`button-customize-${template.id}`}
                  >
                    <Copy className="h-4 w-4 mr-2" />
                    Clone & Customize
                  </Button>
                </CardContent>
              </Card>
            ))}
          </div>

          {filteredTemplates.length === 0 && (
            <Card className="bg-gray-800/50 border-gray-700">
              <CardContent className="p-12 text-center">
                <BookOpen className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                <h3 className="text-lg font-semibold text-white mb-2">No Playbooks Found</h3>
                <p className="text-gray-400">Try adjusting your search or filter criteria</p>
              </CardContent>
            </Card>
          )}

          {/* Customization Dialog */}
          <Dialog open={isCustomizationDialogOpen} onOpenChange={setIsCustomizationDialogOpen}>
            <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle className="flex items-center gap-2">
                  <Copy className="h-5 w-5 text-emerald-500" />
                  Customize Playbook
                </DialogTitle>
                <DialogDescription>
                  Customize "{selectedTemplate?.name}" for your organization
                </DialogDescription>
              </DialogHeader>
              
              {/* Step Progress */}
              <div className="mb-6">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm text-gray-500">Step {customizationStep} of 3</span>
                </div>
                <Progress value={(customizationStep / 3) * 100} className="h-2" />
                <div className="flex justify-between mt-2">
                  <span className={`text-xs ${customizationStep >= 1 ? 'text-emerald-500' : 'text-gray-500'}`}>Details</span>
                  <span className={`text-xs ${customizationStep >= 2 ? 'text-emerald-500' : 'text-gray-500'}`}>Stakeholders</span>
                  <span className={`text-xs ${customizationStep >= 3 ? 'text-emerald-500' : 'text-gray-500'}`}>Settings</span>
                </div>
              </div>
              
              {/* Step 1: Basic Details */}
              {customizationStep === 1 && (
                <div className="space-y-4">
                  <div className="space-y-2">
                    <Label>Playbook Name *</Label>
                    <Input 
                      value={customName}
                      onChange={(e) => setCustomName(e.target.value)}
                      placeholder="Enter playbook name"
                      data-testid="input-custom-name"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Description</Label>
                    <Textarea 
                      value={customDescription}
                      onChange={(e) => setCustomDescription(e.target.value)}
                      placeholder="Describe this playbook..."
                      rows={3}
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Budget Limit ($)</Label>
                    <Input 
                      type="number"
                      value={budgetLimit}
                      onChange={(e) => setBudgetLimit(e.target.value)}
                      placeholder="e.g., 500000"
                    />
                    <p className="text-xs text-gray-500">Maximum budget that can be authorized during playbook execution</p>
                  </div>
                </div>
              )}
              
              {/* Step 2: Stakeholder Assignments */}
              {customizationStep === 2 && (
                <div className="space-y-4">
                  <div className="flex items-center justify-between">
                    <Label className="text-lg">Assign Stakeholders</Label>
                    <Button variant="outline" size="sm" onClick={addStakeholderRole}>
                      <Plus className="h-4 w-4 mr-2" />
                      Add Role
                    </Button>
                  </div>
                  <p className="text-sm text-gray-500">Assign people from your organization to each role in this playbook</p>
                  
                  <div className="space-y-3">
                    {stakeholderAssignments.map((assignment, idx) => (
                      <Card key={idx} className="bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700">
                        <CardContent className="p-4">
                          <div className="flex items-start gap-4">
                            <div className="flex-1 grid grid-cols-3 gap-3">
                              <div className="space-y-1">
                                <Label className="text-xs">Role</Label>
                                <Input 
                                  value={assignment.role}
                                  onChange={(e) => {
                                    const updated = [...stakeholderAssignments];
                                    updated[idx].role = e.target.value;
                                    setStakeholderAssignments(updated);
                                  }}
                                  placeholder="e.g., Executive Sponsor"
                                />
                              </div>
                              <div className="space-y-1">
                                <Label className="text-xs">Assigned To</Label>
                                <Input 
                                  value={assignment.assignedTo}
                                  onChange={(e) => {
                                    const updated = [...stakeholderAssignments];
                                    updated[idx].assignedTo = e.target.value;
                                    setStakeholderAssignments(updated);
                                  }}
                                  placeholder="Name or email"
                                />
                              </div>
                              <div className="space-y-1">
                                <Label className="text-xs">Approval Limit ($)</Label>
                                <Input 
                                  type="number"
                                  value={assignment.approvalAuthority}
                                  onChange={(e) => {
                                    const updated = [...stakeholderAssignments];
                                    updated[idx].approvalAuthority = parseInt(e.target.value) || 0;
                                    setStakeholderAssignments(updated);
                                  }}
                                />
                              </div>
                            </div>
                            <Button 
                              variant="ghost" 
                              size="icon"
                              onClick={() => removeStakeholderRole(idx)}
                              className="text-gray-400 hover:text-red-500 mt-5"
                            >
                              <Trash2 className="h-4 w-4" />
                            </Button>
                          </div>
                        </CardContent>
                      </Card>
                    ))}
                  </div>
                </div>
              )}
              
              {/* Step 3: Execution Settings */}
              {customizationStep === 3 && (
                <div className="space-y-4">
                  <Label className="text-lg">Execution Settings</Label>
                  <p className="text-sm text-gray-500">Configure how this playbook should be executed when activated</p>
                  
                  <Card className="bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700">
                    <CardContent className="p-4 space-y-4">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="font-medium">Require Approval Before Activation</p>
                          <p className="text-sm text-gray-500">Playbook must be approved by designated stakeholder before tasks begin</p>
                        </div>
                        <Switch checked={approvalRequired} onCheckedChange={setApprovalRequired} />
                      </div>
                      
                      <Separator />
                      
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="font-medium">Notify on Activation</p>
                          <p className="text-sm text-gray-500">Send notifications when playbook is activated</p>
                        </div>
                        <Switch defaultChecked />
                      </div>
                      
                      <Separator />
                      
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="font-medium">Notify on Task Completion</p>
                          <p className="text-sm text-gray-500">Send notifications as tasks are completed</p>
                        </div>
                        <Switch defaultChecked />
                      </div>
                      
                      <Separator />
                      
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="font-medium">Auto-Escalate Blocked Tasks</p>
                          <p className="text-sm text-gray-500">Automatically escalate if tasks are blocked for too long</p>
                        </div>
                        <Switch defaultChecked />
                      </div>
                    </CardContent>
                  </Card>
                  
                  {/* Summary */}
                  <Card className="bg-emerald-500/10 border-emerald-500/30">
                    <CardContent className="p-4">
                      <h4 className="font-medium text-emerald-400 mb-2">Customization Summary</h4>
                      <div className="grid grid-cols-2 gap-2 text-sm">
                        <div className="text-gray-400">Playbook Name:</div>
                        <div className="text-white">{customName}</div>
                        <div className="text-gray-400">Budget Limit:</div>
                        <div className="text-white">${parseInt(budgetLimit || '0').toLocaleString()}</div>
                        <div className="text-gray-400">Stakeholders:</div>
                        <div className="text-white">{stakeholderAssignments.length} assigned</div>
                        <div className="text-gray-400">Approval Required:</div>
                        <div className="text-white">{approvalRequired ? 'Yes' : 'No'}</div>
                      </div>
                    </CardContent>
                  </Card>
                </div>
              )}
              
              <DialogFooter className="flex justify-between">
                <Button 
                  variant="outline" 
                  onClick={() => {
                    if (customizationStep > 1) {
                      setCustomizationStep(customizationStep - 1);
                    } else {
                      setIsCustomizationDialogOpen(false);
                    }
                  }}
                >
                  {customizationStep === 1 ? 'Cancel' : 'Back'}
                </Button>
                <Button 
                  onClick={() => {
                    if (customizationStep < 3) {
                      setCustomizationStep(customizationStep + 1);
                    } else {
                      handleSaveCustomization();
                    }
                  }}
                  className="bg-emerald-600 hover:bg-emerald-700"
                  data-testid="button-next-step"
                  disabled={customizationStep === 3 && savePlaybookMutation.isPending}
                >
                  {customizationStep === 3 ? (
                    savePlaybookMutation.isPending ? (
                      <>
                        <div className="animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2" />
                        Saving...
                      </>
                    ) : (
                      <>
                        <Save className="h-4 w-4 mr-2" />
                        Save Playbook
                      </>
                    )
                  ) : (
                    <>
                      Next
                      <ChevronRight className="h-4 w-4 ml-2" />
                    </>
                  )}
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>
          
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/PlaybookCustomize.tsx
========================================
import { useState, useEffect } from "react";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Badge } from "@/components/ui/badge";
import { Switch } from "@/components/ui/switch";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import StandardNav from "@/components/layout/StandardNav";
import { useQuery, useMutation } from "@tanstack/react-query";
import { useRoute, useLocation } from "wouter";
import { useForm, useFieldArray, Controller } from "react-hook-form";
import { ArrowLeft, Plus, Trash2, Users, Clock, Target, AlertTriangle, FileText, DollarSign, TrendingUp, Shield, ArrowUpRight, ChevronDown, ChevronUp, Lock, Scale, Megaphone, Link2, Settings, Globe, GraduationCap, Calendar } from "lucide-react";
import type { Playbook } from "@shared/schema";
import { queryClient, apiRequest } from "@/lib/queryClient";
import { useCustomer } from "@/contexts/CustomerContext";
import { useToast } from "@/hooks/use-toast";
import { 
  STRATEGIC_DOMAINS_ARRAY, 
  STRATEGIC_CATEGORIES_ARRAY,
  PRIORITY_LEVELS as FRAMEWORK_PRIORITY_LEVELS
} from "@shared/constants/framework";

const DOMAINS = STRATEGIC_DOMAINS_ARRAY.map(d => d.name);

const CATEGORIES = STRATEGIC_CATEGORIES_ARRAY.map(c => ({
  value: c.id,
  label: c.name,
  description: c.description
}));

const PRIORITY_LEVELS = FRAMEWORK_PRIORITY_LEVELS.map(p => ({
  value: p.id,
  label: p.name
}));

const PLAYBOOK_STATUSES = [
  { value: "draft", label: "Draft", description: "Still being configured" },
  { value: "ready", label: "Ready", description: "Complete and ready for activation" },
  { value: "active", label: "Active", description: "Currently in use" },
  { value: "archived", label: "Archived", description: "No longer in use" }
];

const TRIGGER_SOURCES = [
  { value: "manual", label: "Manual Activation" },
  { value: "system", label: "System Detection" },
  { value: "integration", label: "Integration Alert" },
  { value: "market_data", label: "Market Data Signal" },
  { value: "news", label: "News Monitoring" },
  { value: "competitive_intelligence", label: "Competitive Intel" },
  { value: "regulatory", label: "Regulatory Filing" },
  { value: "financial", label: "Financial Threshold" }
];

const TRIGGER_SEVERITY = [
  { value: "informational", label: "Informational" },
  { value: "warning", label: "Warning" },
  { value: "urgent", label: "Urgent" },
  { value: "critical", label: "Critical" }
];

const STAKEHOLDER_ROLES = [
  "CEO", "COO", "CFO", "CLO", "CTO", "CISO", "CMO", "CHRO",
  "General Counsel", "VP Operations", "VP Strategy", "VP Communications",
  "Director of Risk", "Director of Compliance", "Project Manager",
  "Legal Counsel", "HR Director", "IT Director", "Security Lead",
  "Board Liaison", "External Counsel", "PR Agency Lead", "Crisis Consultant"
];

const ESCALATION_TRIGGERS = [
  { value: "no_response", label: "No response within time target" },
  { value: "blocked", label: "Task blocked or at risk" },
  { value: "scope_change", label: "Scope or priority change" },
  { value: "budget_exceeded", label: "Budget threshold exceeded" },
  { value: "executive_decision", label: "Executive decision required" },
  { value: "external_dependency", label: "External dependency failure" }
];

const NOTIFICATION_CHANNELS = [
  { value: "email", label: "Email" },
  { value: "slack", label: "Slack" },
  { value: "teams", label: "Teams" },
  { value: "sms", label: "SMS" },
  { value: "phone", label: "Phone" },
  { value: "in_app", label: "In-App" }
];

const TIME_TARGETS = [
  { value: 5, label: "5 min" }, { value: 10, label: "10 min" },
  { value: 15, label: "15 min" }, { value: 30, label: "30 min" },
  { value: 60, label: "1 hr" }, { value: 120, label: "2 hr" },
  { value: 240, label: "4 hr" }, { value: 480, label: "8 hr" },
  { value: 1440, label: "24 hr" }, { value: 2880, label: "48 hr" }
];

const BUDGET_CATEGORIES = [
  { value: "personnel", label: "Personnel / Overtime" },
  { value: "consulting", label: "External Consulting" },
  { value: "legal", label: "Legal Fees" },
  { value: "technology", label: "Technology / Tools" },
  { value: "communications", label: "Communications / PR" },
  { value: "travel", label: "Travel & Expenses" },
  { value: "contingency", label: "Contingency Reserve" },
  { value: "other", label: "Other" }
];

const APPROVAL_TYPES = [
  { value: "none", label: "No approval needed" },
  { value: "manager", label: "Manager approval" },
  { value: "director", label: "Director approval" },
  { value: "vp", label: "VP approval" },
  { value: "c_suite", label: "C-Suite approval" },
  { value: "board", label: "Board approval" }
];

const IMPACT_TYPES = [
  { value: "revenue_protection", label: "Revenue Protection" },
  { value: "cost_avoidance", label: "Cost Avoidance" },
  { value: "time_savings", label: "Time Savings" },
  { value: "risk_mitigation", label: "Risk Mitigation" },
  { value: "reputation_value", label: "Reputation Value" },
  { value: "compliance_value", label: "Compliance Value" },
  { value: "market_share", label: "Market Share Impact" }
];

const COMPLIANCE_FRAMEWORKS = [
  { value: "sox", label: "SOX (Sarbanes-Oxley)" },
  { value: "gdpr", label: "GDPR" },
  { value: "hipaa", label: "HIPAA" },
  { value: "pci_dss", label: "PCI-DSS" },
  { value: "iso_27001", label: "ISO 27001" },
  { value: "soc2", label: "SOC 2" },
  { value: "ccpa", label: "CCPA" },
  { value: "sec", label: "SEC Regulations" },
  { value: "finra", label: "FINRA" },
  { value: "glba", label: "GLBA" },
  { value: "fcpa", label: "FCPA" },
  { value: "osha", label: "OSHA" },
  { value: "epa", label: "EPA Regulations" },
  { value: "fda", label: "FDA Regulations" },
  { value: "other", label: "Other" }
];

const LEGAL_REVIEW_STATUS = [
  { value: "not_required", label: "Not Required" },
  { value: "pending", label: "Pending Review" },
  { value: "in_review", label: "In Review" },
  { value: "approved", label: "Approved" },
  { value: "approved_with_conditions", label: "Approved with Conditions" },
  { value: "rejected", label: "Rejected" }
];

const RISK_LEVELS = [
  { value: 1, label: "1 - Minimal" },
  { value: 2, label: "2 - Low" },
  { value: 3, label: "3 - Moderate" },
  { value: 4, label: "4 - Significant" },
  { value: 5, label: "5 - High" },
  { value: 6, label: "6 - Very High" },
  { value: 7, label: "7 - Severe" },
  { value: 8, label: "8 - Critical" },
  { value: 9, label: "9 - Extreme" },
  { value: 10, label: "10 - Catastrophic" }
];

const DEPENDENCY_TYPES = [
  { value: "vendor", label: "External Vendor" },
  { value: "partner", label: "Business Partner" },
  { value: "technology", label: "Technology/System" },
  { value: "data", label: "Data/Information" },
  { value: "facility", label: "Facility/Location" },
  { value: "equipment", label: "Equipment" },
  { value: "regulatory", label: "Regulatory Body" },
  { value: "internal_team", label: "Internal Team" }
];

const REGIONS = [
  { value: "global", label: "Global" },
  { value: "north_america", label: "North America" },
  { value: "europe", label: "Europe" },
  { value: "asia_pacific", label: "Asia Pacific" },
  { value: "latin_america", label: "Latin America" },
  { value: "middle_east", label: "Middle East" },
  { value: "africa", label: "Africa" },
  { value: "uk", label: "United Kingdom" },
  { value: "eu", label: "European Union" },
  { value: "us", label: "United States" },
  { value: "canada", label: "Canada" },
  { value: "china", label: "China" },
  { value: "japan", label: "Japan" },
  { value: "australia", label: "Australia" }
];

const REVIEW_FREQUENCIES = [
  { value: "monthly", label: "Monthly" },
  { value: "quarterly", label: "Quarterly" },
  { value: "semi_annual", label: "Semi-Annual" },
  { value: "annual", label: "Annual" },
  { value: "as_needed", label: "As Needed" }
];

interface TriggerCondition { 
  id: string; 
  description: string; 
  source: string; 
  severity: string;
  autoActivate: boolean;
}

interface EscalationPath {
  id: string;
  triggerCondition: string;
  escalateTo: string;
  backupContact: string;
  timeToEscalate: number;
  notificationChannels: string[];
}

interface Stakeholder { 
  role: string; 
  userId?: string; 
  responsibility: string; 
  notificationChannels: string[];
  isBackup: boolean;
  backupFor?: string;
}

interface ExecutionStep { 
  id: string; 
  order: number; 
  title: string; 
  description: string; 
  ownerId?: string; 
  timeTargetMinutes: number; 
  isParallel: boolean;
  dependsOn: string[];
  approvalRequired: string;
  approvalNotes: string;
  deliverables: string;
}

interface BudgetAllocation {
  id: string;
  category: string;
  amount: number;
  preApproved: boolean;
  approvalThreshold: number;
  notes: string;
}

interface BusinessImpact {
  id: string;
  type: string;
  estimatedValue: number;
  valueUnit: string;
  description: string;
  measurementMethod: string;
}

interface SuccessMetrics { 
  responseTimeTarget: number; 
  stakeholdersTarget: number; 
  customMetrics: Array<{ name: string; target: string }>;
}

interface ComplianceRequirement {
  id: string;
  framework: string;
  requirement: string;
  notes: string;
}

interface Dependency {
  id: string;
  type: string;
  name: string;
  contactInfo: string;
  criticality: string;
  notes: string;
}

interface PlaybookFormData {
  name: string;
  description: string;
  domain: string;
  category: string;
  priority: string;
  isActive: boolean;
  status: string;
  triggerConditions: TriggerCondition[];
  escalationPaths: EscalationPath[];
  stakeholders: Stakeholder[];
  executionSteps: ExecutionStep[];
  budgetAllocations: BudgetAllocation[];
  businessImpacts: BusinessImpact[];
  successMetrics: SuccessMetrics;
  totalBudget: number;
  budgetCurrency: string;
  complianceFrameworks: string[];
  complianceRequirements: ComplianceRequirement[];
  legalReviewStatus: string;
  legalReviewApprover: string;
  legalReviewDate: string;
  auditTrailRequired: boolean;
  riskScore: number;
  maxFinancialExposure: number;
  reputationalRiskLevel: string;
  riskNotes: string;
  pressResponseRequired: boolean;
  investorNotificationRequired: boolean;
  investorNotificationThreshold: string;
  boardNotificationRequired: boolean;
  boardNotificationThreshold: string;
  preApprovedMessaging: string;
  dependencies: Dependency[];
  playbookOwner: string;
  playbookOwnerEmail: string;
  nextReviewDate: string;
  reviewFrequency: string;
  versionNotes: string;
  changeApprovalRequired: boolean;
  geographicScope: string[];
  primaryTimezone: string;
  localRegulations: string;
  lastDrillDate: string;
  nextDrillDate: string;
  drillFrequency: string;
  trainingRequirements: string;
  certificationRequirements: string;
}

function generateId() { return Math.random().toString(36).substring(2, 11); }

function getSmartDefaults(domain: string, category: string) {
  const isDefense = category === 'defense';
  const isOffense = category === 'offense';
  
  const complianceByDomain: Record<string, string[]> = {
    'Regulatory & Compliance': ['sox', 'sec', 'gdpr'],
    'Cyber Security': ['iso_27001', 'soc2', 'pci_dss', 'gdpr'],
    'Crisis Response': ['sox', 'sec'],
    'AI Governance': ['gdpr', 'ccpa', 'iso_27001'],
    'M&A Integration': ['sox', 'sec', 'finra'],
    'Product Launch': ['gdpr', 'ccpa'],
    'Environmental Compliance': ['epa', 'osha'],
    'Financial Strategy': ['sox', 'sec', 'finra'],
  };
  
  return {
    priority: isDefense ? 'high' : 'medium',
    riskScore: isDefense ? 7 : 5,
    reputationalRiskLevel: isDefense ? 'high' : 'medium',
    complianceFrameworks: complianceByDomain[domain] || ['sox'],
    auditTrailRequired: isDefense,
    pressResponseRequired: isDefense,
    boardNotificationRequired: isDefense || category === 'special_teams',
    boardNotificationThreshold: isDefense ? 'Material impact, regulatory involvement, or reputational risk' : 'Strategic initiative with significant impact',
    investorNotificationRequired: isOffense,
    investorNotificationThreshold: isOffense ? 'Strategic initiative with material financial impact' : '',
    geographicScope: ['global'],
    reviewFrequency: 'quarterly',
    drillFrequency: isDefense ? 'quarterly' : 'semi_annual',
  };
}

// IDEA Framework phase groupings
const IDEA_PHASES = [
  { 
    id: 'identify', 
    label: 'IDENTIFY', 
    tagline: 'Build Your Depth Chart',
    description: 'Define stakeholders, dependencies, and governance before situations arise',
    color: 'bg-blue-500',
    sections: ['basic', 'stakeholders', 'dependencies', 'governance', 'geographic', 'readiness']
  },
  { 
    id: 'detect', 
    label: 'DETECT', 
    tagline: 'Monitor Signals',
    description: 'Configure triggers and risk thresholds for early warning',
    color: 'bg-amber-500',
    sections: ['triggers', 'risk', 'compliance']
  },
  { 
    id: 'execute', 
    label: 'EXECUTE', 
    tagline: 'Execute Response',
    description: 'Define execution steps, escalation paths, budget, and communications',
    color: 'bg-green-500',
    sections: ['steps', 'escalation', 'budget', 'communications']
  },
  { 
    id: 'advance', 
    label: 'ADVANCE', 
    tagline: 'Review the Film',
    description: 'Track success metrics and capture business impact',
    color: 'bg-purple-500',
    sections: ['metrics', 'impact']
  }
];

const sections = [
  { id: 'basic', label: 'Basic Info', icon: FileText, phase: 'identify' },
  { id: 'stakeholders', label: 'Stakeholders', icon: Users, phase: 'identify' },
  { id: 'dependencies', label: 'Dependencies', icon: Link2, phase: 'identify' },
  { id: 'governance', label: 'Governance', icon: Settings, phase: 'identify' },
  { id: 'geographic', label: 'Geographic Scope', icon: Globe, phase: 'identify' },
  { id: 'readiness', label: 'Readiness', icon: GraduationCap, phase: 'identify' },
  { id: 'triggers', label: 'Triggers', icon: AlertTriangle, phase: 'detect' },
  { id: 'risk', label: 'Risk Assessment', icon: Shield, phase: 'detect' },
  { id: 'compliance', label: 'Compliance', icon: Scale, phase: 'detect' },
  { id: 'steps', label: 'Execution Steps', icon: Clock, phase: 'execute' },
  { id: 'escalation', label: 'Escalation', icon: ArrowUpRight, phase: 'execute' },
  { id: 'budget', label: 'Budget', icon: DollarSign, phase: 'execute' },
  { id: 'communications', label: 'Communications', icon: Megaphone, phase: 'execute' },
  { id: 'metrics', label: 'Success Metrics', icon: Target, phase: 'advance' },
  { id: 'impact', label: 'Business Impact', icon: TrendingUp, phase: 'advance' }
];

export default function PlaybookCustomize() {
  const [, params] = useRoute('/playbooks/:id/customize');
  const [, editParams] = useRoute('/playbooks/:id/edit');
  const [, createParams] = useRoute('/playbooks/create');
  const [, customizeParams] = useRoute('/playbook-customize/:id');
  const [, newParams] = useRoute('/playbook-customize/new');
  const [, setLocation] = useLocation();
  const [activeSection, setActiveSection] = useState('basic');
  const [expandedSections, setExpandedSections] = useState<Record<string, boolean>>({
    basic: true, triggers: true, escalation: false, stakeholders: false, 
    steps: false, budget: false, impact: false, compliance: false,
    risk: false, communications: false, dependencies: false, governance: false,
    geographic: false, readiness: false, metrics: false
  });
  
  const playbookId = params?.id || editParams?.id || (customizeParams?.id !== 'new' ? customizeParams?.id : undefined);
  const isCreateMode = !!createParams || !!newParams || !playbookId;
  
  const { organization } = useCustomer();
  const { toast } = useToast();
  
  const { data: template, isLoading } = useQuery<Playbook>({
    queryKey: ['/api/playbooks', playbookId],
    enabled: !!playbookId,
  });
  
  const defaultValues: PlaybookFormData = {
    name: "", description: "", domain: "", category: "defense", priority: "medium", isActive: true, status: "draft",
    triggerConditions: [], escalationPaths: [], stakeholders: [], executionSteps: [],
    budgetAllocations: [], businessImpacts: [],
    successMetrics: { responseTimeTarget: 12, stakeholdersTarget: 5, customMetrics: [] },
    totalBudget: 0, budgetCurrency: "USD",
    complianceFrameworks: [], complianceRequirements: [],
    legalReviewStatus: "not_required", legalReviewApprover: "", legalReviewDate: "",
    auditTrailRequired: false,
    riskScore: 5, maxFinancialExposure: 0, reputationalRiskLevel: "medium", riskNotes: "",
    pressResponseRequired: false, investorNotificationRequired: false, investorNotificationThreshold: "",
    boardNotificationRequired: false, boardNotificationThreshold: "", preApprovedMessaging: "",
    dependencies: [],
    playbookOwner: "", playbookOwnerEmail: "", nextReviewDate: "", reviewFrequency: "quarterly",
    versionNotes: "", changeApprovalRequired: false,
    geographicScope: [], primaryTimezone: "", localRegulations: "",
    lastDrillDate: "", nextDrillDate: "", drillFrequency: "quarterly",
    trainingRequirements: "", certificationRequirements: ""
  };
  
  const form = useForm<PlaybookFormData>({ defaultValues });
  const { control, register, handleSubmit, reset, watch, formState: { errors } } = form;
  
  const triggersArray = useFieldArray({ control, name: "triggerConditions" });
  const escalationArray = useFieldArray({ control, name: "escalationPaths" });
  const stakeholdersArray = useFieldArray({ control, name: "stakeholders" });
  const stepsArray = useFieldArray({ control, name: "executionSteps" });
  const budgetArray = useFieldArray({ control, name: "budgetAllocations" });
  const impactArray = useFieldArray({ control, name: "businessImpacts" });
  const complianceArray = useFieldArray({ control, name: "complianceRequirements" });
  const dependenciesArray = useFieldArray({ control, name: "dependencies" });
  const customMetricsArray = useFieldArray({ control, name: "successMetrics.customMetrics" });
  
  const watchedSteps = watch("executionSteps");
  const watchedBudget = watch("budgetAllocations");
  
  const totalAllocatedBudget = watchedBudget?.reduce((sum, b) => sum + (b.amount || 0), 0) || 0;
  
  useEffect(() => {
    if (template) {
      const t = template as any;
      const domain = template.domain || "";
      const category = template.category || "defense";
      const smartDefaults = getSmartDefaults(domain, category);
      const hasExistingCompliance = t.complianceFrameworks?.length > 0;
      
      reset({
        name: template.name || "",
        description: template.description || "",
        domain: domain,
        category: category,
        priority: t.priority || smartDefaults.priority,
        isActive: template.isActive ?? true,
        status: t.status || "draft",
        triggerConditions: (template.triggerConditions as TriggerCondition[]) || [],
        escalationPaths: t.escalationPaths || [],
        stakeholders: (template.stakeholders as Stakeholder[]) || [],
        executionSteps: (template.executionSteps as ExecutionStep[]) || [],
        budgetAllocations: t.budgetAllocations || [],
        businessImpacts: t.businessImpacts || [],
        successMetrics: (template.successMetrics as SuccessMetrics) || { responseTimeTarget: 12, stakeholdersTarget: 5, customMetrics: [] },
        totalBudget: t.totalBudget || 0,
        budgetCurrency: t.budgetCurrency || "USD",
        complianceFrameworks: hasExistingCompliance ? t.complianceFrameworks : smartDefaults.complianceFrameworks,
        complianceRequirements: t.complianceRequirements || [],
        legalReviewStatus: t.legalReviewStatus || "not_required",
        legalReviewApprover: t.legalReviewApprover || "",
        legalReviewDate: t.legalReviewDate || "",
        auditTrailRequired: t.auditTrailRequired ?? smartDefaults.auditTrailRequired,
        riskScore: t.riskScore || smartDefaults.riskScore,
        maxFinancialExposure: t.maxFinancialExposure || 0,
        reputationalRiskLevel: t.reputationalRiskLevel || smartDefaults.reputationalRiskLevel,
        riskNotes: t.riskNotes || "",
        pressResponseRequired: t.pressResponseRequired ?? smartDefaults.pressResponseRequired,
        investorNotificationRequired: t.investorNotificationRequired ?? smartDefaults.investorNotificationRequired,
        investorNotificationThreshold: t.investorNotificationThreshold || smartDefaults.investorNotificationThreshold,
        boardNotificationRequired: t.boardNotificationRequired ?? smartDefaults.boardNotificationRequired,
        boardNotificationThreshold: t.boardNotificationThreshold || smartDefaults.boardNotificationThreshold,
        preApprovedMessaging: t.preApprovedMessaging || "",
        dependencies: t.dependencies || [],
        playbookOwner: t.playbookOwner || "",
        playbookOwnerEmail: t.playbookOwnerEmail || "",
        nextReviewDate: t.nextReviewDate || "",
        reviewFrequency: t.reviewFrequency || smartDefaults.reviewFrequency,
        versionNotes: t.versionNotes || "",
        changeApprovalRequired: t.changeApprovalRequired || false,
        geographicScope: t.geographicScope?.length > 0 ? t.geographicScope : smartDefaults.geographicScope,
        primaryTimezone: t.primaryTimezone || "",
        localRegulations: t.localRegulations || "",
        lastDrillDate: t.lastDrillDate || "",
        nextDrillDate: t.nextDrillDate || "",
        drillFrequency: t.drillFrequency || smartDefaults.drillFrequency,
        trainingRequirements: t.trainingRequirements || "",
        certificationRequirements: t.certificationRequirements || ""
      });
    }
  }, [template, reset]);
  
  const savePlaybook = useMutation({
    mutationFn: async (data: PlaybookFormData) => {
      const payload = { ...data, sourceType: isCreateMode ? 'custom' : 'customized', templateId: playbookId || null, organizationId: organization?.id || 'demo-org' };
      const res = await apiRequest('POST', '/api/playbooks', payload);
      return res.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbooks'] });
      toast({ title: "Playbook saved", description: "Your playbook has been created successfully." });
      setLocation('/playbooks');
    },
    onError: (error: any) => {
      toast({ title: "Error", description: error.message || "Failed to save playbook", variant: "destructive" });
    }
  });
  
  const toggleSection = (id: string) => {
    setExpandedSections(prev => ({ ...prev, [id]: !prev[id] }));
  };

  const PHASE_BADGES: Record<string, { label: string; color: string }> = {
    identify: { label: 'I', color: 'bg-blue-500' },
    detect: { label: 'D', color: 'bg-amber-500' },
    execute: { label: 'E', color: 'bg-green-500' },
    advance: { label: 'A', color: 'bg-purple-500' },
  };
  
  const SECTION_TO_PHASE: Record<string, string> = {
    basic: 'identify', stakeholders: 'identify', dependencies: 'identify', 
    governance: 'identify', geographic: 'identify', readiness: 'identify',
    triggers: 'detect', risk: 'detect', compliance: 'detect',
    steps: 'execute', escalation: 'execute', budget: 'execute', communications: 'execute',
    metrics: 'advance', impact: 'advance',
  };
  
  const SectionHeader = ({ id, title, icon: Icon, description, children }: { id: string; title: string; icon: any; description?: string; children?: React.ReactNode }) => {
    const phase = SECTION_TO_PHASE[id];
    const phaseBadge = phase ? PHASE_BADGES[phase] : null;
    return (
      <CardHeader className="pb-4">
        <div className="flex items-center justify-between">
          <div className="cursor-pointer flex-1" onClick={() => toggleSection(id)}>
            <CardTitle className="text-lg flex items-center gap-2">
              <Icon className="h-5 w-5 text-slate-500" />
              {title}
              {phaseBadge && (
                <span className={`ml-2 w-5 h-5 ${phaseBadge.color} text-white text-xs font-bold rounded flex items-center justify-center`}>
                  {phaseBadge.label}
                </span>
              )}
            </CardTitle>
            {description && <CardDescription className="text-sm mt-1">{description}</CardDescription>}
          </div>
          <div className="flex items-center gap-2">
            {children}
            {expandedSections[id] ? <ChevronUp className="h-5 w-5 text-slate-400 cursor-pointer" onClick={() => toggleSection(id)} /> : <ChevronDown className="h-5 w-5 text-slate-400 cursor-pointer" onClick={() => toggleSection(id)} />}
          </div>
        </div>
      </CardHeader>
    );
  };
  
  if (isLoading && !isCreateMode) {
    return (
      <div className="min-h-screen bg-slate-50 dark:bg-slate-900">
        <StandardNav />
        <div className="flex items-center justify-center h-[60vh]">
          <div className="text-slate-500">Loading template...</div>
        </div>
      </div>
    );
  }
  
  return (
    <div className="min-h-screen bg-slate-50 dark:bg-slate-950">
      <StandardNav />
      
      <div className="pt-20 pb-32">
        <div className="max-w-6xl mx-auto px-6">
          <div className="flex items-center gap-4 mb-6">
            <Button variant="ghost" size="sm" onClick={() => setLocation('/playbooks')} data-testid="button-back">
              <ArrowLeft className="mr-2 h-4 w-4" />
              Back
            </Button>
            {template && (
              <Badge variant="outline" className="text-xs">
                Based on: {template.name}
              </Badge>
            )}
          </div>
          
          <div className="flex items-start justify-between mb-8">
            <div>
              <h1 className="text-2xl font-semibold text-slate-900 dark:text-white mb-1">
                {isCreateMode ? "Create Playbook" : "Customize Playbook"}
              </h1>
              <p className="text-slate-500 text-sm">
                Comprehensive strategic response configuration
              </p>
            </div>
          </div>
          
          {/* IDEA Phase Summary Cards */}
          <div className="grid grid-cols-4 gap-4 mb-8">
            {IDEA_PHASES.map((phase) => {
              const phaseSections = sections.filter(s => s.phase === phase.id);
              // Proper field mapping for each section
              const sectionFieldMap: Record<string, string> = {
                basic: 'name',
                stakeholders: 'stakeholders',
                dependencies: 'dependencies',
                governance: 'playbookOwner',
                geographic: 'geographicScope',
                readiness: 'trainingRequirements',
                triggers: 'triggerConditions',
                risk: 'riskNotes',
                compliance: 'complianceRequirements',
                steps: 'executionSteps',
                escalation: 'escalationPaths',
                budget: 'budgetAllocations',
                communications: 'preApprovedMessaging',
                metrics: 'successMetrics',
                impact: 'businessImpacts'
              };
              const filledCount = phaseSections.filter(s => {
                const fieldName = sectionFieldMap[s.id] || 'name';
                const values = watch(fieldName as any);
                if (Array.isArray(values)) return values.length > 0;
                if (typeof values === 'object' && values !== null) {
                  // For successMetrics, check if it has customMetrics or targets set
                  return Object.values(values).some(v => v && (Array.isArray(v) ? v.length > 0 : true));
                }
                return !!values;
              }).length;
              return (
                <Card key={phase.id} className="border-slate-200 dark:border-slate-800 overflow-hidden" data-testid={`phase-card-${phase.id}`}>
                  <div className={`h-1.5 ${phase.color}`} />
                  <CardContent className="p-4">
                    <div className="flex items-center justify-between mb-1">
                      <h3 className="font-bold text-sm tracking-wide">{phase.label}</h3>
                      <Badge variant="secondary" className="text-xs">{filledCount}/{phaseSections.length}</Badge>
                    </div>
                    <p className="text-xs text-slate-500 dark:text-slate-400 italic mb-2">{phase.tagline}</p>
                    <p className="text-xs text-slate-600 dark:text-slate-400 line-clamp-2">{phase.description}</p>
                  </CardContent>
                </Card>
              );
            })}
          </div>

          <div className="flex gap-8">
            <nav className="w-56 shrink-0">
              <div className="sticky top-24 space-y-1 max-h-[calc(100vh-8rem)] overflow-y-auto pr-2">
                {IDEA_PHASES.map((phase) => (
                  <div key={phase.id} className="mb-4">
                    <div className={`flex items-center gap-2 px-3 py-2 rounded-lg mb-1`}>
                      <div className={`w-2 h-2 rounded-full ${phase.color}`} />
                      <span className="text-xs font-bold tracking-wider text-slate-500 dark:text-slate-400">{phase.label}</span>
                    </div>
                    {sections.filter(s => s.phase === phase.id).map((section) => {
                      const Icon = section.icon;
                      const isActive = activeSection === section.id;
                      return (
                        <button
                          key={section.id}
                          onClick={() => {
                            setActiveSection(section.id);
                            setExpandedSections(prev => ({ ...prev, [section.id]: true }));
                            document.getElementById(section.id)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                          }}
                          className={`w-full flex items-center gap-2.5 px-3 py-1.5 rounded-lg text-left text-sm transition-colors ${
                            isActive 
                              ? 'bg-primary text-primary-foreground' 
                              : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800'
                          }`}
                          data-testid={`nav-${section.id}`}
                        >
                          <Icon className="h-4 w-4 shrink-0" />
                          <span className="font-medium truncate">{section.label}</span>
                        </button>
                      );
                    })}
                  </div>
                ))}
              </div>
            </nav>
            
            <form onSubmit={handleSubmit((data) => savePlaybook.mutate(data))} className="flex-1 space-y-5">
              
              {/* BASIC INFO */}
              <section id="basic" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="basic" title="Basic Information" icon={FileText} />
                  {expandedSections.basic && (
                    <CardContent className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="col-span-2">
                          <Label className="text-sm font-medium">Playbook Name</Label>
                          <Input {...register('name', { required: "Required" })} placeholder="e.g., Crisis Communication Response" className="mt-1.5" data-testid="input-name" />
                        </div>
                        <div className="col-span-2">
                          <Label className="text-sm font-medium">Description</Label>
                          <Textarea {...register('description')} rows={2} placeholder="Strategic situation this playbook addresses" className="mt-1.5 resize-none" data-testid="input-description" />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Domain</Label>
                          <Controller name="domain" control={control} render={({ field }) => (
                            <Select value={field.value} onValueChange={field.onChange}>
                              <SelectTrigger className="mt-1.5" data-testid="select-domain"><SelectValue placeholder="Select..." /></SelectTrigger>
                              <SelectContent>{DOMAINS.map(d => <SelectItem key={d} value={d}>{d}</SelectItem>)}</SelectContent>
                            </Select>
                          )} />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Category</Label>
                          <Controller name="category" control={control} render={({ field }) => (
                            <Select value={field.value} onValueChange={field.onChange}>
                              <SelectTrigger className="mt-1.5" data-testid="select-category"><SelectValue /></SelectTrigger>
                              <SelectContent>{CATEGORIES.map(c => <SelectItem key={c.value} value={c.value}>{c.label}</SelectItem>)}</SelectContent>
                            </Select>
                          )} />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Priority</Label>
                          <Controller name="priority" control={control} render={({ field }) => (
                            <Select value={field.value} onValueChange={field.onChange}>
                              <SelectTrigger className="mt-1.5" data-testid="select-priority"><SelectValue /></SelectTrigger>
                              <SelectContent>{PRIORITY_LEVELS.map(p => <SelectItem key={p.value} value={p.value}>{p.label}</SelectItem>)}</SelectContent>
                            </Select>
                          )} />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Status</Label>
                          <Controller name="status" control={control} render={({ field }) => (
                            <Select value={field.value || "draft"} onValueChange={field.onChange}>
                              <SelectTrigger className="mt-1.5" data-testid="select-status">
                                <SelectValue>
                                  <span className="flex items-center gap-2">
                                    <span className={`w-2 h-2 rounded-full ${
                                      field.value === 'draft' ? 'bg-yellow-500' :
                                      field.value === 'ready' ? 'bg-green-500' :
                                      field.value === 'active' ? 'bg-blue-500' : 'bg-slate-400'
                                    }`} />
                                    <span className={`font-medium ${
                                      field.value === 'draft' ? 'text-yellow-600 dark:text-yellow-400' :
                                      field.value === 'ready' ? 'text-green-600 dark:text-green-400' :
                                      field.value === 'active' ? 'text-blue-600 dark:text-blue-400' : 'text-slate-600'
                                    }`}>
                                      {PLAYBOOK_STATUSES.find(s => s.value === field.value)?.label || 'Draft'}
                                    </span>
                                  </span>
                                </SelectValue>
                              </SelectTrigger>
                              <SelectContent>
                                {PLAYBOOK_STATUSES.map(s => (
                                  <SelectItem key={s.value} value={s.value}>
                                    <span className="flex items-center gap-2">
                                      <span className={`w-2 h-2 rounded-full ${
                                        s.value === 'draft' ? 'bg-yellow-500' :
                                        s.value === 'ready' ? 'bg-green-500' :
                                        s.value === 'active' ? 'bg-blue-500' : 'bg-slate-400'
                                      }`} />
                                      <span className={`${
                                        s.value === 'draft' ? 'text-yellow-600 dark:text-yellow-400' :
                                        s.value === 'ready' ? 'text-green-600 dark:text-green-400' :
                                        s.value === 'active' ? 'text-blue-600 dark:text-blue-400' : 'text-slate-600'
                                      }`}>
                                        {s.label}
                                      </span>
                                    </span>
                                  </SelectItem>
                                ))}
                              </SelectContent>
                            </Select>
                          )} />
                          <p className="text-xs text-slate-500 mt-1">
                            {PLAYBOOK_STATUSES.find(s => s.value === watch('status'))?.description}
                          </p>
                        </div>
                      </div>
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* TRIGGERS */}
              <section id="triggers" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="triggers" title="Trigger Conditions" icon={AlertTriangle} description="Signals that activate this playbook">
                    <Button type="button" variant="outline" size="sm" onClick={() => triggersArray.append({ id: generateId(), description: "", source: "manual", severity: "warning", autoActivate: false })} data-testid="button-add-trigger">
                      <Plus className="mr-1.5 h-4 w-4" />Add
                    </Button>
                  </SectionHeader>
                  {expandedSections.triggers && (
                    <CardContent>
                      {triggersArray.fields.length === 0 ? (
                        <div className="text-center py-8 text-slate-400 text-sm border-2 border-dashed rounded-lg">No triggers defined</div>
                      ) : (
                        <div className="space-y-3">
                          {triggersArray.fields.map((field, index) => (
                            <div key={field.id} className="p-3 bg-slate-50 dark:bg-slate-900 rounded-lg space-y-3" data-testid={`trigger-item-${index}`}>
                              <div className="flex gap-2">
                                <Input {...register(`triggerConditions.${index}.description`)} placeholder="Trigger description..." className="flex-1" />
                                <Button type="button" variant="ghost" size="sm" onClick={() => triggersArray.remove(index)}><Trash2 className="h-4 w-4 text-slate-400" /></Button>
                              </div>
                              <div className="grid grid-cols-3 gap-2">
                                <Controller name={`triggerConditions.${index}.source`} control={control} render={({ field }) => (
                                  <Select value={field.value} onValueChange={field.onChange}>
                                    <SelectTrigger><SelectValue placeholder="Source" /></SelectTrigger>
                                    <SelectContent>{TRIGGER_SOURCES.map(s => <SelectItem key={s.value} value={s.value}>{s.label}</SelectItem>)}</SelectContent>
                                  </Select>
                                )} />
                                <Controller name={`triggerConditions.${index}.severity`} control={control} render={({ field }) => (
                                  <Select value={field.value} onValueChange={field.onChange}>
                                    <SelectTrigger><SelectValue placeholder="Severity" /></SelectTrigger>
                                    <SelectContent>{TRIGGER_SEVERITY.map(s => <SelectItem key={s.value} value={s.value}>{s.label}</SelectItem>)}</SelectContent>
                                  </Select>
                                )} />
                                <div className="flex items-center gap-2">
                                  <Controller name={`triggerConditions.${index}.autoActivate`} control={control} render={({ field }) => (
                                    <Switch checked={field.value} onCheckedChange={field.onChange} />
                                  )} />
                                  <Label className="text-xs">Auto</Label>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* ESCALATION */}
              <section id="escalation" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="escalation" title="Escalation Paths" icon={ArrowUpRight} description="When and how to escalate issues">
                    <Button type="button" variant="outline" size="sm" onClick={() => escalationArray.append({ id: generateId(), triggerCondition: "no_response", escalateTo: "", backupContact: "", timeToEscalate: 30, notificationChannels: ["email", "phone"] })}>
                      <Plus className="mr-1.5 h-4 w-4" />Add
                    </Button>
                  </SectionHeader>
                  {expandedSections.escalation && (
                    <CardContent>
                      {escalationArray.fields.length === 0 ? (
                        <div className="text-center py-8 text-slate-400 text-sm border-2 border-dashed rounded-lg">No escalation paths</div>
                      ) : (
                        <div className="space-y-3">
                          {escalationArray.fields.map((field, index) => (
                            <div key={field.id} className="p-3 bg-slate-50 dark:bg-slate-900 rounded-lg space-y-3">
                              <div className="flex justify-between items-center">
                                <Badge variant="outline">Path {index + 1}</Badge>
                                <Button type="button" variant="ghost" size="sm" onClick={() => escalationArray.remove(index)}><Trash2 className="h-4 w-4 text-slate-400" /></Button>
                              </div>
                              <div className="grid grid-cols-2 gap-2">
                                <Controller name={`escalationPaths.${index}.triggerCondition`} control={control} render={({ field }) => (
                                  <Select value={field.value} onValueChange={field.onChange}>
                                    <SelectTrigger><SelectValue placeholder="When..." /></SelectTrigger>
                                    <SelectContent>{ESCALATION_TRIGGERS.map(t => <SelectItem key={t.value} value={t.value}>{t.label}</SelectItem>)}</SelectContent>
                                  </Select>
                                )} />
                                <Controller name={`escalationPaths.${index}.timeToEscalate`} control={control} render={({ field }) => (
                                  <Select value={String(field.value)} onValueChange={(v) => field.onChange(parseInt(v))}>
                                    <SelectTrigger><SelectValue placeholder="Time" /></SelectTrigger>
                                    <SelectContent>{TIME_TARGETS.map(t => <SelectItem key={t.value} value={String(t.value)}>{t.label}</SelectItem>)}</SelectContent>
                                  </Select>
                                )} />
                                <Controller name={`escalationPaths.${index}.escalateTo`} control={control} render={({ field }) => (
                                  <Select value={field.value} onValueChange={field.onChange}>
                                    <SelectTrigger><SelectValue placeholder="Escalate to..." /></SelectTrigger>
                                    <SelectContent>{STAKEHOLDER_ROLES.map(r => <SelectItem key={r} value={r}>{r}</SelectItem>)}</SelectContent>
                                  </Select>
                                )} />
                                <Controller name={`escalationPaths.${index}.backupContact`} control={control} render={({ field }) => (
                                  <Select value={field.value} onValueChange={field.onChange}>
                                    <SelectTrigger><SelectValue placeholder="Backup..." /></SelectTrigger>
                                    <SelectContent>{STAKEHOLDER_ROLES.map(r => <SelectItem key={r} value={r}>{r}</SelectItem>)}</SelectContent>
                                  </Select>
                                )} />
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* STAKEHOLDERS */}
              <section id="stakeholders" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="stakeholders" title="Stakeholders" icon={Users} description="Team roles and notifications">
                    <Button type="button" variant="outline" size="sm" onClick={() => stakeholdersArray.append({ role: "", userId: "", responsibility: "", notificationChannels: ["email"], isBackup: false })}>
                      <Plus className="mr-1.5 h-4 w-4" />Add
                    </Button>
                  </SectionHeader>
                  {expandedSections.stakeholders && (
                    <CardContent>
                      {stakeholdersArray.fields.length === 0 ? (
                        <div className="text-center py-8 text-slate-400 text-sm border-2 border-dashed rounded-lg">No stakeholders</div>
                      ) : (
                        <div className="space-y-3">
                          {stakeholdersArray.fields.map((field, index) => (
                            <div key={field.id} className="p-3 bg-slate-50 dark:bg-slate-900 rounded-lg space-y-3">
                              <div className="flex gap-2">
                                <Controller name={`stakeholders.${index}.role`} control={control} render={({ field }) => (
                                  <Select value={field.value} onValueChange={field.onChange}>
                                    <SelectTrigger className="w-40"><SelectValue placeholder="Role..." /></SelectTrigger>
                                    <SelectContent>{STAKEHOLDER_ROLES.map(r => <SelectItem key={r} value={r}>{r}</SelectItem>)}</SelectContent>
                                  </Select>
                                )} />
                                <Input {...register(`stakeholders.${index}.userId`)} placeholder="Name/email" className="flex-1" />
                                <div className="flex items-center gap-1">
                                  <Controller name={`stakeholders.${index}.isBackup`} control={control} render={({ field }) => (
                                    <Switch checked={field.value} onCheckedChange={field.onChange} />
                                  )} />
                                  <Label className="text-xs">Backup</Label>
                                </div>
                                <Button type="button" variant="ghost" size="sm" onClick={() => stakeholdersArray.remove(index)}><Trash2 className="h-4 w-4 text-slate-400" /></Button>
                              </div>
                              <Input {...register(`stakeholders.${index}.responsibility`)} placeholder="Responsibility..." />
                              <div className="flex gap-1 flex-wrap">
                                <Controller name={`stakeholders.${index}.notificationChannels`} control={control} render={({ field }) => (
                                  <>
                                    {NOTIFICATION_CHANNELS.map(ch => {
                                      const channels = field.value || [];
                                      const isSelected = channels.includes(ch.value);
                                      return (
                                        <button key={ch.value} type="button" onClick={() => field.onChange(isSelected ? channels.filter((c: string) => c !== ch.value) : [...channels, ch.value])}
                                          className={`px-2 py-1 text-xs rounded-full border ${isSelected ? 'bg-primary text-primary-foreground' : 'bg-white dark:bg-slate-800 text-slate-500'}`}>
                                          {ch.label}
                                        </button>
                                      );
                                    })}
                                  </>
                                )} />
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </CardContent>
                  )}
                </Card>
              </section>

              {/* EXECUTION STEPS */}
              <section id="steps" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="steps" title="Execution Steps" icon={Clock} description="Workflow with dependencies and approvals">
                    <Button type="button" variant="outline" size="sm" onClick={() => stepsArray.append({ id: generateId(), order: stepsArray.fields.length + 1, title: "", description: "", ownerId: "", timeTargetMinutes: 30, isParallel: false, dependsOn: [], approvalRequired: "none", approvalNotes: "", deliverables: "" })}>
                      <Plus className="mr-1.5 h-4 w-4" />Add
                    </Button>
                  </SectionHeader>
                  {expandedSections.steps && (
                    <CardContent>
                      {stepsArray.fields.length === 0 ? (
                        <div className="text-center py-8 text-slate-400 text-sm border-2 border-dashed rounded-lg">No steps</div>
                      ) : (
                        <div className="space-y-3">
                          {stepsArray.fields.map((field, index) => (
                            <div key={field.id} className="p-3 bg-slate-50 dark:bg-slate-900 rounded-lg space-y-3">
                              <div className="flex gap-2 items-start">
                                <Badge variant="outline" className="shrink-0 w-7 h-7 flex items-center justify-center">{index + 1}</Badge>
                                <div className="flex-1 space-y-2">
                                  <Input {...register(`executionSteps.${index}.title`)} placeholder="Step title..." className="font-medium" />
                                  <Textarea {...register(`executionSteps.${index}.description`)} placeholder="Instructions..." rows={2} className="resize-none text-sm" />
                                  <div className="grid grid-cols-4 gap-2">
                                    <Controller name={`executionSteps.${index}.timeTargetMinutes`} control={control} render={({ field }) => (
                                      <Select value={String(field.value)} onValueChange={(v) => field.onChange(parseInt(v))}>
                                        <SelectTrigger><SelectValue /></SelectTrigger>
                                        <SelectContent>{TIME_TARGETS.map(t => <SelectItem key={t.value} value={String(t.value)}>{t.label}</SelectItem>)}</SelectContent>
                                      </Select>
                                    )} />
                                    <Controller name={`executionSteps.${index}.ownerId`} control={control} render={({ field }) => (
                                      <Select value={field.value || ""} onValueChange={field.onChange}>
                                        <SelectTrigger><SelectValue placeholder="Owner" /></SelectTrigger>
                                        <SelectContent>{STAKEHOLDER_ROLES.map(r => <SelectItem key={r} value={r}>{r}</SelectItem>)}</SelectContent>
                                      </Select>
                                    )} />
                                    <Controller name={`executionSteps.${index}.approvalRequired`} control={control} render={({ field }) => (
                                      <Select value={field.value} onValueChange={field.onChange}>
                                        <SelectTrigger><SelectValue /></SelectTrigger>
                                        <SelectContent>{APPROVAL_TYPES.map(a => <SelectItem key={a.value} value={a.value}>{a.label}</SelectItem>)}</SelectContent>
                                      </Select>
                                    )} />
                                    <Controller name={`executionSteps.${index}.dependsOn`} control={control} render={({ field }) => (
                                      <Select value={(field.value || [])[0] || "none"} onValueChange={(v) => field.onChange(v === "none" ? [] : [v])}>
                                        <SelectTrigger><SelectValue placeholder="Depends on" /></SelectTrigger>
                                        <SelectContent>
                                          <SelectItem value="none">None</SelectItem>
                                          {watchedSteps?.slice(0, index).map((step, i) => (
                                            <SelectItem key={step.id} value={step.id}>Step {i + 1}</SelectItem>
                                          ))}
                                        </SelectContent>
                                      </Select>
                                    )} />
                                  </div>
                                  <Input {...register(`executionSteps.${index}.deliverables`)} placeholder="Deliverables..." />
                                </div>
                                <Button type="button" variant="ghost" size="sm" onClick={() => stepsArray.remove(index)}><Trash2 className="h-4 w-4 text-slate-400" /></Button>
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* BUDGET */}
              <section id="budget" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="budget" title="Budget Allocation" icon={DollarSign} description="Pre-approved spending">
                    <Button type="button" variant="outline" size="sm" onClick={() => budgetArray.append({ id: generateId(), category: "personnel", amount: 0, preApproved: false, approvalThreshold: 50000, notes: "" })}>
                      <Plus className="mr-1.5 h-4 w-4" />Add
                    </Button>
                  </SectionHeader>
                  {expandedSections.budget && (
                    <CardContent className="space-y-4">
                      <div className="grid grid-cols-2 gap-3 p-3 bg-green-50 dark:bg-green-950/30 rounded-lg">
                        <div>
                          <Label className="text-sm">Total Budget</Label>
                          <div className="flex items-center gap-1 mt-1">
                            <span className="text-slate-400">$</span>
                            <Input type="number" {...register('totalBudget', { valueAsNumber: true })} placeholder="0" />
                          </div>
                        </div>
                        <div className="flex items-end">
                          <p className="text-sm"><span className="text-slate-500">Allocated:</span> <span className="font-semibold">${totalAllocatedBudget.toLocaleString()}</span></p>
                        </div>
                      </div>
                      {budgetArray.fields.length === 0 ? (
                        <div className="text-center py-6 text-slate-400 text-sm border-2 border-dashed rounded-lg">No budget lines</div>
                      ) : (
                        <div className="space-y-2">
                          {budgetArray.fields.map((field, index) => (
                            <div key={field.id} className="flex gap-2 items-center p-2 bg-slate-50 dark:bg-slate-900 rounded-lg">
                              <Controller name={`budgetAllocations.${index}.category`} control={control} render={({ field }) => (
                                <Select value={field.value} onValueChange={field.onChange}>
                                  <SelectTrigger className="w-40"><SelectValue /></SelectTrigger>
                                  <SelectContent>{BUDGET_CATEGORIES.map(c => <SelectItem key={c.value} value={c.value}>{c.label}</SelectItem>)}</SelectContent>
                                </Select>
                              )} />
                              <div className="flex items-center gap-1 w-28">
                                <span className="text-slate-400 text-sm">$</span>
                                <Input type="number" {...register(`budgetAllocations.${index}.amount`, { valueAsNumber: true })} placeholder="Amount" />
                              </div>
                              <div className="flex items-center gap-1">
                                <Controller name={`budgetAllocations.${index}.preApproved`} control={control} render={({ field }) => (
                                  <Switch checked={field.value} onCheckedChange={field.onChange} />
                                )} />
                                <Label className="text-xs flex items-center gap-1"><Lock className="h-3 w-3" />Pre-approved</Label>
                              </div>
                              <Input {...register(`budgetAllocations.${index}.notes`)} placeholder="Notes" className="flex-1" />
                              <Button type="button" variant="ghost" size="sm" onClick={() => budgetArray.remove(index)}><Trash2 className="h-4 w-4 text-slate-400" /></Button>
                            </div>
                          ))}
                        </div>
                      )}
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* BUSINESS IMPACT */}
              <section id="impact" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="impact" title="Business Impact" icon={TrendingUp} description="Expected value from execution">
                    <Button type="button" variant="outline" size="sm" onClick={() => impactArray.append({ id: generateId(), type: "revenue_protection", estimatedValue: 0, valueUnit: "USD", description: "", measurementMethod: "" })}>
                      <Plus className="mr-1.5 h-4 w-4" />Add
                    </Button>
                  </SectionHeader>
                  {expandedSections.impact && (
                    <CardContent>
                      {impactArray.fields.length === 0 ? (
                        <div className="text-center py-6 text-slate-400 text-sm border-2 border-dashed rounded-lg">No impact metrics</div>
                      ) : (
                        <div className="space-y-2">
                          {impactArray.fields.map((field, index) => (
                            <div key={field.id} className="p-3 bg-slate-50 dark:bg-slate-900 rounded-lg space-y-2">
                              <div className="flex gap-2">
                                <Controller name={`businessImpacts.${index}.type`} control={control} render={({ field }) => (
                                  <Select value={field.value} onValueChange={field.onChange}>
                                    <SelectTrigger className="w-44"><SelectValue /></SelectTrigger>
                                    <SelectContent>{IMPACT_TYPES.map(t => <SelectItem key={t.value} value={t.value}>{t.label}</SelectItem>)}</SelectContent>
                                  </Select>
                                )} />
                                <div className="flex items-center gap-1 w-32">
                                  <span className="text-slate-400">$</span>
                                  <Input type="number" {...register(`businessImpacts.${index}.estimatedValue`, { valueAsNumber: true })} placeholder="Value" />
                                </div>
                                <Input {...register(`businessImpacts.${index}.description`)} placeholder="Description" className="flex-1" />
                                <Button type="button" variant="ghost" size="sm" onClick={() => impactArray.remove(index)}><Trash2 className="h-4 w-4 text-slate-400" /></Button>
                              </div>
                              <Input {...register(`businessImpacts.${index}.measurementMethod`)} placeholder="How will this be measured?" />
                            </div>
                          ))}
                        </div>
                      )}
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* COMPLIANCE */}
              <section id="compliance" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="compliance" title="Compliance & Regulatory" icon={Scale} description="Legal and regulatory requirements">
                    <Button type="button" variant="outline" size="sm" onClick={() => complianceArray.append({ id: generateId(), framework: "", requirement: "", notes: "" })}>
                      <Plus className="mr-1.5 h-4 w-4" />Add Requirement
                    </Button>
                  </SectionHeader>
                  {expandedSections.compliance && (
                    <CardContent className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <Label className="text-sm font-medium">Legal Review Status</Label>
                          <Controller name="legalReviewStatus" control={control} render={({ field }) => (
                            <Select value={field.value} onValueChange={field.onChange}>
                              <SelectTrigger className="mt-1.5"><SelectValue /></SelectTrigger>
                              <SelectContent>{LEGAL_REVIEW_STATUS.map(s => <SelectItem key={s.value} value={s.value}>{s.label}</SelectItem>)}</SelectContent>
                            </Select>
                          )} />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Legal Approver</Label>
                          <Input {...register('legalReviewApprover')} placeholder="Name of approver" className="mt-1.5" />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Review Date</Label>
                          <Input type="date" {...register('legalReviewDate')} className="mt-1.5" />
                        </div>
                        <div className="flex items-center gap-3 pt-6">
                          <Controller name="auditTrailRequired" control={control} render={({ field }) => (
                            <Switch checked={field.value} onCheckedChange={field.onChange} />
                          )} />
                          <Label className="text-sm">Audit Trail Required</Label>
                        </div>
                      </div>
                      <div>
                        <Label className="text-sm font-medium mb-2 block">Compliance Frameworks</Label>
                        <Controller name="complianceFrameworks" control={control} render={({ field }) => (
                          <div className="flex flex-wrap gap-2">
                            {COMPLIANCE_FRAMEWORKS.map(f => {
                              const selected = (field.value || []).includes(f.value);
                              return (
                                <button key={f.value} type="button" onClick={() => field.onChange(selected ? field.value.filter((v: string) => v !== f.value) : [...(field.value || []), f.value])}
                                  className={`px-3 py-1.5 text-xs rounded-full border transition-colors ${selected ? 'bg-blue-100 text-blue-700 border-blue-300' : 'bg-white dark:bg-slate-800 text-slate-500 border-slate-200'}`}>
                                  {f.label}
                                </button>
                              );
                            })}
                          </div>
                        )} />
                      </div>
                      {complianceArray.fields.length > 0 && (
                        <div className="space-y-2">
                          <Label className="text-sm font-medium">Specific Requirements</Label>
                          {complianceArray.fields.map((field, index) => (
                            <div key={field.id} className="flex gap-2 p-2 bg-slate-50 dark:bg-slate-900 rounded-lg">
                              <Controller name={`complianceRequirements.${index}.framework`} control={control} render={({ field }) => (
                                <Select value={field.value} onValueChange={field.onChange}>
                                  <SelectTrigger className="w-36"><SelectValue placeholder="Framework" /></SelectTrigger>
                                  <SelectContent>{COMPLIANCE_FRAMEWORKS.map(f => <SelectItem key={f.value} value={f.value}>{f.label}</SelectItem>)}</SelectContent>
                                </Select>
                              )} />
                              <Input {...register(`complianceRequirements.${index}.requirement`)} placeholder="Requirement" className="flex-1" />
                              <Button type="button" variant="ghost" size="sm" onClick={() => complianceArray.remove(index)}><Trash2 className="h-4 w-4 text-slate-400" /></Button>
                            </div>
                          ))}
                        </div>
                      )}
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* RISK ASSESSMENT */}
              <section id="risk" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="risk" title="Risk Assessment" icon={Shield} description="Risk scoring and exposure" />
                  {expandedSections.risk && (
                    <CardContent className="space-y-4">
                      <div className="grid grid-cols-3 gap-4">
                        <div>
                          <Label className="text-sm font-medium">Risk Score (1-10)</Label>
                          <Controller name="riskScore" control={control} render={({ field }) => (
                            <Select value={String(field.value)} onValueChange={(v) => field.onChange(parseInt(v))}>
                              <SelectTrigger className="mt-1.5"><SelectValue /></SelectTrigger>
                              <SelectContent>{RISK_LEVELS.map(r => <SelectItem key={r.value} value={String(r.value)}>{r.label}</SelectItem>)}</SelectContent>
                            </Select>
                          )} />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Max Financial Exposure</Label>
                          <div className="flex items-center gap-1 mt-1.5">
                            <span className="text-slate-400">$</span>
                            <Input type="number" {...register('maxFinancialExposure', { valueAsNumber: true })} placeholder="0" />
                          </div>
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Reputational Risk</Label>
                          <Controller name="reputationalRiskLevel" control={control} render={({ field }) => (
                            <Select value={field.value} onValueChange={field.onChange}>
                              <SelectTrigger className="mt-1.5"><SelectValue /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="low">Low</SelectItem>
                                <SelectItem value="medium">Medium</SelectItem>
                                <SelectItem value="high">High</SelectItem>
                                <SelectItem value="critical">Critical</SelectItem>
                              </SelectContent>
                            </Select>
                          )} />
                        </div>
                      </div>
                      <div>
                        <Label className="text-sm font-medium">Risk Notes</Label>
                        <Textarea {...register('riskNotes')} placeholder="Additional risk considerations..." rows={2} className="mt-1.5 resize-none" />
                      </div>
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* EXTERNAL COMMUNICATIONS */}
              <section id="communications" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="communications" title="External Communications" icon={Megaphone} description="Press, investor, and board notifications" />
                  {expandedSections.communications && (
                    <CardContent className="space-y-4">
                      <div className="grid grid-cols-3 gap-4">
                        <div className="flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-900 rounded-lg">
                          <Controller name="pressResponseRequired" control={control} render={({ field }) => (
                            <Switch checked={field.value} onCheckedChange={field.onChange} />
                          )} />
                          <Label className="text-sm">Press/Media Response Required</Label>
                        </div>
                        <div className="flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-900 rounded-lg">
                          <Controller name="investorNotificationRequired" control={control} render={({ field }) => (
                            <Switch checked={field.value} onCheckedChange={field.onChange} />
                          )} />
                          <Label className="text-sm">Investor Notification</Label>
                        </div>
                        <div className="flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-900 rounded-lg">
                          <Controller name="boardNotificationRequired" control={control} render={({ field }) => (
                            <Switch checked={field.value} onCheckedChange={field.onChange} />
                          )} />
                          <Label className="text-sm">Board Notification</Label>
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <Label className="text-sm font-medium">Investor Notification Threshold</Label>
                          <Input {...register('investorNotificationThreshold')} placeholder="e.g., Material impact >$10M" className="mt-1.5" />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Board Notification Threshold</Label>
                          <Input {...register('boardNotificationThreshold')} placeholder="e.g., Crisis level, >$50M exposure" className="mt-1.5" />
                        </div>
                      </div>
                      <div>
                        <Label className="text-sm font-medium">Pre-Approved Messaging</Label>
                        <Textarea {...register('preApprovedMessaging')} placeholder="Pre-approved statements or talking points..." rows={3} className="mt-1.5 resize-none" />
                      </div>
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* DEPENDENCIES */}
              <section id="dependencies" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="dependencies" title="Dependencies & Resources" icon={Link2} description="External vendors, systems, and resources">
                    <Button type="button" variant="outline" size="sm" onClick={() => dependenciesArray.append({ id: generateId(), type: "vendor", name: "", contactInfo: "", criticality: "medium", notes: "" })}>
                      <Plus className="mr-1.5 h-4 w-4" />Add
                    </Button>
                  </SectionHeader>
                  {expandedSections.dependencies && (
                    <CardContent>
                      {dependenciesArray.fields.length === 0 ? (
                        <div className="text-center py-6 text-slate-400 text-sm border-2 border-dashed rounded-lg">No dependencies</div>
                      ) : (
                        <div className="space-y-2">
                          {dependenciesArray.fields.map((field, index) => (
                            <div key={field.id} className="p-3 bg-slate-50 dark:bg-slate-900 rounded-lg space-y-2">
                              <div className="flex gap-2">
                                <Controller name={`dependencies.${index}.type`} control={control} render={({ field }) => (
                                  <Select value={field.value} onValueChange={field.onChange}>
                                    <SelectTrigger className="w-36"><SelectValue /></SelectTrigger>
                                    <SelectContent>{DEPENDENCY_TYPES.map(t => <SelectItem key={t.value} value={t.value}>{t.label}</SelectItem>)}</SelectContent>
                                  </Select>
                                )} />
                                <Input {...register(`dependencies.${index}.name`)} placeholder="Name" className="flex-1" />
                                <Controller name={`dependencies.${index}.criticality`} control={control} render={({ field }) => (
                                  <Select value={field.value} onValueChange={field.onChange}>
                                    <SelectTrigger className="w-28"><SelectValue /></SelectTrigger>
                                    <SelectContent>
                                      <SelectItem value="low">Low</SelectItem>
                                      <SelectItem value="medium">Medium</SelectItem>
                                      <SelectItem value="high">High</SelectItem>
                                      <SelectItem value="critical">Critical</SelectItem>
                                    </SelectContent>
                                  </Select>
                                )} />
                                <Button type="button" variant="ghost" size="sm" onClick={() => dependenciesArray.remove(index)}><Trash2 className="h-4 w-4 text-slate-400" /></Button>
                              </div>
                              <div className="grid grid-cols-2 gap-2">
                                <Input {...register(`dependencies.${index}.contactInfo`)} placeholder="Contact info" />
                                <Input {...register(`dependencies.${index}.notes`)} placeholder="Notes" />
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* GOVERNANCE */}
              <section id="governance" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="governance" title="Governance & Versioning" icon={Settings} description="Ownership and review schedule" />
                  {expandedSections.governance && (
                    <CardContent className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <Label className="text-sm font-medium">Playbook Owner</Label>
                          <Input {...register('playbookOwner')} placeholder="Accountable executive" className="mt-1.5" />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Owner Email</Label>
                          <Input {...register('playbookOwnerEmail')} type="email" placeholder="email@company.com" className="mt-1.5" />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Next Review Date</Label>
                          <Input type="date" {...register('nextReviewDate')} className="mt-1.5" />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Review Frequency</Label>
                          <Controller name="reviewFrequency" control={control} render={({ field }) => (
                            <Select value={field.value} onValueChange={field.onChange}>
                              <SelectTrigger className="mt-1.5"><SelectValue /></SelectTrigger>
                              <SelectContent>{REVIEW_FREQUENCIES.map(f => <SelectItem key={f.value} value={f.value}>{f.label}</SelectItem>)}</SelectContent>
                            </Select>
                          )} />
                        </div>
                      </div>
                      <div>
                        <Label className="text-sm font-medium">Version Notes</Label>
                        <Textarea {...register('versionNotes')} placeholder="Changes in this version..." rows={2} className="mt-1.5 resize-none" />
                      </div>
                      <div className="flex items-center gap-3">
                        <Controller name="changeApprovalRequired" control={control} render={({ field }) => (
                          <Switch checked={field.value} onCheckedChange={field.onChange} />
                        )} />
                        <Label className="text-sm">Changes Require Approval</Label>
                      </div>
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* GEOGRAPHIC SCOPE */}
              <section id="geographic" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="geographic" title="Geographic Scope" icon={Globe} description="Regions and jurisdictions" />
                  {expandedSections.geographic && (
                    <CardContent className="space-y-4">
                      <div>
                        <Label className="text-sm font-medium mb-2 block">Applicable Regions</Label>
                        <Controller name="geographicScope" control={control} render={({ field }) => (
                          <div className="flex flex-wrap gap-2">
                            {REGIONS.map(r => {
                              const selected = (field.value || []).includes(r.value);
                              return (
                                <button key={r.value} type="button" onClick={() => field.onChange(selected ? field.value.filter((v: string) => v !== r.value) : [...(field.value || []), r.value])}
                                  className={`px-3 py-1.5 text-xs rounded-full border transition-colors ${selected ? 'bg-purple-100 text-purple-700 border-purple-300' : 'bg-white dark:bg-slate-800 text-slate-500 border-slate-200'}`}>
                                  {r.label}
                                </button>
                              );
                            })}
                          </div>
                        )} />
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <Label className="text-sm font-medium">Primary Timezone</Label>
                          <Input {...register('primaryTimezone')} placeholder="e.g., America/New_York, UTC" className="mt-1.5" />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Local Regulatory Notes</Label>
                          <Input {...register('localRegulations')} placeholder="Jurisdiction-specific considerations" className="mt-1.5" />
                        </div>
                      </div>
                    </CardContent>
                  )}
                </Card>
              </section>
              
              {/* READINESS & TRAINING */}
              <section id="readiness" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="readiness" title="Readiness & Training" icon={GraduationCap} description="Drills and team preparation" />
                  {expandedSections.readiness && (
                    <CardContent className="space-y-4">
                      <div className="grid grid-cols-3 gap-4">
                        <div>
                          <Label className="text-sm font-medium">Last Drill Date</Label>
                          <Input type="date" {...register('lastDrillDate')} className="mt-1.5" />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Next Drill Date</Label>
                          <Input type="date" {...register('nextDrillDate')} className="mt-1.5" />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Drill Frequency</Label>
                          <Controller name="drillFrequency" control={control} render={({ field }) => (
                            <Select value={field.value} onValueChange={field.onChange}>
                              <SelectTrigger className="mt-1.5"><SelectValue /></SelectTrigger>
                              <SelectContent>{REVIEW_FREQUENCIES.map(f => <SelectItem key={f.value} value={f.value}>{f.label}</SelectItem>)}</SelectContent>
                            </Select>
                          )} />
                        </div>
                      </div>
                      <div>
                        <Label className="text-sm font-medium">Training Requirements</Label>
                        <Textarea {...register('trainingRequirements')} placeholder="Training needed for team members to execute this playbook..." rows={2} className="mt-1.5 resize-none" />
                      </div>
                      <div>
                        <Label className="text-sm font-medium">Certification Requirements</Label>
                        <Input {...register('certificationRequirements')} placeholder="Required certifications (e.g., PMP, CISSP, legal bar)" className="mt-1.5" />
                      </div>
                    </CardContent>
                  )}
                </Card>
              </section>

              {/* SUCCESS METRICS */}
              <section id="metrics" className="scroll-mt-24">
                <Card className="border-slate-200 dark:border-slate-800">
                  <SectionHeader id="metrics" title="Success Metrics" icon={Target} description="How success will be measured">
                    <Button type="button" variant="outline" size="sm" onClick={() => customMetricsArray.append({ name: "", target: "" })}>
                      <Plus className="mr-1.5 h-4 w-4" />Add Metric
                    </Button>
                  </SectionHeader>
                  {expandedSections.metrics && (
                    <CardContent className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <Label className="text-sm font-medium">Response Time Target (min)</Label>
                          <Input type="number" {...register('successMetrics.responseTimeTarget', { valueAsNumber: true })} className="mt-1.5" />
                        </div>
                        <div>
                          <Label className="text-sm font-medium">Stakeholder Engagement Target</Label>
                          <Input type="number" {...register('successMetrics.stakeholdersTarget', { valueAsNumber: true })} className="mt-1.5" />
                        </div>
                      </div>
                      {customMetricsArray.fields.length > 0 && (
                        <div className="space-y-2">
                          <Label className="text-sm font-medium">Custom Metrics</Label>
                          {customMetricsArray.fields.map((field, index) => (
                            <div key={field.id} className="flex gap-2">
                              <Input {...register(`successMetrics.customMetrics.${index}.name`)} placeholder="Metric name" className="flex-1" />
                              <Input {...register(`successMetrics.customMetrics.${index}.target`)} placeholder="Target" className="w-32" />
                              <Button type="button" variant="ghost" size="sm" onClick={() => customMetricsArray.remove(index)}><Trash2 className="h-4 w-4 text-slate-400" /></Button>
                            </div>
                          ))}
                        </div>
                      )}
                    </CardContent>
                  )}
                </Card>
              </section>
              
            </form>
          </div>
        </div>
      </div>
      
      {/* STICKY SAVE BAR */}
      <div className="fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 py-4 px-6 z-50">
        <div className="max-w-6xl mx-auto flex items-center justify-between">
          <div className="text-sm text-slate-500">
            {Object.keys(errors).length > 0 && (
              <span className="text-red-500">Please fix errors before saving</span>
            )}
          </div>
          <div className="flex items-center gap-3">
            <Button variant="outline" onClick={() => setLocation('/playbooks')} data-testid="button-cancel">Cancel</Button>
            <Button onClick={handleSubmit((data) => savePlaybook.mutate(data))} disabled={savePlaybook.isPending} data-testid="button-save-playbook">
              {savePlaybook.isPending ? "Saving..." : "Save Playbook"}
            </Button>
          </div>
        </div>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/PlaybookDetail.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { useParams, Link, useLocation } from 'wouter';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from '@/components/ui/alert-dialog';
import {
  ArrowLeft,
  Play,
  Target,
  Zap,
  Clock,
  Users,
  Shield,
  AlertTriangle,
  CheckCircle2,
  BookOpen,
  Settings,
  BarChart3,
  Layers,
} from 'lucide-react';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';
import PageLayout from '@/components/layout/PageLayout';
import { PhaseProgressBar } from '@/components/playbook/PhaseProgressBar';
import { PreparePhaseView } from '@/components/playbook/PreparePhaseView';
import { MonitorPhaseView } from '@/components/playbook/MonitorPhaseView';
import { LearnPhaseView } from '@/components/playbook/LearnPhaseView';
import { AIPrinciplesScorecard, DeterministicExecutionBadge } from '@/components/ai/AIPrinciplesScorecard';
import { ExecutionCommandCenter } from '@/components/execution/ExecutionCommandCenter';

const SEVERITY_COLORS = {
  critical: 'bg-red-100 text-red-700 dark:bg-red-950 dark:text-red-300',
  high: 'bg-orange-100 text-orange-700 dark:bg-orange-950 dark:text-orange-300',
  medium: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-950 dark:text-yellow-300',
  low: 'bg-green-100 text-green-700 dark:bg-green-950 dark:text-green-300',
};

export default function PlaybookDetail() {
  const { id } = useParams<{ id: string }>();
  const [, setLocation] = useLocation();
  const [activeTab, setActiveTab] = useState('overview');
  const { toast } = useToast();

  const { data: organizations = [] } = useQuery<any[]>({
    queryKey: ['/api/organizations'],
  });
  const organizationId = organizations[0]?.id;

  const { data: playbookData, isLoading } = useQuery<any>({
    queryKey: ['/api/playbook-library', id],
    queryFn: async () => {
      const response = await fetch(`/api/playbook-library/${id}`);
      if (!response.ok) throw new Error('Failed to fetch playbook');
      return response.json();
    },
    enabled: !!id,
  });
  
  const playbook = playbookData?.playbook;

  const { data: readiness } = useQuery<any>({
    queryKey: ['/api/playbook-library', id, 'readiness', { organizationId }],
    queryFn: async () => {
      const response = await fetch(
        `/api/playbook-library/${id}/readiness?organizationId=${organizationId}`
      );
      if (!response.ok) return null;
      return response.json();
    },
    enabled: !!id && !!organizationId,
  });

  const { data: users = [] } = useQuery<any[]>({
    queryKey: ['/api/users'],
    enabled: !!organizationId,
  });

  const activatePlaybookMutation = useMutation({
    mutationFn: async () => {
      const response = await apiRequest('POST', `/api/playbook-library/${id}/activate`, {
        scenarioId: `scenario-${Date.now()}`,
      });
      return response.json();
    },
    onSuccess: (result) => {
      toast({
        title: 'Playbook Activated',
        description: `12-minute execution window initiated. ${result.stakeholders} stakeholders notified.`,
      });
      setLocation('/command-center');
    },
    onError: (error) => {
      toast({
        title: 'Activation Failed',
        description: error instanceof Error ? error.message : 'Unable to activate playbook',
        variant: 'destructive',
      });
    },
  });

  const startDrillMutation = useMutation({
    mutationFn: async () => {
      if (!organizationId || !users[0]?.id) throw new Error('No organization or user found');

      const drillData = {
        organizationId,
        playbookId: id,
        drillName: `Practice Drill: ${playbook?.name || 'Playbook'}`,
        drillType: 'simulation',
        scenarioDescription: playbook?.description || 'Practice drill simulation',
        scheduledDate: new Date(),
        scheduledTime: new Date().toTimeString().slice(0, 5),
        estimatedDuration: 30,
        invitedParticipants: [],
        actualParticipants: [],
        status: 'scheduled',
        complications: null,
        createdBy: users[0].id,
      };

      const drillResponse = await apiRequest('POST', '/api/practice-drills', drillData);
      const drill = await drillResponse.json();
      await apiRequest('POST', `/api/practice-drills/${drill.id}/start`, {});
      return drill;
    },
    onSuccess: (drill) => {
      toast({
        title: 'Practice Drill Started',
        description: 'Navigating to live execution...',
      });
      setLocation(`/practice-drills/${drill.id}/live`);
    },
    onError: (error: any) => {
      toast({
        title: 'Error',
        description: error.message || 'Failed to start drill',
        variant: 'destructive',
      });
    },
  });

  const overallScore = readiness?.overallScore ?? 0;
  const canActivate = overallScore >= 50;

  if (isLoading) {
    return (
      <PageLayout>
        <div className="container mx-auto p-6 animate-pulse">
          <div className="h-8 w-64 bg-slate-200 dark:bg-slate-800 rounded mb-4" />
          <div className="h-48 bg-slate-200 dark:bg-slate-800 rounded" />
        </div>
      </PageLayout>
    );
  }

  if (!playbook) {
    return (
      <PageLayout>
        <div className="container mx-auto p-6 text-center">
          <AlertTriangle className="h-12 w-12 mx-auto mb-4 text-amber-500" />
          <h2 className="text-xl font-semibold mb-2">Playbook Not Found</h2>
          <p className="text-muted-foreground mb-4">
            The requested playbook could not be found.
          </p>
          <Button asChild>
            <Link href="/playbook-library">Back to Library</Link>
          </Button>
        </div>
      </PageLayout>
    );
  }

  return (
    <PageLayout>
      <div className="container mx-auto px-4 sm:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6" data-testid="playbook-detail-page">
        <div className="flex items-center gap-4 mb-4 sm:mb-6">
          <Button variant="ghost" size="sm" asChild data-testid="button-back">
            <Link href="/playbook-library">
              <ArrowLeft className="h-4 w-4 sm:mr-2" />
              <span className="hidden sm:inline">Back to Library</span>
            </Link>
          </Button>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
          <div className="lg:col-span-2 space-y-4 sm:space-y-6">
            <Card>
              <CardHeader className="pb-3 sm:pb-4">
                <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2">
                  <div className="space-y-2">
                    <div className="flex flex-wrap items-center gap-2">
                      <Badge variant="outline">#{playbook.playbookNumber}</Badge>
                      {playbook.primaryExecutiveRole && (
                        <Badge>{playbook.primaryExecutiveRole}</Badge>
                      )}
                    </div>
                    <CardTitle className="text-lg sm:text-2xl" data-testid="text-playbook-title">
                      {playbook.name}
                    </CardTitle>
                    <CardDescription className="text-sm sm:text-base">
                      {playbook.description}
                    </CardDescription>
                  </div>
                </div>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-4">
                  <div className="text-center p-2 sm:p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                    <Clock className="h-4 w-4 sm:h-5 sm:w-5 mx-auto mb-1 text-blue-500" />
                    <div className="text-sm sm:text-base font-semibold">{playbook.timeSensitivity || 12}h</div>
                    <div className="text-[10px] sm:text-xs text-muted-foreground">Response</div>
                  </div>
                  <div className="text-center p-2 sm:p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                    <Shield className="h-4 w-4 sm:h-5 sm:w-5 mx-auto mb-1 text-orange-500" />
                    <div className="text-sm sm:text-base font-semibold">{playbook.severityScore || 75}</div>
                    <div className="text-[10px] sm:text-xs text-muted-foreground">Severity</div>
                  </div>
                  <div className="text-center p-2 sm:p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                    <Users className="h-4 w-4 sm:h-5 sm:w-5 mx-auto mb-1 text-purple-500" />
                    <div className="text-sm sm:text-base font-semibold">
                      {(playbook.tier1Count || 0) + (playbook.tier2Count || 0)}
                    </div>
                    <div className="text-[10px] sm:text-xs text-muted-foreground">Teams</div>
                  </div>
                  <div className="text-center p-2 sm:p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                    <Target className="h-4 w-4 sm:h-5 sm:w-5 mx-auto mb-1 text-green-500" />
                    <div className="text-sm sm:text-base font-semibold">{playbook.historicalFrequency || 'N/A'}</div>
                    <div className="text-[10px] sm:text-xs text-muted-foreground">Frequency</div>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
              <TabsList className="grid w-full grid-cols-5" data-testid="phase-tabs">
                <TabsTrigger value="overview" className="flex items-center gap-1">
                  <Layers className="h-4 w-4" />
                  <span className="hidden sm:inline">Overview</span>
                </TabsTrigger>
                <TabsTrigger value="identify" className="flex items-center gap-1">
                  <span className="text-blue-500 font-bold">I</span>
                  <span className="hidden sm:inline">Identify</span>
                </TabsTrigger>
                <TabsTrigger value="detect" className="flex items-center gap-1">
                  <span className="text-amber-500 font-bold">D</span>
                  <span className="hidden sm:inline">Detect</span>
                </TabsTrigger>
                <TabsTrigger value="execute" className="flex items-center gap-1">
                  <span className="text-green-500 font-bold">E</span>
                  <span className="hidden sm:inline">Execute</span>
                </TabsTrigger>
                <TabsTrigger value="advance" className="flex items-center gap-1">
                  <span className="text-purple-500 font-bold">A</span>
                  <span className="hidden sm:inline">Advance</span>
                </TabsTrigger>
              </TabsList>

              <TabsContent value="overview" className="mt-6 space-y-6">
                <Card>
                  <CardHeader>
                    <CardTitle className="text-lg">Trigger Criteria</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <p className="text-muted-foreground">{playbook.triggerCriteria}</p>
                  </CardContent>
                </Card>

                {playbook.tier1Stakeholders && (
                  <Card>
                    <CardHeader>
                      <CardTitle className="text-lg">Key Stakeholders</CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div>
                        <h4 className="font-medium text-sm mb-2">Tier 1 - Decision Makers</h4>
                        <div className="flex flex-wrap gap-2">
                          {(typeof playbook.tier1Stakeholders === 'object'
                            ? Object.values(playbook.tier1Stakeholders)
                            : [playbook.tier1Stakeholders]
                          ).map((s: any, i: number) => (
                            <Badge key={i} variant="secondary">
                              {typeof s === 'string' ? s : s?.role || 'Unknown'}
                            </Badge>
                          ))}
                        </div>
                      </div>
                      {playbook.tier2Stakeholders && (
                        <div>
                          <h4 className="font-medium text-sm mb-2">Tier 2 - Execution Team</h4>
                          <div className="flex flex-wrap gap-2">
                            {(typeof playbook.tier2Stakeholders === 'object'
                              ? Object.values(playbook.tier2Stakeholders)
                              : [playbook.tier2Stakeholders]
                            ).map((s: any, i: number) => (
                              <Badge key={i} variant="outline">
                                {typeof s === 'string' ? s : s?.role || 'Unknown'}
                              </Badge>
                            ))}
                          </div>
                        </div>
                      )}
                    </CardContent>
                  </Card>
                )}
              </TabsContent>

              <TabsContent value="identify" className="mt-6">
                {organizationId ? (
                  <PreparePhaseView
                    playbookId={id!}
                    organizationId={organizationId}
                    isEditable={true}
                  />
                ) : (
                  <Card>
                    <CardContent className="py-12 text-center">
                      <p className="text-muted-foreground">Loading organization...</p>
                    </CardContent>
                  </Card>
                )}
              </TabsContent>

              <TabsContent value="detect" className="mt-6">
                {organizationId ? (
                  <MonitorPhaseView
                    playbookId={id!}
                    organizationId={organizationId}
                    isEditable={true}
                  />
                ) : (
                  <Card>
                    <CardContent className="py-12 text-center">
                      <p className="text-muted-foreground">Loading organization...</p>
                    </CardContent>
                  </Card>
                )}
              </TabsContent>

              <TabsContent value="execute" className="mt-6">
                {organizationId && id ? (
                  <ExecutionCommandCenter
                    organizationId={organizationId}
                    scenarioId={playbookData?.scenario?.id || null}
                    executionPlanId={playbookData?.executionPlan?.id || id}
                    playbookId={id}
                    playbookName={playbook?.name || 'Playbook'}
                    userId={users[0]?.id}
                  />
                ) : (
                  <Card>
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <Zap className="h-5 w-5 text-orange-500" />
                        EXECUTE Phase
                      </CardTitle>
                      <CardDescription>
                        12-minute coordinated response window
                      </CardDescription>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div className="bg-orange-50 dark:bg-orange-950/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4">
                        <h4 className="font-medium mb-2 flex items-center gap-2">
                          <Clock className="h-4 w-4" />
                          When Activated
                        </h4>
                        <ul className="text-sm text-muted-foreground space-y-2">
                          <li className="flex items-start gap-2">
                            <CheckCircle2 className="h-4 w-4 text-green-500 mt-0.5 shrink-0" />
                            Auto-creates Jira project with all tasks
                          </li>
                          <li className="flex items-start gap-2">
                            <CheckCircle2 className="h-4 w-4 text-green-500 mt-0.5 shrink-0" />
                            Assigns all stakeholders to their roles
                          </li>
                          <li className="flex items-start gap-2">
                            <CheckCircle2 className="h-4 w-4 text-green-500 mt-0.5 shrink-0" />
                            Stages all pre-approved documents
                          </li>
                          <li className="flex items-start gap-2">
                            <CheckCircle2 className="h-4 w-4 text-green-500 mt-0.5 shrink-0" />
                            Unlocks pre-approved budgets
                          </li>
                          <li className="flex items-start gap-2">
                            <CheckCircle2 className="h-4 w-4 text-green-500 mt-0.5 shrink-0" />
                            Notifies all stakeholders via preferred channels
                          </li>
                        </ul>
                      </div>

                      <div className="text-center py-6">
                        <div className="text-4xl font-bold text-orange-500 mb-2">
                          72 hrs  12 min
                        </div>
                        <p className="text-sm text-muted-foreground">
                          M eliminates the planning phase entirely
                        </p>
                      </div>
                    </CardContent>
                  </Card>
                )}
              </TabsContent>

              <TabsContent value="advance" className="mt-6">
                {organizationId ? (
                  <LearnPhaseView
                    playbookId={id!}
                    organizationId={organizationId}
                    isEditable={true}
                  />
                ) : (
                  <Card>
                    <CardContent className="py-12 text-center">
                      <p className="text-muted-foreground">Loading organization...</p>
                    </CardContent>
                  </Card>
                )}
              </TabsContent>
            </Tabs>
          </div>

          <div className="space-y-6">
            <Card className="sticky top-6">
              <CardHeader>
                <CardTitle className="text-lg">Playbook Readiness</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="text-center py-4">
                  <div
                    className={`text-5xl font-bold mb-2 ${
                      overallScore >= 80
                        ? 'text-green-500'
                        : overallScore >= 50
                        ? 'text-yellow-500'
                        : 'text-red-500'
                    }`}
                    data-testid="overall-readiness-score"
                  >
                    {overallScore}%
                  </div>
                  <p className="text-sm text-muted-foreground">
                    {overallScore >= 80
                      ? 'Ready for activation'
                      : overallScore >= 50
                      ? 'Minimum readiness met'
                      : 'Below minimum threshold'}
                  </p>
                </div>

                <PhaseProgressBar
                  prepareScore={readiness?.prepareScore ?? 0}
                  monitorScore={readiness?.monitorScore ?? 0}
                  executeScore={readiness?.executeScore ?? 0}
                  learnScore={readiness?.learnScore ?? 0}
                />

                <div className="space-y-3 pt-4">
                  <AlertDialog>
                    <AlertDialogTrigger asChild>
                      <Button
                        className="w-full"
                        size="lg"
                        disabled={!canActivate || activatePlaybookMutation.isPending}
                        data-testid="button-activate"
                      >
                        <Zap className="h-5 w-5 mr-2" />
                        {activatePlaybookMutation.isPending
                          ? 'Activating...'
                          : 'Activate Playbook'}
                      </Button>
                    </AlertDialogTrigger>
                    <AlertDialogContent>
                      <AlertDialogHeader>
                        <AlertDialogTitle>Activate Playbook?</AlertDialogTitle>
                        <AlertDialogDescription>
                          This will initiate the 12-minute execution window. All stakeholders will
                          be notified, tasks will be created, and budgets will be unlocked. This
                          action cannot be undone.
                        </AlertDialogDescription>
                      </AlertDialogHeader>
                      <AlertDialogFooter>
                        <AlertDialogCancel>Cancel</AlertDialogCancel>
                        <AlertDialogAction
                          onClick={() => activatePlaybookMutation.mutate()}
                          className="bg-orange-500 hover:bg-orange-600"
                        >
                          Yes, Activate Now
                        </AlertDialogAction>
                      </AlertDialogFooter>
                    </AlertDialogContent>
                  </AlertDialog>

                  {!canActivate && (
                    <div className="flex items-center gap-2 p-3 bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 rounded-lg text-sm">
                      <AlertTriangle className="h-4 w-4 text-amber-500 shrink-0" />
                      <span className="text-amber-700 dark:text-amber-300">
                        Readiness must be at least 50% to activate
                      </span>
                    </div>
                  )}

                  <Button
                    variant="outline"
                    className="w-full"
                    onClick={() => startDrillMutation.mutate()}
                    disabled={startDrillMutation.isPending}
                    data-testid="button-run-drill"
                  >
                    <Play className="h-4 w-4 mr-2" />
                    {startDrillMutation.isPending ? 'Starting...' : 'Run Practice Drill'}
                  </Button>

                  <Button variant="ghost" className="w-full" asChild>
                    <Link href={`/playbook-library/${id}/settings`}>
                      <Settings className="h-4 w-4 mr-2" />
                      Configure Settings
                    </Link>
                  </Button>
                </div>
              </CardContent>
            </Card>

            {readiness && (
              <Card>
                <CardHeader>
                  <CardTitle className="text-lg flex items-center gap-2">
                    <BarChart3 className="h-5 w-5" />
                    Readiness Breakdown
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center justify-between text-sm">
                    <span>Stakeholders Assigned</span>
                    <span className="font-medium">
                      {readiness.stakeholdersAssigned || 0}/{readiness.stakeholdersTotal || 0}
                    </span>
                  </div>
                  <div className="flex items-center justify-between text-sm">
                    <span>Documents Ready</span>
                    <span className="font-medium">
                      {readiness.documentsReady || 0}/{readiness.documentsTotal || 0}
                    </span>
                  </div>
                  <div className="flex items-center justify-between text-sm">
                    <span>Resources Staged</span>
                    <span className="font-medium">
                      {readiness.resourcesStaged || 0}/{readiness.resourcesTotal || 0}
                    </span>
                  </div>
                  <div className="flex items-center justify-between text-sm">
                    <span>Triggers Active</span>
                    <span className="font-medium">
                      {readiness.triggersActive || 0}/{readiness.triggersConfigured || 0}
                    </span>
                  </div>
                  <div className="flex items-center justify-between text-sm">
                    <span>Learn Items</span>
                    <span className="font-medium">
                      {readiness.learnItemsConfigured || 0}
                    </span>
                  </div>
                </CardContent>
              </Card>
            )}

            {(playbook?.playbookNumber >= 163 && playbook?.playbookNumber <= 180) && (
              <AIPrinciplesScorecard compact={false} />
            )}

            <Card className="p-4">
              <DeterministicExecutionBadge />
            </Card>
          </div>
        </div>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/PlaybookLibrary.tsx
========================================
import { useMemo, useState } from "react";
import { useQuery } from "@tanstack/react-query";
import { useLocation, useRoute } from "wouter";

import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { useCustomer } from "@/contexts/CustomerContext";

import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Switch } from "@/components/ui/switch";

import {
  ArrowRight,
  Layers,
  BookOpen,
  Shield,
  Zap,
  Search,
  Target,
  Clock,
  Users,
  Sparkles,
  AlertTriangle,
  TrendingUp,
  Settings,
} from "lucide-react";

import type { PlaybookLibrary as PlaybookType } from "@shared/schema";

type Telemetry = {
  lastUsedAt: string | null;
  avgOutcomeScore: number | null;
  executionCount: number;
};

// Marketing category display configuration
// Counts are now driven by strategicCategory field from database (58/56/52 split)
const CATEGORIES = {
  offense: {
    label: "OFFENSE",
    tagline: "Seize Opportunities",
    icon: Target,
    color: "emerald",
    gradient: "from-emerald-50 to-emerald-100 dark:from-emerald-950/40 dark:to-emerald-900/30",
    border: "border-emerald-200 dark:border-emerald-800",
    text: "text-emerald-700 dark:text-emerald-400",
    badge: "bg-emerald-500 text-white",
    domains: ["Market Dynamics", "Market Opportunities"],
  },
  defense: {
    label: "DEFENSE",
    tagline: "Protect Value",
    icon: Shield,
    color: "blue",
    gradient: "from-blue-50 to-blue-100 dark:from-blue-950/40 dark:to-blue-900/30",
    border: "border-blue-200 dark:border-blue-800",
    text: "text-blue-700 dark:text-blue-400",
    badge: "bg-blue-500 text-white",
    domains: ["Regulatory & Compliance", "Operational Excellence", "Financial Strategy", "Brand & Reputation"],
  },
  special_teams: {
    label: "SPECIAL TEAMS",
    tagline: "Change the Game",
    icon: Zap,
    color: "purple",
    gradient: "from-purple-50 to-purple-100 dark:from-purple-950/40 dark:to-purple-900/30",
    border: "border-purple-200 dark:border-purple-800",
    text: "text-purple-700 dark:text-purple-400",
    badge: "bg-purple-500 text-white",
    domains: ["Technology & Innovation", "Talent & Leadership", "AI Governance"],
  },
} as const;

type Category = keyof typeof CATEGORIES;

interface PlaybookLibraryResponse {
  domains: unknown[];
  categories: unknown[];
  playbooks: PlaybookType[];
}

export default function PlaybookLibrary() {
  const [location, setLocation] = useLocation();
  const [search, setSearch] = useState("");
  const [actNowMode, setActNowMode] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState<Category | null>(null);
  const { organization } = useCustomer();
  
  const basePath = location.startsWith('/identify/') ? '/identify' : '';

  const { data: response, isLoading } = useQuery<PlaybookLibraryResponse>({
    queryKey: ["/api/playbook-library"],
  });

  const { data: telemetry } = useQuery<Record<string, Telemetry>>({
    queryKey: ["/api/playbook-library/telemetry", organization?.id],
    queryFn: async () => {
      if (!organization?.id) return {};
      const res = await fetch(`/api/playbook-library/telemetry?organizationId=${organization.id}`);
      if (!res.ok) return {};
      return res.json();
    },
    enabled: !!organization?.id,
  });

  const data = response?.playbooks;

  const enriched = useMemo(() => {
    if (!data) return [];

    return data.map((pb) => {
      const t = telemetry?.[pb.id];
      const daysAgo = t?.lastUsedAt
        ? Math.floor(
            (Date.now() - new Date(t.lastUsedAt).getTime()) / 86400000
          )
        : 999;

      const urgency =
        daysAgo > 30 || (t?.avgOutcomeScore ?? 100) < 70 ? "high" : "normal";

      return {
        ...pb,
        executions: t?.executionCount ?? 0,
        avgOutcome: t?.avgOutcomeScore,
        daysAgo,
        urgency,
      };
    });
  }, [data, telemetry]);

  const filtered = useMemo(() => {
    const q = search.toLowerCase();
    
    return enriched.filter((pb) => {
      if (!pb || !pb.name) return false;
      
      const matchesSearch = !q || 
        pb.name.toLowerCase().includes(q) ||
        pb.description?.toLowerCase().includes(q) ||
        pb.triggerCriteria?.toLowerCase().includes(q);
      
      if (!matchesSearch) return false;
      
      // Filter by strategicCategory field directly from database
      if (selectedCategory) {
        const pbCategory = (pb as any).strategicCategory || "";
        return pbCategory === selectedCategory;
      }
      
      return true;
    });
  }, [enriched, search, selectedCategory]);

  const sorted = useMemo(() => {
    if (!actNowMode) return filtered;
    return [...filtered].sort((a, b) => {
      if (a.urgency !== b.urgency) return a.urgency === "high" ? -1 : 1;
      return a.daysAgo - b.daysAgo;
    });
  }, [filtered, actNowMode]);

  const totalCount = sorted.length;

  const categoryCounts = useMemo(() => {
    const counts: Record<Category, number> = { offense: 0, defense: 0, special_teams: 0 };
    enriched.forEach((pb) => {
      const category = (pb as any).strategicCategory as Category;
      if (category && counts[category] !== undefined) {
        counts[category]++;
      }
    });
    return counts;
  }, [enriched]);

  // Count domains per category (accounts for Financial Strategy being split)
  const domainCountsByCategory = useMemo(() => {
    const counts: Record<Category, Record<string, number>> = {
      offense: {},
      defense: {},
      special_teams: {},
    };
    enriched.forEach((pb) => {
      const category = (pb as any).strategicCategory as Category;
      const domain = (pb as any).domainName || "Unknown";
      if (category && counts[category]) {
        counts[category][domain] = (counts[category][domain] || 0) + 1;
      }
    });
    return counts;
  }, [enriched]);

  return (
    <>
      <StandardNav />

      <main className="max-w-7xl mx-auto px-6 py-12">
        <header className="mb-10" data-testid="playbook-library-header">
          <h1 className="text-4xl font-bold text-slate-900 dark:text-white">
            {actNowMode ? "Act Now" : "Playbook Library"}
          </h1>
          <p className="text-slate-600 dark:text-slate-400 mt-2">
            {actNowMode 
              ? "Prioritized plays based on real execution data."
              : "From signal to coordinated action in minutesnot days. Success favors the prepared."
            }
          </p>
        </header>

        <div className="flex flex-wrap items-center gap-6 mb-10">
          <div className="max-w-md relative flex-1" data-testid="search-container">
            <Search className="absolute left-3 top-2.5 h-4 w-4 text-slate-400" />
            <Input
              placeholder="Search by scenario, domain, or objective"
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              className="pl-10"
              data-testid="input-search"
            />
          </div>

          <div className="flex items-center gap-3">
            <Switch 
              checked={actNowMode} 
              onCheckedChange={setActNowMode}
              data-testid="switch-act-now"
            />
            <span className="text-sm text-slate-600 dark:text-slate-400">Act Now priority</span>
          </div>
        </div>

        {!isLoading && !actNowMode && (
          <div className="grid grid-cols-2 md:grid-cols-4 gap-6 mb-14" data-testid="stats-bar">
            <Stat label="Total Playbooks" value={enriched.length} testId="stat-total" />
            <Stat label="Offense" value={categoryCounts.offense} testId="stat-offense" />
            <Stat label="Defense" value={categoryCounts.defense} testId="stat-defense" />
            <Stat label="Special Teams" value={categoryCounts.special_teams} testId="stat-special" />
          </div>
        )}

        {!actNowMode && (
          <div className="grid md:grid-cols-3 gap-6 mb-14">
            {(Object.keys(CATEGORIES) as Category[]).map((category) => {
              const meta = CATEGORIES[category];
              const IconComponent = meta.icon;
              const isSelected = selectedCategory === category;

              return (
                <Card 
                  key={category} 
                  className={`bg-gradient-to-br ${meta.gradient} ${meta.border} cursor-pointer transition-all hover:shadow-lg hover:-translate-y-1 ${isSelected ? 'ring-2 ring-offset-2 ring-slate-900 dark:ring-white' : ''}`}
                  onClick={() => setSelectedCategory(isSelected ? null : category)}
                  data-testid={`card-category-${category}`}
                >
                  <CardHeader className="pb-3">
                    <div className="flex items-center gap-3">
                      <div className={`w-10 h-10 rounded-lg flex items-center justify-center bg-white/50 dark:bg-black/20`}>
                        <IconComponent className={`h-5 w-5 ${meta.text}`} />
                      </div>
                      <div>
                        <CardTitle className={meta.text}>{meta.label}</CardTitle>
                        <CardDescription className="text-slate-600 dark:text-slate-400">{meta.tagline}</CardDescription>
                      </div>
                    </div>
                  </CardHeader>
                  <CardContent className="pt-0">
                    <div className="space-y-2 text-sm">
                      {Object.entries(domainCountsByCategory[category])
                        .sort(([,a], [,b]) => b - a)
                        .map(([domainName, count]) => (
                        <div key={domainName} className="flex justify-between items-center">
                          <span className="text-slate-600 dark:text-slate-400 truncate">{domainName}</span>
                          <span className={`${meta.text} font-medium ml-2`}>{count}</span>
                        </div>
                      ))}
                    </div>
                    <div className="mt-4 pt-3 border-t border-slate-200 dark:border-slate-700 flex items-center justify-between">
                      <Badge className={meta.badge}>{categoryCounts[category]} Playbooks</Badge>
                      {isSelected && (
                        <span className="text-xs text-slate-500">Click to clear</span>
                      )}
                    </div>
                  </CardContent>
                </Card>
              );
            })}
          </div>
        )}
        
        {selectedCategory && (
          <div className="mb-6 flex items-center gap-3">
            <Badge variant="secondary" className="text-sm py-1 px-3">
              Filtering: {CATEGORIES[selectedCategory].label}
            </Badge>
            <Button 
              variant="ghost" 
              size="sm"
              onClick={() => setSelectedCategory(null)}
              data-testid="button-clear-filter"
            >
              Clear filter
            </Button>
          </div>
        )}

        {isLoading && (
          <div className="py-24 text-center text-slate-500" data-testid="loading-state">
            <Layers className="h-8 w-8 mx-auto mb-3 animate-pulse" />
            {actNowMode ? "Analyzing execution history" : "Loading strategic plays"}
          </div>
        )}

        {!isLoading && totalCount === 0 && (
          <div className="py-24 text-center text-slate-500" data-testid="empty-state">
            <BookOpen className="h-12 w-12 mx-auto mb-3 opacity-50" />
            <p className="font-medium">No playbooks found.</p>
            <p className="text-sm mt-1">Strategy gaps often hide here.</p>
          </div>
        )}

        {!isLoading && totalCount > 0 && (
          <section data-testid="playbooks-grid">
            <h2 className="text-2xl font-bold text-slate-900 dark:text-white mb-6">
              {actNowMode 
                ? "Priority Playbooks" 
                : selectedCategory 
                  ? `${CATEGORIES[selectedCategory].label} Playbooks` 
                  : "All Playbooks"
              } ({totalCount})
            </h2>
            <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
              {sorted.map((playbook) => (
                <Card
                  key={playbook.id}
                  className="cursor-pointer transition hover:shadow-xl hover:-translate-y-1"
                  onClick={() => setLocation(`${basePath}/playbook-command/${playbook.id}`)}
                  data-testid={`card-playbook-${playbook.id}`}
                >
                  <CardHeader className="space-y-3">
                    <div className="flex items-start justify-between gap-2">
                      <CardTitle className="text-lg leading-tight">{playbook.name}</CardTitle>
                      {playbook.playbookNumber && (
                        <Badge variant="outline" className="shrink-0">
                          #{playbook.playbookNumber}
                        </Badge>
                      )}
                    </div>
                    {playbook.primaryExecutiveRole && (
                      <CardDescription>{playbook.primaryExecutiveRole}</CardDescription>
                    )}

                    <div className="flex flex-wrap gap-2">
                      <Badge variant="outline">
                        <Clock className="h-3 w-3 mr-1" />
                        ~12 min
                      </Badge>
                      
                      {playbook.urgency === "high" && (
                        <Badge className="bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-400">
                          <AlertTriangle className="h-3 w-3 mr-1" />
                          Act now
                        </Badge>
                      )}
                    </div>
                  </CardHeader>

                  <CardContent className="space-y-4">
                    <div className="text-sm text-slate-500 dark:text-slate-400 space-y-1">
                      <div>
                        Last used:{" "}
                        {playbook.daysAgo === 999 ? "Never" : `${playbook.daysAgo} days ago`}
                      </div>
                      <div>Executions: {playbook.executions}</div>
                      {playbook.avgOutcome !== null && playbook.avgOutcome !== undefined && (
                        <div className="flex items-center gap-1">
                          <TrendingUp className="h-4 w-4" />
                          Avg outcome: {Math.round(playbook.avgOutcome)}%
                        </div>
                      )}
                    </div>

                    {playbook.preApprovedBudget && (
                      <div className="text-sm text-slate-500">
                        Pre-approved: ${Number(playbook.preApprovedBudget).toLocaleString()}
                      </div>
                    )}

                    <div className="flex gap-2">
                      <Button
                        variant="outline"
                        className="flex-1"
                        onClick={(e) => {
                          e.stopPropagation();
                          setLocation(`/playbooks/${playbook.id}/customize`);
                        }}
                        data-testid={`button-customize-${playbook.id}`}
                      >
                        <Settings className="h-4 w-4 mr-2" />
                        Customize
                      </Button>
                      <Button
                        variant="default"
                        className="flex-1"
                        onClick={(e) => {
                          e.stopPropagation();
                          setLocation(`${basePath}/playbook-command/${playbook.id}`);
                        }}
                        data-testid={`button-execute-${playbook.id}`}
                      >
                        Execute
                        <ArrowRight className="h-4 w-4 ml-2" />
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </section>
        )}
      </main>

      <Footer />
    </>
  );
}

function Stat({ label, value, testId }: { label: string; value: number; testId: string }) {
  return (
    <div className="text-center" data-testid={testId}>
      <div className="text-3xl font-bold text-slate-900 dark:text-white">{value}</div>
      <div className="text-sm text-slate-500">{label}</div>
    </div>
  );
}


========================================
FILE: client/src/pages/PlaybookLibraryV2.tsx
========================================
import { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from "@/components/ui/dropdown-menu";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { useQuery } from "@tanstack/react-query";
import { useLocation } from "wouter";
import { Search, Plus, Eye, Copy, Edit, Target, Shield, Zap, Clock, Users, Star, MoreHorizontal, ArrowLeft, ChevronRight, BookOpen } from "lucide-react";
import type { Playbook } from "@shared/schema";
import { useCustomer } from "@/contexts/CustomerContext";

const categoryConfig = {
  offense: {
    label: 'OFFENSE',
    tagline: 'Seize Opportunities',
    description: 'Market expansion, M&A integration, and product launches',
    icon: Target,
    color: 'emerald',
    bgGradient: 'from-emerald-500 to-emerald-600',
    lightBg: 'bg-gradient-to-br from-emerald-50 to-emerald-100/50 dark:from-emerald-950/40 dark:to-emerald-900/20',
    iconBg: 'bg-emerald-500',
    textColor: 'text-emerald-600 dark:text-emerald-400',
    borderColor: 'border-emerald-200 dark:border-emerald-800/50',
    hoverBorder: 'hover:border-emerald-400 dark:hover:border-emerald-600',
    count: 58,
    domains: [
      { name: 'Market Entry & Expansion', count: 22 },
      { name: 'M&A Integration', count: 16 },
      { name: 'Product Launch', count: 20 }
    ]
  },
  defense: {
    label: 'DEFENSE',
    tagline: 'Protect Value',
    description: 'Crisis response, cyber incidents, and regulatory compliance',
    icon: Shield,
    color: 'blue',
    bgGradient: 'from-blue-500 to-blue-600',
    lightBg: 'bg-gradient-to-br from-blue-50 to-blue-100/50 dark:from-blue-950/40 dark:to-blue-900/20',
    iconBg: 'bg-blue-500',
    textColor: 'text-blue-600 dark:text-blue-400',
    borderColor: 'border-blue-200 dark:border-blue-800/50',
    hoverBorder: 'hover:border-blue-400 dark:hover:border-blue-600',
    count: 56,
    domains: [
      { name: 'Crisis Response', count: 24 },
      { name: 'Cyber Incidents', count: 18 },
      { name: 'Regulatory Compliance', count: 14 }
    ]
  },
  special_teams: {
    label: 'SPECIAL TEAMS',
    tagline: 'Change the Game',
    description: 'Digital transformation, competitive response, and AI governance',
    icon: Zap,
    color: 'purple',
    bgGradient: 'from-purple-500 to-purple-600',
    lightBg: 'bg-gradient-to-br from-purple-50 to-purple-100/50 dark:from-purple-950/40 dark:to-purple-900/20',
    iconBg: 'bg-purple-500',
    textColor: 'text-purple-600 dark:text-purple-400',
    borderColor: 'border-purple-200 dark:border-purple-800/50',
    hoverBorder: 'hover:border-purple-400 dark:hover:border-purple-600',
    count: 52,
    domains: [
      { name: 'Digital Transformation', count: 16 },
      { name: 'Competitive Response', count: 18 },
      { name: 'AI Governance', count: 18 }
    ]
  }
};

type Category = keyof typeof categoryConfig;

export default function PlaybookLibraryV2() {
  const [, setLocation] = useLocation();
  const [selectedCategory, setSelectedCategory] = useState<Category | null>(null);
  const [search, setSearch] = useState("");
  const [domainFilter, setDomainFilter] = useState<string>("all");
  const { organization } = useCustomer();
  
  const { data: templates, isLoading: loadingTemplates } = useQuery<Playbook[]>({
    queryKey: ['/api/playbooks/templates'],
  });
  
  const { data: myPlaybooks } = useQuery<Playbook[]>({
    queryKey: ['/api/playbooks', organization?.id],
    queryFn: async () => {
      const res = await fetch(`/api/playbooks?organizationId=${organization?.id || ''}`);
      if (!res.ok) return [];
      return res.json();
    },
    enabled: true
  });
  
  const domains = Array.from(new Set(templates?.map(t => t.domain).filter(Boolean) || []));
  
  const getCategoryPlaybooks = (category: Category) => {
    return templates?.filter(t => {
      const matchesCategory = t.category === category;
      const matchesSearch = !search || 
        t.name?.toLowerCase().includes(search.toLowerCase()) ||
        t.description?.toLowerCase().includes(search.toLowerCase());
      const matchesDomain = domainFilter === "all" || t.domain === domainFilter;
      return matchesCategory && matchesSearch && matchesDomain;
    }) || [];
  };

  const categoryCounts = {
    offense: templates?.filter(t => t.category === 'offense').length || 58,
    defense: templates?.filter(t => t.category === 'defense').length || 56,
    special_teams: templates?.filter(t => t.category === 'special_teams').length || 52
  };
  
  const totalCount = categoryCounts.offense + categoryCounts.defense + categoryCounts.special_teams;
  
  return (
    <div className="min-h-screen bg-slate-50 dark:bg-slate-950">
      <StandardNav />
      
      {!selectedCategory ? (
        <>
          <div className="bg-slate-900 dark:bg-slate-950 border-b border-slate-800">
            <div className="max-w-6xl mx-auto px-6 pt-24 pb-16">
              <div className="flex items-center justify-between">
                <div>
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                      <BookOpen className="h-5 w-5 text-white" />
                    </div>
                    <h1 className="text-2xl font-semibold text-white tracking-tight">
                      Playbook Library
                    </h1>
                  </div>
                  <p className="text-slate-400 max-w-lg">
                    {totalCount} battle-tested strategic playbooks. Select a category to explore.
                  </p>
                </div>
                <Button 
                  onClick={() => setLocation('/playbooks/create')} 
                  className="bg-white text-slate-900 hover:bg-slate-100"
                  data-testid="button-create-playbook"
                >
                  <Plus className="mr-2 h-4 w-4" />
                  Create Custom
                </Button>
              </div>
            </div>
          </div>
          
          <div className="max-w-6xl mx-auto px-6 -mt-8">
            <div className="grid md:grid-cols-3 gap-5">
              {(['offense', 'defense', 'special_teams'] as Category[]).map((category) => {
                const config = categoryConfig[category];
                const Icon = config.icon;
                const count = categoryCounts[category];
                
                return (
                  <Card
                    key={category}
                    className={`group cursor-pointer bg-white dark:bg-slate-900 border-2 ${config.borderColor} ${config.hoverBorder} transition-all duration-200 hover:shadow-xl hover:-translate-y-1`}
                    onClick={() => setSelectedCategory(category)}
                    data-testid={`card-category-${category}`}
                  >
                    <CardContent className="p-6">
                      <div className="flex items-start justify-between mb-4">
                        <div className={`w-12 h-12 rounded-xl ${config.iconBg} flex items-center justify-center shadow-lg`}>
                          <Icon className="h-6 w-6 text-white" />
                        </div>
                        <span className="text-3xl font-bold text-slate-900 dark:text-white">
                          {count}
                        </span>
                      </div>
                      
                      <h3 className="text-lg font-bold text-slate-900 dark:text-white mb-1 tracking-tight">
                        {config.label}
                      </h3>
                      <p className={`text-sm font-medium ${config.textColor} mb-3`}>
                        {config.tagline}
                      </p>
                      
                      <div className="space-y-1.5 mb-4">
                        {config.domains.map((domain, idx) => (
                          <div key={idx} className="flex items-center justify-between text-sm">
                            <span className="text-slate-600 dark:text-slate-400">{domain.name}</span>
                            <span className="font-medium text-slate-900 dark:text-white">{domain.count}</span>
                          </div>
                        ))}
                      </div>
                      
                      <div className={`flex items-center gap-1 text-sm font-medium ${config.textColor} group-hover:gap-2 transition-all`}>
                        Browse playbooks
                        <ChevronRight className="h-4 w-4" />
                      </div>
                    </CardContent>
                  </Card>
                );
              })}
            </div>
            
            {myPlaybooks && myPlaybooks.length > 0 && (
              <div className="mt-12 mb-8">
                <div className="flex items-center gap-3 mb-5">
                  <Star className="h-5 w-5 text-amber-500" />
                  <h2 className="text-lg font-semibold text-slate-900 dark:text-white">
                    My Playbooks
                  </h2>
                  <Badge variant="secondary">{myPlaybooks.length}</Badge>
                </div>
                <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
                  {myPlaybooks.slice(0, 3).map((playbook) => (
                    <PlaybookCard key={playbook.id} playbook={playbook} isCustom={true} />
                  ))}
                </div>
              </div>
            )}
          </div>
        </>
      ) : (
        <>
          {(() => {
            const config = categoryConfig[selectedCategory];
            const Icon = config.icon;
            const playbooks = getCategoryPlaybooks(selectedCategory);
            
            return (
              <>
                <div className={`bg-gradient-to-r ${config.bgGradient} border-b border-slate-800`}>
                  <div className="max-w-6xl mx-auto px-6 pt-24 pb-12">
                    <Button 
                      variant="ghost" 
                      size="sm" 
                      onClick={() => { setSelectedCategory(null); setSearch(""); setDomainFilter("all"); }}
                      className="text-white/80 hover:text-white hover:bg-white/10 mb-4 -ml-2"
                      data-testid="button-back-categories"
                    >
                      <ArrowLeft className="mr-2 h-4 w-4" />
                      All Categories
                    </Button>
                    
                    <div className="flex items-start justify-between">
                      <div className="flex items-center gap-4">
                        <div className="w-14 h-14 rounded-2xl bg-white/20 backdrop-blur flex items-center justify-center">
                          <Icon className="h-7 w-7 text-white" />
                        </div>
                        <div>
                          <h1 className="text-2xl font-semibold text-white tracking-tight">
                            {config.label}
                          </h1>
                          <p className="text-white/80">
                            {config.tagline}  {playbooks.length} playbooks
                          </p>
                        </div>
                      </div>
                      <Button 
                        onClick={() => setLocation('/playbooks/create')} 
                        className="bg-white text-slate-900 hover:bg-slate-100"
                        data-testid="button-create-playbook-detail"
                      >
                        <Plus className="mr-2 h-4 w-4" />
                        Create Custom
                      </Button>
                    </div>
                  </div>
                </div>
                
                <div className="max-w-6xl mx-auto px-6 py-8">
                  <div className="flex items-center gap-4 mb-6 p-4 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                    <div className="flex-1 relative max-w-sm">
                      <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" />
                      <Input 
                        placeholder="Search playbooks..." 
                        className="pl-10 border-slate-200 dark:border-slate-700"
                        value={search}
                        onChange={(e) => setSearch(e.target.value)}
                        data-testid="input-search"
                      />
                    </div>
                    <Select value={domainFilter} onValueChange={setDomainFilter}>
                      <SelectTrigger className="w-48 border-slate-200 dark:border-slate-700" data-testid="select-domain-filter">
                        <SelectValue placeholder="All Domains" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="all">All Domains</SelectItem>
                        {domains.map(domain => (
                          <SelectItem key={domain} value={domain!}>{domain}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    {(search || domainFilter !== "all") && (
                      <Button variant="ghost" size="sm" onClick={() => { setSearch(""); setDomainFilter("all"); }}>
                        Clear filters
                      </Button>
                    )}
                  </div>
                  
                  {loadingTemplates ? (
                    <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
                      {[1,2,3,4,5,6].map(i => (
                        <div key={i} className="h-52 rounded-xl bg-slate-100 dark:bg-slate-800 animate-pulse" />
                      ))}
                    </div>
                  ) : playbooks.length === 0 ? (
                    <div className="text-center py-20">
                      <div className="w-16 h-16 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center mx-auto mb-4">
                        <Search className="h-8 w-8 text-slate-400" />
                      </div>
                      <p className="text-slate-500 dark:text-slate-400">No playbooks found matching your criteria.</p>
                      <Button variant="link" onClick={() => { setSearch(""); setDomainFilter("all"); }}>
                        Clear filters
                      </Button>
                    </div>
                  ) : (
                    <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
                      {playbooks.map((playbook) => (
                        <PlaybookCard key={playbook.id} playbook={playbook} isCustom={false} />
                      ))}
                    </div>
                  )}
                </div>
              </>
            );
          })()}
        </>
      )}
      
      <Footer />
    </div>
  );
}

function PlaybookCard({ 
  playbook, 
  isCustom
}: { 
  playbook: Playbook; 
  isCustom: boolean;
}) {
  const [, setLocation] = useLocation();
  const category = (playbook.category || 'offense') as Category;
  const config = categoryConfig[category] || categoryConfig.offense;
  
  return (
    <Card 
      className="group bg-white dark:bg-slate-900 hover:shadow-lg transition-all duration-200 border-slate-200 dark:border-slate-800 hover:border-slate-300 dark:hover:border-slate-700"
      data-testid={`card-playbook-${playbook.id}`}
    >
      <CardContent className="p-5">
        <div className="flex items-start justify-between gap-3 mb-3">
          <Badge variant="outline" className={`text-xs font-medium ${config.textColor} border-current`}>
            {config.label}
          </Badge>
          <div className="flex items-center gap-1.5">
            {isCustom && playbook.status && (
              <Badge 
                className={`text-xs ${
                  playbook.status === 'draft' 
                    ? 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400' 
                    : playbook.status === 'ready'
                    ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'
                    : playbook.status === 'active'
                    ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400'
                    : 'bg-slate-100 text-slate-700 dark:bg-slate-900/30 dark:text-slate-400'
                }`}
              >
                {playbook.status === 'draft' ? 'Draft' : 
                 playbook.status === 'ready' ? 'Ready' : 
                 playbook.status === 'active' ? 'Active' : 
                 playbook.status}
              </Badge>
            )}
            {isCustom && (
              <Badge className="bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 text-xs">
                Custom
              </Badge>
            )}
          </div>
        </div>
        
        <h3 className="font-semibold text-slate-900 dark:text-white mb-2 line-clamp-2 leading-snug">
          {playbook.name}
        </h3>
        <p className="text-sm text-slate-500 dark:text-slate-400 line-clamp-2 mb-4">
          {playbook.description}
        </p>
        
        <div className="flex items-center gap-4 text-xs text-slate-500 mb-4">
          {!isCustom && (
            <>
              <span className="flex items-center gap-1">
                <Users className="h-3.5 w-3.5" />
                {playbook.timesUsed || 0}
              </span>
              <span className="flex items-center gap-1">
                <Clock className="h-3.5 w-3.5" />
                ~{playbook.avgResponseTimeSeconds ? Math.round(playbook.avgResponseTimeSeconds / 60) : 12}m
              </span>
            </>
          )}
          <span className="truncate flex-1 text-right">{playbook.domain}</span>
        </div>
        
        <div className="flex items-center gap-2">
          <Button 
            variant="outline" 
            size="sm" 
            className="flex-1 h-9"
            onClick={() => setLocation(`/playbooks/${playbook.id}/preview`)}
            data-testid={`button-preview-${playbook.id}`}
          >
            <Eye className="mr-1.5 h-3.5 w-3.5" />
            Preview
          </Button>
          
          {isCustom ? (
            <Button 
              size="sm" 
              className="flex-1 h-9"
              onClick={() => setLocation(`/playbooks/${playbook.id}/edit`)}
              data-testid={`button-edit-${playbook.id}`}
            >
              <Edit className="mr-1.5 h-3.5 w-3.5" />
              Edit
            </Button>
          ) : (
            <>
              <Button 
                size="sm"
                className="flex-1 h-9"
                onClick={() => setLocation(`/playbooks/${playbook.id}/customize`)}
                data-testid={`button-customize-${playbook.id}`}
              >
                <Edit className="mr-1.5 h-3.5 w-3.5" />
                Customize
              </Button>
              <DropdownMenu>
                <DropdownMenuTrigger asChild>
                  <Button variant="outline" size="sm" className="h-9 w-9 p-0">
                    <MoreHorizontal className="h-4 w-4" />
                  </Button>
                </DropdownMenuTrigger>
                <DropdownMenuContent align="end">
                  <DropdownMenuItem onClick={() => setLocation(`/playbooks/${playbook.id}/customize`)}>
                    <Copy className="mr-2 h-4 w-4" />
                    Clone as new
                  </DropdownMenuItem>
                </DropdownMenuContent>
              </DropdownMenu>
            </>
          )}
        </div>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/pages/PlaybookManagement.tsx
========================================
import { useState } from "react";
import { useQuery, useMutation } from "@tanstack/react-query";
import { useLocation } from "wouter";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { useCustomer } from "@/contexts/CustomerContext";
import { queryClient, apiRequest } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";

import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";

import {
  Plus,
  Search,
  MoreVertical,
  Edit,
  Trash2,
  Eye,
  Copy,
  Target,
  Shield,
  Zap,
  Clock,
  Users,
  DollarSign,
  AlertTriangle,
  CheckCircle,
  FileText,
  Play,
} from "lucide-react";

import type { Playbook } from "@shared/schema";

const CATEGORY_CONFIG = {
  offense: { label: "Offense", icon: Target, color: "text-emerald-600", bg: "bg-emerald-100 dark:bg-emerald-900/30" },
  defense: { label: "Defense", icon: Shield, color: "text-blue-600", bg: "bg-blue-100 dark:bg-blue-900/30" },
  special_teams: { label: "Special Teams", icon: Zap, color: "text-purple-600", bg: "bg-purple-100 dark:bg-purple-900/30" },
};

const STATUS_CONFIG = {
  draft: { label: "Draft", color: "bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300" },
  ready: { label: "Ready", color: "bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400" },
  active: { label: "Active", color: "bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400" },
  archived: { label: "Archived", color: "bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400" },
};

const PRIORITY_CONFIG = {
  critical: { label: "Critical", color: "bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400" },
  high: { label: "High", color: "bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400" },
  medium: { label: "Medium", color: "bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400" },
  low: { label: "Low", color: "bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400" },
};

export default function PlaybookManagement() {
  const [, setLocation] = useLocation();
  const { organization } = useCustomer();
  const { toast } = useToast();
  const [search, setSearch] = useState("");
  const [deleteId, setDeleteId] = useState<string | null>(null);
  const [statusFilter, setStatusFilter] = useState<string>("all");
  const [categoryFilter, setCategoryFilter] = useState<string>("all");

  const { data: playbooksData, isLoading } = useQuery<Playbook[]>({
    queryKey: ["/api/playbooks", organization?.id],
    queryFn: async () => {
      const res = await fetch(`/api/playbooks?organizationId=${organization?.id || ''}`);
      if (!res.ok) return [];
      const data = await res.json();
      return Array.isArray(data) ? data : [];
    },
    enabled: true,
  });
  
  const playbooks = Array.isArray(playbooksData) ? playbooksData : [];

  const deleteMutation = useMutation({
    mutationFn: async (id: string) => {
      return apiRequest("DELETE", `/api/playbooks/${id}`);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/playbooks"] });
      toast({
        title: "Playbook Deleted",
        description: "The playbook has been permanently deleted.",
      });
      setDeleteId(null);
    },
    onError: () => {
      toast({
        title: "Error",
        description: "Failed to delete playbook. Please try again.",
        variant: "destructive",
      });
    },
  });

  const filteredPlaybooks = playbooks.filter((pb) => {
    const matchesSearch = !search || 
      pb.name.toLowerCase().includes(search.toLowerCase()) ||
      (pb.domain && pb.domain.toLowerCase().includes(search.toLowerCase()));
    const matchesStatus = statusFilter === "all" || pb.status === statusFilter;
    const matchesCategory = categoryFilter === "all" || pb.category === categoryFilter;
    return matchesSearch && matchesStatus && matchesCategory;
  });

  const stats = {
    total: playbooks.length,
    active: playbooks.filter(p => p.status === 'active').length,
    ready: playbooks.filter(p => p.status === 'ready').length,
    draft: playbooks.filter(p => p.status === 'draft').length,
  };

  const getCategoryIcon = (category: string | null) => {
    const config = CATEGORY_CONFIG[category as keyof typeof CATEGORY_CONFIG];
    if (!config) return Target;
    return config.icon;
  };

  return (
    <>
      <StandardNav />
      
      <main className="max-w-7xl mx-auto px-6 py-12">
        <header className="mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <h1 className="text-3xl font-bold text-slate-900 dark:text-white" data-testid="text-page-title">
              Playbook Management
            </h1>
            <p className="text-slate-600 dark:text-slate-400 mt-1">
              Create, customize, and manage your organization's strategic playbooks
            </p>
          </div>
          <Button 
            onClick={() => setLocation('/playbook-customize/new')}
            className="bg-purple-600 hover:bg-purple-700"
            data-testid="button-create-playbook"
          >
            <Plus className="h-4 w-4 mr-2" />
            Create Playbook
          </Button>
        </header>

        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <Card data-testid="stat-total">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                  <FileText className="h-5 w-5 text-slate-600 dark:text-slate-400" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-slate-900 dark:text-white">{stats.total}</p>
                  <p className="text-sm text-slate-500">Total Playbooks</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-active">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg">
                  <CheckCircle className="h-5 w-5 text-green-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-green-600">{stats.active}</p>
                  <p className="text-sm text-slate-500">Active</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-ready">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                  <Play className="h-5 w-5 text-blue-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-blue-600">{stats.ready}</p>
                  <p className="text-sm text-slate-500">Ready</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-draft">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                  <Edit className="h-5 w-5 text-slate-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-slate-600">{stats.draft}</p>
                  <p className="text-sm text-slate-500">Drafts</p>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>

        <Card className="mb-6">
          <CardContent className="p-4">
            <div className="flex flex-col md:flex-row gap-4">
              <div className="relative flex-1">
                <Search className="absolute left-3 top-2.5 h-4 w-4 text-slate-400" />
                <Input
                  placeholder="Search playbooks..."
                  value={search}
                  onChange={(e) => setSearch(e.target.value)}
                  className="pl-10"
                  data-testid="input-search"
                />
              </div>
              <div className="flex gap-2">
                <select
                  value={statusFilter}
                  onChange={(e) => setStatusFilter(e.target.value)}
                  className="px-3 py-2 border rounded-md bg-white dark:bg-slate-900 text-sm"
                  data-testid="select-status-filter"
                >
                  <option value="all">All Status</option>
                  <option value="draft">Draft</option>
                  <option value="ready">Ready</option>
                  <option value="active">Active</option>
                  <option value="archived">Archived</option>
                </select>
                <select
                  value={categoryFilter}
                  onChange={(e) => setCategoryFilter(e.target.value)}
                  className="px-3 py-2 border rounded-md bg-white dark:bg-slate-900 text-sm"
                  data-testid="select-category-filter"
                >
                  <option value="all">All Categories</option>
                  <option value="offense">Offense</option>
                  <option value="defense">Defense</option>
                  <option value="special_teams">Special Teams</option>
                </select>
              </div>
            </div>
          </CardContent>
        </Card>

        {isLoading ? (
          <Card>
            <CardContent className="py-12 text-center">
              <div className="animate-pulse space-y-3">
                <div className="h-4 bg-slate-200 dark:bg-slate-700 rounded w-1/3 mx-auto"></div>
                <div className="h-4 bg-slate-200 dark:bg-slate-700 rounded w-1/2 mx-auto"></div>
              </div>
            </CardContent>
          </Card>
        ) : filteredPlaybooks.length === 0 ? (
          <Card>
            <CardContent className="py-16 text-center">
              <FileText className="h-12 w-12 mx-auto mb-4 text-slate-300 dark:text-slate-600" />
              <h3 className="text-lg font-medium text-slate-900 dark:text-white mb-2">
                {playbooks.length === 0 ? "No Playbooks Yet" : "No Matching Playbooks"}
              </h3>
              <p className="text-slate-500 mb-6 max-w-md mx-auto">
                {playbooks.length === 0 
                  ? "Create your first playbook to start building your strategic response library."
                  : "Try adjusting your search or filter criteria."}
              </p>
              {playbooks.length === 0 && (
                <Button onClick={() => setLocation('/playbook-customize/new')} data-testid="button-create-first">
                  <Plus className="h-4 w-4 mr-2" />
                  Create Your First Playbook
                </Button>
              )}
            </CardContent>
          </Card>
        ) : (
          <Card>
            <Table>
              <TableHeader>
                <TableRow>
                  <TableHead>Playbook</TableHead>
                  <TableHead>Category</TableHead>
                  <TableHead>Status</TableHead>
                  <TableHead>Priority</TableHead>
                  <TableHead className="text-right">Budget</TableHead>
                  <TableHead className="text-right">Uses</TableHead>
                  <TableHead className="w-[50px]"></TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {filteredPlaybooks.map((playbook) => {
                  const CategoryIcon = getCategoryIcon(playbook.category);
                  const categoryConfig = CATEGORY_CONFIG[playbook.category as keyof typeof CATEGORY_CONFIG];
                  const statusConfig = STATUS_CONFIG[playbook.status as keyof typeof STATUS_CONFIG] || STATUS_CONFIG.draft;
                  const priorityConfig = PRIORITY_CONFIG[playbook.priority as keyof typeof PRIORITY_CONFIG] || PRIORITY_CONFIG.medium;

                  return (
                    <TableRow 
                      key={playbook.id} 
                      className="cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50"
                      data-testid={`row-playbook-${playbook.id}`}
                    >
                      <TableCell>
                        <div className="flex items-center gap-3">
                          <div className={`p-2 rounded-lg ${categoryConfig?.bg || 'bg-slate-100 dark:bg-slate-800'}`}>
                            <CategoryIcon className={`h-4 w-4 ${categoryConfig?.color || 'text-slate-600'}`} />
                          </div>
                          <div>
                            <p className="font-medium text-slate-900 dark:text-white">{playbook.name}</p>
                            <p className="text-sm text-slate-500 truncate max-w-xs">{playbook.domain}</p>
                          </div>
                        </div>
                      </TableCell>
                      <TableCell>
                        <Badge variant="outline" className={categoryConfig?.color}>
                          {categoryConfig?.label || 'Uncategorized'}
                        </Badge>
                      </TableCell>
                      <TableCell>
                        <Badge className={statusConfig.color}>
                          {statusConfig.label}
                        </Badge>
                      </TableCell>
                      <TableCell>
                        <Badge className={priorityConfig.color}>
                          {priorityConfig.label}
                        </Badge>
                      </TableCell>
                      <TableCell className="text-right">
                        {playbook.totalBudget ? (
                          <span className="text-slate-600 dark:text-slate-400" data-testid={`text-budget-${playbook.id}`}>
                            ${Number(playbook.totalBudget).toLocaleString()}
                          </span>
                        ) : (
                          <span className="text-slate-400" data-testid={`text-budget-${playbook.id}`}>-</span>
                        )}
                      </TableCell>
                      <TableCell className="text-right">
                        <span className="text-slate-600 dark:text-slate-400" data-testid={`text-uses-${playbook.id}`}>
                          {playbook.timesUsed || 0}
                        </span>
                      </TableCell>
                      <TableCell>
                        <DropdownMenu>
                          <DropdownMenuTrigger asChild>
                            <Button variant="ghost" size="sm" data-testid={`button-actions-${playbook.id}`}>
                              <MoreVertical className="h-4 w-4" />
                            </Button>
                          </DropdownMenuTrigger>
                          <DropdownMenuContent align="end">
                            <DropdownMenuItem 
                              onClick={() => setLocation(`/playbook-command/${playbook.id}`)}
                              data-testid={`menu-view-${playbook.id}`}
                            >
                              <Eye className="h-4 w-4 mr-2" />
                              View
                            </DropdownMenuItem>
                            <DropdownMenuItem 
                              onClick={() => setLocation(`/playbook-customize/${playbook.id}`)}
                              data-testid={`menu-edit-${playbook.id}`}
                            >
                              <Edit className="h-4 w-4 mr-2" />
                              Edit
                            </DropdownMenuItem>
                            <DropdownMenuItem 
                              onClick={() => setLocation(`/playbook-customize/new?template=${playbook.id}`)}
                              data-testid={`menu-duplicate-${playbook.id}`}
                            >
                              <Copy className="h-4 w-4 mr-2" />
                              Duplicate
                            </DropdownMenuItem>
                            <DropdownMenuItem 
                              onClick={() => setDeleteId(playbook.id)}
                              className="text-red-600 focus:text-red-600"
                              data-testid={`menu-delete-${playbook.id}`}
                            >
                              <Trash2 className="h-4 w-4 mr-2" />
                              Delete
                            </DropdownMenuItem>
                          </DropdownMenuContent>
                        </DropdownMenu>
                      </TableCell>
                    </TableRow>
                  );
                })}
              </TableBody>
            </Table>
          </Card>
        )}

        <AlertDialog open={!!deleteId} onOpenChange={() => setDeleteId(null)}>
          <AlertDialogContent>
            <AlertDialogHeader>
              <AlertDialogTitle>Delete Playbook</AlertDialogTitle>
              <AlertDialogDescription>
                Are you sure you want to delete this playbook? This action cannot be undone and will permanently remove the playbook and all its configuration.
              </AlertDialogDescription>
            </AlertDialogHeader>
            <AlertDialogFooter>
              <AlertDialogCancel data-testid="button-cancel-delete">Cancel</AlertDialogCancel>
              <AlertDialogAction
                onClick={() => deleteId && deleteMutation.mutate(deleteId)}
                className="bg-red-600 hover:bg-red-700"
                data-testid="button-confirm-delete"
              >
                {deleteMutation.isPending ? "Deleting..." : "Delete"}
              </AlertDialogAction>
            </AlertDialogFooter>
          </AlertDialogContent>
        </AlertDialog>
      </main>

      <Footer />
    </>
  );
}


========================================
FILE: client/src/pages/PlaybookReadinessAudit.tsx
========================================
import { useState, useMemo } from 'react';
import StandardNav from '@/components/layout/StandardNav';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Input } from '@/components/ui/input';
import { 
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { 
  Shield, 
  AlertTriangle, 
  CheckCircle2, 
  XCircle,
  Search,
  Filter,
  Download,
  RefreshCw,
  Target,
  Users,
  Clock,
  TrendingUp,
  ChevronRight,
  Calendar,
  Play
} from 'lucide-react';
import { Link } from 'wouter';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';

interface PlaybookReadiness {
  id: string;
  playbookNumber: number;
  name: string;
  domain: string;
  category: string;
  overallScore: number;
  triggerCoverage: number;
  stakeholderReadiness: number;
  practiceFrequency: number;
  outcomeConfidence: number;
  lastDrillDate: string | null;
  drillsCompleted: number;
  stakeholderCount: number;
  tier: 'combat-ready' | 'practice-needed' | 'setup-required' | 'not-configured';
  recommendations: string[];
}

const domains = [
  'Market Response',
  'Operational Resilience', 
  'People & Culture',
  'Technology & Innovation',
  'Regulatory Compliance',
  'Crisis Management',
  'Growth & Expansion',
  'Strategic Partnerships'
];

const generateMockPlaybooks = (): PlaybookReadiness[] => {
  const playbooks: PlaybookReadiness[] = [];
  const playbookNames = [
    'Competitor Price War Response', 'Market Share Defense', 'New Market Entry',
    'Supply Chain Disruption', 'Vendor Failure Recovery', 'Capacity Surge Protocol',
    'Executive Transition', 'Talent Retention Crisis', 'Union Negotiation',
    'Ransomware Response', 'Data Breach Protocol', 'System Outage Recovery',
    'FDA Audit Preparation', 'GDPR Compliance Alert', 'SEC Investigation Response',
    'Product Recall Coordination', 'Reputation Crisis Management', 'Natural Disaster Response',
    'Acquisition Integration', 'Strategic Partnership Launch', 'Market Expansion Protocol',
    'Joint Venture Formation', 'Licensing Agreement Negotiation', 'Technology Transfer'
  ];

  for (let i = 1; i <= 166; i++) {
    const nameIndex = (i - 1) % playbookNames.length;
    const domainIndex = Math.floor((i - 1) / 20) % domains.length;
    
    const triggerCoverage = Math.floor(Math.random() * 40) + 60;
    const stakeholderReadiness = Math.floor(Math.random() * 50) + 50;
    const practiceFrequency = Math.floor(Math.random() * 60) + 40;
    const outcomeConfidence = Math.floor(Math.random() * 45) + 55;
    const overallScore = Math.round((triggerCoverage + stakeholderReadiness + practiceFrequency + outcomeConfidence) / 4);
    
    let tier: PlaybookReadiness['tier'];
    if (overallScore >= 80) tier = 'combat-ready';
    else if (overallScore >= 60) tier = 'practice-needed';
    else if (overallScore >= 40) tier = 'setup-required';
    else tier = 'not-configured';

    const recommendations: string[] = [];
    if (triggerCoverage < 70) recommendations.push('Configure additional trigger conditions');
    if (stakeholderReadiness < 70) recommendations.push('Update stakeholder contact information');
    if (practiceFrequency < 50) recommendations.push('Schedule practice drill');
    if (outcomeConfidence < 60) recommendations.push('Review decision tree accuracy');

    const daysAgo = Math.floor(Math.random() * 180);
    const lastDrill = daysAgo < 90 ? new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000).toISOString() : null;

    playbooks.push({
      id: `playbook-${i}`,
      playbookNumber: i,
      name: `${playbookNames[nameIndex]} ${Math.floor(i / 24) + 1}`,
      domain: domains[domainIndex],
      category: `${domains[domainIndex]} - Subcategory ${(i % 6) + 1}`,
      overallScore,
      triggerCoverage,
      stakeholderReadiness,
      practiceFrequency,
      outcomeConfidence,
      lastDrillDate: lastDrill,
      drillsCompleted: Math.floor(Math.random() * 12),
      stakeholderCount: Math.floor(Math.random() * 30) + 10,
      tier,
      recommendations
    });
  }
  
  return playbooks;
};

const tierConfig = {
  'combat-ready': {
    label: 'Combat Ready',
    color: 'bg-emerald-500',
    textColor: 'text-emerald-600 dark:text-emerald-400',
    bgColor: 'bg-emerald-50 dark:bg-emerald-950/30',
    borderColor: 'border-emerald-200 dark:border-emerald-800',
    icon: CheckCircle2
  },
  'practice-needed': {
    label: 'Practice Needed',
    color: 'bg-amber-500',
    textColor: 'text-amber-600 dark:text-amber-400',
    bgColor: 'bg-amber-50 dark:bg-amber-950/30',
    borderColor: 'border-amber-200 dark:border-amber-800',
    icon: Clock
  },
  'setup-required': {
    label: 'Setup Required',
    color: 'bg-orange-500',
    textColor: 'text-orange-600 dark:text-orange-400',
    bgColor: 'bg-orange-50 dark:bg-orange-950/30',
    borderColor: 'border-orange-200 dark:border-orange-800',
    icon: AlertTriangle
  },
  'not-configured': {
    label: 'Not Configured',
    color: 'bg-red-500',
    textColor: 'text-red-600 dark:text-red-400',
    bgColor: 'bg-red-50 dark:bg-red-950/30',
    borderColor: 'border-red-200 dark:border-red-800',
    icon: XCircle
  }
};

export default function PlaybookReadinessAudit() {
  const [playbooks] = useState<PlaybookReadiness[]>(generateMockPlaybooks);
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedDomain, setSelectedDomain] = useState<string>('all');
  const [selectedTier, setSelectedTier] = useState<string>('all');

  const filteredPlaybooks = useMemo(() => {
    return playbooks.filter(pb => {
      const matchesSearch = pb.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                           pb.domain.toLowerCase().includes(searchQuery.toLowerCase());
      const matchesDomain = selectedDomain === 'all' || pb.domain === selectedDomain;
      const matchesTier = selectedTier === 'all' || pb.tier === selectedTier;
      return matchesSearch && matchesDomain && matchesTier;
    });
  }, [playbooks, searchQuery, selectedDomain, selectedTier]);

  const stats = useMemo(() => {
    const tierCounts = {
      'combat-ready': 0,
      'practice-needed': 0,
      'setup-required': 0,
      'not-configured': 0
    };
    let totalScore = 0;
    
    playbooks.forEach(pb => {
      tierCounts[pb.tier]++;
      totalScore += pb.overallScore;
    });

    return {
      tierCounts,
      averageScore: Math.round(totalScore / playbooks.length),
      total: playbooks.length
    };
  }, [playbooks]);

  return (
    <div className="page-background min-h-screen">
      <StandardNav />
      
      <div className="bg-gradient-to-r from-blue-600 via-violet-600 to-purple-600 text-white py-12">
        <div className="max-w-7xl mx-auto px-8">
          <div className="flex items-center justify-between">
            <div>
              <div className="flex items-center gap-3 mb-3">
                <Shield className="h-8 w-8" />
                <h1 className="text-3xl font-bold" data-testid="page-title">
                  Playbook Readiness Audit
                </h1>
              </div>
              <p className="text-blue-100 text-lg max-w-2xl">
                Assess preparedness across your 166 strategic playbooks. Identify gaps, 
                schedule drills, and ensure your organization is ready to execute.
              </p>
            </div>
            <div className="hidden lg:flex items-center gap-4">
              <OnboardingTrigger pageId="playbook-readiness" autoStart={true} className="bg-white/10 border-white/30 text-white hover:bg-white/20" />
              <Button variant="outline" className="bg-white/10 border-white/30 text-white hover:bg-white/20" data-testid="button-export">
                <Download className="h-4 w-4 mr-2" />
                Export Report
              </Button>
            </div>
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-8 py-8 space-y-8">
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4" data-testid="readiness-summary">
          {Object.entries(tierConfig).map(([tier, config]) => {
            const TierIcon = config.icon;
            const count = stats.tierCounts[tier as keyof typeof stats.tierCounts];
            const percentage = Math.round((count / stats.total) * 100);
            
            return (
              <Card 
                key={tier} 
                className={`${config.bgColor} ${config.borderColor} border-2 cursor-pointer hover:scale-105 transition-transform`}
                onClick={() => setSelectedTier(tier)}
                data-testid={`tier-card-${tier}`}
              >
                <CardContent className="pt-6">
                  <div className="flex items-center justify-between mb-2">
                    <TierIcon className={`h-6 w-6 ${config.textColor}`} />
                    <Badge className={`${config.color} text-white`}>
                      {percentage}%
                    </Badge>
                  </div>
                  <div className={`text-3xl font-bold ${config.textColor}`}>
                    {count}
                  </div>
                  <div className="text-sm text-slate-600 dark:text-slate-400">
                    {config.label}
                  </div>
                </CardContent>
              </Card>
            );
          })}
        </div>

        <Card className="border-2 border-blue-500 dark:border-blue-700" data-testid="card-overall-readiness">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <TrendingUp className="h-5 w-5 text-blue-600" />
              Overall Readiness Score
            </CardTitle>
            <CardDescription>
              Average preparedness across all 166 playbooks
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center gap-8">
              <div className="text-center">
                <div className="text-6xl font-bold text-blue-600 dark:text-blue-400">
                  {stats.averageScore}%
                </div>
                <div className="text-sm text-slate-600 dark:text-slate-400 mt-1">
                  Target: 84.4%
                </div>
              </div>
              <div className="flex-1 space-y-4">
                <div>
                  <div className="flex items-center justify-between text-sm mb-1">
                    <span className="flex items-center gap-2">
                      <Target className="h-4 w-4" />
                      Trigger Coverage
                    </span>
                    <span className="font-semibold">72%</span>
                  </div>
                  <Progress value={72} className="h-2" />
                </div>
                <div>
                  <div className="flex items-center justify-between text-sm mb-1">
                    <span className="flex items-center gap-2">
                      <Users className="h-4 w-4" />
                      Stakeholder Readiness
                    </span>
                    <span className="font-semibold">68%</span>
                  </div>
                  <Progress value={68} className="h-2" />
                </div>
                <div>
                  <div className="flex items-center justify-between text-sm mb-1">
                    <span className="flex items-center gap-2">
                      <Calendar className="h-4 w-4" />
                      Practice Frequency
                    </span>
                    <span className="font-semibold">55%</span>
                  </div>
                  <Progress value={55} className="h-2" />
                </div>
                <div>
                  <div className="flex items-center justify-between text-sm mb-1">
                    <span className="flex items-center gap-2">
                      <CheckCircle2 className="h-4 w-4" />
                      Outcome Confidence
                    </span>
                    <span className="font-semibold">64%</span>
                  </div>
                  <Progress value={64} className="h-2" />
                </div>
              </div>
            </div>
          </CardContent>
        </Card>

        <div className="flex flex-col md:flex-row gap-4 items-center justify-between">
          <div className="flex items-center gap-3 w-full md:w-auto">
            <div className="relative flex-1 md:w-80">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400" />
              <Input
                placeholder="Search playbooks..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="pl-10"
                data-testid="input-search"
              />
            </div>
            <Select value={selectedDomain} onValueChange={setSelectedDomain}>
              <SelectTrigger className="w-48" data-testid="select-domain">
                <Filter className="h-4 w-4 mr-2" />
                <SelectValue placeholder="Domain" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">All Domains</SelectItem>
                {domains.map(domain => (
                  <SelectItem key={domain} value={domain}>{domain}</SelectItem>
                ))}
              </SelectContent>
            </Select>
            <Select value={selectedTier} onValueChange={setSelectedTier}>
              <SelectTrigger className="w-48" data-testid="select-tier">
                <SelectValue placeholder="Tier" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">All Tiers</SelectItem>
                {Object.entries(tierConfig).map(([tier, config]) => (
                  <SelectItem key={tier} value={tier}>{config.label}</SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
          <div className="text-sm text-slate-600 dark:text-slate-400">
            Showing {filteredPlaybooks.length} of {playbooks.length} playbooks
          </div>
        </div>

        <div className="grid gap-4" data-testid="playbook-list">
          {filteredPlaybooks.slice(0, 20).map((playbook) => {
            const config = tierConfig[playbook.tier];
            const TierIcon = config.icon;
            
            return (
              <Card 
                key={playbook.id} 
                className={`${config.borderColor} border-l-4 hover:shadow-lg transition-shadow`}
                data-testid={`playbook-card-${playbook.playbookNumber}`}
              >
                <CardContent className="py-4">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-4 flex-1">
                      <div className={`w-12 h-12 ${config.bgColor} rounded-lg flex items-center justify-center`}>
                        <TierIcon className={`h-6 w-6 ${config.textColor}`} />
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center gap-2 mb-1">
                          <h3 className="font-semibold text-slate-900 dark:text-white">
                            #{playbook.playbookNumber} - {playbook.name}
                          </h3>
                          <Badge variant="outline" className={config.textColor}>
                            {config.label}
                          </Badge>
                        </div>
                        <div className="flex items-center gap-4 text-sm text-slate-600 dark:text-slate-400">
                          <span>{playbook.domain}</span>
                          <span></span>
                          <span>{playbook.stakeholderCount} stakeholders</span>
                          <span></span>
                          <span>{playbook.drillsCompleted} drills completed</span>
                          {playbook.lastDrillDate && (
                            <>
                              <span></span>
                              <span>Last drill: {new Date(playbook.lastDrillDate).toLocaleDateString()}</span>
                            </>
                          )}
                        </div>
                      </div>
                    </div>

                    <div className="flex items-center gap-6">
                      <div className="hidden lg:flex items-center gap-4">
                        <div className="text-center">
                          <div className="text-lg font-bold text-blue-600 dark:text-blue-400">
                            {playbook.triggerCoverage}%
                          </div>
                          <div className="text-xs text-slate-500">Triggers</div>
                        </div>
                        <div className="text-center">
                          <div className="text-lg font-bold text-violet-600 dark:text-violet-400">
                            {playbook.stakeholderReadiness}%
                          </div>
                          <div className="text-xs text-slate-500">Stakeholders</div>
                        </div>
                        <div className="text-center">
                          <div className="text-lg font-bold text-amber-600 dark:text-amber-400">
                            {playbook.practiceFrequency}%
                          </div>
                          <div className="text-xs text-slate-500">Practice</div>
                        </div>
                        <div className="text-center">
                          <div className="text-lg font-bold text-emerald-600 dark:text-emerald-400">
                            {playbook.outcomeConfidence}%
                          </div>
                          <div className="text-xs text-slate-500">Confidence</div>
                        </div>
                      </div>

                      <div className="text-center px-4 border-l border-slate-200 dark:border-slate-700">
                        <div className={`text-2xl font-bold ${config.textColor}`}>
                          {playbook.overallScore}%
                        </div>
                        <div className="text-xs text-slate-500">Overall</div>
                      </div>

                      <div className="flex items-center gap-2">
                        <Button 
                          variant="outline" 
                          size="sm"
                          data-testid={`button-drill-${playbook.playbookNumber}`}
                        >
                          <Play className="h-4 w-4 mr-1" />
                          Drill
                        </Button>
                        <Button 
                          variant="ghost" 
                          size="sm"
                          data-testid={`button-view-${playbook.playbookNumber}`}
                        >
                          <ChevronRight className="h-4 w-4" />
                        </Button>
                      </div>
                    </div>
                  </div>

                  {playbook.recommendations.length > 0 && (
                    <div className="mt-3 pt-3 border-t border-slate-200 dark:border-slate-700">
                      <div className="flex items-center gap-2 flex-wrap">
                        <span className="text-xs font-semibold text-slate-500">Recommendations:</span>
                        {playbook.recommendations.map((rec, idx) => (
                          <Badge key={idx} variant="secondary" className="text-xs">
                            {rec}
                          </Badge>
                        ))}
                      </div>
                    </div>
                  )}
                </CardContent>
              </Card>
            );
          })}
        </div>

        {filteredPlaybooks.length > 20 && (
          <div className="text-center">
            <Button variant="outline" data-testid="button-load-more">
              <RefreshCw className="h-4 w-4 mr-2" />
              Load More ({filteredPlaybooks.length - 20} remaining)
            </Button>
          </div>
        )}

        <Card className="bg-gradient-to-r from-blue-50 via-violet-50 to-purple-50 dark:from-blue-950/30 dark:via-violet-950/30 dark:to-purple-950/30 border-blue-200 dark:border-blue-800">
          <CardContent className="py-6">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-lg font-semibold text-slate-900 dark:text-white mb-1">
                  Ready to improve readiness?
                </h3>
                <p className="text-sm text-slate-600 dark:text-slate-400">
                  Schedule a bulk drill session or import stakeholder data to boost your scores.
                </p>
              </div>
              <div className="flex items-center gap-3">
                <Link href="/scenario-gallery">
                  <Button variant="outline" data-testid="button-browse-playbooks">
                    Browse Playbooks
                  </Button>
                </Link>
                <Button data-testid="button-schedule-drill">
                  <Calendar className="h-4 w-4 mr-2" />
                  Schedule Drill
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/PlaybookSettings.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { useParams, Link } from 'wouter';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Switch } from '@/components/ui/switch';
import { Separator } from '@/components/ui/separator';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { ArrowLeft, Save, Bell, Users, DollarSign, Shield, Zap, Clock } from 'lucide-react';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';
import PageLayout from '@/components/layout/PageLayout';

export default function PlaybookSettings() {
  const { id } = useParams<{ id: string }>();
  const { toast } = useToast();

  const { data: playbookData, isLoading } = useQuery<any>({
    queryKey: ['/api/playbook-library', id],
    queryFn: async () => {
      const response = await fetch(`/api/playbook-library/${id}`);
      if (!response.ok) throw new Error('Failed to fetch playbook');
      return response.json();
    },
    enabled: !!id,
  });

  const playbook = playbookData?.playbook;

  const [settings, setSettings] = useState({
    autoActivate: false,
    notifyOnTrigger: true,
    requireApproval: true,
    approvalThreshold: 1,
    syncPlatform: 'none',
    budgetLimit: '',
    executionTimeout: 12,
    escalationEnabled: true,
    escalationDelay: 5,
  });

  const updateSettingsMutation = useMutation({
    mutationFn: async (newSettings: typeof settings) => {
      return apiRequest('PATCH', `/api/playbook-library/${id}/settings`, newSettings);
    },
    onSuccess: () => {
      toast({
        title: 'Settings Saved',
        description: 'Playbook settings have been updated successfully.',
      });
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', id] });
    },
    onError: () => {
      toast({
        title: 'Error',
        description: 'Failed to save settings. Please try again.',
        variant: 'destructive',
      });
    },
  });

  const handleSave = () => {
    updateSettingsMutation.mutate(settings);
  };

  if (isLoading) {
    return (
      <PageLayout>
        <div className="flex items-center justify-center h-64">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
        </div>
      </PageLayout>
    );
  }

  if (!playbook) {
    return (
      <PageLayout>
        <div className="text-center py-12">
          <p className="text-muted-foreground">Playbook not found</p>
          <Button asChild className="mt-4">
            <Link href="/playbook-library">Back to Library</Link>
          </Button>
        </div>
      </PageLayout>
    );
  }

  return (
    <PageLayout>
      <div className="max-w-4xl mx-auto space-y-6">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <Button variant="ghost" size="icon" asChild data-testid="button-back">
              <Link href={`/playbook-library/${id}`}>
                <ArrowLeft className="h-5 w-5" />
              </Link>
            </Button>
            <div>
              <h1 className="text-2xl font-bold">Playbook Settings</h1>
              <p className="text-muted-foreground">{playbook.name}</p>
            </div>
          </div>
          <Button 
            onClick={handleSave} 
            disabled={updateSettingsMutation.isPending}
            data-testid="button-save-settings"
          >
            <Save className="h-4 w-4 mr-2" />
            {updateSettingsMutation.isPending ? 'Saving...' : 'Save Settings'}
          </Button>
        </div>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Zap className="h-5 w-5" />
              Activation Settings
            </CardTitle>
            <CardDescription>
              Configure how this playbook is activated and executed
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-6">
            <div className="flex items-center justify-between">
              <div className="space-y-0.5">
                <Label htmlFor="autoActivate">Auto-Activate on Trigger</Label>
                <p className="text-sm text-muted-foreground">
                  Automatically activate when trigger conditions are met
                </p>
              </div>
              <Switch
                id="autoActivate"
                checked={settings.autoActivate}
                onCheckedChange={(checked) => setSettings({ ...settings, autoActivate: checked })}
                data-testid="switch-auto-activate"
              />
            </div>

            <Separator />

            <div className="flex items-center justify-between">
              <div className="space-y-0.5">
                <Label htmlFor="requireApproval">Require Approval</Label>
                <p className="text-sm text-muted-foreground">
                  Require executive approval before activation
                </p>
              </div>
              <Switch
                id="requireApproval"
                checked={settings.requireApproval}
                onCheckedChange={(checked) => setSettings({ ...settings, requireApproval: checked })}
                data-testid="switch-require-approval"
              />
            </div>

            {settings.requireApproval && (
              <div className="space-y-2 pl-6 border-l-2 border-muted">
                <Label htmlFor="approvalThreshold">Required Approvals</Label>
                <Select
                  value={String(settings.approvalThreshold)}
                  onValueChange={(value) => setSettings({ ...settings, approvalThreshold: Number(value) })}
                >
                  <SelectTrigger className="w-48" data-testid="select-approval-threshold">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="1">1 Approval</SelectItem>
                    <SelectItem value="2">2 Approvals</SelectItem>
                    <SelectItem value="3">3 Approvals</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            )}

            <Separator />

            <div className="space-y-2">
              <Label htmlFor="executionTimeout" className="flex items-center gap-2">
                <Clock className="h-4 w-4" />
                Execution Window (minutes)
              </Label>
              <Input
                id="executionTimeout"
                type="number"
                value={settings.executionTimeout}
                onChange={(e) => setSettings({ ...settings, executionTimeout: Number(e.target.value) })}
                className="w-48"
                min={5}
                max={60}
                data-testid="input-execution-timeout"
              />
              <p className="text-sm text-muted-foreground">
                Target time to complete all execution tasks (default: 12 minutes)
              </p>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Bell className="h-5 w-5" />
              Notification Settings
            </CardTitle>
            <CardDescription>
              Configure alerts and stakeholder notifications
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-6">
            <div className="flex items-center justify-between">
              <div className="space-y-0.5">
                <Label htmlFor="notifyOnTrigger">Notify on Trigger Detection</Label>
                <p className="text-sm text-muted-foreground">
                  Send alerts when trigger conditions are detected
                </p>
              </div>
              <Switch
                id="notifyOnTrigger"
                checked={settings.notifyOnTrigger}
                onCheckedChange={(checked) => setSettings({ ...settings, notifyOnTrigger: checked })}
                data-testid="switch-notify-trigger"
              />
            </div>

            <Separator />

            <div className="flex items-center justify-between">
              <div className="space-y-0.5">
                <Label htmlFor="escalationEnabled">Enable Escalation</Label>
                <p className="text-sm text-muted-foreground">
                  Escalate to leadership if tasks are delayed
                </p>
              </div>
              <Switch
                id="escalationEnabled"
                checked={settings.escalationEnabled}
                onCheckedChange={(checked) => setSettings({ ...settings, escalationEnabled: checked })}
                data-testid="switch-escalation"
              />
            </div>

            {settings.escalationEnabled && (
              <div className="space-y-2 pl-6 border-l-2 border-muted">
                <Label htmlFor="escalationDelay">Escalation Delay (minutes)</Label>
                <Input
                  id="escalationDelay"
                  type="number"
                  value={settings.escalationDelay}
                  onChange={(e) => setSettings({ ...settings, escalationDelay: Number(e.target.value) })}
                  className="w-48"
                  min={1}
                  max={30}
                  data-testid="input-escalation-delay"
                />
              </div>
            )}
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Users className="h-5 w-5" />
              Integration Settings
            </CardTitle>
            <CardDescription>
              Connect with external project management tools
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="syncPlatform">Sync Platform</Label>
              <Select
                value={settings.syncPlatform}
                onValueChange={(value) => setSettings({ ...settings, syncPlatform: value })}
              >
                <SelectTrigger className="w-64" data-testid="select-sync-platform">
                  <SelectValue placeholder="Select platform" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="none">No Integration</SelectItem>
                  <SelectItem value="jira">Jira</SelectItem>
                  <SelectItem value="asana">Asana</SelectItem>
                  <SelectItem value="monday">Monday.com</SelectItem>
                  <SelectItem value="ms_project">Microsoft Project</SelectItem>
                  <SelectItem value="servicenow">ServiceNow</SelectItem>
                </SelectContent>
              </Select>
              <p className="text-sm text-muted-foreground">
                Automatically sync tasks to your project management platform on activation
              </p>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <DollarSign className="h-5 w-5" />
              Budget Settings
            </CardTitle>
            <CardDescription>
              Configure pre-approved budget limits
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="budgetLimit">Pre-Approved Budget Limit (USD)</Label>
              <Input
                id="budgetLimit"
                type="number"
                value={settings.budgetLimit}
                onChange={(e) => setSettings({ ...settings, budgetLimit: e.target.value })}
                placeholder={playbook.preApprovedBudget ? `Current: $${playbook.preApprovedBudget}` : 'Enter amount'}
                className="w-64"
                data-testid="input-budget-limit"
              />
              <p className="text-sm text-muted-foreground">
                Budget automatically unlocked when playbook is activated
              </p>
            </div>
          </CardContent>
        </Card>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/PracticeDrills.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { 
  Target, 
  Play, 
  Calendar, 
  Clock,
  Users,
  CheckCircle,
  AlertTriangle,
  TrendingUp,
  Award,
  Activity
} from 'lucide-react';
import PageLayout from '@/components/layout/PageLayout';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';

export default function PracticeDrills() {
  const { toast } = useToast();
  const [selectedDrill, setSelectedDrill] = useState<any>(null);
  const [isScheduling, setIsScheduling] = useState(false);
  const [scheduledDate, setScheduledDate] = useState('');
  const [participants, setParticipants] = useState('');
  const [selectedPlaybookId, setSelectedPlaybookId] = useState('');

  // Fetch organizations
  const { data: organizations = [] } = useQuery<any[]>({ 
    queryKey: ['/api/organizations'] 
  });
  const organizationId = organizations[0]?.id;

  // Fetch playbooks for selection
  const { data: libraryData } = useQuery<any>({
    queryKey: ['/api/playbook-library'],
  });
  const playbooks = libraryData?.playbooks || [];

  // Fetch scheduled drills
  const { data: drills = [], isLoading: drillsLoading } = useQuery<any[]>({
    queryKey: ['/api/practice-drills', organizationId],
    enabled: !!organizationId,
  });

  // Fetch drill performance data
  const { data: performanceData } = useQuery<any>({
    queryKey: [`/api/practice-drills/performance`, organizationId],
    enabled: !!organizationId,
  });
  const performances = performanceData?.performances || [];
  const performanceSummary = performanceData?.summary || {
    totalDrills: 0,
    passedDrills: 0,
    passRate: 0,
    averageScore: 0,
    averageExecutionTime: 0,
    targetExecutionTime: 12
  };

  // Schedule drill mutation
  const scheduleDrillMutation = useMutation({
    mutationFn: async (data: any) => {
      return apiRequest('POST', '/api/practice-drills', data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/practice-drills'] });
      toast({
        title: 'Drill Scheduled',
        description: 'Practice drill has been scheduled successfully',
      });
      setIsScheduling(false);
      setScheduledDate('');
      setParticipants('');
      setSelectedPlaybookId('');
    },
    onError: () => {
      toast({
        title: 'Error',
        description: 'Failed to schedule practice drill',
        variant: 'destructive',
      });
    },
  });

  // Start drill mutation
  const startDrillMutation = useMutation({
    mutationFn: async (drillId: string) => {
      return apiRequest('POST', `/api/practice-drills/${drillId}/start`, {});
    },
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ['/api/practice-drills'] });
      toast({
        title: 'Drill Started',
        description: 'Live simulation is now running',
      });
      setSelectedDrill(data);
    },
    onError: () => {
      toast({
        title: 'Error',
        description: 'Failed to start drill',
        variant: 'destructive',
      });
    },
  });

  // Complete drill mutation
  const completeDrillMutation = useMutation({
    mutationFn: async ({ drillId, data }: any) => {
      return apiRequest('POST', `/api/practice-drills/${drillId}/complete`, data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/practice-drills'] });
      queryClient.invalidateQueries({ queryKey: ['/api/practice-drills/performance'] });
      toast({
        title: 'Drill Completed',
        description: 'Performance data has been recorded',
      });
      setSelectedDrill(null);
    },
  });

  const handleScheduleDrill = () => {
    if (!selectedPlaybookId || !scheduledDate || !organizationId) {
      toast({
        title: 'Missing Information',
        description: 'Please fill in all required fields',
        variant: 'destructive',
      });
      return;
    }

    const participantsList = participants.split(',').map(p => p.trim()).filter(Boolean);

    scheduleDrillMutation.mutate({
      organizationId,
      playbookId: selectedPlaybookId,
      scheduledFor: new Date(scheduledDate).toISOString(),
      participants: participantsList,
    });
  };

  const handleCompleteDrill = (drillId: string, success: boolean) => {
    completeDrillMutation.mutate({
      drillId,
      data: {
        timeToComplete: Math.floor(Math.random() * 20) + 5, // Simulated time
        participantsFeedback: success ? 'excellent' : 'needs_improvement',
        bottlenecks: success ? [] : ['Communication delays', 'Resource allocation'],
        successRate: success ? 95 : 65,
      },
    });
  };

  if (drillsLoading) {
    return (
      <PageLayout>
        <div className="p-6">
          <div className="animate-pulse">Loading practice drills...</div>
        </div>
      </PageLayout>
    );
  }

  const upcomingDrills = drills.filter(d => d.status === 'scheduled');
  const completedDrills = drills.filter(d => d.status === 'completed');
  const activeDrills = drills.filter(d => d.status === 'in_progress');

  // Calculate aggregate stats
  const avgCompletionTime = performances.length > 0
    ? Math.round(performances.reduce((sum, p) => sum + (p.timeToComplete || 0), 0) / performances.length)
    : 0;

  const avgSuccessRate = performances.length > 0
    ? Math.round(performances.reduce((sum, p) => sum + (p.successRate || 0), 0) / performances.length)
    : 0;

  return (
    <PageLayout>
      <div className="p-6 space-y-6" data-testid="practice-drills-page">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold" data-testid="page-title">
              Strategic Simulations & War Games
            </h1>
            <p className="text-muted-foreground mt-1">
              Practice decision execution through scenario testing and executive simulations
            </p>
          </div>
          <div className="flex items-center gap-4">
            <Button 
              onClick={() => setIsScheduling(!isScheduling)}
              data-testid="button-schedule-drill"
            >
              <Calendar className="h-4 w-4 mr-2" />
              Schedule New Drill
            </Button>
          </div>
        </div>

        {/* Performance Stats */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <Card>
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-2xl font-bold" data-testid="stat-total-drills">
                    {drills.length}
                  </div>
                  <div className="text-xs text-muted-foreground mt-1">Total Drills</div>
                </div>
                <Activity className="h-8 w-8 text-blue-600 dark:text-blue-400" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-2xl font-bold" data-testid="stat-completion-time">
                    {avgCompletionTime}m
                  </div>
                  <div className="text-xs text-muted-foreground mt-1">Avg. Completion</div>
                </div>
                <Clock className="h-8 w-8 text-green-600 dark:text-green-400" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-2xl font-bold" data-testid="stat-success-rate">
                    {avgSuccessRate}%
                  </div>
                  <div className="text-xs text-muted-foreground mt-1">Success Rate</div>
                </div>
                <TrendingUp className="h-8 w-8 text-purple-600 dark:text-purple-400" />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <div className="text-2xl font-bold" data-testid="stat-upcoming">
                    {upcomingDrills.length}
                  </div>
                  <div className="text-xs text-muted-foreground mt-1">Upcoming</div>
                </div>
                <Calendar className="h-8 w-8 text-orange-600 dark:text-orange-400" />
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Schedule New Drill */}
        {isScheduling && (
          <Card className="border-2 border-[#0A1F44] dark:border-[#D4AF37]">
            <CardHeader>
              <CardTitle>Schedule Practice Drill</CardTitle>
              <CardDescription>Set up a new fire drill simulation</CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="playbook">Select Playbook</Label>
                  <Select value={selectedPlaybookId} onValueChange={setSelectedPlaybookId}>
                    <SelectTrigger id="playbook" data-testid="select-playbook">
                      <SelectValue placeholder="Choose a playbook..." />
                    </SelectTrigger>
                    <SelectContent>
                      {playbooks.map((playbook: any) => (
                        <SelectItem key={playbook.id} value={playbook.id}>
                          {playbook.name}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>

                <div className="space-y-2">
                  <Label htmlFor="date">Scheduled Date & Time</Label>
                  <Input
                    id="date"
                    type="datetime-local"
                    value={scheduledDate}
                    onChange={(e) => setScheduledDate(e.target.value)}
                    data-testid="input-date"
                  />
                </div>
              </div>

              <div className="space-y-2">
                <Label htmlFor="participants">Participants (comma-separated emails)</Label>
                <Input
                  id="participants"
                  placeholder="john@company.com, jane@company.com"
                  value={participants}
                  onChange={(e) => setParticipants(e.target.value)}
                  data-testid="input-participants"
                />
              </div>

              <div className="flex gap-2">
                <Button 
                  onClick={handleScheduleDrill}
                  disabled={scheduleDrillMutation.isPending}
                  data-testid="button-confirm-schedule"
                >
                  {scheduleDrillMutation.isPending ? 'Scheduling...' : 'Schedule Drill'}
                </Button>
                <Button 
                  variant="outline" 
                  onClick={() => setIsScheduling(false)}
                  data-testid="button-cancel-schedule"
                >
                  Cancel
                </Button>
              </div>
            </CardContent>
          </Card>
        )}

        {/* Tabs for different drill views */}
        <Tabs defaultValue="upcoming" className="w-full">
          <TabsList>
            <TabsTrigger value="upcoming" data-testid="tab-upcoming">
              Upcoming ({upcomingDrills.length})
            </TabsTrigger>
            <TabsTrigger value="active" data-testid="tab-active">
              Active ({activeDrills.length})
            </TabsTrigger>
            <TabsTrigger value="completed" data-testid="tab-completed">
              Completed ({completedDrills.length})
            </TabsTrigger>
            <TabsTrigger value="performance" data-testid="tab-performance">
              Performance Reports
            </TabsTrigger>
          </TabsList>

          {/* Upcoming Drills */}
          <TabsContent value="upcoming" className="space-y-4 mt-6">
            {upcomingDrills.length === 0 ? (
              <Card>
                <CardContent className="pt-6">
                  <div className="text-center py-12 text-muted-foreground">
                    <Calendar className="h-12 w-12 mx-auto mb-3 opacity-50" />
                    <p className="font-medium">No upcoming drills</p>
                    <p className="text-sm mt-1">Schedule your first practice drill</p>
                  </div>
                </CardContent>
              </Card>
            ) : (
              upcomingDrills.map((drill: any) => {
                const playbook = playbooks.find((p: any) => p.id === drill.playbookId);
                return (
                  <Card key={drill.id} data-testid={`card-drill-${drill.id}`}>
                    <CardHeader>
                      <div className="flex items-start justify-between">
                        <div>
                          <CardTitle className="text-lg" data-testid={`text-drill-title-${drill.id}`}>
                            {playbook?.title || 'Unknown Playbook'}
                          </CardTitle>
                          <CardDescription className="mt-1">
                            <div className="flex items-center gap-2 text-sm">
                              <Clock className="h-4 w-4" />
                              {new Date(drill.scheduledFor).toLocaleString()}
                            </div>
                          </CardDescription>
                        </div>
                        <Badge variant="outline" data-testid={`badge-status-${drill.id}`}>
                          {drill.status}
                        </Badge>
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center justify-between">
                        <div className="text-sm text-muted-foreground">
                          <Users className="h-4 w-4 inline mr-1" />
                          {drill.participants?.length || 0} participants
                        </div>
                        <Button
                          onClick={() => startDrillMutation.mutate(drill.id)}
                          disabled={startDrillMutation.isPending}
                          data-testid={`button-start-${drill.id}`}
                        >
                          <Play className="h-4 w-4 mr-2" />
                          Start Now
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                );
              })
            )}
          </TabsContent>

          {/* Active Drills */}
          <TabsContent value="active" className="space-y-4 mt-6">
            {activeDrills.length === 0 ? (
              <Card>
                <CardContent className="pt-6">
                  <div className="text-center py-12 text-muted-foreground">
                    <Activity className="h-12 w-12 mx-auto mb-3 opacity-50" />
                    <p className="font-medium">No active drills</p>
                    <p className="text-sm mt-1">Start an upcoming drill to see it here</p>
                  </div>
                </CardContent>
              </Card>
            ) : (
              activeDrills.map((drill: any) => {
                const playbook = playbooks.find((p: any) => p.id === drill.playbookId);
                return (
                  <Card key={drill.id} className="border-2 border-green-500" data-testid={`card-active-drill-${drill.id}`}>
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <Activity className="h-5 w-5 text-green-600 animate-pulse" />
                        {playbook?.title || 'Unknown Playbook'} - LIVE
                      </CardTitle>
                      <CardDescription>Simulation in progress</CardDescription>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div className="text-sm text-muted-foreground">
                        Started: {drill.startedAt ? new Date(drill.startedAt).toLocaleString() : 'N/A'}
                      </div>
                      <div className="flex gap-2">
                        <Button
                          onClick={() => handleCompleteDrill(drill.id, true)}
                          disabled={completeDrillMutation.isPending}
                          data-testid={`button-complete-success-${drill.id}`}
                        >
                          <CheckCircle className="h-4 w-4 mr-2" />
                          Complete Successfully
                        </Button>
                        <Button
                          variant="outline"
                          onClick={() => handleCompleteDrill(drill.id, false)}
                          disabled={completeDrillMutation.isPending}
                          data-testid={`button-complete-issues-${drill.id}`}
                        >
                          <AlertTriangle className="h-4 w-4 mr-2" />
                          Complete with Issues
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                );
              })
            )}
          </TabsContent>

          {/* Completed Drills */}
          <TabsContent value="completed" className="space-y-4 mt-6">
            {completedDrills.length === 0 ? (
              <Card>
                <CardContent className="pt-6">
                  <div className="text-center py-12 text-muted-foreground">
                    <Award className="h-12 w-12 mx-auto mb-3 opacity-50" />
                    <p className="font-medium">No completed drills</p>
                    <p className="text-sm mt-1">Complete your first drill to see results</p>
                  </div>
                </CardContent>
              </Card>
            ) : (
              completedDrills.map((drill: any) => {
                const playbook = playbooks.find((p: any) => p.id === drill.playbookId);
                const performance = performances.find(p => p.drillId === drill.id);
                
                return (
                  <Card key={drill.id} data-testid={`card-completed-drill-${drill.id}`}>
                    <CardHeader>
                      <div className="flex items-start justify-between">
                        <div>
                          <CardTitle className="text-lg">
                            {playbook?.title || 'Unknown Playbook'}
                          </CardTitle>
                          <CardDescription className="mt-1">
                            Completed: {drill.completedAt ? new Date(drill.completedAt).toLocaleDateString() : 'N/A'}
                          </CardDescription>
                        </div>
                        <Badge variant="secondary" data-testid={`badge-completed-${drill.id}`}>
                          <CheckCircle className="h-3 w-3 mr-1" />
                          Completed
                        </Badge>
                      </div>
                    </CardHeader>
                    {performance && (
                      <CardContent>
                        <div className="grid grid-cols-3 gap-4 text-sm">
                          <div>
                            <div className="text-muted-foreground">Time</div>
                            <div className="font-medium" data-testid={`text-time-${drill.id}`}>
                              {performance.timeToComplete}m
                            </div>
                          </div>
                          <div>
                            <div className="text-muted-foreground">Success Rate</div>
                            <div className="font-medium" data-testid={`text-success-${drill.id}`}>
                              {performance.successRate}%
                            </div>
                          </div>
                          <div>
                            <div className="text-muted-foreground">Bottlenecks</div>
                            <div className="font-medium" data-testid={`text-bottlenecks-${drill.id}`}>
                              {performance.bottlenecks?.length || 0}
                            </div>
                          </div>
                        </div>
                      </CardContent>
                    )}
                  </Card>
                );
              })
            )}
          </TabsContent>

          {/* Performance Reports */}
          <TabsContent value="performance" className="space-y-4 mt-6">
            <Card>
              <CardHeader>
                <CardTitle>Performance Analytics</CardTitle>
                <CardDescription>Drill execution trends and improvement areas</CardDescription>
              </CardHeader>
              <CardContent>
                {performances.length === 0 ? (
                  <div className="text-center py-12 text-muted-foreground">
                    <TrendingUp className="h-12 w-12 mx-auto mb-3 opacity-50" />
                    <p className="font-medium">No performance data yet</p>
                    <p className="text-sm mt-1">Complete drills to see analytics</p>
                  </div>
                ) : (
                  <div className="space-y-4">
                    <div className="grid grid-cols-2 gap-6">
                      <div className="space-y-2">
                        <h4 className="font-medium">Common Bottlenecks</h4>
                        <div className="space-y-1">
                          {Array.from(new Set(
                            performances.flatMap(p => p.bottlenecks || [])
                          )).slice(0, 5).map((bottleneck, i) => (
                            <div key={i} className="flex items-center gap-2 text-sm">
                              <AlertTriangle className="h-4 w-4 text-yellow-600" />
                              <span>{bottleneck}</span>
                            </div>
                          ))}
                        </div>
                      </div>

                      <div className="space-y-2">
                        <h4 className="font-medium">Performance Metrics</h4>
                        <div className="space-y-2 text-sm">
                          <div className="flex justify-between">
                            <span className="text-muted-foreground">Best Time:</span>
                            <span className="font-medium">
                              {Math.min(...performances.map(p => p.timeToComplete || 999))}m
                            </span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-muted-foreground">Best Success Rate:</span>
                            <span className="font-medium">
                              {Math.max(...performances.map(p => p.successRate || 0))}%
                            </span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-muted-foreground">Total Drills:</span>
                            <span className="font-medium">{performances.length}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/PreparednessReport.tsx
========================================
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ArrowLeft, Shield, TrendingUp, AlertTriangle, CheckCircle, Target, Users } from 'lucide-react';
import { Link } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';

export default function PreparednessReport() {
  const { data: organizations = [] } = useQuery<any[]>({ queryKey: ['/api/organizations'] });
  const organizationId = organizations[0]?.id || '95b97862-8e9d-4c4c-8609-7d8f37b68d36';

  const { data: scoreData, isLoading } = useQuery<any>({
    queryKey: [`/api/preparedness/score?organizationId=${organizationId}`],
    enabled: !!organizationId,
  });

  const { data: scoreHistory = [] } = useQuery<any[]>({
    queryKey: [`/api/preparedness/history?organizationId=${organizationId}&days=30`],
    enabled: !!organizationId,
  });

  if (isLoading || !scoreData) {
    return (
      <PageLayout>
        <div className="p-6">
          <div className="animate-pulse">Loading preparedness report...</div>
        </div>
      </PageLayout>
    );
  }

  const coverageGaps = scoreData.coverageGaps || [];
  const readinessMetrics = scoreData.readinessMetrics || {};

  return (
    <PageLayout>
      <div className="p-6 space-y-6" data-testid="preparedness-report-page">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <Link href="/dashboard" data-testid="link-back-dashboard">
              <Button variant="outline" size="sm">
                <ArrowLeft className="h-4 w-4 mr-2" />
                Back to Dashboard
              </Button>
            </Link>
            <div>
              <h1 className="text-3xl font-bold" data-testid="page-title">Executive Preparedness Report</h1>
              <p className="text-muted-foreground mt-1">Comprehensive crisis readiness assessment</p>
            </div>
          </div>
          <Shield className="h-12 w-12 text-blue-600 dark:text-blue-400" />
        </div>

        {/* Score Overview */}
        <Card className="border-2">
          <CardHeader>
            <CardTitle>Current Preparedness Score</CardTitle>
            <CardDescription>Your overall crisis readiness rating</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center gap-8">
              <div className="text-center">
                <div className="text-6xl font-bold text-blue-600 dark:text-blue-400" data-testid="score-main">
                  {scoreData.score}
                </div>
                <div className="text-sm text-muted-foreground mt-2">out of 100</div>
              </div>
              
              <div className="flex-1 page-background space-y-4">
                <div>
                  <div className="flex justify-between text-sm mb-2">
                    <span className="font-medium">Scenarios Practiced</span>
                    <span>{readinessMetrics.scenariosPracticed || 0}/30 points</span>
                  </div>
                  <Progress value={(readinessMetrics.scenariosPracticed || 0) / 30 * 100} className="h-2" />
                </div>

                <div>
                  <div className="flex justify-between text-sm mb-2">
                    <span className="font-medium">Drills Completed</span>
                    <span>{readinessMetrics.drillsCompleted || 0}/25 points</span>
                  </div>
                  <Progress value={(readinessMetrics.drillsCompleted || 0) / 25 * 100} className="h-2" />
                </div>

                <div>
                  <div className="flex justify-between text-sm mb-2">
                    <span className="font-medium">Triggers Configured</span>
                    <span>{readinessMetrics.triggersCovered || 0}/20 points</span>
                  </div>
                  <Progress value={(readinessMetrics.triggersCovered || 0) / 20 * 100} className="h-2" />
                </div>

                <div>
                  <div className="flex justify-between text-sm mb-2">
                    <span className="font-medium">Playbook Readiness</span>
                    <span>{readinessMetrics.playbookReadiness || 0}/15 points</span>
                  </div>
                  <Progress value={(readinessMetrics.playbookReadiness || 0) / 15 * 100} className="h-2" />
                </div>

                <div>
                  <div className="flex justify-between text-sm mb-2">
                    <span className="font-medium">Recent Activity</span>
                    <span>{readinessMetrics.recentActivity || 0}/10 points</span>
                  </div>
                  <Progress value={(readinessMetrics.recentActivity || 0) / 10 * 100} className="h-2" />
                </div>
              </div>
            </div>
          </CardContent>
        </Card>

        <Tabs defaultValue="comparison" className="w-full">
          <TabsList className="grid w-full grid-cols-4">
            <TabsTrigger value="comparison" data-testid="tab-comparison">Peer Comparison</TabsTrigger>
            <TabsTrigger value="gaps" data-testid="tab-gaps">Coverage Gaps</TabsTrigger>
            <TabsTrigger value="trends" data-testid="tab-trends">Historical Trends</TabsTrigger>
            <TabsTrigger value="recommendations" data-testid="tab-recommendations">Recommendations</TabsTrigger>
          </TabsList>

          <TabsContent value="comparison" className="space-y-4 mt-6">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Users className="h-5 w-5" />
                  Peer Benchmarking
                </CardTitle>
                <CardDescription>How you compare to industry peers</CardDescription>
              </CardHeader>
              <CardContent className="space-y-6">
                <div className="grid grid-cols-3 gap-6">
                  <div className="text-center p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg">
                    <div className="text-3xl font-bold text-blue-600 dark:text-blue-400" data-testid="industry-avg">
                      {scoreData.industryBenchmark}
                    </div>
                    <div className="text-sm text-muted-foreground mt-1">Industry Average</div>
                    <Badge variant="secondary" className="mt-2">{scoreData.executiveRole}</Badge>
                  </div>

                  <div className="text-center p-4 bg-green-50 dark:bg-green-950/20 rounded-lg">
                    <div className="text-3xl font-bold text-green-600 dark:text-green-400" data-testid="percentile">
                      {scoreData.peerPercentile}
                    </div>
                    <div className="text-sm text-muted-foreground mt-1">Percentile Rank</div>
                    <Badge variant="secondary" className="mt-2">Top {100 - scoreData.peerPercentile}%</Badge>
                  </div>

                  <div className="text-center p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg">
                    <div className="text-3xl font-bold text-purple-600 dark:text-purple-400" data-testid="delta">
                      {Math.abs(scoreData.score - scoreData.industryBenchmark)}
                    </div>
                    <div className="text-sm text-muted-foreground mt-1">Points {scoreData.score > scoreData.industryBenchmark ? 'Above' : 'Below'} Average</div>
                  </div>
                </div>

                <div className="border-t pt-4">
                  <h4 className="font-medium mb-3">Competitive Positioning</h4>
                  <div className="space-y-2 text-sm">
                    {scoreData.score >= scoreData.industryBenchmark + 10 && (
                      <div className="flex items-start gap-2 text-green-700 dark:text-green-400">
                        <CheckCircle className="h-4 w-4 mt-0.5" />
                        <span>Significantly above industry standard - You're a market leader in preparedness</span>
                      </div>
                    )}
                    {scoreData.score < scoreData.industryBenchmark && (
                      <div className="flex items-start gap-2 text-yellow-700 dark:text-yellow-400">
                        <AlertTriangle className="h-4 w-4 mt-0.5" />
                        <span>Below industry average - Prioritize preparedness activities to reduce risk</span>
                      </div>
                    )}
                    <div className="flex items-start gap-2">
                      <TrendingUp className="h-4 w-4 mt-0.5 text-blue-600" />
                      <span>Anonymous benchmarking ensures fair comparison across {scoreData.executiveRole} peers</span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="gaps" className="space-y-4 mt-6">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <AlertTriangle className="h-5 w-5 text-yellow-600" />
                  Coverage Gaps Analysis
                </CardTitle>
                <CardDescription>High-risk scenarios requiring attention</CardDescription>
              </CardHeader>
              <CardContent>
                {coverageGaps.length === 0 ? (
                  <div className="text-center py-8 text-muted-foreground" data-testid="no-gaps">
                    <CheckCircle className="h-12 w-12 mx-auto mb-3 text-green-600" />
                    <p className="font-medium">No critical coverage gaps identified</p>
                    <p className="text-sm mt-1">You've addressed all high-priority scenarios</p>
                  </div>
                ) : (
                  <div className="space-y-4" data-testid="gaps-list">
                    {coverageGaps.map((gap: any, index: number) => (
                      <div key={index} className="border rounded-lg p-4">
                        <div className="flex items-start justify-between mb-3">
                          <div>
                            <h4 className="font-medium">{gap.category}</h4>
                            <Badge variant={gap.severity === 'high' ? 'destructive' : 'secondary'} className="mt-1">
                              {gap.severity} priority
                            </Badge>
                          </div>
                          <Target className="h-5 w-5 text-yellow-600" />
                        </div>
                        <p className="text-sm text-muted-foreground mb-3">{gap.recommendation}</p>
                        {gap.missingPlaybooks && gap.missingPlaybooks.length > 0 && (
                          <div className="text-xs">
                            <div className="font-medium mb-1">Missing Playbooks:</div>
                            <ul className="list-disc list-inside space-y-1 text-muted-foreground">
                              {gap.missingPlaybooks.map((playbook: string, i: number) => (
                                <li key={i}>{playbook}</li>
                              ))}
                            </ul>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                )}
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="trends" className="space-y-4 mt-6">
            <Card>
              <CardHeader>
                <CardTitle>Score History (Last 30 Days)</CardTitle>
                <CardDescription>Track your preparedness improvement over time</CardDescription>
              </CardHeader>
              <CardContent>
                {scoreHistory.length === 0 ? (
                  <div className="text-center py-8 text-muted-foreground">
                    <p>No historical data available yet</p>
                    <p className="text-sm mt-1">Continue practicing to build your trend history</p>
                  </div>
                ) : (
                  <div className="space-y-3">
                    {scoreHistory.slice(0, 10).map((entry: any, index: number) => (
                      <div key={index} className="flex items-center justify-between border-b pb-2">
                        <div className="text-sm text-muted-foreground">
                          {new Date(entry.calculatedAt).toLocaleDateString()}
                        </div>
                        <div className="flex items-center gap-3">
                          <div className="text-lg font-bold">{entry.score}</div>
                          {entry.scoreDelta !== 0 && (
                            <Badge variant={entry.scoreDelta > 0 ? 'default' : 'secondary'}>
                              {entry.scoreDelta > 0 ? '+' : ''}{entry.scoreDelta}
                            </Badge>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="recommendations" className="space-y-4 mt-6">
            <Card>
              <CardHeader>
                <CardTitle>Recommended Actions</CardTitle>
                <CardDescription>Steps to improve your preparedness score</CardDescription>
              </CardHeader>
              <CardContent className="space-y-3">
                {readinessMetrics.scenariosPracticed < 30 && (
                  <div className="flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg" data-testid="rec-scenarios">
                    <Target className="h-5 w-5 text-blue-600 mt-0.5" />
                    <div className="flex-1 page-background">
                      <div className="font-medium text-blue-700 dark:text-blue-300">Practice More Scenarios</div>
                      <p className="text-sm text-blue-600 dark:text-blue-400 mt-1">
                        Complete {Math.ceil((30 - (readinessMetrics.scenariosPracticed || 0)) / 3)} more what-if analyses to maximize this category (+{30 - (readinessMetrics.scenariosPracticed || 0)} points)
                      </p>
                      <Link href="/what-if-analyzer">
                        <Button size="sm" className="mt-2" data-testid="button-goto-analyzer">Go to What-If Analyzer</Button>
                      </Link>
                    </div>
                  </div>
                )}

                {readinessMetrics.drillsCompleted < 25 && (
                  <div className="flex items-start gap-3 p-3 bg-green-50 dark:bg-green-950/20 rounded-lg" data-testid="rec-drills">
                    <Shield className="h-5 w-5 text-green-600 mt-0.5" />
                    <div className="flex-1 page-background">
                      <div className="font-medium text-green-700 dark:text-green-300">Run Playbook Drills</div>
                      <p className="text-sm text-green-600 dark:text-green-400 mt-1">
                        Complete {Math.ceil((25 - (readinessMetrics.drillsCompleted || 0)) / 5)} more playbook drills (+{25 - (readinessMetrics.drillsCompleted || 0)} points)
                      </p>
                      <Link href="/playbook-library">
                        <Button size="sm" className="mt-2" data-testid="button-goto-playbooks">View Playbooks</Button>
                      </Link>
                    </div>
                  </div>
                )}

                {readinessMetrics.triggersCovered < 20 && (
                  <div className="flex items-start gap-3 p-3 bg-purple-50 dark:bg-purple-950/20 rounded-lg" data-testid="rec-triggers">
                    <AlertTriangle className="h-5 w-5 text-purple-600 mt-0.5" />
                    <div className="flex-1 page-background">
                      <div className="font-medium text-purple-700 dark:text-purple-300">Configure More Triggers</div>
                      <p className="text-sm text-purple-600 dark:text-purple-400 mt-1">
                        Set up {Math.ceil((20 - (readinessMetrics.triggersCovered || 0)) / 4)} more executive triggers (+{20 - (readinessMetrics.triggersCovered || 0)} points)
                      </p>
                      <Link href="/trigger-dashboard">
                        <Button size="sm" className="mt-2" data-testid="button-goto-triggers">Manage Triggers</Button>
                      </Link>
                    </div>
                  </div>
                )}

                {readinessMetrics.recentActivity < 10 && (
                  <div className="flex items-start gap-3 p-3 bg-yellow-50 dark:bg-yellow-950/20 rounded-lg" data-testid="rec-activity">
                    <TrendingUp className="h-5 w-5 text-yellow-600 mt-0.5" />
                    <div className="flex-1 page-background">
                      <div className="font-medium text-yellow-700 dark:text-yellow-300">Increase Recent Activity</div>
                      <p className="text-sm text-yellow-600 dark:text-yellow-400 mt-1">
                        Stay active with regular practice - aim for 5+ activities in the last 30 days (+{10 - (readinessMetrics.recentActivity || 0)} points)
                      </p>
                    </div>
                  </div>
                )}
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/Pricing.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { 
  Check,
  ArrowRight,
  TrendingUp,
  Shield,
  Zap,
  Users,
  Building2,
  Sparkles,
  Play,
  FileText
} from "lucide-react";
import { useLocation } from "wouter";
import { useEffect } from "react";
import { updatePageMetadata } from "@/lib/seo";
import StandardNav from "@/components/layout/StandardNav";

export default function Pricing() {
  const [, setLocation] = useLocation();

  useEffect(() => {
    updatePageMetadata({
      title: "Enterprise Pricing - M | Strategic Execution Operating System",
      description: "Premium tiered pricing for Fortune 1000 companies. Enterprise ($250K), Enterprise Plus ($450K), Global ($750K-$1.5M). Founding Partner Pilot Program ($75K, 100% credited to Year 1) available Q1 2025.",
      ogTitle: "M Enterprise Pricing - Built for Fortune 1000",
      ogDescription: "Category-defining Executive Decision Operations platform with value-aligned premium pricing. Three tiers from $250K-$1.5M annually.",
    });
  }, []);

  return (
    <div className="page-background min-h-screen bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900">
      <StandardNav />

      {/* Hero */}
      <section className="py-20 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
        <div className="max-w-5xl mx-auto text-center">
          <Badge className="mb-6 bg-cyan-500 text-white border-0 text-lg px-6 py-2" data-testid="badge-pricing">
            Enterprise Pricing
          </Badge>
          <h1 className="text-5xl md:text-6xl font-bold mb-6 text-white" data-testid="heading-pricing">
            Built for Fortune 1000
          </h1>
          <p className="text-2xl text-blue-100 mb-4">
            Transparent, value-based pricing for enterprise decision velocity
          </p>
          <p className="text-lg text-blue-200 max-w-3xl mx-auto">
            M is purpose-built for large enterprises executing complex strategic decisions. Our pricing reflects the platform's ability to deliver 360x faster execution and preserve millions in revenue.
          </p>
        </div>
      </section>

      {/* Founding Partner Pilot Program */}
      <section className="py-20 px-6 bg-white dark:bg-slate-900">
        <div className="max-w-6xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-emerald-600 text-white text-base px-4 py-2">
              Q1 2025 Founding Partner Program
            </Badge>
            <h2 className="text-4xl font-bold mb-4 text-slate-900 dark:text-white">
              Join Our Founding Partners
            </h2>
            <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto">
              We're selecting 10 Fortune 1000 companies for our 90-day validation program. Full platform access, dedicated implementation support, 100% pilot fee credited toward Year 1.
            </p>
          </div>

          <Card className="max-w-4xl mx-auto bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/30 dark:to-emerald-950/30 border-2 border-green-500" data-testid="card-early-access">
            <CardHeader>
              <div className="flex items-center justify-between mb-4">
                <CardTitle className="text-3xl font-bold text-slate-900 dark:text-white">
                  Founding Partner Pilot
                </CardTitle>
                <div className="text-right">
                  <div className="text-4xl font-bold text-emerald-600">$75K</div>
                  <div className="text-sm text-emerald-700 dark:text-emerald-400 font-medium">100% credited to Year 1</div>
                  <div className="text-xs text-slate-500 dark:text-slate-400">90-day pilot</div>
                </div>
              </div>
              <p className="text-slate-700 dark:text-slate-300">
                Strategic validation partnership with full platform access, dedicated implementation support, and executive-level partnership
              </p>
            </CardHeader>
            <CardContent>
              <div className="grid md:grid-cols-2 gap-6 mb-8">
                <div>
                  <h3 className="font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2">
                    <Sparkles className="w-5 h-5 text-green-600" />
                    What's Included
                  </h3>
                  <ul className="space-y-2">
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>Full platform access (all features unlocked)</span>
                    </li>
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>Dedicated implementation team</span>
                    </li>
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>Custom playbook development (3 scenarios)</span>
                    </li>
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>Strategic execution coaching</span>
                    </li>
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>Weekly success reviews</span>
                    </li>
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>ROI measurement & documentation</span>
                    </li>
                  </ul>
                </div>
                <div>
                  <h3 className="font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2">
                    <Shield className="w-5 h-5 text-green-600" />
                    Qualification Criteria
                  </h3>
                  <ul className="space-y-2">
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>Fortune 1000 company</span>
                    </li>
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>VP+ decision authority</span>
                    </li>
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>Active strategic execution challenges</span>
                    </li>
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>Commitment to 90-day validation</span>
                    </li>
                    <li className="flex items-start gap-2 text-slate-700 dark:text-slate-300">
                      <Check className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                      <span>Willingness to provide feedback</span>
                    </li>
                  </ul>
                </div>
              </div>
              <div className="bg-white dark:bg-slate-800 rounded-lg p-4 mb-6 border border-green-200 dark:border-green-800">
                <div className="flex items-start gap-3">
                  <TrendingUp className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
                  <div className="text-sm text-slate-700 dark:text-slate-300">
                    <span className="font-semibold">Post-Pilot Conversion:</span> Founding Partners receive 100% pilot fee credit toward Year 1, preferred pricing, and ongoing strategic support when converting to annual licenses.
                  </div>
                </div>
              </div>
              <Button 
                size="lg" 
                onClick={() => setLocation("/contact")}
                className="w-full bg-green-600 hover:bg-green-700 text-white text-lg py-6"
                data-testid="button-apply-early-access"
              >
                Apply for Founding Partner Pilot <ArrowRight className="ml-2 h-5 w-5" />
              </Button>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Post-Pilot Pricing */}
      <section className="py-20 px-6 bg-slate-100 dark:bg-slate-800">
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-blue-600 text-white text-base px-4 py-2">
              Post-Pilot Enterprise Pricing
            </Badge>
            <h2 className="text-4xl font-bold mb-4 text-slate-900 dark:text-white">
              Transparent, Value-Based Tiers
            </h2>
            <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto">
              Premium pricing for enterprise scale. No hidden fees. No per-user charges. Unlimited scenarios and executions.
            </p>
          </div>

          <div className="grid md:grid-cols-3 gap-6 mb-12">
            {/* Enterprise Tier */}
            <Card className="border-2 border-blue-200 dark:border-blue-800" data-testid="card-tier-enterprise">
              <CardHeader className="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30">
                <div className="text-center">
                  <Badge className="mb-3 bg-blue-600 text-white">Enterprise</Badge>
                  <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">1,000-5,000 employees</div>
                  <div className="flex items-baseline justify-center gap-2 mb-1">
                    <div className="text-5xl font-bold text-slate-900 dark:text-white">$250K</div>
                  </div>
                  <div className="text-sm text-slate-600 dark:text-slate-400">per year</div>
                </div>
              </CardHeader>
              <CardContent className="pt-6">
                <ul className="space-y-3 mb-6">
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
                    <span>Full platform access</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
                    <span>AI Intelligence Suite</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
                    <span>24/7 monitoring system</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
                    <span>Customer success manager</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
                    <span>Quarterly business reviews</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
                    <span>99.9% uptime SLA</span>
                  </li>
                </ul>
                <Button 
                  className="w-full bg-blue-600 hover:bg-blue-700 text-white"
                  onClick={() => setLocation("/contact")}
                  data-testid="button-enterprise-tier"
                >
                  Get Started
                </Button>
              </CardContent>
            </Card>

            {/* Enterprise Plus Tier */}
            <Card className="border-2 border-purple-500 dark:border-purple-600 shadow-xl relative" data-testid="card-tier-enterprise-plus">
              <div className="absolute -top-3 left-1/2 -translate-x-1/2">
                <Badge className="bg-purple-600 text-white px-4 py-1 text-sm">Most Popular</Badge>
              </div>
              <CardHeader className="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-950/30 dark:to-pink-950/30">
                <div className="text-center">
                  <Badge className="mb-3 bg-purple-600 text-white">Enterprise Plus</Badge>
                  <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">5,000-15,000 employees</div>
                  <div className="flex items-baseline justify-center gap-2 mb-1">
                    <div className="text-5xl font-bold text-slate-900 dark:text-white">$450K</div>
                  </div>
                  <div className="text-sm text-slate-600 dark:text-slate-400">per year</div>
                </div>
              </CardHeader>
              <CardContent className="pt-6">
                <ul className="space-y-3 mb-6">
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5" />
                    <span><strong>Everything in Enterprise, plus:</strong></span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5" />
                    <span>Multi-division coordination</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5" />
                    <span>Advanced integration hub</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5" />
                    <span>Priority support (2-hour SLA)</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5" />
                    <span>Custom playbook development</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5" />
                    <span>Executive briefing service</span>
                  </li>
                </ul>
                <Button 
                  className="w-full bg-purple-600 hover:bg-purple-700 text-white"
                  onClick={() => setLocation("/contact")}
                  data-testid="button-enterprise-plus-tier"
                >
                  Get Started
                </Button>
              </CardContent>
            </Card>

            {/* Global Tier */}
            <Card className="border-2 border-slate-300 dark:border-slate-700" data-testid="card-tier-global">
              <CardHeader className="bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900/50 dark:to-slate-800/50">
                <div className="text-center">
                  <Badge className="mb-3 bg-slate-700 text-white">Global</Badge>
                  <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">15,000+ employees</div>
                  <div className="flex items-baseline justify-center gap-2 mb-1">
                    <div className="text-4xl font-bold text-slate-900 dark:text-white">Custom</div>
                  </div>
                  <div className="text-sm text-slate-600 dark:text-slate-400">$750K - $1.5M+/year</div>
                </div>
              </CardHeader>
              <CardContent className="pt-6">
                <ul className="space-y-3 mb-6">
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-slate-700 flex-shrink-0 mt-0.5" />
                    <span><strong>Everything in Enterprise Plus, plus:</strong></span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-slate-700 flex-shrink-0 mt-0.5" />
                    <span>Multi-region orchestration</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-slate-700 flex-shrink-0 mt-0.5" />
                    <span>White-glove implementation</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-slate-700 flex-shrink-0 mt-0.5" />
                    <span>Dedicated account team</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-slate-700 flex-shrink-0 mt-0.5" />
                    <span>Custom SLA agreements</span>
                  </li>
                  <li className="flex items-start gap-2 text-sm text-slate-700 dark:text-slate-300">
                    <Check className="w-5 h-5 text-slate-700 flex-shrink-0 mt-0.5" />
                    <span>On-premise deployment option</span>
                  </li>
                </ul>
                <Button 
                  className="w-full bg-slate-700 hover:bg-slate-800 text-white"
                  onClick={() => setLocation("/contact")}
                  data-testid="button-global-tier"
                >
                  Contact Sales
                </Button>
              </CardContent>
            </Card>
          </div>

          {/* Add-On Modules */}
          <Card className="max-w-5xl mx-auto bg-white dark:bg-slate-900 border-2">
            <CardHeader>
              <CardTitle className="text-center text-2xl">Optional Add-On Modules</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid md:grid-cols-2 gap-6">
                <div className="border border-slate-200 dark:border-slate-700 rounded-lg p-4">
                  <div className="flex items-start justify-between mb-3">
                    <div>
                      <h3 className="font-semibold text-slate-900 dark:text-white">Premium Integration Hub</h3>
                      <p className="text-sm text-slate-600 dark:text-slate-400">Unlimited connectors, bi-directional sync</p>
                    </div>
                    <div className="text-right">
                      <div className="text-xl font-bold text-blue-600">+$50K</div>
                      <div className="text-xs text-slate-500">per year</div>
                    </div>
                  </div>
                </div>
                <div className="border border-slate-200 dark:border-slate-700 rounded-lg p-4">
                  <div className="flex items-start justify-between mb-3">
                    <div>
                      <h3 className="font-semibold text-slate-900 dark:text-white">White-Glove Implementation</h3>
                      <p className="text-sm text-slate-600 dark:text-slate-400">Custom playbooks, training, change management</p>
                    </div>
                    <div className="text-right">
                      <div className="text-xl font-bold text-blue-600">$150K-$300K</div>
                      <div className="text-xs text-slate-500">one-time</div>
                    </div>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* ROI Justification */}
      <section className="py-20 px-6 bg-white dark:bg-slate-900">
        <div className="max-w-6xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-4xl font-bold mb-4 text-slate-900 dark:text-white">
              Return on Investment
            </h2>
            <p className="text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto">
              M typically delivers 79x ROI in the first year through faster execution and revenue preservation
            </p>
          </div>

          <div className="grid md:grid-cols-3 gap-6 mb-12">
            <Card className="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30 border-2 border-blue-200 dark:border-blue-800">
              <CardContent className="p-6">
                <div className="text-sm font-semibold text-blue-600 dark:text-blue-400 mb-2">Competitive Responses</div>
                <div className="text-3xl font-bold text-slate-900 dark:text-white mb-2">$9.6M</div>
                <div className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                  4 responses/year  $2.4M avg deal preservation
                </div>
                <div className="text-xs text-slate-500 dark:text-slate-500">
                  Days  minutes coordination enables capturing time-sensitive opportunities
                </div>
              </CardContent>
            </Card>

            <Card className="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-950/30 dark:to-pink-950/30 border-2 border-purple-200 dark:border-purple-800">
              <CardContent className="p-6">
                <div className="text-sm font-semibold text-purple-600 dark:text-purple-400 mb-2">Regulatory Compliance</div>
                <div className="text-3xl font-bold text-slate-900 dark:text-white mb-2">$10M</div>
                <div className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                  2 responses/year  $5M avg risk avoidance
                </div>
                <div className="text-xs text-slate-500 dark:text-slate-500">
                  Trigger-activated playbooks ensure compliance windows aren't missed
                </div>
              </CardContent>
            </Card>

            <Card className="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/30 dark:to-emerald-950/30 border-2 border-green-200 dark:border-green-800">
              <CardContent className="p-6">
                <div className="text-sm font-semibold text-green-600 dark:text-green-400 mb-2">M&A Opportunities</div>
                <div className="text-3xl font-bold text-slate-900 dark:text-white mb-2">$20M</div>
                <div className="text-sm text-slate-600 dark:text-slate-400 mb-4">
                  1 response/year  $20M avg value capture
                </div>
                <div className="text-xs text-slate-500 dark:text-slate-500">
                  Pre-built acquisition playbooks enable decisive action when targets appear
                </div>
              </CardContent>
            </Card>
          </div>

          <Card className="max-w-4xl mx-auto bg-gradient-to-r from-blue-600 to-cyan-600 text-white">
            <CardContent className="p-8">
              <div className="grid md:grid-cols-2 gap-8 items-center">
                <div>
                  <div className="text-sm font-semibold text-blue-100 mb-2">Total Annual Value</div>
                  <div className="text-6xl font-bold mb-2">$39.6M</div>
                  <div className="text-blue-100 mb-4">
                    Average customer captures $39.6M in value annually through M
                  </div>
                  <div className="bg-white/10 rounded-lg p-4 border border-white/20">
                    <div className="text-sm text-blue-100 mb-1">Return on Investment</div>
                    <div className="text-3xl font-bold">79x ROI</div>
                    <div className="text-sm text-blue-100 mt-1">Get $79 for every $1 invested</div>
                  </div>
                </div>
                <div className="space-y-3 text-blue-50">
                  <p className="text-sm">
                    <span className="font-semibold">Conservative estimate:</span> These numbers reflect conservative industry benchmarks and documented strategic execution failures.
                  </p>
                  <p className="text-sm">
                    <span className="font-semibold">Your actual ROI:</span> Will vary based on your industry, deal sizes, and execution challenges. Founding Partner pilots measure actual value for your organization.
                  </p>
                  <Button 
                    size="lg" 
                    onClick={() => setLocation("/contact")}
                    className="bg-white text-blue-600 hover:bg-blue-50 w-full mt-4"
                    data-testid="button-calculate-roi"
                  >
                    Calculate Your ROI <ArrowRight className="ml-2 h-5 w-5" />
                  </Button>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* CTA */}
      <section className="py-20 px-6 bg-slate-100 dark:bg-slate-800">
        <div className="max-w-4xl mx-auto text-center">
          <h2 className="text-4xl font-bold mb-6 text-slate-900 dark:text-white">
            Ready to Transform Your Strategic Execution?
          </h2>
          <p className="text-xl text-slate-600 dark:text-slate-400 mb-8">
            Join our Q1 2025 Founding Partner Pilot Program or schedule a personalized pricing consultation
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center mb-8">
            <Button 
              size="lg" 
              onClick={() => setLocation("/contact")}
              className="bg-blue-600 hover:bg-blue-700 text-white text-lg px-10 py-6"
              data-testid="button-apply-now"
            >
              Apply for Founding Partner Pilot <ArrowRight className="ml-2 h-5 w-5" />
            </Button>
            <Button 
              size="lg" 
              onClick={() => setLocation("/industry-demos")}
              variant="outline"
              className="border-2 border-emerald-500 text-emerald-600 dark:text-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 text-lg px-10 py-6"
              data-testid="button-view-demos"
            >
              <Play className="mr-2 h-5 w-5" />
              View 9 Industry Demos
            </Button>
          </div>
          
          <div className="flex items-center justify-center gap-6 text-sm text-slate-600 dark:text-slate-400">
            <button 
              onClick={() => setLocation("/playbook-library")}
              className="underline hover:text-blue-600 dark:hover:text-blue-400 transition-colors flex items-center gap-1"
              data-testid="link-playbook-library"
            >
              <FileText className="h-4 w-4" />
              Explore 166 Strategic Playbooks
            </button>
            <span></span>
            <button 
              onClick={() => setLocation("/demo")}
              className="underline hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
              data-testid="link-watch-demo"
            >
              Watch live demo
            </button>
          </div>
        </div>
      </section>
    </div>
  );
}


========================================
FILE: client/src/pages/PrismInsights.tsx
========================================
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Link } from 'wouter';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';
import { 
  Layers, 
  Brain, 
  Target,
  TrendingUp,
  Users,
  DollarSign,
  Globe,
  Lightbulb,
  Eye,
  Search,
  BarChart3,
  Filter,
  Download,
  ArrowLeft,
  Home
} from 'lucide-react';

export default function PrismInsights() {
  const [selectedDimension, setSelectedDimension] = useState('strategic');

  const strategicInsights = [
    {
      id: 'market-positioning',
      title: 'Market Positioning Analysis',
      dimension: 'strategic',
      confidence: 94,
      impact: 'high',
      timeframe: 'Q4 2025',
      description: 'Multi-dimensional analysis reveals optimal market positioning for competitive advantage',
      insights: [
        'Premium positioning in emerging markets shows 340% ROI potential',
        'Customer acquisition cost decreasing by 23% in target segments',
        'Brand perception alignment with market demands at 89%'
      ],
      recommendations: [
        'Accelerate premium product line expansion',
        'Increase marketing spend in emerging markets by 45%',
        'Develop partnerships with key market influencers'
      ],
      icon: <Target className="h-5 w-5" />,
      color: 'emerald'
    },
    {
      id: 'operational-efficiency',
      title: 'Operational Efficiency Matrix',
      dimension: 'operational',
      confidence: 87,
      impact: 'high',
      timeframe: 'Q1-Q2 2025',
      description: 'Cross-functional analysis identifying efficiency optimization opportunities',
      insights: [
        'Process automation potential in 67% of current workflows',
        'Resource allocation misalignment costing $2.3M annually',
        'Team productivity varies by 34% across departments'
      ],
      recommendations: [
        'Implement AI-driven process automation in high-impact areas',
        'Restructure resource allocation based on performance data',
        'Deploy standardized productivity enhancement protocols'
      ],
      icon: <BarChart3 className="h-5 w-5" />,
      color: 'blue'
    },
    {
      id: 'financial-modeling',
      title: 'Financial Performance Modeling',
      dimension: 'financial',
      confidence: 91,
      impact: 'critical',
      timeframe: 'Ongoing',
      description: 'Multi-variable financial analysis with predictive modeling capabilities',
      insights: [
        'Revenue growth trajectory shows 28% YoY increase potential',
        'Cost optimization opportunities worth $4.7M identified',
        'Investment portfolio showing 15% above-market performance'
      ],
      recommendations: [
        'Diversify revenue streams to reduce single-point risk',
        'Implement advanced cost management systems',
        'Expand high-performing investment allocations'
      ],
      icon: <DollarSign className="h-5 w-5" />,
      color: 'purple'
    },
    {
      id: 'talent-dynamics',
      title: 'Talent & Culture Dynamics',
      dimension: 'human',
      confidence: 83,
      impact: 'medium',
      timeframe: 'Q2-Q3 2025',
      description: 'Comprehensive analysis of human capital and organizational culture',
      insights: [
        'Employee engagement correlation with performance at 0.78',
        'Skills gap analysis reveals critical shortages in 3 key areas',
        'Leadership effectiveness rating increased 12% this quarter'
      ],
      recommendations: [
        'Launch targeted upskilling programs for identified gaps',
        'Implement advanced employee engagement initiatives',
        'Expand leadership development across all levels'
      ],
      icon: <Users className="h-5 w-5" />,
      color: 'orange'
    }
  ];

  const getColorClasses = (color: string) => {
    const colors = {
      emerald: 'text-emerald-400 bg-emerald-500/10 border-emerald-500/30',
      blue: 'text-blue-400 bg-blue-500/10 border-blue-500/30',
      purple: 'text-purple-400 bg-purple-500/10 border-purple-500/30',
      orange: 'text-orange-400 bg-orange-500/10 border-orange-500/30'
    };
    return colors[color as keyof typeof colors] || colors.blue;
  };

  const getImpactColor = (impact: string) => {
    switch (impact) {
      case 'critical': return 'bg-red-500/20 text-red-400 border-red-500/30';
      case 'high': return 'bg-orange-500/20 text-orange-400 border-orange-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30';
      case 'low': return 'bg-green-500/20 text-green-400 border-green-500/30';
      default: return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
    }
  };

  const filteredInsights = strategicInsights.filter(insight =>
    selectedDimension === 'all' || insight.dimension === selectedDimension
  );

  return (
    <>
      <div className="page-background min-h-screen bg-transparent p-6" data-testid="prism-insights">
        <div className="max-w-7xl mx-auto space-y-8">
          
          {/* Breadcrumb Navigation */}
          <div className="mb-6">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>AI Intelligence</span>
              <span>/</span>
              <span className="text-white">Prism Insights</span>
            </div>
          </div>

          {/* ROI Value Context - Tier 2 Enhancement */}
          <Card className="mb-4 bg-purple-50 dark:bg-purple-950/20 border-purple-300 dark:border-purple-700" data-testid="prism-roi-context">
            <CardContent className="p-3 flex items-center gap-3">
              <div className="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                <Layers className="h-5 w-5 text-purple-600" />
              </div>
              <div>
                <div className="font-semibold text-purple-900 dark:text-purple-100 text-sm">How Prism Saves You Money</div>
                <div className="text-xs text-purple-700 dark:text-purple-300">Automates 40 hours/month of stakeholder analysis, saving $180K+ annually in executive time</div>
              </div>
            </CardContent>
          </Card>

          {/* Header */}
          <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-6 rounded-lg">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <Layers className="h-10 w-10" />
                <div>
                  <h1 className="text-3xl font-bold" data-testid="prism-title">
                    Prism Insights
                  </h1>
                  <p className="text-purple-100">Multi-dimensional strategic analysis and decision support intelligence</p>
                </div>
              </div>
              <div className="flex items-center gap-4">
                <OnboardingTrigger pageId="prism-insights" autoStart={true} className="bg-white/10 border-white/30 text-white hover:bg-white/20" />
                <Link to="/">
                  <Button variant="secondary" className="bg-purple-700 hover:bg-purple-800 text-purple-100 border-purple-600" data-testid="back-to-dashboard">
                    <ArrowLeft className="h-4 w-4 mr-2" />
                    Dashboard
                  </Button>
                </Link>
                <Badge variant="secondary" className="bg-purple-700 text-purple-100 border-purple-600" data-testid="ai-analysis-badge">
                  <Brain className="h-4 w-4 mr-2" />
                  AI ANALYSIS
                </Badge>
                <Button variant="secondary" className="bg-pink-600 hover:bg-pink-700 text-white" data-testid="generate-report-button">
                  <Download className="h-4 w-4 mr-2" />
                  Generate Report
                </Button>
              </div>
            </div>
          </div>

          <Tabs value={selectedDimension} onValueChange={setSelectedDimension} className="w-full">
            <TabsList className="grid w-full grid-cols-5">
              <TabsTrigger value="strategic" data-testid="tab-strategic">Strategic</TabsTrigger>
              <TabsTrigger value="operational" data-testid="tab-operational">Operational</TabsTrigger>
              <TabsTrigger value="financial" data-testid="tab-financial">Financial</TabsTrigger>
              <TabsTrigger value="human" data-testid="tab-human">Human Capital</TabsTrigger>
              <TabsTrigger value="all" data-testid="tab-all">All Dimensions</TabsTrigger>
            </TabsList>

            <TabsContent value={selectedDimension} className="space-y-6">
              {/* Analysis Tools Bar */}
              <div className="flex items-center justify-between bg-gray-900/50 p-4 rounded-lg border border-gray-700/50">
                <div className="flex items-center gap-4">
                  <Button variant="outline" size="sm">
                    <Filter className="h-4 w-4 mr-2" />
                    Filter
                  </Button>
                  <Button variant="outline" size="sm">
                    <Search className="h-4 w-4 mr-2" />
                    Deep Dive
                  </Button>
                  <Button variant="outline" size="sm">
                    <Eye className="h-4 w-4 mr-2" />
                    Visualize
                  </Button>
                </div>
                <div className="text-sm text-gray-400">
                  {filteredInsights.length} insights  Last updated: 2 minutes ago
                </div>
              </div>

              {/* Insights Grid */}
              <div className="space-y-6">
                {filteredInsights.map((insight) => (
                  <Card key={insight.id} className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm hover:border-purple-500/30 transition-colors" data-testid={`insight-${insight.id}`}>
                    <CardHeader>
                      <div className="flex items-start justify-between">
                        <div className="flex items-center gap-3">
                          <div className={`p-3 rounded-lg ${getColorClasses(insight.color)}`}>
                            {insight.icon}
                          </div>
                          <div>
                            <h3 className="text-xl font-semibold text-white">{insight.title}</h3>
                            <p className="text-gray-400 capitalize">{insight.dimension} Analysis  {insight.timeframe}</p>
                          </div>
                        </div>
                        <div className="flex flex-col gap-2">
                          <Badge variant="outline" className={getImpactColor(insight.impact)}>
                            {insight.impact.toUpperCase()} IMPACT
                          </Badge>
                          <div className="text-right">
                            <div className="text-sm text-gray-400">Confidence</div>
                            <div className="text-lg font-bold text-white">{insight.confidence}%</div>
                          </div>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent className="space-y-6">
                      <p className="text-gray-300">{insight.description}</p>
                      
                      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                          <h4 className="font-semibold text-white mb-3 flex items-center gap-2">
                            <Lightbulb className="h-4 w-4 text-yellow-400" />
                            Key Insights
                          </h4>
                          <ul className="space-y-2">
                            {insight.insights.map((item, index) => (
                              <li key={index} className="flex items-start gap-2 text-sm text-gray-300">
                                <div className="w-1.5 h-1.5 bg-purple-400 rounded-full mt-2 flex-shrink-0"></div>
                                {item}
                              </li>
                            ))}
                          </ul>
                        </div>
                        
                        <div>
                          <h4 className="font-semibold text-white mb-3 flex items-center gap-2">
                            <Target className="h-4 w-4 text-green-400" />
                            Strategic Recommendations
                          </h4>
                          <ul className="space-y-2">
                            {insight.recommendations.map((item, index) => (
                              <li key={index} className="flex items-start gap-2 text-sm text-gray-300">
                                <div className="w-1.5 h-1.5 bg-green-400 rounded-full mt-2 flex-shrink-0"></div>
                                {item}
                              </li>
                            ))}
                          </ul>
                        </div>
                      </div>

                      <div className="flex gap-3 pt-4 border-t border-gray-700/50">
                        <Button size="sm" variant="outline" className="flex-1">
                          <Eye className="h-4 w-4 mr-2" />
                          Deep Dive Analysis
                        </Button>
                        <Button size="sm" variant="outline" className="flex-1">
                          <BarChart3 className="h-4 w-4 mr-2" />
                          View Data
                        </Button>
                        <Button size="sm" className="flex-1 bg-purple-600 hover:bg-purple-700">
                          <Download className="h-4 w-4 mr-2" />
                          Export Report
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>

              {/* AI Summary */}
              <Card className="border-blue-500/30 bg-blue-950/30 backdrop-blur-sm">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-blue-300">
                    <Brain className="h-5 w-5" />
                    Cross-Dimensional AI Summary
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="p-4 bg-purple-950/30 rounded-lg border border-purple-500/30">
                      <p className="text-purple-300 font-medium mb-2">Strategic Convergence</p>
                      <p className="text-purple-200 text-sm">Market positioning and financial modeling show 87% alignment, suggesting coordinated execution will maximize impact.</p>
                    </div>
                    <div className="p-4 bg-green-950/30 rounded-lg border border-green-500/30">
                      <p className="text-green-300 font-medium mb-2">Optimization Opportunity</p>
                      <p className="text-green-200 text-sm">Operational efficiency improvements can fund 73% of strategic market expansion with neutral cash flow impact.</p>
                    </div>
                    <div className="p-4 bg-orange-950/30 rounded-lg border border-orange-500/30">
                      <p className="text-orange-300 font-medium mb-2">Risk-Adjusted Prioritization</p>
                      <p className="text-orange-200 text-sm">Human capital investments show highest risk-adjusted returns and should be prioritized for Q2 execution.</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>
          </Tabs>
        </div>
      </div>
    </>
  );
}

========================================
FILE: client/src/pages/ProductTour.tsx
========================================
import { useState, useEffect, useCallback, useRef } from 'react';
import { useLocation } from 'wouter';
import { motion, AnimatePresence } from 'framer-motion';
import StandardNav from '@/components/layout/StandardNav';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { Card, CardContent } from '@/components/ui/card';
import {
  Play,
  Pause,
  SkipForward,
  SkipBack,
  Volume2,
  VolumeX,
  Maximize,
  X,
  ChevronRight,
  Clock,
  Users,
  Shield,
  Zap,
  Target,
  TrendingUp,
  AlertTriangle,
  CheckCircle2,
  BarChart3,
  Building2,
  Globe,
  ArrowRight,
  BookOpen,
  Radio,
  Activity,
  Brain,
  Lightbulb,
  Award,
  Timer,
  DollarSign,
  FileText,
  MessageSquare
} from 'lucide-react';

interface Scene {
  id: string;
  type: 'cinematic' | 'stats' | 'phase' | 'demo' | 'proof' | 'cta';
  duration: number;
  title?: string;
  subtitle?: string;
  narration: string;
  visual?: 'problem' | 'solution' | 'identify' | 'detect' | 'execute' | 'advance' | 'metrics' | 'comparison' | 'cta';
}

const TOUR_SCENES: Scene[] = [
  {
    id: 'intro',
    type: 'cinematic',
    duration: 6000,
    title: 'M',
    subtitle: 'Strategic Execution Operating System',
    narration: 'Welcome to M  the operating system that transforms how Fortune 1000 companies execute strategy.',
    visual: 'solution'
  },
  {
    id: 'problem-1',
    type: 'cinematic',
    duration: 7000,
    title: 'The Problem',
    subtitle: 'Strategic execution is broken',
    narration: 'Today, critical market signals take 72+ hours to reach decision-makers. Competitive threats go undetected until revenue is lost.',
    visual: 'problem'
  },
  {
    id: 'problem-2',
    type: 'stats',
    duration: 6000,
    narration: 'The cost of slow response: lost market share, revenue leakage, and reputation damage from reactive positioning.',
    visual: 'problem'
  },
  {
    id: 'solution',
    type: 'cinematic',
    duration: 6000,
    title: 'The Solution',
    subtitle: 'Compress 72 hours into 12 minutes',
    narration: 'M connects intelligence signals directly to pre-built playbooks, enabling coordinated response in minutes  not days.',
    visual: 'solution'
  },
  {
    id: 'phase-identify',
    type: 'phase',
    duration: 8000,
    title: 'IDENTIFY',
    subtitle: 'Build Your Depth Chart',
    narration: 'Build your strategic arsenal. 166 pre-built playbooks across 9 domains  ready to deploy instantly when needed.',
    visual: 'identify'
  },
  {
    id: 'phase-detect',
    type: 'phase',
    duration: 8000,
    title: 'DETECT',
    subtitle: 'Monitor Signals',
    narration: 'Human insight amplified by AI-powered pattern matching. We help you spot what mattersand ignore what doesn\'t.',
    visual: 'detect'
  },
  {
    id: 'phase-execute',
    type: 'phase',
    duration: 8000,
    title: 'EXECUTE',
    subtitle: 'Execute Response',
    narration: 'When signals fire, M orchestrates your entire organization. Stakeholders align in parallel, not sequence.',
    visual: 'execute'
  },
  {
    id: 'phase-advance',
    type: 'phase',
    duration: 7000,
    title: 'ADVANCE',
    subtitle: 'Review the Film',
    narration: 'Every execution feeds back into your playbooks. AI suggests refinements. Your organization gets smarter.',
    visual: 'advance'
  },
  {
    id: 'demo-intro',
    type: 'demo',
    duration: 6000,
    title: 'See It In Action',
    subtitle: 'Executive Simulation',
    narration: 'Experience M through the eyes of Sarah Chen, Chief Strategy Officer at Meridian Industries.',
    visual: 'execute'
  },
  {
    id: 'demo-signal',
    type: 'demo',
    duration: 7000,
    title: 'Critical Signal Detected',
    subtitle: 'Competitor Acquisition',
    narration: 'A competitor announces a major acquisition. M detects it instantly and recommends immediate response.',
    visual: 'detect'
  },
  {
    id: 'demo-response',
    type: 'demo',
    duration: 7000,
    title: 'Coordinated Response',
    subtitle: '6 Stakeholders, 12 Minutes',
    narration: 'One click activates your playbook. CFO, CMO, Legal, Ops, Sales  all moving in parallel.',
    visual: 'execute'
  },
  {
    id: 'proof',
    type: 'proof',
    duration: 8000,
    title: 'The Results',
    subtitle: '3,180x Faster Response',
    narration: 'What traditionally takes 72 hours, M coordinates in under 2 minutes. That\'s strategic velocity.',
    visual: 'metrics'
  },
  {
    id: 'comparison',
    type: 'proof',
    duration: 8000,
    title: 'Why M?',
    subtitle: 'The Only Closed-Loop Platform',
    narration: 'Unlike Palantir, Anaplan, or Dataminr  M connects signals to playbooks to execution to learning. One platform.',
    visual: 'comparison'
  },
  {
    id: 'cta',
    type: 'cta',
    duration: 10000,
    title: 'Ready to Transform Your Strategic Execution?',
    narration: 'Request a custom demo configured with your industry, competitive landscape, and strategic priorities.',
    visual: 'cta'
  }
];

function ProductTour() {
  const [, setLocation] = useLocation();
  const [currentSceneIndex, setCurrentSceneIndex] = useState(0);
  const [isPlaying, setIsPlaying] = useState(true);
  const [progress, setProgress] = useState(0);
  const [sceneProgress, setSceneProgress] = useState(0);
  const [isMuted, setIsMuted] = useState(false);
  const [showControls, setShowControls] = useState(true);
  const timerRef = useRef<NodeJS.Timeout | null>(null);
  const progressRef = useRef<NodeJS.Timeout | null>(null);

  const currentScene = TOUR_SCENES[currentSceneIndex];
  const totalDuration = TOUR_SCENES.reduce((acc, s) => acc + s.duration, 0);

  const clearTimers = useCallback(() => {
    if (timerRef.current) {
      clearTimeout(timerRef.current);
      timerRef.current = null;
    }
    if (progressRef.current) {
      clearInterval(progressRef.current);
      progressRef.current = null;
    }
  }, []);

  const goToNextScene = useCallback(() => {
    if (currentSceneIndex < TOUR_SCENES.length - 1) {
      setCurrentSceneIndex(prev => prev + 1);
      setSceneProgress(0);
    } else {
      setIsPlaying(false);
    }
  }, [currentSceneIndex]);

  const goToPrevScene = useCallback(() => {
    if (currentSceneIndex > 0) {
      setCurrentSceneIndex(prev => prev - 1);
      setSceneProgress(0);
    }
  }, [currentSceneIndex]);

  useEffect(() => {
    if (!isPlaying) {
      clearTimers();
      return;
    }

    const scene = TOUR_SCENES[currentSceneIndex];
    
    progressRef.current = setInterval(() => {
      setSceneProgress(prev => {
        const newProgress = prev + (100 / (scene.duration / 100));
        return Math.min(newProgress, 100);
      });
    }, 100);

    timerRef.current = setTimeout(() => {
      goToNextScene();
    }, scene.duration);

    return () => clearTimers();
  }, [isPlaying, currentSceneIndex, goToNextScene, clearTimers]);

  useEffect(() => {
    const completedDuration = TOUR_SCENES.slice(0, currentSceneIndex).reduce((acc, s) => acc + s.duration, 0);
    const currentSceneDuration = (sceneProgress / 100) * TOUR_SCENES[currentSceneIndex].duration;
    const totalProgress = ((completedDuration + currentSceneDuration) / totalDuration) * 100;
    setProgress(totalProgress);
  }, [currentSceneIndex, sceneProgress, totalDuration]);

  useEffect(() => {
    return () => clearTimers();
  }, [clearTimers]);

  const togglePlay = useCallback(() => {
    if (isPlaying) {
      clearTimers();
    }
    setIsPlaying(prev => !prev);
  }, [isPlaying, clearTimers]);

  const formatTime = (ms: number) => {
    const minutes = Math.floor(ms / 60000);
    const seconds = Math.floor((ms % 60000) / 1000);
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
  };

  const getCurrentTime = () => {
    const completedDuration = TOUR_SCENES.slice(0, currentSceneIndex).reduce((acc, s) => acc + s.duration, 0);
    const currentSceneDuration = (sceneProgress / 100) * TOUR_SCENES[currentSceneIndex].duration;
    return formatTime(completedDuration + currentSceneDuration);
  };

  const renderProblemVisual = () => (
    <div className="relative w-full h-full flex items-center justify-center">
      <div className="grid grid-cols-3 gap-8 max-w-4xl">
        <motion.div 
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.3 }}
          className="text-center"
        >
          <div className="w-24 h-24 mx-auto bg-red-500/20 rounded-full flex items-center justify-center mb-4">
            <Clock className="w-12 h-12 text-red-400" />
          </div>
          <p className="text-2xl font-bold text-red-400">72+ Hours</p>
          <p className="text-slate-400">Signal to Decision</p>
        </motion.div>
        <motion.div 
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.5 }}
          className="text-center"
        >
          <div className="w-24 h-24 mx-auto bg-orange-500/20 rounded-full flex items-center justify-center mb-4">
            <AlertTriangle className="w-12 h-12 text-orange-400" />
          </div>
          <p className="text-2xl font-bold text-orange-400">15+ Meetings</p>
          <p className="text-slate-400">To Align Stakeholders</p>
        </motion.div>
        <motion.div 
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.7 }}
          className="text-center"
        >
          <div className="w-24 h-24 mx-auto bg-yellow-500/20 rounded-full flex items-center justify-center mb-4">
            <TrendingUp className="w-12 h-12 text-yellow-400 rotate-180" />
          </div>
          <p className="text-2xl font-bold text-yellow-400">$10-50M</p>
          <p className="text-slate-400">Annual Revenue at Risk</p>
        </motion.div>
      </div>
    </div>
  );

  const renderSolutionVisual = () => (
    <div className="relative w-full h-full flex items-center justify-center">
      <motion.div 
        initial={{ scale: 0.8, opacity: 0 }}
        animate={{ scale: 1, opacity: 1 }}
        className="text-center"
      >
        <motion.div 
          className="w-32 h-32 mx-auto mb-8 bg-gradient-to-br from-blue-500 to-teal-500 rounded-2xl flex items-center justify-center"
          animate={{ 
            boxShadow: ['0 0 20px rgba(59, 130, 246, 0.5)', '0 0 60px rgba(59, 130, 246, 0.8)', '0 0 20px rgba(59, 130, 246, 0.5)']
          }}
          transition={{ duration: 2, repeat: Infinity }}
        >
          <span className="text-6xl font-bold text-white">M</span>
        </motion.div>
        <div className="flex items-center justify-center gap-8 mt-8">
          <motion.div 
            initial={{ x: -50, opacity: 0 }}
            animate={{ x: 0, opacity: 1 }}
            transition={{ delay: 0.5 }}
            className="text-center"
          >
            <p className="text-4xl font-bold text-blue-400">12</p>
            <p className="text-slate-400">Minutes</p>
          </motion.div>
          <motion.div
            initial={{ scale: 0 }}
            animate={{ scale: 1 }}
            transition={{ delay: 0.7 }}
          >
            <Zap className="w-12 h-12 text-teal-400" />
          </motion.div>
          <motion.div 
            initial={{ x: 50, opacity: 0 }}
            animate={{ x: 0, opacity: 1 }}
            transition={{ delay: 0.9 }}
            className="text-center"
          >
            <p className="text-4xl font-bold text-teal-400">166</p>
            <p className="text-slate-400">Playbooks</p>
          </motion.div>
        </div>
      </motion.div>
    </div>
  );

  const renderPhaseVisual = (phase: string) => {
    const phaseConfig: Record<string, { icon: typeof Shield; color: string; items: string[] }> = {
      prepare: {
        icon: BookOpen,
        color: 'blue',
        items: ['166 Strategic Playbooks', '9 Strategic Domains', 'Pre-approved Budgets', 'Stakeholder Assignments']
      },
      monitor: {
        icon: Radio,
        color: 'purple',
        items: ['16 Signal Categories', '92 Data Points', '24/7 AI Monitoring', 'Real-time Alerts']
      },
      execute: {
        icon: Zap,
        color: 'teal',
        items: ['12-Minute Coordination', 'Parallel Execution', 'Live Progress Tracking', 'Automatic Notifications']
      },
      learn: {
        icon: Brain,
        color: 'amber',
        items: ['Outcome Analysis', 'AI Recommendations', 'Playbook Refinement', 'Future Readiness Index']
      }
    };

    const config = phaseConfig[phase] || phaseConfig.prepare;
    const Icon = config.icon;

    return (
      <div className="relative w-full h-full flex items-center justify-center">
        <div className="flex items-center gap-16 max-w-5xl">
          <motion.div
            initial={{ scale: 0, rotate: -180 }}
            animate={{ scale: 1, rotate: 0 }}
            transition={{ type: 'spring', duration: 0.8 }}
            className={`w-48 h-48 rounded-full bg-${config.color}-500/20 flex items-center justify-center`}
            style={{ backgroundColor: `rgba(var(--${config.color}-500), 0.2)` }}
          >
            <div className={`w-32 h-32 rounded-full bg-gradient-to-br from-${config.color}-400 to-${config.color}-600 flex items-center justify-center`}>
              <Icon className="w-16 h-16 text-white" />
            </div>
          </motion.div>
          
          <div className="flex-1">
            <div className="grid grid-cols-2 gap-4">
              {config.items.map((item, index) => (
                <motion.div
                  key={item}
                  initial={{ x: 50, opacity: 0 }}
                  animate={{ x: 0, opacity: 1 }}
                  transition={{ delay: 0.3 + index * 0.15 }}
                  className="flex items-center gap-3 bg-slate-800/50 rounded-lg p-4"
                >
                  <CheckCircle2 className={`w-5 h-5 text-${config.color}-400`} />
                  <span className="text-white font-medium">{item}</span>
                </motion.div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  };

  const renderDemoVisual = () => (
    <div className="relative w-full h-full flex items-center justify-center">
      <motion.div 
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        className="w-full max-w-4xl"
      >
        <Card className="bg-slate-800/80 border-slate-700 overflow-hidden">
          <div className="bg-gradient-to-r from-blue-600 to-teal-500 p-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                  <span className="font-bold text-white">SC</span>
                </div>
                <div>
                  <p className="font-semibold text-white">Sarah Chen</p>
                  <p className="text-sm text-white/80">Chief Strategy Officer</p>
                </div>
              </div>
              <Badge className="bg-red-500 text-white animate-pulse">
                <AlertTriangle className="w-3 h-3 mr-1" />
                CRITICAL SIGNAL
              </Badge>
            </div>
          </div>
          <CardContent className="p-6">
            <div className="space-y-4">
              <div className="flex items-start gap-4 p-4 bg-red-500/10 rounded-lg border border-red-500/30">
                <AlertTriangle className="w-8 h-8 text-red-400 flex-shrink-0" />
                <div>
                  <p className="font-semibold text-white">Competitor Acquisition Announced</p>
                  <p className="text-slate-400 text-sm">TitanTech acquires Precision Components for $890M</p>
                </div>
              </div>
              
              <div className="grid grid-cols-3 gap-4">
                {['CFO', 'CMO', 'Legal', 'Ops', 'Sales', 'Strategy'].map((role, i) => (
                  <motion.div
                    key={role}
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    transition={{ delay: 1 + i * 0.1 }}
                    className="flex items-center gap-2 bg-slate-700/50 rounded-lg p-3"
                  >
                    <div className="w-8 h-8 bg-teal-500/20 rounded-full flex items-center justify-center">
                      <CheckCircle2 className="w-4 h-4 text-teal-400" />
                    </div>
                    <span className="text-sm text-white">{role}</span>
                  </motion.div>
                ))}
              </div>
            </div>
          </CardContent>
        </Card>
      </motion.div>
    </div>
  );

  const renderMetricsVisual = () => (
    <div className="relative w-full h-full flex items-center justify-center">
      <div className="grid grid-cols-3 gap-12 max-w-4xl">
        <motion.div
          initial={{ y: 50, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.3 }}
          className="text-center"
        >
          <div className="w-32 h-32 mx-auto bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mb-4">
            <Timer className="w-16 h-16 text-white" />
          </div>
          <p className="text-5xl font-bold text-teal-400">3,180x</p>
          <p className="text-slate-400 mt-2">Faster Response</p>
        </motion.div>
        <motion.div
          initial={{ y: 50, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.5 }}
          className="text-center"
        >
          <div className="w-32 h-32 mx-auto bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mb-4">
            <Users className="w-16 h-16 text-white" />
          </div>
          <p className="text-5xl font-bold text-blue-400">6</p>
          <p className="text-slate-400 mt-2">Stakeholders Aligned</p>
        </motion.div>
        <motion.div
          initial={{ y: 50, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ delay: 0.7 }}
          className="text-center"
        >
          <div className="w-32 h-32 mx-auto bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mb-4">
            <DollarSign className="w-16 h-16 text-white" />
          </div>
          <p className="text-5xl font-bold text-purple-400">$50M+</p>
          <p className="text-slate-400 mt-2">Revenue Protected</p>
        </motion.div>
      </div>
    </div>
  );

  const renderComparisonVisual = () => (
    <div className="relative w-full h-full flex items-center justify-center">
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        className="w-full max-w-4xl"
      >
        <div className="grid grid-cols-4 gap-4">
          <div className="col-span-1"></div>
          <motion.div initial={{ y: -20, opacity: 0 }} animate={{ y: 0, opacity: 1 }} transition={{ delay: 0.2 }} className="text-center p-3 bg-slate-800 rounded-lg">
            <p className="text-slate-400 text-sm">Palantir</p>
          </motion.div>
          <motion.div initial={{ y: -20, opacity: 0 }} animate={{ y: 0, opacity: 1 }} transition={{ delay: 0.3 }} className="text-center p-3 bg-slate-800 rounded-lg">
            <p className="text-slate-400 text-sm">Anaplan</p>
          </motion.div>
          <motion.div initial={{ y: -20, opacity: 0 }} animate={{ y: 0, opacity: 1 }} transition={{ delay: 0.4 }} className="text-center p-3 bg-gradient-to-r from-blue-600 to-teal-500 rounded-lg">
            <p className="text-white font-bold text-sm">M</p>
          </motion.div>
          
          {[
            { label: 'Signal Detection', scores: ['Custom Build', 'No', ' 16 Categories'] },
            { label: 'Pre-built Playbooks', scores: ['No', 'No', ' 166 Ready'] },
            { label: 'Execution Engine', scores: ['No', 'No', ' 12-Minute'] },
            { label: 'Closed-Loop Learning', scores: ['Manual', 'Manual', ' AI-Powered'] }
          ].map((row, i) => (
            <motion.div 
              key={row.label}
              initial={{ x: -20, opacity: 0 }}
              animate={{ x: 0, opacity: 1 }}
              transition={{ delay: 0.5 + i * 0.1 }}
              className="contents"
            >
              <div className="p-3 bg-slate-800/50 rounded-lg flex items-center">
                <p className="text-white text-sm">{row.label}</p>
              </div>
              {row.scores.map((score, j) => (
                <div key={j} className={`p-3 rounded-lg flex items-center justify-center ${j === 2 ? 'bg-teal-500/20' : 'bg-slate-800/30'}`}>
                  <p className={`text-sm ${j === 2 ? 'text-teal-400 font-medium' : 'text-slate-500'}`}>{score}</p>
                </div>
              ))}
            </motion.div>
          ))}
        </div>
      </motion.div>
    </div>
  );

  const renderCTAVisual = () => (
    <div className="relative w-full h-full flex items-center justify-center">
      <motion.div
        initial={{ scale: 0.9, opacity: 0 }}
        animate={{ scale: 1, opacity: 1 }}
        className="text-center max-w-2xl"
      >
        <motion.div 
          className="w-24 h-24 mx-auto mb-8 bg-gradient-to-br from-blue-500 to-teal-500 rounded-2xl flex items-center justify-center"
        >
          <span className="text-5xl font-bold text-white">M</span>
        </motion.div>
        <div className="space-y-6">
          <motion.div
            initial={{ y: 20, opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            transition={{ delay: 0.3 }}
          >
            <Button 
              size="lg" 
              className="bg-gradient-to-r from-blue-600 to-teal-500 hover:from-blue-700 hover:to-teal-600 text-white px-8 py-6 text-lg"
              onClick={() => setLocation('/executive-simulation')}
              data-testid="button-try-simulation"
            >
              <Play className="w-5 h-5 mr-2" />
              Try Executive Simulation
            </Button>
          </motion.div>
          <motion.div
            initial={{ y: 20, opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            transition={{ delay: 0.5 }}
            className="flex items-center justify-center gap-4"
          >
            <Button 
              variant="outline" 
              size="lg"
              onClick={() => setLocation('/scenario-library')}
              data-testid="button-explore-playbooks"
            >
              <BookOpen className="w-5 h-5 mr-2" />
              Explore 166 Playbooks
            </Button>
            <Button 
              variant="outline" 
              size="lg"
              onClick={() => setLocation('/foresight-radar')}
              data-testid="button-see-radar"
            >
              <Radio className="w-5 h-5 mr-2" />
              See Intelligence Radar
            </Button>
          </motion.div>
          <motion.p
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.7 }}
            className="text-slate-400 text-sm"
          >
            Request a custom demo configured for your industry
          </motion.p>
        </div>
      </motion.div>
    </div>
  );

  const renderVisual = () => {
    switch (currentScene.visual) {
      case 'problem':
        return renderProblemVisual();
      case 'solution':
        return renderSolutionVisual();
      case 'identify':
      case 'detect':
      case 'execute':
      case 'advance':
        return renderPhaseVisual(currentScene.visual);
      case 'metrics':
        return renderMetricsVisual();
      case 'comparison':
        return renderComparisonVisual();
      case 'cta':
        return renderCTAVisual();
      default:
        return renderDemoVisual();
    }
  };

  return (
    <div 
      className="fixed inset-0 bg-slate-950 overflow-hidden"
      onMouseMove={() => setShowControls(true)}
      data-testid="page-product-tour"
    >
      <div className="absolute inset-0 bg-gradient-to-br from-slate-900 via-slate-950 to-black" />
      
      <div className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
        <div className="absolute top-1/4 left-1/4 w-96 h-96 bg-blue-500/5 rounded-full blur-3xl" />
        <div className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-teal-500/5 rounded-full blur-3xl" />
      </div>

      <Button
        variant="ghost"
        size="icon"
        className="absolute top-4 right-4 z-50 text-white/70 hover:text-white hover:bg-white/10"
        onClick={() => setLocation('/')}
        data-testid="button-close-tour"
      >
        <X className="w-6 h-6" />
      </Button>

      <AnimatePresence mode="wait">
        <motion.div
          key={currentScene.id}
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          transition={{ duration: 0.5 }}
          className="absolute inset-0 flex flex-col items-center justify-center px-8"
        >
          {currentScene.title && (
            <motion.div
              initial={{ y: -30, opacity: 0 }}
              animate={{ y: 0, opacity: 1 }}
              transition={{ delay: 0.2 }}
              className="text-center mb-8"
            >
              <Badge 
                className={`mb-4 ${
                  currentScene.visual === 'problem' ? 'bg-red-500/20 text-red-400' :
                  currentScene.type === 'phase' ? 'bg-blue-500/20 text-blue-400' :
                  'bg-teal-500/20 text-teal-400'
                }`}
              >
                Scene {currentSceneIndex + 1} of {TOUR_SCENES.length}
              </Badge>
              <h1 className="text-5xl md:text-7xl font-bold text-white mb-4">
                {currentScene.title}
              </h1>
              {currentScene.subtitle && (
                <p className="text-2xl text-slate-400">{currentScene.subtitle}</p>
              )}
            </motion.div>
          )}

          <div className="flex-1 w-full max-w-6xl flex items-center justify-center">
            {renderVisual()}
          </div>

          <motion.div
            initial={{ y: 30, opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            transition={{ delay: 0.4 }}
            className="mb-32 max-w-3xl text-center"
          >
            <p className="text-xl md:text-2xl text-slate-300 leading-relaxed">
              {currentScene.narration}
            </p>
          </motion.div>
        </motion.div>
      </AnimatePresence>

      <motion.div
        initial={{ y: 100 }}
        animate={{ y: showControls ? 0 : 100 }}
        className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 to-transparent p-6"
      >
        <div className="max-w-4xl mx-auto">
          <div className="mb-4">
            <Progress value={progress} className="h-1 bg-slate-700" />
          </div>
          
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <Button
                variant="ghost"
                size="icon"
                onClick={goToPrevScene}
                disabled={currentSceneIndex === 0}
                className="text-white/70 hover:text-white hover:bg-white/10 disabled:opacity-30"
                data-testid="button-prev-scene"
              >
                <SkipBack className="w-5 h-5" />
              </Button>
              
              <Button
                variant="ghost"
                size="icon"
                onClick={togglePlay}
                className="w-12 h-12 text-white hover:bg-white/10 rounded-full"
                data-testid="button-play-pause"
              >
                {isPlaying ? <Pause className="w-6 h-6" /> : <Play className="w-6 h-6" />}
              </Button>
              
              <Button
                variant="ghost"
                size="icon"
                onClick={goToNextScene}
                disabled={currentSceneIndex === TOUR_SCENES.length - 1}
                className="text-white/70 hover:text-white hover:bg-white/10 disabled:opacity-30"
                data-testid="button-next-scene"
              >
                <SkipForward className="w-5 h-5" />
              </Button>
              
              <Button
                variant="ghost"
                size="icon"
                onClick={() => setIsMuted(!isMuted)}
                className="text-white/70 hover:text-white hover:bg-white/10"
                data-testid="button-mute"
              >
                {isMuted ? <VolumeX className="w-5 h-5" /> : <Volume2 className="w-5 h-5" />}
              </Button>
            </div>

            <div className="flex items-center gap-2 text-white/70 text-sm">
              <span>{getCurrentTime()}</span>
              <span>/</span>
              <span>{formatTime(totalDuration)}</span>
            </div>

            <div className="flex items-center gap-2">
              {TOUR_SCENES.map((scene, index) => (
                <button
                  key={scene.id}
                  onClick={() => {
                    setCurrentSceneIndex(index);
                    setSceneProgress(0);
                  }}
                  className={`w-2 h-2 rounded-full transition-all ${
                    index === currentSceneIndex 
                      ? 'bg-teal-400 w-6' 
                      : index < currentSceneIndex 
                        ? 'bg-teal-400/50' 
                        : 'bg-slate-600'
                  }`}
                  data-testid={`button-scene-${index}`}
                />
              ))}
            </div>
          </div>
        </div>
      </motion.div>
    </div>
  );
}

// Wrap component with navigation
const ProductTourWithNav = () => {
  return (
    <div className="flex flex-col min-h-screen">
      <StandardNav />
      <div className="flex-1 bg-slate-950">
        <ProductTour />
      </div>
    </div>
  );
};

export default ProductTourWithNav;


========================================
FILE: client/src/pages/PulseIntelligence.tsx
========================================
import { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { useQuery } from '@tanstack/react-query';
import { Link } from 'wouter';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';
import { 
  Activity, 
  TrendingUp, 
  Users, 
  Target,
  AlertTriangle,
  CheckCircle,
  Clock,
  Zap,
  Brain,
  BarChart3,
  ArrowLeft,
  Home
} from 'lucide-react';

export default function PulseIntelligence() {
  const [selectedMetric, setSelectedMetric] = useState('overview');

  // Real-time pulse metrics
  const { data: pulseMetrics } = useQuery({
    queryKey: ['/api/dashboard/metrics'],
    refetchInterval: 30000, // Real-time updates every 30s
  });

  const healthMetrics = [
    {
      id: 'organizational-health',
      name: 'Organizational Health',
      value: 87.6,
      change: +2.4,
      status: 'excellent',
      description: 'Overall organizational resilience and performance',
      icon: <Activity className="h-5 w-5" />,
      color: 'text-emerald-500',
      bgColor: 'bg-emerald-500/10'
    },
    {
      id: 'agility-score',
      name: 'Enterprise Agility',
      value: 94.2,
      change: +1.6,
      status: 'excellent', 
      description: 'Ability to adapt and respond to market changes',
      icon: <Zap className="h-5 w-5" />,
      color: 'text-blue-500',
      bgColor: 'bg-blue-500/10'
    },
    {
      id: 'risk-exposure',
      name: 'Risk Exposure',
      value: 23.1,
      change: -4.2,
      status: 'good',
      description: 'Current organizational risk level and vulnerabilities',
      icon: <AlertTriangle className="h-5 w-5" />,
      color: 'text-orange-500',
      bgColor: 'bg-orange-500/10'
    },
    {
      id: 'innovation-index',
      name: 'Innovation Index',
      value: 91.4,
      change: +3.2,
      status: 'excellent',
      description: 'Innovation capability and breakthrough potential',
      icon: <Brain className="h-5 w-5" />,
      color: 'text-purple-500',
      bgColor: 'bg-purple-500/10'
    }
  ];

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'excellent': return 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30';
      case 'good': return 'bg-blue-500/20 text-blue-400 border-blue-500/30';
      case 'warning': return 'bg-orange-500/20 text-orange-400 border-orange-500/30';
      case 'critical': return 'bg-red-500/20 text-red-400 border-red-500/30';
      default: return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
    }
  };

  return (
    <div className="h-full bg-transparent p-4" data-testid="pulse-intelligence">
        <div className="w-full max-w-none mx-auto space-y-4 h-full overflow-hidden flex flex-col">
          
          {/* Breadcrumb Navigation */}
          <div className="mb-2 flex-shrink-0">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>AI Intelligence</span>
              <span>/</span>
              <span className="text-white">Pulse Intelligence</span>
            </div>
          </div>

          {/* ROI Value Context - Tier 2 Enhancement */}
          <Card className="mb-4 bg-emerald-50 dark:bg-emerald-950/20 border-emerald-300 dark:border-emerald-700 flex-shrink-0" data-testid="pulse-roi-context">
            <CardContent className="p-3 flex items-center gap-3">
              <div className="p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg">
                <TrendingUp className="h-5 w-5 text-emerald-600" />
              </div>
              <div>
                <div className="font-semibold text-emerald-900 dark:text-emerald-100 text-sm">How Pulse Saves You Money</div>
                <div className="text-xs text-emerald-700 dark:text-emerald-300">Replaces $120K/year consulting fees for market intelligence with real-time AI monitoring</div>
              </div>
            </CardContent>
          </Card>

          {/* Header */}
          <div className="bg-gradient-to-r from-emerald-600 to-teal-600 text-white p-4 rounded-lg flex-shrink-0">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <Activity className="h-10 w-10" />
                <div>
                  <h1 className="text-3xl font-bold" data-testid="pulse-title">
                    Pulse Intelligence
                  </h1>
                  <p className="text-emerald-100">Real-time organizational health and performance analytics</p>
                </div>
              </div>
              <div className="flex items-center gap-3">
                <OnboardingTrigger pageId="pulse-intelligence" autoStart={true} className="bg-white/10 border-white/30 text-white hover:bg-white/20" />
                <Link to="/">
                  <Button variant="secondary" className="bg-emerald-700 hover:bg-emerald-800 text-emerald-100 border-emerald-600" data-testid="back-to-dashboard">
                    <ArrowLeft className="h-4 w-4 mr-2" />
                    Dashboard
                  </Button>
                </Link>
                <Badge variant="secondary" className="bg-emerald-700 text-emerald-100 border-emerald-600" data-testid="live-status">
                  <div className="w-2 h-2 bg-emerald-300 rounded-full mr-2 animate-pulse"></div>
                  LIVE MONITORING
                </Badge>
              </div>
            </div>
          </div>

          <Tabs value={selectedMetric} onValueChange={setSelectedMetric} className="w-full flex-1 flex flex-col min-h-0">
            <TabsList className="grid w-full grid-cols-4 flex-shrink-0">
              <TabsTrigger value="overview" data-testid="tab-overview">Overview</TabsTrigger>
              <TabsTrigger value="health" data-testid="tab-health">Health Metrics</TabsTrigger>
              <TabsTrigger value="trends" data-testid="tab-trends">Trend Analysis</TabsTrigger>
              <TabsTrigger value="alerts" data-testid="tab-alerts">AI Alerts</TabsTrigger>
            </TabsList>

            <TabsContent value="overview" className="flex-1 overflow-y-auto p-4 space-y-4">
              {/* Real-time Metrics Grid */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                {healthMetrics.map((metric) => (
                  <Card key={metric.id} className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm" data-testid={metric.id === 'organizational-health' ? 'organizational-health-metric' : `metric-${metric.id}`}>
                    <CardHeader className="pb-2">
                      <div className="flex items-center justify-between">
                        <div className={`p-2 rounded-lg ${metric.bgColor}`}>
                          <div className={metric.color}>
                            {metric.icon}
                          </div>
                        </div>
                        <Badge variant="outline" className={getStatusColor(metric.status)}>
                          {metric.status.toUpperCase()}
                        </Badge>
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-1">
                        <div className="flex items-center justify-between">
                          <h3 className="font-semibold text-white">{metric.name}</h3>
                          <span className={`text-sm font-medium ${metric.change >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                            {metric.change >= 0 ? '+' : ''}{metric.change}%
                          </span>
                        </div>
                        <div className="text-2xl font-bold text-white">{metric.value}%</div>
                        <Progress value={metric.value} className="h-2" />
                        <p className="text-xs text-gray-400">{metric.description}</p>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>

              {/* Key Insights */}
              <Card className="border-blue-500/30 bg-blue-950/30 backdrop-blur-sm">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-blue-300">
                    <Brain className="h-5 w-5" />
                    AI-Generated Insights
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="flex items-start gap-3 p-4 bg-emerald-950/30 rounded-lg border border-emerald-500/30">
                      <CheckCircle className="h-5 w-5 text-emerald-400 mt-0.5" />
                      <div>
                        <p className="text-emerald-300 font-medium">Strong Performance Trajectory</p>
                        <p className="text-emerald-200 text-sm">Your organization shows excellent adaptability with 94.2% agility score, indicating strong resilience to market changes.</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3 p-4 bg-blue-950/30 rounded-lg border border-blue-500/30">
                      <TrendingUp className="h-5 w-5 text-blue-400 mt-0.5" />
                      <div>
                        <p className="text-blue-300 font-medium">Innovation Pipeline Accelerating</p>
                        <p className="text-blue-200 text-sm">91.4% innovation index with +3.2% growth suggests breakthrough opportunities emerging in Q4.</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3 p-4 bg-orange-950/30 rounded-lg border border-orange-500/30">
                      <AlertTriangle className="h-5 w-5 text-orange-400 mt-0.5" />
                      <div>
                        <p className="text-orange-300 font-medium">Risk Mitigation Success</p>
                        <p className="text-orange-200 text-sm">Risk exposure decreased by 4.2%, indicating effective crisis preparedness and proactive management.</p>
                      </div>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            <TabsContent value="health" className="space-y-6">
              <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                <CardHeader>
                  <CardTitle className="text-white">Detailed Health Analysis</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-center py-12">
                    <BarChart3 className="h-16 w-16 text-gray-400 mx-auto mb-4" />
                    <p className="text-gray-400">Detailed health metrics and predictive analysis coming soon</p>
                    <p className="text-sm text-gray-500 mt-2">AI-powered health forecasting and recommendations</p>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            <TabsContent value="trends" className="space-y-6">
              <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                <CardHeader>
                  <CardTitle className="text-white">Trend Analysis & Predictions</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-center py-12">
                    <TrendingUp className="h-16 w-16 text-gray-400 mx-auto mb-4" />
                    <p className="text-gray-400">Historical trends and predictive analytics</p>
                    <p className="text-sm text-gray-500 mt-2">Multi-dimensional trend analysis with AI predictions</p>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            <TabsContent value="alerts" className="space-y-6">
              <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                <CardHeader>
                  <CardTitle className="text-white">AI-Powered Alerts & Recommendations</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-center py-12">
                    <Brain className="h-16 w-16 text-gray-400 mx-auto mb-4" />
                    <p className="text-gray-400">Intelligent alerts and proactive recommendations</p>
                    <p className="text-sm text-gray-500 mt-2">AI-driven insights for executive decision making</p>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>
          </Tabs>
        </div>
    </div>
  );
}

========================================
FILE: client/src/pages/RealTimeCollaboration.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import PageLayout from '@/components/layout/PageLayout';
import { 
  Users, 
  MessageSquare, 
  Video, 
  Share, 
  Bell,
  Clock,
  CheckCircle,
  AlertTriangle,
  Activity,
  FileText,
  Calendar,
  Target,
  Zap,
  Edit,
  Send,
  Phone,
  Monitor,
  Globe,
  Link,
  Settings,
  Plus,
  Search,
  Filter
} from 'lucide-react';

interface CollaborationSession {
  id: string;
  title: string;
  type: 'meeting' | 'planning' | 'crisis' | 'review';
  status: 'active' | 'scheduled' | 'completed';
  participants: {
    id: string;
    name: string;
    role: string;
    avatar?: string;
    status: 'online' | 'offline' | 'busy';
  }[];
  startTime: string;
  duration: string;
  description: string;
  agenda?: string[];
  decisions?: string[];
  actionItems?: {
    id: string;
    description: string;
    assignee: string;
    dueDate: string;
    status: 'pending' | 'in-progress' | 'completed';
  }[];
}

interface LiveUpdate {
  id: string;
  type: 'message' | 'decision' | 'action' | 'status' | 'alert';
  title: string;
  content: string;
  user: string;
  timestamp: string;
  priority: 'low' | 'medium' | 'high' | 'urgent';
  relatedTo?: string;
}

interface TeamMember {
  id: string;
  name: string;
  role: string;
  department: string;
  status: 'online' | 'offline' | 'busy' | 'away';
  avatar?: string;
  currentActivity?: string;
  timezone: string;
}

export default function RealTimeCollaboration() {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [collaborationSessions, setCollaborationSessions] = useState<CollaborationSession[]>([]);
  const [liveUpdates, setLiveUpdates] = useState<LiveUpdate[]>([]);
  const [teamMembers, setTeamMembers] = useState<TeamMember[]>([]);
  const [newMessage, setNewMessage] = useState('');
  const [activeUsers, setActiveUsers] = useState(24);

  useEffect(() => {
    // Initialize collaboration data
    const sessions: CollaborationSession[] = [
      {
        id: 'session-001',
        title: 'Q2 Strategic Planning Review',
        type: 'planning',
        status: 'active',
        participants: [
          { id: '1', name: 'Chief Executive', role: 'CEO', status: 'online' },
          { id: '2', name: 'Chief Technology', role: 'CTO', status: 'online' },
          { id: '3', name: 'VP Strategy', role: 'VP Strategy', status: 'online' },
          { id: '4', name: 'Chief Financial', role: 'CFO', status: 'busy' }
        ],
        startTime: '2024-02-20 14:00',
        duration: '90 minutes',
        description: 'Review Q2 strategic initiatives and budget allocation decisions',
        agenda: [
          'Digital transformation progress review',
          'Market expansion strategy approval',
          'Budget reallocation for new initiatives',
          'Risk assessment and mitigation plans'
        ],
        decisions: [
          'Approved $2.5M budget for digital transformation Phase 2',
          'Greenlit market expansion into APAC region',
          'Established Q2 performance targets'
        ],
        actionItems: [
          {
            id: 'ai-001',
            description: 'Finalize APAC market entry timeline',
            assignee: 'VP Strategy',
            dueDate: '2024-02-25',
            status: 'in-progress'
          },
          {
            id: 'ai-002',
            description: 'Update digital transformation roadmap',
            assignee: 'Chief Technology Officer',
            dueDate: '2024-02-22',
            status: 'pending'
          }
        ]
      },
      {
        id: 'session-002',
        title: 'Crisis Response Coordination',
        type: 'crisis',
        status: 'active',
        participants: [
          { id: '5', name: 'Chief Operations', role: 'COO', status: 'online' },
          { id: '6', name: 'Communications Lead', role: 'Head of Communications', status: 'online' },
          { id: '7', name: 'General Counsel', role: 'Legal Counsel', status: 'online' }
        ],
        startTime: '2024-02-20 15:30',
        duration: '60 minutes',
        description: 'Coordinate response to supply chain disruption',
        agenda: [
          'Impact assessment review',
          'Communication strategy approval',
          'Alternative supplier activation',
          'Customer notification plan'
        ]
      },
      {
        id: 'session-003',
        title: 'Innovation Pipeline Review',
        type: 'review',
        status: 'scheduled',
        participants: [
          { id: '8', name: 'VP Innovation', role: 'VP Innovation', status: 'offline' },
          { id: '9', name: 'R&D Director', role: 'R&D Director', status: 'offline' }
        ],
        startTime: '2024-02-21 10:00',
        duration: '120 minutes',
        description: 'Monthly review of innovation projects and breakthrough opportunities'
      }
    ];

    const updates: LiveUpdate[] = [
      {
        id: 'update-001',
        type: 'decision',
        title: 'Strategic Decision Made',
        content: 'Approved $2.5M budget allocation for digital transformation Phase 2',
        user: 'Chief Executive Officer',
        timestamp: new Date(Date.now() - 300000).toISOString(),
        priority: 'high',
        relatedTo: 'Q2 Strategic Planning'
      },
      {
        id: 'update-002',
        type: 'action',
        title: 'Action Item Created',
        content: 'Finalize APAC market entry timeline assigned to VP Strategy',
        user: 'System',
        timestamp: new Date(Date.now() - 600000).toISOString(),
        priority: 'medium',
        relatedTo: 'Q2 Strategic Planning'
      },
      {
        id: 'update-003',
        type: 'alert',
        title: 'Crisis Response Activated',
        content: 'Supply chain disruption protocol initiated by Operations team',
        user: 'Chief Operations Officer',
        timestamp: new Date(Date.now() - 900000).toISOString(),
        priority: 'urgent',
        relatedTo: 'Crisis Response'
      },
      {
        id: 'update-004',
        type: 'message',
        title: 'Team Communication',
        content: 'Digital transformation metrics show 45% completion rate - on track for Q2 targets',
        user: 'Chief Technology Officer',
        timestamp: new Date(Date.now() - 1200000).toISOString(),
        priority: 'low',
        relatedTo: 'Digital Transformation'
      }
    ];

    const team: TeamMember[] = [
      {
        id: 'tm-001',
        name: 'Chief Executive',
        role: 'Chief Executive Officer',
        department: 'Executive',
        status: 'online',
        currentActivity: 'Strategic Planning Session',
        timezone: 'PST'
      },
      {
        id: 'tm-002',
        name: 'Chief Technology',
        role: 'Chief Technology Officer',
        department: 'Technology',
        status: 'online',
        currentActivity: 'Digital Transformation Review',
        timezone: 'PST'
      },
      {
        id: 'tm-003',
        name: 'VP Strategy',
        role: 'VP Strategy',
        department: 'Strategy',
        status: 'busy',
        currentActivity: 'APAC Market Analysis',
        timezone: 'EST'
      },
      {
        id: 'tm-004',
        name: 'Chief Financial',
        role: 'Chief Financial Officer',
        department: 'Finance',
        status: 'online',
        currentActivity: 'Budget Review',
        timezone: 'CST'
      },
      {
        id: 'tm-005',
        name: 'Chief Operations',
        role: 'Chief Operating Officer',
        department: 'Operations',
        status: 'online',
        currentActivity: 'Crisis Response Coordination',
        timezone: 'PST'
      }
    ];

    setCollaborationSessions(sessions);
    setLiveUpdates(updates);
    setTeamMembers(team);

    // Simulate real-time updates
    const interval = setInterval(() => {
      setActiveUsers(prev => prev + Math.floor(Math.random() * 6 - 3));
      
      // Add random live update
      if (Math.random() > 0.7) {
        const newUpdate: LiveUpdate = {
          id: `update-${Date.now()}`,
          type: ['message', 'action', 'status'][Math.floor(Math.random() * 3)] as any,
          title: 'Live Update',
          content: 'Real-time collaboration activity detected',
          user: 'System',
          timestamp: new Date().toISOString(),
          priority: ['low', 'medium'][Math.floor(Math.random() * 2)] as any
        };
        
        setLiveUpdates(prev => [newUpdate, ...prev.slice(0, 9)]);
      }
    }, 15000);

    return () => clearInterval(interval);
  }, []);

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'online': return 'bg-emerald-500';
      case 'busy': return 'bg-amber-500';
      case 'away': return 'bg-blue-500';
      case 'offline': return 'bg-slate-500';
      default: return 'bg-slate-500';
    }
  };

  const getTypeColor = (type: string) => {
    switch (type) {
      case 'planning': return 'bg-blue-500/20 text-blue-300 border-blue-500/30';
      case 'crisis': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'meeting': return 'bg-purple-500/20 text-purple-300 border-purple-500/30';
      case 'review': return 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'urgent': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'high': return 'bg-orange-500/20 text-orange-300 border-orange-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30';
      case 'low': return 'bg-green-500/20 text-green-300 border-green-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const sendMessage = () => {
    if (newMessage.trim()) {
      const message: LiveUpdate = {
        id: `msg-${Date.now()}`,
        type: 'message',
        title: 'Team Message',
        content: newMessage,
        user: 'You',
        timestamp: new Date().toISOString(),
        priority: 'medium'
      };
      
      setLiveUpdates(prev => [message, ...prev]);
      setNewMessage('');
    }
  };

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-y-auto p-8 space-y-8">
        
        {/* Collaboration Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-white mb-2">Real-Time Collaboration Center</h1>
            <p className="text-slate-300">Enterprise-grade team coordination and live decision management</p>
          </div>
          <div className="flex items-center gap-4">
            <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">
              <Activity className="w-4 h-4 mr-2" />
              {activeUsers} Active Users
            </Badge>
            <Button className="bg-blue-600 hover:bg-blue-700">
              <Video className="w-4 h-4 mr-2" />
              Start Session
            </Button>
          </div>
        </div>

        {/* Live Status Overview */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Active Sessions</h3>
                <Users className="h-5 w-5 text-blue-400" />
              </div>
              <div className="text-2xl font-bold text-white">{collaborationSessions.filter(s => s.status === 'active').length}</div>
              <div className="text-sm text-slate-400">Live collaboration</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Team Online</h3>
                <Activity className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{teamMembers.filter(m => m.status === 'online').length}</div>
              <div className="text-sm text-slate-400">Members available</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Live Updates</h3>
                <Bell className="h-5 w-5 text-purple-400" />
              </div>
              <div className="text-2xl font-bold text-white">{liveUpdates.length}</div>
              <div className="text-sm text-slate-400">Recent activity</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Decisions Today</h3>
                <CheckCircle className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">7</div>
              <div className="text-sm text-slate-400">Executive decisions</div>
            </CardContent>
          </Card>
        </div>

        {/* Main Collaboration Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="bg-slate-800/50 border border-slate-700/50">
            <TabsTrigger value="dashboard" className="data-[state=active]:bg-slate-700">Live Dashboard</TabsTrigger>
            <TabsTrigger value="sessions" className="data-[state=active]:bg-slate-700">Active Sessions</TabsTrigger>
            <TabsTrigger value="team" className="data-[state=active]:bg-slate-700">Team Status</TabsTrigger>
            <TabsTrigger value="messages" className="data-[state=active]:bg-slate-700">Live Feed</TabsTrigger>
            <TabsTrigger value="decisions" className="data-[state=active]:bg-slate-700">Decision Tracking</TabsTrigger>
          </TabsList>

          {/* Live Dashboard */}
          <TabsContent value="dashboard" className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              {/* Real-Time Activity Feed */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Activity className="h-5 w-5" />
                    Live Activity Stream
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4 max-h-96 overflow-y-auto">
                  {liveUpdates.slice(0, 8).map((update) => (
                    <div key={update.id} className="p-3 bg-slate-800/50 rounded-lg border border-slate-600/50">
                      <div className="flex items-start justify-between mb-2">
                        <div className="flex items-center gap-2">
                          <Badge className={getPriorityColor(update.priority)}>
                            {update.priority.toUpperCase()}
                          </Badge>
                          <span className="text-sm text-slate-400">
                            {new Date(update.timestamp).toLocaleTimeString()}
                          </span>
                        </div>
                      </div>
                      <h4 className="font-semibold text-white text-sm mb-1">{update.title}</h4>
                      <p className="text-slate-300 text-sm mb-2">{update.content}</p>
                      <div className="text-xs text-slate-500">By: {update.user}</div>
                    </div>
                  ))}
                </CardContent>
              </Card>

              {/* Quick Communication */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <MessageSquare className="h-5 w-5" />
                    Quick Communication
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex gap-2">
                    <Input
                      placeholder="Send a message to the team..."
                      value={newMessage}
                      onChange={(e) => setNewMessage(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                      className="bg-slate-800 border-slate-600 text-white"
                    />
                    <Button onClick={sendMessage} className="bg-blue-600 hover:bg-blue-700">
                      <Send className="w-4 h-4" />
                    </Button>
                  </div>
                  
                  <div className="grid grid-cols-2 gap-3">
                    <Button size="sm" className="bg-emerald-600 hover:bg-emerald-700">
                      <Video className="w-4 h-4 mr-2" />
                      Start Video Call
                    </Button>
                    <Button size="sm" className="bg-purple-600 hover:bg-purple-700">
                      <Share className="w-4 h-4 mr-2" />
                      Share Screen
                    </Button>
                    <Button size="sm" className="bg-amber-600 hover:bg-amber-700">
                      <Calendar className="w-4 h-4 mr-2" />
                      Schedule Meeting
                    </Button>
                    <Button size="sm" className="bg-pink-600 hover:bg-pink-700">
                      <FileText className="w-4 h-4 mr-2" />
                      Create Document
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Active Sessions */}
          <TabsContent value="sessions" className="space-y-6">
            <div className="space-y-4">
              {collaborationSessions.map((session) => (
                <Card key={session.id} className="bg-slate-900/50 border-slate-700/50">
                  <CardContent className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex-1 page-background">
                        <div className="flex items-center gap-3 mb-2">
                          <h3 className="text-lg font-semibold text-white">{session.title}</h3>
                          <Badge className={getTypeColor(session.type)}>
                            {session.type.toUpperCase()}
                          </Badge>
                          <Badge className={session.status === 'active' ? 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30' : 'bg-slate-500/20 text-slate-300 border-slate-500/30'}>
                            {session.status.toUpperCase()}
                          </Badge>
                        </div>
                        <p className="text-slate-300 mb-4">{session.description}</p>
                      </div>
                      <div className="text-right">
                        <div className="text-sm text-slate-400">Duration</div>
                        <div className="text-white font-medium">{session.duration}</div>
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div>
                        <h4 className="font-semibold text-white mb-2">Participants</h4>
                        <div className="space-y-2">
                          {session.participants.map((participant) => (
                            <div key={participant.id} className="flex items-center gap-3">
                              <div className="relative">
                                <Avatar className="h-8 w-8">
                                  <AvatarFallback className="bg-slate-700 text-white text-xs">
                                    {participant.name.split(' ').map(n => n[0]).join('')}
                                  </AvatarFallback>
                                </Avatar>
                                <div className={`absolute -bottom-1 -right-1 w-3 h-3 ${getStatusColor(participant.status)} rounded-full border border-slate-900`} />
                              </div>
                              <div>
                                <div className="text-sm font-medium text-white">{participant.name}</div>
                                <div className="text-xs text-slate-400">{participant.role}</div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                      
                      {session.agenda && (
                        <div>
                          <h4 className="font-semibold text-white mb-2">Agenda</h4>
                          <div className="space-y-1">
                            {session.agenda.map((item, index) => (
                              <div key={index} className="text-sm text-slate-300 flex items-center gap-2">
                                <div className="w-1.5 h-1.5 bg-blue-400 rounded-full" />
                                {item}
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                      
                      {session.decisions && (
                        <div>
                          <h4 className="font-semibold text-white mb-2">Decisions</h4>
                          <div className="space-y-1">
                            {session.decisions.map((decision, index) => (
                              <div key={index} className="text-sm text-slate-300 flex items-center gap-2">
                                <CheckCircle className="w-4 h-4 text-emerald-400 flex-shrink-0" />
                                {decision}
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>
                    
                    <div className="mt-6 pt-4 border-t border-slate-700 flex gap-3">
                      <Button className="bg-blue-600 hover:bg-blue-700">
                        <Video className="w-4 h-4 mr-2" />
                        Join Session
                      </Button>
                      <Button variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <FileText className="w-4 h-4 mr-2" />
                        View Notes
                      </Button>
                      <Button variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <Share className="w-4 h-4 mr-2" />
                        Share
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Team Status */}
          <TabsContent value="team" className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {teamMembers.map((member) => (
                <Card key={member.id} className="bg-slate-900/50 border-slate-700/50">
                  <CardContent className="p-6">
                    <div className="flex items-center gap-4 mb-4">
                      <div className="relative">
                        <Avatar className="h-12 w-12">
                          <AvatarFallback className="bg-slate-700 text-white">
                            {member.name.split(' ').map(n => n[0]).join('')}
                          </AvatarFallback>
                        </Avatar>
                        <div className={`absolute -bottom-1 -right-1 w-4 h-4 ${getStatusColor(member.status)} rounded-full border-2 border-slate-900`} />
                      </div>
                      <div className="flex-1 page-background">
                        <h3 className="font-semibold text-white">{member.name}</h3>
                        <p className="text-sm text-slate-400">{member.role}</p>
                        <Badge variant="outline" className="border-slate-600 text-slate-300 text-xs mt-1">
                          {member.department}
                        </Badge>
                      </div>
                    </div>
                    
                    <div className="space-y-2 text-sm">
                      <div className="flex justify-between">
                        <span className="text-slate-400">Status:</span>
                        <span className="text-white capitalize">{member.status}</span>
                      </div>
                      {member.currentActivity && (
                        <div className="flex justify-between">
                          <span className="text-slate-400">Activity:</span>
                          <span className="text-white text-xs">{member.currentActivity}</span>
                        </div>
                      )}
                      <div className="flex justify-between">
                        <span className="text-slate-400">Timezone:</span>
                        <span className="text-white">{member.timezone}</span>
                      </div>
                    </div>
                    
                    <div className="mt-4 flex gap-2">
                      <Button size="sm" className="flex-1 bg-blue-600 hover:bg-blue-700">
                        <MessageSquare className="w-4 h-4 mr-2" />
                        Message
                      </Button>
                      <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <Video className="w-4 h-4" />
                      </Button>
                      <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <Phone className="w-4 h-4" />
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Live Feed */}
          <TabsContent value="messages" className="space-y-6">
            <Card className="bg-slate-900/50 border-slate-700/50">
              <CardHeader>
                <CardTitle className="text-white">Live Communication Feed</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="flex gap-2 mb-4">
                  <Input
                    placeholder="Type your message..."
                    value={newMessage}
                    onChange={(e) => setNewMessage(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                    className="bg-slate-800 border-slate-600 text-white"
                  />
                  <Button onClick={sendMessage} className="bg-blue-600 hover:bg-blue-700">
                    <Send className="w-4 h-4" />
                  </Button>
                </div>
                
                <div className="space-y-3 max-h-96 overflow-y-auto">
                  {liveUpdates.map((update) => (
                    <div key={update.id} className="p-4 bg-slate-800/50 rounded-lg">
                      <div className="flex items-start justify-between mb-2">
                        <div className="flex items-center gap-2">
                          <span className="font-medium text-white text-sm">{update.user}</span>
                          <Badge className={getPriorityColor(update.priority)}>
                            {update.priority}
                          </Badge>
                        </div>
                        <span className="text-xs text-slate-400">
                          {new Date(update.timestamp).toLocaleTimeString()}
                        </span>
                      </div>
                      <p className="text-slate-300 text-sm">{update.content}</p>
                      {update.relatedTo && (
                        <div className="mt-2">
                          <Badge variant="outline" className="border-slate-600 text-slate-400 text-xs">
                            Related to: {update.relatedTo}
                          </Badge>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          {/* Decision Tracking */}
          <TabsContent value="decisions" className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Target className="h-5 w-5" />
                    Today's Decisions
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-white font-medium">Digital Transformation Budget</span>
                      <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">APPROVED</Badge>
                    </div>
                    <p className="text-sm text-slate-400">$2.5M allocated for Phase 2 implementation</p>
                    <div className="text-xs text-slate-500 mt-1">Decided by: Chief Executive Officer</div>
                  </div>
                  
                  <div className="p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-white font-medium">APAC Market Expansion</span>
                      <Badge className="bg-emerald-500/20 text-emerald-300 border-emerald-500/30">APPROVED</Badge>
                    </div>
                    <p className="text-sm text-slate-400">Greenlit market entry strategy</p>
                    <div className="text-xs text-slate-500 mt-1">Decided by: VP Strategy</div>
                  </div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Clock className="h-5 w-5" />
                    Pending Decisions
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-white font-medium">Q3 Hiring Plan</span>
                      <Badge className="bg-amber-500/20 text-amber-300 border-amber-500/30">PENDING</Badge>
                    </div>
                    <p className="text-sm text-slate-400">25 new positions across departments</p>
                    <div className="text-xs text-slate-500 mt-1">Assigned to: Chief Financial Officer</div>
                  </div>
                  
                  <div className="p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-white font-medium">Office Expansion</span>
                      <Badge className="bg-blue-500/20 text-blue-300 border-blue-500/30">REVIEW</Badge>
                    </div>
                    <p className="text-sm text-slate-400">Additional office space in Austin</p>
                    <div className="text-xs text-slate-500 mt-1">Assigned to: Chief Operations Officer</div>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/Research.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { 
  ArrowRight, 
  ExternalLink,
  Clock, 
  DollarSign,
  AlertTriangle,
  TrendingUp,
  Shield,
  Users,
  Zap,
  Building2,
  Globe2,
  BarChart3,
  BookOpen,
  CheckCircle2
} from "lucide-react";
import { Link } from "wouter";
import StandardNav from "@/components/layout/StandardNav";
import { useEffect } from "react";
import { updatePageMetadata } from "@/lib/seo";

export default function Research() {
  useEffect(() => {
    updatePageMetadata({
      title: "Research Behind M | Crisis Response Statistics & Industry Data",
      description: "M was built on a foundation of industry research from McKinsey, PwC, IBM, and Ponemon Institute. See the data that proves faster response saves millions.",
      ogTitle: "The Research Behind M - Industry Data & Statistics",
      ogDescription: "IBM, McKinsey, PwC research proves the cost of slow response. See how M compresses 72 hours to 12 minutes.",
    });
  }, []);

  return (
    <div className="min-h-screen bg-background text-foreground">
      <StandardNav />

      {/* Hero Section */}
      <section className="py-20 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
        <div className="max-w-5xl mx-auto text-center">
          <Badge className="mb-6 bg-primary text-white border-0">
            <BarChart3 className="w-4 h-4 mr-2" />
            Industry Research
          </Badge>
          
          <h1 className="text-4xl md:text-6xl font-bold mb-6 leading-tight" data-testid="heading-research">
            The Research Behind M
          </h1>
          
          <p className="text-xl md:text-2xl text-blue-100 mb-8 max-w-3xl mx-auto">
            M was built on a foundation of industry research and 20+ years of Fortune 500 
            operational experience. Here's the data that shaped our platform.
          </p>
        </div>
      </section>

      {/* The Problem Is Well-Documented */}
      <section className="py-16 px-6">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-3xl font-bold text-foreground mb-4">
              The Problem is Well-Documented
            </h2>
            <p className="text-muted-foreground max-w-2xl mx-auto">
              Leading institutions have quantified the cost of slow, uncoordinated response. 
              M was designed to solve these exact challenges.
            </p>
          </div>

          {/* Response Time Section */}
          <Card className="mb-8 border-2 border-orange-500/30">
            <CardContent className="p-8">
              <div className="flex items-start gap-4 mb-6">
                <div className="w-12 h-12 rounded-full bg-orange-500/20 flex items-center justify-center shrink-0">
                  <Clock className="h-6 w-6 text-orange-500" />
                </div>
                <div>
                  <h3 className="text-2xl font-bold text-foreground mb-2">Response Time</h3>
                  <p className="text-muted-foreground">
                    McKinsey's crisis response framework focuses on "the first 72 hours" as the 
                    critical window for organizational response. Most companies struggle to get 
                    aligned within this timeframe.
                  </p>
                </div>
              </div>
              
              <div className="bg-orange-500/5 rounded-lg p-6 mb-4">
                <div className="flex items-center justify-between flex-wrap gap-4">
                  <div className="text-center">
                    <div className="text-4xl font-bold text-orange-500">72 hrs</div>
                    <p className="text-sm text-muted-foreground">Industry average response time</p>
                  </div>
                  <ArrowRight className="h-8 w-8 text-primary" />
                  <div className="text-center">
                    <div className="text-4xl font-bold text-primary">12 min</div>
                    <p className="text-sm text-muted-foreground">M's coordinated response</p>
                  </div>
                </div>
              </div>
              
              <p className="text-sm text-muted-foreground">
                Source: McKinsey & Company  Crisis Response Framework
              </p>
            </CardContent>
          </Card>

          {/* Disruption Frequency Section */}
          <Card className="mb-8 border-2 border-red-500/30">
            <CardContent className="p-8">
              <div className="flex items-start gap-4 mb-6">
                <div className="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center shrink-0">
                  <AlertTriangle className="h-6 w-6 text-red-500" />
                </div>
                <div>
                  <h3 className="text-2xl font-bold text-foreground mb-2">Disruption is Constant</h3>
                  <p className="text-muted-foreground">
                    PwC's 2023 Global Crisis Survey found that 91% of organizations have experienced 
                    at least one major disruption beyond the pandemic, with companies averaging 3.5 
                    significant disruptions every two years.
                  </p>
                </div>
              </div>
              
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                <div className="text-center p-4 bg-red-500/5 rounded-lg">
                  <div className="text-3xl font-bold text-red-500">91%</div>
                  <p className="text-xs text-muted-foreground">Experienced major disruption</p>
                </div>
                <div className="text-center p-4 bg-red-500/5 rounded-lg">
                  <div className="text-3xl font-bold text-red-500">3.5</div>
                  <p className="text-xs text-muted-foreground">Disruptions per 2 years</p>
                </div>
                <div className="text-center p-4 bg-red-500/5 rounded-lg">
                  <div className="text-3xl font-bold text-red-500">89%</div>
                  <p className="text-xs text-muted-foreground">Prioritize resilience</p>
                </div>
                <div className="text-center p-4 bg-red-500/5 rounded-lg">
                  <div className="text-3xl font-bold text-red-500">70%</div>
                  <p className="text-xs text-muted-foreground">Report significant impact</p>
                </div>
              </div>
              
              <p className="text-sm text-muted-foreground">
                Source: PwC Global Crisis and Resilience Survey 2023  1,812 organizations, 42 countries
              </p>
            </CardContent>
          </Card>

          {/* Speed Saves Money Section */}
          <Card className="mb-8 border-2 border-green-500/30">
            <CardContent className="p-8">
              <div className="flex items-start gap-4 mb-6">
                <div className="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center shrink-0">
                  <DollarSign className="h-6 w-6 text-green-500" />
                </div>
                <div>
                  <h3 className="text-2xl font-bold text-foreground mb-2">Speed Saves Money</h3>
                  <p className="text-muted-foreground">
                    IBM's 2024 Cost of Data Breach study proves what we've seen in practice: faster 
                    response = lower costs. M provides all of these capabilities in a single platform.
                  </p>
                </div>
              </div>
              
              <div className="grid md:grid-cols-2 gap-4 mb-4">
                <div className="p-4 bg-green-500/5 rounded-lg">
                  <div className="flex items-center gap-3 mb-2">
                    <CheckCircle2 className="h-5 w-5 text-green-500" />
                    <span className="text-2xl font-bold text-green-500">$1.76M</span>
                  </div>
                  <p className="text-sm text-muted-foreground">Saved by containing incidents within 30 days</p>
                </div>
                <div className="p-4 bg-green-500/5 rounded-lg">
                  <div className="flex items-center gap-3 mb-2">
                    <CheckCircle2 className="h-5 w-5 text-green-500" />
                    <span className="text-2xl font-bold text-green-500">35%</span>
                  </div>
                  <p className="text-sm text-muted-foreground">Cost reduction with pre-defined response teams</p>
                </div>
                <div className="p-4 bg-green-500/5 rounded-lg">
                  <div className="flex items-center gap-3 mb-2">
                    <CheckCircle2 className="h-5 w-5 text-green-500" />
                    <span className="text-2xl font-bold text-green-500">$2.2M</span>
                  </div>
                  <p className="text-sm text-muted-foreground">Saved per incident with automation</p>
                </div>
                <div className="p-4 bg-green-500/5 rounded-lg">
                  <div className="flex items-center gap-3 mb-2">
                    <CheckCircle2 className="h-5 w-5 text-green-500" />
                    <span className="text-2xl font-bold text-green-500">98 days</span>
                  </div>
                  <p className="text-sm text-muted-foreground">Faster response with AI-powered tools</p>
                </div>
              </div>
              
              <p className="text-sm text-muted-foreground">
                Source: IBM/Ponemon Institute  Cost of a Data Breach Report 2024  604 organizations studied
              </p>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Industry-Specific Data */}
      <section className="py-16 px-6 bg-slate-50 dark:bg-slate-900">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-3xl font-bold text-foreground mb-4">
              Industry-Specific Impact
            </h2>
            <p className="text-muted-foreground max-w-2xl mx-auto">
              The stakes are even higher in regulated industries where compliance, reputation, 
              and customer trust are on the line.
            </p>
          </div>

          <div className="grid md:grid-cols-2 gap-6">
            {/* Financial Services */}
            <Card className="border-2 border-blue-500/30">
              <CardContent className="p-8">
                <div className="flex items-center gap-3 mb-6">
                  <Building2 className="h-10 w-10 text-blue-500" />
                  <div>
                    <h3 className="font-bold text-xl text-foreground">Financial Services</h3>
                    <p className="text-sm text-muted-foreground">Higher Stakes, Higher Costs</p>
                  </div>
                </div>
                
                <div className="grid grid-cols-3 gap-4 text-center mb-6">
                  <div className="p-3 bg-blue-500/5 rounded-lg">
                    <div className="text-2xl font-bold text-blue-500">$6.08M</div>
                    <p className="text-xs text-muted-foreground">Avg breach cost</p>
                  </div>
                  <div className="p-3 bg-blue-500/5 rounded-lg">
                    <div className="text-2xl font-bold text-blue-500">168</div>
                    <p className="text-xs text-muted-foreground">Days to identify</p>
                  </div>
                  <div className="p-3 bg-blue-500/5 rounded-lg">
                    <div className="text-2xl font-bold text-blue-500">51</div>
                    <p className="text-xs text-muted-foreground">Days to contain</p>
                  </div>
                </div>
                
                <div className="p-4 bg-blue-500/10 rounded-lg mb-4">
                  <p className="text-sm text-foreground font-medium">
                    22% above global average cost. M cuts this timeline to minutes.
                  </p>
                </div>
                
                <p className="text-xs text-muted-foreground">
                  Source: IBM Cost of Data Breach 2024 - Financial Industry
                </p>
              </CardContent>
            </Card>

            {/* Healthcare */}
            <Card className="border-2 border-red-500/30">
              <CardContent className="p-8">
                <div className="flex items-center gap-3 mb-6">
                  <Shield className="h-10 w-10 text-red-500" />
                  <div>
                    <h3 className="font-bold text-xl text-foreground">Healthcare</h3>
                    <p className="text-sm text-muted-foreground">The Costliest Industry</p>
                  </div>
                </div>
                
                <div className="grid grid-cols-3 gap-4 text-center mb-6">
                  <div className="p-3 bg-red-500/5 rounded-lg">
                    <div className="text-2xl font-bold text-red-500">$9.77M</div>
                    <p className="text-xs text-muted-foreground">Avg breach cost</p>
                  </div>
                  <div className="p-3 bg-red-500/5 rounded-lg">
                    <div className="text-2xl font-bold text-red-500">213</div>
                    <p className="text-xs text-muted-foreground">Days to discover</p>
                  </div>
                  <div className="p-3 bg-red-500/5 rounded-lg">
                    <div className="text-2xl font-bold text-red-500">14</div>
                    <p className="text-xs text-muted-foreground">Years as #1</p>
                  </div>
                </div>
                
                <div className="p-4 bg-red-500/10 rounded-lg mb-4">
                  <p className="text-sm text-foreground font-medium">
                    Highest regulatory scrutiny of any industry. M ensures you're ready before the next incident.
                  </p>
                </div>
                
                <p className="text-xs text-muted-foreground">
                  Source: IBM Cost of Data Breach 2024
                </p>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Business Agility Research */}
      <section className="py-16 px-6">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-3xl font-bold text-foreground mb-4">
              Business Agility is No Longer Optional
            </h2>
            <p className="text-muted-foreground max-w-2xl mx-auto">
              Business Agility Institute research proves that organizations with stronger agility 
              capabilities significantly outperform their peersespecially under pressure.
            </p>
          </div>

          <Card className="mb-8 border-2 border-purple-500/30">
            <CardContent className="p-8">
              <div className="flex items-start gap-4 mb-6">
                <div className="w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center shrink-0">
                  <TrendingUp className="h-6 w-6 text-purple-500" />
                </div>
                <div>
                  <h3 className="text-2xl font-bold text-foreground mb-2">Agility Drives Revenue</h3>
                  <p className="text-muted-foreground">
                    Organizations that measurably improved their business agility saw dramatically 
                    higher financial performance compared to those that didn't prioritize adaptability.
                  </p>
                </div>
              </div>
              
              <div className="grid md:grid-cols-3 gap-4 mb-6">
                <div className="text-center p-4 bg-purple-500/5 rounded-lg">
                  <div className="text-4xl font-bold text-purple-500">10.3%</div>
                  <p className="text-sm text-muted-foreground">Revenue increase per employee for agile organizations</p>
                </div>
                <div className="text-center p-4 bg-purple-500/5 rounded-lg">
                  <div className="text-4xl font-bold text-purple-500">3x</div>
                  <p className="text-sm text-muted-foreground">Better performance vs non-agile peers (3.5% increase)</p>
                </div>
                <div className="text-center p-4 bg-purple-500/5 rounded-lg">
                  <div className="text-4xl font-bold text-purple-500">5.4</div>
                  <p className="text-sm text-muted-foreground">Global agility maturity rating (resilient despite headwinds)</p>
                </div>
              </div>

              <div className="p-4 bg-purple-500/10 rounded-lg mb-4">
                <p className="text-sm text-foreground font-medium italic">
                  "AI does not create an advantage on its own. It amplifies the organization in which 
                  it is embedded. In companies with strong business agility, AI accelerates learning, 
                  innovation, and value creation. In those without it, AI exposes structural friction, 
                  leadership gaps, and brittle decision systems at speed."
                </p>
                <p className="text-xs text-muted-foreground mt-2"> Ahmed Sidky, President, Business Agility Institute</p>
              </div>
              
              <p className="text-sm text-muted-foreground">
                Source: Business Agility Institute  Business Agility Report
              </p>
            </CardContent>
          </Card>

          <div className="grid md:grid-cols-3 gap-4">
            <Card className="border border-purple-500/20">
              <CardContent className="p-6 text-center">
                <Shield className="h-8 w-8 text-purple-500 mx-auto mb-3" />
                <h4 className="font-bold text-foreground mb-2">Balance Governance & Risk</h4>
                <p className="text-sm text-muted-foreground">
                  Give people autonomy while maintaining safeguards. M's pre-approved resources do exactly this.
                </p>
              </CardContent>
            </Card>
            <Card className="border border-purple-500/20">
              <CardContent className="p-6 text-center">
                <Users className="h-8 w-8 text-purple-500 mx-auto mb-3" />
                <h4 className="font-bold text-foreground mb-2">Empower with Accountability</h4>
                <p className="text-sm text-muted-foreground">
                  Clear task ownership with defined acceptance criteria. M's playbooks assign both.
                </p>
              </CardContent>
            </Card>
            <Card className="border border-purple-500/20">
              <CardContent className="p-6 text-center">
                <Zap className="h-8 w-8 text-purple-500 mx-auto mb-3" />
                <h4 className="font-bold text-foreground mb-2">Fund Work Dynamically</h4>
                <p className="text-sm text-muted-foreground">
                  Shift resources to high-value activities without bureaucracy. M unlocks pre-approved budgets instantly.
                </p>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* How M Addresses These Findings */}
      <section className="py-16 px-6 bg-slate-50 dark:bg-slate-900">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-3xl font-bold text-foreground mb-4">
              How M Addresses These Findings
            </h2>
            <p className="text-muted-foreground max-w-2xl mx-auto">
              Every feature in M was designed to address a specific research finding about 
              what makes organizations faster and more resilient.
            </p>
          </div>

          <div className="grid md:grid-cols-2 gap-6">
            <Card>
              <CardContent className="p-6">
                <div className="flex items-start gap-4">
                  <Users className="h-8 w-8 text-primary shrink-0" />
                  <div>
                    <h4 className="font-bold text-foreground mb-2">Pre-Defined Response Teams</h4>
                    <p className="text-sm text-muted-foreground mb-3">
                      IBM found 35% cost reduction with pre-assigned teams. M's playbooks 
                      include pre-assigned stakeholders for every scenario.
                    </p>
                    <Badge variant="outline" className="text-xs">166 Playbooks Ready</Badge>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardContent className="p-6">
                <div className="flex items-start gap-4">
                  <Zap className="h-8 w-8 text-primary shrink-0" />
                  <div>
                    <h4 className="font-bold text-foreground mb-2">Automated Orchestration</h4>
                    <p className="text-sm text-muted-foreground mb-3">
                      $2.2M saved per incident with automation. M auto-creates Jira projects, 
                      notifies via Slack, and orchestrates execution.
                    </p>
                    <Badge variant="outline" className="text-xs">Enterprise Integrations</Badge>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardContent className="p-6">
                <div className="flex items-start gap-4">
                  <Clock className="h-8 w-8 text-primary shrink-0" />
                  <div>
                    <h4 className="font-bold text-foreground mb-2">Faster Containment</h4>
                    <p className="text-sm text-muted-foreground mb-3">
                      $1.76M saved by containing within 30 days. M's pre-staged playbooks 
                      get you to coordinated response in minutes.
                    </p>
                    <Badge variant="outline" className="text-xs">12-Minute Activation</Badge>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardContent className="p-6">
                <div className="flex items-start gap-4">
                  <TrendingUp className="h-8 w-8 text-primary shrink-0" />
                  <div>
                    <h4 className="font-bold text-foreground mb-2">AI-Powered Detection</h4>
                    <p className="text-sm text-muted-foreground mb-3">
                      98 days faster with AI. M's continuous monitoring detects weak signals 
                      before they become crises.
                    </p>
                    <Badge variant="outline" className="text-xs">24/7 Monitoring</Badge>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Sources */}
      <section className="py-16 px-6 bg-slate-50 dark:bg-slate-900">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-3xl font-bold text-foreground mb-4">
              Research Sources
            </h2>
            <p className="text-muted-foreground max-w-2xl mx-auto">
              All statistics and insights referenced are from leading global research institutions.
            </p>
          </div>

          <div className="grid md:grid-cols-2 gap-6">
            <Card>
              <CardContent className="p-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center">
                    <BookOpen className="h-6 w-6 text-blue-500" />
                  </div>
                  <div>
                    <h4 className="font-bold text-foreground">McKinsey & Company</h4>
                    <p className="text-sm text-muted-foreground">Crisis Response Framework</p>
                  </div>
                </div>
                <p className="text-sm text-muted-foreground mb-4">
                  Research on the critical importance of the first 72 hours in crisis response 
                  and organizational coordination.
                </p>
                <a 
                  href="https://www.mckinsey.com/capabilities/risk-and-resilience/how-we-help-clients/crisis-response" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="text-primary text-sm flex items-center gap-1 hover:underline"
                >
                  Visit Research <ExternalLink className="h-3 w-3" />
                </a>
              </CardContent>
            </Card>

            <Card>
              <CardContent className="p-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-12 h-12 rounded-full bg-orange-500/20 flex items-center justify-center">
                    <Globe2 className="h-6 w-6 text-orange-500" />
                  </div>
                  <div>
                    <h4 className="font-bold text-foreground">PwC</h4>
                    <p className="text-sm text-muted-foreground">Global Crisis and Resilience Survey 2023</p>
                  </div>
                </div>
                <p className="text-sm text-muted-foreground mb-4">
                  Survey of 1,812 organizations across 42 countries on disruption frequency, 
                  impact, and resilience priorities.
                </p>
                <a 
                  href="https://www.pwc.com/gx/en/issues/crisis-solutions/global-crisis-survey.html" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="text-primary text-sm flex items-center gap-1 hover:underline"
                >
                  Visit Research <ExternalLink className="h-3 w-3" />
                </a>
              </CardContent>
            </Card>

            <Card>
              <CardContent className="p-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center">
                    <Shield className="h-6 w-6 text-green-500" />
                  </div>
                  <div>
                    <h4 className="font-bold text-foreground">IBM Security</h4>
                    <p className="text-sm text-muted-foreground">Cost of a Data Breach Report 2024</p>
                  </div>
                </div>
                <p className="text-sm text-muted-foreground mb-4">
                  Study of 604 organizations analyzing breach costs, response times, and 
                  the financial impact of automation and AI.
                </p>
                <a 
                  href="https://www.ibm.com/reports/data-breach" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="text-primary text-sm flex items-center gap-1 hover:underline"
                >
                  Visit Research <ExternalLink className="h-3 w-3" />
                </a>
              </CardContent>
            </Card>

            <Card>
              <CardContent className="p-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center">
                    <BarChart3 className="h-6 w-6 text-purple-500" />
                  </div>
                  <div>
                    <h4 className="font-bold text-foreground">Ponemon Institute</h4>
                    <p className="text-sm text-muted-foreground">Security Research Partner</p>
                  </div>
                </div>
                <p className="text-sm text-muted-foreground mb-4">
                  Independent research on data protection, privacy, and information security 
                  policy. Research partner for IBM studies.
                </p>
                <a 
                  href="https://www.ponemon.org/" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="text-primary text-sm flex items-center gap-1 hover:underline"
                >
                  Visit Research <ExternalLink className="h-3 w-3" />
                </a>
              </CardContent>
            </Card>

            <Card>
              <CardContent className="p-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center">
                    <TrendingUp className="h-6 w-6 text-indigo-500" />
                  </div>
                  <div>
                    <h4 className="font-bold text-foreground">Business Agility Institute</h4>
                    <p className="text-sm text-muted-foreground">Business Agility Report</p>
                  </div>
                </div>
                <p className="text-sm text-muted-foreground mb-4">
                  Global research on organizational agility, resilience, and the correlation 
                  between adaptability and business performance.
                </p>
                <a 
                  href="https://businessagility.institute/type/research" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="text-primary text-sm flex items-center gap-1 hover:underline"
                >
                  Visit Research <ExternalLink className="h-3 w-3" />
                </a>
              </CardContent>
            </Card>
          </div>

          <div className="mt-8 p-6 bg-primary/10 rounded-lg text-center">
            <p className="text-foreground font-medium mb-2">
              Research updates annually. We refresh our statistics as new reports are published.
            </p>
            <p className="text-sm text-muted-foreground">
              IBM updates annually (July) | PwC surveys bi-annually | McKinsey publishes regularly | BAI reports annually
            </p>
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="py-16 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
        <div className="max-w-3xl mx-auto text-center">
          <h2 className="text-3xl font-bold mb-6">
            See the Research in Action
          </h2>
          <p className="text-xl text-blue-100 mb-8">
            Watch how M transforms these research findings into operational capability.
          </p>
          <div className="flex gap-4 justify-center flex-wrap">
            <Link href="/demo-selector">
              <Button size="lg" className="bg-white text-slate-900 hover:bg-slate-100">
                Watch Demo
                <ArrowRight className="ml-2 h-5 w-5" />
              </Button>
            </Link>
            <Link href="/why-m">
              <Button size="lg" variant="outline" className="border-white text-white hover:bg-white/10">
                Our Story
              </Button>
            </Link>
          </div>
        </div>
      </section>
    </div>
  );
}


========================================
FILE: client/src/pages/RetailFoodSafetyDemo.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useState, useEffect } from "react";
import { Link } from "wouter";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { ShoppingCart, Heart, AlertTriangle, CheckCircle, Clock, Users, DollarSign, ShieldAlert, ArrowLeft, Play, Store } from "lucide-react";
import AIRadarSimulation from "@/components/demo/AIRadarSimulation";
import TwelveMinuteTimer from "@/components/demo/TwelveMinuteTimer";
import ROIComparison from "@/components/demo/ROIComparison";
import DemoNavHeader from "@/components/demo/DemoNavHeader";
import { retailDemoData } from "@shared/retail-demo-data";

type DemoAct = "intro" | "detection" | "coordination" | "outcome";

export default function RetailFoodSafetyDemo() {
  const [currentAct, setCurrentAct] = useState<DemoAct>("intro");
  const [detectionProgress, setDetectionProgress] = useState(0);
  const [coordinationComplete, setCoordinationComplete] = useState(false);

  // Auto-progress detection
  useEffect(() => {
    if (currentAct === "detection" && detectionProgress < 100) {
      const interval = setInterval(() => {
        setDetectionProgress(prev => {
          if (prev >= 100) {
            clearInterval(interval);
            return 100;
          }
          return prev + 2;
        });
      }, 100);
      return () => clearInterval(interval);
    }
  }, [currentAct, detectionProgress]);

  const resetDemo = () => {
    setCurrentAct("intro");
    setDetectionProgress(0);
    setCoordinationComplete(false);
  };

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-950 via-emerald-950 to-slate-900">
      <DemoNavHeader title="Retail Food Safety Demo" showBackButton={true} />

      {/* Act Navigation */}
      <div className="border-b border-emerald-800/20 bg-slate-950/30 pt-20">
        <div className="container mx-auto px-6 py-3">
          <div className="flex justify-between items-center">
            {[
              { id: "intro", label: "1. Introduction", icon: Play },
              { id: "detection", label: "2. AI Detection @ 88%", icon: ShieldAlert },
              { id: "coordination", label: "3. 1-Hour Response", icon: Clock },
              { id: "outcome", label: "4. Lives Saved", icon: Heart }
            ].map((act) => (
              <button
                key={act.id}
                onClick={() => setCurrentAct(act.id as DemoAct)}
                className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
                  currentAct === act.id
                    ? "bg-emerald-600 text-white"
                    : "text-emerald-300 hover:bg-emerald-950/50"
                }`}
                data-testid={`button-act-${act.id}`}
              >
                <act.icon className="w-4 h-4" />
                <span className="text-sm font-medium">{act.label}</span>
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="container mx-auto px-6 py-12">
        {/* ACT 1: INTRODUCTION */}
        {currentAct === "intro" && (
          <div className="max-w-5xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-emerald-800/30">
              <div className="text-center mb-8">
                <ShoppingCart className="w-16 h-16 text-emerald-400 mx-auto mb-4" />
                <h2 className="text-3xl font-bold text-white mb-3">{retailDemoData.crisis.title}</h2>
                <p className="text-xl text-emerald-200">{retailDemoData.crisis.subtitle}</p>
              </div>

              <div className="grid md:grid-cols-2 gap-6 mb-8">
                <div className="p-6 bg-emerald-950/30 rounded-lg border border-emerald-800/30">
                  <h3 className="font-bold text-white mb-4 flex items-center gap-2">
                    <AlertTriangle className="w-5 h-5 text-emerald-400" />
                    The Crisis
                  </h3>
                  <div className="space-y-3 text-sm">
                    <div>
                      <div className="text-emerald-300 mb-1">Organization</div>
                      <div className="text-white font-semibold">{retailDemoData.organization.name}</div>
                    </div>
                    <div>
                      <div className="text-emerald-300 mb-1">Contaminated Product</div>
                      <div className="text-white">Bagged Lettuce (Batch #47382)</div>
                    </div>
                    <div>
                      <div className="text-emerald-300 mb-1">Detection</div>
                      <div className="text-white">Salmonella - exceeds FDA threshold</div>
                    </div>
                    <div>
                      <div className="text-emerald-300 mb-1">Scale</div>
                      <div className="text-white font-bold">847 stores  23 states  12,847 customers</div>
                    </div>
                  </div>
                </div>

                <div className="p-6 bg-slate-900/50 rounded-lg border border-emerald-800/30">
                  <h3 className="font-bold text-white mb-4">Traditional Recall Timeline</h3>
                  <ul className="space-y-2 text-sm text-emerald-200">
                    <li> Week 1: QA detects contamination, internal investigation</li>
                    <li> Week 1 End: Quietly notify wholesalers only</li>
                    <li className="text-amber-400 font-semibold"> During gap: 50+ customers consume contaminated lettuce</li>
                    <li className="text-red-400 font-bold"> During gap: Hospitalizations begin</li>
                    <li> Week 2: Public recall finally announced</li>
                    <li className="text-emerald-300"> Month 1-2: $200M in lawsuits, FDA warning letter</li>
                  </ul>
                </div>
              </div>

              <div className="bg-gradient-to-r from-emerald-950/50 to-green-950/50 border border-emerald-700 rounded-lg p-6 mb-8">
                <div className="flex items-start gap-4">
                  <ShieldAlert className="w-8 h-8 text-emerald-400 flex-shrink-0 mt-1" />
                  <div>
                    <h3 className="font-bold text-white mb-2">The Detection-Execution Gap</h3>
                    <p className="text-emerald-100 leading-relaxed">
                      Walmart's AI supply chain saved $20M+ in transportation costs. Their QA testing detected the salmonella 
                      immediately. But coordinating 5,000 stakeholders across 847 stores, 12,847 customers, FDA, CDC, and 
                      23 state health departments took <strong>7 days</strong>. In that gap, 50+ people were hospitalized. 
                      This demo shows how M compresses that 7-day coordination into <strong>1 hour</strong>, ensuring 
                      zero customers consume contaminated product after detection.
                    </p>
                  </div>
                </div>
              </div>

              <div className="grid md:grid-cols-3 gap-4 mb-8">
                <div className="p-4 bg-emerald-950/30 rounded-lg border border-emerald-800/30 text-center">
                  <Users className="w-8 h-8 text-emerald-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">5,000+</div>
                  <div className="text-sm text-emerald-300">Stakeholders Coordinated</div>
                </div>
                <div className="p-4 bg-emerald-950/30 rounded-lg border border-emerald-800/30 text-center">
                  <Clock className="w-8 h-8 text-emerald-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">1 Hour</div>
                  <div className="text-sm text-emerald-300">Full Coordination</div>
                </div>
                <div className="p-4 bg-emerald-950/30 rounded-lg border border-emerald-800/30 text-center">
                  <DollarSign className="w-8 h-8 text-emerald-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">$240M+</div>
                  <div className="text-sm text-emerald-300">Value Preserved</div>
                </div>
              </div>

              <div className="text-center">
                <Button
                  size="lg"
                  onClick={() => setCurrentAct("detection")}
                  className="bg-emerald-600 hover:bg-emerald-700 text-white px-8"
                  data-testid="button-start-demo"
                >
                  Begin Crisis Simulation
                  <Play className="w-5 h-5 ml-2" />
                </Button>
              </div>
            </Card>
          </div>
        )}

        {/* ACT 2: AI DETECTION */}
        {currentAct === "detection" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-emerald-800/30">
              <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                <ShieldAlert className="w-8 h-8 text-emerald-400" />
                AI Quality Control Detects Food Safety Crisis
              </h2>

              <div className="mb-8">
                <div className="flex items-center justify-between mb-3">
                  <span className="text-emerald-200">AI Confidence Level</span>
                  <span className="text-2xl font-bold text-emerald-400">{detectionProgress}%</span>
                </div>
                <Progress value={detectionProgress} className="h-3" />
                {detectionProgress >= 88 && (
                  <div className="mt-4 p-4 bg-emerald-950/50 border border-emerald-600 rounded-lg">
                    <p className="text-emerald-200 font-semibold">
                       ALERT: Class I recall criteria detected - Food contamination + wide distribution = immediate action required
                    </p>
                  </div>
                )}
              </div>

              <AIRadarSimulation
                dataStreams={retailDemoData.aiDataStreams}
                title="Food Safety Intelligence Signals"
                playbookId="#095"
                playbookName="Food Product Recall (Class I)"
                autoStart={true}
              />

              {detectionProgress >= 88 && (
                <div className="mt-8 text-center">
                  <Button
                    size="lg"
                    onClick={() => setCurrentAct("coordination")}
                    className="bg-emerald-600 hover:bg-emerald-700 text-white px-8"
                    data-testid="button-activate-playbook"
                  >
                    Activate Playbook #095 - Food Recall
                    <CheckCircle className="w-5 h-5 ml-2" />
                  </Button>
                </div>
              )}
            </Card>
          </div>
        )}

        {/* ACT 3: COORDINATED RESPONSE */}
        {currentAct === "coordination" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-emerald-800/30">
              <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                <Clock className="w-8 h-8 text-emerald-400" />
                1-Hour Coordinated Response Across 5,000 Stakeholders
              </h2>

              <TwelveMinuteTimer
                timelineEvents={retailDemoData.timelineEvents}
                onComplete={() => setCoordinationComplete(true)}
                title="1-Hour Crisis Response Timeline"
                subtitle="From detection to full coordination across 5,000 stakeholders"
                autoStart={true}
              />

              {coordinationComplete && (
                <div className="mt-8">
                  <div className="grid md:grid-cols-3 gap-6 mb-8">
                    <Card className="p-6 bg-emerald-950/30 border-emerald-800/30">
                      <div className="text-center">
                        <Users className="w-10 h-10 text-emerald-400 mx-auto mb-3" />
                        <div className="text-3xl font-bold text-white mb-1">
                          {retailDemoData.stakeholderTiers.tier1.count}
                        </div>
                        <div className="text-sm text-emerald-300 mb-4">{retailDemoData.stakeholderTiers.tier1.title}</div>
                        <ul className="text-xs text-emerald-200 space-y-1 text-left">
                          <li> CEO, COO, CFO</li>
                          <li> General Counsel</li>
                          <li> FDA Liaison, CDC</li>
                          <li> Crisis PR, Insurance</li>
                        </ul>
                      </div>
                    </Card>

                    <Card className="p-6 bg-emerald-950/30 border-emerald-800/30">
                      <div className="text-center">
                        <Users className="w-10 h-10 text-emerald-400 mx-auto mb-3" />
                        <div className="text-3xl font-bold text-white mb-1">
                          {retailDemoData.stakeholderTiers.tier2.count}
                        </div>
                        <div className="text-sm text-emerald-300 mb-4">{retailDemoData.stakeholderTiers.tier2.title}</div>
                        <ul className="text-xs text-emerald-200 space-y-1 text-left">
                          <li> 847 store managers</li>
                          <li> Supply chain team</li>
                          <li> Customer care (50)</li>
                          <li> Communications (15)</li>
                        </ul>
                      </div>
                    </Card>

                    <Card className="p-6 bg-emerald-950/30 border-emerald-800/30">
                      <div className="text-center">
                        <Users className="w-10 h-10 text-emerald-400 mx-auto mb-3" />
                        <div className="text-3xl font-bold text-white mb-1">
                          {retailDemoData.stakeholderTiers.tier3.count}+
                        </div>
                        <div className="text-sm text-emerald-300 mb-4">{retailDemoData.stakeholderTiers.tier3.title}</div>
                        <ul className="text-xs text-emerald-200 space-y-1 text-left">
                          <li> 12,847 customers</li>
                          <li> All store employees</li>
                          <li> Board members</li>
                          <li> Media, investors</li>
                        </ul>
                      </div>
                    </Card>
                  </div>

                  <div className="text-center">
                    <Button
                      size="lg"
                      onClick={() => setCurrentAct("outcome")}
                      className="bg-emerald-600 hover:bg-emerald-700 text-white px-8"
                      data-testid="button-view-outcome"
                    >
                      View ROI Outcome
                      <DollarSign className="w-5 h-5 ml-2" />
                    </Button>
                  </div>
                </div>
              )}
            </Card>
          </div>
        )}

        {/* ACT 4: OUTCOME */}
        {currentAct === "outcome" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-emerald-800/30">
              <div className="text-center mb-8">
                <Heart className="w-16 h-16 text-emerald-400 mx-auto mb-4" />
                <h2 className="text-3xl font-bold text-white mb-3">Lives Saved Through Rapid Coordination</h2>
                <p className="text-xl text-emerald-200">
                  Zero customers consume contaminated lettuce after 2:00 PM detection
                </p>
              </div>

              <ROIComparison
                traditional={{
                  label: retailDemoData.roiComparison.traditional.title,
                  duration: retailDemoData.roiComparison.traditional.timeline,
                  approach: retailDemoData.roiComparison.traditional.approach,
                  outcome: retailDemoData.roiComparison.traditional.outcome,
                  points: retailDemoData.roiComparison.traditional.points,
                  details: retailDemoData.roiComparison.traditional.details
                }}
                vexor={{
                  label: retailDemoData.roiComparison.vexor.title,
                  duration: retailDemoData.roiComparison.vexor.timeline,
                  approach: retailDemoData.roiComparison.vexor.approach,
                  outcome: retailDemoData.roiComparison.vexor.outcome,
                  points: retailDemoData.roiComparison.vexor.points,
                  details: retailDemoData.roiComparison.vexor.details
                }}
                bottomLine={{
                  value: "$240M+ Value Preserved",
                  metric: "Lives saved + lawsuits prevented + brand trust reinforced"
                }}
              />

              <div className="mt-8 p-6 bg-gradient-to-r from-emerald-950/50 to-green-950/50 border border-emerald-600 rounded-lg">
                <h3 className="font-bold text-white mb-4 text-center text-xl">The M Difference</h3>
                <div className="grid md:grid-cols-2 gap-6">
                  <div>
                    <h4 className="font-semibold text-emerald-300 mb-3">Traditional Crisis Response</h4>
                    <ul className="space-y-2 text-sm text-emerald-100">
                      <li> 7 days of email chains and staged notifications</li>
                      <li> 50+ customers hospitalized</li>
                      <li> $200M in lawsuit settlements</li>
                      <li> Congressional hearing, FDA warning letter</li>
                      <li> "Walmart knew for a week" - brand damage</li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="font-semibold text-emerald-300 mb-3">M Coordinated Response</h4>
                    <ul className="space-y-2 text-sm text-emerald-100">
                      <li> 1-hour orchestrated execution across 5,000 stakeholders</li>
                      <li> 0 hospitalizations after detection</li>
                      <li> $5M total cost (only pre-detection cases)</li>
                      <li> FDA commendation for "exemplary response"</li>
                      <li> "Industry leader in food safety" - trust reinforced</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div className="mt-8 text-center space-x-4">
                <Button
                  variant="outline"
                  onClick={resetDemo}
                  className="border-emerald-600 text-emerald-400 hover:bg-emerald-950/50"
                  data-testid="button-replay-demo"
                >
                  Replay Demo
                </Button>
                <Link href="/industry-demos">
                  <Button className="bg-emerald-600 hover:bg-emerald-700 text-white" data-testid="button-view-all-demos">
                    View All Industry Demos
                  </Button>
                </Link>
              </div>
            </Card>
          </div>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/RoadshowResources.tsx
========================================
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import { 
  FileText, 
  MessageSquare, 
  DollarSign, 
  Clock, 
  TrendingUp, 
  Shield, 
  CheckSquare,
  Copy,
  Check,
  Zap,
  Target
} from 'lucide-react';
import StandardNav from '@/components/layout/StandardNav';
import { useLocation } from 'wouter';

import investorFaqContent from '@/data/M-Investor-FAQ.md?raw';
import pilotProgramContent from '@/data/M-Pilot-Program-OnePager.md?raw';
import demoScriptContent from '@/data/M-Demo-Script-3min.md?raw';
import whyNowContent from '@/data/M-WhyNow-SlideContent.md?raw';
import competitiveMoatContent from '@/data/M-Competitive-Moat-TalkingPoints.md?raw';
import checklistContent from '@/data/M-PreRoadshow-Checklist.md?raw';

const KEY_STATS = [
  { label: "Response Time", value: "72h  12min", color: "text-emerald-400" },
  { label: "Playbooks", value: "166", color: "text-blue-400" },
  { label: "Domains", value: "9", color: "text-purple-400" },
  { label: "Pilot Price", value: "$75K", color: "text-amber-400" },
  { label: "Contract Range", value: "$250K-$1.5M", color: "text-green-400" },
  { label: "Seed Target", value: "$2.6M", color: "text-pink-400" },
];

const DOCUMENTS = [
  {
    id: 'faq',
    title: 'Investor FAQ',
    description: '20 anticipated questions with crisp answers',
    icon: MessageSquare,
    color: 'from-blue-500 to-cyan-500',
    badge: '20 Q&As',
    content: investorFaqContent
  },
  {
    id: 'pilot',
    title: 'Pilot Program',
    description: '90-day engagement structure, pricing, success metrics',
    icon: Target,
    color: 'from-emerald-500 to-teal-500',
    badge: '$75K',
    content: pilotProgramContent
  },
  {
    id: 'demo-script',
    title: 'Demo Script',
    description: '3-minute investor demo with exact talking points',
    icon: Clock,
    color: 'from-purple-500 to-violet-500',
    badge: '3 min',
    content: demoScriptContent
  },
  {
    id: 'why-now',
    title: 'Why Now',
    description: '3 slides of market timing narrative and data',
    icon: TrendingUp,
    color: 'from-amber-500 to-orange-500',
    badge: '3 Slides',
    content: whyNowContent
  },
  {
    id: 'moat',
    title: 'Competitive Moat',
    description: 'Responses to "Why can\'t BigCo build this?"',
    icon: Shield,
    color: 'from-red-500 to-rose-500',
    badge: '5 Moats',
    content: competitiveMoatContent
  },
  {
    id: 'checklist',
    title: 'Pre-Roadshow Checklist',
    description: '75 tasks with priorities and deadlines',
    icon: CheckSquare,
    color: 'from-green-500 to-emerald-500',
    badge: '75 Tasks',
    content: checklistContent
  },
];

function MarkdownRenderer({ content }: { content: string }) {
  const lines = content.split('\n');
  
  return (
    <div className="prose prose-invert prose-sm max-w-none">
      {lines.map((line, idx) => {
        if (line.startsWith('# ')) {
          return <h1 key={idx} className="text-2xl font-bold text-white mt-6 mb-4">{line.slice(2)}</h1>;
        }
        if (line.startsWith('## ')) {
          return <h2 key={idx} className="text-xl font-bold text-white mt-6 mb-3 border-b border-slate-700 pb-2">{line.slice(3)}</h2>;
        }
        if (line.startsWith('### ')) {
          return <h3 key={idx} className="text-lg font-semibold text-emerald-400 mt-4 mb-2">{line.slice(4)}</h3>;
        }
        if (line.startsWith('**') && line.endsWith('**')) {
          return <p key={idx} className="font-bold text-white my-2">{line.slice(2, -2)}</p>;
        }
        if (line.startsWith('> ')) {
          return <blockquote key={idx} className="border-l-4 border-emerald-500 pl-4 my-3 text-slate-300 italic">{line.slice(2)}</blockquote>;
        }
        if (line.startsWith('- [ ] ')) {
          return <div key={idx} className="flex items-start gap-2 my-1"><input type="checkbox" className="mt-1" /><span className="text-slate-300">{line.slice(6)}</span></div>;
        }
        if (line.startsWith('- ')) {
          return <li key={idx} className="text-slate-300 ml-4 my-1">{line.slice(2)}</li>;
        }
        if (line.startsWith('| ') && line.includes(' | ')) {
          const cells = line.split(' | ').map(c => c.replace(/^\||\|$/g, '').trim());
          const isHeader = lines[idx + 1]?.includes('---');
          return (
            <div key={idx} className={`grid gap-2 py-2 border-b border-slate-800 ${isHeader ? 'font-semibold text-white' : 'text-slate-400'}`} style={{ gridTemplateColumns: `repeat(${cells.length}, minmax(0, 1fr))` }}>
              {cells.map((cell, i) => <div key={i} className="text-sm">{cell}</div>)}
            </div>
          );
        }
        if (line.includes('|---')) {
          return null;
        }
        if (line.startsWith('---')) {
          return <hr key={idx} className="border-slate-700 my-6" />;
        }
        if (line.trim() === '') {
          return <div key={idx} className="h-2" />;
        }
        const formattedLine = line
          .replace(/\*\*(.*?)\*\*/g, '<strong class="text-white">$1</strong>')
          .replace(/\*(.*?)\*/g, '<em>$1</em>')
          .replace(/`(.*?)`/g, '<code class="bg-slate-800 px-1 rounded text-emerald-400">$1</code>');
        return <p key={idx} className="text-slate-300 my-1" dangerouslySetInnerHTML={{ __html: formattedLine }} />;
      })}
    </div>
  );
}

export default function RoadshowResources() {
  const [, setLocation] = useLocation();
  const [copiedStat, setCopiedStat] = useState<string | null>(null);
  const [activeDoc, setActiveDoc] = useState('faq');

  const copyToClipboard = (text: string, label: string) => {
    navigator.clipboard.writeText(text);
    setCopiedStat(label);
    setTimeout(() => setCopiedStat(null), 2000);
  };

  const activeDocument = DOCUMENTS.find(d => d.id === activeDoc);

  return (
    <div className="min-h-screen bg-slate-950">
      <StandardNav />
      
      <div className="max-w-7xl mx-auto px-6 py-8">
        <div className="text-center mb-8">
          <Badge className="bg-purple-500 text-white mb-4">
            Internal Resources
          </Badge>
          <h1 className="text-4xl font-bold text-white mb-2" data-testid="heading-roadshow">
            Roadshow Preparation
          </h1>
          <p className="text-slate-400 max-w-2xl mx-auto">
            Complete investor materials. Click any document to view full content.
          </p>
        </div>

        <div className="mb-8">
          <h2 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
            <Zap className="h-5 w-5 text-amber-400" />
            Key Numbers to Memorize
          </h2>
          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
            {KEY_STATS.map((stat) => (
              <Card 
                key={stat.label}
                className="bg-slate-900/50 border-slate-700 cursor-pointer hover:border-slate-500 transition-all group"
                onClick={() => copyToClipboard(stat.value, stat.label)}
                data-testid={`card-stat-${stat.label.toLowerCase().replace(/\s+/g, '-')}`}
              >
                <CardContent className="p-4 text-center">
                  <div className={`text-2xl font-bold ${stat.color}`}>{stat.value}</div>
                  <div className="text-sm text-slate-400">{stat.label}</div>
                  <div className="mt-2 opacity-0 group-hover:opacity-100 transition-opacity text-xs text-slate-500 flex items-center justify-center gap-1">
                    {copiedStat === stat.label ? (
                      <><Check className="h-3 w-3" /> Copied</>
                    ) : (
                      <><Copy className="h-3 w-3" /> Click to copy</>
                    )}
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
          <div className="lg:col-span-1">
            <h2 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
              <FileText className="h-5 w-5 text-blue-400" />
              Documents
            </h2>
            <div className="space-y-2">
              {DOCUMENTS.map((doc) => {
                const IconComponent = doc.icon;
                return (
                  <Card 
                    key={doc.id}
                    className={`bg-slate-900/50 border cursor-pointer transition-all ${
                      activeDoc === doc.id 
                        ? 'border-emerald-500 bg-emerald-950/20' 
                        : 'border-slate-700 hover:border-slate-500'
                    }`}
                    onClick={() => setActiveDoc(doc.id)}
                    data-testid={`card-doc-${doc.id}`}
                  >
                    <CardContent className="p-4">
                      <div className="flex items-center gap-3">
                        <div className={`p-2 rounded-lg bg-gradient-to-br ${doc.color}`}>
                          <IconComponent className="h-4 w-4 text-white" />
                        </div>
                        <div className="flex-1 min-w-0">
                          <div className="font-medium text-white text-sm">{doc.title}</div>
                          <div className="text-xs text-slate-400 truncate">{doc.description}</div>
                        </div>
                        <Badge variant="secondary" className="text-xs shrink-0">
                          {doc.badge}
                        </Badge>
                      </div>
                    </CardContent>
                  </Card>
                );
              })}
            </div>

            <div className="mt-6 space-y-3">
              <Button 
                className="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600"
                onClick={() => setLocation('/investor-demo')}
                data-testid="button-run-investor-demo"
              >
                <Clock className="mr-2 h-4 w-4" />
                Run Investor Demo
              </Button>
              <Button 
                variant="outline"
                className="w-full border-slate-600 text-slate-300"
                onClick={() => setLocation('/demo')}
                data-testid="button-view-all-demos"
              >
                View All Demos
              </Button>
            </div>
          </div>

          <div className="lg:col-span-3">
            {activeDocument && (
              <Card className="bg-slate-900 border-slate-700">
                <CardHeader className="border-b border-slate-700">
                  <div className="flex items-center gap-4">
                    <div className={`p-3 rounded-xl bg-gradient-to-br ${activeDocument.color}`}>
                      <activeDocument.icon className="h-6 w-6 text-white" />
                    </div>
                    <div className="flex-1">
                      <CardTitle className="text-white text-xl">{activeDocument.title}</CardTitle>
                      <CardDescription>{activeDocument.description}</CardDescription>
                    </div>
                    <Button
                      variant="outline"
                      size="sm"
                      className="border-slate-600"
                      onClick={() => {
                        navigator.clipboard.writeText(activeDocument.content);
                        setCopiedStat('doc');
                        setTimeout(() => setCopiedStat(null), 2000);
                      }}
                      data-testid="button-copy-document"
                    >
                      {copiedStat === 'doc' ? <><Check className="h-4 w-4 mr-1" /> Copied</> : <><Copy className="h-4 w-4 mr-1" /> Copy All</>}
                    </Button>
                  </div>
                </CardHeader>
                <CardContent className="p-6">
                  <ScrollArea className="h-[600px] pr-4">
                    <MarkdownRenderer content={activeDocument.content} />
                  </ScrollArea>
                </CardContent>
              </Card>
            )}
          </div>
        </div>

        <Card className="mt-8 bg-gradient-to-r from-purple-950/50 to-blue-950/50 border-purple-500/30">
          <CardContent className="p-6">
            <div className="flex items-center justify-between flex-wrap gap-4">
              <div>
                <h3 className="text-lg font-bold text-white mb-1">Quick Reference Table</h3>
                <p className="text-slate-400 text-sm">What document to use in each situation</p>
              </div>
              <div className="flex flex-wrap gap-2">
                <Badge variant="outline" className="border-slate-600 text-slate-300">
                  Tough question  FAQ
                </Badge>
                <Badge variant="outline" className="border-slate-600 text-slate-300">
                  Pricing talk  Pilot Program
                </Badge>
                <Badge variant="outline" className="border-slate-600 text-slate-300">
                  About to demo  Demo Script
                </Badge>
                <Badge variant="outline" className="border-slate-600 text-slate-300">
                  "Why can't Salesforce?"  Competitive Moat
                </Badge>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/ROICalculator.tsx
========================================
import { useState, useMemo } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Slider } from '@/components/ui/slider';
import { 
  Calculator,
  Clock,
  DollarSign,
  TrendingUp,
  Users,
  AlertTriangle,
  ArrowRight,
  Building2,
  Zap,
  Target,
  Shield,
  Download,
  Send
} from 'lucide-react';
import { useLocation } from 'wouter';
import StandardNav from '@/components/layout/StandardNav';
import Footer from '@/components/layout/Footer';

interface ROIInputs {
  companySize: string;
  industry: string;
  annualRevenue: number;
  strategicEventsPerYear: number;
  avgResponseTimeHours: number;
  executivesInvolved: number;
  avgExecutiveSalary: number;
}

const INDUSTRY_MULTIPLIERS: Record<string, { riskMultiplier: number; regulatoryFactor: number; label: string }> = {
  financial_services: { riskMultiplier: 1.5, regulatoryFactor: 1.4, label: 'Financial Services' },
  healthcare: { riskMultiplier: 1.4, regulatoryFactor: 1.5, label: 'Healthcare & Life Sciences' },
  technology: { riskMultiplier: 1.2, regulatoryFactor: 1.1, label: 'Technology' },
  manufacturing: { riskMultiplier: 1.1, regulatoryFactor: 1.2, label: 'Manufacturing' },
  retail: { riskMultiplier: 1.0, regulatoryFactor: 1.0, label: 'Retail & Consumer' },
  energy: { riskMultiplier: 1.3, regulatoryFactor: 1.4, label: 'Energy & Utilities' },
  telecommunications: { riskMultiplier: 1.2, regulatoryFactor: 1.3, label: 'Telecommunications' },
  other: { riskMultiplier: 1.0, regulatoryFactor: 1.0, label: 'Other' },
};

const COMPANY_SIZES: Record<string, { employees: number; label: string }> = {
  mid_market: { employees: 2500, label: 'Mid-Market (1K-5K employees)' },
  enterprise: { employees: 15000, label: 'Enterprise (5K-25K employees)' },
  large_enterprise: { employees: 50000, label: 'Large Enterprise (25K-100K employees)' },
  fortune_500: { employees: 100000, label: 'Fortune 500 (100K+ employees)' },
};

export default function ROICalculator() {
  const [, setLocation] = useLocation();
  
  const [inputs, setInputs] = useState<ROIInputs>({
    companySize: 'enterprise',
    industry: 'financial_services',
    annualRevenue: 5000000000, // $5B
    strategicEventsPerYear: 24,
    avgResponseTimeHours: 72,
    executivesInvolved: 8,
    avgExecutiveSalary: 400000,
  });

  const calculations = useMemo(() => {
    const industryData = INDUSTRY_MULTIPLIERS[inputs.industry];
    const companyData = COMPANY_SIZES[inputs.companySize];
    
    // Current state calculations
    const hourlyExecutiveCost = inputs.avgExecutiveSalary / 2080; // Annual salary / working hours
    const currentCoordinationHoursPerEvent = inputs.avgResponseTimeHours;
    const currentTotalExecutiveHoursPerYear = currentCoordinationHoursPerEvent * inputs.executivesInvolved * inputs.strategicEventsPerYear;
    const currentCoordinationCostPerYear = currentTotalExecutiveHoursPerYear * hourlyExecutiveCost;
    
    // Revenue at risk from slow response (percentage of annual revenue)
    const revenueAtRiskPercentage = 0.005 * industryData.riskMultiplier; // 0.5% base, adjusted by industry
    const revenueAtRiskPerEvent = inputs.annualRevenue * revenueAtRiskPercentage / inputs.strategicEventsPerYear;
    
    // Regulatory/compliance risk cost
    const complianceRiskCost = inputs.annualRevenue * 0.001 * industryData.regulatoryFactor;
    
    // With M Platform (12-minute decision, 90-minute full execution)
    const mResponseTimeHours = 0.2 + 1.5; // 12 min decision + 90 min execution = ~1.7 hours
    const mTotalExecutiveHoursPerYear = mResponseTimeHours * inputs.executivesInvolved * inputs.strategicEventsPerYear;
    const mCoordinationCostPerYear = mTotalExecutiveHoursPerYear * hourlyExecutiveCost;
    
    // Savings calculations
    const coordinationCostSavings = currentCoordinationCostPerYear - mCoordinationCostPerYear;
    const timeSavedHoursPerYear = currentTotalExecutiveHoursPerYear - mTotalExecutiveHoursPerYear;
    const revenueProtected = revenueAtRiskPerEvent * inputs.strategicEventsPerYear * 0.7; // 70% of at-risk revenue protected
    const complianceRiskReduction = complianceRiskCost * 0.6; // 60% reduction in compliance risk
    
    // Total annual value
    const totalAnnualValue = coordinationCostSavings + revenueProtected + complianceRiskReduction;
    
    // Platform investment assumption
    const assumedAnnualInvestment = 500000; // $500K annual platform cost
    const roi = ((totalAnnualValue - assumedAnnualInvestment) / assumedAnnualInvestment) * 100;
    const paybackMonths = (assumedAnnualInvestment / totalAnnualValue) * 12;
    
    // Time metrics
    const speedImprovement = Math.round(inputs.avgResponseTimeHours / mResponseTimeHours);
    
    return {
      // Current state
      currentCoordinationCostPerYear,
      currentTotalExecutiveHoursPerYear,
      revenueAtRiskPerEvent,
      
      // With M
      mCoordinationCostPerYear,
      mTotalExecutiveHoursPerYear,
      
      // Savings
      coordinationCostSavings,
      timeSavedHoursPerYear,
      revenueProtected,
      complianceRiskReduction,
      totalAnnualValue,
      
      // ROI
      roi,
      paybackMonths,
      speedImprovement,
      
      // Raw
      hourlyExecutiveCost,
    };
  }, [inputs]);

  const formatCurrency = (value: number) => {
    if (value >= 1000000000) return `$${(value / 1000000000).toFixed(1)}B`;
    if (value >= 1000000) return `$${(value / 1000000).toFixed(1)}M`;
    if (value >= 1000) return `$${(value / 1000).toFixed(0)}K`;
    return `$${value.toFixed(0)}`;
  };

  const formatNumber = (value: number) => {
    return value.toLocaleString();
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-950">
      <StandardNav />
      
      <div className="container mx-auto px-4 py-12">
        <div className="max-w-6xl mx-auto">
          {/* Header */}
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-green-500/20 text-green-400 border-green-500/30">
              <Calculator className="h-4 w-4 mr-2" />
              ROI Calculator
            </Badge>
            <h1 className="text-4xl font-bold text-white mb-4">
              Calculate Your Strategic Velocity ROI
            </h1>
            <p className="text-xl text-slate-300 max-w-2xl mx-auto">
              See how M Platform transforms coordination time from 72 hours to 12 minutesand what that means for your bottom line.
            </p>
          </div>

          <div className="grid lg:grid-cols-2 gap-8">
            {/* Input Section */}
            <div className="space-y-6">
              <Card className="bg-slate-900/50 border-slate-800">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Building2 className="h-5 w-5 text-blue-400" />
                    Your Organization
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-6">
                  <div className="space-y-2">
                    <Label className="text-slate-300">Company Size</Label>
                    <Select 
                      value={inputs.companySize} 
                      onValueChange={(v) => setInputs({...inputs, companySize: v})}
                    >
                      <SelectTrigger className="bg-slate-800 border-slate-700 text-white" data-testid="select-company-size">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        {Object.entries(COMPANY_SIZES).map(([key, data]) => (
                          <SelectItem key={key} value={key}>{data.label}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>

                  <div className="space-y-2">
                    <Label className="text-slate-300">Industry</Label>
                    <Select 
                      value={inputs.industry} 
                      onValueChange={(v) => setInputs({...inputs, industry: v})}
                    >
                      <SelectTrigger className="bg-slate-800 border-slate-700 text-white" data-testid="select-industry">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        {Object.entries(INDUSTRY_MULTIPLIERS).map(([key, data]) => (
                          <SelectItem key={key} value={key}>{data.label}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>

                  <div className="space-y-2">
                    <Label className="text-slate-300">Annual Revenue</Label>
                    <div className="flex items-center gap-4">
                      <Slider
                        value={[Math.log10(inputs.annualRevenue)]}
                        onValueChange={([v]) => setInputs({...inputs, annualRevenue: Math.pow(10, v)})}
                        min={8} // $100M
                        max={11} // $100B
                        step={0.1}
                        className="flex-1"
                        data-testid="slider-revenue"
                      />
                      <span className="text-white font-mono w-20 text-right">
                        {formatCurrency(inputs.annualRevenue)}
                      </span>
                    </div>
                  </div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-800">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <AlertTriangle className="h-5 w-5 text-amber-400" />
                    Current State
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-6">
                  <div className="space-y-2">
                    <Label className="text-slate-300">Strategic Events per Year</Label>
                    <div className="text-xs text-slate-500 mb-2">
                      Crises, competitive responses, market entries, M&A, regulatory changes
                    </div>
                    <div className="flex items-center gap-4">
                      <Slider
                        value={[inputs.strategicEventsPerYear]}
                        onValueChange={([v]) => setInputs({...inputs, strategicEventsPerYear: v})}
                        min={4}
                        max={100}
                        step={1}
                        className="flex-1"
                        data-testid="slider-events"
                      />
                      <span className="text-white font-mono w-16 text-right">
                        {inputs.strategicEventsPerYear}
                      </span>
                    </div>
                  </div>

                  <div className="space-y-2">
                    <Label className="text-slate-300">Average Response Time (Hours)</Label>
                    <div className="text-xs text-slate-500 mb-2">
                      Time from event detection to coordinated response execution
                    </div>
                    <div className="flex items-center gap-4">
                      <Slider
                        value={[inputs.avgResponseTimeHours]}
                        onValueChange={([v]) => setInputs({...inputs, avgResponseTimeHours: v})}
                        min={24}
                        max={408} // 17 days
                        step={1}
                        className="flex-1"
                        data-testid="slider-response-time"
                      />
                      <span className="text-white font-mono w-20 text-right">
                        {inputs.avgResponseTimeHours}h
                      </span>
                    </div>
                  </div>

                  <div className="space-y-2">
                    <Label className="text-slate-300">Executives Involved per Event</Label>
                    <div className="flex items-center gap-4">
                      <Slider
                        value={[inputs.executivesInvolved]}
                        onValueChange={([v]) => setInputs({...inputs, executivesInvolved: v})}
                        min={3}
                        max={20}
                        step={1}
                        className="flex-1"
                        data-testid="slider-executives"
                      />
                      <span className="text-white font-mono w-16 text-right">
                        {inputs.executivesInvolved}
                      </span>
                    </div>
                  </div>

                  <div className="space-y-2">
                    <Label className="text-slate-300">Average Executive Compensation</Label>
                    <div className="flex items-center gap-4">
                      <Slider
                        value={[inputs.avgExecutiveSalary]}
                        onValueChange={([v]) => setInputs({...inputs, avgExecutiveSalary: v})}
                        min={200000}
                        max={1000000}
                        step={25000}
                        className="flex-1"
                        data-testid="slider-salary"
                      />
                      <span className="text-white font-mono w-20 text-right">
                        {formatCurrency(inputs.avgExecutiveSalary)}
                      </span>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Results Section */}
            <div className="space-y-6">
              {/* ROI Summary Card */}
              <Card className="bg-gradient-to-br from-green-950/50 to-emerald-950/50 border-green-500/30">
                <CardContent className="p-8">
                  <div className="text-center mb-6">
                    <div className="text-6xl font-bold text-green-400 mb-2">
                      {calculations.roi.toFixed(0)}%
                    </div>
                    <div className="text-xl text-slate-300">Annual ROI</div>
                  </div>
                  
                  <div className="grid grid-cols-2 gap-4 mb-6">
                    <div className="bg-slate-800/50 rounded-lg p-4 text-center">
                      <div className="text-2xl font-bold text-white">
                        {formatCurrency(calculations.totalAnnualValue)}
                      </div>
                      <div className="text-sm text-slate-400">Total Annual Value</div>
                    </div>
                    <div className="bg-slate-800/50 rounded-lg p-4 text-center">
                      <div className="text-2xl font-bold text-white">
                        {calculations.paybackMonths.toFixed(1)} mo
                      </div>
                      <div className="text-sm text-slate-400">Payback Period</div>
                    </div>
                  </div>

                  <div className="flex justify-center">
                    <Button 
                      size="lg"
                      className="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700"
                      onClick={() => setLocation('/contact')}
                      data-testid="button-get-proposal"
                    >
                      Get Custom Proposal
                      <ArrowRight className="h-5 w-5 ml-2" />
                    </Button>
                  </div>
                </CardContent>
              </Card>

              {/* Speed Improvement */}
              <Card className="bg-slate-900/50 border-slate-800">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                      <Zap className="h-5 w-5 text-amber-400" />
                      Speed Improvement
                    </h3>
                    <Badge className="bg-amber-500/20 text-amber-400 border-amber-500/30 text-lg px-4">
                      {calculations.speedImprovement}X Faster
                    </Badge>
                  </div>
                  
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-red-950/30 rounded-lg p-4 border border-red-500/20">
                      <div className="text-sm text-red-400 mb-1">Current Response</div>
                      <div className="text-2xl font-bold text-white">{inputs.avgResponseTimeHours} hours</div>
                    </div>
                    <div className="bg-green-950/30 rounded-lg p-4 border border-green-500/20">
                      <div className="text-sm text-green-400 mb-1">With M Platform</div>
                      <div className="text-2xl font-bold text-white">~2 hours</div>
                      <div className="text-xs text-slate-500">12 min decision + 90 min execution</div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Value Breakdown */}
              <Card className="bg-slate-900/50 border-slate-800">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <TrendingUp className="h-5 w-5 text-blue-400" />
                    Value Breakdown
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <Clock className="h-5 w-5 text-blue-400" />
                      <div>
                        <div className="text-white">Executive Time Saved</div>
                        <div className="text-xs text-slate-500">
                          {formatNumber(Math.round(calculations.timeSavedHoursPerYear))} hours/year
                        </div>
                      </div>
                    </div>
                    <div className="text-lg font-bold text-green-400">
                      {formatCurrency(calculations.coordinationCostSavings)}
                    </div>
                  </div>

                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <DollarSign className="h-5 w-5 text-green-400" />
                      <div>
                        <div className="text-white">Revenue Protected</div>
                        <div className="text-xs text-slate-500">
                          From faster competitive response
                        </div>
                      </div>
                    </div>
                    <div className="text-lg font-bold text-green-400">
                      {formatCurrency(calculations.revenueProtected)}
                    </div>
                  </div>

                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <Shield className="h-5 w-5 text-amber-400" />
                      <div>
                        <div className="text-white">Compliance Risk Reduction</div>
                        <div className="text-xs text-slate-500">
                          Faster regulatory response
                        </div>
                      </div>
                    </div>
                    <div className="text-lg font-bold text-green-400">
                      {formatCurrency(calculations.complianceRiskReduction)}
                    </div>
                  </div>

                  <div className="border-t border-slate-700 pt-4 mt-4">
                    <div className="flex items-center justify-between">
                      <div className="text-lg text-white font-semibold">Total Annual Value</div>
                      <div className="text-2xl font-bold text-green-400">
                        {formatCurrency(calculations.totalAnnualValue)}
                      </div>
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Disclaimer */}
              <div className="text-xs text-slate-500 text-center">
                * Calculations are estimates based on industry benchmarks and your inputs.
                Actual results may vary. Contact us for a detailed analysis.
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/RoleSelector.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { Link } from 'wouter';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { 
  Briefcase,
  DollarSign,
  Settings,
  TrendingUp,
  Server,
  Shield,
  Users,
  Scale,
  Database,
  FileCheck,
  Target,
  ArrowRight,
  Sparkles
} from 'lucide-react';

type Role = 'CEO' | 'CFO' | 'COO' | 'CMO' | 'CTO' | 'CISO' | 'CHRO' | 'CDO' | 'GC' | 'CCO' | 'CSO' | 'CRO';

interface RoleConfig {
  id: Role;
  title: string;
  icon: any;
  color: string;
  hookQuestion: string;
  keyMetric: string;
  demoPath: string;
  gradient: string;
  borderColor: string;
}

const roleConfigs: RoleConfig[] = [
  {
    id: 'CEO',
    title: 'Chief Executive Officer',
    icon: Briefcase,
    color: 'blue',
    hookQuestion: "What percentage of your strategic initiatives actually deliver on time and on budget?",
    keyMetric: "$144M execution gap  12-minute coordination",
    demoPath: '/demo/competitive-response',
    gradient: 'bg-gradient-to-br from-blue-50 via-indigo-50 to-blue-50 dark:from-blue-900/30 dark:via-indigo-900/30 dark:to-blue-900/30',
    borderColor: 'border-blue-300 dark:border-blue-700/50'
  },
  {
    id: 'CFO',
    title: 'Chief Financial Officer',
    icon: DollarSign,
    color: 'green',
    hookQuestion: "What's your company's biggest untracked expense that doesn't show up on any line item?",
    keyMetric: "$114M Year 1 ROI, 6.3 week payback",
    demoPath: '/demo/ma-integration',
    gradient: 'bg-gradient-to-br from-green-50 via-emerald-50 to-green-50 dark:from-green-900/30 dark:via-emerald-900/30 dark:to-green-900/30',
    borderColor: 'border-green-300 dark:border-green-700/50'
  },
  {
    id: 'COO',
    title: 'Chief Operating Officer',
    icon: Settings,
    color: 'orange',
    hookQuestion: "When was the last time you executed your continuity plan at the speed it assumes?",
    keyMetric: "72 hours  12 minutes, $2.1M saved",
    demoPath: '/demo/supplier-crisis',
    gradient: 'bg-gradient-to-br from-orange-50 via-amber-50 to-orange-50 dark:from-orange-900/30 dark:via-amber-900/30 dark:to-orange-900/30',
    borderColor: 'border-orange-300 dark:border-orange-700/50'
  },
  {
    id: 'CMO',
    title: 'Chief Marketing Officer',
    icon: TrendingUp,
    color: 'purple',
    hookQuestion: "Competitor launches a product tomorrow. How long until your counter-campaign is in market?",
    keyMetric: "21 days  3 days, $12M market share saved",
    demoPath: '/demo/competitive-response',
    gradient: 'bg-gradient-to-br from-purple-50 via-pink-50 to-purple-50 dark:from-purple-900/30 dark:via-pink-900/30 dark:to-purple-900/30',
    borderColor: 'border-purple-300 dark:border-purple-700/50'
  },
  {
    id: 'CTO',
    title: 'Chief Technology Officer',
    icon: Server,
    color: 'cyan',
    hookQuestion: "CEO announces digital transformation Monday. How long until 6 teams are coordinating?",
    keyMetric: "36  22 months, $12M ROI, 82% adoption",
    demoPath: '/demo/product-launch',
    gradient: 'bg-gradient-to-br from-cyan-50 via-blue-50 to-cyan-50 dark:from-cyan-900/30 dark:via-blue-900/30 dark:to-cyan-900/30',
    borderColor: 'border-cyan-300 dark:border-cyan-700/50'
  },
  {
    id: 'CISO',
    title: 'Chief Information Security Officer',
    icon: Shield,
    color: 'red',
    hookQuestion: "Breach detected at 2 AM. How long until 6 teams are executing coordinated response?",
    keyMetric: "8 hours  47 minutes, breach contained",
    demoPath: '/demo/ransomware',
    gradient: 'bg-gradient-to-br from-red-50 via-orange-50 to-red-50 dark:from-red-900/30 dark:via-orange-900/30 dark:to-red-900/30',
    borderColor: 'border-red-300 dark:border-red-700/50'
  },
  {
    id: 'CHRO',
    title: 'Chief Human Resources Officer',
    icon: Users,
    color: 'pink',
    hookQuestion: "What's the #1 reason your top performers give in exit interviews?",
    keyMetric: "85% engagement, $2.1M saved, 40% faster",
    demoPath: '/demo/ma-integration',
    gradient: 'bg-gradient-to-br from-pink-50 via-rose-50 to-pink-50 dark:from-pink-900/30 dark:via-rose-900/30 dark:to-pink-900/30',
    borderColor: 'border-pink-300 dark:border-pink-700/50'
  },
  {
    id: 'CDO',
    title: 'Chief Data Officer',
    icon: Database,
    color: 'indigo',
    hookQuestion: "Your data signals 'churn risk.' How long until the organization acts on that insight?",
    keyMetric: "14 days  2 hours, 92% customer save rate",
    demoPath: '/demo/customer-crisis',
    gradient: 'bg-gradient-to-br from-indigo-50 via-violet-50 to-indigo-50 dark:from-indigo-900/30 dark:via-violet-900/30 dark:to-indigo-900/30',
    borderColor: 'border-indigo-300 dark:border-indigo-700/50'
  },
  {
    id: 'GC',
    title: 'General Counsel',
    icon: Scale,
    color: 'slate',
    hookQuestion: "Regulatory change Friday afternoon. How long until organization executes compliance?",
    keyMetric: "5 weeks  10 days, deadline met easily",
    demoPath: '/demo/regulatory-crisis',
    gradient: 'bg-gradient-to-br from-slate-50 via-gray-50 to-slate-50 dark:from-slate-900/30 dark:via-gray-900/30 dark:to-slate-900/30',
    borderColor: 'border-slate-300 dark:border-slate-700/50'
  },
  {
    id: 'CCO',
    title: 'Chief Compliance Officer',
    icon: FileCheck,
    color: 'teal',
    hookQuestion: "Audit notification arrives Monday. How long to get coordinated responses from 6 teams?",
    keyMetric: "10 days  2 days, stress eliminated",
    demoPath: '/demo/regulatory-crisis',
    gradient: 'bg-gradient-to-br from-teal-50 via-cyan-50 to-teal-50 dark:from-teal-900/30 dark:via-cyan-900/30 dark:to-teal-900/30',
    borderColor: 'border-teal-300 dark:border-teal-700/50'
  },
  {
    id: 'CSO',
    title: 'Chief Strategy Officer',
    icon: Target,
    color: 'violet',
    hookQuestion: "Six months later, how much of your strategy is actually executing as planned?",
    keyMetric: "70%  95% delivery, $144M gap closed",
    demoPath: '/demo/ma-integration',
    gradient: 'bg-gradient-to-br from-violet-50 via-purple-50 to-violet-50 dark:from-violet-900/30 dark:via-purple-900/30 dark:to-violet-900/30',
    borderColor: 'border-violet-300 dark:border-violet-700/50'
  },
  {
    id: 'CRO',
    title: 'Chief Revenue Officer',
    icon: TrendingUp,
    color: 'emerald',
    hookQuestion: "What's your average time from 'customer requests proposal' to 'proposal delivered'?",
    keyMetric: "21 days  5 days, +5% win rate, $44M revenue",
    demoPath: '/demo/competitive-response',
    gradient: 'bg-gradient-to-br from-emerald-50 via-green-50 to-emerald-50 dark:from-emerald-900/30 dark:via-green-900/30 dark:to-emerald-900/30',
    borderColor: 'border-emerald-300 dark:border-emerald-700/50'
  }
];

function RoleCard({ config }: { config: RoleConfig }) {
  const Icon = config.icon;
  
  return (
    <Link href={config.demoPath}>
      <Card 
        className={`${config.gradient} ${config.borderColor} hover:scale-105 transition-all cursor-pointer h-full`}
        data-testid={`card-role-${config.id.toLowerCase()}`}
      >
        <CardHeader>
          <div className="flex items-center gap-3 mb-4">
            <Icon className={`h-8 w-8 text-${config.color}-500`} />
            <div>
              <CardTitle className="text-xl" data-testid={`text-role-title-${config.id.toLowerCase()}`}>
                {config.title}
              </CardTitle>
              <Badge variant="outline" className="mt-1" data-testid={`badge-role-${config.id.toLowerCase()}`}>
                {config.id}
              </Badge>
            </div>
          </div>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="min-h-[80px]">
            <p className="text-lg font-semibold text-slate-900 dark:text-slate-100 italic" data-testid={`text-hook-${config.id.toLowerCase()}`}>
              "{config.hookQuestion}"
            </p>
          </div>
          
          <div className="pt-4 border-t border-slate-300 dark:border-slate-700">
            <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">Your M Impact:</div>
            <div className="text-base font-bold text-green-600 dark:text-green-400" data-testid={`text-metric-${config.id.toLowerCase()}`}>
              {config.keyMetric}
            </div>
          </div>

          <Button 
            className="w-full mt-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700"
            data-testid={`button-demo-${config.id.toLowerCase()}`}
          >
            See Your Demo
            <ArrowRight className="w-4 h-4 ml-2" />
          </Button>
        </CardContent>
      </Card>
    </Link>
  );
}

export default function RoleSelector() {
  return (
    <div className="page-background min-h-screen bg-white dark:bg-slate-950 text-slate-900 dark:text-white p-8">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="text-center mb-12">
          <div className="flex items-center justify-center gap-4 mb-6">
            <Sparkles className="h-12 w-12 text-purple-500 animate-pulse" />
            <h1 className="text-5xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent">
              Which Executive Role Best Describes You?
            </h1>
            <Sparkles className="h-12 w-12 text-blue-500 animate-pulse" />
          </div>
          <p className="text-2xl text-slate-700 dark:text-slate-400 mb-4">
            See M from Your Perspective
          </p>
          <p className="text-lg text-slate-600 dark:text-slate-500 max-w-3xl mx-auto">
            Select your role below to see a personalized demo showing how M solves your specific coordination challenges and delivers measurable impact for Fortune 1000 executives like you.
          </p>
        </div>

        {/* Role Cards Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {roleConfigs.map(config => (
            <RoleCard key={config.id} config={config} />
          ))}
        </div>

        {/* Footer CTA */}
        <div className="mt-16 text-center">
          <div className="bg-gradient-to-r .section-background dark:from-blue-900/20 dark:via-purple-900/20 dark:to-pink-900/20 rounded-lg p-8 border border-blue-200 dark:border-blue-800/50">
            <h3 className="text-2xl font-bold mb-4">Not Sure Which Demo to Try?</h3>
            <p className="text-lg text-slate-700 dark:text-slate-300 mb-6 max-w-2xl mx-auto">
              Browse all 7 scenario-based demos to see M in action across different strategic situations.
            </p>
            <Link href="/demo-selector">
              <Button 
                size="lg" 
                variant="outline"
                className="border-blue-600 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-950"
                data-testid="button-browse-scenarios"
              >
                Browse All Scenarios
                <ArrowRight className="w-5 h-5 ml-2" />
              </Button>
            </Link>
          </div>
        </div>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/SandboxDemo.tsx
========================================
import { useState, useEffect } from "react";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Slider } from "@/components/ui/slider";
import { Switch } from "@/components/ui/switch";
import { Progress } from "@/components/ui/progress";
import { Checkbox } from "@/components/ui/checkbox";
import { Textarea } from "@/components/ui/textarea";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from "@/components/ui/accordion";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { useLocation } from "wouter";
import { 
  ArrowRight, 
  ArrowLeft, 
  Shield, 
  Target, 
  Zap, 
  Globe, 
  GitMerge, 
  Rocket, 
  AlertTriangle, 
  Scale, 
  Cpu, 
  Brain,
  Clock,
  Users,
  DollarSign,
  CheckCircle2,
  Play,
  TrendingUp,
  Mail,
  MessageSquare,
  Phone,
  Building2,
  Sparkles,
  Timer,
  FileText,
  Award,
  ListChecks,
  GitBranch,
  ArrowUpRight,
  Bell,
  ChevronDown,
  ChevronRight,
  Workflow,
  Network,
  Plus,
  Trash2,
  GripVertical,
  Send,
  Plug,
  BarChart3,
  PieChart,
  Link2,
  CircleCheck,
  CircleX
} from "lucide-react";
import { STRATEGIC_DOMAINS_ARRAY, TIMING_BENCHMARKS, IDEA_PHASES } from "@shared/constants/framework";
import Confetti from "react-confetti";

type Step = 'domain' | 'configure' | 'tasks' | 'triggers' | 'simulate' | 'results';

interface PlaybookConfig {
  domain: string;
  domainName: string;
  companyName: string;
  industry: string;
  stakeholders: string[];
  responseTimeTarget: number;
  budgetPreApproved: number;
  notificationChannels: string[];
  aiAssistEnabled: boolean;
  autoEscalation: boolean;
  escalationPath: EscalationLevel[];
  decisionPoints: DecisionPoint[];
  communicationTemplates: CommunicationTemplate[];
}

interface EscalationLevel {
  id: string;
  level: number;
  role: string;
  timeoutMinutes: number;
  action: string;
}

interface DecisionPoint {
  id: string;
  name: string;
  description: string;
  approver: string;
  requiredFor: string;
  autoApproveTimeout: number;
}

interface CommunicationTemplate {
  id: string;
  type: 'initial' | 'update' | 'escalation' | 'completion';
  channel: string;
  subject: string;
  message: string;
}

interface TaskAssignment {
  id: string;
  name: string;
  description: string;
  assignedRole: string;
  estimatedMinutes: number;
  dependencies: string[];
  requiresApproval: boolean;
  priority: 'critical' | 'high' | 'medium' | 'low';
}

interface TriggerConfig {
  triggerType: string;
  severity: string;
  autoActivate: boolean;
  confirmationRequired: boolean;
  signalSources: string[];
  thresholds: TriggerThreshold[];
  detectionCriteria: string[];
}

interface TriggerThreshold {
  id: string;
  metric: string;
  operator: 'greater' | 'less' | 'equals' | 'contains';
  value: string;
  action: 'alert' | 'activate' | 'escalate';
}

interface SimulationEvent {
  time: string;
  event: string;
  type: 'trigger' | 'ai' | 'stakeholder' | 'decision' | 'task' | 'escalation' | 'complete';
  stakeholder?: string;
  explanation?: string;
}

const EVENT_EXPLANATIONS: Record<string, string> = {
  trigger: "M detected this event through connected monitoring systems. In production, this would come from your SIEM, news feeds, or internal alerts.",
  ai: "The AI assistant is processing the situation and taking automated actions based on your pre-configured playbook rules.",
  stakeholder: "Notifications are being sent through your selected channels (Slack, email, SMS) to the right people automatically.",
  decision: "A decision point has been reached. In production, executives receive mobile alerts with pre-staged options to choose from.",
  task: "Tasks are being assigned to team members with clear instructions, deadlines, and dependencies already mapped out.",
  escalation: "The escalation path you configured is now active. If responses aren't received in time, M will automatically escalate.",
  complete: "The coordinated response is complete. All stakeholders were aligned, tasks assigned, and decisions made in record time."
};

const ICON_MAP: Record<string, any> = {
  Globe, GitMerge, Rocket, AlertTriangle, Shield, Scale, Cpu, Target, Brain
};

const INDUSTRIES = [
  "Financial Services", "Healthcare", "Technology", "Manufacturing", 
  "Retail", "Energy", "Pharmaceuticals", "Gaming & Hospitality"
];

const STAKEHOLDER_OPTIONS = [
  { id: "ceo", label: "CEO", icon: Building2, level: 1 },
  { id: "cfo", label: "CFO", icon: DollarSign, level: 2 },
  { id: "ciso", label: "CISO", icon: Shield, level: 2 },
  { id: "clo", label: "General Counsel", icon: Scale, level: 2 },
  { id: "cmo", label: "CMO", icon: Target, level: 2 },
  { id: "coo", label: "COO", icon: Users, level: 2 },
  { id: "hr", label: "HR Director", icon: Users, level: 3 },
  { id: "comms", label: "VP Communications", icon: MessageSquare, level: 3 },
  { id: "ir", label: "Investor Relations", icon: TrendingUp, level: 3 },
  { id: "legal", label: "Senior Legal Counsel", icon: Scale, level: 3 },
];

const NOTIFICATION_OPTIONS = [
  { id: "email", label: "Email", icon: Mail },
  { id: "slack", label: "Slack", icon: MessageSquare },
  { id: "sms", label: "SMS", icon: Phone },
  { id: "teams", label: "Microsoft Teams", icon: Users },
];

const SIGNAL_SOURCES = [
  { id: "siem", label: "SIEM/Security Logs", category: "security" },
  { id: "news", label: "News & Media Monitoring", category: "market" },
  { id: "social", label: "Social Media Signals", category: "market" },
  { id: "regulatory", label: "Regulatory Filings", category: "compliance" },
  { id: "competitor", label: "Competitor Intelligence", category: "market" },
  { id: "internal", label: "Internal Systems", category: "operations" },
  { id: "vendor", label: "Vendor/Supply Chain", category: "operations" },
  { id: "financial", label: "Financial Data Feeds", category: "market" },
];

const ENTERPRISE_INTEGRATIONS = [
  { id: "jira", label: "Jira", category: "project", description: "Auto-create issues & assign tasks", connected: true },
  { id: "servicenow", label: "ServiceNow", category: "itsm", description: "Incident management & workflows", connected: true },
  { id: "slack", label: "Slack", category: "comms", description: "Real-time notifications & channels", connected: true },
  { id: "teams", label: "Microsoft Teams", category: "comms", description: "Team alerts & collaboration", connected: false },
  { id: "salesforce", label: "Salesforce", category: "crm", description: "Customer impact tracking", connected: false },
  { id: "pagerduty", label: "PagerDuty", category: "oncall", description: "Escalation & on-call routing", connected: true },
  { id: "confluence", label: "Confluence", category: "docs", description: "Auto-generate runbooks", connected: true },
  { id: "okta", label: "Okta", category: "identity", description: "Access control & SSO", connected: true },
];

const BUDGET_CATEGORIES = [
  { id: "legal", label: "Legal & Compliance", icon: Scale, defaultPercent: 25 },
  { id: "pr", label: "PR & Communications", icon: MessageSquare, defaultPercent: 20 },
  { id: "consulting", label: "External Consulting", icon: Users, defaultPercent: 15 },
  { id: "operations", label: "Operations & IT", icon: Cpu, defaultPercent: 25 },
  { id: "contingency", label: "Contingency Reserve", icon: Shield, defaultPercent: 15 },
];

const SUCCESS_METRICS = [
  { id: "response_time", label: "Response Time", unit: "minutes", target: 12, description: "Time from trigger to coordinated response" },
  { id: "stakeholder_alignment", label: "Stakeholder Alignment", unit: "%", target: 95, description: "Percentage of stakeholders briefed and aligned" },
  { id: "task_completion", label: "Task Completion Rate", unit: "%", target: 100, description: "Critical tasks completed within target window" },
  { id: "decision_velocity", label: "Decision Velocity", unit: "min/decision", target: 3, description: "Average time per approval gate" },
  { id: "communication_coverage", label: "Communication Coverage", unit: "%", target: 100, description: "Stakeholders receiving timely updates" },
];

const SCENARIO_BRANCHES = [
  { severity: "critical", label: "Critical - Full Activation", color: "bg-red-500", actions: ["Immediate full team mobilization", "All escalation paths active", "Board notification triggered"] },
  { severity: "high", label: "High - Elevated Response", color: "bg-orange-500", actions: ["Core team activation", "Management notification", "External counsel on standby"] },
  { severity: "medium", label: "Medium - Monitoring Mode", color: "bg-yellow-500", actions: ["Primary owner notified", "Situation monitoring enabled", "Escalation paths ready"] },
  { severity: "low", label: "Low - Awareness Only", color: "bg-blue-500", actions: ["Log for tracking", "Weekly digest inclusion", "No immediate action required"] },
];

const DEFAULT_TASKS: TaskAssignment[] = [
  { id: '1', name: 'Initial Assessment', description: 'Evaluate scope and severity of the situation', assignedRole: 'ciso', estimatedMinutes: 3, dependencies: [], requiresApproval: false, priority: 'critical' },
  { id: '2', name: 'Stakeholder Notification', description: 'Alert all relevant stakeholders via configured channels', assignedRole: 'comms', estimatedMinutes: 2, dependencies: ['1'], requiresApproval: false, priority: 'critical' },
  { id: '3', name: 'Legal Review', description: 'Review legal implications and disclosure requirements', assignedRole: 'clo', estimatedMinutes: 5, dependencies: ['1'], requiresApproval: false, priority: 'high' },
  { id: '4', name: 'Response Strategy', description: 'Draft coordinated response plan', assignedRole: 'ceo', estimatedMinutes: 4, dependencies: ['2', '3'], requiresApproval: true, priority: 'critical' },
  { id: '5', name: 'Execute Response', description: 'Implement approved response actions', assignedRole: 'coo', estimatedMinutes: 5, dependencies: ['4'], requiresApproval: false, priority: 'high' },
];

export default function SandboxDemo() {
  const [, setLocation] = useLocation();
  const [currentStep, setCurrentStep] = useState<Step>('domain');
  const [showConfetti, setShowConfetti] = useState(false);
  const [configTab, setConfigTab] = useState('team');
  
  const [config, setConfig] = useState<PlaybookConfig>({
    domain: '',
    domainName: '',
    companyName: '',
    industry: '',
    stakeholders: ['ceo', 'ciso', 'clo'],
    responseTimeTarget: 12,
    budgetPreApproved: 50000,
    notificationChannels: ['email', 'slack'],
    aiAssistEnabled: true,
    autoEscalation: true,
    escalationPath: [
      { id: '1', level: 1, role: 'Primary Owner', timeoutMinutes: 3, action: 'Escalate to backup' },
      { id: '2', level: 2, role: 'Backup Owner', timeoutMinutes: 2, action: 'Escalate to executive' },
      { id: '3', level: 3, role: 'Executive Sponsor', timeoutMinutes: 2, action: 'Auto-activate response' },
    ],
    decisionPoints: [
      { id: '1', name: 'Initial Response Approval', description: 'Approve the initial response strategy', approver: 'ceo', requiredFor: 'Response execution', autoApproveTimeout: 5 },
      { id: '2', name: 'Budget Release', description: 'Authorize emergency budget spend', approver: 'cfo', requiredFor: 'Resource allocation', autoApproveTimeout: 3 },
      { id: '3', name: 'External Communication', description: 'Approve external messaging', approver: 'clo', requiredFor: 'Public statement', autoApproveTimeout: 4 },
    ],
    communicationTemplates: [
      { id: '1', type: 'initial', channel: 'email', subject: 'URGENT: {domain} Alert - Immediate Action Required', message: 'A {severity} {domain} event has been detected. Your immediate attention is required. Click here to view your assigned tasks.' },
      { id: '2', type: 'escalation', channel: 'sms', subject: 'Escalation Alert', message: 'Task "{task}" has not been acknowledged. Escalating to next level.' },
      { id: '3', type: 'completion', channel: 'email', subject: '{domain} Response Complete - {duration} Total', message: 'The coordinated response has been completed. All stakeholders aligned. Summary report attached.' },
    ],
  });

  const [tasks, setTasks] = useState<TaskAssignment[]>(DEFAULT_TASKS);

  const [triggerConfig, setTriggerConfig] = useState<TriggerConfig>({
    triggerType: 'system',
    severity: 'critical',
    autoActivate: false,
    confirmationRequired: true,
    signalSources: ['siem', 'news'],
    thresholds: [
      { id: '1', metric: 'Threat Score', operator: 'greater', value: '85', action: 'activate' },
      { id: '2', metric: 'News Mentions', operator: 'greater', value: '10', action: 'alert' },
    ],
    detectionCriteria: ['Brand mention with negative sentiment', 'Unusual system access patterns', 'Competitor announcement in market'],
  });

  const [simulationProgress, setSimulationProgress] = useState(0);
  const [simulationEvents, setSimulationEvents] = useState<SimulationEvent[]>([]);
  const [simulationComplete, setSimulationComplete] = useState(false);
  
  const [budgetBreakdown, setBudgetBreakdown] = useState<Record<string, number>>({
    legal: 25, pr: 20, consulting: 15, operations: 25, contingency: 15
  });
  
  const [enabledIntegrations, setEnabledIntegrations] = useState<string[]>(['jira', 'servicenow', 'slack', 'pagerduty', 'confluence', 'okta']);
  
  const [successTargets, setSuccessTargets] = useState<Record<string, number>>({
    response_time: 12, stakeholder_alignment: 95, task_completion: 100, decision_velocity: 3, communication_coverage: 100
  });

  const steps: { id: Step; label: string; icon: any; description: string }[] = [
    { id: 'domain', label: 'Domain', icon: Target, description: 'Select strategic domain' },
    { id: 'configure', label: 'Configure', icon: Users, description: 'Team, decisions, communications' },
    { id: 'tasks', label: 'Tasks', icon: ListChecks, description: 'Assignments & dependencies' },
    { id: 'triggers', label: 'Triggers', icon: Zap, description: 'Detection & activation' },
    { id: 'simulate', label: 'Execute', icon: Play, description: 'Run simulation' },
    { id: 'results', label: 'Results', icon: Award, description: 'ROI & summary' },
  ];

  const currentStepIndex = steps.findIndex(s => s.id === currentStep);

  const generateSimulationEvents = (): SimulationEvent[] => {
    const stakeholderNames = config.stakeholders.map(id => 
      STAKEHOLDER_OPTIONS.find(s => s.id === id)?.label || id
    );
    
    const signalSourceNames = triggerConfig.signalSources.map(id =>
      SIGNAL_SOURCES.find(s => s.id === id)?.label || id
    );

    const initialTemplate = config.communicationTemplates.find(t => t.type === 'initial');
    const completionTemplate = config.communicationTemplates.find(t => t.type === 'completion');
    
    const events: SimulationEvent[] = [
      { time: '0:00', event: `${triggerConfig.severity.toUpperCase()} signal detected from: ${signalSourceNames.slice(0, 2).join(', ')}`, type: 'trigger' },
    ];

    triggerConfig.thresholds.forEach((threshold, i) => {
      const operatorText = 
        threshold.operator === 'greater' ? '>' : 
        threshold.operator === 'less' ? '<' : 
        threshold.operator === 'equals' ? '=' :
        threshold.operator === 'contains' ? 'contains' : threshold.operator;
      events.push({
        time: `0:0${i + 1}`,
        event: `Threshold matched: ${threshold.metric} ${operatorText} ${threshold.value}  ${threshold.action.toUpperCase()}`,
        type: 'ai'
      });
    });

    let minute = triggerConfig.thresholds.length + 1;
    
    events.push({
      time: `0:${String(minute).padStart(2, '0')}`,
      event: `AI matching to ${config.domainName} playbook (${config.aiAssistEnabled ? '98%' : '85%'} confidence)`,
      type: 'ai'
    });
    minute++;

    if (initialTemplate) {
      events.push({
        time: `0:${String(minute).padStart(2, '0')}`,
        event: `Sending via ${initialTemplate.channel.toUpperCase()}: "${initialTemplate.subject.replace('{domain}', config.domainName).replace('{severity}', triggerConfig.severity)}"`,
        type: 'ai'
      });
      minute++;
    }

    events.push({
      time: `0:${String(minute).padStart(2, '0')}`,
      event: `Notifying ${stakeholderNames.length} stakeholders via ${config.notificationChannels.join(', ')}`,
      type: 'ai'
    });
    minute++;

    const sortedTasks = [...tasks].sort((a, b) => {
      if (a.dependencies.length === 0 && b.dependencies.length > 0) return -1;
      if (a.dependencies.length > 0 && b.dependencies.length === 0) return 1;
      return 0;
    });

    sortedTasks.slice(0, 4).forEach((task, i) => {
      const assignee = STAKEHOLDER_OPTIONS.find(s => s.id === task.assignedRole)?.label || task.assignedRole;
      const depText = task.dependencies.length > 0 ? ` (after Task ${task.dependencies.join(', ')})` : '';
      const priorityEmoji = task.priority === 'critical' ? '' : task.priority === 'high' ? '' : '';
      
      events.push({
        time: `0:${String(minute).padStart(2, '0')}`,
        event: `${priorityEmoji} ${assignee}: "${task.name}" (~${task.estimatedMinutes}min)${depText}`,
        type: 'task',
        stakeholder: assignee
      });
      minute++;
      
      if (task.requiresApproval) {
        const decisionPoint = config.decisionPoints.find(dp => dp.requiredFor.toLowerCase().includes(task.name.toLowerCase().split(' ')[0]));
        const approver = decisionPoint 
          ? STAKEHOLDER_OPTIONS.find(s => s.id === decisionPoint.approver)?.label 
          : stakeholderNames[0];
        events.push({
          time: `0:${String(minute).padStart(2, '0')}`,
          event: ` Decision Gate: ${approver} approving "${task.name}"`,
          type: 'decision'
        });
        minute++;
      }
    });

    config.decisionPoints.slice(0, 2).forEach((dp) => {
      const approver = STAKEHOLDER_OPTIONS.find(s => s.id === dp.approver)?.label || dp.approver;
      events.push({
        time: `0:${String(Math.min(minute, config.responseTimeTarget - 3)).padStart(2, '0')}`,
        event: ` ${approver} approved: "${dp.name}" (timeout: ${dp.autoApproveTimeout}min)`,
        type: 'decision'
      });
      minute++;
    });

    if (config.autoEscalation && config.escalationPath.length > 0) {
      const firstEscalation = config.escalationPath[0];
      events.push({
        time: `0:${String(Math.min(minute, config.responseTimeTarget - 2)).padStart(2, '0')}`,
        event: ` Escalation path active: ${firstEscalation.role}  ${firstEscalation.action} (${firstEscalation.timeoutMinutes}min)`,
        type: 'escalation'
      });
    }

    if (config.budgetPreApproved > 0) {
      events.push({
        time: `0:${String(Math.min(minute + 1, config.responseTimeTarget - 1)).padStart(2, '0')}`,
        event: ` $${(config.budgetPreApproved / 1000).toFixed(0)}K pre-approved budget unlocked for response`,
        type: 'ai'
      });
    }

    const completionMsg = completionTemplate 
      ? completionTemplate.subject.replace('{domain}', config.domainName).replace('{duration}', `${config.responseTimeTarget}min`)
      : `${config.domainName} Response Complete`;

    events.push({
      time: `0:${String(config.responseTimeTarget).padStart(2, '0')}`,
      event: ` ${completionMsg} - ${stakeholderNames.length} stakeholders, ${tasks.length} tasks, ${config.decisionPoints.length} decisions`,
      type: 'complete'
    });

    return events;
  };

  const runSimulation = () => {
    const events = generateSimulationEvents();
    setSimulationEvents([]);
    setSimulationProgress(0);
    setSimulationComplete(false);

    events.forEach((event, index) => {
      setTimeout(() => {
        setSimulationEvents(prev => [...prev, event]);
        setSimulationProgress(((index + 1) / events.length) * 100);
        
        if (index === events.length - 1) {
          setSimulationComplete(true);
          setShowConfetti(true);
          setTimeout(() => setShowConfetti(false), 5000);
          setTimeout(() => setCurrentStep('results'), 2000);
        }
      }, (index + 1) * 1800);
    });
  };

  useEffect(() => {
    if (currentStep === 'simulate' && simulationEvents.length === 0) {
      setTimeout(runSimulation, 500);
    }
  }, [currentStep]);

  const calculateROI = () => {
    const industryResponseMinutes = TIMING_BENCHMARKS.INDUSTRY_AVERAGE.decisionTime * 60;
    const mPlatformMinutes = config.responseTimeTarget;
    const minutesSaved = industryResponseMinutes - mPlatformMinutes;
    const hoursSavedPerEvent = minutesSaved / 60;
    
    const stakeholderHourlyCost = 350;
    const eventsPerYear = 6;
    const coordinationCostSaved = hoursSavedPerEvent * config.stakeholders.length * stakeholderHourlyCost * eventsPerYear;
    
    const revenueAtRiskPerEvent = config.budgetPreApproved * 3;
    const protectionRate = config.aiAssistEnabled ? 0.85 : 0.65;
    const revenueProtected = revenueAtRiskPerEvent * protectionRate * eventsPerYear;
    
    const riskReduction = config.aiAssistEnabled ? 0.65 : 0.45;
    const speedMultiplier = Math.round(industryResponseMinutes / mPlatformMinutes);
    
    return {
      hoursSaved: Math.round(hoursSavedPerEvent),
      coordinationCostSaved: Math.round(coordinationCostSaved),
      revenueProtected: Math.round(revenueProtected),
      riskReduction: Math.round(riskReduction * 100),
      speedMultiplier: speedMultiplier,
      totalValue: Math.round(coordinationCostSaved + revenueProtected * 0.2),
      tasksConfigured: tasks.length,
      decisionPoints: config.decisionPoints.length,
      escalationLevels: config.escalationPath.length
    };
  };

  const renderDomainSelection = () => (
    <div className="space-y-8">
      <div className="text-center">
        <Badge className="mb-4 bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400">
          Step 1 of 6: IDENTIFY Phase
        </Badge>
        <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4">
          What strategic challenge do you want to prepare for?
        </h2>
        <p className="text-lg text-slate-600 dark:text-slate-400">
          Select a domain to build your personalized playbook
        </p>
      </div>

      <div className="grid md:grid-cols-3 gap-4">
        {STRATEGIC_DOMAINS_ARRAY.map((domain) => {
          const IconComponent = ICON_MAP[domain.icon] || Target;
          const isSelected = config.domain === domain.id;
          
          return (
            <Card 
              key={domain.id}
              className={`cursor-pointer transition-all hover:scale-105 ${
                isSelected 
                  ? 'ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-950/30' 
                  : 'hover:shadow-lg'
              }`}
              onClick={() => setConfig({ ...config, domain: domain.id, domainName: domain.name })}
              data-testid={`domain-card-${domain.id}`}
            >
              <CardContent className="p-6 text-center">
                <div 
                  className="w-12 h-12 mx-auto mb-4 rounded-xl flex items-center justify-center"
                  style={{ backgroundColor: `${domain.color}20` }}
                >
                  <IconComponent className="h-6 w-6" style={{ color: domain.color }} />
                </div>
                <h3 className="font-bold text-slate-900 dark:text-white mb-2">{domain.name}</h3>
                <p className="text-sm text-slate-600 dark:text-slate-400 mb-3">{domain.description}</p>
                <Badge 
                  variant="outline" 
                  className="text-xs"
                  style={{ borderColor: domain.color, color: domain.color }}
                >
                  {domain.category.replace('_', ' ').toUpperCase()}
                </Badge>
              </CardContent>
            </Card>
          );
        })}
      </div>
    </div>
  );

  const renderConfiguration = () => (
    <div className="space-y-8">
      <div className="text-center">
        <Badge className="mb-4 bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400">
          Step 2 of 6: Configure Playbook
        </Badge>
        <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4">
          Configure Your {config.domainName} Playbook
        </h2>
        <p className="text-lg text-slate-600 dark:text-slate-400">
          Set up your team, decision tree, escalation paths, and communications
        </p>
      </div>

      <Tabs value={configTab} onValueChange={setConfigTab} className="w-full">
        <TabsList className="grid w-full grid-cols-7 mb-6">
          <TabsTrigger value="team" className="flex items-center gap-1 text-xs">
            <Users className="h-4 w-4" />
            <span className="hidden lg:inline">Team</span>
          </TabsTrigger>
          <TabsTrigger value="budget" className="flex items-center gap-1 text-xs">
            <PieChart className="h-4 w-4" />
            <span className="hidden lg:inline">Budget</span>
          </TabsTrigger>
          <TabsTrigger value="integrations" className="flex items-center gap-1 text-xs">
            <Plug className="h-4 w-4" />
            <span className="hidden lg:inline">Integrations</span>
          </TabsTrigger>
          <TabsTrigger value="decisions" className="flex items-center gap-1 text-xs">
            <GitBranch className="h-4 w-4" />
            <span className="hidden lg:inline">Decisions</span>
          </TabsTrigger>
          <TabsTrigger value="escalation" className="flex items-center gap-1 text-xs">
            <ArrowUpRight className="h-4 w-4" />
            <span className="hidden lg:inline">Escalation</span>
          </TabsTrigger>
          <TabsTrigger value="comms" className="flex items-center gap-1 text-xs">
            <Send className="h-4 w-4" />
            <span className="hidden lg:inline">Comms</span>
          </TabsTrigger>
          <TabsTrigger value="metrics" className="flex items-center gap-1 text-xs">
            <BarChart3 className="h-4 w-4" />
            <span className="hidden lg:inline">KPIs</span>
          </TabsTrigger>
        </TabsList>

        <TabsContent value="team" className="space-y-6">
          <div className="grid md:grid-cols-2 gap-6">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Building2 className="h-5 w-5 text-blue-600" />
                  Organization Details
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div>
                  <Label htmlFor="companyName">Company Name</Label>
                  <Input
                    id="companyName"
                    placeholder="Your Company"
                    value={config.companyName}
                    onChange={(e) => setConfig({ ...config, companyName: e.target.value })}
                    data-testid="input-company-name"
                  />
                </div>
                <div>
                  <Label>Industry</Label>
                  <Select 
                    value={config.industry} 
                    onValueChange={(v) => setConfig({ ...config, industry: v })}
                  >
                    <SelectTrigger data-testid="select-industry">
                      <SelectValue placeholder="Select industry" />
                    </SelectTrigger>
                    <SelectContent>
                      {INDUSTRIES.map(ind => (
                        <SelectItem key={ind} value={ind}>{ind}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
                <div>
                  <div className="flex justify-between mb-2">
                    <Label>Pre-Approved Budget</Label>
                    <span className="text-lg font-bold text-green-600">${(config.budgetPreApproved / 1000).toFixed(0)}K</span>
                  </div>
                  <Slider
                    value={[config.budgetPreApproved]}
                    onValueChange={(v) => setConfig({ ...config, budgetPreApproved: v[0] })}
                    min={10000}
                    max={500000}
                    step={10000}
                    className="w-full"
                    data-testid="slider-budget"
                  />
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Clock className="h-5 w-5 text-amber-600" />
                  Response Timing
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div>
                  <div className="flex justify-between mb-2">
                    <Label>Target Response Time</Label>
                    <span className="text-lg font-bold text-amber-600">{config.responseTimeTarget} min</span>
                  </div>
                  <Slider
                    value={[config.responseTimeTarget]}
                    onValueChange={(v) => setConfig({ ...config, responseTimeTarget: v[0] })}
                    min={5}
                    max={60}
                    step={1}
                    className="w-full"
                    data-testid="slider-response-time"
                  />
                </div>
                <div className="p-4 bg-amber-50 dark:bg-amber-950/30 rounded-lg">
                  <p className="text-sm text-amber-700 dark:text-amber-400">
                    <strong>Industry Average:</strong> {TIMING_BENCHMARKS.INDUSTRY_AVERAGE.decisionTime} hours
                  </p>
                  <p className="text-sm font-bold text-amber-600 mt-1">
                    You'll be {Math.round((TIMING_BENCHMARKS.INDUSTRY_AVERAGE.decisionTime * 60) / config.responseTimeTarget)}X faster
                  </p>
                </div>
                <div className="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg">
                  <div>
                    <Label className="text-sm">AI-Assisted Drafting</Label>
                    <p className="text-xs text-slate-500">Auto-generate documents</p>
                  </div>
                  <Switch
                    checked={config.aiAssistEnabled}
                    onCheckedChange={(v) => setConfig({ ...config, aiAssistEnabled: v })}
                    data-testid="switch-ai-assist"
                  />
                </div>
              </CardContent>
            </Card>
          </div>

          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Users className="h-5 w-5 text-purple-600" />
                Response Team ({config.stakeholders.length} selected)
              </CardTitle>
              <CardDescription>Select stakeholders to include in the coordinated response</CardDescription>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                {STAKEHOLDER_OPTIONS.map((stakeholder) => {
                  const isSelected = config.stakeholders.includes(stakeholder.id);
                  const Icon = stakeholder.icon;
                  return (
                    <div
                      key={stakeholder.id}
                      className={`flex flex-col items-center p-4 rounded-lg border cursor-pointer transition-all ${
                        isSelected 
                          ? 'bg-purple-50 border-purple-300 dark:bg-purple-950/30 dark:border-purple-700' 
                          : 'hover:bg-slate-50 dark:hover:bg-slate-800'
                      }`}
                      onClick={() => {
                        const newStakeholders = isSelected
                          ? config.stakeholders.filter(s => s !== stakeholder.id)
                          : [...config.stakeholders, stakeholder.id];
                        setConfig({ ...config, stakeholders: newStakeholders });
                      }}
                      data-testid={`stakeholder-${stakeholder.id}`}
                    >
                      <Icon className={`h-6 w-6 mb-2 ${isSelected ? 'text-purple-600' : 'text-slate-400'}`} />
                      <span className="text-sm font-medium text-center">{stakeholder.label}</span>
                      <Badge variant="outline" className="mt-1 text-xs">L{stakeholder.level}</Badge>
                    </div>
                  );
                })}
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Bell className="h-5 w-5 text-blue-600" />
                Notification Channels
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="flex flex-wrap gap-3">
                {NOTIFICATION_OPTIONS.map((channel) => {
                  const isSelected = config.notificationChannels.includes(channel.id);
                  const Icon = channel.icon;
                  return (
                    <Badge
                      key={channel.id}
                      variant={isSelected ? "default" : "outline"}
                      className={`cursor-pointer px-4 py-2 text-base ${isSelected ? 'bg-blue-600' : ''}`}
                      onClick={() => {
                        const newChannels = isSelected
                          ? config.notificationChannels.filter(c => c !== channel.id)
                          : [...config.notificationChannels, channel.id];
                        setConfig({ ...config, notificationChannels: newChannels });
                      }}
                      data-testid={`channel-${channel.id}`}
                    >
                      <Icon className="h-4 w-4 mr-2" />
                      {channel.label}
                    </Badge>
                  );
                })}
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="decisions" className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <GitBranch className="h-5 w-5 text-indigo-600" />
                Decision Tree Configuration
              </CardTitle>
              <CardDescription>Define approval gates and decision points in your playbook</CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              {config.decisionPoints.map((dp, index) => (
                <div key={dp.id} className="p-4 border rounded-lg bg-slate-50 dark:bg-slate-800/50">
                  <div className="flex items-start justify-between gap-4">
                    <div className="flex items-center gap-3">
                      <div className="w-8 h-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 font-bold">
                        {index + 1}
                      </div>
                      <div className="flex-1">
                        <Input
                          value={dp.name}
                          onChange={(e) => {
                            const updated = [...config.decisionPoints];
                            updated[index].name = e.target.value;
                            setConfig({ ...config, decisionPoints: updated });
                          }}
                          className="font-medium mb-2"
                          placeholder="Decision point name"
                          data-testid={`decision-name-${index}`}
                        />
                        <Textarea
                          value={dp.description}
                          onChange={(e) => {
                            const updated = [...config.decisionPoints];
                            updated[index].description = e.target.value;
                            setConfig({ ...config, decisionPoints: updated });
                          }}
                          placeholder="Description of what requires approval"
                          className="text-sm resize-none"
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>
                  <div className="grid grid-cols-3 gap-4 mt-4">
                    <div>
                      <Label className="text-xs">Approver</Label>
                      <Select 
                        value={dp.approver}
                        onValueChange={(v) => {
                          const updated = [...config.decisionPoints];
                          updated[index].approver = v;
                          setConfig({ ...config, decisionPoints: updated });
                        }}
                      >
                        <SelectTrigger className="mt-1">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          {STAKEHOLDER_OPTIONS.map(s => (
                            <SelectItem key={s.id} value={s.id}>{s.label}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label className="text-xs">Required For</Label>
                      <Input
                        value={dp.requiredFor}
                        onChange={(e) => {
                          const updated = [...config.decisionPoints];
                          updated[index].requiredFor = e.target.value;
                          setConfig({ ...config, decisionPoints: updated });
                        }}
                        className="mt-1"
                        placeholder="e.g., Response execution"
                      />
                    </div>
                    <div>
                      <Label className="text-xs">Auto-approve timeout</Label>
                      <div className="flex items-center gap-2 mt-1">
                        <Input
                          type="number"
                          value={dp.autoApproveTimeout}
                          onChange={(e) => {
                            const updated = [...config.decisionPoints];
                            updated[index].autoApproveTimeout = parseInt(e.target.value) || 0;
                            setConfig({ ...config, decisionPoints: updated });
                          }}
                          className="w-20"
                        />
                        <span className="text-sm text-slate-500">min</span>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
              <Button
                variant="outline"
                onClick={() => {
                  setConfig({
                    ...config,
                    decisionPoints: [...config.decisionPoints, {
                      id: String(config.decisionPoints.length + 1),
                      name: 'New Decision Point',
                      description: '',
                      approver: 'ceo',
                      requiredFor: '',
                      autoApproveTimeout: 5
                    }]
                  });
                }}
                className="w-full"
                data-testid="button-add-decision"
              >
                <Plus className="h-4 w-4 mr-2" />
                Add Decision Point
              </Button>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="escalation" className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <ArrowUpRight className="h-5 w-5 text-orange-600" />
                Escalation Path
              </CardTitle>
              <CardDescription>Define what happens when stakeholders don't respond in time</CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                {config.escalationPath.map((level, index) => (
                  <div key={level.id} className="flex items-center gap-4">
                    <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white ${
                      index === 0 ? 'bg-green-500' : index === 1 ? 'bg-amber-500' : 'bg-red-500'
                    }`}>
                      L{level.level}
                    </div>
                    <div className="flex-1 grid grid-cols-3 gap-4">
                      <Input
                        value={level.role}
                        onChange={(e) => {
                          const updated = [...config.escalationPath];
                          updated[index].role = e.target.value;
                          setConfig({ ...config, escalationPath: updated });
                        }}
                        placeholder="Role name"
                        data-testid={`escalation-role-${index}`}
                      />
                      <div className="flex items-center gap-2">
                        <Input
                          type="number"
                          value={level.timeoutMinutes}
                          onChange={(e) => {
                            const updated = [...config.escalationPath];
                            updated[index].timeoutMinutes = parseInt(e.target.value) || 0;
                            setConfig({ ...config, escalationPath: updated });
                          }}
                          className="w-20"
                        />
                        <span className="text-sm text-slate-500">min timeout</span>
                      </div>
                      <Input
                        value={level.action}
                        onChange={(e) => {
                          const updated = [...config.escalationPath];
                          updated[index].action = e.target.value;
                          setConfig({ ...config, escalationPath: updated });
                        }}
                        placeholder="Action if no response"
                      />
                    </div>
                    {index < config.escalationPath.length - 1 && (
                      <ChevronDown className="h-5 w-5 text-slate-400" />
                    )}
                  </div>
                ))}
              </div>
              <div className="mt-4 p-4 bg-orange-50 dark:bg-orange-950/30 rounded-lg">
                <p className="text-sm text-orange-700 dark:text-orange-400">
                  <strong>Auto-Escalation:</strong> If enabled, the system automatically escalates when timeouts are reached
                </p>
                <div className="flex items-center gap-2 mt-2">
                  <Switch
                    checked={config.autoEscalation}
                    onCheckedChange={(v) => setConfig({ ...config, autoEscalation: v })}
                  />
                  <Label>Enable auto-escalation</Label>
                </div>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="comms" className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Send className="h-5 w-5 text-blue-600" />
                Communication Templates
              </CardTitle>
              <CardDescription>Pre-configure messages that go out automatically</CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              {config.communicationTemplates.map((template, index) => (
                <div key={template.id} className="p-4 border rounded-lg">
                  <div className="flex items-center gap-3 mb-3">
                    <Badge variant={
                      template.type === 'initial' ? 'default' :
                      template.type === 'escalation' ? 'destructive' :
                      template.type === 'completion' ? 'secondary' : 'outline'
                    }>
                      {template.type.charAt(0).toUpperCase() + template.type.slice(1)}
                    </Badge>
                    <Select 
                      value={template.channel}
                      onValueChange={(v) => {
                        const updated = [...config.communicationTemplates];
                        updated[index].channel = v;
                        setConfig({ ...config, communicationTemplates: updated });
                      }}
                    >
                      <SelectTrigger className="w-32">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        {NOTIFICATION_OPTIONS.map(c => (
                          <SelectItem key={c.id} value={c.id}>{c.label}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="space-y-3">
                    <div>
                      <Label className="text-xs">Subject Line</Label>
                      <Input
                        value={template.subject}
                        onChange={(e) => {
                          const updated = [...config.communicationTemplates];
                          updated[index].subject = e.target.value;
                          setConfig({ ...config, communicationTemplates: updated });
                        }}
                        placeholder="Email subject or notification title"
                        className="mt-1"
                      />
                    </div>
                    <div>
                      <Label className="text-xs">Message Template</Label>
                      <Textarea
                        value={template.message}
                        onChange={(e) => {
                          const updated = [...config.communicationTemplates];
                          updated[index].message = e.target.value;
                          setConfig({ ...config, communicationTemplates: updated });
                        }}
                        placeholder="Message content. Use {domain}, {severity}, {task}, {duration} as variables."
                        className="mt-1"
                        rows={3}
                      />
                    </div>
                  </div>
                </div>
              ))}
              <p className="text-sm text-slate-500">
                <strong>Variables:</strong> {'{domain}'}, {'{severity}'}, {'{task}'}, {'{duration}'}, {'{stakeholder}'}
              </p>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="budget" className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <PieChart className="h-5 w-5 text-green-600" />
                Budget Allocation
              </CardTitle>
              <CardDescription>
                Pre-approved budget: ${(config.budgetPreApproved / 1000).toFixed(0)}K - Allocate across response categories
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              {BUDGET_CATEGORIES.map((category) => {
                const Icon = category.icon;
                const amount = Math.round((budgetBreakdown[category.id] / 100) * config.budgetPreApproved);
                return (
                  <div key={category.id} className="space-y-2">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-2">
                        <Icon className="h-4 w-4 text-slate-500" />
                        <Label className="font-medium">{category.label}</Label>
                      </div>
                      <div className="text-right">
                        <span className="font-bold text-green-600">${(amount / 1000).toFixed(0)}K</span>
                        <span className="text-sm text-slate-500 ml-2">({budgetBreakdown[category.id]}%)</span>
                      </div>
                    </div>
                    <Slider
                      value={[budgetBreakdown[category.id]]}
                      onValueChange={(v) => setBudgetBreakdown({ ...budgetBreakdown, [category.id]: v[0] })}
                      min={0}
                      max={50}
                      step={5}
                      className="w-full"
                      data-testid={`slider-budget-${category.id}`}
                    />
                  </div>
                );
              })}
              <div className="p-4 bg-slate-50 dark:bg-slate-800 rounded-lg mt-4">
                <div className="flex justify-between items-center">
                  <span className="font-medium">Total Allocation</span>
                  <span className={`font-bold ${Object.values(budgetBreakdown).reduce((a, b) => a + b, 0) === 100 ? 'text-green-600' : 'text-amber-600'}`}>
                    {Object.values(budgetBreakdown).reduce((a, b) => a + b, 0)}%
                  </span>
                </div>
                {Object.values(budgetBreakdown).reduce((a, b) => a + b, 0) !== 100 && (
                  <p className="text-xs text-amber-600 mt-1">Adjust allocations to total 100%</p>
                )}
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="integrations" className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Plug className="h-5 w-5 text-purple-600" />
                Enterprise Integrations
              </CardTitle>
              <CardDescription>Connect M Platform to your existing tools for seamless execution</CardDescription>
            </CardHeader>
            <CardContent>
              <div className="grid md:grid-cols-2 gap-4">
                {ENTERPRISE_INTEGRATIONS.map((integration) => {
                  const isEnabled = enabledIntegrations.includes(integration.id);
                  return (
                    <div
                      key={integration.id}
                      className={`p-4 border rounded-lg cursor-pointer transition-all ${
                        isEnabled 
                          ? 'bg-purple-50 border-purple-300 dark:bg-purple-950/30 dark:border-purple-700' 
                          : 'hover:bg-slate-50 dark:hover:bg-slate-800'
                      }`}
                      onClick={() => {
                        const newIntegrations = isEnabled
                          ? enabledIntegrations.filter(i => i !== integration.id)
                          : [...enabledIntegrations, integration.id];
                        setEnabledIntegrations(newIntegrations);
                      }}
                      data-testid={`integration-${integration.id}`}
                    >
                      <div className="flex items-center justify-between mb-2">
                        <span className="font-medium">{integration.label}</span>
                        {isEnabled ? (
                          <CircleCheck className="h-5 w-5 text-green-600" />
                        ) : (
                          <CircleX className="h-5 w-5 text-slate-300" />
                        )}
                      </div>
                      <p className="text-sm text-slate-500">{integration.description}</p>
                      <Badge variant="outline" className="mt-2 text-xs">{integration.category.toUpperCase()}</Badge>
                    </div>
                  );
                })}
              </div>
              <div className="mt-6 p-4 bg-blue-50 dark:bg-blue-950/30 rounded-lg">
                <p className="text-sm text-blue-700 dark:text-blue-400">
                  <strong>{enabledIntegrations.length} integrations enabled.</strong> When triggered, M will automatically create tasks in Jira, send alerts via Slack, and update ServiceNow tickets.
                </p>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="metrics" className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <BarChart3 className="h-5 w-5 text-blue-600" />
                Success Metrics & KPIs
              </CardTitle>
              <CardDescription>Define measurable targets to track playbook effectiveness</CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              {SUCCESS_METRICS.map((metric) => (
                <div key={metric.id} className="p-4 border rounded-lg bg-slate-50 dark:bg-slate-800/50">
                  <div className="flex items-start justify-between mb-3">
                    <div>
                      <h4 className="font-medium">{metric.label}</h4>
                      <p className="text-sm text-slate-500">{metric.description}</p>
                    </div>
                    <Badge variant="outline">{metric.unit}</Badge>
                  </div>
                  <div className="flex items-center gap-4">
                    <Label className="text-xs w-16">Target:</Label>
                    <Slider
                      value={[successTargets[metric.id]]}
                      onValueChange={(v) => setSuccessTargets({ ...successTargets, [metric.id]: v[0] })}
                      min={metric.unit === 'minutes' || metric.unit === 'min/decision' ? 1 : 50}
                      max={metric.unit === 'minutes' ? 60 : metric.unit === 'min/decision' ? 15 : 100}
                      step={1}
                      className="flex-1"
                      data-testid={`slider-kpi-${metric.id}`}
                    />
                    <span className="font-bold text-blue-600 w-20 text-right" data-testid={`value-kpi-${metric.id}`}>
                      {successTargets[metric.id]} {metric.unit}
                    </span>
                  </div>
                </div>
              ))}
              <div className="p-4 bg-green-50 dark:bg-green-950/30 rounded-lg">
                <p className="text-sm text-green-700 dark:text-green-400">
                  <strong>Automated Tracking:</strong> M will measure these KPIs in real-time during execution and include them in post-action reports for continuous improvement.
                </p>
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  );

  const renderTaskAssignments = () => (
    <div className="space-y-8">
      <div className="text-center">
        <Badge className="mb-4 bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400">
          Step 3 of 6: EXECUTE Phase Setup
        </Badge>
        <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4">
          Configure Task Assignments
        </h2>
        <p className="text-lg text-slate-600 dark:text-slate-400">
          Define tasks, assign roles, and set dependencies for your {config.domainName} response
        </p>
      </div>

      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <ListChecks className="h-5 w-5 text-purple-600" />
            Execution Tasks ({tasks.length} configured)
          </CardTitle>
          <CardDescription>Tasks execute in order based on dependencies. Drag to reorder.</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {tasks.map((task, index) => (
            <div key={task.id} className="p-4 border rounded-lg bg-slate-50 dark:bg-slate-800/50">
              <div className="flex items-start gap-4">
                <div className="flex flex-col items-center">
                  <GripVertical className="h-5 w-5 text-slate-400 cursor-move" />
                  <div className={`mt-2 w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold ${
                    task.priority === 'critical' ? 'bg-red-500' :
                    task.priority === 'high' ? 'bg-orange-500' :
                    task.priority === 'medium' ? 'bg-blue-500' : 'bg-gray-500'
                  }`}>
                    {index + 1}
                  </div>
                </div>
                <div className="flex-1 space-y-3">
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <Label className="text-xs">Task Name</Label>
                      <Input
                        value={task.name}
                        onChange={(e) => {
                          const updated = [...tasks];
                          updated[index].name = e.target.value;
                          setTasks(updated);
                        }}
                        className="mt-1 font-medium"
                        data-testid={`task-name-${index}`}
                      />
                    </div>
                    <div>
                      <Label className="text-xs">Assigned Role</Label>
                      <Select 
                        value={task.assignedRole}
                        onValueChange={(v) => {
                          const updated = [...tasks];
                          updated[index].assignedRole = v;
                          setTasks(updated);
                        }}
                      >
                        <SelectTrigger className="mt-1">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          {STAKEHOLDER_OPTIONS.map(s => (
                            <SelectItem key={s.id} value={s.id}>{s.label}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                  <div>
                    <Label className="text-xs">Description</Label>
                    <Textarea
                      value={task.description}
                      onChange={(e) => {
                        const updated = [...tasks];
                        updated[index].description = e.target.value;
                        setTasks(updated);
                      }}
                      className="mt-1 resize-none"
                      rows={2}
                      placeholder="What needs to be done"
                    />
                  </div>
                  <div className="grid grid-cols-4 gap-4 items-end">
                    <div>
                      <Label className="text-xs">Est. Duration</Label>
                      <div className="flex items-center gap-2 mt-1">
                        <Input
                          type="number"
                          value={task.estimatedMinutes}
                          onChange={(e) => {
                            const updated = [...tasks];
                            updated[index].estimatedMinutes = parseInt(e.target.value) || 0;
                            setTasks(updated);
                          }}
                          className="w-20"
                        />
                        <span className="text-sm text-slate-500">min</span>
                      </div>
                    </div>
                    <div>
                      <Label className="text-xs">Priority</Label>
                      <Select 
                        value={task.priority}
                        onValueChange={(v: 'critical' | 'high' | 'medium' | 'low') => {
                          const updated = [...tasks];
                          updated[index].priority = v;
                          setTasks(updated);
                        }}
                      >
                        <SelectTrigger className="mt-1">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="critical">Critical</SelectItem>
                          <SelectItem value="high">High</SelectItem>
                          <SelectItem value="medium">Medium</SelectItem>
                          <SelectItem value="low">Low</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label className="text-xs">Dependencies</Label>
                      <div className="flex flex-wrap gap-1 mt-1">
                        {task.dependencies.length > 0 ? (
                          task.dependencies.map(dep => (
                            <Badge key={dep} variant="outline" className="text-xs">
                              Task {dep}
                            </Badge>
                          ))
                        ) : (
                          <Badge variant="outline" className="text-xs text-slate-400">None</Badge>
                        )}
                      </div>
                    </div>
                    <div className="flex items-center gap-2">
                      <Checkbox
                        checked={task.requiresApproval}
                        onCheckedChange={(v) => {
                          const updated = [...tasks];
                          updated[index].requiresApproval = v as boolean;
                          setTasks(updated);
                        }}
                      />
                      <Label className="text-xs">Requires Approval</Label>
                    </div>
                  </div>
                </div>
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={() => setTasks(tasks.filter(t => t.id !== task.id))}
                  className="text-red-500 hover:text-red-700"
                >
                  <Trash2 className="h-4 w-4" />
                </Button>
              </div>
            </div>
          ))}
          <Button
            variant="outline"
            onClick={() => {
              setTasks([...tasks, {
                id: String(tasks.length + 1),
                name: 'New Task',
                description: '',
                assignedRole: 'coo',
                estimatedMinutes: 5,
                dependencies: tasks.length > 0 ? [tasks[tasks.length - 1].id] : [],
                requiresApproval: false,
                priority: 'medium'
              }]);
            }}
            className="w-full"
            data-testid="button-add-task"
          >
            <Plus className="h-4 w-4 mr-2" />
            Add Task
          </Button>
        </CardContent>
      </Card>

      <Card className="bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-950/30 dark:to-indigo-950/30">
        <CardContent className="p-6">
          <div className="flex items-center justify-between">
            <div>
              <h4 className="font-bold text-slate-900 dark:text-white">Task Flow Preview</h4>
              <p className="text-sm text-slate-600 dark:text-slate-400">
                Total estimated time: {tasks.reduce((acc, t) => acc + t.estimatedMinutes, 0)} minutes
              </p>
            </div>
            <div className="flex items-center gap-2">
              {tasks.slice(0, 5).map((task, i) => (
                <div key={task.id} className="flex items-center">
                  <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold ${
                    task.priority === 'critical' ? 'bg-red-500' :
                    task.priority === 'high' ? 'bg-orange-500' : 'bg-blue-500'
                  }`}>
                    {i + 1}
                  </div>
                  {i < Math.min(4, tasks.length - 1) && (
                    <ChevronRight className="h-4 w-4 text-slate-400 mx-1" />
                  )}
                </div>
              ))}
              {tasks.length > 5 && (
                <Badge variant="outline">+{tasks.length - 5} more</Badge>
              )}
            </div>
          </div>
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Users className="h-5 w-5 text-emerald-600" />
            RACI Matrix
          </CardTitle>
          <CardDescription>Responsibility assignment for each task across stakeholders</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="overflow-x-auto">
            <table className="w-full text-sm">
              <thead>
                <tr className="border-b">
                  <th className="text-left p-2 font-medium">Task</th>
                  {config.stakeholders.slice(0, 5).map(id => {
                    const s = STAKEHOLDER_OPTIONS.find(opt => opt.id === id);
                    return s ? (
                      <th key={id} className="text-center p-2 font-medium">{s.label}</th>
                    ) : null;
                  })}
                </tr>
              </thead>
              <tbody>
                {tasks.map((task, taskIndex) => {
                  const approverStakeholder = config.decisionPoints.find(dp => dp.requiredFor.toLowerCase().includes(task.name.toLowerCase().split(' ')[0]))?.approver;
                  const dependencyRoles = tasks.filter(t => task.dependencies.includes(t.id)).map(t => t.assignedRole);
                  
                  return (
                    <tr key={task.id} className="border-b hover:bg-slate-50 dark:hover:bg-slate-800/50" data-testid={`raci-row-${task.id}`}>
                      <td className="p-2 font-medium">{task.name}</td>
                      {config.stakeholders.slice(0, 5).map(id => {
                        const isResponsible = task.assignedRole === id;
                        const isAccountable = task.requiresApproval && approverStakeholder === id;
                        const isConsulted = dependencyRoles.includes(id) && !isResponsible;
                        
                        let badge = null;
                        let role = 'I';
                        if (isResponsible) { badge = <Badge className="bg-blue-500 text-white">R</Badge>; role = 'R'; }
                        else if (isAccountable) { badge = <Badge className="bg-purple-500 text-white">A</Badge>; role = 'A'; }
                        else if (isConsulted) { badge = <Badge className="bg-amber-500 text-white">C</Badge>; role = 'C'; }
                        else badge = <Badge variant="outline" className="text-slate-400">I</Badge>;
                        
                        return (
                          <td key={id} className="text-center p-2" data-testid={`raci-cell-${task.id}-${id}-${role}`}>{badge}</td>
                        );
                      })}
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
          <div className="flex gap-4 mt-4 text-xs text-slate-500">
            <span><Badge className="bg-blue-500 text-white mr-1">R</Badge> Responsible</span>
            <span><Badge className="bg-purple-500 text-white mr-1">A</Badge> Accountable</span>
            <span><Badge className="bg-amber-500 text-white mr-1">C</Badge> Consulted</span>
            <span><Badge variant="outline" className="text-slate-400 mr-1">I</Badge> Informed</span>
          </div>
        </CardContent>
      </Card>
    </div>
  );

  const renderTriggerSetup = () => (
    <div className="space-y-8">
      <div className="text-center">
        <Badge className="mb-4 bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400">
          Step 4 of 6: DETECT Phase
        </Badge>
        <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4">
          Configure Detection & Triggers
        </h2>
        <p className="text-lg text-slate-600 dark:text-slate-400">
          Define signal sources, thresholds, and activation rules for your {config.domainName} playbook
        </p>
      </div>

      <div className="grid md:grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Network className="h-5 w-5 text-blue-600" />
              Signal Sources
            </CardTitle>
            <CardDescription>Where should M Platform monitor for signals?</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-2 gap-3">
              {SIGNAL_SOURCES.map((source) => {
                const isSelected = triggerConfig.signalSources.includes(source.id);
                return (
                  <div
                    key={source.id}
                    className={`p-3 rounded-lg border cursor-pointer transition-all ${
                      isSelected 
                        ? 'bg-blue-50 border-blue-300 dark:bg-blue-950/30 dark:border-blue-700' 
                        : 'hover:bg-slate-50 dark:hover:bg-slate-800'
                    }`}
                    onClick={() => {
                      const newSources = isSelected
                        ? triggerConfig.signalSources.filter(s => s !== source.id)
                        : [...triggerConfig.signalSources, source.id];
                      setTriggerConfig({ ...triggerConfig, signalSources: newSources });
                    }}
                    data-testid={`signal-${source.id}`}
                  >
                    <div className="flex items-center gap-2">
                      <Checkbox checked={isSelected} />
                      <span className="text-sm font-medium">{source.label}</span>
                    </div>
                  </div>
                );
              })}
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Zap className="h-5 w-5 text-amber-600" />
              Trigger Type
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="grid grid-cols-2 gap-3">
              {[
                { id: 'system', label: 'AI Detection', desc: 'Automatic pattern recognition' },
                { id: 'manual', label: 'Manual Activation', desc: 'Executive-initiated' },
                { id: 'integration', label: 'External Webhook', desc: 'From connected tools' },
                { id: 'schedule', label: 'Scheduled Check', desc: 'Regular monitoring' },
              ].map((trigger) => (
                <div
                  key={trigger.id}
                  className={`p-3 rounded-lg border cursor-pointer transition-all ${
                    triggerConfig.triggerType === trigger.id
                      ? 'bg-amber-50 border-amber-300 dark:bg-amber-950/30 dark:border-amber-700'
                      : 'hover:bg-slate-50 dark:hover:bg-slate-800'
                  }`}
                  onClick={() => setTriggerConfig({ ...triggerConfig, triggerType: trigger.id })}
                  data-testid={`trigger-type-${trigger.id}`}
                >
                  <div className="font-medium text-sm">{trigger.label}</div>
                  <div className="text-xs text-slate-500">{trigger.desc}</div>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
      </div>

      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <TrendingUp className="h-5 w-5 text-green-600" />
            Threshold Conditions
          </CardTitle>
          <CardDescription>When these conditions are met, the specified action is triggered</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {triggerConfig.thresholds.map((threshold, index) => (
            <div key={threshold.id} className="flex items-center gap-4 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
              <span className="text-sm font-medium text-slate-500">When</span>
              <Input
                value={threshold.metric}
                onChange={(e) => {
                  const updated = [...triggerConfig.thresholds];
                  updated[index].metric = e.target.value;
                  setTriggerConfig({ ...triggerConfig, thresholds: updated });
                }}
                className="w-40"
                placeholder="Metric name"
              />
              <Select 
                value={threshold.operator}
                onValueChange={(v: 'greater' | 'less' | 'equals' | 'contains') => {
                  const updated = [...triggerConfig.thresholds];
                  updated[index].operator = v;
                  setTriggerConfig({ ...triggerConfig, thresholds: updated });
                }}
              >
                <SelectTrigger className="w-32">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="greater">is greater than</SelectItem>
                  <SelectItem value="less">is less than</SelectItem>
                  <SelectItem value="equals">equals</SelectItem>
                  <SelectItem value="contains">contains</SelectItem>
                </SelectContent>
              </Select>
              <Input
                value={threshold.value}
                onChange={(e) => {
                  const updated = [...triggerConfig.thresholds];
                  updated[index].value = e.target.value;
                  setTriggerConfig({ ...triggerConfig, thresholds: updated });
                }}
                className="w-24"
                placeholder="Value"
              />
              <span className="text-sm font-medium text-slate-500">then</span>
              <Select 
                value={threshold.action}
                onValueChange={(v: 'alert' | 'activate' | 'escalate') => {
                  const updated = [...triggerConfig.thresholds];
                  updated[index].action = v;
                  setTriggerConfig({ ...triggerConfig, thresholds: updated });
                }}
              >
                <SelectTrigger className="w-32">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="alert">Send Alert</SelectItem>
                  <SelectItem value="activate">Activate Playbook</SelectItem>
                  <SelectItem value="escalate">Escalate</SelectItem>
                </SelectContent>
              </Select>
              <Button
                variant="ghost"
                size="sm"
                onClick={() => {
                  setTriggerConfig({
                    ...triggerConfig,
                    thresholds: triggerConfig.thresholds.filter(t => t.id !== threshold.id)
                  });
                }}
                className="text-red-500"
              >
                <Trash2 className="h-4 w-4" />
              </Button>
            </div>
          ))}
          <Button
            variant="outline"
            onClick={() => {
              setTriggerConfig({
                ...triggerConfig,
                thresholds: [...triggerConfig.thresholds, {
                  id: String(triggerConfig.thresholds.length + 1),
                  metric: '',
                  operator: 'greater',
                  value: '',
                  action: 'alert'
                }]
              });
            }}
            className="w-full"
          >
            <Plus className="h-4 w-4 mr-2" />
            Add Threshold
          </Button>
        </CardContent>
      </Card>

      <div className="grid md:grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <AlertTriangle className="h-5 w-5 text-red-600" />
              Severity Level
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-4 gap-3">
              {[
                { id: 'critical', label: 'Critical', color: 'bg-red-500' },
                { id: 'high', label: 'High', color: 'bg-orange-500' },
                { id: 'medium', label: 'Medium', color: 'bg-yellow-500' },
                { id: 'low', label: 'Low', color: 'bg-gray-400' },
              ].map((sev) => (
                <div
                  key={sev.id}
                  className={`p-3 rounded-lg border cursor-pointer transition-all text-center ${
                    triggerConfig.severity === sev.id
                      ? 'ring-2 ring-offset-2 ring-blue-500'
                      : 'hover:bg-slate-50 dark:hover:bg-slate-800'
                  }`}
                  onClick={() => setTriggerConfig({ ...triggerConfig, severity: sev.id })}
                  data-testid={`severity-${sev.id}`}
                >
                  <div className={`w-4 h-4 rounded-full mx-auto mb-2 ${sev.color}`} />
                  <span className="text-sm font-medium">{sev.label}</span>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Shield className="h-5 w-5 text-blue-600" />
              Activation Controls
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg">
              <div>
                <Label className="text-sm">Require Confirmation</Label>
                <p className="text-xs text-slate-500">Human must approve activation</p>
              </div>
              <Switch
                checked={triggerConfig.confirmationRequired}
                onCheckedChange={(v) => setTriggerConfig({ ...triggerConfig, confirmationRequired: v })}
                data-testid="switch-confirmation-required"
              />
            </div>
            <div className="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg">
              <div>
                <Label className="text-sm">Auto-Activate on Timeout</Label>
                <p className="text-xs text-slate-500">If no response in 5 min</p>
              </div>
              <Switch
                checked={triggerConfig.autoActivate}
                onCheckedChange={(v) => setTriggerConfig({ ...triggerConfig, autoActivate: v })}
                data-testid="switch-auto-activate"
              />
            </div>
          </CardContent>
        </Card>
      </div>

      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <GitBranch className="h-5 w-5 text-purple-600" />
            Scenario Branching
          </CardTitle>
          <CardDescription>Different response paths based on trigger severity - actions are pre-configured for each level</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {SCENARIO_BRANCHES.map((branch) => (
              <div 
                key={branch.severity}
                className={`p-4 border rounded-lg transition-all cursor-pointer ${
                  triggerConfig.severity === branch.severity 
                    ? 'ring-2 ring-blue-500 bg-slate-50 dark:bg-slate-800/50' 
                    : 'opacity-60 hover:opacity-80'
                }`}
                onClick={() => setTriggerConfig({ ...triggerConfig, severity: branch.severity })}
                data-testid={`scenario-branch-${branch.severity}`}
              >
                <div className="flex items-center gap-3 mb-3">
                  <div className={`w-4 h-4 rounded-full ${branch.color}`} />
                  <span className="font-semibold">{branch.label}</span>
                  {triggerConfig.severity === branch.severity && (
                    <Badge className="bg-blue-500 text-white ml-auto">Active Path</Badge>
                  )}
                </div>
                <div className="grid md:grid-cols-3 gap-2">
                  {branch.actions.map((action, i) => (
                    <div key={i} className="flex items-center gap-2 text-sm">
                      <CheckCircle2 className={`h-4 w-4 ${triggerConfig.severity === branch.severity ? 'text-green-600' : 'text-slate-300'}`} />
                      <span className={triggerConfig.severity === branch.severity ? '' : 'text-slate-400'}>{action}</span>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
          <div className="mt-4 p-4 bg-purple-50 dark:bg-purple-950/30 rounded-lg">
            <p className="text-sm text-purple-700 dark:text-purple-400">
              <strong>Dynamic Routing:</strong> M Platform automatically routes to the appropriate response path based on detected signal severity. Change severity above to see different response configurations.
            </p>
          </div>
        </CardContent>
      </Card>
    </div>
  );

  const renderSimulation = () => (
    <div className="space-y-8">
      {showConfetti && <Confetti recycle={false} numberOfPieces={300} />}
      
      <div className="text-center">
        <Badge className="mb-4 bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400">
          Step 5 of 6: Execute Simulation
        </Badge>
        <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4">
          {simulationComplete ? 'Response Coordinated!' : 'Running Your Personalized Simulation...'}
        </h2>
        <p className="text-lg text-slate-600 dark:text-slate-400">
          {config.companyName || 'Your organization'} responding to {config.domainName} scenario
        </p>
      </div>

      <div className="max-w-3xl mx-auto">
        <Card className="mb-6">
          <CardContent className="p-6">
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-3">
                <Timer className="h-6 w-6 text-purple-600" />
                <span className="text-lg font-semibold">Execution Progress</span>
              </div>
              <Badge variant={simulationComplete ? "default" : "secondary"} className={simulationComplete ? "bg-green-600" : ""}>
                {simulationComplete ? 'Complete' : 'In Progress'}
              </Badge>
            </div>
            <Progress value={simulationProgress} className="h-3 mb-2" />
            <div className="flex justify-between text-sm text-slate-500">
              <span>Target: {config.responseTimeTarget} min</span>
              <span>{Math.round(simulationProgress)}% complete</span>
            </div>
          </CardContent>
        </Card>

        <div className="grid md:grid-cols-4 gap-4 mb-6">
          <Card className="bg-slate-50 dark:bg-slate-800">
            <CardContent className="p-4 text-center">
              <div className="text-2xl font-bold text-purple-600">{config.stakeholders.length}</div>
              <div className="text-xs text-slate-500">Stakeholders</div>
            </CardContent>
          </Card>
          <Card className="bg-slate-50 dark:bg-slate-800">
            <CardContent className="p-4 text-center">
              <div className="text-2xl font-bold text-blue-600">{tasks.length}</div>
              <div className="text-xs text-slate-500">Tasks</div>
            </CardContent>
          </Card>
          <Card className="bg-slate-50 dark:bg-slate-800">
            <CardContent className="p-4 text-center">
              <div className="text-2xl font-bold text-amber-600">{config.decisionPoints.length}</div>
              <div className="text-xs text-slate-500">Decisions</div>
            </CardContent>
          </Card>
          <Card className="bg-slate-50 dark:bg-slate-800">
            <CardContent className="p-4 text-center">
              <div className="text-2xl font-bold text-green-600">${(config.budgetPreApproved/1000).toFixed(0)}K</div>
              <div className="text-xs text-slate-500">Budget</div>
            </CardContent>
          </Card>
        </div>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <FileText className="h-5 w-5 text-blue-600" />
              Live Execution Log
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3 max-h-96 overflow-y-auto">
              {simulationEvents.map((event, index) => (
                <div 
                  key={index}
                  className={`flex items-start gap-4 p-4 rounded-lg animate-in fade-in slide-in-from-left duration-500 ${
                    event.type === 'complete' 
                      ? 'bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800'
                      : event.type === 'trigger'
                      ? 'bg-red-50 dark:bg-red-950/30'
                      : event.type === 'ai'
                      ? 'bg-blue-50 dark:bg-blue-950/30'
                      : event.type === 'decision'
                      ? 'bg-purple-50 dark:bg-purple-950/30'
                      : event.type === 'task'
                      ? 'bg-indigo-50 dark:bg-indigo-950/30'
                      : 'bg-slate-50 dark:bg-slate-800'
                  }`}
                >
                  <div className="min-w-16 font-mono text-sm font-bold text-slate-600 dark:text-slate-400">
                    {event.time}
                  </div>
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      {event.type === 'complete' && <CheckCircle2 className="h-4 w-4 text-green-600" />}
                      {event.type === 'trigger' && <AlertTriangle className="h-4 w-4 text-red-600" />}
                      {event.type === 'ai' && <Sparkles className="h-4 w-4 text-blue-600" />}
                      {event.type === 'task' && <ListChecks className="h-4 w-4 text-indigo-600" />}
                      {event.type === 'decision' && <GitBranch className="h-4 w-4 text-purple-600" />}
                      {event.type === 'stakeholder' && <Users className="h-4 w-4 text-emerald-600" />}
                      {event.type === 'escalation' && <ArrowUpRight className="h-4 w-4 text-amber-600" />}
                      <span className={`font-medium ${event.type === 'complete' ? 'text-green-700 dark:text-green-400' : ''}`}>
                        {event.event}
                      </span>
                    </div>
                    <p className="text-xs text-slate-500 dark:text-slate-400 mt-1 italic">
                      {EVENT_EXPLANATIONS[event.type]}
                    </p>
                  </div>
                </div>
              ))}
              {simulationEvents.length === 0 && (
                <div className="text-center py-8 text-slate-500">
                  <Timer className="h-8 w-8 mx-auto mb-2 animate-pulse" />
                  <p>Initializing simulation...</p>
                </div>
              )}
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );

  const renderResults = () => {
    const roi = calculateROI();
    
    return (
      <div className="space-y-8">
        <div className="text-center">
          <Badge className="mb-4 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400">
            Step 6 of 6: Results
          </Badge>
          <h2 className="text-3xl font-bold text-slate-900 dark:text-white mb-4">
            Your Personalized ROI Analysis
          </h2>
          <p className="text-lg text-slate-600 dark:text-slate-400">
            Based on your complete {config.domainName} playbook configuration
          </p>
        </div>

        <div className="grid md:grid-cols-4 gap-6">
          <Card className="bg-gradient-to-br from-blue-500 to-blue-600 text-white">
            <CardContent className="p-6 text-center">
              <Zap className="h-8 w-8 mx-auto mb-2 opacity-80" />
              <div className="text-4xl font-bold mb-1">{roi.speedMultiplier}X</div>
              <div className="text-sm opacity-80">Faster Than Industry</div>
            </CardContent>
          </Card>
          <Card className="bg-gradient-to-br from-green-500 to-green-600 text-white">
            <CardContent className="p-6 text-center">
              <Clock className="h-8 w-8 mx-auto mb-2 opacity-80" />
              <div className="text-4xl font-bold mb-1">{roi.hoursSaved}</div>
              <div className="text-sm opacity-80">Hours Saved Per Event</div>
            </CardContent>
          </Card>
          <Card className="bg-gradient-to-br from-purple-500 to-purple-600 text-white">
            <CardContent className="p-6 text-center">
              <DollarSign className="h-8 w-8 mx-auto mb-2 opacity-80" />
              <div className="text-4xl font-bold mb-1">${(roi.coordinationCostSaved / 1000).toFixed(0)}K</div>
              <div className="text-sm opacity-80">Coordination Savings</div>
            </CardContent>
          </Card>
          <Card className="bg-gradient-to-br from-amber-500 to-amber-600 text-white">
            <CardContent className="p-6 text-center">
              <Shield className="h-8 w-8 mx-auto mb-2 opacity-80" />
              <div className="text-4xl font-bold mb-1">{roi.riskReduction}%</div>
              <div className="text-sm opacity-80">Risk Reduction</div>
            </CardContent>
          </Card>
        </div>

        <div className="grid md:grid-cols-3 gap-6">
          <Accordion type="single" collapsible className="w-full">
            <AccordionItem value="response-team" className="border rounded-lg bg-white dark:bg-slate-900">
              <AccordionTrigger className="px-4 py-3 hover:no-underline">
                <div className="flex items-center gap-2">
                  <Users className="h-5 w-5 text-purple-600" />
                  <span className="font-semibold">Response Team</span>
                  <Badge variant="secondary" className="ml-2">{config.stakeholders.length}</Badge>
                </div>
              </AccordionTrigger>
              <AccordionContent className="px-4 pb-4">
                <div className="space-y-2">
                  {config.stakeholders.map(id => {
                    const s = STAKEHOLDER_OPTIONS.find(opt => opt.id === id);
                    return s ? (
                      <div key={id} className="flex items-center gap-2 text-sm p-2 rounded bg-slate-50 dark:bg-slate-800">
                        <Badge variant="outline" className="text-xs">L{s.level}</Badge>
                        <span>{s.label}</span>
                      </div>
                    ) : null;
                  })}
                  <p className="text-xs text-slate-500 mt-2 italic">
                    All team members will be notified via {config.notificationChannels.join(', ')} when triggered.
                  </p>
                </div>
              </AccordionContent>
            </AccordionItem>
          </Accordion>

          <Accordion type="single" collapsible className="w-full">
            <AccordionItem value="execution-tasks" className="border rounded-lg bg-white dark:bg-slate-900">
              <AccordionTrigger className="px-4 py-3 hover:no-underline">
                <div className="flex items-center gap-2">
                  <ListChecks className="h-5 w-5 text-indigo-600" />
                  <span className="font-semibold">Execution Tasks</span>
                  <Badge variant="secondary" className="ml-2">{tasks.length}</Badge>
                </div>
              </AccordionTrigger>
              <AccordionContent className="px-4 pb-4">
                <div className="space-y-2">
                  {tasks.map((task) => (
                    <div key={task.id} className="flex items-center gap-2 text-sm p-2 rounded bg-slate-50 dark:bg-slate-800">
                      <div className={`w-2 h-2 rounded-full flex-shrink-0 ${
                        task.priority === 'critical' ? 'bg-red-500' :
                        task.priority === 'high' ? 'bg-orange-500' : 'bg-blue-500'
                      }`} />
                      <span className="flex-1">{task.name}</span>
                      <Badge variant="outline" className="text-xs">{task.estimatedMinutes}m</Badge>
                    </div>
                  ))}
                  <p className="text-xs text-slate-500 mt-2 italic">
                    Tasks are assigned based on role and executed in parallel where dependencies allow.
                  </p>
                </div>
              </AccordionContent>
            </AccordionItem>
          </Accordion>

          <Accordion type="single" collapsible className="w-full">
            <AccordionItem value="trigger-config" className="border rounded-lg bg-white dark:bg-slate-900">
              <AccordionTrigger className="px-4 py-3 hover:no-underline">
                <div className="flex items-center gap-2">
                  <Zap className="h-5 w-5 text-amber-600" />
                  <span className="font-semibold">Trigger Configuration</span>
                  <Badge variant={triggerConfig.severity === 'critical' ? 'destructive' : 'secondary'} className="ml-2">
                    {triggerConfig.severity.toUpperCase()}
                  </Badge>
                </div>
              </AccordionTrigger>
              <AccordionContent className="px-4 pb-4">
                <div className="space-y-3">
                  <div>
                    <p className="text-xs font-medium text-slate-500 mb-1">Signal Sources</p>
                    <div className="flex flex-wrap gap-1">
                      {triggerConfig.signalSources.map(source => (
                        <Badge key={source} variant="outline" className="text-xs">{source}</Badge>
                      ))}
                    </div>
                  </div>
                  <div>
                    <p className="text-xs font-medium text-slate-500 mb-1">Thresholds</p>
                    <div className="space-y-1">
                      {triggerConfig.thresholds.map((t) => {
                        const opText = t.operator === 'greater' ? '>' : t.operator === 'less' ? '<' : t.operator === 'equals' ? '=' : 'contains';
                        return (
                          <div key={t.id} className="text-sm p-2 rounded bg-slate-50 dark:bg-slate-800">
                            {t.metric} {opText} {t.value}  <Badge variant="outline" className="text-xs">{t.action}</Badge>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                  <div className="flex items-center gap-2 text-sm">
                    <span className="text-slate-500">Auto-activate:</span>
                    <Badge variant={triggerConfig.autoActivate ? 'default' : 'secondary'}>
                      {triggerConfig.autoActivate ? 'Yes' : 'No'}
                    </Badge>
                  </div>
                </div>
              </AccordionContent>
            </AccordionItem>
          </Accordion>
        </div>

        <div className="grid md:grid-cols-2 gap-6">
          <Card>
            <CardHeader className="pb-3">
              <CardTitle className="text-lg flex items-center gap-2">
                <GitBranch className="h-5 w-5 text-indigo-600" />
                Decision Gates
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-3">
              {config.decisionPoints.map((dp, i) => {
                const approver = STAKEHOLDER_OPTIONS.find(s => s.id === dp.approver)?.label || dp.approver;
                return (
                  <div key={dp.id} className="flex items-center gap-3 text-sm">
                    <div className="w-6 h-6 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 text-xs font-bold">
                      {i + 1}
                    </div>
                    <div className="flex-1">
                      <div className="font-medium">{dp.name}</div>
                      <div className="text-xs text-slate-500">Approver: {approver} | Timeout: {dp.autoApproveTimeout}min</div>
                    </div>
                  </div>
                );
              })}
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="pb-3">
              <CardTitle className="text-lg flex items-center gap-2">
                <ArrowUpRight className="h-5 w-5 text-orange-600" />
                Escalation Path
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-3">
              {config.escalationPath.map((level, i) => (
                <div key={level.id} className="flex items-center gap-3 text-sm">
                  <div className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold ${
                    i === 0 ? 'bg-green-500' : i === 1 ? 'bg-amber-500' : 'bg-red-500'
                  }`}>
                    L{level.level}
                  </div>
                  <div className="flex-1">
                    <div className="font-medium">{level.role}</div>
                    <div className="text-xs text-slate-500">{level.timeoutMinutes}min  {level.action}</div>
                  </div>
                </div>
              ))}
            </CardContent>
          </Card>
        </div>

        <Card className="bg-gradient-to-r from-slate-900 to-slate-800 text-white">
          <CardContent className="p-8">
            <div className="grid md:grid-cols-2 gap-8 items-center">
              <div>
                <h3 className="text-2xl font-bold mb-4">Complete Configuration Summary</h3>
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div className="space-y-2">
                    <p><strong className="text-blue-300">Domain:</strong> {config.domainName}</p>
                    <p><strong className="text-blue-300">Team Size:</strong> {config.stakeholders.length} stakeholders</p>
                    <p><strong className="text-blue-300">Tasks:</strong> {tasks.length} configured</p>
                    <p><strong className="text-blue-300">Decisions:</strong> {config.decisionPoints.length} gates</p>
                    <p><strong className="text-blue-300">Escalation:</strong> {config.escalationPath.length} levels</p>
                  </div>
                  <div className="space-y-2">
                    <p><strong className="text-green-300">Target Time:</strong> {config.responseTimeTarget} min</p>
                    <p><strong className="text-green-300">Budget:</strong> ${(config.budgetPreApproved / 1000).toFixed(0)}K</p>
                    <p><strong className="text-green-300">Signal Sources:</strong> {triggerConfig.signalSources.length}</p>
                    <p><strong className="text-green-300">Thresholds:</strong> {triggerConfig.thresholds.length} rules</p>
                    <p><strong className="text-green-300">Templates:</strong> {config.communicationTemplates.length} messages</p>
                  </div>
                </div>
              </div>
              <div className="text-center">
                <div className="text-5xl font-bold text-green-400 mb-2">
                  ${(roi.totalValue / 1000).toFixed(0)}K+
                </div>
                <div className="text-xl text-slate-300 mb-6">Estimated Annual Value</div>
                <Button 
                  size="lg" 
                  className="bg-white text-slate-900 hover:bg-slate-100"
                  onClick={() => setLocation('/contact')}
                  data-testid="button-get-started"
                >
                  Start Your Pilot
                  <ArrowRight className="ml-2 h-5 w-5" />
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>

        <div className="text-center">
          <p className="text-slate-600 dark:text-slate-400 mb-4">
            Ready to see M Platform with your real scenarios?
          </p>
          <div className="flex justify-center gap-4">
            <Button variant="outline" onClick={() => {
              setCurrentStep('domain');
              setSimulationEvents([]);
              setSimulationComplete(false);
            }} data-testid="button-try-again">
              Try Another Scenario
            </Button>
            <Button onClick={() => setLocation('/pilot-program')} data-testid="button-pilot-programs">
              View Pilot Program
            </Button>
          </div>
        </div>
      </div>
    );
  };

  const canProceed = () => {
    switch (currentStep) {
      case 'domain': return config.domain !== '';
      case 'configure': return config.stakeholders.length > 0;
      case 'tasks': return tasks.length > 0;
      case 'triggers': return triggerConfig.triggerType !== '' && triggerConfig.signalSources.length > 0;
      case 'simulate': return simulationComplete;
      default: return true;
    }
  };

  const handleNext = () => {
    const nextIndex = currentStepIndex + 1;
    if (nextIndex < steps.length) {
      setCurrentStep(steps[nextIndex].id);
    }
  };

  const handleBack = () => {
    const prevIndex = currentStepIndex - 1;
    if (prevIndex >= 0) {
      setCurrentStep(steps[prevIndex].id);
    }
  };

  return (
    <div className="min-h-screen bg-white dark:bg-slate-950">
      <StandardNav />

      <div className="py-12 px-6">
        <div className="max-w-6xl mx-auto">
          <div className="flex items-center justify-center mb-12 overflow-x-auto pb-4">
            {steps.map((step, index) => {
              const Icon = step.icon;
              const isActive = index === currentStepIndex;
              const isComplete = index < currentStepIndex;
              
              return (
                <div key={step.id} className="flex items-center">
                  <div 
                    className={`flex items-center gap-2 px-3 py-2 rounded-full transition-all whitespace-nowrap ${
                      isActive 
                        ? 'bg-blue-600 text-white' 
                        : isComplete 
                        ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'
                        : 'bg-slate-100 text-slate-500 dark:bg-slate-800'
                    }`}
                  >
                    {isComplete ? (
                      <CheckCircle2 className="h-4 w-4" />
                    ) : (
                      <Icon className="h-4 w-4" />
                    )}
                    <span className="hidden lg:inline text-sm font-medium">{step.label}</span>
                  </div>
                  {index < steps.length - 1 && (
                    <div className={`w-6 h-0.5 mx-1 ${
                      isComplete ? 'bg-green-400' : 'bg-slate-200 dark:bg-slate-700'
                    }`} />
                  )}
                </div>
              );
            })}
          </div>

          {currentStep === 'domain' && renderDomainSelection()}
          {currentStep === 'configure' && renderConfiguration()}
          {currentStep === 'tasks' && renderTaskAssignments()}
          {currentStep === 'triggers' && renderTriggerSetup()}
          {currentStep === 'simulate' && renderSimulation()}
          {currentStep === 'results' && renderResults()}

          {currentStep !== 'results' && (
            <div className="flex justify-between mt-12 max-w-3xl mx-auto">
              <Button
                variant="outline"
                onClick={handleBack}
                disabled={currentStepIndex === 0}
                data-testid="button-back"
              >
                <ArrowLeft className="mr-2 h-4 w-4" />
                Back
              </Button>
              <Button
                onClick={handleNext}
                disabled={!canProceed()}
                className="bg-blue-600 hover:bg-blue-700"
                data-testid="button-next"
              >
                {currentStep === 'triggers' ? 'Run Simulation' : 'Continue'}
                <ArrowRight className="ml-2 h-4 w-4" />
              </Button>
            </div>
          )}
        </div>
      </div>

      <Footer />
    </div>
  );
}


========================================
FILE: client/src/pages/ScenarioGallery.tsx
========================================
import { useState, useEffect } from 'react';
import { useLocation } from 'wouter';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { 
  TrendingUp, 
  Shield, 
  Zap,
  Users,
  Smartphone,
  Briefcase,
  Target,
  GitBranch,
  Layers,
  Globe,
  Leaf,
  AlertTriangle,
  GitMerge,
  Network,
  ChevronRight,
  Sparkles,
  Rocket,
  DollarSign,
  Building2
} from 'lucide-react';
import { updatePageMetadata } from '@/lib/seo';
import StandardNav from '@/components/layout/StandardNav';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';

const iconMap: Record<string, any> = {
  Users,
  Smartphone,
  Briefcase,
  Target,
  GitBranch,
  Layers,
  Shield,
  Globe,
  Leaf,
  AlertTriangle,
  GitMerge,
  Network,
  Rocket,
  DollarSign,
  Building2,
  TrendingUp
};

const domainColors: Record<string, any> = {
  'Market Dynamics': {
    border: 'border-green-200 dark:border-green-800',
    bg: 'bg-green-50 dark:bg-green-950/10',
    hover: 'hover:border-green-500 dark:hover:border-green-500',
    badge: 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-400',
    icon: 'text-green-600'
  },
  'Financial Strategy': {
    border: 'border-emerald-200 dark:border-emerald-800',
    bg: 'bg-emerald-50 dark:bg-emerald-950/10',
    hover: 'hover:border-emerald-500 dark:hover:border-emerald-500',
    badge: 'bg-emerald-100 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-400',
    icon: 'text-emerald-600'
  },
  'Operational Excellence': {
    border: 'border-blue-200 dark:border-blue-800',
    bg: 'bg-blue-50 dark:bg-blue-950/10',
    hover: 'hover:border-blue-500 dark:hover:border-blue-500',
    badge: 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-400',
    icon: 'text-blue-600'
  },
  'Technology & Innovation': {
    border: 'border-purple-200 dark:border-purple-800',
    bg: 'bg-purple-50 dark:bg-purple-950/10',
    hover: 'hover:border-purple-500 dark:hover:border-purple-500',
    badge: 'bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-400',
    icon: 'text-purple-600'
  },
  'Talent & Leadership': {
    border: 'border-amber-200 dark:border-amber-800',
    bg: 'bg-amber-50 dark:bg-amber-950/10',
    hover: 'hover:border-amber-500 dark:hover:border-amber-500',
    badge: 'bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-400',
    icon: 'text-amber-600'
  },
  'Brand & Reputation': {
    border: 'border-pink-200 dark:border-pink-800',
    bg: 'bg-pink-50 dark:bg-pink-950/10',
    hover: 'hover:border-pink-500 dark:hover:border-pink-500',
    badge: 'bg-pink-100 dark:bg-pink-900 text-pink-700 dark:text-pink-400',
    icon: 'text-pink-600'
  },
  'Regulatory & Compliance': {
    border: 'border-cyan-200 dark:border-cyan-800',
    bg: 'bg-cyan-50 dark:bg-cyan-950/10',
    hover: 'hover:border-cyan-500 dark:hover:border-cyan-500',
    badge: 'bg-cyan-100 dark:bg-cyan-900 text-cyan-700 dark:text-cyan-400',
    icon: 'text-cyan-600'
  },
  'Market Opportunities': {
    border: 'border-indigo-200 dark:border-indigo-800',
    bg: 'bg-indigo-50 dark:bg-indigo-950/10',
    hover: 'hover:border-indigo-500 dark:hover:border-indigo-500',
    badge: 'bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-400',
    icon: 'text-indigo-600'
  }
};

const defaultColors = {
  border: 'border-slate-200 dark:border-slate-800',
  bg: 'bg-slate-50 dark:bg-slate-950/10',
  hover: 'hover:border-slate-500 dark:hover:border-slate-500',
  badge: 'bg-slate-100 dark:bg-slate-900 text-slate-700 dark:text-slate-400',
  icon: 'text-slate-600'
};

export default function ScenarioGallery() {
  const [, setLocation] = useLocation();
  const [selectedDomain, setSelectedDomain] = useState<string>('all');

  const { data: playbooks, isLoading } = useQuery<any[]>({
    queryKey: ['/api/playbook-library/featured'],
  });

  useEffect(() => {
    updatePageMetadata({
      title: "Strategic Playbook Library | M Executive Decision Platform",
      description: "Explore M's 166 strategic playbooks across 9 domains: digital transformation, M&A integration, crisis management, new product launches, global expansion, AI governance, and more. See the human-AI partnership in action.",
      ogTitle: "Experience M Strategic Playbook Library",
      ogDescription: "From culture transformation to new product launches - see how executives prepare, AI monitors, and teams execute across 166 strategic playbooks.",
    });
  }, []);

  const playbookList = playbooks || [];
  
  const filteredPlaybooks = selectedDomain === 'all' 
    ? playbookList
    : playbookList.filter((p: any) => p.domain?.name === selectedDomain);

  const domainCounts = playbookList.reduce((acc: Record<string, number>, p: any) => {
    const domainName = p.domain?.name || 'Unknown';
    acc[domainName] = (acc[domainName] || 0) + 1;
    return acc;
  }, {});

  const uniqueDomains = Array.from(new Set(playbookList.map((p: any) => p.domain?.name).filter(Boolean)));

  return (
    <div className="page-background min-h-screen bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900">
      <StandardNav />

      {/* Hero Section */}
      <section className="py-20 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white relative overflow-hidden">
        <div className="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAxMCAwIEwgMCAwIDAgMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIi8+PC9zdmc+')] opacity-20"></div>
        
        <div className="max-w-7xl mx-auto text-center relative z-10">
          <div className="flex items-center justify-center gap-4 mb-6">
            <Badge className="bg-cyan-600 text-white border-0 text-sm px-4 py-1.5" data-testid="badge-scenarios">
              <Sparkles className="w-4 h-4 inline mr-2" />
              166 Strategic Playbooks + Unlimited Custom Scenarios
            </Badge>
            <OnboardingTrigger pageId="scenario-gallery" autoStart={true} className="bg-white/10 border-white/30 text-white hover:bg-white/20" />
          </div>
          
          <h1 className="text-4xl md:text-6xl font-bold mb-8 leading-tight max-w-5xl mx-auto" data-testid="heading-hero">
            Experience How M Handles Real Business Situations
          </h1>
          
          <p className="text-xl md:text-2xl text-blue-100 mb-10 max-w-4xl mx-auto" data-testid="text-subtitle">
            <strong>166 battle-tested playbooks</strong> ready for immediate deployment. <strong>Unlimited custom scenarios</strong> via What-If Analyzer.
            See how your team prepares, AI monitors, and everyone executes with confidence.
          </p>

          <div className="flex items-center justify-center gap-8 text-blue-200">
            <div className="flex items-center gap-2">
              <TrendingUp className="w-5 h-5 text-green-400" />
              <span>Market Dynamics</span>
            </div>
            <div className="flex items-center gap-2">
              <Shield className="w-5 h-5 text-blue-400" />
              <span>Operational Excellence</span>
            </div>
            <div className="flex items-center gap-2">
              <Zap className="w-5 h-5 text-purple-400" />
              <span>Technology & Innovation</span>
            </div>
          </div>
        </div>
      </section>

      {/* Category Filter & Playbooks */}
      <section className="py-16 px-6">
        <div className="max-w-7xl mx-auto">
          {isLoading ? (
            <div className="text-center py-16" data-testid="loading-playbooks">
              <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
              <p className="text-slate-600 dark:text-slate-400">Loading featured playbooks...</p>
            </div>
          ) : (
            <>
              <Tabs value={selectedDomain} onValueChange={setSelectedDomain} className="w-full">
                <TabsList className="grid w-full max-w-4xl mx-auto mb-12" style={{ gridTemplateColumns: `repeat(${Math.min(uniqueDomains.length + 1, 5)}, minmax(0, 1fr))` }}>
                  <TabsTrigger value="all" data-testid="tab-all">All ({playbookList.length})</TabsTrigger>
                  {uniqueDomains.slice(0, 4).map((domain: string) => (
                    <TabsTrigger key={domain} value={domain} data-testid={`tab-${domain}`}>
                      {domain} ({domainCounts[domain] || 0})
                    </TabsTrigger>
                  ))}
                </TabsList>

                <TabsContent value={selectedDomain} className="mt-0">
                  <div className="grid md:grid-cols-3 gap-6">
                    {filteredPlaybooks.map((playbook: any) => {
                      const domainName = playbook.domain?.name || 'Unknown';
                      const colors = domainColors[domainName] || defaultColors;
                      const Icon = iconMap[playbook.icon] || Briefcase;
                      const playbookId = playbook.playbookNumber;

                      return (
                        <Card 
                          key={playbook.id}
                          className={`${colors.border} ${colors.bg} ${colors.hover} border-2 transition-all cursor-pointer group`}
                          onClick={() => setLocation(`/business-scenario/${playbookId}`)}
                          data-testid={`card-playbook-${playbookId}`}
                        >
                          <CardContent className="pt-8 pb-8">
                            <div className="flex items-start justify-between mb-4">
                              <Icon className={`h-12 w-12 ${colors.icon} group-hover:scale-110 transition-transform`} />
                              <Badge variant="outline" className={colors.badge}>
                                {domainName}
                              </Badge>
                            </div>

                            <div className="mb-2">
                              <Badge variant="secondary" className="text-xs">
                                Playbook #{playbookId}
                              </Badge>
                            </div>

                            <h3 className="text-xl font-bold mb-3 text-slate-900 dark:text-white">
                              {playbook.name}
                            </h3>

                            <p className="text-sm text-slate-600 dark:text-slate-400 mb-4 line-clamp-3">
                              {playbook.description}
                            </p>

                            <div className="mb-4 space-y-2">
                              <div className="text-xs text-slate-500 dark:text-slate-500 font-semibold uppercase">
                                Trigger Criteria
                              </div>
                              <p className="text-sm text-slate-700 dark:text-slate-300 line-clamp-2">
                                {playbook.triggerCriteria}
                              </p>
                            </div>

                            {playbook.estimatedTimeSaved && (
                              <div className="mb-4 pb-4 border-b border-slate-200 dark:border-slate-700">
                                <div className="text-sm font-semibold text-green-600 dark:text-green-400">
                                  Est. {playbook.estimatedTimeSaved} saved
                                </div>
                              </div>
                            )}

                            <Button 
                              variant="ghost" 
                              className="w-full justify-between group-hover:bg-white/50 dark:group-hover:bg-slate-800/50"
                              data-testid={`button-explore-${playbookId}`}
                            >
                              <span>Experience This Playbook</span>
                              <ChevronRight className="h-4 w-4 group-hover:translate-x-1 transition-transform" />
                            </Button>
                          </CardContent>
                        </Card>
                      );
                    })}
                  </div>
                </TabsContent>
              </Tabs>

              {/* Human-AI Partnership Message */}
              <div className="mt-16 max-w-4xl mx-auto">
                <Card className="bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20 border-2 border-blue-200 dark:border-blue-800">
                  <CardContent className="pt-8 pb-8">
                    <div className="flex items-start gap-4">
                      <Sparkles className="h-8 w-8 text-blue-600 flex-shrink-0 mt-1" />
                      <div>
                        <h3 className="text-xl font-bold mb-3 text-slate-900 dark:text-white">
                          How It Works: Human Preparation + AI Intelligence
                        </h3>
                        <p className="text-slate-700 dark:text-slate-300 mb-4">
                          Each playbook demonstrates the M partnership model: <strong>You and your team prepare the playbook</strong> (define triggers, map stakeholders, sequence tasks). <strong>AI monitors 24/7</strong> (watches signals, detects patterns, triggers alerts). <strong>You decide and execute</strong> (activate your plan, coordinate your team). <strong>AI learns</strong> (captures outcomes, improves recommendations).
                        </p>
                        <p className="text-sm text-blue-700 dark:text-blue-400 italic">
                          The platform is only as good as your preparation. Strong inputs  Smarter AI  Better outcomes.
                        </p>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>

              {/* Conversion CTA */}
              <div className="mt-12 max-w-4xl mx-auto">
                <Card className="bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20 border-2 border-purple-300 dark:border-purple-700">
                  <CardContent className="pt-8 pb-8 text-center">
                    <h3 className="text-3xl font-bold mb-4 text-slate-900 dark:text-white">
                      Ready to Operationalize Your Playbooks?
                    </h3>
                    <p className="text-lg text-slate-700 dark:text-slate-300 mb-6 max-w-2xl mx-auto">
                      Join M's Q1 2025 pilot program and transform your strategic execution from 72-hour coordination to 12-minute response. Limited to 10 Fortune 1000 companies.
                    </p>
                    <div className="flex flex-col sm:flex-row gap-4 justify-center mb-6">
                      <Button 
                        onClick={() => setLocation('/contact')}
                        size="lg"
                        className="bg-purple-600 hover:bg-purple-700 text-white text-lg px-8 py-6"
                        data-testid="button-request-early-access-scenarios"
                      >
                        Request Early Access Interview
                        <ChevronRight className="ml-2 h-5 w-5" />
                      </Button>
                      <Button 
                        onClick={() => setLocation('/how-it-works')}
                        size="lg"
                        variant="outline"
                        className="border-2 text-lg px-8 py-6"
                        data-testid="button-see-how-it-works"
                      >
                        See How It Works
                        <ChevronRight className="ml-2 h-5 w-5" />
                      </Button>
                    </div>
                    <p className="text-sm text-slate-600 dark:text-slate-400">
                      90-day validation partnership  Full platform access  Strategic implementation support
                    </p>
                  </CardContent>
                </Card>
              </div>
            </>
          )}
        </div>
      </section>
    </div>
  );
}


========================================
FILE: client/src/pages/ScenarioLibraryPage.tsx
========================================
import PageLayout from '@/components/layout/PageLayout';
import { useState } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import { Search, BookOpen, Play, Star, TrendingUp, ArrowRight } from 'lucide-react';
import { useLocation } from 'wouter';

const playbookCategories = [
  { name: 'Crisis Response', count: 24, color: 'bg-red-500' },
  { name: 'Market Opportunities', count: 18, color: 'bg-blue-500' },
  { name: 'Competitive Threats', count: 16, color: 'bg-orange-500' },
  { name: 'Regulatory Changes', count: 22, color: 'bg-purple-500' },
  { name: 'Technology Disruption', count: 20, color: 'bg-cyan-500' },
  { name: 'M&A Activity', count: 14, color: 'bg-green-500' },
  { name: 'Supply Chain', count: 18, color: 'bg-yellow-500' },
  { name: 'Talent & Culture', count: 16, color: 'bg-pink-500' },
];

const featuredPlaybooks = [
  { id: 1, name: 'Ransomware Attack Response', category: 'Crisis Response', activations: 127, rating: 4.9, lastUsed: '2 days ago' },
  { id: 2, name: 'Emerging Market Entry', category: 'Market Opportunities', activations: 94, rating: 4.8, lastUsed: '1 week ago' },
  { id: 3, name: 'Competitor Product Launch', category: 'Competitive Threats', activations: 156, rating: 4.7, lastUsed: '3 days ago' },
  { id: 4, name: 'Supply Chain Disruption', category: 'Supply Chain', activations: 203, rating: 4.9, lastUsed: 'Today' },
  { id: 5, name: 'M&A Integration Playbook', category: 'M&A Activity', activations: 78, rating: 4.6, lastUsed: '5 days ago' },
  { id: 6, name: 'Data Breach Response', category: 'Crisis Response', activations: 112, rating: 4.8, lastUsed: '1 day ago' },
];

export default function ScenarioLibraryPage() {
  const [searchQuery, setSearchQuery] = useState('');
  const [, setLocation] = useLocation();

  // Filter playbooks based on search query
  const filteredPlaybooks = featuredPlaybooks.filter(playbook =>
    playbook.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
    playbook.category.toLowerCase().includes(searchQuery.toLowerCase())
  );

  return (
    <PageLayout>
      <div className="p-8">
        <div className="max-w-7xl mx-auto space-y-8">
          {/* Header */}
          <div>
            <h1 className="text-title mb-2">
            Scenario Library
          </h1>
          <p className="text-slate-600 dark:text-slate-400 mb-6">
            166 battle-tested strategic playbooks across 9 domains
          </p>

          {/* Search */}
          <div className="relative max-w-2xl">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" />
            <Input
              type="text"
              placeholder="Search playbooks by name, category, or trigger..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="pl-10 border-2 border-slate-300 focus:border-blue-500"
              data-testid="input-search-playbooks"
            />
            {searchQuery && (
              <span className="absolute right-3 top-1/2 transform -translate-y-1/2 text-sm text-slate-500">
                {filteredPlaybooks.length} result{filteredPlaybooks.length !== 1 ? 's' : ''}
              </span>
            )}
          </div>
        </div>

        {/* Categories Grid */}
        <div>
          <h2 className="text-2xl font-bold text-slate-900 dark:text-white mb-4">Browse by Category</h2>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            {playbookCategories.map((category) => (
              <Card 
                key={category.name} 
                className="cursor-pointer hover:shadow-lg transition-all hover:scale-105 hover:border-blue-400 dark:hover:border-blue-500"
                data-testid={`card-category-${category.name.replace(/\s+/g, '-').toLowerCase()}`}
                onClick={() => setLocation('/playbook-library')}
              >
                <CardHeader>
                  <div className="flex items-center gap-3">
                    <div className={`w-3 h-3 rounded-full ${category.color}`}></div>
                    <CardTitle className="text-sm">{category.name}</CardTitle>
                  </div>
                  <CardDescription className="text-2xl font-bold">
                    {category.count}
                  </CardDescription>
                </CardHeader>
              </Card>
            ))}
          </div>
        </div>

        {/* Featured Playbooks */}
        <div>
          <h2 className="text-2xl font-bold text-slate-900 dark:text-white mb-4">
            {searchQuery ? 'Search Results' : 'Most Activated Playbooks'}
          </h2>
          {filteredPlaybooks.length === 0 ? (
            <Card className="bg-slate-50 dark:bg-slate-900 border-dashed">
              <CardContent className="p-12 text-center">
                <BookOpen className="w-12 h-12 text-slate-400 mx-auto mb-3" />
                <p className="text-slate-600 dark:text-slate-400">
                  No playbooks found matching "{searchQuery}". Try a different search term.
                </p>
              </CardContent>
            </Card>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {filteredPlaybooks.map((playbook) => (
              <Card 
                key={playbook.id} 
                data-testid={`card-playbook-${playbook.id}`}
                className="cursor-pointer hover:shadow-lg transition-all hover:border-blue-400 dark:hover:border-blue-500 group"
                onClick={() => setLocation('/playbook-library')}
              >
                <CardHeader>
                  <div className="flex items-start justify-between mb-2">
                    <BookOpen className="w-5 h-5 text-blue-600" />
                    <div className="flex items-center gap-1">
                      <Star className="w-4 h-4 text-yellow-500 fill-yellow-500" />
                      <span className="text-sm font-semibold">{playbook.rating}</span>
                    </div>
                  </div>
                  <CardTitle className="text-lg group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">{playbook.name}</CardTitle>
                  <CardDescription>{playbook.category}</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between text-sm">
                      <span className="text-slate-600 dark:text-slate-400">Activations:</span>
                      <Badge variant="secondary">{playbook.activations}</Badge>
                    </div>
                    <div className="flex items-center justify-between text-sm">
                      <span className="text-slate-600 dark:text-slate-400">Last used:</span>
                      <span className="font-medium">{playbook.lastUsed}</span>
                    </div>
                    <Button className="w-full" size="sm" data-testid={`button-view-details-${playbook.id}`}>
                      <ArrowRight className="w-4 h-4 mr-2" />
                      View Details
                    </Button>
                  </div>
                </CardContent>
              </Card>
            ))}
            </div>
          )}
        </div>

        {/* Total Count */}
        <Card className="bg-gradient-to-r from-blue-600 to-violet-600 text-white border-0">
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-2xl font-bold mb-1">166 Strategic Playbooks</h3>
                <p className="text-blue-100">Ready to deploy across your organization</p>
              </div>
              <Button 
                variant="secondary" 
                size="lg" 
                data-testid="button-view-all"
                onClick={() => setLocation('/playbook-library')}
              >
                View All Playbooks
                <ArrowRight className="w-4 h-4 ml-2" />
              </Button>
            </div>
          </CardContent>
        </Card>
        </div>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/ScenarioTemplates.tsx
========================================
import { useToast } from "@/hooks/use-toast";
import PageLayout from '@/components/layout/PageLayout';
import ScenarioTemplateLibrary from "@/components/ScenarioTemplateLibrary";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { FileText, Zap, Target, TrendingUp } from "lucide-react";

export default function ScenarioTemplates() {
  const { toast } = useToast();

  // Full access to enterprise template library

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto" data-testid="scenario-templates-page">
        <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-8">
          <div className="max-w-7xl mx-auto">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-4xl font-bold mb-2">Comprehensive Scenario Templates</h1>
                <p className="text-blue-100 text-lg">12+ professional starting templates that grow as you build YOUR playbooks</p>
              </div>
              <div className="text-right">
                <Badge variant="secondary" className="bg-white/20 text-white border-white/30 mb-2">
                  ENTERPRISE GRADE
                </Badge>
                <div className="text-blue-100">Customizable & Expandable</div>
              </div>
            </div>
          </div>
        </div>

        <div className="p-6 max-w-7xl mx-auto space-y-6">
          {/* Template Categories Overview */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <Card className="border-red-200 bg-red-50 dark:bg-red-900/20" data-testid="crisis-category">
              <CardHeader className="pb-2">
                <CardTitle className="text-sm flex items-center gap-2 text-red-800 dark:text-red-200">
                  <Zap className="h-4 w-4" />
                  Crisis Response
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-xs text-red-600 dark:text-red-400">Emergency Templates</div>
              </CardContent>
            </Card>

            <Card className="border-blue-200 bg-blue-50 dark:bg-blue-900/20" data-testid="strategic-category">
              <CardHeader className="pb-2">
                <CardTitle className="text-sm flex items-center gap-2 text-blue-800 dark:text-blue-200">
                  <Target className="h-4 w-4" />
                  Strategic Planning
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-2xl font-bold text-blue-700 dark:text-blue-300">5</div>
                <div className="text-xs text-blue-600 dark:text-blue-400">Growth Templates</div>
              </CardContent>
            </Card>

            <Card className="border-green-200 bg-green-50 dark:bg-green-900/20" data-testid="operational-category">
              <CardHeader className="pb-2">
                <CardTitle className="text-sm flex items-center gap-2 text-green-800 dark:text-green-200">
                  <TrendingUp className="h-4 w-4" />
                  Operational
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-xs text-green-600 dark:text-green-400">Process Templates</div>
              </CardContent>
            </Card>

            <Card className="border-purple-200 bg-purple-50 dark:bg-purple-900/20" data-testid="innovation-category">
              <CardHeader className="pb-2">
                <CardTitle className="text-sm flex items-center gap-2 text-purple-800 dark:text-purple-200">
                  <FileText className="h-4 w-4" />
                  Innovation
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-xs text-purple-600 dark:text-purple-400">Opportunity Templates</div>
              </CardContent>
            </Card>
          </div>

          {/* Comprehensive Template Library */}
          <ScenarioTemplateLibrary organizationId="org-1" />
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/Settings.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Switch } from '@/components/ui/switch';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Link } from 'wouter';
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
import { apiRequest } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { useState } from 'react';
import PageLayout from '@/components/layout/PageLayout';
import { 
  Settings, 
  Users, 
  Shield, 
  Database, 
  Globe,
  Bell,
  Key,
  Activity,
  BarChart3,
  Crown,
  Building2,
  CheckCircle,
  AlertTriangle,
  Clock,
  Zap,
  FileText,
  Target,
  ArrowLeft,
  Home,
  RotateCcw,
  PlayCircle,
  RefreshCw
} from 'lucide-react';

export default function SettingsPage() {
  const { toast } = useToast();
  const queryClient = useQueryClient();
  const [selectedScenario, setSelectedScenario] = useState('apac-competitive-response');
  
  // Fetch available demo scenarios
  const { data: scenariosData, isLoading: scenariosLoading } = useQuery({
    queryKey: ['/api/demo/scenarios'],
    enabled: true
  });
  
  // Demo reset mutation
  const resetDemoMutation = useMutation({
    mutationFn: async () => {
      const response = await apiRequest('POST', '/api/demo/reset', { scenarioId: selectedScenario });
      return response.json();
    },
    onSuccess: (data) => {
      toast({
        title: 'Demo Reset Successful',
        description: `${data.demoNarrative} demo data has been reset. Organization: ${data.organization?.name || 'Demo Organization'}`,
        variant: 'default',
      });
      // Invalidate all cache to refresh the UI with new data
      queryClient.invalidateQueries({ queryKey: ['/api/organizations'] });
      queryClient.invalidateQueries({ queryKey: ['/api/scenarios'] });
      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });
    },
    onError: (error) => {
      toast({
        title: 'Demo Reset Failed',
        description: error instanceof Error ? error.message : 'Failed to reset demo data',
        variant: 'destructive',
      });
    },
  });

  const systemStatus = [
    { service: "AI Intelligence Modules", status: "Active", uptime: "99.97%", color: "text-green-600" },
    { service: "Crisis Response Systems", status: "Ready", uptime: "99.99%", color: "text-green-600" },
    { service: "Database Performance", status: "Optimal", uptime: "99.95%", color: "text-green-600" },
    { service: "WebSocket Connections", status: "Connected", uptime: "99.92%", color: "text-green-600" }
  ];

  const enterpriseFeatures = [
    { 
      name: "Advanced Decision Tracking", 
      description: "Track strategic decisions and learn from outcomes",
      enabled: true,
      critical: true
    },
    { 
      name: "Learning Pattern Recognition", 
      description: "AI-powered organizational pattern analysis",
      enabled: true,
      critical: true
    },
    { 
      name: "Institutional Memory", 
      description: "Preserve and access organizational knowledge",
      enabled: true,
      critical: true
    },
    { 
      name: "Real-time Crisis Alerts", 
      description: "Immediate notifications for crisis scenarios",
      enabled: true,
      critical: false
    },
    { 
      name: "Executive Reporting", 
      description: "Automated board and C-suite reporting",
      enabled: true,
      critical: false
    }
  ];

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800">
        <div className="p-8">
          {/* Breadcrumb Navigation */}
          <div className="mb-6">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-gray-800 dark:hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>Administration</span>
              <span>/</span>
              <span className="text-gray-800 dark:text-white">Settings</span>
            </div>
          </div>

          {/* Settings Header */}
          <div className="flex items-center justify-between mb-8">
            <div className="flex items-center space-x-4">
              <div className="w-12 h-12 bg-gradient-to-r from-teal-500 to-blue-600 rounded-xl flex items-center justify-center">
                <Settings className="w-7 h-7 text-white" />
              </div>
              <div>
                <h1 className="text-3xl font-bold text-gray-900 dark:text-white">System Management</h1>
                <p className="text-gray-600 dark:text-gray-300">Enterprise Platform Administration & Configuration</p>
              </div>
            </div>
            <div className="flex items-center space-x-3">
              <Link to="/">
                <Button variant="secondary" className="bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-100">
                  <ArrowLeft className="h-4 w-4 mr-2" />
                  Dashboard
                </Button>
              </Link>
              <Badge variant="outline" className="text-green-600 border-green-500/50">
                <CheckCircle className="w-3 h-3 mr-1" />
                All Systems Operational
              </Badge>
              <Badge className="bg-teal-600 text-white">
                Admin Access
              </Badge>
            </div>
          </div>

          <Tabs defaultValue="system" className="space-y-6">
            <TabsList className="grid w-full grid-cols-6">
              <TabsTrigger value="system" data-testid="tab-system-status">
                <Activity className="w-4 h-4 mr-2" />
                System Status
              </TabsTrigger>
              <TabsTrigger value="users" data-testid="tab-user-management">
                <Users className="w-4 h-4 mr-2" />
                User Management
              </TabsTrigger>
              <TabsTrigger value="security" data-testid="tab-security-settings">
                <Shield className="w-4 h-4 mr-2" />
                Security
              </TabsTrigger>
              <TabsTrigger value="enterprise" data-testid="tab-enterprise-features">
                <Crown className="w-4 h-4 mr-2" />
                Enterprise Features
              </TabsTrigger>
              <TabsTrigger value="integrations" data-testid="tab-integrations">
                <Globe className="w-4 h-4 mr-2" />
                Integrations
              </TabsTrigger>
              <TabsTrigger value="demo" data-testid="tab-demo-management">
                <PlayCircle className="w-4 h-4 mr-2" />
                Demo Management
              </TabsTrigger>
            </TabsList>

            {/* System Status Tab */}
            <TabsContent value="system" className="space-y-6">
              <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
                <CardHeader>
                  <CardTitle className="flex items-center text-gray-900 dark:text-white">
                    <Activity className="w-5 h-5 mr-2 text-blue-500" />
                    Platform Status Dashboard
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    {systemStatus.map((service, index) => (
                      <div key={index} className="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                        <div className="flex items-center space-x-3">
                          <CheckCircle className="w-5 h-5 text-green-500" />
                          <div>
                            <h4 className="font-semibold text-gray-900 dark:text-white">{service.service}</h4>
                            <p className="text-sm text-gray-600 dark:text-gray-400">Uptime: {service.uptime}</p>
                          </div>
                        </div>
                        <Badge variant="default" className="bg-green-600">
                          {service.status}
                        </Badge>
                      </div>
                    ))}
                  </div>
                  
                  <div className="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <Button data-testid="button-system-health-check">
                      <BarChart3 className="w-4 h-4 mr-2" />
                      Run Health Check
                    </Button>
                    <Button variant="outline" data-testid="button-restart-services">
                      <Zap className="w-4 h-4 mr-2" />
                      Restart Services
                    </Button>
                    <Button variant="outline" data-testid="button-view-logs">
                      <FileText className="w-4 h-4 mr-2" />
                      View System Logs
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            {/* User Management Tab */}
            <TabsContent value="users" className="space-y-6">
              <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
                <CardHeader>
                  <CardTitle className="flex items-center text-gray-900 dark:text-white">
                    <Users className="w-5 h-5 mr-2 text-green-500" />
                    Enterprise User Management
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                        <div className="text-2xl font-bold text-blue-600">1,247</div>
                        <div className="text-sm text-gray-600 dark:text-gray-400">Active Users</div>
                      </div>
                      <div className="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                        <div className="text-2xl font-bold text-green-600">94%</div>
                        <div className="text-sm text-gray-600 dark:text-gray-400">Platform Adoption</div>
                      </div>
                      <div className="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                        <div className="text-2xl font-bold text-purple-600">47</div>
                        <div className="text-sm text-gray-600 dark:text-gray-400">Admin Users</div>
                      </div>
                    </div>

                    <div className="flex space-x-3">
                      <Button data-testid="button-add-user">
                        <Users className="w-4 h-4 mr-2" />
                        Add Enterprise User
                      </Button>
                      <Button variant="outline" data-testid="button-bulk-import">
                        <Database className="w-4 h-4 mr-2" />
                        Bulk Import
                      </Button>
                      <Button variant="outline" data-testid="button-export-users">
                        <BarChart3 className="w-4 h-4 mr-2" />
                        Export User Data
                      </Button>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            {/* Enterprise Features Tab */}
            <TabsContent value="enterprise" className="space-y-6">
              <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
                <CardHeader>
                  <CardTitle className="flex items-center text-gray-900 dark:text-white">
                    <Crown className="w-5 h-5 mr-2 text-purple-500" />
                    Fortune 1000 Enterprise Features
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-6">
                    {enterpriseFeatures.map((feature, index) => (
                      <div key={index} className="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                        <div className="flex-1 page-background">
                          <div className="flex items-center space-x-3 mb-2">
                            <h4 className="font-semibold text-gray-900 dark:text-white">{feature.name}</h4>
                            {feature.critical && (
                              <Badge variant="destructive">Critical</Badge>
                            )}
                          </div>
                          <p className="text-sm text-gray-600 dark:text-gray-400">{feature.description}</p>
                        </div>
                        <div className="flex items-center space-x-3">
                          <Switch 
                            checked={feature.enabled}
                            disabled={feature.critical}
                            data-testid={`switch-${feature.name.toLowerCase().replace(/\s+/g, '-')}`}
                          />
                          <Badge variant={feature.enabled ? 'default' : 'secondary'}>
                            {feature.enabled ? 'Enabled' : 'Disabled'}
                          </Badge>
                        </div>
                      </div>
                    ))}
                  </div>
                  
                  <div className="mt-6 p-4 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg">
                    <div className="flex items-center text-purple-800 dark:text-purple-200">
                      <Crown className="w-4 h-4 mr-2" />
                      <span className="text-sm font-medium">Enterprise Intelligence Platform Status</span>
                    </div>
                    <p className="text-xs text-purple-700 dark:text-purple-300 mt-1">
                      All Fortune 1000 enterprise features are active and optimized for organizational intelligence and crisis response excellence.
                    </p>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            {/* Security Settings Tab */}
            <TabsContent value="security" className="space-y-6">
              <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
                <CardHeader>
                  <CardTitle className="flex items-center text-gray-900 dark:text-white">
                    <Shield className="w-5 h-5 mr-2 text-red-500" />
                    Enterprise Security Configuration
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div className="space-y-3">
                        <Label htmlFor="session-timeout">Session Timeout (minutes)</Label>
                        <Input 
                          id="session-timeout" 
                          type="number" 
                          defaultValue="60"
                          data-testid="input-session-timeout"
                        />
                      </div>
                      <div className="space-y-3">
                        <Label htmlFor="max-attempts">Max Login Attempts</Label>
                        <Input 
                          id="max-attempts" 
                          type="number" 
                          defaultValue="5"
                          data-testid="input-max-login-attempts"
                        />
                      </div>
                    </div>

                    <div className="space-y-4">
                      <div className="flex items-center justify-between">
                        <div>
                          <h4 className="font-medium text-gray-900 dark:text-white">Two-Factor Authentication</h4>
                          <p className="text-sm text-gray-600 dark:text-gray-400">Require 2FA for all admin users</p>
                        </div>
                        <Switch defaultChecked data-testid="switch-2fa-required" />
                      </div>
                      
                      <div className="flex items-center justify-between">
                        <div>
                          <h4 className="font-medium text-gray-900 dark:text-white">Audit Logging</h4>
                          <p className="text-sm text-gray-600 dark:text-gray-400">Log all user actions and system events</p>
                        </div>
                        <Switch defaultChecked data-testid="switch-audit-logging" />
                      </div>

                      <div className="flex items-center justify-between">
                        <div>
                          <h4 className="font-medium text-gray-900 dark:text-white">Advanced Encryption</h4>
                          <p className="text-sm text-gray-600 dark:text-gray-400">AES-256 encryption for sensitive data</p>
                        </div>
                        <Switch defaultChecked disabled />
                      </div>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            {/* Integrations Tab */}
            <TabsContent value="integrations" className="space-y-6">
              <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
                <CardHeader>
                  <CardTitle className="flex items-center text-gray-900 dark:text-white">
                    <Globe className="w-5 h-5 mr-2 text-blue-500" />
                    Enterprise System Integrations
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="space-y-4">
                      <h4 className="font-semibold text-gray-900 dark:text-white">Connected Systems</h4>
                      <div className="space-y-3">
                        <div className="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                          <span className="text-sm font-medium text-gray-900 dark:text-white">Salesforce CRM</span>
                          <Badge className="bg-green-600">Connected</Badge>
                        </div>
                        <div className="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                          <span className="text-sm font-medium text-gray-900 dark:text-white">Microsoft Teams</span>
                          <Badge className="bg-green-600">Connected</Badge>
                        </div>
                        <div className="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                          <span className="text-sm font-medium text-gray-900 dark:text-white">SAP ERP</span>
                          <Badge className="bg-green-600">Connected</Badge>
                        </div>
                      </div>
                    </div>

                    <div className="space-y-4">
                      <h4 className="font-semibold text-gray-900 dark:text-white">Available Integrations</h4>
                      <div className="space-y-3">
                        <Button className="w-full justify-start" variant="outline" data-testid="button-integrate-slack">
                          <Building2 className="w-4 h-4 mr-2" />
                          Slack Workspace
                        </Button>
                        <Button className="w-full justify-start" variant="outline" data-testid="button-integrate-jira">
                          <Target className="w-4 h-4 mr-2" />
                          Jira Project Management
                        </Button>
                        <Button className="w-full justify-start" variant="outline" data-testid="button-integrate-tableau">
                          <BarChart3 className="w-4 h-4 mr-2" />
                          Tableau Analytics
                        </Button>
                      </div>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            {/* Demo Management Tab */}
            <TabsContent value="demo" className="space-y-6">
              <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
                <CardHeader>
                  <CardTitle className="flex items-center text-gray-900 dark:text-white">
                    <PlayCircle className="w-5 h-5 mr-2 text-orange-500" />
                    Fortune 500 Demo Management
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-6">
                    <Alert className="border-orange-200 bg-orange-50 dark:bg-orange-900/20">
                      <AlertTriangle className="h-4 w-4 text-orange-600" />
                      <AlertDescription className="text-orange-800 dark:text-orange-200">
                        <strong>Demo Reset:</strong> This completely replaces all platform data with a selected Fortune 500 executive crisis scenario for sales presentations. Choose from multiple compelling narratives.
                      </AlertDescription>
                    </Alert>

                    <div className="space-y-4">
                      <div>
                        <Label htmlFor="scenario-select" className="text-sm font-medium text-gray-900 dark:text-white">
                          Select Demo Scenario
                        </Label>
                        <Select value={selectedScenario} onValueChange={setSelectedScenario}>
                          <SelectTrigger className="w-full mt-2" data-testid="select-demo-scenario">
                            <SelectValue placeholder="Choose a Fortune 500 crisis scenario..." />
                          </SelectTrigger>
                          <SelectContent>
                            {!scenariosLoading && scenariosData?.scenarios?.map((scenario: any) => (
                              <SelectItem key={scenario.id} value={scenario.id}>
                                {scenario.name}
                              </SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    {scenariosData?.scenarios && (
                      <div className="bg-gradient-to-r .section-background dark:from-blue-900/20 dark:to-purple-900/20 p-6 rounded-lg border border-blue-200 dark:border-blue-800">
                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">Selected Scenario Preview</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                          <div className="space-y-2">
                            <div className="flex items-center text-sm text-gray-700 dark:text-gray-300">
                              <Building2 className="w-4 h-4 mr-2 text-blue-500" />
                              <span><strong>Scenario:</strong> {scenariosData.scenarios.find((s: any) => s.id === selectedScenario)?.name}</span>
                            </div>
                            <div className="flex items-center text-sm text-gray-700 dark:text-gray-300">
                              <AlertTriangle className="w-4 h-4 mr-2 text-red-500" />
                              <span><strong>Crisis Type:</strong> Executive-Level Response</span>
                            </div>
                            <div className="flex items-center text-sm text-gray-700 dark:text-gray-300">
                              <Target className="w-4 h-4 mr-2 text-orange-500" />
                              <span><strong>Audience:</strong> Fortune 500 Executives</span>
                            </div>
                          </div>
                          <div className="space-y-2">
                            <div className="flex items-center text-sm text-gray-700 dark:text-gray-300">
                              <Users className="w-4 h-4 mr-2 text-green-500" />
                              <span><strong>Executive Team:</strong> C-Suite Leadership</span>
                            </div>
                            <div className="flex items-center text-sm text-gray-700 dark:text-gray-300">
                              <Clock className="w-4 h-4 mr-2 text-purple-500" />
                              <span><strong>Timeline:</strong> Active crisis response</span>
                            </div>
                            <div className="flex items-center text-sm text-gray-700 dark:text-gray-300">
                              <Activity className="w-4 h-4 mr-2 text-blue-500" />
                              <span><strong>AI Modules:</strong> Full intelligence suite</span>
                            </div>
                          </div>
                        </div>

                        <div className="bg-white/60 dark:bg-slate-800/60 p-4 rounded-lg border border-blue-200 dark:border-blue-700">
                          <p className="text-sm text-gray-700 dark:text-gray-300 mb-3">
                            <strong>Demo Title:</strong> {scenariosData.scenarios.find((s: any) => s.id === selectedScenario)?.title}
                          </p>
                          <p className="text-xs text-gray-600 dark:text-gray-400">
                            Each scenario includes realistic organizational data, executive briefings, strategic action items, AI intelligence modules, and crisis response workflows tailored for Fortune 500 leadership demonstrations.
                          </p>
                        </div>
                      </div>
                    )}

                    <div className="flex flex-col sm:flex-row gap-4">
                      <Button 
                        onClick={() => resetDemoMutation.mutate()}
                        disabled={resetDemoMutation.isPending || scenariosLoading}
                        className="flex-1 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white h-12"
                        data-testid="button-reset-demo-scenario"
                      >
                        {resetDemoMutation.isPending ? (
                          <>
                            <RefreshCw className="w-4 h-4 mr-2 animate-spin" />
                            Resetting Demo Data...
                          </>
                        ) : (
                          <>
                            <RotateCcw className="w-4 h-4 mr-2" />
                            Reset Selected Scenario
                          </>
                        )}
                      </Button>
                      <Button 
                        variant="outline" 
                        className="flex-1 h-12"
                        data-testid="button-preview-demo-data"
                      >
                        <FileText className="w-4 h-4 mr-2" />
                        Preview Demo Data
                      </Button>
                    </div>

                    <div className="text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg">
                      <strong>Note:</strong> This action will completely replace all organizations, users, scenarios, tasks, and AI intelligence data with the Golden Demo dataset. This is intended for sales presentations and demonstrations only.
                    </div>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>
          </Tabs>

          {/* Enterprise Administration Actions */}
          <Card className="mt-8 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-purple-200 dark:border-purple-800">
            <CardHeader>
              <CardTitle className="flex items-center text-gray-900 dark:text-white">
                <Crown className="w-5 h-5 mr-2 text-purple-500" />
                Enterprise Administration Commands
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <Button className="h-16 bg-blue-600 hover:bg-blue-700 text-white" data-testid="button-backup-system">
                  <Database className="w-5 h-5 mr-2" />
                  System Backup
                </Button>
                <Button className="h-16 bg-green-600 hover:bg-green-700 text-white" data-testid="button-performance-optimization">
                  <Zap className="w-5 h-5 mr-2" />
                  Optimize Performance
                </Button>
                <Button className="h-16 bg-purple-600 hover:bg-purple-700 text-white" data-testid="button-security-scan">
                  <Shield className="w-5 h-5 mr-2" />
                  Security Scan
                </Button>
                <Button className="h-16 bg-orange-600 hover:bg-orange-700 text-white" data-testid="button-generate-reports">
                  <BarChart3 className="w-5 h-5 mr-2" />
                  Generate Reports
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/SHEINTrendDemo.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useState } from "react";
import { Link } from "wouter";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { TrendingUp, Zap, Target, ShoppingBag, CheckCircle, Users, DollarSign, ArrowLeft, Play } from "lucide-react";
import AIRadarSimulation from "@/components/demo/AIRadarSimulation";
import TwelveMinuteTimer from "@/components/demo/TwelveMinuteTimer";
import ROIComparison from "@/components/demo/ROIComparison";
import DemoNavHeader from "@/components/demo/DemoNavHeader";
import { sheinTrendDemoData } from "@shared/shein-trend-data";

type DemoAct = "intro" | "detection" | "coordination" | "outcome";

export default function SHEINTrendDemo() {
  const [currentAct, setCurrentAct] = useState<DemoAct>("intro");
  const [coordinationComplete, setCoordinationComplete] = useState(false);

  const goToAct = (act: DemoAct) => {
    setCurrentAct(act);
    if (act === "intro") {
      setCoordinationComplete(false);
    }
  };

  const resetDemo = () => {
    setCurrentAct("intro");
    setCoordinationComplete(false);
  };

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-950 via-pink-950 to-slate-900">
      <DemoNavHeader title="SHEIN Trend Demo" showBackButton={true} />

      {/* Act Navigation */}
      <div className="border-b border-pink-800/20 bg-slate-950/30 pt-20">
        <div className="container mx-auto px-6 py-3">
          <div className="flex justify-between items-center">
            {[
              { id: "intro", label: "1. Introduction", icon: Play },
              { id: "detection", label: "2. AI Detection @ 96%", icon: Target },
              { id: "coordination", label: "3. 12-Minute Response", icon: Zap },
              { id: "outcome", label: "4. First-Mover Win", icon: TrendingUp }
            ].map((act) => (
              <button
                key={act.id}
                onClick={() => goToAct(act.id as DemoAct)}
                className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
                  currentAct === act.id
                    ? "bg-pink-600 text-white"
                    : "text-pink-300 hover:bg-pink-950/50"
                }`}
                data-testid={`button-act-${act.id}`}
              >
                <act.icon className="w-4 h-4" />
                <span className="text-sm font-medium">{act.label}</span>
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="container mx-auto px-6 py-12">
        {/* ACT 1: INTRODUCTION */}
        {currentAct === "intro" && (
          <div className="max-w-5xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-pink-800/30">
              <div className="text-center mb-8">
                <TrendingUp className="w-16 h-16 text-pink-400 mx-auto mb-4" />
                <h2 className="text-3xl font-bold text-white mb-3">{sheinTrendDemoData.crisis.title}</h2>
                <p className="text-xl text-pink-200">{sheinTrendDemoData.crisis.subtitle}</p>
              </div>

              <div className="grid md:grid-cols-2 gap-6 mb-8">
                <div className="p-6 bg-pink-950/30 rounded-lg border border-pink-800/30">
                  <h3 className="font-bold text-white mb-4 flex items-center gap-2">
                    <TrendingUp className="w-5 h-5 text-pink-400" />
                    The Opportunity
                  </h3>
                  <div className="space-y-3 text-sm">
                    <div>
                      <div className="text-pink-300 mb-1">Viral Trend</div>
                      <div className="text-white font-semibold">Cottage Core Renaissance - 47M TikTok views in 18 hours</div>
                    </div>
                    <div>
                      <div className="text-pink-300 mb-1">Market Opportunity</div>
                      <div className="text-white">$180M revenue, 21-day lifecycle</div>
                    </div>
                    <div>
                      <div className="text-pink-300 mb-1">Strategic Move</div>
                      <div className="text-white">200 SKUs  5,000 suppliers  7-day launch</div>
                    </div>
                    <div>
                      <div className="text-pink-300 mb-1">First-Mover Advantage</div>
                      <div className="text-white font-bold">65% market share if launched in 7 days</div>
                    </div>
                  </div>
                </div>

                <div className="p-6 bg-slate-900/50 rounded-lg border border-pink-800/30">
                  <h3 className="font-bold text-white mb-4">Traditional Coordination Timeline</h3>
                  <ul className="space-y-2 text-sm text-pink-200">
                    <li> Day 1-2: Design teams start planning independently</li>
                    <li> Day 2-3: Supplier coordination meetings drag on</li>
                    <li className="text-amber-400 font-semibold"> During gap: Zara and H&M detect same trend</li>
                    <li className="text-red-400 font-bold"> During gap: Launch delayed to day 10</li>
                    <li> Day 10+: Launch alongside competitors (not first)</li>
                    <li className="text-pink-300"> Result: 40% market share instead of 65% ($72M vs $180M)</li>
                  </ul>
                </div>
              </div>

              <div className="bg-gradient-to-r from-pink-950/50 to-rose-950/50 border border-pink-700 rounded-lg p-6 mb-8">
                <div className="flex items-start gap-4">
                  <Target className="w-8 h-8 text-pink-400 flex-shrink-0 mt-1" />
                  <div>
                    <h3 className="font-bold text-white mb-2">Speed = Market Share in Fast Fashion</h3>
                    <p className="text-pink-100 leading-relaxed">
                      SHEIN's AI detected the Cottage Core trend instantly. But coordinating 5,847 stakeholders (180 designers, 
                      5,000 suppliers, logistics, marketing) traditionally takes <strong>48-72 hours</strong>enough time for 
                      Zara and H&M to respond. In fast fashion, first-mover captures 65% of revenue. M compresses coordination 
                      to <strong>12 minutes</strong>, enabling 7-day launch before competitors detect the trend.
                    </p>
                  </div>
                </div>
              </div>

              <div className="grid md:grid-cols-3 gap-4 mb-8">
                <div className="p-4 bg-pink-950/30 rounded-lg border border-pink-800/30 text-center">
                  <Users className="w-8 h-8 text-pink-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">5,847</div>
                  <div className="text-sm text-pink-300">Stakeholders Coordinated</div>
                </div>
                <div className="p-4 bg-pink-950/30 rounded-lg border border-pink-800/30 text-center">
                  <Zap className="w-8 h-8 text-pink-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">12 Minutes</div>
                  <div className="text-sm text-pink-300">Full Coordination</div>
                </div>
                <div className="p-4 bg-pink-950/30 rounded-lg border border-pink-800/30 text-center">
                  <DollarSign className="w-8 h-8 text-pink-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">$108M</div>
                  <div className="text-sm text-pink-300">Additional Revenue</div>
                </div>
              </div>

              <div className="text-center">
                <Button
                  size="lg"
                  onClick={() => goToAct("detection")}
                  className="bg-pink-600 hover:bg-pink-700 text-white px-8 py-6 text-lg"
                  data-testid="button-begin-simulation"
                >
                  <Play className="w-5 h-5 mr-2" />
                  Begin Trend Simulation
                </Button>
                <p className="text-sm text-pink-400 mt-3">Experience first-mover coordination velocity</p>
              </div>
            </Card>
          </div>
        )}

        {/* ACT 2: AI DETECTION */}
        {currentAct === "detection" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-pink-800/30">
              <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                <Target className="w-8 h-8 text-pink-400" />
                Act 2: AI Trend Detection
              </h2>
              <p className="text-lg text-pink-200 mb-4">
                11:00 AM EST - SHEIN AI detects viral trend: "Cottage Core Renaissance" explodes on TikTok with 47M views in 18 hours. 
                2,300 influencers posting, 850% search spike. Trend lifecycle: 21 days. Window to capture 65% market share: 7 days.
              </p>
              <div className="mt-6 p-4 bg-pink-900/50 border border-pink-500 rounded">
                <div className="flex items-center gap-3">
                  <CheckCircle className="h-6 w-6 text-pink-400 animate-pulse" />
                  <div>
                    <p className="font-bold text-white">Viral Trend Criteria Met</p>
                    <p className="text-sm text-pink-200">
                      First-mover window open - Playbook #146 (Trend Capitalization) recommended
                    </p>
                  </div>
                </div>
              </div>
            </Card>

            <AIRadarSimulation
              dataStreams={sheinTrendDemoData.aiDataStreams}
              title="Trend Intelligence Signals"
              playbookId="#146"
              playbookName="Trend Capitalization"
              autoStart={true}
            />

            <div className="text-center mt-8">
              <Button
                size="lg"
                onClick={() => goToAct("coordination")}
                className="gap-2 bg-pink-600 hover:bg-pink-700 text-white"
                data-testid="button-activate-playbook"
              >
                <TrendingUp className="h-5 w-5" />
                Activate Playbook #146 - Trend Capitalization
              </Button>
              <p className="text-sm text-pink-300 mt-2">
                CEO approves - Launch 200 SKUs in 7 days
              </p>
            </div>
          </div>
        )}

        {/* ACT 3: COORDINATED RESPONSE */}
        {currentAct === "coordination" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-pink-800/30">
              <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                <Zap className="w-8 h-8 text-pink-400" />
                Act 3: 12-Minute Coordinated Execution
              </h2>
              <p className="text-lg text-pink-200 mb-6">
                M coordinates all 5,847 stakeholders in 12 minutes. CEO decision triggers instant alignment across designers, 
                production coordinators, 5,000 suppliers, and marketing teamsenabling 7-day launch before Zara/H&M respond.
              </p>

              <div className="grid md:grid-cols-3 gap-6 mb-8">
                <div className="p-6 bg-pink-950/30 rounded-lg border border-pink-800/30">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-full bg-pink-600 flex items-center justify-center text-white font-bold">1</div>
                    <h3 className="font-bold text-white">Design Teams</h3>
                  </div>
                  <p className="text-sm text-pink-200 mb-2">180 designers begin creating 200 SKUs using AI trend insights</p>
                  <div className="text-2xl font-bold text-pink-400">180 Designers</div>
                </div>
                <div className="p-6 bg-pink-950/30 rounded-lg border border-pink-800/30">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-full bg-pink-600 flex items-center justify-center text-white font-bold">2</div>
                    <h3 className="font-bold text-white">Supplier Network</h3>
                  </div>
                  <p className="text-sm text-pink-200 mb-2">5,000 suppliers receive production orders, 3,200 begin manufacturing</p>
                  <div className="text-2xl font-bold text-pink-400">5,000 Suppliers</div>
                </div>
                <div className="p-6 bg-pink-950/30 rounded-lg border border-pink-800/30">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-full bg-pink-600 flex items-center justify-center text-white font-bold">3</div>
                    <h3 className="font-bold text-white">Marketing Launch</h3>
                  </div>
                  <p className="text-sm text-pink-200 mb-2">2,300 TikTok influencers engaged, campaign ready for day-7 launch</p>
                  <div className="text-2xl font-bold text-pink-400">667 Specialists</div>
                </div>
              </div>
            </Card>

            <TwelveMinuteTimer
              timelineEvents={sheinTrendDemoData.timelineEvents}
              onComplete={() => setCoordinationComplete(true)}
              autoStart={true}
            />

            {coordinationComplete && (
              <div className="text-center animate-in fade-in duration-500">
                <Button
                  size="lg"
                  onClick={() => goToAct("outcome")}
                  className="gap-2 bg-pink-600 hover:bg-pink-700 text-white"
                  data-testid="button-view-outcome"
                >
                  <TrendingUp className="h-5 w-5" />
                  View First-Mover Outcome
                </Button>
              </div>
            )}
          </div>
        )}

        {/* ACT 4: ROI OUTCOME */}
        {currentAct === "outcome" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-pink-800/30 text-center">
              <TrendingUp className="w-16 h-16 text-pink-400 mx-auto mb-4" />
              <h2 className="text-3xl font-bold text-white mb-3">
                $108M Additional Revenue Through First-Mover Velocity
              </h2>
              <p className="text-xl text-pink-200 mb-6">
                SHEIN coordinates 5,847 stakeholders in 12 minutes, launches 200 SKUs on day 7capturing 65% market 
                share and $180M revenue while Zara/H&M are still planning.
              </p>

              <div className="grid md:grid-cols-3 gap-6 mb-8">
                <div className="p-4 bg-pink-950/30 rounded-lg">
                  <div className="text-3xl font-bold text-pink-400 mb-2">$108M</div>
                  <div className="text-sm text-pink-300">Additional Revenue vs Late Launch</div>
                </div>
                <div className="p-4 bg-pink-950/30 rounded-lg">
                  <div className="text-3xl font-bold text-pink-400 mb-2">12 Min</div>
                  <div className="text-sm text-pink-300">vs 48-72 Hours Traditional</div>
                </div>
                <div className="p-4 bg-pink-950/30 rounded-lg">
                  <div className="text-3xl font-bold text-pink-400 mb-2">65%</div>
                  <div className="text-sm text-pink-300">Market Share Captured</div>
                </div>
              </div>
            </Card>

            <ROIComparison
              traditional={sheinTrendDemoData.roiComparisonData.traditional}
              vexor={sheinTrendDemoData.roiComparisonData.vexor}
              bottomLine={sheinTrendDemoData.roiComparisonData.bottomLine}
            />

            <div className="flex justify-center gap-4">
              <Button onClick={resetDemo} variant="outline" className="border-pink-500 text-pink-300 hover:bg-pink-950" data-testid="button-replay">
                Replay Demo
              </Button>
              <Link href="/industry-demos">
                <Button className="bg-pink-600 hover:bg-pink-700 text-white" data-testid="button-all-demos">
                  View All Industry Demos
                </Button>
              </Link>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/SignalIntelligenceHub.tsx
========================================
import { useState, useEffect } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { queryClient, apiRequest } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';
import PageLayout from '@/components/layout/PageLayout';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Switch } from '@/components/ui/switch';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Separator } from '@/components/ui/separator';
import { Textarea } from '@/components/ui/textarea';
import { 
  Radio, 
  ChevronRight, 
  ChevronLeft,
  Search,
  Plus,
  Settings,
  AlertTriangle,
  CheckCircle,
  Clock,
  Database,
  Zap,
  Target,
  TrendingUp,
  Activity,
  DollarSign,
  Scale,
  Truck,
  Heart,
  Users,
  Cpu,
  Newspaper,
  Globe,
  BarChart3,
  Handshake,
  Lightbulb,
  Leaf,
  Swords,
  Eye,
  Edit,
  Trash2,
  Play,
  Pause,
  RefreshCw,
  Bell,
  Layers,
  Copy,
  Sparkles
} from 'lucide-react';
import { Link } from 'wouter';
import { SIGNAL_CATEGORIES, type SignalCategory, type DataPoint } from '@shared/intelligence-signals';

const iconMap: Record<string, any> = {
  Swords, TrendingUp, DollarSign, Scale, Truck, Heart, Users, Cpu, 
  Newspaper, Globe, BarChart3, Handshake, Target, Activity, Lightbulb, Leaf
};

function CategoryIcon({ iconName, className, style }: { iconName: string; className?: string; style?: React.CSSProperties }) {
  const Icon = iconMap[iconName] || Radio;
  return <Icon className={className} style={style} />;
}

function getOperatorLabel(operator: string): string {
  const labels: Record<string, string> = {
    gt: '>',
    lt: '<',
    gte: '',
    lte: '',
    eq: '=',
    neq: '',
    contains: 'contains',
    spike: ' spike',
    drop: ' drop',
    trend: 'trend'
  };
  return labels[operator] || operator;
}

function mapUrgencyToAlertThreshold(urgency: string): string {
  return urgency === 'critical' ? 'red' : 
         urgency === 'high' ? 'yellow' : 'green';
}

function mapUrgencyToSeverity(urgency: string): string {
  return urgency === 'critical' ? 'critical' : 
         urgency === 'high' ? 'high' :
         urgency === 'medium' ? 'medium' : 'low';
}

function mapAlertThresholdToUrgency(alertThreshold: string, severity?: string): string {
  if (alertThreshold === 'red') return 'critical';
  if (alertThreshold === 'yellow') return 'high';
  if (alertThreshold === 'green') return severity === 'medium' ? 'medium' : 'low';
  if (['critical', 'high', 'medium', 'low'].includes(alertThreshold)) return alertThreshold;
  return 'high';
}

const TRIGGER_TEMPLATES = [
  {
    id: 'competitor-launch',
    name: 'Competitor Product Launch',
    description: 'Alert when a competitor announces a new product',
    category: 'competitive',
    dataPointId: 'comp_product_launch',
    operator: 'gte',
    value: '1',
    urgency: 'critical',
    icon: Swords,
    color: '#ef4444'
  },
  {
    id: 'pricing-war',
    name: 'Pricing War Detection',
    description: 'Detect significant competitor pricing changes',
    category: 'competitive',
    dataPointId: 'comp_pricing_change',
    operator: 'drop',
    value: '15',
    urgency: 'critical',
    icon: DollarSign,
    color: '#22c55e'
  },
  {
    id: 'supply-risk',
    name: 'Supply Chain Risk',
    description: 'Monitor supplier health and lead time changes',
    category: 'supplychain',
    dataPointId: 'sc_lead_times',
    operator: 'spike',
    value: '30',
    urgency: 'high',
    icon: Truck,
    color: '#f59e0b'
  },
  {
    id: 'customer-churn',
    name: 'Customer Churn Risk',
    description: 'Alert on declining NPS or increasing churn signals',
    category: 'customer',
    dataPointId: 'cust_nps',
    operator: 'drop',
    value: '10',
    urgency: 'critical',
    icon: Heart,
    color: '#ec4899'
  },
  {
    id: 'talent-flight',
    name: 'Key Talent Departure',
    description: 'Detect signals of key employee departures',
    category: 'talent',
    dataPointId: 'tal_key_departures',
    operator: 'eq',
    value: 'true',
    urgency: 'critical',
    icon: Users,
    color: '#6366f1'
  },
  {
    id: 'regulatory-alert',
    name: 'Regulatory Change',
    description: 'Monitor new legislation or enforcement actions',
    category: 'regulatory',
    dataPointId: 'reg_legislation',
    operator: 'gte',
    value: '1',
    urgency: 'high',
    icon: Scale,
    color: '#8b5cf6'
  },
  {
    id: 'media-crisis',
    name: 'Media Crisis Detection',
    description: 'Detect negative news spikes or viral content',
    category: 'media',
    dataPointId: 'med_viral_negative',
    operator: 'gte',
    value: '1',
    urgency: 'critical',
    icon: Newspaper,
    color: '#f43f5e'
  },
  {
    id: 'ma-activity',
    name: 'M&A Activity',
    description: 'Track mergers and acquisitions in your sector',
    category: 'financial',
    dataPointId: 'fin_ma_activity',
    operator: 'gte',
    value: '1',
    urgency: 'critical',
    icon: DollarSign,
    color: '#22c55e'
  }
];

function SignalCategoryCard({ 
  category, 
  onSelect,
  isActive,
  triggerCount 
}: { 
  category: SignalCategory; 
  onSelect: () => void;
  isActive: boolean;
  triggerCount: number;
}) {
  const dataPointCount = category.dataPoints.length;
  
  return (
    <Card 
      className={`cursor-pointer transition-all hover:shadow-lg ${isActive ? 'ring-2 ring-blue-500 border-blue-500' : ''}`}
      onClick={onSelect}
      data-testid={`signal-category-${category.id}`}
    >
      <CardContent className="p-4">
        <div className="flex items-start justify-between mb-3">
          <div 
            className="w-10 h-10 rounded-lg flex items-center justify-center"
            style={{ backgroundColor: `${category.color}20` }}
          >
            <CategoryIcon 
              iconName={category.icon} 
              className="h-5 w-5"
              style={{ color: category.color }}
            />
          </div>
          <div className="flex items-center gap-1">
            {triggerCount > 0 && (
              <Badge className="bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 text-xs">
                {triggerCount} active
              </Badge>
            )}
            <Badge 
              variant="outline" 
              className="text-xs"
              style={{ borderColor: category.color, color: category.color }}
            >
              {category.phase === 'external' ? 'External' : 'Internal'}
            </Badge>
          </div>
        </div>
        
        <h3 className="font-semibold text-sm mb-1">{category.shortName}</h3>
        <p className="text-xs text-muted-foreground mb-3 line-clamp-2">
          {category.description}
        </p>
        
        <div className="flex items-center justify-between text-xs">
          <span className="text-muted-foreground">{dataPointCount} data points</span>
          <ChevronRight className="h-3 w-3" style={{ color: category.color }} />
        </div>
      </CardContent>
    </Card>
  );
}

function DataPointRow({ 
  dataPoint, 
  category,
  onConfigureTrigger,
  onQuickToggle,
  existingTrigger,
  isToggling
}: { 
  dataPoint: DataPoint; 
  category: SignalCategory;
  onConfigureTrigger: (dp: DataPoint) => void;
  onQuickToggle: (dp: DataPoint, category: SignalCategory, enable: boolean, existingTriggerId?: string) => void;
  existingTrigger?: any;
  isToggling?: boolean;
}) {
  const isActive = existingTrigger?.isActive ?? false;
  const currentValue = dataPoint.metricType === 'percentage' 
    ? `${Math.floor(Math.random() * 100)}%`
    : dataPoint.metricType === 'currency'
    ? `$${(Math.random() * 10000000).toLocaleString()}`
    : dataPoint.metricType === 'count'
    ? Math.floor(Math.random() * 100).toString()
    : dataPoint.metricType === 'boolean'
    ? (Math.random() > 0.5 ? 'Yes' : 'No')
    : Math.floor(Math.random() * 100).toString();

  const handleToggle = (checked: boolean) => {
    onQuickToggle(dataPoint, category, checked, existingTrigger?.id);
  };

  return (
    <div className="flex items-center justify-between p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
      <div className="flex items-center gap-3 flex-1">
        <Switch 
          checked={isActive}
          onCheckedChange={handleToggle}
          disabled={isToggling}
          data-testid={`toggle-${dataPoint.id}`}
          className="data-[state=checked]:bg-emerald-500"
        />
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2">
            <span className="font-medium text-sm">{dataPoint.name}</span>
            {dataPoint.defaultThreshold && (
              <Badge variant="outline" className="text-xs">
                {getOperatorLabel(dataPoint.defaultThreshold.operator)} {dataPoint.defaultThreshold.value}{dataPoint.unit || ''}
              </Badge>
            )}
            {isActive && (
              <Badge className="bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 text-xs">
                <Bell className="h-3 w-3 mr-1" />
                Monitoring
              </Badge>
            )}
          </div>
          <p className="text-xs text-muted-foreground truncate">{dataPoint.description}</p>
        </div>
      </div>
      
      <div className="flex items-center gap-4 ml-4">
        <div className="text-right min-w-[60px]">
          <div className="text-sm font-semibold">{currentValue}</div>
          <div className="text-xs text-muted-foreground">Current</div>
        </div>
        
        <div className="hidden md:flex items-center gap-1">
          {dataPoint.sources.slice(0, 2).map((source, i) => (
            <Badge key={i} variant="secondary" className="text-xs">
              {source}
            </Badge>
          ))}
          {dataPoint.sources.length > 2 && (
            <Badge variant="secondary" className="text-xs">
              +{dataPoint.sources.length - 2}
            </Badge>
          )}
        </div>
        
        <Button 
          variant="ghost"
          size="sm"
          onClick={() => onConfigureTrigger(dataPoint)}
          data-testid={`configure-trigger-${dataPoint.id}`}
          title="Customize trigger settings"
        >
          <Settings className="h-4 w-4" />
        </Button>
      </div>
    </div>
  );
}

function MyTriggersTab({ triggers, isLoading, onEdit, onToggle, onDelete }: { 
  triggers: any[];
  isLoading: boolean;
  onEdit: (trigger: any) => void;
  onToggle: (triggerId: string, isActive: boolean) => void;
  onDelete: (triggerId: string) => void;
}) {
  if (isLoading) {
    return (
      <div className="text-center py-12">
        <RefreshCw className="h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground" />
        <p className="text-muted-foreground">Loading your triggers...</p>
      </div>
    );
  }

  if (triggers.length === 0) {
    return (
      <div className="text-center py-12">
        <Bell className="h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50" />
        <h3 className="font-semibold mb-2">No Triggers Configured</h3>
        <p className="text-sm text-muted-foreground mb-4">
          Create your first trigger to start monitoring signals
        </p>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {triggers.map((trigger: any) => {
        const category = SIGNAL_CATEGORIES.find(c => c.id === trigger.category);
        const statusColor = trigger.currentStatus === 'red' ? 'bg-red-500' :
                           trigger.currentStatus === 'yellow' ? 'bg-amber-500' : 'bg-emerald-500';
        
        return (
          <Card key={trigger.id} className={`card-bg ${!trigger.isActive ? 'opacity-60' : ''}`}>
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className={`w-3 h-3 rounded-full ${statusColor}`} />
                  <div 
                    className="w-10 h-10 rounded-lg flex items-center justify-center"
                    style={{ backgroundColor: category ? `${category.color}20` : '#e2e8f0' }}
                  >
                    {category && (
                      <CategoryIcon 
                        iconName={category.icon} 
                        className="h-5 w-5"
                        style={{ color: category.color }}
                      />
                    )}
                  </div>
                  <div>
                    <h4 className="font-semibold">{trigger.name}</h4>
                    <p className="text-sm text-muted-foreground">{trigger.description || 'No description'}</p>
                    <div className="flex items-center gap-2 mt-1">
                      <Badge variant="outline" className="text-xs">
                        {trigger.triggerType}
                      </Badge>
                      <Badge 
                        className={`text-xs ${
                          trigger.alertThreshold === 'red' || trigger.severity === 'critical' ? 'bg-red-100 text-red-700' :
                          trigger.alertThreshold === 'yellow' || trigger.severity === 'high' ? 'bg-orange-100 text-orange-700' :
                          trigger.severity === 'medium' ? 'bg-amber-100 text-amber-700' :
                          'bg-slate-100 text-slate-700'
                        }`}
                      >
                        {mapAlertThresholdToUrgency(trigger.alertThreshold, trigger.severity)}
                      </Badge>
                      {trigger.triggerCount > 0 && (
                        <span className="text-xs text-muted-foreground">
                          Triggered {trigger.triggerCount}x
                        </span>
                      )}
                    </div>
                  </div>
                </div>
                
                <div className="flex items-center gap-2">
                  <Switch 
                    checked={trigger.isActive} 
                    onCheckedChange={(checked) => onToggle(trigger.id, checked)}
                  />
                  <Button variant="ghost" size="sm" onClick={() => onEdit(trigger)}>
                    <Edit className="h-4 w-4" />
                  </Button>
                  <Button variant="ghost" size="sm" onClick={() => onDelete(trigger.id)}>
                    <Trash2 className="h-4 w-4 text-red-500" />
                  </Button>
                </div>
              </div>
            </CardContent>
          </Card>
        );
      })}
    </div>
  );
}

function TemplatesTab({ onUseTemplate }: { onUseTemplate: (template: any) => void }) {
  return (
    <div className="space-y-4">
      <div className="flex items-center gap-2 mb-4">
        <Sparkles className="h-5 w-5 text-amber-500" />
        <h3 className="font-semibold">Quick-Start Templates</h3>
        <span className="text-sm text-muted-foreground">Pre-configured triggers for common scenarios</span>
      </div>
      
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {TRIGGER_TEMPLATES.map(template => {
          const Icon = template.icon;
          return (
            <Card key={template.id} className="card-bg hover:shadow-md transition-shadow">
              <CardContent className="p-4">
                <div className="flex items-start justify-between mb-3">
                  <div 
                    className="w-10 h-10 rounded-lg flex items-center justify-center"
                    style={{ backgroundColor: `${template.color}20` }}
                  >
                    <Icon className="h-5 w-5" style={{ color: template.color }} />
                  </div>
                  <Badge 
                    className={`text-xs ${
                      template.urgency === 'critical' ? 'bg-red-100 text-red-700' :
                      template.urgency === 'high' ? 'bg-orange-100 text-orange-700' :
                      'bg-amber-100 text-amber-700'
                    }`}
                  >
                    {template.urgency}
                  </Badge>
                </div>
                <h4 className="font-semibold mb-1">{template.name}</h4>
                <p className="text-sm text-muted-foreground mb-3">{template.description}</p>
                <div className="flex items-center justify-between">
                  <Badge variant="outline" className="text-xs">
                    {getOperatorLabel(template.operator)} {template.value}
                  </Badge>
                  <Button 
                    size="sm" 
                    onClick={() => onUseTemplate(template)}
                    data-testid={`use-template-${template.id}`}
                  >
                    <Copy className="h-3 w-3 mr-1" />
                    Use Template
                  </Button>
                </div>
              </CardContent>
            </Card>
          );
        })}
      </div>
    </div>
  );
}

function TriggerConfigDialog({ 
  open, 
  onOpenChange, 
  dataPoint,
  category,
  existingTrigger,
  onSave
}: { 
  open: boolean; 
  onOpenChange: (open: boolean) => void;
  dataPoint: DataPoint | null;
  category: SignalCategory | null;
  existingTrigger?: any;
  onSave: (triggerData: any) => void;
}) {
  const [name, setName] = useState('');
  const [description, setDescription] = useState('');
  const [operator, setOperator] = useState<string>('gt');
  const [threshold, setThreshold] = useState('');
  const [urgency, setUrgency] = useState<string>('high');
  const [isActive, setIsActive] = useState(true);
  const [autoActivate, setAutoActivate] = useState(false);

  useEffect(() => {
    if (open) {
      if (existingTrigger) {
        setName(existingTrigger.name || '');
        setDescription(existingTrigger.description || '');
        setOperator(existingTrigger.conditions?.operator || 'gt');
        setThreshold(existingTrigger.conditions?.value?.toString() || '');
        setUrgency(mapAlertThresholdToUrgency(existingTrigger.alertThreshold, existingTrigger.severity));
        setIsActive(existingTrigger.isActive ?? true);
        setAutoActivate(existingTrigger.autoActivate ?? false);
      } else if (dataPoint) {
        setName(`${dataPoint.name} Monitor`);
        setDescription(`Monitor ${dataPoint.name.toLowerCase()} for changes`);
        setOperator(dataPoint.defaultThreshold?.operator || 'gt');
        setThreshold(dataPoint.defaultThreshold?.value?.toString() || '');
        setUrgency(dataPoint.defaultThreshold?.urgency || 'high');
        setIsActive(true);
        setAutoActivate(false);
      }
    }
  }, [dataPoint, open, existingTrigger]);

  const handleSave = () => {
    onSave({
      id: existingTrigger?.id,
      name,
      description,
      category: category?.id,
      triggerType: 'threshold',
      conditions: {
        dataPointId: dataPoint?.id,
        operator,
        value: threshold
      },
      alertThreshold: urgency,
      isActive,
      autoActivate,
      recommendedPlaybooks: category?.recommendedPlaybooks || []
    });
    onOpenChange(false);
  };

  if (!dataPoint || !category) return null;

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-2xl">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2">
            <div 
              className="w-8 h-8 rounded-lg flex items-center justify-center"
              style={{ backgroundColor: `${category.color}20` }}
            >
              <CategoryIcon 
                iconName={category.icon} 
                className="h-4 w-4"
                style={{ color: category.color }}
              />
            </div>
            {existingTrigger ? 'Edit Trigger' : 'Create Trigger'}: {dataPoint.name}
          </DialogTitle>
          <DialogDescription>
            Set up automated monitoring and alerts for this data point
          </DialogDescription>
        </DialogHeader>
        
        <div className="space-y-6 py-4">
          <div className="grid grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label>Trigger Name</Label>
              <Input 
                value={name} 
                onChange={(e) => setName(e.target.value)}
                placeholder="e.g., Competitor Launch Alert"
                data-testid="input-trigger-name"
              />
            </div>
            <div className="space-y-2">
              <Label>Signal Category</Label>
              <Input value={category.name} disabled />
            </div>
          </div>
          
          <div className="space-y-2">
            <Label>Description</Label>
            <Textarea 
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              placeholder="Describe what this trigger monitors..."
              rows={2}
              data-testid="input-trigger-description"
            />
          </div>
          
          <Separator />
          
          <div className="space-y-4">
            <h4 className="font-semibold">Trigger Conditions</h4>
            
            <div className="grid grid-cols-3 gap-4">
              <div className="space-y-2">
                <Label>Operator</Label>
                <Select value={operator} onValueChange={setOperator}>
                  <SelectTrigger data-testid="select-operator">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="gt">Greater than (&gt;)</SelectItem>
                    <SelectItem value="gte">Greater or equal ()</SelectItem>
                    <SelectItem value="lt">Less than (&lt;)</SelectItem>
                    <SelectItem value="lte">Less or equal ()</SelectItem>
                    <SelectItem value="eq">Equals (=)</SelectItem>
                    <SelectItem value="spike">Spike increase ()</SelectItem>
                    <SelectItem value="drop">Drop decrease ()</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              
              <div className="space-y-2">
                <Label>Threshold Value</Label>
                <Input 
                  type="text" 
                  value={threshold} 
                  onChange={(e) => setThreshold(e.target.value)}
                  placeholder={`e.g., ${dataPoint.defaultThreshold?.value || '10'}`}
                  data-testid="input-threshold"
                />
              </div>
              
              <div className="space-y-2">
                <Label>Urgency Level</Label>
                <Select value={urgency} onValueChange={setUrgency}>
                  <SelectTrigger data-testid="select-urgency">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="critical">Critical</SelectItem>
                    <SelectItem value="high">High</SelectItem>
                    <SelectItem value="medium">Medium</SelectItem>
                    <SelectItem value="low">Low</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </div>
          </div>
          
          <Separator />
          
          <div className="space-y-4">
            <h4 className="font-semibold">Data Sources</h4>
            <div className="flex flex-wrap gap-2">
              {dataPoint.sources.map((source, i) => (
                <Badge key={i} variant="outline" className="flex items-center gap-1">
                  <Database className="h-3 w-3" />
                  {source}
                </Badge>
              ))}
            </div>
            <p className="text-xs text-muted-foreground">
              These sources will be monitored for changes in this data point
            </p>
          </div>
          
          <Separator />
          
          <div className="space-y-4">
            <h4 className="font-semibold">Automation Settings</h4>
            
            <div className="flex items-center justify-between">
              <div>
                <Label>Trigger Active</Label>
                <p className="text-xs text-muted-foreground">Enable monitoring for this trigger</p>
              </div>
              <Switch 
                checked={isActive} 
                onCheckedChange={setIsActive}
                data-testid="switch-active"
              />
            </div>
            
            <div className="flex items-center justify-between">
              <div>
                <Label>Auto-Activate Playbook</Label>
                <p className="text-xs text-muted-foreground">Automatically activate recommended playbooks when triggered</p>
              </div>
              <Switch 
                checked={autoActivate} 
                onCheckedChange={setAutoActivate}
                data-testid="switch-auto-activate"
              />
            </div>
          </div>
          
          {category.recommendedPlaybooks.length > 0 && (
            <>
              <Separator />
              <div className="space-y-3">
                <h4 className="font-semibold">Recommended Playbooks</h4>
                <div className="flex flex-wrap gap-2">
                  {category.recommendedPlaybooks.map((playbook, i) => (
                    <Badge key={i} className="bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300">
                      <Target className="h-3 w-3 mr-1" />
                      {playbook}
                    </Badge>
                  ))}
                </div>
              </div>
            </>
          )}
        </div>
        
        <DialogFooter>
          <Button variant="outline" onClick={() => onOpenChange(false)}>
            Cancel
          </Button>
          <Button onClick={handleSave} data-testid="button-save-trigger">
            <CheckCircle className="h-4 w-4 mr-2" />
            {existingTrigger ? 'Update Trigger' : 'Create Trigger'}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}

function CompositeBuilderDialog({ 
  open, 
  onOpenChange,
  onSave 
}: { 
  open: boolean; 
  onOpenChange: (open: boolean) => void;
  onSave: (triggerData: any) => void;
}) {
  const [name, setName] = useState('');
  const [description, setDescription] = useState('');
  const [logic, setLogic] = useState<'AND' | 'OR'>('AND');
  const [conditions, setConditions] = useState<any[]>([
    { categoryId: '', dataPointId: '', operator: 'gt', value: '' }
  ]);
  const [urgency, setUrgency] = useState('high');

  const addCondition = () => {
    setConditions([...conditions, { categoryId: '', dataPointId: '', operator: 'gt', value: '' }]);
  };

  const removeCondition = (index: number) => {
    setConditions(conditions.filter((_, i) => i !== index));
  };

  const updateCondition = (index: number, field: string, value: string) => {
    const newConditions = [...conditions];
    newConditions[index] = { ...newConditions[index], [field]: value };
    if (field === 'categoryId') {
      newConditions[index].dataPointId = '';
    }
    setConditions(newConditions);
  };

  const handleSave = () => {
    onSave({
      name,
      description,
      triggerType: 'composite',
      conditions: {
        logic,
        conditions: conditions.filter(c => c.dataPointId)
      },
      alertThreshold: urgency,
      isActive: true
    });
    onOpenChange(false);
    setName('');
    setDescription('');
    setConditions([{ categoryId: '', dataPointId: '', operator: 'gt', value: '' }]);
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-3xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2">
            <Layers className="h-5 w-5 text-purple-500" />
            Create Composite Trigger
          </DialogTitle>
          <DialogDescription>
            Combine multiple conditions to create sophisticated trigger logic
          </DialogDescription>
        </DialogHeader>
        
        <div className="space-y-6 py-4">
          <div className="grid grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label>Trigger Name</Label>
              <Input 
                value={name} 
                onChange={(e) => setName(e.target.value)}
                placeholder="e.g., Multi-Signal Crisis Alert"
              />
            </div>
            <div className="space-y-2">
              <Label>Urgency Level</Label>
              <Select value={urgency} onValueChange={setUrgency}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="critical">Critical</SelectItem>
                  <SelectItem value="high">High</SelectItem>
                  <SelectItem value="medium">Medium</SelectItem>
                  <SelectItem value="low">Low</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
          
          <div className="space-y-2">
            <Label>Description</Label>
            <Textarea 
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              placeholder="Describe the composite trigger..."
              rows={2}
            />
          </div>
          
          <Separator />
          
          <div className="space-y-4">
            <div className="flex items-center justify-between">
              <h4 className="font-semibold">Conditions</h4>
              <div className="flex items-center gap-2">
                <span className="text-sm text-muted-foreground">Logic:</span>
                <Select value={logic} onValueChange={(v) => setLogic(v as 'AND' | 'OR')}>
                  <SelectTrigger className="w-24">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="AND">AND</SelectItem>
                    <SelectItem value="OR">OR</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </div>
            
            <div className="space-y-3">
              {conditions.map((condition, index) => {
                const selectedCategory = SIGNAL_CATEGORIES.find(c => c.id === condition.categoryId);
                return (
                  <div key={index} className="flex items-center gap-2">
                    {index > 0 && (
                      <Badge variant="outline" className="shrink-0">
                        {logic}
                      </Badge>
                    )}
                    <Select 
                      value={condition.categoryId} 
                      onValueChange={(v) => updateCondition(index, 'categoryId', v)}
                    >
                      <SelectTrigger className="w-40">
                        <SelectValue placeholder="Category" />
                      </SelectTrigger>
                      <SelectContent>
                        {SIGNAL_CATEGORIES.map(cat => (
                          <SelectItem key={cat.id} value={cat.id}>{cat.shortName}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    
                    <Select 
                      value={condition.dataPointId} 
                      onValueChange={(v) => updateCondition(index, 'dataPointId', v)}
                      disabled={!condition.categoryId}
                    >
                      <SelectTrigger className="w-48">
                        <SelectValue placeholder="Data Point" />
                      </SelectTrigger>
                      <SelectContent>
                        {selectedCategory?.dataPoints.map(dp => (
                          <SelectItem key={dp.id} value={dp.id}>{dp.name}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    
                    <Select 
                      value={condition.operator} 
                      onValueChange={(v) => updateCondition(index, 'operator', v)}
                    >
                      <SelectTrigger className="w-32">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="gt">&gt;</SelectItem>
                        <SelectItem value="lt">&lt;</SelectItem>
                        <SelectItem value="gte"></SelectItem>
                        <SelectItem value="lte"></SelectItem>
                        <SelectItem value="spike"> spike</SelectItem>
                        <SelectItem value="drop"> drop</SelectItem>
                      </SelectContent>
                    </Select>
                    
                    <Input 
                      value={condition.value}
                      onChange={(e) => updateCondition(index, 'value', e.target.value)}
                      placeholder="Value"
                      className="w-24"
                    />
                    
                    {conditions.length > 1 && (
                      <Button 
                        variant="ghost" 
                        size="sm"
                        onClick={() => removeCondition(index)}
                      >
                        <Trash2 className="h-4 w-4 text-red-500" />
                      </Button>
                    )}
                  </div>
                );
              })}
            </div>
            
            <Button variant="outline" size="sm" onClick={addCondition}>
              <Plus className="h-4 w-4 mr-1" />
              Add Condition
            </Button>
          </div>
        </div>
        
        <DialogFooter>
          <Button variant="outline" onClick={() => onOpenChange(false)}>
            Cancel
          </Button>
          <Button onClick={handleSave} disabled={!name || conditions.every(c => !c.dataPointId)}>
            <CheckCircle className="h-4 w-4 mr-2" />
            Create Composite Trigger
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}

export default function SignalIntelligenceHub() {
  const { toast } = useToast();
  const [selectedCategory, setSelectedCategory] = useState<SignalCategory | null>(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [phaseFilter, setPhaseFilter] = useState<'all' | 'external' | 'internal'>('all');
  const [activeTab, setActiveTab] = useState<'brief' | 'signals' | 'triggers' | 'templates'>('brief');
  const [configDialogOpen, setConfigDialogOpen] = useState(false);
  const [compositeDialogOpen, setCompositeDialogOpen] = useState(false);
  const [selectedDataPoint, setSelectedDataPoint] = useState<DataPoint | null>(null);
  const [editingTrigger, setEditingTrigger] = useState<any>(null);

  const { data: triggers = [], isLoading: triggersLoading } = useQuery<any[]>({
    queryKey: ['/api/executive-triggers'],
  });

  const { data: organizations = [] } = useQuery<any[]>({
    queryKey: ['/api/organizations'],
  });
  const organizationId = organizations[0]?.id;

  const createTriggerMutation = useMutation({
    mutationFn: async (triggerData: any) => {
      const urgency = triggerData.alertThreshold || 'high';
      const payload = {
        organizationId: organizationId || '00000000-0000-0000-0000-000000000000',
        name: triggerData.name || 'New Trigger',
        description: triggerData.description || '',
        category: triggerData.category || 'competitive',
        triggerType: triggerData.triggerType || 'threshold',
        conditions: triggerData.conditions || {},
        severity: mapUrgencyToSeverity(urgency),
        alertThreshold: mapUrgencyToAlertThreshold(urgency),
        recommendedPlaybooks: Array.isArray(triggerData.recommendedPlaybooks) 
          ? triggerData.recommendedPlaybooks 
          : [],
        notificationSettings: { email: true, slack: false, teams: false },
        createdBy: 'current-user'
      };
      console.log('Creating trigger with payload:', payload);
      return apiRequest('POST', '/api/executive-triggers', payload);
    },
    onSuccess: () => {
      queryClient.refetchQueries({ queryKey: ['/api/executive-triggers'], exact: false });
      toast({ title: 'Trigger created', description: 'Your trigger is now active' });
    },
    onError: (error: any) => {
      console.error('Create trigger error:', error);
      toast({ title: 'Error', description: 'Failed to create trigger. Check console for details.', variant: 'destructive' });
    }
  });

  const updateTriggerMutation = useMutation({
    mutationFn: async ({ id, isActive, ...data }: any) => {
      if (isActive !== undefined && Object.keys(data).length === 0) {
        console.log('Toggling trigger active state:', id, isActive);
        return apiRequest('PUT', `/api/executive-triggers/${id}`, { isActive });
      }
      
      const payload: Record<string, any> = {};
      if (data.name !== undefined) payload.name = data.name;
      if (data.description !== undefined) payload.description = data.description;
      if (isActive !== undefined) payload.isActive = isActive;
      if (data.conditions !== undefined) payload.conditions = data.conditions;
      if (data.alertThreshold !== undefined) {
        payload.severity = mapUrgencyToSeverity(data.alertThreshold);
        payload.alertThreshold = mapUrgencyToAlertThreshold(data.alertThreshold);
      }
      console.log('Updating trigger with payload:', id, payload);
      return apiRequest('PUT', `/api/executive-triggers/${id}`, payload);
    },
    onSuccess: () => {
      queryClient.refetchQueries({ queryKey: ['/api/executive-triggers'], exact: false });
      toast({ title: 'Trigger updated', description: 'Changes saved successfully' });
    },
    onError: (error: any) => {
      console.error('Update trigger error:', error);
      toast({ title: 'Error', description: 'Failed to update trigger', variant: 'destructive' });
    }
  });

  const deleteTriggerMutation = useMutation({
    mutationFn: async (id: string) => {
      console.log('Deleting trigger:', id);
      return apiRequest('DELETE', `/api/executive-triggers/${id}`);
    },
    onSuccess: () => {
      queryClient.refetchQueries({ queryKey: ['/api/executive-triggers'], exact: false });
      toast({ title: 'Trigger deleted' });
    },
    onError: (error: any) => {
      console.error('Delete trigger error:', error);
      toast({ title: 'Error', description: 'Failed to delete trigger', variant: 'destructive' });
    }
  });

  const filteredCategories = SIGNAL_CATEGORIES.filter(cat => {
    const matchesSearch = cat.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                         cat.description.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesPhase = phaseFilter === 'all' || cat.phase === phaseFilter;
    return matchesSearch && matchesPhase;
  });

  const externalCount = SIGNAL_CATEGORIES.filter(c => c.phase === 'external').length;
  const internalCount = SIGNAL_CATEGORIES.filter(c => c.phase === 'internal').length;
  const totalDataPoints = SIGNAL_CATEGORIES.reduce((sum, cat) => sum + cat.dataPoints.length, 0);
  // Ensure triggers is always an array
  const safeTriggers = Array.isArray(triggers) ? triggers : [];
  const activeTriggerCount = safeTriggers.filter((t: any) => t.isActive).length;

  const getCategoryTriggerCount = (categoryId: string) => {
    return safeTriggers.filter((t: any) => t.category === categoryId && t.isActive).length;
  };

  const handleConfigureTrigger = (dp: DataPoint) => {
    setSelectedDataPoint(dp);
    setEditingTrigger(null);
    setConfigDialogOpen(true);
  };

  const handleEditTrigger = (trigger: any) => {
    const category = SIGNAL_CATEGORIES.find(c => c.id === trigger.category);
    const dataPoint = category?.dataPoints.find(dp => dp.id === trigger.conditions?.dataPointId);
    setSelectedCategory(category || null);
    setSelectedDataPoint(dataPoint || null);
    setEditingTrigger(trigger);
    setConfigDialogOpen(true);
  };

  const handleSaveTrigger = (triggerData: any) => {
    if (triggerData.id) {
      updateTriggerMutation.mutate(triggerData);
    } else {
      createTriggerMutation.mutate(triggerData);
    }
  };

  const handleToggleTrigger = (triggerId: string, isActive: boolean) => {
    updateTriggerMutation.mutate({ id: triggerId, isActive });
  };

  const handleDeleteTrigger = (triggerId: string) => {
    deleteTriggerMutation.mutate(triggerId);
  };

  const handleQuickToggle = (dataPoint: DataPoint, category: SignalCategory, enable: boolean, existingTriggerId?: string) => {
    if (enable) {
      if (existingTriggerId) {
        updateTriggerMutation.mutate({ id: existingTriggerId, isActive: true });
      } else {
        const defaultThreshold = dataPoint.defaultThreshold;
        const urgency = defaultThreshold?.urgency || 'high';
        const thresholdValue = defaultThreshold?.value;
        const valueAsString = thresholdValue !== undefined && thresholdValue !== null 
          ? String(thresholdValue) 
          : '0';
        
        createTriggerMutation.mutate({
          name: `${dataPoint.name} Monitor`,
          description: `Auto-monitoring: ${dataPoint.description}`,
          category: category.id,
          triggerType: 'threshold',
          conditions: {
            dataPointId: dataPoint.id,
            operator: defaultThreshold?.operator || 'gt',
            value: valueAsString
          },
          alertThreshold: urgency,
          isActive: true,
          autoActivate: false,
          recommendedPlaybooks: category.recommendedPlaybooks || []
        });
      }
    } else {
      if (existingTriggerId) {
        updateTriggerMutation.mutate({ id: existingTriggerId, isActive: false });
      }
    }
  };

  const handleUseTemplate = (template: any) => {
    const category = SIGNAL_CATEGORIES.find(c => c.id === template.category);
    const dataPoint = category?.dataPoints.find(dp => dp.id === template.dataPointId);
    if (category && dataPoint) {
      setSelectedCategory(category);
      setSelectedDataPoint(dataPoint);
      setEditingTrigger({
        name: template.name,
        description: template.description,
        conditions: { operator: template.operator, value: template.value },
        alertThreshold: template.urgency
      });
      setConfigDialogOpen(true);
    }
  };

  return (
    <PageLayout>
      <div className="flex-1 overflow-auto page-background">
        <div className="max-w-7xl mx-auto p-6 space-y-6">
          
          {/* Header */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              {selectedCategory && activeTab === 'signals' && (
                <Button 
                  variant="ghost" 
                  size="sm"
                  onClick={() => setSelectedCategory(null)}
                  data-testid="button-back-to-categories"
                >
                  <ChevronLeft className="h-4 w-4 mr-1" />
                  All Categories
                </Button>
              )}
              <div>
                <h1 className="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                  <Radio className="h-6 w-6 text-amber-500" />
                  {selectedCategory && activeTab === 'signals' ? selectedCategory.name : 'Signal Intelligence Hub'}
                </h1>
                <p className="text-sm text-muted-foreground mt-1">
                  {selectedCategory && activeTab === 'signals'
                    ? selectedCategory.description 
                    : `Monitor ${totalDataPoints} data points across ${SIGNAL_CATEGORIES.length} signal categories`
                  }
                </p>
              </div>
            </div>
            
            <div className="flex items-center gap-2">
              <Button 
                variant="outline" 
                onClick={() => setCompositeDialogOpen(true)}
                data-testid="button-composite-trigger"
              >
                <Layers className="h-4 w-4 mr-2" />
                Composite Trigger
              </Button>
              <Button 
                onClick={() => {
                  setActiveTab('templates');
                }}
                data-testid="button-create-trigger"
              >
                <Plus className="h-4 w-4 mr-2" />
                New Trigger
              </Button>
            </div>
          </div>

          {/* Stats Bar */}
          <div className="grid grid-cols-5 gap-4">
            <Card className="card-bg">
              <CardContent className="p-4 flex items-center gap-3">
                <div className="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                  <Radio className="h-5 w-5 text-blue-600 dark:text-blue-400" />
                </div>
                <div>
                  <div className="text-2xl font-bold">{SIGNAL_CATEGORIES.length}</div>
                  <div className="text-xs text-muted-foreground">Categories</div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="card-bg">
              <CardContent className="p-4 flex items-center gap-3">
                <div className="w-10 h-10 rounded-lg bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center">
                  <Database className="h-5 w-5 text-emerald-600 dark:text-emerald-400" />
                </div>
                <div>
                  <div className="text-2xl font-bold">{totalDataPoints}</div>
                  <div className="text-xs text-muted-foreground">Data Points</div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="card-bg">
              <CardContent className="p-4 flex items-center gap-3">
                <div className="w-10 h-10 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center">
                  <Bell className="h-5 w-5 text-amber-600 dark:text-amber-400" />
                </div>
                <div>
                  <div className="text-2xl font-bold">{activeTriggerCount}</div>
                  <div className="text-xs text-muted-foreground">Active Triggers</div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="card-bg">
              <CardContent className="p-4 flex items-center gap-3">
                <div className="w-10 h-10 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                  <Globe className="h-5 w-5 text-purple-600 dark:text-purple-400" />
                </div>
                <div>
                  <div className="text-2xl font-bold">{externalCount}</div>
                  <div className="text-xs text-muted-foreground">External</div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="card-bg">
              <CardContent className="p-4 flex items-center gap-3">
                <div className="w-10 h-10 rounded-lg bg-slate-100 dark:bg-slate-800 flex items-center justify-center">
                  <Target className="h-5 w-5 text-slate-600 dark:text-slate-400" />
                </div>
                <div>
                  <div className="text-2xl font-bold">{internalCount}</div>
                  <div className="text-xs text-muted-foreground">Internal</div>
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Main Tabs */}
          <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as any)}>
            <TabsList>
              <TabsTrigger value="brief" data-testid="tab-executive-brief">
                <BarChart3 className="h-4 w-4 mr-2" />
                Executive Brief
              </TabsTrigger>
              <TabsTrigger value="signals" data-testid="tab-signals">
                <Radio className="h-4 w-4 mr-2" />
                Signal Catalog
              </TabsTrigger>
              <TabsTrigger value="triggers" data-testid="tab-my-triggers">
                <Bell className="h-4 w-4 mr-2" />
                My Triggers ({activeTriggerCount})
              </TabsTrigger>
              <TabsTrigger value="templates" data-testid="tab-templates">
                <Sparkles className="h-4 w-4 mr-2" />
                Templates
              </TabsTrigger>
            </TabsList>

            {/* Executive Brief Tab */}
            <TabsContent value="brief" className="mt-6">
              <div className="space-y-6">
                {/* Live Status Cards */}
                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                  <Card className={`card-bg border-l-4 ${safeTriggers.filter((t: any) => t.currentStatus === 'red').length > 0 ? 'border-l-red-500' : 'border-l-emerald-500'}`}>
                    <CardContent className="p-4">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-sm text-muted-foreground">Critical Alerts</p>
                          <p className="text-3xl font-bold">{safeTriggers.filter((t: any) => t.currentStatus === 'red').length}</p>
                        </div>
                        <AlertTriangle className={`h-8 w-8 ${safeTriggers.filter((t: any) => t.currentStatus === 'red').length > 0 ? 'text-red-500' : 'text-emerald-500'}`} />
                      </div>
                    </CardContent>
                  </Card>
                  
                  <Card className="card-bg border-l-4 border-l-amber-500">
                    <CardContent className="p-4">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-sm text-muted-foreground">Warnings</p>
                          <p className="text-3xl font-bold">{safeTriggers.filter((t: any) => t.currentStatus === 'yellow').length}</p>
                        </div>
                        <Eye className="h-8 w-8 text-amber-500" />
                      </div>
                    </CardContent>
                  </Card>
                  
                  <Card className="card-bg border-l-4 border-l-emerald-500">
                    <CardContent className="p-4">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-sm text-muted-foreground">Active Monitors</p>
                          <p className="text-3xl font-bold">{activeTriggerCount}</p>
                        </div>
                        <Activity className="h-8 w-8 text-emerald-500" />
                      </div>
                    </CardContent>
                  </Card>
                  
                  <Card className="card-bg border-l-4 border-l-blue-500">
                    <CardContent className="p-4">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-sm text-muted-foreground">Signal Coverage</p>
                          <p className="text-3xl font-bold">{totalDataPoints}</p>
                        </div>
                        <Radio className="h-8 w-8 text-blue-500" />
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {/* Two Column Layout */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {/* Recent Alerts */}
                  <Card className="card-bg">
                    <CardHeader className="pb-3">
                      <CardTitle className="text-lg flex items-center gap-2">
                        <Bell className="h-5 w-5 text-amber-500" />
                        Recent Trigger Activity
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      {safeTriggers.length === 0 ? (
                        <div className="text-center py-8 text-muted-foreground">
                          <Bell className="h-8 w-8 mx-auto mb-2 opacity-50" />
                          <p>No triggers configured yet</p>
                          <Button 
                            variant="link" 
                            className="mt-2"
                            onClick={() => setActiveTab('signals')}
                          >
                            Browse Signal Catalog to create triggers
                          </Button>
                        </div>
                      ) : (
                        <div className="space-y-3">
                          {safeTriggers.slice(0, 5).map((trigger: any) => {
                            const category = SIGNAL_CATEGORIES.find(c => c.id === trigger.category);
                            return (
                              <div key={trigger.id} className="flex items-center gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50">
                                <div className={`w-2 h-2 rounded-full ${
                                  trigger.currentStatus === 'red' ? 'bg-red-500' :
                                  trigger.currentStatus === 'yellow' ? 'bg-amber-500' : 'bg-emerald-500'
                                }`} />
                                <div className="flex-1 min-w-0">
                                  <p className="font-medium truncate">{trigger.name}</p>
                                  <p className="text-xs text-muted-foreground">{category?.name || 'Unknown'}</p>
                                </div>
                                <Badge variant="outline" className="text-xs">
                                  {trigger.isActive ? 'Active' : 'Paused'}
                                </Badge>
                              </div>
                            );
                          })}
                          {safeTriggers.length > 5 && (
                            <Button 
                              variant="ghost" 
                              className="w-full"
                              onClick={() => setActiveTab('triggers')}
                            >
                              View all {safeTriggers.length} triggers
                            </Button>
                          )}
                        </div>
                      )}
                    </CardContent>
                  </Card>

                  {/* Signal Categories Overview */}
                  <Card className="card-bg">
                    <CardHeader className="pb-3">
                      <CardTitle className="text-lg flex items-center gap-2">
                        <Radio className="h-5 w-5 text-blue-500" />
                        Signal Coverage by Category
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-2">
                        {SIGNAL_CATEGORIES.slice(0, 8).map(category => {
                          const triggerCount = getCategoryTriggerCount(category.id);
                          return (
                            <div 
                              key={category.id} 
                              className="flex items-center gap-3 p-2 rounded hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer"
                              onClick={() => {
                                setSelectedCategory(category);
                                setActiveTab('signals');
                              }}
                            >
                              <div 
                                className="w-8 h-8 rounded flex items-center justify-center"
                                style={{ backgroundColor: `${category.color}20` }}
                              >
                                <CategoryIcon 
                                  iconName={category.icon} 
                                  className="h-4 w-4"
                                  style={{ color: category.color }}
                                />
                              </div>
                              <div className="flex-1">
                                <p className="text-sm font-medium">{category.name}</p>
                              </div>
                              <div className="text-right">
                                <span className="text-xs text-muted-foreground">{category.dataPoints.length} signals</span>
                                {triggerCount > 0 && (
                                  <Badge className="ml-2 text-xs" variant="secondary">{triggerCount} active</Badge>
                                )}
                              </div>
                            </div>
                          );
                        })}
                        {SIGNAL_CATEGORIES.length > 8 && (
                          <Button 
                            variant="ghost" 
                            className="w-full text-sm"
                            onClick={() => setActiveTab('signals')}
                          >
                            View all {SIGNAL_CATEGORIES.length} categories
                          </Button>
                        )}
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {/* Quick Actions */}
                <Card className="card-bg">
                  <CardHeader className="pb-3">
                    <CardTitle className="text-lg">Quick Actions</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                      <Button 
                        variant="outline" 
                        className="h-auto py-4 flex flex-col items-center gap-2"
                        onClick={() => setActiveTab('signals')}
                      >
                        <Radio className="h-5 w-5 text-blue-500" />
                        <span className="text-sm">Browse Signals</span>
                      </Button>
                      <Button 
                        variant="outline" 
                        className="h-auto py-4 flex flex-col items-center gap-2"
                        onClick={() => setActiveTab('templates')}
                      >
                        <Sparkles className="h-5 w-5 text-amber-500" />
                        <span className="text-sm">Use Template</span>
                      </Button>
                      <Button 
                        variant="outline" 
                        className="h-auto py-4 flex flex-col items-center gap-2"
                        onClick={() => setCompositeDialogOpen(true)}
                      >
                        <Layers className="h-5 w-5 text-purple-500" />
                        <span className="text-sm">Composite Trigger</span>
                      </Button>
                      <Button 
                        variant="outline" 
                        className="h-auto py-4 flex flex-col items-center gap-2"
                        onClick={() => setActiveTab('triggers')}
                      >
                        <Settings className="h-5 w-5 text-slate-500" />
                        <span className="text-sm">Manage Triggers</span>
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="signals" className="mt-6">
              {!selectedCategory ? (
                <>
                  {/* Filters */}
                  <div className="flex items-center gap-4 mb-6">
                    <div className="relative flex-1 max-w-md">
                      <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                      <Input 
                        placeholder="Search signal categories..."
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        className="pl-9"
                        data-testid="input-search-signals"
                      />
                    </div>
                    
                    <Tabs value={phaseFilter} onValueChange={(v) => setPhaseFilter(v as any)}>
                      <TabsList>
                        <TabsTrigger value="all">All</TabsTrigger>
                        <TabsTrigger value="external">External</TabsTrigger>
                        <TabsTrigger value="internal">Internal</TabsTrigger>
                      </TabsList>
                    </Tabs>
                  </div>

                  {/* Category Grid */}
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    {filteredCategories.map(category => (
                      <SignalCategoryCard
                        key={category.id}
                        category={category}
                        onSelect={() => setSelectedCategory(category)}
                        isActive={false}
                        triggerCount={getCategoryTriggerCount(category.id)}
                      />
                    ))}
                  </div>
                  
                  {filteredCategories.length === 0 && (
                    <div className="text-center py-12 text-muted-foreground">
                      <Search className="h-12 w-12 mx-auto mb-4 opacity-50" />
                      <p>No signal categories match your search</p>
                    </div>
                  )}
                </>
              ) : (
                /* Category Detail View */
                <Card className="card-bg">
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div 
                          className="w-12 h-12 rounded-lg flex items-center justify-center"
                          style={{ backgroundColor: `${selectedCategory.color}20` }}
                        >
                          <CategoryIcon 
                            iconName={selectedCategory.icon} 
                            className="h-6 w-6"
                            style={{ color: selectedCategory.color }}
                          />
                        </div>
                        <div>
                          <CardTitle>{selectedCategory.name}</CardTitle>
                          <CardDescription>{selectedCategory.description}</CardDescription>
                        </div>
                      </div>
                      <div className="flex items-center gap-2">
                        <Badge variant="outline">
                          <Clock className="h-3 w-3 mr-1" />
                          Refreshes every {selectedCategory.refreshInterval >= 86400 
                            ? `${selectedCategory.refreshInterval / 86400}d`
                            : selectedCategory.refreshInterval >= 3600
                            ? `${selectedCategory.refreshInterval / 3600}h`
                            : `${selectedCategory.refreshInterval / 60}m`
                          }
                        </Badge>
                        <Badge style={{ backgroundColor: selectedCategory.color, color: 'white' }}>
                          {selectedCategory.dataPoints.length} Data Points
                        </Badge>
                      </div>
                    </div>
                  </CardHeader>
                  
                  <CardContent>
                    <div className="space-y-2">
                      <div className="flex items-center justify-between py-2 px-3 bg-slate-100 dark:bg-slate-800 rounded-lg text-xs font-medium text-muted-foreground">
                        <span className="flex items-center gap-2">
                          <span className="w-10">Enable</span>
                          <span>Data Point</span>
                        </span>
                        <span className="flex items-center gap-4">
                          <span>Value</span>
                          <span className="hidden md:inline">Sources</span>
                          <span>Settings</span>
                        </span>
                      </div>
                      
                      <ScrollArea className="h-[500px]">
                        <div className="space-y-1">
                          {selectedCategory.dataPoints.map(dataPoint => {
                            const existingTrigger = safeTriggers.find((t: any) => 
                              t.conditions?.dataPointId === dataPoint.id
                            );
                            return (
                              <DataPointRow
                                key={dataPoint.id}
                                dataPoint={dataPoint}
                                category={selectedCategory}
                                onConfigureTrigger={handleConfigureTrigger}
                                onQuickToggle={handleQuickToggle}
                                existingTrigger={existingTrigger}
                                isToggling={createTriggerMutation.isPending || updateTriggerMutation.isPending}
                              />
                            );
                          })}
                        </div>
                      </ScrollArea>
                    </div>
                    
                    {selectedCategory.recommendedPlaybooks.length > 0 && (
                      <div className="mt-6 pt-6 border-t">
                        <h4 className="font-semibold mb-3">Recommended Playbooks</h4>
                        <div className="flex flex-wrap gap-2">
                          {selectedCategory.recommendedPlaybooks.map((playbook, i) => (
                            <Link key={i} href="/playbook-library">
                              <Badge 
                                className="cursor-pointer hover:opacity-80 transition-opacity"
                                style={{ backgroundColor: `${selectedCategory.color}20`, color: selectedCategory.color, borderColor: selectedCategory.color }}
                              >
                                <Target className="h-3 w-3 mr-1" />
                                {playbook}
                              </Badge>
                            </Link>
                          ))}
                        </div>
                      </div>
                    )}
                  </CardContent>
                </Card>
              )}
            </TabsContent>

            <TabsContent value="triggers" className="mt-6">
              <MyTriggersTab 
                triggers={safeTriggers}
                isLoading={triggersLoading}
                onEdit={handleEditTrigger}
                onToggle={handleToggleTrigger}
                onDelete={handleDeleteTrigger}
              />
            </TabsContent>

            <TabsContent value="templates" className="mt-6">
              <TemplatesTab onUseTemplate={handleUseTemplate} />
            </TabsContent>
          </Tabs>
          
          <TriggerConfigDialog
            open={configDialogOpen}
            onOpenChange={setConfigDialogOpen}
            dataPoint={selectedDataPoint}
            category={selectedCategory}
            existingTrigger={editingTrigger}
            onSave={handleSaveTrigger}
          />
          
          <CompositeBuilderDialog
            open={compositeDialogOpen}
            onOpenChange={setCompositeDialogOpen}
            onSave={handleSaveTrigger}
          />
        </div>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/SimulationStudio.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { 
  Play, 
  Pause,
  RotateCcw,
  Trophy,
  Users,
  Clock,
  Target,
  AlertTriangle,
  CheckCircle2,
  Activity
} from 'lucide-react';
import PageLayout from '@/components/layout/PageLayout';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';

export default function SimulationStudio() {
  const { toast } = useToast();
  const [isCreating, setIsCreating] = useState(false);
  const [simulationName, setSimulationName] = useState('');
  const [selectedScenarioId, setSelectedScenarioId] = useState('');
  const [participants, setParticipants] = useState('');
  const [duration, setDuration] = useState('60');
  const [complications, setComplications] = useState('');

  const { data: organizations = [] } = useQuery<any[]>({ 
    queryKey: ['/api/organizations'] 
  });
  const organizationId = organizations[0]?.id;

  const { data: scenarios = [] } = useQuery<any[]>({
    queryKey: ['/api/strategic-scenarios', organizationId],
    enabled: !!organizationId,
  });

  const { data: simulations = [], isLoading } = useQuery<any[]>({
    queryKey: ['/api/crisis-simulations', organizationId],
    enabled: !!organizationId,
  });

  const createSimulation = useMutation({
    mutationFn: async (data: any) => {
      return apiRequest('POST', '/api/crisis-simulations', data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/crisis-simulations'] });
      toast({
        title: 'Simulation Created',
        description: 'Crisis simulation has been scheduled successfully',
      });
      setIsCreating(false);
      resetForm();
    },
  });

  const startSimulation = useMutation({
    mutationFn: async (simulationId: string) => {
      return apiRequest('PATCH', `/api/crisis-simulations/${simulationId}/status`, { status: 'running' });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/crisis-simulations'] });
      toast({
        title: 'Simulation Started',
        description: 'Crisis simulation is now running',
      });
    },
  });

  const resetForm = () => {
    setSimulationName('');
    setSelectedScenarioId('');
    setParticipants('');
    setDuration('60');
    setComplications('');
  };

  const handleCreateSimulation = () => {
    if (!simulationName || !selectedScenarioId || !organizationId) {
      toast({
        title: 'Missing Information',
        description: 'Please fill in all required fields',
        variant: 'destructive',
      });
      return;
    }

    createSimulation.mutate({
      organizationId,
      scenarioId: selectedScenarioId,
      simulationName,
      facilitator: 'System',
      participants: participants.split(',').map(p => p.trim()).filter(Boolean),
      duration: parseInt(duration),
      complications: complications ? complications.split('\n').filter(Boolean) : [],
      status: 'scheduled',
    });
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'running': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
      case 'completed': return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';
      case 'cancelled': return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
      default: return 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200';
    }
  };

  return (
    <PageLayout>
      <div className="p-6 space-y-6" data-testid="simulation-studio-page">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold mb-2" data-testid="page-title">Simulation Studio</h1>
            <p className="text-muted-foreground">
              War-game your crisis playbooks to turn abstract preparedness into measurable performance
            </p>
          </div>
          <Dialog open={isCreating} onOpenChange={setIsCreating}>
            <DialogTrigger asChild>
              <Button size="lg" data-testid="button-create-simulation">
                <Play className="mr-2 h-5 w-5" />
                New Simulation
              </Button>
            </DialogTrigger>
            <DialogContent className="max-w-2xl">
              <DialogHeader>
                <DialogTitle>Create Crisis Simulation</DialogTitle>
                <DialogDescription>
                  Set up a war-gaming exercise to practice your crisis response
                </DialogDescription>
              </DialogHeader>
              
              <div className="space-y-4 py-4">
                <div>
                  <Label htmlFor="sim-name">Simulation Name</Label>
                  <Input
                    id="sim-name"
                    placeholder="Q4 2025 Crisis Drill"
                    value={simulationName}
                    onChange={(e) => setSimulationName(e.target.value)}
                    data-testid="input-simulation-name"
                  />
                </div>

                <div>
                  <Label htmlFor="scenario">Scenario to Simulate</Label>
                  <Select value={selectedScenarioId} onValueChange={setSelectedScenarioId}>
                    <SelectTrigger id="scenario" data-testid="select-scenario">
                      <SelectValue placeholder="Select a crisis scenario" />
                    </SelectTrigger>
                    <SelectContent>
                      {scenarios.map((scenario) => (
                        <SelectItem key={scenario.id} value={scenario.id}>
                          {scenario.title || scenario.name}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>

                <div>
                  <Label htmlFor="participants">Participants (comma-separated emails)</Label>
                  <Input
                    id="participants"
                    placeholder="ceo@company.com, cfo@company.com, cto@company.com"
                    value={participants}
                    onChange={(e) => setParticipants(e.target.value)}
                    data-testid="input-participants"
                  />
                </div>

                <div>
                  <Label htmlFor="duration">Duration (minutes)</Label>
                  <Input
                    id="duration"
                    type="number"
                    placeholder="60"
                    value={duration}
                    onChange={(e) => setDuration(e.target.value)}
                    data-testid="input-duration"
                  />
                </div>

                <div>
                  <Label htmlFor="complications">AI-Injected Complications (one per line, optional)</Label>
                  <Textarea
                    id="complications"
                    placeholder="CFO is on a flight and unreachable&#10;Main PR firm's system is down&#10;Social media amplifies the story faster than expected"
                    value={complications}
                    onChange={(e) => setComplications(e.target.value)}
                    rows={4}
                    data-testid="textarea-complications"
                  />
                  <p className="text-xs text-muted-foreground mt-1">
                    Add realistic complications to test your team's adaptability
                  </p>
                </div>
              </div>

              <DialogFooter>
                <Button variant="outline" onClick={() => setIsCreating(false)} data-testid="button-cancel">
                  Cancel
                </Button>
                <Button onClick={handleCreateSimulation} data-testid="button-create-confirm">
                  Create Simulation
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>
        </div>

        {/* Value Proposition */}
        <Card className="bg-gradient-to-r .section-background dark:from-blue-950/30 dark:to-purple-950/30 border-blue-200 dark:border-blue-800">
          <CardHeader>
            <CardTitle className="text-blue-900 dark:text-blue-100">Why Simulations Matter</CardTitle>
          </CardHeader>
          <CardContent className="text-sm text-blue-900 dark:text-blue-100 space-y-2">
            <div className="flex items-start gap-2">
              <CheckCircle2 className="h-5 w-5 flex-shrink-0 mt-0.5 text-green-600" />
              <p><strong>Find Bottlenecks:</strong> Discover that your Legal counsel takes 22 minutes to respond, not the planned 2 minutes</p>
            </div>
            <div className="flex items-start gap-2">
              <CheckCircle2 className="h-5 w-5 flex-shrink-0 mt-0.5 text-green-600" />
              <p><strong>Build Muscle Memory:</strong> Turn a 72-hour chaos into 20 minutes, then 15, then the target 12 minutes</p>
            </div>
            <div className="flex items-start gap-2">
              <CheckCircle2 className="h-5 w-5 flex-shrink-0 mt-0.5 text-green-600" />
              <p><strong>Prove ROI:</strong> Demonstrate to the board that your crisis preparedness is real, not theoretical</p>
            </div>
          </CardContent>
        </Card>

        {/* Simulations List */}
        <Card>
          <CardHeader>
            <CardTitle>Scheduled & Past Simulations</CardTitle>
            <CardDescription>Track your war-gaming exercises and performance improvements</CardDescription>
          </CardHeader>
          <CardContent>
            {isLoading ? (
              <div className="text-center py-8 text-muted-foreground">Loading simulations...</div>
            ) : simulations.length === 0 ? (
              <div className="text-center py-12 space-y-3">
                <Activity className="h-12 w-12 mx-auto text-muted-foreground" />
                <p className="text-muted-foreground">No simulations scheduled yet</p>
                <Button onClick={() => setIsCreating(true)} data-testid="button-create-first">
                  Create Your First Simulation
                </Button>
              </div>
            ) : (
              <div className="space-y-3">
                {simulations.map((sim) => (
                  <div
                    key={sim.id}
                    className="border rounded-lg p-4 space-y-3"
                    data-testid={`card-simulation-${sim.id}`}
                  >
                    <div className="flex items-center justify-between">
                      <div className="flex-1 page-background">
                        <h3 className="font-semibold text-lg">{sim.simulationName}</h3>
                        <p className="text-sm text-muted-foreground">
                          Scenario: {scenarios.find(s => s.id === sim.scenarioId)?.title || 'Unknown'}
                        </p>
                      </div>
                      <Badge className={getStatusColor(sim.status)} data-testid={`badge-status-${sim.id}`}>
                        {sim.status}
                      </Badge>
                    </div>

                    <div className="grid grid-cols-3 gap-4 text-sm">
                      <div className="flex items-center gap-2">
                        <Users className="h-4 w-4 text-muted-foreground" />
                        <span>{sim.participants?.length || 0} participants</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <Clock className="h-4 w-4 text-muted-foreground" />
                        <span>{sim.duration} minutes</span>
                      </div>
                      {sim.results && (
                        <div className="flex items-center gap-2">
                          <Trophy className="h-4 w-4 text-yellow-500" />
                          <span>Results available</span>
                        </div>
                      )}
                    </div>

                    {sim.status === 'scheduled' && (
                      <div className="flex gap-2">
                        <Button
                          size="sm"
                          onClick={() => startSimulation.mutate(sim.id)}
                          data-testid={`button-start-${sim.id}`}
                        >
                          <Play className="h-4 w-4 mr-2" />
                          Start Simulation
                        </Button>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/Sitemap.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { useLocation } from "wouter";

export default function Sitemap() {
  const [, setLocation] = useLocation();

  const sections = [
    {
      title: "Core Pages",
      pages: [
        { name: "Home", path: "/" },
        { name: "Demo Selector", path: "/demo-selector" },
        { name: "Playbook Library", path: "/playbook-library" },
        { name: "Dashboard", path: "/dashboard" },
        { name: "Executive Suite", path: "/executive-suite" },
        { name: "ROI Calculator", path: "/calculator" },
      ]
    },
    {
      title: "Live Interactive Demos",
      pages: [
        { name: "4-Phase System Demo", path: "/four-phase-demo" },
        { name: "Ransomware Response", path: "/demo/ransomware" },
        { name: "M&A Integration", path: "/demo/ma-integration" },
        { name: "Product Launch", path: "/demo/product-launch" },
        { name: "Supplier Crisis", path: "/demo/supplier-crisis" },
        { name: "Competitive Response", path: "/demo/competitive-response" },
        { name: "Regulatory Crisis", path: "/demo/regulatory-crisis" },
        { name: "Customer Crisis", path: "/demo/customer-crisis" },
      ]
    },
    {
      title: "Industry Crisis Demos",
      pages: [
        { name: "Industry Demos Hub", path: "/industry-demos" },
        { name: "Luxury Crisis Demo", path: "/luxury-crisis-demo" },
        { name: "Financial Ransomware Demo", path: "/financial-demo" },
        { name: "Pharmaceutical Recall Demo", path: "/pharma-demo" },
        { name: "Manufacturing Supplier Demo", path: "/manufacturing-demo" },
        { name: "Retail Food Safety Demo", path: "/retail-demo" },
        { name: "Energy Grid Failure Demo", path: "/energy-demo" },
      ]
    },
    {
      title: "Strategic Opportunity Demos",
      pages: [
        { name: "LVMH Market Entry", path: "/lvmh-demo" },
        { name: "SHEIN Trend Response", path: "/shein-demo" },
        { name: "SpaceX Launch Coordination", path: "/spacex-demo" },
      ]
    },
    {
      title: "Strategic Operations",
      pages: [
        { name: "Strategic Monitoring", path: "/strategic-monitoring" },
        { name: "Command Center", path: "/command-center" },
        { name: "Collaboration", path: "/collaboration" },
        { name: "Decision Velocity", path: "/decision-velocity" },
        { name: "What-If Analyzer", path: "/what-if-analyzer" },
      ]
    },
    {
      title: "AI Intelligence",
      pages: [
        { name: "AI Intelligence Hub", path: "/ai" },
        { name: "AI Radar Dashboard", path: "/ai-radar" },
        { name: "Pulse Intelligence", path: "/pulse" },
        { name: "Flux Adaptations", path: "/flux" },
        { name: "Prism Insights", path: "/prism" },
        { name: "Echo Cultural Analytics", path: "/echo" },
        { name: "Nova Innovations", path: "/nova" },
      ]
    },
    {
      title: "Planning & Preparedness",
      pages: [
        { name: "Strategic Planning Hub", path: "/strategic" },
        { name: "Triggers Management", path: "/triggers-management" },
        { name: "Preparedness Report", path: "/preparedness-report" },
        { name: "Practice Drills", path: "/practice-drills" },
        { name: "Drill Tracking", path: "/drill-tracking" },
        { name: "Crisis Exposure Matrix", path: "/crisis-exposure-matrix" },
        { name: "Simulation Studio", path: "/simulation-studio" },
        { name: "NFL Learning Dashboard", path: "/nfl-learning" },
      ]
    },
    {
      title: "Analytics & Reporting",
      pages: [
        { name: "Advanced Analytics", path: "/analytics" },
        { name: "Executive Analytics", path: "/executive-analytics-dashboard" },
        { name: "Audit Logging Center", path: "/audit-logging-center" },
        { name: "Business Intelligence", path: "/business-intelligence" },
        { name: "Operating Model Alignment", path: "/operating-model" },
        { name: "Operating Model Health", path: "/operating-model-health" },
        { name: "ROI Breakdown", path: "/roi-breakdown" },
      ]
    },
    {
      title: "Enterprise Features",
      pages: [
        { name: "Integration Hub", path: "/integration-hub" },
        { name: "Integrations", path: "/integrations" },
        { name: "Institutional Memory", path: "/institutional-memory" },
        { name: "Board Briefings", path: "/board-briefings" },
        { name: "Platform", path: "/platform" },
      ]
    },
    {
      title: "Demo Experiences",
      pages: [
        { name: "How It Works", path: "/how-it-works" },
        { name: "Watch Demo", path: "/watch-demo" },
        { name: "Trade Show Demo", path: "/trade-show-demo" },
        { name: "Executive Demo", path: "/executive-demo" },
        { name: "Hybrid Demo", path: "/hybrid-demo" },
        { name: "Executive Walkthrough", path: "/executive-demo-walkthrough" },
      ]
    },
    {
      title: "Company & Resources",
      pages: [
        { name: "Our Story", path: "/our-story" },
        { name: "Pricing", path: "/pricing" },
        { name: "Contact", path: "/contact" },
        { name: "Early Access", path: "/early-access" },
        { name: "Settings", path: "/settings" },
      ]
    }
  ];

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white p-8 pt-24">
      <div className="max-w-7xl mx-auto">
        <div className="mb-12">
          <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
            M Sitemap
          </h1>
          <p className="text-xl text-slate-400">
            Complete directory of all pages and features available in M
          </p>
        </div>

        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {sections.map((section) => (
            <Card key={section.title} className="bg-slate-800/50 border-slate-700">
              <CardHeader>
                <CardTitle className="text-xl text-blue-400">{section.title}</CardTitle>
              </CardHeader>
              <CardContent>
                <ul className="space-y-2">
                  {section.pages.map((page) => (
                    <li key={page.path}>
                      <button
                        onClick={() => setLocation(page.path)}
                        className="text-slate-300 hover:text-white hover:underline text-left w-full"
                      >
                        {page.name}
                      </button>
                    </li>
                  ))}
                </ul>
              </CardContent>
            </Card>
          ))}
        </div>

        <Card className="mt-8 bg-slate-800/50 border-slate-700">
          <CardContent className="p-8">
            <h2 className="text-2xl font-bold mb-4">Quick Stats</h2>
            <div className="grid md:grid-cols-4 gap-6 text-center">
              <div>
                <div className="text-4xl font-bold text-blue-400 mb-2">7</div>
                <div className="text-slate-400">Live Interactive Demos</div>
              </div>
              <div>
                <div className="text-4xl font-bold text-green-400 mb-2">10</div>
                <div className="text-slate-400">Industry Demos</div>
              </div>
              <div>
                <div className="text-4xl font-bold text-purple-400 mb-2">166</div>
                <div className="text-slate-400">Strategic Playbooks</div>
              </div>
              <div>
                <div className="text-4xl font-bold text-orange-400 mb-2">70+</div>
                <div className="text-slate-400">Total Pages</div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/SpaceXLaunchDemo.tsx
========================================
import StandardNav from '@/components/layout/StandardNav';
import { useState } from "react";
import { Link } from "wouter";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Rocket, Target, Zap, Satellite, CheckCircle, Users, DollarSign, ArrowLeft, Play } from "lucide-react";
import AIRadarSimulation from "@/components/demo/AIRadarSimulation";
import TwelveMinuteTimer from "@/components/demo/TwelveMinuteTimer";
import ROIComparison from "@/components/demo/ROIComparison";
import DemoNavHeader from "@/components/demo/DemoNavHeader";
import { spacexLaunchDemoData } from "@shared/spacex-launch-data";

type DemoAct = "intro" | "detection" | "coordination" | "outcome";

export default function SpaceXLaunchDemo() {
  const [currentAct, setCurrentAct] = useState<DemoAct>("intro");
  const [coordinationComplete, setCoordinationComplete] = useState(false);

  const goToAct = (act: DemoAct) => {
    setCurrentAct(act);
    if (act === "intro") {
      setCoordinationComplete(false);
    }
  };

  const resetDemo = () => {
    setCurrentAct("intro");
    setCoordinationComplete(false);
  };

  return (
    <div className="page-background min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900">
      <DemoNavHeader title="SpaceX Launch Demo" showBackButton={true} />

      {/* Act Navigation */}
      <div className="border-b border-blue-800/20 bg-slate-950/30 pt-20">
        <div className="container mx-auto px-6 py-3">
          <div className="flex justify-between items-center">
            {[
              { id: "intro", label: "1. Introduction", icon: Play },
              { id: "detection", label: "2. AI Detection @ 94%", icon: Target },
              { id: "coordination", label: "3. 12-Minute Response", icon: Zap },
              { id: "outcome", label: "4. Window Captured", icon: Rocket }
            ].map((act) => (
              <button
                key={act.id}
                onClick={() => goToAct(act.id as DemoAct)}
                className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${
                  currentAct === act.id
                    ? "bg-blue-600 text-white"
                    : "text-blue-300 hover:bg-blue-950/50"
                }`}
                data-testid={`button-act-${act.id}`}
              >
                <act.icon className="w-4 h-4" />
                <span className="text-sm font-medium">{act.label}</span>
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="container mx-auto px-6 py-12">
        {/* ACT 1: INTRODUCTION */}
        {currentAct === "intro" && (
          <div className="max-w-5xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-blue-800/30">
              <div className="text-center mb-8">
                <Satellite className="w-16 h-16 text-blue-400 mx-auto mb-4" />
                <h2 className="text-3xl font-bold text-white mb-3">{spacexLaunchDemoData.crisis.title}</h2>
                <p className="text-xl text-blue-200">{spacexLaunchDemoData.crisis.subtitle}</p>
              </div>

              <div className="grid md:grid-cols-2 gap-6 mb-8">
                <div className="p-6 bg-blue-950/30 rounded-lg border border-blue-800/30">
                  <h3 className="font-bold text-white mb-4 flex items-center gap-2">
                    <Target className="w-5 h-5 text-blue-400" />
                    The Opportunity
                  </h3>
                  <div className="space-y-3 text-sm">
                    <div>
                      <div className="text-blue-300 mb-1">Mission</div>
                      <div className="text-white font-semibold">Starlink Group 7-8  23 satellites  Falcon 9 Block 5</div>
                    </div>
                    <div>
                      <div className="text-blue-300 mb-1">Orbital Window</div>
                      <div className="text-white">Opens 3 days early (April 15 vs April 18)</div>
                    </div>
                    <div>
                      <div className="text-blue-300 mb-1">Strategic Value</div>
                      <div className="text-white">Optimal geometry + vacant slot from ULA delay</div>
                    </div>
                    <div>
                      <div className="text-blue-300 mb-1">Revenue Impact</div>
                      <div className="text-white font-bold">$47M acceleration + 2-week service expansion</div>
                    </div>
                  </div>
                </div>

                <div className="p-6 bg-slate-900/50 rounded-lg border border-blue-800/30">
                  <h3 className="font-bold text-white mb-4">Traditional Aerospace Coordination</h3>
                  <ul className="space-y-2 text-sm text-blue-200">
                    <li> Day 1-2: Engineering reviews sequential approvals</li>
                    <li> Day 3-4: FAA license modification (standard 7-10 days)</li>
                    <li className="text-amber-400 font-semibold"> During gap: Favorable window closes</li>
                    <li className="text-red-400 font-bold"> During gap: ULA reschedules, reclaims slot</li>
                    <li> Day 5-7: Coordination finally completetoo late</li>
                    <li className="text-blue-300"> Result: Launch April 18 on original date (opportunity missed)</li>
                  </ul>
                </div>
              </div>

              <div className="bg-gradient-to-r from-blue-950/50 to-indigo-950/50 border border-blue-700 rounded-lg p-6 mb-8">
                <div className="flex items-start gap-4">
                  <Zap className="w-8 h-8 text-blue-400 flex-shrink-0 mt-1" />
                  <div>
                    <h3 className="font-bold text-white mb-2">When Elon Calls the Play, Everyone Executes</h3>
                    <p className="text-blue-100 leading-relaxed">
                      SpaceX already moves faster than traditional aerospacebut even SpaceX faces coordination bottlenecks. 
                      When a favorable orbital window opens, coordinating 1,847 stakeholders (ground crews, FAA, Space Force, 
                      payload teams, weather, range safety) traditionally takes <strong>5-7 days</strong>. M compresses 
                      it to <strong>12 minutes</strong>enabling SpaceX to capture time-sensitive launch opportunities competitors cannot match.
                    </p>
                  </div>
                </div>
              </div>

              <div className="grid md:grid-cols-3 gap-4 mb-8">
                <div className="p-4 bg-blue-950/30 rounded-lg border border-blue-800/30 text-center">
                  <Users className="w-8 h-8 text-blue-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">1,847</div>
                  <div className="text-sm text-blue-300">Stakeholders Coordinated</div>
                </div>
                <div className="p-4 bg-blue-950/30 rounded-lg border border-blue-800/30 text-center">
                  <Zap className="w-8 h-8 text-blue-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">12 Minutes</div>
                  <div className="text-sm text-blue-300">Full Coordination</div>
                </div>
                <div className="p-4 bg-blue-950/30 rounded-lg border border-blue-800/30 text-center">
                  <DollarSign className="w-8 h-8 text-blue-400 mx-auto mb-2" />
                  <div className="text-2xl font-bold text-white">$47M</div>
                  <div className="text-sm text-blue-300">Revenue Accelerated</div>
                </div>
              </div>

              <div className="text-center">
                <Button
                  size="lg"
                  onClick={() => goToAct("detection")}
                  className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-6 text-lg"
                  data-testid="button-begin-simulation"
                >
                  <Play className="w-5 h-5 mr-2" />
                  Begin Launch Simulation
                </Button>
                <p className="text-sm text-blue-400 mt-3">Experience aerospace coordination velocity</p>
              </div>
            </Card>
          </div>
        )}

        {/* ACT 2: AI DETECTION */}
        {currentAct === "detection" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-blue-800/30">
              <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                <Target className="w-8 h-8 text-blue-400" />
                Act 2: Orbital Dynamics Detection
              </h2>
              <p className="text-lg text-blue-200 mb-4">
                9:00 AM PT - SpaceX trajectory analysis identifies rare orbital window opening 3 days early. Favorable 
                atmospheric conditions + ULA delay = vacant April 15 slot. Moving launch forward unlocks $47M revenue + optimal constellation geometry.
              </p>
              <div className="mt-6 p-4 bg-blue-900/50 border border-blue-500 rounded">
                <div className="flex items-center gap-3">
                  <CheckCircle className="h-6 w-6 text-blue-400 animate-pulse" />
                  <div>
                    <p className="font-bold text-white">Orbital Window Criteria Met</p>
                    <p className="text-sm text-blue-200">
                      Favorable conditions confirmed - Playbook #155 (Launch Acceleration) recommended
                    </p>
                  </div>
                </div>
              </div>
            </Card>

            <AIRadarSimulation
              dataStreams={spacexLaunchDemoData.aiDataStreams}
              title="Launch Intelligence Signals"
              playbookId="#155"
              playbookName="Launch Schedule Acceleration"
              autoStart={true}
            />

            <div className="text-center mt-8">
              <Button
                size="lg"
                onClick={() => goToAct("coordination")}
                className="gap-2 bg-blue-600 hover:bg-blue-700 text-white"
                data-testid="button-activate-playbook"
              >
                <Rocket className="h-5 w-5" />
                Activate Playbook #155 - Launch Acceleration
              </Button>
              <p className="text-sm text-blue-300 mt-2">
                Elon approves - Move launch to April 15
              </p>
            </div>
          </div>
        )}

        {/* ACT 3: COORDINATED RESPONSE */}
        {currentAct === "coordination" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-blue-800/30">
              <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                <Zap className="w-8 h-8 text-blue-400" />
                Act 3: 12-Minute Coordinated Execution
              </h2>
              <p className="text-lg text-blue-200 mb-6">
                M coordinates all 1,847 stakeholders in 12 minutes. Elon's decision triggers instant alignment across 
                34 executives, 813 operations teams, and 1,000 external partners (FAA, Space Force, Range Control).
              </p>

              <div className="grid md:grid-cols-3 gap-6 mb-8">
                <div className="p-6 bg-blue-950/30 rounded-lg border border-blue-800/30">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold">1</div>
                    <h3 className="font-bold text-white">Mission Leadership</h3>
                  </div>
                  <p className="text-sm text-blue-200 mb-2">34 executives approve 3-day acceleration, initiate FAA expedited review</p>
                  <div className="text-2xl font-bold text-blue-400">34 Leaders</div>
                </div>
                <div className="p-6 bg-blue-950/30 rounded-lg border border-blue-800/30">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold">2</div>
                    <h3 className="font-bold text-white">Operations Teams</h3>
                  </div>
                  <p className="text-sm text-blue-200 mb-2">Ground crews, vehicle processing, payload, fuelingall accelerated by 72 hours</p>
                  <div className="text-2xl font-bold text-blue-400">813 Specialists</div>
                </div>
                <div className="p-6 bg-blue-950/30 rounded-lg border border-blue-800/30">
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold">3</div>
                    <h3 className="font-bold text-white">External Partners</h3>
                  </div>
                  <p className="text-sm text-blue-200 mb-2">FAA, Space Force, Range Control, airspaceall coordinated</p>
                  <div className="text-2xl font-bold text-blue-400">1,000 Partners</div>
                </div>
              </div>
            </Card>

            <TwelveMinuteTimer
              timelineEvents={spacexLaunchDemoData.timelineEvents}
              onComplete={() => setCoordinationComplete(true)}
              autoStart={true}
            />

            {coordinationComplete && (
              <div className="text-center animate-in fade-in duration-500">
                <Button
                  size="lg"
                  onClick={() => goToAct("outcome")}
                  className="gap-2 bg-blue-600 hover:bg-blue-700 text-white"
                  data-testid="button-view-outcome"
                >
                  <Rocket className="h-5 w-5" />
                  View Launch Outcome
                </Button>
              </div>
            )}
          </div>
        )}

        {/* ACT 4: ROI OUTCOME */}
        {currentAct === "outcome" && (
          <div className="max-w-6xl mx-auto space-y-8">
            <Card className="p-8 bg-slate-900/50 border-blue-800/30 text-center">
              <Rocket className="w-16 h-16 text-blue-400 mx-auto mb-4" />
              <h2 className="text-3xl font-bold text-white mb-3">
                $47M Revenue + Strategic Orbital Position Through Coordination Velocity
              </h2>
              <p className="text-xl text-blue-200 mb-6">
                SpaceX coordinates 1,847 stakeholders in 12 minutes, moves launch forward 3 days, captures April 15 
                optimal windowaccelerating Starlink expansion and demonstrating coordination velocity traditional aerospace cannot match.
              </p>

              <div className="grid md:grid-cols-3 gap-6 mb-8">
                <div className="p-4 bg-blue-950/30 rounded-lg">
                  <div className="text-3xl font-bold text-blue-400 mb-2">$47M</div>
                  <div className="text-sm text-blue-300">Revenue Accelerated</div>
                </div>
                <div className="p-4 bg-blue-950/30 rounded-lg">
                  <div className="text-3xl font-bold text-blue-400 mb-2">12 Min</div>
                  <div className="text-sm text-blue-300">vs 5-7 Days Traditional</div>
                </div>
                <div className="p-4 bg-blue-950/30 rounded-lg">
                  <div className="text-3xl font-bold text-blue-400 mb-2">72 Hrs</div>
                  <div className="text-sm text-blue-300">Vehicle Turnaround Achieved</div>
                </div>
              </div>
            </Card>

            <ROIComparison
              traditional={spacexLaunchDemoData.roiComparisonData.traditional}
              vexor={spacexLaunchDemoData.roiComparisonData.vexor}
              bottomLine={spacexLaunchDemoData.roiComparisonData.bottomLine}
            />

            <div className="flex justify-center gap-4">
              <Button onClick={resetDemo} variant="outline" className="border-blue-500 text-blue-300 hover:bg-blue-950" data-testid="button-replay">
                Replay Demo
              </Button>
              <Link href="/industry-demos">
                <Button className="bg-blue-600 hover:bg-blue-700 text-white" data-testid="button-all-demos">
                  View All Industry Demos
                </Button>
              </Link>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}


========================================
FILE: client/src/pages/StakeholderManagement.tsx
========================================
import { useState } from "react";
import { useQuery, useMutation } from "@tanstack/react-query";
import { useLocation } from "wouter";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { useCustomer } from "@/contexts/CustomerContext";
import { queryClient, apiRequest } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";

import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Switch } from "@/components/ui/switch";
import { Avatar, AvatarFallback } from "@/components/ui/avatar";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";

import {
  Plus,
  Search,
  Users,
  Mail,
  Phone,
  Building2,
  Shield,
  Edit,
  Trash2,
  UserCircle,
  Bell,
  MessageSquare,
  Smartphone,
} from "lucide-react";

interface Stakeholder {
  id: string;
  name: string;
  email: string;
  phone: string;
  role: string;
  department: string;
  level: number;
  responsibility: string;
  notificationChannels: string[];
  isBackup: boolean;
  backupFor?: string;
  isActive: boolean;
}

const STAKEHOLDER_ROLES = [
  { value: "CEO", label: "Chief Executive Officer", level: 1 },
  { value: "COO", label: "Chief Operating Officer", level: 1 },
  { value: "CFO", label: "Chief Financial Officer", level: 1 },
  { value: "CLO", label: "Chief Legal Officer", level: 1 },
  { value: "CTO", label: "Chief Technology Officer", level: 1 },
  { value: "CISO", label: "Chief Information Security Officer", level: 2 },
  { value: "CMO", label: "Chief Marketing Officer", level: 2 },
  { value: "CHRO", label: "Chief Human Resources Officer", level: 2 },
  { value: "VP Operations", label: "VP of Operations", level: 3 },
  { value: "VP Strategy", label: "VP of Strategy", level: 3 },
  { value: "VP Communications", label: "VP of Communications", level: 3 },
  { value: "General Counsel", label: "General Counsel", level: 2 },
  { value: "Director of Risk", label: "Director of Risk", level: 4 },
  { value: "Director of Compliance", label: "Director of Compliance", level: 4 },
  { value: "Project Manager", label: "Project Manager", level: 5 },
  { value: "HR Director", label: "HR Director", level: 4 },
  { value: "IT Director", label: "IT Director", level: 4 },
  { value: "Security Lead", label: "Security Lead", level: 5 },
];

const DEPARTMENTS = [
  "Executive", "Legal", "Finance", "Operations", "Technology", 
  "Human Resources", "Marketing", "Communications", "Compliance", "Security"
];

const NOTIFICATION_CHANNELS = [
  { id: "email", label: "Email", icon: Mail },
  { id: "sms", label: "SMS", icon: Smartphone },
  { id: "phone", label: "Phone", icon: Phone },
  { id: "slack", label: "Slack", icon: MessageSquare },
  { id: "in_app", label: "In-App", icon: Bell },
];

const LEVEL_CONFIG: Record<number, { label: string; color: string }> = {
  1: { label: "C-Suite", color: "bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400" },
  2: { label: "Executive", color: "bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400" },
  3: { label: "VP", color: "bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400" },
  4: { label: "Director", color: "bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400" },
  5: { label: "Manager", color: "bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300" },
};

const generateId = () => Math.random().toString(36).substring(2, 11);

const DEFAULT_STAKEHOLDERS: Stakeholder[] = [
  { id: '1', name: 'Sarah Chen', email: 'sarah.chen@company.com', phone: '+1 (555) 100-0001', role: 'CEO', department: 'Executive', level: 1, responsibility: 'Final decision authority, external communications approval', notificationChannels: ['email', 'phone', 'sms'], isBackup: false, isActive: true },
  { id: '2', name: 'Michael Torres', email: 'michael.torres@company.com', phone: '+1 (555) 100-0002', role: 'COO', department: 'Operations', level: 1, responsibility: 'Operations oversight, resource allocation', notificationChannels: ['email', 'slack', 'phone'], isBackup: false, isActive: true },
  { id: '3', name: 'Jennifer Wright', email: 'jennifer.wright@company.com', phone: '+1 (555) 100-0003', role: 'CFO', department: 'Finance', level: 1, responsibility: 'Financial impact assessment, budget approvals', notificationChannels: ['email', 'phone'], isBackup: false, isActive: true },
  { id: '4', name: 'David Park', email: 'david.park@company.com', phone: '+1 (555) 100-0004', role: 'General Counsel', department: 'Legal', level: 2, responsibility: 'Legal review, regulatory compliance', notificationChannels: ['email', 'phone', 'slack'], isBackup: false, isActive: true },
  { id: '5', name: 'Lisa Anderson', email: 'lisa.anderson@company.com', phone: '+1 (555) 100-0005', role: 'VP Communications', department: 'Communications', level: 3, responsibility: 'External messaging, media relations', notificationChannels: ['email', 'sms', 'slack'], isBackup: false, isActive: true },
  { id: '6', name: 'Robert Kim', email: 'robert.kim@company.com', phone: '+1 (555) 100-0006', role: 'CISO', department: 'Security', level: 2, responsibility: 'Security assessment, incident response', notificationChannels: ['email', 'phone', 'sms', 'slack'], isBackup: false, isActive: true },
];

export default function StakeholderManagement() {
  const { organization } = useCustomer();
  const { toast } = useToast();
  const [search, setSearch] = useState("");
  const [stakeholders, setStakeholders] = useState<Stakeholder[]>(DEFAULT_STAKEHOLDERS);
  const [editingStakeholder, setEditingStakeholder] = useState<Stakeholder | null>(null);
  const [deleteId, setDeleteId] = useState<string | null>(null);
  const [isDialogOpen, setIsDialogOpen] = useState(false);
  const [levelFilter, setLevelFilter] = useState<string>("all");
  const [departmentFilter, setDepartmentFilter] = useState<string>("all");

  const [formData, setFormData] = useState<Partial<Stakeholder>>({
    name: '',
    email: '',
    phone: '',
    role: '',
    department: '',
    level: 3,
    responsibility: '',
    notificationChannels: ['email'],
    isBackup: false,
    isActive: true,
  });

  const filteredStakeholders = stakeholders.filter(s => {
    const matchesSearch = !search || 
      s.name.toLowerCase().includes(search.toLowerCase()) ||
      s.role.toLowerCase().includes(search.toLowerCase()) ||
      s.email.toLowerCase().includes(search.toLowerCase());
    const matchesLevel = levelFilter === "all" || s.level.toString() === levelFilter;
    const matchesDept = departmentFilter === "all" || s.department === departmentFilter;
    return matchesSearch && matchesLevel && matchesDept;
  });

  const stats = {
    total: stakeholders.length,
    cSuite: stakeholders.filter(s => s.level === 1).length,
    executives: stakeholders.filter(s => s.level === 2).length,
    active: stakeholders.filter(s => s.isActive).length,
  };

  const handleOpenCreate = () => {
    setFormData({
      name: '',
      email: '',
      phone: '',
      role: '',
      department: '',
      level: 3,
      responsibility: '',
      notificationChannels: ['email'],
      isBackup: false,
      isActive: true,
    });
    setEditingStakeholder(null);
    setIsDialogOpen(true);
  };

  const handleOpenEdit = (stakeholder: Stakeholder) => {
    setFormData({ ...stakeholder });
    setEditingStakeholder(stakeholder);
    setIsDialogOpen(true);
  };

  const handleSave = () => {
    if (!formData.name || !formData.email || !formData.role) {
      toast({
        title: "Missing Fields",
        description: "Please fill in name, email, and role.",
        variant: "destructive",
      });
      return;
    }

    if (editingStakeholder) {
      setStakeholders(stakeholders.map(s => 
        s.id === editingStakeholder.id 
          ? { ...s, ...formData } as Stakeholder
          : s
      ));
      toast({ title: "Stakeholder Updated", description: "The stakeholder has been updated." });
    } else {
      const roleInfo = STAKEHOLDER_ROLES.find(r => r.value === formData.role);
      const newStakeholder: Stakeholder = {
        id: generateId(),
        name: formData.name || '',
        email: formData.email || '',
        phone: formData.phone || '',
        role: formData.role || '',
        department: formData.department || '',
        level: roleInfo?.level || formData.level || 3,
        responsibility: formData.responsibility || '',
        notificationChannels: formData.notificationChannels || ['email'],
        isBackup: formData.isBackup || false,
        isActive: formData.isActive ?? true,
      };
      setStakeholders([...stakeholders, newStakeholder]);
      toast({ title: "Stakeholder Added", description: "New stakeholder has been added to the directory." });
    }
    setIsDialogOpen(false);
  };

  const handleDelete = () => {
    if (deleteId) {
      setStakeholders(stakeholders.filter(s => s.id !== deleteId));
      setDeleteId(null);
      toast({ title: "Stakeholder Removed", description: "The stakeholder has been removed." });
    }
  };

  const handleToggleChannel = (channel: string) => {
    const current = formData.notificationChannels || [];
    if (current.includes(channel)) {
      setFormData({ ...formData, notificationChannels: current.filter(c => c !== channel) });
    } else {
      setFormData({ ...formData, notificationChannels: [...current, channel] });
    }
  };

  const handleRoleChange = (role: string) => {
    const roleInfo = STAKEHOLDER_ROLES.find(r => r.value === role);
    setFormData({ 
      ...formData, 
      role, 
      level: roleInfo?.level || formData.level 
    });
  };

  const getInitials = (name: string) => {
    return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
  };

  return (
    <>
      <StandardNav />
      
      <main className="max-w-7xl mx-auto px-6 py-12">
        <header className="mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <h1 className="text-3xl font-bold text-slate-900 dark:text-white" data-testid="text-page-title">
              Stakeholder Directory
            </h1>
            <p className="text-slate-600 dark:text-slate-400 mt-1">
              Manage your organization's stakeholders, roles, and contact information
            </p>
          </div>
          <Button 
            onClick={handleOpenCreate}
            className="bg-purple-600 hover:bg-purple-700"
            data-testid="button-add-stakeholder"
          >
            <Plus className="h-4 w-4 mr-2" />
            Add Stakeholder
          </Button>
        </header>

        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <Card data-testid="stat-total">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                  <Users className="h-5 w-5 text-slate-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-slate-900 dark:text-white">{stats.total}</p>
                  <p className="text-sm text-slate-500">Total Stakeholders</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-csuite">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                  <Shield className="h-5 w-5 text-purple-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-purple-600">{stats.cSuite}</p>
                  <p className="text-sm text-slate-500">C-Suite</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-executives">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                  <Building2 className="h-5 w-5 text-blue-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-blue-600">{stats.executives}</p>
                  <p className="text-sm text-slate-500">Executives</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-active">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg">
                  <UserCircle className="h-5 w-5 text-green-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-green-600">{stats.active}</p>
                  <p className="text-sm text-slate-500">Active</p>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>

        <Card className="mb-6">
          <CardContent className="p-4">
            <div className="flex flex-col md:flex-row gap-4">
              <div className="relative flex-1">
                <Search className="absolute left-3 top-2.5 h-4 w-4 text-slate-400" />
                <Input
                  placeholder="Search by name, role, or email..."
                  value={search}
                  onChange={(e) => setSearch(e.target.value)}
                  className="pl-10"
                  data-testid="input-search"
                />
              </div>
              <div className="flex gap-2">
                <select
                  value={levelFilter}
                  onChange={(e) => setLevelFilter(e.target.value)}
                  className="px-3 py-2 border rounded-md bg-white dark:bg-slate-900 text-sm"
                  data-testid="select-level-filter"
                >
                  <option value="all">All Levels</option>
                  <option value="1">C-Suite</option>
                  <option value="2">Executive</option>
                  <option value="3">VP</option>
                  <option value="4">Director</option>
                  <option value="5">Manager</option>
                </select>
                <select
                  value={departmentFilter}
                  onChange={(e) => setDepartmentFilter(e.target.value)}
                  className="px-3 py-2 border rounded-md bg-white dark:bg-slate-900 text-sm"
                  data-testid="select-department-filter"
                >
                  <option value="all">All Departments</option>
                  {DEPARTMENTS.map(dept => (
                    <option key={dept} value={dept}>{dept}</option>
                  ))}
                </select>
              </div>
            </div>
          </CardContent>
        </Card>

        {filteredStakeholders.length === 0 ? (
          <Card>
            <CardContent className="py-16 text-center">
              <Users className="h-12 w-12 mx-auto mb-4 text-slate-300" />
              <h3 className="text-lg font-medium text-slate-900 dark:text-white mb-2">No Stakeholders Found</h3>
              <p className="text-slate-500 mb-6">Start by adding stakeholders to your directory.</p>
              <Button onClick={handleOpenCreate} data-testid="button-add-first-stakeholder">
                <Plus className="h-4 w-4 mr-2" />
                Add First Stakeholder
              </Button>
            </CardContent>
          </Card>
        ) : (
          <Card>
            <Table>
              <TableHeader>
                <TableRow>
                  <TableHead>Stakeholder</TableHead>
                  <TableHead>Role</TableHead>
                  <TableHead>Department</TableHead>
                  <TableHead>Level</TableHead>
                  <TableHead>Contact</TableHead>
                  <TableHead>Channels</TableHead>
                  <TableHead className="w-[80px]"></TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {filteredStakeholders.map((stakeholder) => {
                  const levelConfig = LEVEL_CONFIG[stakeholder.level] || LEVEL_CONFIG[5];

                  return (
                    <TableRow key={stakeholder.id} data-testid={`row-stakeholder-${stakeholder.id}`}>
                      <TableCell>
                        <div className="flex items-center gap-3">
                          <Avatar className="h-10 w-10">
                            <AvatarFallback className="bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400">
                              {getInitials(stakeholder.name)}
                            </AvatarFallback>
                          </Avatar>
                          <div>
                            <p className="font-medium text-slate-900 dark:text-white">{stakeholder.name}</p>
                            {stakeholder.isBackup && (
                              <Badge variant="outline" className="text-xs">Backup</Badge>
                            )}
                          </div>
                        </div>
                      </TableCell>
                      <TableCell>
                        <span className="font-medium">{stakeholder.role}</span>
                      </TableCell>
                      <TableCell>
                        <span className="text-slate-600 dark:text-slate-400">{stakeholder.department}</span>
                      </TableCell>
                      <TableCell>
                        <Badge className={levelConfig.color}>
                          {levelConfig.label}
                        </Badge>
                      </TableCell>
                      <TableCell>
                        <div className="space-y-1 text-sm">
                          <div className="flex items-center gap-1 text-slate-600 dark:text-slate-400">
                            <Mail className="h-3 w-3" />
                            <span className="truncate max-w-[150px]" data-testid={`text-email-${stakeholder.id}`}>{stakeholder.email}</span>
                          </div>
                          {stakeholder.phone && (
                            <div className="flex items-center gap-1 text-slate-500">
                              <Phone className="h-3 w-3" />
                              <span data-testid={`text-phone-${stakeholder.id}`}>{stakeholder.phone}</span>
                            </div>
                          )}
                        </div>
                      </TableCell>
                      <TableCell>
                        <div className="flex gap-1">
                          {stakeholder.notificationChannels.map(ch => {
                            const channel = NOTIFICATION_CHANNELS.find(c => c.id === ch);
                            if (!channel) return null;
                            const Icon = channel.icon;
                            return (
                              <div 
                                key={ch} 
                                className="w-6 h-6 rounded bg-slate-100 dark:bg-slate-800 flex items-center justify-center"
                                title={channel.label}
                                data-testid={`badge-channel-${stakeholder.id}-${ch}`}
                              >
                                <Icon className="h-3 w-3 text-slate-600 dark:text-slate-400" />
                              </div>
                            );
                          })}
                        </div>
                      </TableCell>
                      <TableCell>
                        <div className="flex gap-1">
                          <Button 
                            variant="ghost" 
                            size="sm" 
                            onClick={() => handleOpenEdit(stakeholder)}
                            data-testid={`button-edit-${stakeholder.id}`}
                          >
                            <Edit className="h-4 w-4" />
                          </Button>
                          <Button 
                            variant="ghost" 
                            size="sm" 
                            onClick={() => setDeleteId(stakeholder.id)}
                            className="text-red-600 hover:text-red-700"
                            data-testid={`button-delete-${stakeholder.id}`}
                          >
                            <Trash2 className="h-4 w-4" />
                          </Button>
                        </div>
                      </TableCell>
                    </TableRow>
                  );
                })}
              </TableBody>
            </Table>
          </Card>
        )}

        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
          <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
            <DialogHeader>
              <DialogTitle>{editingStakeholder ? 'Edit Stakeholder' : 'Add New Stakeholder'}</DialogTitle>
              <DialogDescription>
                Enter the stakeholder's contact information and notification preferences.
              </DialogDescription>
            </DialogHeader>
            
            <div className="space-y-4 py-4">
              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="name">Full Name *</Label>
                  <Input
                    id="name"
                    value={formData.name || ''}
                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                    placeholder="John Smith"
                    data-testid="input-name"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="email">Email *</Label>
                  <Input
                    id="email"
                    type="email"
                    value={formData.email || ''}
                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                    placeholder="john.smith@company.com"
                    data-testid="input-email"
                  />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="phone">Phone</Label>
                  <Input
                    id="phone"
                    value={formData.phone || ''}
                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                    placeholder="+1 (555) 123-4567"
                    data-testid="input-phone"
                  />
                </div>
                <div className="space-y-2">
                  <Label>Role *</Label>
                  <Select 
                    value={formData.role || ''} 
                    onValueChange={handleRoleChange}
                  >
                    <SelectTrigger data-testid="select-role">
                      <SelectValue placeholder="Select role" />
                    </SelectTrigger>
                    <SelectContent>
                      {STAKEHOLDER_ROLES.map(role => (
                        <SelectItem key={role.value} value={role.value}>
                          {role.value} - {role.label}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label>Department</Label>
                  <Select 
                    value={formData.department || ''} 
                    onValueChange={(v) => setFormData({ ...formData, department: v })}
                  >
                    <SelectTrigger data-testid="select-department">
                      <SelectValue placeholder="Select department" />
                    </SelectTrigger>
                    <SelectContent>
                      {DEPARTMENTS.map(dept => (
                        <SelectItem key={dept} value={dept}>{dept}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label>Level</Label>
                  <Select 
                    value={formData.level?.toString() || '3'} 
                    onValueChange={(v) => setFormData({ ...formData, level: parseInt(v) })}
                  >
                    <SelectTrigger data-testid="select-level">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      {Object.entries(LEVEL_CONFIG).map(([level, config]) => (
                        <SelectItem key={level} value={level}>{config.label}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
              </div>

              <div className="space-y-2">
                <Label htmlFor="responsibility">Responsibility</Label>
                <Textarea
                  id="responsibility"
                  value={formData.responsibility || ''}
                  onChange={(e) => setFormData({ ...formData, responsibility: e.target.value })}
                  placeholder="Describe their role and responsibilities during crisis response"
                  data-testid="input-responsibility"
                />
              </div>

              <div className="space-y-2">
                <Label>Notification Channels</Label>
                <div className="flex flex-wrap gap-2 p-3 border rounded-lg">
                  {NOTIFICATION_CHANNELS.map(channel => {
                    const Icon = channel.icon;
                    const isSelected = formData.notificationChannels?.includes(channel.id);
                    return (
                      <Button
                        key={channel.id}
                        type="button"
                        variant={isSelected ? "default" : "outline"}
                        size="sm"
                        onClick={() => handleToggleChannel(channel.id)}
                        className={isSelected ? "bg-purple-600 hover:bg-purple-700" : ""}
                        data-testid={`button-channel-${channel.id}`}
                      >
                        <Icon className="h-4 w-4 mr-1" />
                        {channel.label}
                      </Button>
                    );
                  })}
                </div>
              </div>

              <div className="flex items-center gap-6">
                <div className="flex items-center gap-2">
                  <Switch
                    checked={formData.isBackup || false}
                    onCheckedChange={(v) => setFormData({ ...formData, isBackup: v })}
                    data-testid="switch-is-backup"
                  />
                  <Label>Is Backup Contact</Label>
                </div>
                <div className="flex items-center gap-2">
                  <Switch
                    checked={formData.isActive ?? true}
                    onCheckedChange={(v) => setFormData({ ...formData, isActive: v })}
                    data-testid="switch-is-active"
                  />
                  <Label>Active</Label>
                </div>
              </div>

              {formData.isBackup && (
                <div className="space-y-2">
                  <Label>Backup For</Label>
                  <Select 
                    value={formData.backupFor || ''} 
                    onValueChange={(v) => setFormData({ ...formData, backupFor: v })}
                  >
                    <SelectTrigger data-testid="select-backup-for">
                      <SelectValue placeholder="Select primary stakeholder" />
                    </SelectTrigger>
                    <SelectContent>
                      {stakeholders.filter(s => s.id !== editingStakeholder?.id && !s.isBackup).map(s => (
                        <SelectItem key={s.id} value={s.id}>{s.name} - {s.role}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
              )}
            </div>

            <DialogFooter>
              <Button variant="outline" onClick={() => setIsDialogOpen(false)} data-testid="button-cancel">
                Cancel
              </Button>
              <Button onClick={handleSave} data-testid="button-save-stakeholder">
                {editingStakeholder ? 'Update Stakeholder' : 'Add Stakeholder'}
              </Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>

        <AlertDialog open={!!deleteId} onOpenChange={() => setDeleteId(null)}>
          <AlertDialogContent>
            <AlertDialogHeader>
              <AlertDialogTitle>Remove Stakeholder</AlertDialogTitle>
              <AlertDialogDescription>
                Are you sure you want to remove this stakeholder from the directory? They will no longer receive notifications.
              </AlertDialogDescription>
            </AlertDialogHeader>
            <AlertDialogFooter>
              <AlertDialogCancel data-testid="button-cancel-delete">Cancel</AlertDialogCancel>
              <AlertDialogAction
                onClick={handleDelete}
                className="bg-red-600 hover:bg-red-700"
                data-testid="button-confirm-delete"
              >
                Remove
              </AlertDialogAction>
            </AlertDialogFooter>
          </AlertDialogContent>
        </AlertDialog>
      </main>

      <Footer />
    </>
  );
}


========================================
FILE: client/src/pages/StrategicPlanningHub.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import PageLayout from '@/components/layout/PageLayout';
import { Link } from 'wouter';
import { 
  Target, 
  BarChart3, 
  TrendingUp, 
  Calendar, 
  Users, 
  DollarSign, 
  FileText, 
  CheckCircle, 
  AlertCircle, 
  Clock, 
  Zap,
  Building2,
  Globe,
  Lightbulb,
  Settings,
  Plus,
  Edit,
  Trash2,
  Filter,
  Search,
  Download,
  Share,
  ArrowLeft,
  Home
} from 'lucide-react';

interface StrategicScenario {
  id: string;
  name: string;
  category: string;
  status: 'planning' | 'active' | 'completed' | 'on-hold';
  priority: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  owner: string;
  startDate: string;
  endDate: string;
  budget: number;
  progress: number;
  kpis: {
    name: string;
    target: string;
    current: string;
    trend: 'up' | 'down' | 'stable';
  }[];
  milestones: {
    name: string;
    date: string;
    status: 'completed' | 'in-progress' | 'pending';
  }[];
  risksOpportunities: {
    type: 'risk' | 'opportunity';
    description: string;
    impact: 'low' | 'medium' | 'high';
    probability: 'low' | 'medium' | 'high';
    mitigation?: string;
  }[];
}

interface PortfolioMetrics {
  totalScenarios: number;
  activeProjects: number;
  completedThisQuarter: number;
  totalBudget: number;
  portfolioHealth: number;
  riskExposure: number;
}

export default function StrategicPlanningHub() {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [scenarios, setScenarios] = useState<StrategicScenario[]>([]);
  const [portfolioMetrics, setPortfolioMetrics] = useState<PortfolioMetrics>({
    totalScenarios: 18,
    activeProjects: 12,
    completedThisQuarter: 6,
    totalBudget: 12500000,
    portfolioHealth: 87,
    riskExposure: 23
  });
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [filterPriority, setFilterPriority] = useState('all');

  useEffect(() => {
    // Load strategic scenarios
    const mockScenarios: StrategicScenario[] = [
      {
        id: 'sc-001',
        name: 'Digital Transformation Initiative',
        category: 'Technology',
        status: 'active',
        priority: 'critical',
        description: 'Comprehensive digital transformation to modernize operations and enhance customer experience',
        owner: 'CTO Office',
        startDate: '2024-01-15',
        endDate: '2024-12-31',
        budget: 2500000,
        progress: 45,
        kpis: [
          { name: 'System Modernization', target: '100%', current: '45%', trend: 'up' },
          { name: 'User Adoption', target: '85%', current: '32%', trend: 'up' },
          { name: 'Cost Savings', target: '$500K', current: '$120K', trend: 'up' }
        ],
        milestones: [
          { name: 'Infrastructure Assessment', date: '2024-02-28', status: 'completed' },
          { name: 'Platform Selection', date: '2024-04-15', status: 'completed' },
          { name: 'Phase 1 Implementation', date: '2024-07-30', status: 'in-progress' },
          { name: 'User Training Program', date: '2024-09-15', status: 'pending' }
        ],
        risksOpportunities: [
          { type: 'risk', description: 'User resistance to new systems', impact: 'medium', probability: 'medium', mitigation: 'Comprehensive training and change management' },
          { type: 'opportunity', description: 'Process automation potential', impact: 'high', probability: 'high' }
        ]
      },
      {
        id: 'sc-002',
        name: 'Market Expansion Strategy',
        category: 'Growth',
        status: 'planning',
        priority: 'high',
        description: 'Strategic expansion into three new geographic markets with localized offerings',
        owner: 'VP Growth',
        startDate: '2024-03-01',
        endDate: '2025-02-28',
        budget: 1800000,
        progress: 15,
        kpis: [
          { name: 'Market Penetration', target: '15%', current: '2%', trend: 'up' },
          { name: 'Revenue Growth', target: '$2.5M', current: '$125K', trend: 'up' },
          { name: 'Customer Acquisition', target: '1000', current: '45', trend: 'up' }
        ],
        milestones: [
          { name: 'Market Research', date: '2024-03-30', status: 'completed' },
          { name: 'Regulatory Approval', date: '2024-05-15', status: 'in-progress' },
          { name: 'Local Partnerships', date: '2024-07-01', status: 'pending' },
          { name: 'Market Launch', date: '2024-09-01', status: 'pending' }
        ],
        risksOpportunities: [
          { type: 'risk', description: 'Regulatory delays', impact: 'high', probability: 'medium', mitigation: 'Early regulatory engagement and compliance planning' },
          { type: 'opportunity', description: 'First-mover advantage', impact: 'high', probability: 'medium' }
        ]
      },
      {
        id: 'sc-003',
        name: 'Sustainability Initiative',
        category: 'ESG',
        status: 'active',
        priority: 'medium',
        description: 'Comprehensive sustainability program to achieve carbon neutrality by 2026',
        owner: 'Chief Sustainability Officer',
        startDate: '2024-01-01',
        endDate: '2026-12-31',
        budget: 3200000,
        progress: 28,
        kpis: [
          { name: 'Carbon Reduction', target: '50%', current: '12%', trend: 'up' },
          { name: 'Renewable Energy', target: '100%', current: '35%', trend: 'up' },
          { name: 'Waste Reduction', target: '75%', current: '23%', trend: 'up' }
        ],
        milestones: [
          { name: 'Baseline Assessment', date: '2024-02-15', status: 'completed' },
          { name: 'Renewable Energy Plan', date: '2024-06-30', status: 'in-progress' },
          { name: 'Waste Reduction Program', date: '2024-09-30', status: 'pending' },
          { name: 'Carbon Offset Strategy', date: '2025-03-31', status: 'pending' }
        ],
        risksOpportunities: [
          { type: 'risk', description: 'Technology readiness', impact: 'medium', probability: 'low' },
          { type: 'opportunity', description: 'Cost savings from efficiency', impact: 'high', probability: 'high' },
          { type: 'opportunity', description: 'Brand differentiation', impact: 'medium', probability: 'high' }
        ]
      }
    ];

    setScenarios(mockScenarios);
  }, []);

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'active': return 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30';
      case 'planning': return 'bg-blue-500/20 text-blue-300 border-blue-500/30';
      case 'completed': return 'bg-green-500/20 text-green-300 border-green-500/30';
      case 'on-hold': return 'bg-amber-500/20 text-amber-300 border-amber-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'critical': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'high': return 'bg-orange-500/20 text-orange-300 border-orange-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30';
      case 'low': return 'bg-green-500/20 text-green-300 border-green-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(amount);
  };

  const filteredScenarios = scenarios.filter((scenario) => {
    const matchesSearch = scenario.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         scenario.description.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesStatus = filterStatus === 'all' || scenario.status === filterStatus;
    const matchesPriority = filterPriority === 'all' || scenario.priority === filterPriority;
    
    return matchesSearch && matchesStatus && matchesPriority;
  });

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-y-auto p-8 space-y-8">
        
        {/* Breadcrumb Navigation */}
        <div className="mb-6">
          <div className="flex items-center gap-2 text-sm text-gray-400">
            <Link to="/">
              <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                <Home className="h-4 w-4" />
              </Button>
            </Link>
            <span>/</span>
            <span>Strategic Operations</span>
            <span>/</span>
            <span className="text-white">Strategic Planning Hub</span>
          </div>
        </div>

        {/* Strategic Planning Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-white mb-2">Strategic Planning Hub</h1>
            <p className="text-slate-300">Comprehensive scenario planning and strategic execution management</p>
          </div>
          <div className="flex items-center gap-4">
            <Link to="/">
              <Button variant="secondary" className="bg-slate-700 hover:bg-slate-600 text-slate-100 border-slate-600">
                <ArrowLeft className="h-4 w-4 mr-2" />
                Dashboard
              </Button>
            </Link>
            <Button className="bg-blue-600 hover:bg-blue-700">
              <Plus className="w-4 h-4 mr-2" />
              New Scenario
            </Button>
            <Button variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
              <Download className="w-4 w-4 mr-2" />
              Export Portfolio
            </Button>
          </div>
        </div>

        {/* Portfolio Metrics */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6">
          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Total Scenarios</h3>
                <Target className="h-5 w-5 text-blue-400" />
              </div>
              <div className="text-2xl font-bold text-white">{portfolioMetrics.totalScenarios}</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Active Projects</h3>
                <CheckCircle className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{portfolioMetrics.activeProjects}</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Completed Q1</h3>
                <TrendingUp className="h-5 w-5 text-green-400" />
              </div>
              <div className="text-2xl font-bold text-white">{portfolioMetrics.completedThisQuarter}</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Total Budget</h3>
                <DollarSign className="h-5 w-5 text-purple-400" />
              </div>
              <div className="text-2xl font-bold text-white">{formatCurrency(portfolioMetrics.totalBudget)}</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Portfolio Health</h3>
                <BarChart3 className="h-5 w-5 text-emerald-400" />
              </div>
              <div className="text-2xl font-bold text-white">{portfolioMetrics.portfolioHealth}%</div>
            </CardContent>
          </Card>

          <Card className="bg-slate-900/50 border-slate-700/50">
            <CardContent className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-white">Risk Exposure</h3>
                <AlertCircle className="h-5 w-5 text-amber-400" />
              </div>
              <div className="text-2xl font-bold text-white">{portfolioMetrics.riskExposure}%</div>
            </CardContent>
          </Card>
        </div>

        {/* Main Content Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="bg-slate-800/50 border border-slate-700/50">
            <TabsTrigger value="dashboard" className="data-[state=active]:bg-slate-700">Portfolio Dashboard</TabsTrigger>
            <TabsTrigger value="scenarios" className="data-[state=active]:bg-slate-700">Strategic Scenarios</TabsTrigger>
            <TabsTrigger value="analytics" className="data-[state=active]:bg-slate-700">Performance Analytics</TabsTrigger>
            <TabsTrigger value="planning" className="data-[state=active]:bg-slate-700">Planning Tools</TabsTrigger>
          </TabsList>

          {/* Portfolio Dashboard */}
          <TabsContent value="dashboard" className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              {/* Active Scenarios Overview */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Target className="h-5 w-5" />
                    Active Scenarios
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  {scenarios.filter(s => s.status === 'active').map((scenario) => (
                    <div key={scenario.id} className="p-4 bg-slate-800/50 rounded-lg border border-slate-600/50">
                      <div className="flex items-center justify-between mb-3">
                        <h4 className="font-semibold text-white">{scenario.name}</h4>
                        <Badge className={getPriorityColor(scenario.priority)}>
                          {scenario.priority.toUpperCase()}
                        </Badge>
                      </div>
                      <div className="space-y-2">
                        <div className="flex justify-between text-sm">
                          <span className="text-slate-400">Progress</span>
                          <span className="text-white">{scenario.progress}%</span>
                        </div>
                        <Progress value={scenario.progress} className="h-2" />
                        <div className="flex justify-between text-xs">
                          <span className="text-slate-500">Owner: {scenario.owner}</span>
                          <span className="text-slate-500">Budget: {formatCurrency(scenario.budget)}</span>
                        </div>
                      </div>
                    </div>
                  ))}
                </CardContent>
              </Card>

              {/* Recent Activity */}
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardHeader>
                  <CardTitle className="text-white flex items-center gap-2">
                    <Clock className="h-5 w-5" />
                    Recent Activity
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="space-y-3">
                    <div className="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
                      <div className="w-2 h-2 bg-emerald-400 rounded-full" />
                      <div className="flex-1 page-background">
                        <div className="text-sm text-white">Digital Transformation milestone completed</div>
                        <div className="text-xs text-slate-400">2 hours ago</div>
                      </div>
                    </div>
                    <div className="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
                      <div className="w-2 h-2 bg-blue-400 rounded-full" />
                      <div className="flex-1 page-background">
                        <div className="text-sm text-white">Market Expansion budget approved</div>
                        <div className="text-xs text-slate-400">1 day ago</div>
                      </div>
                    </div>
                    <div className="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
                      <div className="w-2 h-2 bg-amber-400 rounded-full" />
                      <div className="flex-1 page-background">
                        <div className="text-sm text-white">Sustainability initiative risk review</div>
                        <div className="text-xs text-slate-400">3 days ago</div>
                      </div>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Strategic Scenarios */}
          <TabsContent value="scenarios" className="space-y-6">
            
            {/* Filters and Search */}
            <div className="flex items-center gap-4 bg-slate-900/50 p-4 rounded-lg border border-slate-700/50">
              <div className="flex-1 page-background relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400" />
                <Input
                  placeholder="Search scenarios..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="pl-10 bg-slate-800 border-slate-600 text-white"
                />
              </div>
              <Select value={filterStatus} onValueChange={setFilterStatus}>
                <SelectTrigger className="w-40 bg-slate-800 border-slate-600 text-white">
                  <SelectValue placeholder="Status" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">All Status</SelectItem>
                  <SelectItem value="planning">Planning</SelectItem>
                  <SelectItem value="active">Active</SelectItem>
                  <SelectItem value="completed">Completed</SelectItem>
                  <SelectItem value="on-hold">On Hold</SelectItem>
                </SelectContent>
              </Select>
              <Select value={filterPriority} onValueChange={setFilterPriority}>
                <SelectTrigger className="w-40 bg-slate-800 border-slate-600 text-white">
                  <SelectValue placeholder="Priority" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">All Priority</SelectItem>
                  <SelectItem value="critical">Critical</SelectItem>
                  <SelectItem value="high">High</SelectItem>
                  <SelectItem value="medium">Medium</SelectItem>
                  <SelectItem value="low">Low</SelectItem>
                </SelectContent>
              </Select>
            </div>

            {/* Scenarios Grid */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {filteredScenarios.map((scenario) => (
                <Card key={scenario.id} className="bg-slate-900/50 border-slate-700/50 hover:bg-slate-800/50 transition-all duration-300">
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-white text-lg">{scenario.name}</CardTitle>
                      <div className="flex items-center gap-2">
                        <Badge className={getStatusColor(scenario.status)}>
                          {scenario.status.toUpperCase()}
                        </Badge>
                        <Badge className={getPriorityColor(scenario.priority)}>
                          {scenario.priority.toUpperCase()}
                        </Badge>
                      </div>
                    </div>
                    <p className="text-slate-400 text-sm">{scenario.description}</p>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <div className="text-slate-400">Owner</div>
                        <div className="text-white">{scenario.owner}</div>
                      </div>
                      <div>
                        <div className="text-slate-400">Budget</div>
                        <div className="text-white">{formatCurrency(scenario.budget)}</div>
                      </div>
                      <div>
                        <div className="text-slate-400">Timeline</div>
                        <div className="text-white">{scenario.startDate} - {scenario.endDate}</div>
                      </div>
                      <div>
                        <div className="text-slate-400">Progress</div>
                        <div className="text-white">{scenario.progress}%</div>
                      </div>
                    </div>
                    
                    <div className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-400">Overall Progress</span>
                        <span className="text-white">{scenario.progress}%</span>
                      </div>
                      <Progress value={scenario.progress} className="h-2" />
                    </div>
                    
                    <div className="flex gap-2">
                      <Button size="sm" className="flex-1 bg-blue-600 hover:bg-blue-700">
                        <FileText className="w-4 h-4 mr-2" />
                        View Details
                      </Button>
                      <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <Edit className="w-4 h-4" />
                      </Button>
                      <Button size="sm" variant="outline" className="border-slate-600 text-slate-300 hover:bg-slate-700">
                        <Share className="w-4 h-4" />
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </TabsContent>

          {/* Performance Analytics */}
          <TabsContent value="analytics" className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Success Rate</h3>
                    <TrendingUp className="h-5 w-5 text-emerald-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">94%</div>
                  <div className="text-sm text-slate-400">Scenario completion</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Avg Timeline</h3>
                    <Calendar className="h-5 w-5 text-blue-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">8.2</div>
                  <div className="text-sm text-slate-400">months</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">ROI Average</h3>
                    <DollarSign className="h-5 w-5 text-emerald-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">245%</div>
                  <div className="text-sm text-slate-400">Return on investment</div>
                </CardContent>
              </Card>

              <Card className="bg-slate-900/50 border-slate-700/50">
                <CardContent className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-white">Risk Mitigation</h3>
                    <AlertCircle className="h-5 w-5 text-amber-400" />
                  </div>
                  <div className="text-2xl font-bold text-white mb-2">87%</div>
                  <div className="text-sm text-slate-400">Issues prevented</div>
                </CardContent>
              </Card>
            </div>
          </TabsContent>

          {/* Planning Tools */}
          <TabsContent value="planning" className="space-y-6">
            <Card className="bg-slate-900/50 border-slate-700/50">
              <CardHeader>
                <CardTitle className="text-white">Strategic Planning Tools</CardTitle>
              </CardHeader>
              <CardContent className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <Button className="h-24 bg-blue-600 hover:bg-blue-700 flex-col gap-2">
                  <Lightbulb className="w-8 h-8" />
                  Scenario Builder
                </Button>
                <Button className="h-24 bg-emerald-600 hover:bg-emerald-700 flex-col gap-2">
                  <BarChart3 className="w-8 h-8" />
                  Impact Analysis
                </Button>
                <Button className="h-24 bg-purple-600 hover:bg-purple-700 flex-col gap-2">
                  <Users className="w-8 h-8" />
                  Stakeholder Mapping
                </Button>
                <Button className="h-24 bg-amber-600 hover:bg-amber-700 flex-col gap-2">
                  <AlertCircle className="w-8 h-8" />
                  Risk Assessment
                </Button>
                <Button className="h-24 bg-pink-600 hover:bg-pink-700 flex-col gap-2">
                  <DollarSign className="w-8 h-8" />
                  Budget Planning
                </Button>
                <Button className="h-24 bg-indigo-600 hover:bg-indigo-700 flex-col gap-2">
                  <Calendar className="w-8 h-8" />
                  Timeline Builder
                </Button>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/SuccessMetricsConfiguration.tsx
========================================
import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Textarea } from '@/components/ui/textarea';
import { Switch } from '@/components/ui/switch';
import { Progress } from '@/components/ui/progress';
import { Separator } from '@/components/ui/separator';
import { useToast } from '@/hooks/use-toast';
import { useQuery, useMutation } from '@tanstack/react-query';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { Link } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import { 
  Target,
  TrendingUp,
  BarChart3,
  Clock,
  DollarSign,
  Users,
  Zap,
  Shield,
  ArrowLeft,
  Home,
  Save,
  Plus,
  Edit,
  Trash2,
  Check,
  AlertTriangle,
  Gauge,
  Calendar,
  RefreshCw
} from 'lucide-react';

interface SuccessMetric {
  id: string;
  name: string;
  type: 'fri' | 'velocity' | 'coverage' | 'roi' | 'custom';
  description: string;
  targetValue: number;
  currentValue: number;
  baselineValue: number;
  unit: string;
  reviewCadence: 'daily' | 'weekly' | 'monthly' | 'quarterly';
  isActive: boolean;
}

const METRIC_TYPES = [
  { id: 'fri', name: 'Future Readiness Index', icon: Gauge, color: 'text-blue-500', description: 'Overall organizational readiness score' },
  { id: 'velocity', name: 'Decision Velocity', icon: Zap, color: 'text-yellow-500', description: 'Speed of strategic decision-making' },
  { id: 'coverage', name: 'Scenario Coverage', icon: Shield, color: 'text-purple-500', description: 'Percentage of risks with active playbooks' },
  { id: 'roi', name: 'ROI Metrics', icon: DollarSign, color: 'text-green-500', description: 'Return on strategic investments' },
  { id: 'custom', name: 'Custom KPI', icon: BarChart3, color: 'text-cyan-500', description: 'Organization-specific metrics' },
];

const REVIEW_CADENCES = [
  { id: 'daily', name: 'Daily', description: 'Review every day' },
  { id: 'weekly', name: 'Weekly', description: 'Review every week' },
  { id: 'monthly', name: 'Monthly', description: 'Review every month' },
  { id: 'quarterly', name: 'Quarterly', description: 'Review every quarter' },
];

const DEFAULT_METRICS: SuccessMetric[] = [
  { 
    id: '1', 
    name: 'Future Readiness Index', 
    type: 'fri', 
    description: 'Overall organizational readiness score measuring strategic preparedness across all domains',
    targetValue: 84.4,
    currentValue: 72.3,
    baselineValue: 58.1,
    unit: '%',
    reviewCadence: 'weekly',
    isActive: true,
  },
  { 
    id: '2', 
    name: 'Decision Velocity', 
    type: 'velocity', 
    description: 'Average time from trigger detection to coordinated response initiation',
    targetValue: 12,
    currentValue: 18,
    baselineValue: 45,
    unit: 'minutes',
    reviewCadence: 'daily',
    isActive: true,
  },
  { 
    id: '3', 
    name: 'Scenario Coverage', 
    type: 'coverage', 
    description: 'Percentage of identified risk scenarios with active, tested playbooks',
    targetValue: 95,
    currentValue: 78,
    baselineValue: 35,
    unit: '%',
    reviewCadence: 'monthly',
    isActive: true,
  },
  { 
    id: '4', 
    name: 'Stakeholder Coordination', 
    type: 'custom', 
    description: 'Number of stakeholders actively engaged in execution coordination',
    targetValue: 30,
    currentValue: 24,
    baselineValue: 8,
    unit: 'people',
    reviewCadence: 'weekly',
    isActive: true,
  },
];

export default function SuccessMetricsConfiguration() {
  const { toast } = useToast();
  const [isAddMetricDialogOpen, setIsAddMetricDialogOpen] = useState(false);
  
  // Form state
  const [newMetric, setNewMetric] = useState<Partial<SuccessMetric>>({
    name: '',
    type: 'custom',
    description: '',
    targetValue: 0,
    currentValue: 0,
    baselineValue: 0,
    unit: '%',
    reviewCadence: 'weekly',
    isActive: true,
  });
  
  // Fetch metrics from API
  const { data: apiMetrics, isLoading } = useQuery<any[]>({
    queryKey: ['/api/config/success-metrics'],
  });
  
  // Use API data if available, otherwise use defaults
  const metrics: SuccessMetric[] = (apiMetrics && apiMetrics.length > 0) 
    ? apiMetrics.map((m: any) => ({
        id: m.id,
        name: m.name,
        type: m.metric_type || m.metricType || 'custom',
        description: m.description || '',
        targetValue: parseFloat(m.target_value || m.targetValue) || 0,
        currentValue: parseFloat(m.current_value || m.currentValue) || 0,
        baselineValue: parseFloat(m.baseline_value || m.baselineValue) || 0,
        unit: m.unit || '%',
        reviewCadence: m.review_cadence || m.reviewCadence || 'weekly',
        isActive: m.is_active ?? m.isActive ?? true,
      }))
    : DEFAULT_METRICS;
  
  // Create metric mutation
  const createMetricMutation = useMutation({
    mutationFn: async (metric: Partial<SuccessMetric>) => {
      return apiRequest('/api/config/success-metrics', {
        method: 'POST',
        body: JSON.stringify({
          name: metric.name,
          description: metric.description,
          metricType: metric.type,
          targetValue: metric.targetValue,
          currentValue: metric.currentValue,
          baselineValue: metric.baselineValue,
          unit: metric.unit,
          reviewCadence: metric.reviewCadence,
          isActive: metric.isActive,
        }),
      });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/config/success-metrics'] });
      toast({ title: 'Success', description: 'Metric created successfully' });
      setIsAddMetricDialogOpen(false);
      setNewMetric({
        name: '',
        type: 'custom',
        description: '',
        targetValue: 0,
        currentValue: 0,
        baselineValue: 0,
        unit: '%',
        reviewCadence: 'weekly',
        isActive: true,
      });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to create metric', variant: 'destructive' });
    },
  });
  
  // Delete metric mutation
  const deleteMetricMutation = useMutation({
    mutationFn: async (id: string) => {
      return apiRequest(`/api/config/success-metrics/${id}`, { method: 'DELETE' });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/config/success-metrics'] });
      toast({ title: 'Deleted', description: 'Metric removed' });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to delete metric', variant: 'destructive' });
    },
  });
  
  // Local state for metrics that aren't persisted yet (for demo)
  const [localMetrics, setLocalMetrics] = useState<SuccessMetric[]>([]);
  
  // Combine API metrics with local metrics for display
  const allMetrics = [...metrics, ...localMetrics.filter(lm => !metrics.find(m => m.id === lm.id))];
  
  const calculateProgress = (current: number, baseline: number, target: number) => {
    if (target === baseline) return 0;
    const progress = ((current - baseline) / (target - baseline)) * 100;
    return Math.min(Math.max(progress, 0), 100);
  };
  
  const getProgressColor = (progress: number) => {
    if (progress >= 80) return 'bg-green-500';
    if (progress >= 50) return 'bg-yellow-500';
    return 'bg-red-500';
  };
  
  const handleAddMetric = () => {
    if (!newMetric.name) {
      toast({ title: 'Error', description: 'Metric name is required', variant: 'destructive' });
      return;
    }
    
    // Try to save to API
    createMetricMutation.mutate(newMetric);
  };
  
  const handleDeleteMetric = (id: string) => {
    // Try to delete from API
    deleteMetricMutation.mutate(id);
  };
  
  const getMetricTypeInfo = (type: string) => {
    return METRIC_TYPES.find(t => t.id === type) || METRIC_TYPES[4];
  };

  // Calculate overall FRI
  const friMetric = metrics.find(m => m.type === 'fri');
  const overallFRI = friMetric?.currentValue || 0;
  const friTarget = friMetric?.targetValue || 84.4;
  const friProgress = friMetric ? calculateProgress(friMetric.currentValue, friMetric.baselineValue, friMetric.targetValue) : 0;

  return (
    <PageLayout>
      <div className="page-background min-h-screen bg-transparent p-6">
        <div className="max-w-7xl mx-auto space-y-8">
          
          {/* Breadcrumb Navigation */}
          <div className="mb-6">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>Configuration</span>
              <span>/</span>
              <span className="text-white">Success Metrics</span>
            </div>
          </div>

          {/* Header */}
          <div className="bg-gradient-to-r from-amber-600 to-orange-600 text-white p-6 rounded-lg">
            <div className="flex items-center justify-between">
              <div className="flex items-center space-x-4">
                <div className="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                  <Target className="w-7 h-7 text-white" />
                </div>
                <div>
                  <h1 className="text-3xl font-bold" data-testid="success-metrics-title">Success Metrics Configuration</h1>
                  <p className="text-amber-100 mt-1">Define YOUR success criteria and KPIs</p>
                  <p className="text-amber-200 mt-1 text-sm">Track progress toward your strategic goals with custom metrics</p>
                </div>
              </div>
              <div className="flex items-center gap-4">
                <Button 
                  onClick={() => setIsAddMetricDialogOpen(true)}
                  className="bg-white text-amber-600 hover:bg-amber-50"
                  data-testid="button-add-metric"
                >
                  <Plus className="h-4 w-4 mr-2" />
                  Add Metric
                </Button>
                <Link to="/">
                  <Button variant="secondary" className="bg-amber-700 hover:bg-amber-800 text-amber-100 border-amber-600">
                    <ArrowLeft className="h-4 w-4 mr-2" />
                    Dashboard
                  </Button>
                </Link>
              </div>
            </div>
          </div>

          {/* FRI Hero Card */}
          <Card className="border-amber-500/30 bg-gradient-to-br from-amber-900/30 to-orange-900/20">
            <CardContent className="p-8">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-6">
                  <div className="relative">
                    <div className="w-32 h-32 rounded-full border-8 border-amber-500/30 flex items-center justify-center bg-gray-900">
                      <div className="text-center">
                        <div className="text-4xl font-bold text-amber-400">{overallFRI.toFixed(1)}%</div>
                        <div className="text-sm text-gray-400">Current FRI</div>
                      </div>
                    </div>
                    <div className="absolute -right-2 -top-2 w-10 h-10 rounded-full bg-amber-600 flex items-center justify-center">
                      <TrendingUp className="h-5 w-5 text-white" />
                    </div>
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold text-white">Future Readiness Index</h2>
                    <p className="text-gray-400 mt-1">Your organization's strategic preparedness score</p>
                    <div className="mt-4 flex items-center gap-4">
                      <div>
                        <span className="text-sm text-gray-400">Target:</span>
                        <span className="ml-2 text-lg font-semibold text-amber-400">{friTarget}%</span>
                      </div>
                      <div>
                        <span className="text-sm text-gray-400">Improvement:</span>
                        <span className="ml-2 text-lg font-semibold text-green-400">+{(overallFRI - (friMetric?.baselineValue || 0)).toFixed(1)}%</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div className="w-64">
                  <div className="flex justify-between text-sm mb-2">
                    <span className="text-gray-400">Progress to Target</span>
                    <span className="text-amber-400">{friProgress.toFixed(0)}%</span>
                  </div>
                  <Progress value={friProgress} className="h-3" />
                  <p className="text-xs text-gray-500 mt-2">
                    {friProgress >= 100 ? 'Target achieved!' : `${(friTarget - overallFRI).toFixed(1)}% remaining to target`}
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Metrics Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {metrics.map((metric) => {
              const typeInfo = getMetricTypeInfo(metric.type);
              const TypeIcon = typeInfo.icon;
              const progress = calculateProgress(metric.currentValue, metric.baselineValue, metric.targetValue);
              
              return (
                <Card key={metric.id} className="bg-gray-800/50 border-gray-700 hover:border-amber-500/50 transition-all">
                  <CardHeader className="pb-2">
                    <div className="flex items-start justify-between">
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-lg flex items-center justify-center bg-gray-700`}>
                          <TypeIcon className={`h-5 w-5 ${typeInfo.color}`} />
                        </div>
                        <div>
                          <CardTitle className="text-white text-lg">{metric.name}</CardTitle>
                          <CardDescription className="text-gray-400 text-sm">
                            {metric.description}
                          </CardDescription>
                        </div>
                      </div>
                      <div className="flex gap-1">
                        <Button variant="ghost" size="icon" className="h-8 w-8 text-gray-400 hover:text-white">
                          <Edit className="h-4 w-4" />
                        </Button>
                        <Button 
                          variant="ghost" 
                          size="icon" 
                          className="h-8 w-8 text-gray-400 hover:text-red-500"
                          onClick={() => handleDeleteMetric(metric.id)}
                        >
                          <Trash2 className="h-4 w-4" />
                        </Button>
                      </div>
                    </div>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-3 gap-4 text-center">
                      <div className="p-2 bg-gray-700/50 rounded-lg">
                        <div className="text-xs text-gray-400">Baseline</div>
                        <div className="text-lg font-semibold text-gray-300">
                          {metric.baselineValue}{metric.unit === '%' || metric.unit === 'minutes' ? '' : ' '}{metric.unit}
                        </div>
                      </div>
                      <div className="p-2 bg-gray-700/50 rounded-lg border-2 border-amber-500/30">
                        <div className="text-xs text-gray-400">Current</div>
                        <div className="text-lg font-semibold text-amber-400">
                          {metric.currentValue}{metric.unit === '%' || metric.unit === 'minutes' ? '' : ' '}{metric.unit}
                        </div>
                      </div>
                      <div className="p-2 bg-gray-700/50 rounded-lg">
                        <div className="text-xs text-gray-400">Target</div>
                        <div className="text-lg font-semibold text-green-400">
                          {metric.targetValue}{metric.unit === '%' || metric.unit === 'minutes' ? '' : ' '}{metric.unit}
                        </div>
                      </div>
                    </div>
                    
                    <div>
                      <div className="flex justify-between text-sm mb-1">
                        <span className="text-gray-400">Progress</span>
                        <span className={progress >= 80 ? 'text-green-400' : progress >= 50 ? 'text-yellow-400' : 'text-red-400'}>
                          {progress.toFixed(0)}%
                        </span>
                      </div>
                      <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
                        <div 
                          className={`h-full ${getProgressColor(progress)} transition-all`}
                          style={{ width: `${progress}%` }}
                        />
                      </div>
                    </div>
                    
                    <div className="flex items-center justify-between text-sm">
                      <div className="flex items-center gap-2 text-gray-400">
                        <RefreshCw className="h-4 w-4" />
                        <span>Review: {metric.reviewCadence}</span>
                      </div>
                      <Badge 
                        variant="outline" 
                        className={metric.isActive ? 'text-green-400 border-green-500/30' : 'text-gray-400 border-gray-500/30'}
                      >
                        {metric.isActive ? 'Active' : 'Inactive'}
                      </Badge>
                    </div>
                  </CardContent>
                </Card>
              );
            })}
          </div>

          {/* Add Metric Dialog */}
          <Dialog open={isAddMetricDialogOpen} onOpenChange={setIsAddMetricDialogOpen}>
            <DialogContent className="max-w-lg">
              <DialogHeader>
                <DialogTitle className="flex items-center gap-2">
                  <Plus className="h-5 w-5 text-amber-500" />
                  Add Success Metric
                </DialogTitle>
                <DialogDescription>
                  Define a new KPI to track your organization's strategic success
                </DialogDescription>
              </DialogHeader>
              
              <div className="space-y-4">
                <div className="space-y-2">
                  <Label>Metric Type</Label>
                  <Select 
                    value={newMetric.type} 
                    onValueChange={(value: any) => setNewMetric({ ...newMetric, type: value })}
                  >
                    <SelectTrigger>
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      {METRIC_TYPES.map((type) => (
                        <SelectItem key={type.id} value={type.id}>
                          <div className="flex items-center gap-2">
                            <type.icon className={`h-4 w-4 ${type.color}`} />
                            <span>{type.name}</span>
                          </div>
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
                
                <div className="space-y-2">
                  <Label>Metric Name *</Label>
                  <Input 
                    value={newMetric.name}
                    onChange={(e) => setNewMetric({ ...newMetric, name: e.target.value })}
                    placeholder="e.g., Customer Response Time"
                    data-testid="input-metric-name"
                  />
                </div>
                
                <div className="space-y-2">
                  <Label>Description</Label>
                  <Textarea 
                    value={newMetric.description}
                    onChange={(e) => setNewMetric({ ...newMetric, description: e.target.value })}
                    placeholder="Describe what this metric measures..."
                    rows={2}
                  />
                </div>
                
                <div className="grid grid-cols-3 gap-4">
                  <div className="space-y-2">
                    <Label>Baseline</Label>
                    <Input 
                      type="number"
                      value={newMetric.baselineValue}
                      onChange={(e) => setNewMetric({ ...newMetric, baselineValue: parseFloat(e.target.value) || 0 })}
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Current</Label>
                    <Input 
                      type="number"
                      value={newMetric.currentValue}
                      onChange={(e) => setNewMetric({ ...newMetric, currentValue: parseFloat(e.target.value) || 0 })}
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Target</Label>
                    <Input 
                      type="number"
                      value={newMetric.targetValue}
                      onChange={(e) => setNewMetric({ ...newMetric, targetValue: parseFloat(e.target.value) || 0 })}
                    />
                  </div>
                </div>
                
                <div className="grid grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label>Unit</Label>
                    <Select 
                      value={newMetric.unit} 
                      onValueChange={(value) => setNewMetric({ ...newMetric, unit: value })}
                    >
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="%">Percentage (%)</SelectItem>
                        <SelectItem value="$">Currency ($)</SelectItem>
                        <SelectItem value="minutes">Minutes</SelectItem>
                        <SelectItem value="hours">Hours</SelectItem>
                        <SelectItem value="days">Days</SelectItem>
                        <SelectItem value="count">Count</SelectItem>
                        <SelectItem value="people">People</SelectItem>
                        <SelectItem value="score">Score</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="space-y-2">
                    <Label>Review Cadence</Label>
                    <Select 
                      value={newMetric.reviewCadence} 
                      onValueChange={(value: any) => setNewMetric({ ...newMetric, reviewCadence: value })}
                    >
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        {REVIEW_CADENCES.map((cadence) => (
                          <SelectItem key={cadence.id} value={cadence.id}>{cadence.name}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                </div>
              </div>
              
              <DialogFooter>
                <Button variant="outline" onClick={() => setIsAddMetricDialogOpen(false)}>
                  Cancel
                </Button>
                <Button onClick={handleAddMetric} className="bg-amber-600 hover:bg-amber-700" data-testid="button-save-metric">
                  <Save className="h-4 w-4 mr-2" />
                  Save Metric
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>
          
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/TaskManagement.tsx
========================================
import { useState } from "react";
import { useQuery, useMutation } from "@tanstack/react-query";
import { useLocation } from "wouter";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { useCustomer } from "@/contexts/CustomerContext";
import { queryClient, apiRequest } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";

import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Switch } from "@/components/ui/switch";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";

import {
  Plus,
  Search,
  Clock,
  Users,
  CheckCircle2,
  Circle,
  ArrowRight,
  Timer,
  GitBranch,
  Edit,
  Trash2,
  AlertTriangle,
  Layers,
  ListChecks,
} from "lucide-react";

interface Task {
  id: string;
  title: string;
  description: string;
  assignedRole: string;
  estimatedMinutes: number;
  priority: 'critical' | 'high' | 'medium' | 'low';
  status: 'pending' | 'in_progress' | 'completed' | 'blocked';
  dependsOn: string[];
  approvalRequired: string;
  deliverables: string;
  playbookId?: string;
  playbookName?: string;
}

const STAKEHOLDER_ROLES = [
  "CEO", "COO", "CFO", "CLO", "CTO", "CISO", "CMO", "CHRO",
  "General Counsel", "VP Operations", "VP Strategy", "VP Communications",
  "Director of Risk", "Director of Compliance", "Project Manager",
  "Legal Counsel", "HR Director", "IT Director", "Security Lead"
];

const PRIORITY_CONFIG = {
  critical: { label: "Critical", color: "bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400" },
  high: { label: "High", color: "bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400" },
  medium: { label: "Medium", color: "bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400" },
  low: { label: "Low", color: "bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400" },
};

const STATUS_CONFIG = {
  pending: { label: "Pending", icon: Circle, color: "text-slate-400" },
  in_progress: { label: "In Progress", icon: Timer, color: "text-blue-500" },
  completed: { label: "Completed", icon: CheckCircle2, color: "text-green-500" },
  blocked: { label: "Blocked", icon: AlertTriangle, color: "text-red-500" },
};

const APPROVAL_TYPES = [
  { value: "none", label: "No approval needed" },
  { value: "manager", label: "Manager approval" },
  { value: "director", label: "Director approval" },
  { value: "vp", label: "VP approval" },
  { value: "c_suite", label: "C-Suite approval" },
  { value: "board", label: "Board approval" }
];

const generateId = () => Math.random().toString(36).substring(2, 11);

const DEFAULT_TASKS: Task[] = [
  { id: '1', title: 'Initial Situation Assessment', description: 'Gather and analyze initial information about the incident', assignedRole: 'COO', estimatedMinutes: 10, priority: 'critical', status: 'pending', dependsOn: [], approvalRequired: 'none', deliverables: 'Situation brief document' },
  { id: '2', title: 'Stakeholder Notification', description: 'Notify all relevant stakeholders through established channels', assignedRole: 'VP Communications', estimatedMinutes: 5, priority: 'high', status: 'pending', dependsOn: ['1'], approvalRequired: 'director', deliverables: 'Notification log' },
  { id: '3', title: 'Legal Review', description: 'Initial legal assessment and risk evaluation', assignedRole: 'General Counsel', estimatedMinutes: 15, priority: 'high', status: 'pending', dependsOn: ['1'], approvalRequired: 'none', deliverables: 'Legal risk assessment' },
  { id: '4', title: 'Response Strategy Development', description: 'Develop comprehensive response strategy based on situation', assignedRole: 'CEO', estimatedMinutes: 20, priority: 'critical', status: 'pending', dependsOn: ['1', '3'], approvalRequired: 'c_suite', deliverables: 'Response strategy document' },
  { id: '5', title: 'External Communication Draft', description: 'Prepare external communication materials', assignedRole: 'CMO', estimatedMinutes: 30, priority: 'medium', status: 'pending', dependsOn: ['4'], approvalRequired: 'c_suite', deliverables: 'Press release, FAQ document' },
];

export default function TaskManagement() {
  const { organization } = useCustomer();
  const { toast } = useToast();
  const [search, setSearch] = useState("");
  const [tasks, setTasks] = useState<Task[]>(DEFAULT_TASKS);
  const [editingTask, setEditingTask] = useState<Task | null>(null);
  const [deleteId, setDeleteId] = useState<string | null>(null);
  const [isDialogOpen, setIsDialogOpen] = useState(false);

  const [formData, setFormData] = useState<Partial<Task>>({
    title: '',
    description: '',
    assignedRole: '',
    estimatedMinutes: 15,
    priority: 'medium',
    status: 'pending',
    dependsOn: [],
    approvalRequired: 'none',
    deliverables: '',
  });

  const filteredTasks = tasks.filter(task =>
    !search || 
    task.title.toLowerCase().includes(search.toLowerCase()) ||
    task.assignedRole.toLowerCase().includes(search.toLowerCase())
  );

  const stats = {
    total: tasks.length,
    pending: tasks.filter(t => t.status === 'pending').length,
    inProgress: tasks.filter(t => t.status === 'in_progress').length,
    completed: tasks.filter(t => t.status === 'completed').length,
    totalMinutes: tasks.reduce((sum, t) => sum + t.estimatedMinutes, 0),
  };

  const handleOpenCreate = () => {
    setFormData({
      title: '',
      description: '',
      assignedRole: '',
      estimatedMinutes: 15,
      priority: 'medium',
      status: 'pending',
      dependsOn: [],
      approvalRequired: 'none',
      deliverables: '',
    });
    setEditingTask(null);
    setIsDialogOpen(true);
  };

  const handleOpenEdit = (task: Task) => {
    setFormData({ ...task });
    setEditingTask(task);
    setIsDialogOpen(true);
  };

  const handleSave = () => {
    if (!formData.title || !formData.assignedRole) {
      toast({
        title: "Missing Fields",
        description: "Please fill in title and assigned role.",
        variant: "destructive",
      });
      return;
    }

    if (editingTask) {
      setTasks(tasks.map(t => 
        t.id === editingTask.id 
          ? { ...t, ...formData } as Task
          : t
      ));
      toast({ title: "Task Updated", description: "The task has been updated." });
    } else {
      const newTask: Task = {
        id: generateId(),
        title: formData.title || '',
        description: formData.description || '',
        assignedRole: formData.assignedRole || '',
        estimatedMinutes: formData.estimatedMinutes || 15,
        priority: formData.priority as Task['priority'] || 'medium',
        status: formData.status as Task['status'] || 'pending',
        dependsOn: formData.dependsOn || [],
        approvalRequired: formData.approvalRequired || 'none',
        deliverables: formData.deliverables || '',
      };
      setTasks([...tasks, newTask]);
      toast({ title: "Task Created", description: "New task has been added." });
    }
    setIsDialogOpen(false);
  };

  const handleDelete = () => {
    if (deleteId) {
      setTasks(tasks.filter(t => t.id !== deleteId));
      setDeleteId(null);
      toast({ title: "Task Deleted", description: "The task has been removed." });
    }
  };

  const handleToggleDependency = (taskId: string) => {
    const current = formData.dependsOn || [];
    if (current.includes(taskId)) {
      setFormData({ ...formData, dependsOn: current.filter(id => id !== taskId) });
    } else {
      setFormData({ ...formData, dependsOn: [...current, taskId] });
    }
  };

  return (
    <>
      <StandardNav />
      
      <main className="max-w-7xl mx-auto px-6 py-12">
        <header className="mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <h1 className="text-3xl font-bold text-slate-900 dark:text-white" data-testid="text-page-title">
              Task Management
            </h1>
            <p className="text-slate-600 dark:text-slate-400 mt-1">
              Define and manage execution tasks with dependencies and approval gates
            </p>
          </div>
          <Button 
            onClick={handleOpenCreate}
            className="bg-purple-600 hover:bg-purple-700"
            data-testid="button-create-task"
          >
            <Plus className="h-4 w-4 mr-2" />
            Add Task
          </Button>
        </header>

        <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
          <Card data-testid="stat-total">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                  <ListChecks className="h-5 w-5 text-slate-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-slate-900 dark:text-white">{stats.total}</p>
                  <p className="text-sm text-slate-500">Total Tasks</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-pending">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                  <Circle className="h-5 w-5 text-slate-400" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-slate-600">{stats.pending}</p>
                  <p className="text-sm text-slate-500">Pending</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-in-progress">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                  <Timer className="h-5 w-5 text-blue-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-blue-600">{stats.inProgress}</p>
                  <p className="text-sm text-slate-500">In Progress</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-completed">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg">
                  <CheckCircle2 className="h-5 w-5 text-green-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-green-600">{stats.completed}</p>
                  <p className="text-sm text-slate-500">Completed</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-duration">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                  <Clock className="h-5 w-5 text-purple-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-purple-600">{stats.totalMinutes}m</p>
                  <p className="text-sm text-slate-500">Total Duration</p>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>

        <Card className="mb-6">
          <CardContent className="p-4">
            <div className="relative">
              <Search className="absolute left-3 top-2.5 h-4 w-4 text-slate-400" />
              <Input
                placeholder="Search tasks..."
                value={search}
                onChange={(e) => setSearch(e.target.value)}
                className="pl-10"
                data-testid="input-search"
              />
            </div>
          </CardContent>
        </Card>

        <div className="space-y-4">
          {filteredTasks.length === 0 ? (
            <Card>
              <CardContent className="py-16 text-center">
                <ListChecks className="h-12 w-12 mx-auto mb-4 text-slate-300" />
                <h3 className="text-lg font-medium text-slate-900 dark:text-white mb-2">No Tasks Found</h3>
                <p className="text-slate-500 mb-6">Start by creating your first execution task.</p>
                <Button onClick={handleOpenCreate} data-testid="button-add-first-task">
                  <Plus className="h-4 w-4 mr-2" />
                  Add Task
                </Button>
              </CardContent>
            </Card>
          ) : (
            filteredTasks.map((task, index) => {
              const StatusIcon = STATUS_CONFIG[task.status].icon;
              const priorityConfig = PRIORITY_CONFIG[task.priority];
              const dependencies = task.dependsOn.map(id => tasks.find(t => t.id === id)?.title || id).join(', ');

              return (
                <Card key={task.id} data-testid={`card-task-${task.id}`}>
                  <CardContent className="p-4">
                    <div className="flex items-start gap-4">
                      <div className="flex flex-col items-center gap-1 min-w-[40px]">
                        <div className="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-sm font-bold">
                          {index + 1}
                        </div>
                        {index < filteredTasks.length - 1 && (
                          <div className="w-0.5 h-8 bg-slate-200 dark:bg-slate-700" />
                        )}
                      </div>
                      
                      <div className="flex-1 min-w-0">
                        <div className="flex items-start justify-between gap-4">
                          <div className="flex-1">
                            <div className="flex items-center gap-2 mb-1">
                              <StatusIcon className={`h-4 w-4 ${STATUS_CONFIG[task.status].color}`} />
                              <h3 className="font-semibold text-slate-900 dark:text-white">{task.title}</h3>
                            </div>
                            <p className="text-sm text-slate-500 mb-3">{task.description}</p>
                            
                            <div className="flex flex-wrap gap-2">
                              <Badge variant="outline" className="text-xs">
                                <Users className="h-3 w-3 mr-1" />
                                {task.assignedRole}
                              </Badge>
                              <Badge variant="outline" className="text-xs">
                                <Clock className="h-3 w-3 mr-1" />
                                {task.estimatedMinutes} min
                              </Badge>
                              <Badge className={priorityConfig.color}>
                                {priorityConfig.label}
                              </Badge>
                              {task.approvalRequired !== 'none' && (
                                <Badge variant="outline" className="text-xs text-purple-600 border-purple-300">
                                  <GitBranch className="h-3 w-3 mr-1" />
                                  {APPROVAL_TYPES.find(a => a.value === task.approvalRequired)?.label}
                                </Badge>
                              )}
                              {task.dependsOn.length > 0 && (
                                <Badge variant="outline" className="text-xs text-amber-600 border-amber-300">
                                  <ArrowRight className="h-3 w-3 mr-1" />
                                  Depends on: {dependencies}
                                </Badge>
                              )}
                            </div>
                          </div>
                          
                          <div className="flex gap-2">
                            <Button 
                              variant="ghost" 
                              size="sm" 
                              onClick={() => handleOpenEdit(task)}
                              data-testid={`button-edit-${task.id}`}
                            >
                              <Edit className="h-4 w-4" />
                            </Button>
                            <Button 
                              variant="ghost" 
                              size="sm" 
                              onClick={() => setDeleteId(task.id)}
                              className="text-red-600 hover:text-red-700"
                              data-testid={`button-delete-${task.id}`}
                            >
                              <Trash2 className="h-4 w-4" />
                            </Button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              );
            })
          )}
        </div>

        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
          <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
            <DialogHeader>
              <DialogTitle>{editingTask ? 'Edit Task' : 'Create New Task'}</DialogTitle>
              <DialogDescription>
                Define the task details, dependencies, and approval requirements.
              </DialogDescription>
            </DialogHeader>
            
            <div className="space-y-4 py-4">
              <div className="space-y-2">
                <Label htmlFor="title">Task Title *</Label>
                <Input
                  id="title"
                  value={formData.title || ''}
                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                  placeholder="Enter task title"
                  data-testid="input-task-title"
                />
              </div>

              <div className="space-y-2">
                <Label htmlFor="description">Description</Label>
                <Textarea
                  id="description"
                  value={formData.description || ''}
                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  placeholder="Describe what this task involves"
                  data-testid="input-task-description"
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label>Assigned Role *</Label>
                  <Select 
                    value={formData.assignedRole || ''} 
                    onValueChange={(v) => setFormData({ ...formData, assignedRole: v })}
                  >
                    <SelectTrigger data-testid="select-assigned-role">
                      <SelectValue placeholder="Select role" />
                    </SelectTrigger>
                    <SelectContent>
                      {STAKEHOLDER_ROLES.map(role => (
                        <SelectItem key={role} value={role}>{role}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>

                <div className="space-y-2">
                  <Label htmlFor="estimatedMinutes">Estimated Duration (min)</Label>
                  <Input
                    id="estimatedMinutes"
                    type="number"
                    value={formData.estimatedMinutes || 15}
                    onChange={(e) => setFormData({ ...formData, estimatedMinutes: parseInt(e.target.value) || 15 })}
                    data-testid="input-estimated-minutes"
                  />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label>Priority</Label>
                  <Select 
                    value={formData.priority || 'medium'} 
                    onValueChange={(v) => setFormData({ ...formData, priority: v as Task['priority'] })}
                  >
                    <SelectTrigger data-testid="select-priority">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="critical">Critical</SelectItem>
                      <SelectItem value="high">High</SelectItem>
                      <SelectItem value="medium">Medium</SelectItem>
                      <SelectItem value="low">Low</SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                <div className="space-y-2">
                  <Label>Status</Label>
                  <Select 
                    value={formData.status || 'pending'} 
                    onValueChange={(v) => setFormData({ ...formData, status: v as Task['status'] })}
                  >
                    <SelectTrigger data-testid="select-status">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="pending">Pending</SelectItem>
                      <SelectItem value="in_progress">In Progress</SelectItem>
                      <SelectItem value="completed">Completed</SelectItem>
                      <SelectItem value="blocked">Blocked</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>

              <div className="space-y-2">
                <Label>Approval Required</Label>
                <Select 
                  value={formData.approvalRequired || 'none'} 
                  onValueChange={(v) => setFormData({ ...formData, approvalRequired: v })}
                >
                  <SelectTrigger data-testid="select-approval">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    {APPROVAL_TYPES.map(type => (
                      <SelectItem key={type.value} value={type.value}>{type.label}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>

              <div className="space-y-2">
                <Label>Dependencies (Tasks that must complete first)</Label>
                <div className="grid grid-cols-2 gap-2 p-3 border rounded-lg max-h-40 overflow-y-auto">
                  {tasks.filter(t => t.id !== editingTask?.id).map(task => (
                    <div key={task.id} className="flex items-center gap-2">
                      <Switch
                        checked={formData.dependsOn?.includes(task.id) || false}
                        onCheckedChange={() => handleToggleDependency(task.id)}
                      />
                      <span className="text-sm truncate">{task.title}</span>
                    </div>
                  ))}
                </div>
              </div>

              <div className="space-y-2">
                <Label htmlFor="deliverables">Deliverables</Label>
                <Textarea
                  id="deliverables"
                  value={formData.deliverables || ''}
                  onChange={(e) => setFormData({ ...formData, deliverables: e.target.value })}
                  placeholder="Expected outputs from this task"
                  data-testid="input-deliverables"
                />
              </div>
            </div>

            <DialogFooter>
              <Button variant="outline" onClick={() => setIsDialogOpen(false)} data-testid="button-cancel">
                Cancel
              </Button>
              <Button onClick={handleSave} data-testid="button-save-task">
                {editingTask ? 'Update Task' : 'Create Task'}
              </Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>

        <AlertDialog open={!!deleteId} onOpenChange={() => setDeleteId(null)}>
          <AlertDialogContent>
            <AlertDialogHeader>
              <AlertDialogTitle>Delete Task</AlertDialogTitle>
              <AlertDialogDescription>
                Are you sure you want to delete this task? This action cannot be undone.
              </AlertDialogDescription>
            </AlertDialogHeader>
            <AlertDialogFooter>
              <AlertDialogCancel data-testid="button-cancel-delete">Cancel</AlertDialogCancel>
              <AlertDialogAction
                onClick={handleDelete}
                className="bg-red-600 hover:bg-red-700"
                data-testid="button-confirm-delete"
              >
                Delete
              </AlertDialogAction>
            </AlertDialogFooter>
          </AlertDialogContent>
        </AlertDialog>
      </main>

      <Footer />
    </>
  );
}


========================================
FILE: client/src/pages/TriggersManagement.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Switch } from '@/components/ui/switch';
import { useQuery, useMutation } from '@tanstack/react-query';
import { queryClient, apiRequest } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';
import { Link } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';
import TriggerConfigurationWizard from '@/components/configuration/TriggerConfigurationWizard';
import { 
  AlertTriangle, 
  Activity, 
  Bell,
  Clock,
  TrendingUp,
  Target,
  BarChart3,
  Settings,
  Eye,
  Zap,
  Shield,
  DollarSign,
  Users,
  CheckCircle,
  XCircle,
  Pause,
  Play,
  PlayCircle,
  ArrowLeft,
  Home,
  Plus
} from 'lucide-react';

interface TriggerCondition {
  id: string;
  scenarioId: string;
  scenarioName: string;
  triggerType: 'threshold' | 'event' | 'time' | 'condition' | 'ml_prediction' | 'composite';
  condition: string;
  currentValue: number | string;
  thresholdValue: number | string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  status: 'active' | 'triggered' | 'paused' | 'learning' | 'predicting';
  category: string;
  lastChecked: string;
  triggeredAt?: string;
  autoEscalate: boolean;
  recommendedPlaybooks?: string[];
  // Enhanced AI & Automation Features
  mlPrediction?: {
    confidence: number;
    trend: 'increasing' | 'decreasing' | 'stable';
    forecastedTrigger: string;
    aiModel: string;
    dataPoints: number;
  };
  compositeLogic?: {
    operator: 'AND' | 'OR';
    conditions: Array<{
      metric: string;
      operator: '>' | '<' | '=' | '>=' | '<=';
      value: number | string;
      weight: number;
    }>;
  };
  automatedResponse?: {
    enabled: boolean;
    actions: Array<{
      type: 'activate_scenario' | 'send_notification' | 'escalate' | 'run_script';
      target: string;
      delay: number;
    }>;
  };
  escalationWorkflow?: {
    levels: Array<{
      level: number;
      threshold: number;
      approvers: string[];
      timeout: number;
      actions: string[];
    }>;
  };
  dataSource?: {
    type: 'api' | 'database' | 'webhook' | 'manual';
    endpoint?: string;
    refreshRate: number;
    lastUpdate: string;
    status: 'connected' | 'disconnected' | 'error';
  };
}

const mockTriggers: TriggerCondition[] = [
  {
    id: '1',
    scenarioId: 'supply-chain-crisis',
    scenarioName: 'Supply Chain Disruption',
    triggerType: 'ml_prediction',
    condition: 'AI-predicted supply chain disruption risk',
    currentValue: 12,
    thresholdValue: 7,
    severity: 'high',
    status: 'predicting',
    category: 'supply-chain',
    lastChecked: '2 minutes ago',
    autoEscalate: true,
    mlPrediction: {
      confidence: 89.4,
      trend: 'increasing',
      forecastedTrigger: '2.3 hours',
      aiModel: 'Supply Chain Risk Predictor v3.2',
      dataPoints: 15420
    },
    automatedResponse: {
      enabled: true,
      actions: [
        { type: 'send_notification', target: 'coo@company.com', delay: 0 },
        { type: 'activate_scenario', target: 'supply-chain-crisis', delay: 300 },
        { type: 'escalate', target: 'executive-team', delay: 900 }
      ]
    },
    dataSource: {
      type: 'api',
      endpoint: 'https://api.supplier-network.com/v1/status',
      refreshRate: 300,
      lastUpdate: '2 minutes ago',
      status: 'connected'
    }
  },
  {
    id: '2',
    scenarioId: 'cybersecurity-incident',
    scenarioName: 'Cybersecurity Incident',
    triggerType: 'composite',
    condition: 'Advanced threat detection (Multi-factor analysis)',
    currentValue: 847,
    thresholdValue: 1000,
    severity: 'critical',
    status: 'triggered',
    category: 'security',
    lastChecked: '30 seconds ago',
    triggeredAt: '5 minutes ago',
    autoEscalate: true,
    compositeLogic: {
      operator: 'OR',
      conditions: [
        { metric: 'failed_logins', operator: '>', value: 500, weight: 0.4 },
        { metric: 'suspicious_ips', operator: '>=', value: 10, weight: 0.3 },
        { metric: 'malware_signatures', operator: '>', value: 0, weight: 0.5 },
        { metric: 'anomaly_score', operator: '>=', value: 85, weight: 0.6 }
      ]
    },
    escalationWorkflow: {
      levels: [
        { level: 1, threshold: 300, approvers: ['security-team'], timeout: 300, actions: ['immediate-lockdown'] },
        { level: 2, threshold: 600, approvers: ['ciso', 'cto'], timeout: 600, actions: ['incident-response', 'external-forensics'] },
        { level: 3, threshold: 1200, approvers: ['ceo', 'board'], timeout: 900, actions: ['public-disclosure', 'regulatory-notification'] }
      ]
    },
    dataSource: {
      type: 'api',
      endpoint: 'https://siem.company.com/api/v2/threats',
      refreshRate: 30,
      lastUpdate: '30 seconds ago',
      status: 'connected'
    }
  },
  {
    id: '3',
    scenarioId: 'financial-liquidity-crisis',
    scenarioName: 'Financial Liquidity Crisis',
    triggerType: 'threshold',
    condition: 'Cash flow below operational requirements',
    currentValue: 2.3,
    thresholdValue: 2.0,
    severity: 'high',
    status: 'active',
    category: 'financial',
    lastChecked: '1 minute ago',
    autoEscalate: false
  },
  {
    id: '4',
    scenarioId: 'product-recall-crisis',
    scenarioName: 'Product Recall Crisis',
    triggerType: 'event',
    condition: 'Customer complaints exceed threshold',
    currentValue: 23,
    thresholdValue: 50,
    severity: 'medium',
    status: 'paused',
    category: 'operational',
    lastChecked: '5 minutes ago',
    autoEscalate: true
  }
];

export default function TriggersManagement() {
  const [selectedCategory, setSelectedCategory] = useState<string>('all');
  const [selectedTrigger, setSelectedTrigger] = useState<TriggerCondition | null>(null);
  const [isWizardOpen, setIsWizardOpen] = useState(false);
  const [filterStatus, setFilterStatus] = useState<string>('all');
  const { toast } = useToast();

  // Fetch real triggers from the API
  const { data: triggersData, isLoading, isError, error } = useQuery<any[]>({
    queryKey: ['/api/executive-triggers'],
  });

  // Mutation to toggle trigger active status
  const toggleTriggerMutation = useMutation({
    mutationFn: async ({ id, isActive }: { id: string; isActive: boolean }) => {
      console.log('Toggling trigger active state:', id, isActive);
      return await apiRequest('PUT', `/api/executive-triggers/${id}`, { isActive });
    },
    onSuccess: () => {
      queryClient.refetchQueries({ queryKey: ['/api/executive-triggers'], exact: false });
      toast({
        title: 'Trigger Updated',
        description: 'Trigger status has been updated successfully.',
      });
    },
    onError: (error: any) => {
      toast({
        title: 'Error',
        description: error.message || 'Failed to update trigger status.',
        variant: 'destructive',
      });
    },
  });

  // Keep raw trigger data for detailed view
  const rawTriggers = triggersData || [];

  // Transform database triggers to frontend format
  const allTriggers: TriggerCondition[] = rawTriggers.map((trigger: any) => ({
    id: trigger.id,
    scenarioId: trigger.id,
    scenarioName: trigger.name,
    triggerType: trigger.triggerType || 'threshold' as const,
    condition: trigger.description || 'Monitor threshold',
    currentValue: trigger.conditions?.value || 0,
    thresholdValue: trigger.conditions?.value || 0,
    severity: trigger.severity || 'medium' as const,
    status: trigger.isActive ? (trigger.alertThreshold === 'red' ? 'triggered' : 'active') : 'paused' as const,
    category: trigger.category || 'operational',
    lastChecked: trigger.updatedAt ? new Date(trigger.updatedAt).toLocaleString() : 'Just now',
    autoEscalate: trigger.notificationSettings?.escalation || false,
    recommendedPlaybooks: trigger.recommendedPlaybooks || [],
    triggeredAt: trigger.lastTriggeredAt ? new Date(trigger.lastTriggeredAt).toLocaleString() : undefined,
  }));

  // Get raw trigger data by ID for detailed view
  const getRawTrigger = (id: string) => rawTriggers.find((t: any) => t.id === id);

  const filteredTriggers = allTriggers.filter(trigger => {
    const categoryMatch = selectedCategory === 'all' || trigger.category === selectedCategory;
    const statusMatch = filterStatus === 'all' || trigger.status === filterStatus;
    return categoryMatch && statusMatch;
  });

  const triggeredCount = allTriggers.filter(t => t.status === 'triggered').length;
  const activeCount = allTriggers.filter(t => t.status === 'active').length;
  const pausedCount = allTriggers.filter(t => t.status === 'paused').length;

  const getTriggerTypeIcon = (triggerType: string) => {
    switch (triggerType) {
      case 'ml_prediction': return <TrendingUp className="h-4 w-4 text-purple-600" />;
      case 'composite': return <BarChart3 className="h-4 w-4 text-blue-600" />;
      case 'threshold': return <Target className="h-4 w-4 text-green-600" />;
      case 'event': return <Zap className="h-4 w-4 text-yellow-600" />;
      case 'time': return <Clock className="h-4 w-4 text-gray-600" />;
      default: return <Activity className="h-4 w-4 text-gray-600" />;
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'triggered': return <AlertTriangle className="h-4 w-4 text-red-600" />;
      case 'predicting': return <TrendingUp className="h-4 w-4 text-purple-600" />;
      case 'learning': return <Settings className="h-4 w-4 text-blue-600 animate-spin" />;
      case 'active': return <Play className="h-4 w-4 text-green-600" />;
      case 'paused': return <Pause className="h-4 w-4 text-gray-600" />;
      default: return <Activity className="h-4 w-4 text-gray-600" />;
    }
  };

  const getDataSourceStatusIcon = (status: string) => {
    switch (status) {
      case 'connected': return <CheckCircle className="h-4 w-4 text-green-600" />;
      case 'disconnected': return <XCircle className="h-4 w-4 text-red-600" />;
      case 'error': return <AlertTriangle className="h-4 w-4 text-orange-600" />;
      default: return <Activity className="h-4 w-4 text-gray-600" />;
    }
  };

  const getSeverityIcon = (severity: string) => {
    switch (severity) {
      case 'critical': return <AlertTriangle className="h-4 w-4 text-red-600" />;
      case 'high': return <AlertTriangle className="h-4 w-4 text-orange-600" />;
      case 'medium': return <AlertTriangle className="h-4 w-4 text-yellow-600" />;
      default: return <AlertTriangle className="h-4 w-4 text-blue-600" />;
    }
  };

  const getCategoryIcon = (category: string) => {
    switch (category) {
      case 'supply-chain': return <Target className="h-4 w-4" />;
      case 'security': return <Shield className="h-4 w-4" />;
      case 'financial': return <DollarSign className="h-4 w-4" />;
      case 'operational': return <Activity className="h-4 w-4" />;
      case 'compliance': return <CheckCircle className="h-4 w-4" />;
      default: return <Activity className="h-4 w-4" />;
    }
  };

  return (
    <PageLayout>
      <div className="page-background min-h-screen bg-transparent p-6">
        <div className="max-w-7xl mx-auto space-y-8">
          
          {/* Breadcrumb Navigation */}
          <div className="mb-6">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>Crisis Management</span>
              <span>/</span>
              <span className="text-white">Triggers Management</span>
            </div>
          </div>

          {/* Header */}
          <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-lg">
            <div className="flex items-center justify-between">
              <div className="flex items-center space-x-4">
                <div className="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                  <Zap className="w-7 h-7 text-white" />
                </div>
                <div>
                  <h1 className="text-3xl font-bold" data-testid="triggers-page-title">Executive Trigger Dashboard</h1>
                  <p className="text-blue-100 mt-1">Define YOUR conditions  AI monitors 24/7  Execute playbooks when triggers fire</p>
                  <p className="text-blue-200 mt-1 text-sm">You define what matters, AI co-pilot handles the monitoring and execution speed</p>
                </div>
              </div>
              <div className="flex items-center gap-4">
                <Button 
                  onClick={() => setIsWizardOpen(true)}
                  className="bg-white text-blue-600 hover:bg-blue-50"
                  data-testid="button-create-custom-trigger"
                >
                  <Plus className="h-4 w-4 mr-2" />
                  Create Custom Trigger
                </Button>
                <OnboardingTrigger pageId="triggers-management" autoStart={true} className="bg-white/10 border-white/30 text-white hover:bg-white/20" />
                <Link to="/">
                  <Button variant="secondary" className="bg-blue-700 hover:bg-blue-800 text-blue-100 border-blue-600">
                    <ArrowLeft className="h-4 w-4 mr-2" />
                    Dashboard
                  </Button>
                </Link>
                <div className="text-right">
                  <div className="text-3xl font-bold">{triggeredCount}</div>
                  <div className="text-blue-100">Active Alerts</div>
                </div>
              </div>
            </div>
          </div>

          {/* Key Metrics */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
            <Card className="border-red-300 bg-red-50 dark:bg-red-900/20">
              <CardContent className="p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-red-600 text-sm font-medium">Critical Alerts</p>
                    <p className="text-2xl font-bold text-red-700">{triggeredCount}</p>
                  </div>
                  <Bell className="h-8 w-8 text-red-600" />
                </div>
              </CardContent>
            </Card>

            <Card className="border-green-300 bg-green-50 dark:bg-green-900/20">
              <CardContent className="p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-green-600 text-sm font-medium">Active Monitoring</p>
                    <p className="text-2xl font-bold text-green-700">{activeCount}</p>
                  </div>
                  <Activity className="h-8 w-8 text-green-600" />
                </div>
              </CardContent>
            </Card>

            <Card className="border-gray-300 bg-gray-50 dark:bg-gray-800">
              <CardContent className="p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600 text-sm font-medium">Paused Triggers</p>
                    <p className="text-2xl font-bold text-gray-700">{pausedCount}</p>
                  </div>
                  <Pause className="h-8 w-8 text-gray-600" />
                </div>
              </CardContent>
            </Card>

            <Card className="border-blue-300 bg-blue-50 dark:bg-blue-900/20">
              <CardContent className="p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-blue-600 text-sm font-medium">Total Triggers</p>
                    <p className="text-2xl font-bold text-blue-700">{isLoading ? '...' : allTriggers.length}</p>
                  </div>
                  <Target className="h-8 w-8 text-blue-600" />
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Active Alerts Banner */}
          {triggeredCount > 0 && (
            <Alert className="border-red-500 bg-red-50 dark:bg-red-900/20">
              <AlertTriangle className="h-5 w-5 text-red-600" />
              <AlertDescription className="text-red-800 dark:text-red-200">
                <div className="flex items-center justify-between">
                  <div>
                    <div className="font-semibold"> Critical Triggers Activated</div>
                    <div className="mt-1">{triggeredCount} scenario triggers require immediate attention</div>
                  </div>
                  <Button variant="destructive" size="sm">
                    View All Alerts
                  </Button>
                </div>
              </AlertDescription>
            </Alert>
          )}

          {/* Signal Categories Overview */}
          <Card className="border-blue-500/30 bg-blue-950/20">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-blue-300">
                <Eye className="h-5 w-5" />
                Intelligence Signal Categories ({allTriggers.length} Data Points)
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-4 md:grid-cols-8 gap-2">
                {['competitive', 'market', 'financial', 'regulatory', 'supplychain', 'customer', 'talent', 'geopolitical', 'technology', 'media', 'cyber', 'economic', 'partnership', 'execution', 'behavior', 'innovation'].map(cat => {
                  const count = allTriggers.filter(t => t.category === cat).length;
                  return (
                    <Button
                      key={cat}
                      variant={selectedCategory === cat ? "default" : "outline"}
                      size="sm"
                      onClick={() => setSelectedCategory(cat)}
                      className="text-xs capitalize"
                      data-testid={`category-${cat}`}
                    >
                      {cat} ({count})
                    </Button>
                  );
                })}
              </div>
            </CardContent>
          </Card>

          <Tabs value={selectedCategory} onValueChange={setSelectedCategory} className="space-y-6">
            <div className="flex items-center justify-between">
              <TabsList className="bg-white dark:bg-gray-800 flex-wrap h-auto gap-1 p-1">
                <TabsTrigger value="all">All ({allTriggers.length})</TabsTrigger>
                <TabsTrigger value="competitive">Competitive</TabsTrigger>
                <TabsTrigger value="market">Market</TabsTrigger>
                <TabsTrigger value="financial">Financial</TabsTrigger>
                <TabsTrigger value="regulatory">Regulatory</TabsTrigger>
                <TabsTrigger value="supplychain">Supply Chain</TabsTrigger>
                <TabsTrigger value="customer">Customer</TabsTrigger>
                <TabsTrigger value="talent">Talent</TabsTrigger>
                <TabsTrigger value="technology">Technology</TabsTrigger>
              </TabsList>

              <div className="flex items-center space-x-4">
                <Select value={filterStatus} onValueChange={setFilterStatus}>
                  <SelectTrigger className="w-40">
                    <SelectValue placeholder="Filter by status" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="all">All Status</SelectItem>
                    <SelectItem value="triggered">Triggered</SelectItem>
                    <SelectItem value="active">Active</SelectItem>
                    <SelectItem value="paused">Paused</SelectItem>
                  </SelectContent>
                </Select>
                <Button variant="outline" size="sm">
                  <Settings className="h-4 w-4 mr-2" />
                  Configure
                </Button>
              </div>
            </div>

            <TabsContent value={selectedCategory} className="space-y-6">
              <div className="grid grid-cols-1 gap-4">
                {isLoading && (
                  <Card>
                    <CardContent className="p-12 text-center">
                      <div className="text-gray-500">Loading triggers...</div>
                    </CardContent>
                  </Card>
                )}
                
                {isError && (
                  <Card className="border-red-300">
                    <CardContent className="p-12 text-center">
                      <AlertTriangle className="h-12 w-12 text-red-500 mx-auto mb-4" />
                      <h3 className="text-lg font-semibold text-red-700 mb-2">Error Loading Triggers</h3>
                      <p className="text-gray-600">Failed to fetch triggers from the database. Please try refreshing the page.</p>
                    </CardContent>
                  </Card>
                )}
                
                {!isLoading && !isError && filteredTriggers.length === 0 && (
                  <Card>
                    <CardContent className="p-12 text-center">
                      <Target className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                      <h3 className="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">No Triggers Found</h3>
                      <p className="text-gray-600 dark:text-gray-400 mb-4">
                        {allTriggers.length === 0 
                          ? "You haven't created any executive triggers yet. Create your first trigger to start monitoring critical conditions."
                          : "No triggers match the selected filters. Try adjusting your category or status filters."}
                      </p>
                      <Button 
                        onClick={() => setIsWizardOpen(true)}
                        data-testid="button-create-trigger"
                      >
                        <Plus className="h-4 w-4 mr-2" />
                        Create First Trigger
                      </Button>
                    </CardContent>
                  </Card>
                )}
                
                {!isLoading && !isError && filteredTriggers.map((trigger) => {
                  const rawData = getRawTrigger(trigger.id);
                  return (
                  <Card key={trigger.id} className={`transition-all hover:shadow-md ${
                    trigger.status === 'triggered' ? 'border-red-500 bg-red-50 dark:bg-red-900/20' : 
                    trigger.status === 'active' ? 'border-green-300' : 'border-gray-200'
                  }`}>
                    <CardContent className="p-6">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center space-x-4">
                          <div className="flex items-center space-x-2">
                            {getCategoryIcon(trigger.category)}
                            {getTriggerTypeIcon(trigger.triggerType)}
                            {getSeverityIcon(trigger.severity)}
                            {getStatusIcon(trigger.status)}
                          </div>
                          <div>
                            <h3 className="font-semibold text-gray-900 dark:text-gray-100">
                              {trigger.scenarioName}
                            </h3>
                            <p className="text-sm text-gray-600 dark:text-gray-400">{trigger.condition}</p>
                          </div>
                        </div>

                        <div className="flex items-center space-x-6">
                          <div className="text-center">
                            <div className="text-sm text-gray-500">Threshold</div>
                            <div className="font-bold">{rawData?.conditions?.operator || ''} {rawData?.conditions?.value || trigger.thresholdValue}</div>
                          </div>
                          
                          {/* Enable/Disable Toggle */}
                          <div className="flex items-center space-x-2">
                            <Label htmlFor={`trigger-toggle-${trigger.id}`} className="text-sm text-gray-500">
                              {trigger.status === 'paused' ? 'Disabled' : 'Enabled'}
                            </Label>
                            <Switch
                              id={`trigger-toggle-${trigger.id}`}
                              checked={trigger.status !== 'paused'}
                              onCheckedChange={(checked) => {
                                toggleTriggerMutation.mutate({ id: trigger.id, isActive: checked });
                              }}
                              disabled={toggleTriggerMutation.isPending}
                              data-testid={`switch-trigger-${trigger.id}`}
                            />
                          </div>
                          
                          <div className="flex items-center space-x-2">
                            {getStatusIcon(trigger.status)}
                            <Badge variant={
                              trigger.status === 'triggered' ? 'destructive' :
                              trigger.status === 'active' ? 'default' : 'secondary'
                            }>
                              {trigger.status}
                            </Badge>
                          </div>
                          <Badge variant="outline" className={
                            trigger.severity === 'critical' ? 'border-red-500 text-red-600' :
                            trigger.severity === 'high' ? 'border-orange-500 text-orange-600' :
                            trigger.severity === 'medium' ? 'border-yellow-500 text-yellow-600' :
                            'border-blue-500 text-blue-600'
                          }>
                            {trigger.severity.toUpperCase()}
                          </Badge>
                        </div>
                      </div>

                      {/* Full Data Points Display */}
                      {rawData && (
                        <div className="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                          {/* Condition Details */}
                          <div className="p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700">
                            <div className="flex items-center gap-2 mb-2">
                              <Target className="h-4 w-4 text-blue-500" />
                              <span className="text-sm font-medium text-slate-700 dark:text-slate-300">Trigger Condition</span>
                            </div>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between">
                                <span className="text-slate-500">Field:</span>
                                <span className="font-mono text-slate-700 dark:text-slate-300">{rawData.conditions?.field || 'N/A'}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">Operator:</span>
                                <span className="font-mono text-slate-700 dark:text-slate-300">{rawData.conditions?.operator || 'N/A'}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">Value:</span>
                                <span className="font-mono text-slate-700 dark:text-slate-300">{rawData.conditions?.value}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">Logic:</span>
                                <span className="font-mono text-slate-700 dark:text-slate-300">{rawData.conditions?.logic || 'single'}</span>
                              </div>
                            </div>
                          </div>

                          {/* Notification Settings */}
                          <div className="p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-700">
                            <div className="flex items-center gap-2 mb-2">
                              <Bell className="h-4 w-4 text-amber-500" />
                              <span className="text-sm font-medium text-amber-700 dark:text-amber-300">Notifications</span>
                            </div>
                            <div className="flex flex-wrap gap-2">
                              {rawData.notificationSettings?.email && (
                                <Badge variant="secondary" className="text-xs bg-green-100 text-green-700">Email </Badge>
                              )}
                              {rawData.notificationSettings?.inApp && (
                                <Badge variant="secondary" className="text-xs bg-green-100 text-green-700">In-App </Badge>
                              )}
                              {rawData.notificationSettings?.slack && (
                                <Badge variant="secondary" className="text-xs bg-green-100 text-green-700">Slack </Badge>
                              )}
                              {rawData.notificationSettings?.escalation && (
                                <Badge variant="secondary" className="text-xs bg-red-100 text-red-700">Escalation </Badge>
                              )}
                            </div>
                          </div>

                          {/* Category & Metadata */}
                          <div className="p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-700">
                            <div className="flex items-center gap-2 mb-2">
                              <Activity className="h-4 w-4 text-purple-500" />
                              <span className="text-sm font-medium text-purple-700 dark:text-purple-300">Metadata</span>
                            </div>
                            <div className="space-y-1 text-xs">
                              <div className="flex justify-between">
                                <span className="text-slate-500">Category:</span>
                                <Badge variant="outline" className="text-xs capitalize">{rawData.category}</Badge>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">Type:</span>
                                <span className="font-mono text-slate-700 dark:text-slate-300">{rawData.triggerType}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-500">Alert Level:</span>
                                <Badge variant={rawData.alertThreshold === 'red' ? 'destructive' : rawData.alertThreshold === 'yellow' ? 'default' : 'secondary'} className="text-xs">
                                  {rawData.alertThreshold}
                                </Badge>
                              </div>
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Enhanced Features Display */}
                      <div className="mt-4 space-y-3">
                        {/* AI Prediction Display */}
                        {trigger.mlPrediction && (
                          <div className="p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-700">
                            <div className="flex items-center justify-between mb-2">
                              <div className="flex items-center gap-2">
                                <TrendingUp className="h-4 w-4 text-purple-600" />
                                <span className="text-sm font-medium text-purple-700 dark:text-purple-300">AI Prediction</span>
                                <Badge variant="outline" className="text-xs border-purple-300 text-purple-600">
                                  {trigger.mlPrediction.confidence}% Confidence
                                </Badge>
                              </div>
                              <Badge variant={trigger.mlPrediction.trend === 'increasing' ? 'destructive' : 'secondary'}>
                                {trigger.mlPrediction.trend}
                              </Badge>
                            </div>
                            <div className="text-xs text-purple-600 dark:text-purple-400 grid grid-cols-3 gap-4">
                              <div>Forecasted trigger: {trigger.mlPrediction.forecastedTrigger}</div>
                              <div>Model: {trigger.mlPrediction.aiModel}</div>
                              <div>Data points: {trigger.mlPrediction.dataPoints.toLocaleString()}</div>
                            </div>
                          </div>
                        )}

                        {/* Composite Logic Display */}
                        {trigger.compositeLogic && (
                          <div className="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700">
                            <div className="flex items-center gap-2 mb-2">
                              <BarChart3 className="h-4 w-4 text-blue-600" />
                              <span className="text-sm font-medium text-blue-700 dark:text-blue-300">Composite Logic</span>
                              <Badge variant="outline" className="text-xs border-blue-300 text-blue-600">
                                {trigger.compositeLogic.operator}
                              </Badge>
                            </div>
                            <div className="grid grid-cols-2 gap-2">
                              {trigger.compositeLogic.conditions.map((condition, idx) => (
                                <div key={idx} className="text-xs text-blue-600 dark:text-blue-400 flex items-center justify-between bg-white dark:bg-gray-800 p-2 rounded">
                                  <span>{condition.metric.replace('_', ' ')} {condition.operator} {condition.value}</span>
                                  <Badge variant="secondary" className="text-xs">W: {condition.weight}</Badge>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}

                        {/* Automated Response Display */}
                        {trigger.automatedResponse && trigger.automatedResponse.enabled && (
                          <div className="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-700">
                            <div className="flex items-center gap-2 mb-2">
                              <Settings className="h-4 w-4 text-green-600" />
                              <span className="text-sm font-medium text-green-700 dark:text-green-300">Automated Response</span>
                              <Badge variant="secondary" className="text-xs bg-green-100 text-green-700">
                                {trigger.automatedResponse.actions.length} Actions Configured
                              </Badge>
                            </div>
                            <div className="grid grid-cols-1 gap-1">
                              {trigger.automatedResponse.actions.map((action, idx) => (
                                <div key={idx} className="text-xs text-green-600 dark:text-green-400 flex items-center justify-between bg-white dark:bg-gray-800 p-2 rounded">
                                  <span className="capitalize">{action.type.replace('_', ' ')}: {action.target}</span>
                                  {action.delay > 0 && <Badge variant="outline" className="text-xs">Delay: {action.delay}s</Badge>}
                                </div>
                              ))}
                            </div>
                          </div>
                        )}

                        {/* Escalation Workflow Display */}
                        {trigger.escalationWorkflow && (
                          <div className="p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-700">
                            <div className="flex items-center gap-2 mb-2">
                              <AlertTriangle className="h-4 w-4 text-orange-600" />
                              <span className="text-sm font-medium text-orange-700 dark:text-orange-300">Escalation Workflow</span>
                              <Badge variant="secondary" className="text-xs bg-orange-100 text-orange-700">
                                {trigger.escalationWorkflow.levels.length} Levels
                              </Badge>
                            </div>
                            <div className="grid grid-cols-3 gap-2">
                              {trigger.escalationWorkflow.levels.map((level, idx) => (
                                <div key={idx} className="text-xs bg-white dark:bg-gray-800 p-2 rounded border">
                                  <div className="font-medium text-orange-600">Level {level.level}</div>
                                  <div className="text-gray-600 dark:text-gray-400">{level.threshold}s threshold</div>
                                  <div className="text-gray-600 dark:text-gray-400">{level.approvers.join(', ')}</div>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}

                        {/* Data Source Status */}
                        {trigger.dataSource && (
                          <div className="p-2 bg-gray-50 dark:bg-gray-800 rounded border">
                            <div className="flex items-center justify-between">
                              <div className="flex items-center gap-2">
                                {getDataSourceStatusIcon(trigger.dataSource.status)}
                                <span className="text-sm font-medium">Data Source</span>
                                <Badge variant="outline" className="text-xs">
                                  {trigger.dataSource.type.toUpperCase()}
                                </Badge>
                                <Badge variant={trigger.dataSource.status === 'connected' ? 'secondary' : 'destructive'} className="text-xs">
                                  {trigger.dataSource.status}
                                </Badge>
                              </div>
                              <div className="text-xs text-gray-500">
                                Refresh: {trigger.dataSource.refreshRate}s | Last: {trigger.dataSource.lastUpdate}
                              </div>
                            </div>
                            {trigger.dataSource.endpoint && (
                              <div className="text-xs text-gray-500 mt-1 truncate">
                                {trigger.dataSource.endpoint}
                              </div>
                            )}
                          </div>
                        )}

                        {/* Recommended Playbooks */}
                        {trigger.recommendedPlaybooks && trigger.recommendedPlaybooks.length > 0 && (
                          <div className="p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg border border-indigo-200 dark:border-indigo-700">
                            <div className="flex items-center gap-2 mb-2">
                              <Target className="h-4 w-4 text-indigo-600" />
                              <span className="text-sm font-medium text-indigo-700 dark:text-indigo-300">Recommended Playbooks</span>
                              <Badge variant="outline" className="text-xs border-indigo-300 text-indigo-600">
                                {trigger.recommendedPlaybooks.length} Available
                              </Badge>
                            </div>
                            <div className="flex flex-wrap gap-2">
                              {trigger.recommendedPlaybooks.map((playbook, idx) => (
                                <Badge key={idx} variant="secondary" className="text-xs bg-indigo-100 dark:bg-indigo-800 text-indigo-700 dark:text-indigo-200">
                                  {playbook}
                                </Badge>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>

                      {trigger.status === 'triggered' && (
                        <div className="mt-4 p-3 bg-red-100 dark:bg-red-900/30 rounded-lg">
                          <div className="flex items-center justify-between">
                            <div className="text-sm text-red-800 dark:text-red-200">
                              <strong> TRIGGERED:</strong> {trigger.triggeredAt} - Immediate action required
                            </div>
                            <div className="flex space-x-2">
                              <Link href={trigger.recommendedPlaybooks?.[0] ? `/playbook-activation/${trigger.id}/${trigger.recommendedPlaybooks[0]}` : `/scenarios`}>
                                <Button 
                                  variant="default" 
                                  size="sm"
                                  className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700"
                                  data-testid="button-execute-playbook"
                                >
                                  <PlayCircle className="h-4 w-4 mr-2" />
                                  {trigger.recommendedPlaybooks?.[0] ? 'Execute Playbook' : 'Select Playbook'}
                                </Button>
                              </Link>
                              <Button variant="destructive" size="sm">
                                Escalate Now
                              </Button>
                              <Button variant="outline" size="sm">
                                Acknowledge
                              </Button>
                            </div>
                          </div>
                        </div>
                      )}

                      {trigger.status === 'active' && (
                        <div className="mt-4">
                          <div className="flex items-center justify-between">
                            <span className="text-xs text-gray-500">Progress to threshold</span>
                            <span className="text-xs text-gray-500">
                              {Math.round((Number(trigger.currentValue) / Number(trigger.thresholdValue)) * 100)}%
                            </span>
                          </div>
                          <Progress 
                            value={Math.min((Number(trigger.currentValue) / Number(trigger.thresholdValue)) * 100, 100)} 
                            className="mt-1"
                          />
                        </div>
                      )}
                    </CardContent>
                  </Card>
                  );
                })}
              </div>
            </TabsContent>
          </Tabs>

          {/* Trigger Analytics */}
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center space-x-2">
                <BarChart3 className="h-5 w-5" />
                <span>Trigger Analytics & Performance</span>
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className="text-center">
                  <div className="text-2xl font-bold text-blue-600">98.7%</div>
                  <div className="text-sm text-gray-600">Detection Accuracy</div>
                </div>
                <div className="text-center">
                  <div className="text-2xl font-bold text-green-600">1.2s</div>
                  <div className="text-sm text-gray-600">Avg Response Time</div>
                </div>
                <div className="text-center">
                  <div className="text-2xl font-bold text-purple-600">47</div>
                  <div className="text-sm text-gray-600">Prevented Escalations</div>
                </div>
              </div>
            </CardContent>
          </Card>

        </div>
      </div>
      
      {/* Trigger Configuration Wizard */}
      <TriggerConfigurationWizard 
        isOpen={isWizardOpen}
        onClose={() => setIsWizardOpen(false)}
        onSuccess={() => {
          setIsWizardOpen(false);
        }}
      />
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/UATAdmin.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useToast } from '@/hooks/use-toast';
import { apiRequest } from '@/lib/queryClient';
import PageLayout from '@/components/layout/PageLayout';
import { 
  Settings, 
  Users, 
  Building2, 
  Plus, 
  Check, 
  AlertTriangle, 
  Copy,
  Key,
  Database,
  PlayCircle,
  FileText,
  Shield,
  Brain
} from 'lucide-react';

interface UATOrganization {
  id: string;
  name: string;
  description?: string;
  domain?: string;
  type: string;
  industry?: string;
  size?: number;
  status: string;
  createdAt: string;
}

interface UATUser {
  id: string;
  email: string;
  firstName?: string;
  lastName?: string;
  organizationId?: string;
  department?: string;
  team?: string;
  createdAt: string;
}

interface DecisionOutcome {
  id: string;
  organizationId: string;
  scenarioId?: string;
  decisionType: string;
  decisionDescription: string;
  decisionMaker?: string;
  createdAt: string;
}

export default function UATAdmin() {
  const { toast } = useToast();
  const queryClient = useQueryClient();
  const [activeTab, setActiveTab] = useState('provision');
  
  // State for organization creation
  const [orgFormData, setOrgFormData] = useState({
    name: '',
    description: '',
    domain: '',
    type: 'enterprise',
    industry: '',
    size: ''
  });

  // State for user creation
  const [userFormData, setUserFormData] = useState({
    email: '',
    firstName: '',
    lastName: '',
    organizationId: '',
    department: '',
    team: '',
    password: ''
  });

  // Fetch organizations for UAT
  const { data: organizations = [], isLoading: orgLoading } = useQuery({
    queryKey: ['/api/organizations'],
    enabled: true
  });

  // Fetch users for UAT
  const { data: users = [], isLoading: usersLoading } = useQuery({
    queryKey: ['/api/users'],
    enabled: true
  });

  // Fetch decision outcomes for UAT validation
  const { data: decisionOutcomes = [], isLoading: decisionsLoading } = useQuery({
    queryKey: ['/api/decision-outcomes'],
    enabled: true
  });

  // Create organization mutation
  const createOrgMutation = useMutation({
    mutationFn: async (data: any) => {
      const response = await fetch('/api/organizations', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          ...data,
          size: data.size ? parseInt(data.size) : null,
          ownerId: 'uat-admin' // Special UAT owner
        })
      });
      return response.json();
    },
    onSuccess: (data) => {
      toast({
        title: "Organization Created",
        description: `Successfully created ${data.name} for UAT testing.`
      });
      queryClient.invalidateQueries({ queryKey: ['/api/organizations'] });
      setOrgFormData({
        name: '',
        description: '',
        domain: '',
        type: 'enterprise',
        industry: '',
        size: ''
      });
    },
    onError: (error: any) => {
      toast({
        title: "Error",
        description: error.message || "Failed to create organization",
        variant: "destructive"
      });
    }
  });

  // Create user mutation
  const createUserMutation = useMutation({
    mutationFn: async (data: any) => {
      const response = await fetch('/api/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          ...data,
          id: `uat-${Date.now()}-${Math.random().toString(36).substr(2, 9)}` // Generate UAT user ID
        })
      });
      return response.json();
    },
    onSuccess: (data) => {
      toast({
        title: "User Created",
        description: `Successfully created user ${data.email} for UAT testing.`
      });
      queryClient.invalidateQueries({ queryKey: ['/api/users'] });
      setUserFormData({
        email: '',
        firstName: '',
        lastName: '',
        organizationId: '',
        department: '',
        team: '',
        password: ''
      });
    },
    onError: (error: any) => {
      toast({
        title: "Error",
        description: error.message || "Failed to create user",
        variant: "destructive"
      });
    }
  });

  // Generate secure credentials
  const generateCredentials = () => {
    const randomPassword = Math.random().toString(36).slice(-12) + Math.random().toString(36).slice(-12).toUpperCase() + '123!';
    setUserFormData(prev => ({ ...prev, password: randomPassword }));
  };

  // Copy credentials to clipboard
  const copyCredentials = async (email: string, password: string) => {
    const credentials = `Email: ${email}\nPassword: ${password}`;
    await navigator.clipboard.writeText(credentials);
    toast({
      title: "Credentials Copied",
      description: "User credentials copied to clipboard"
    });
  };

  return (
    <PageLayout>
      <div className="page-background min-h-screen bg-gray-50 dark:bg-gray-900">
        {/* Header */}
        <div className="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg flex items-center justify-center">
                <Settings className="h-6 w-6 text-white" />
              </div>
              <div>
                <h1 className="text-2xl font-bold text-gray-900 dark:text-white" data-testid="uat-admin-title">
                  UAT Administration Center
                </h1>
                <p className="text-sm text-gray-600 dark:text-gray-300">White-Glove Customer Onboarding & Testing Management</p>
              </div>
            </div>
            <div className="flex items-center gap-4">
              <Badge variant="secondary" className="bg-purple-100 text-purple-800 border-purple-200" data-testid="uat-status">
                <div className="w-2 h-2 bg-purple-400 rounded-full mr-2 animate-pulse"></div>
                UAT Environment Active
              </Badge>
            </div>
          </div>
        </div>

        {/* Main Content */}
        <div className="p-6">
          <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full" data-testid="uat-tabs">
            <TabsList className="grid w-full grid-cols-4 mb-6">
              <TabsTrigger value="provision" className="flex items-center gap-2" data-testid="tab-provision">
                <Plus className="h-4 w-4" />
                Provision
              </TabsTrigger>
              <TabsTrigger value="monitor" className="flex items-center gap-2" data-testid="tab-monitor">
                <Database className="h-4 w-4" />
                Monitor
              </TabsTrigger>
              <TabsTrigger value="validate" className="flex items-center gap-2" data-testid="tab-validate">
                <Check className="h-4 w-4" />
                Validate
              </TabsTrigger>
              <TabsTrigger value="scenarios" className="flex items-center gap-2" data-testid="tab-scenarios">
                <PlayCircle className="h-4 w-4" />
                UAT Scenarios
              </TabsTrigger>
            </TabsList>

            {/* PROVISION TAB - Stage 1 */}
            <TabsContent value="provision" className="space-y-6" data-testid="provision-content">
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Create Organization */}
                <Card className="border-2 border-blue-200">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Building2 className="h-5 w-5 text-blue-600" />
                      Create UAT Organization
                      <Badge variant="outline" className="bg-blue-50 text-blue-700">Stage 1</Badge>
                    </CardTitle>
                    <p className="text-sm text-muted-foreground">
                      Manually provision customer organization for white-glove onboarding
                    </p>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <Label htmlFor="org-name">Organization Name</Label>
                        <Input
                          id="org-name"
                          value={orgFormData.name}
                          onChange={(e) => setOrgFormData(prev => ({ ...prev, name: e.target.value }))}
                          placeholder="Customer Company Inc."
                          data-testid="input-org-name"
                        />
                      </div>
                      <div>
                        <Label htmlFor="org-domain">Domain</Label>
                        <Input
                          id="org-domain"
                          value={orgFormData.domain}
                          onChange={(e) => setOrgFormData(prev => ({ ...prev, domain: e.target.value }))}
                          placeholder="customer.com"
                          data-testid="input-org-domain"
                        />
                      </div>
                    </div>
                    <div>
                      <Label htmlFor="org-description">Description</Label>
                      <Textarea
                        id="org-description"
                        value={orgFormData.description}
                        onChange={(e) => setOrgFormData(prev => ({ ...prev, description: e.target.value }))}
                        placeholder="Brief description of the customer organization..."
                        rows={3}
                        data-testid="input-org-description"
                      />
                    </div>
                    <div className="grid grid-cols-3 gap-4">
                      <div>
                        <Label htmlFor="org-type">Type</Label>
                        <Select value={orgFormData.type} onValueChange={(value) => setOrgFormData(prev => ({ ...prev, type: value }))}>
                          <SelectTrigger data-testid="select-org-type">
                            <SelectValue />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="enterprise">Enterprise</SelectItem>
                            <SelectItem value="mid-market">Mid-Market</SelectItem>
                            <SelectItem value="startup">Startup</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label htmlFor="org-industry">Industry</Label>
                        <Input
                          id="org-industry"
                          value={orgFormData.industry}
                          onChange={(e) => setOrgFormData(prev => ({ ...prev, industry: e.target.value }))}
                          placeholder="Technology"
                          data-testid="input-org-industry"
                        />
                      </div>
                      <div>
                        <Label htmlFor="org-size">Employee Count</Label>
                        <Input
                          id="org-size"
                          type="number"
                          value={orgFormData.size}
                          onChange={(e) => setOrgFormData(prev => ({ ...prev, size: e.target.value }))}
                          placeholder="500"
                          data-testid="input-org-size"
                        />
                      </div>
                    </div>
                    <Button 
                      onClick={() => createOrgMutation.mutate(orgFormData)}
                      disabled={!orgFormData.name || createOrgMutation.isPending}
                      className="w-full bg-blue-600 hover:bg-blue-700"
                      data-testid="button-create-org"
                    >
                      {createOrgMutation.isPending ? "Creating..." : "Create Organization"}
                    </Button>
                  </CardContent>
                </Card>

                {/* Create Users */}
                <Card className="border-2 border-green-200">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Users className="h-5 w-5 text-green-600" />
                      Provision Test Users
                      <Badge variant="outline" className="bg-green-50 text-green-700">Stage 1</Badge>
                    </CardTitle>
                    <p className="text-sm text-muted-foreground">
                      Create user accounts linked to the customer organization
                    </p>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div>
                      <Label htmlFor="user-org">Organization</Label>
                      <Select value={userFormData.organizationId} onValueChange={(value) => setUserFormData(prev => ({ ...prev, organizationId: value }))}>
                        <SelectTrigger data-testid="select-user-org">
                          <SelectValue placeholder="Select organization" />
                        </SelectTrigger>
                        <SelectContent>
                          {(organizations as UATOrganization[]).map((org: UATOrganization) => (
                            <SelectItem key={org.id} value={org.id}>{org.name}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <Label htmlFor="user-email">Email</Label>
                        <Input
                          id="user-email"
                          type="email"
                          value={userFormData.email}
                          onChange={(e) => setUserFormData(prev => ({ ...prev, email: e.target.value }))}
                          placeholder="tester@customer.com"
                          data-testid="input-user-email"
                        />
                      </div>
                      <div>
                        <Label htmlFor="user-password">Password</Label>
                        <div className="flex gap-2">
                          <Input
                            id="user-password"
                            type="text"
                            value={userFormData.password}
                            onChange={(e) => setUserFormData(prev => ({ ...prev, password: e.target.value }))}
                            placeholder="Secure password"
                            data-testid="input-user-password"
                          />
                          <Button
                            type="button"
                            variant="outline"
                            size="sm"
                            onClick={generateCredentials}
                            data-testid="button-generate-password"
                          >
                            <Key className="h-4 w-4" />
                          </Button>
                        </div>
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <Label htmlFor="user-firstName">First Name</Label>
                        <Input
                          id="user-firstName"
                          value={userFormData.firstName}
                          onChange={(e) => setUserFormData(prev => ({ ...prev, firstName: e.target.value }))}
                          placeholder="John"
                          data-testid="input-user-first-name"
                        />
                      </div>
                      <div>
                        <Label htmlFor="user-lastName">Last Name</Label>
                        <Input
                          id="user-lastName"
                          value={userFormData.lastName}
                          onChange={(e) => setUserFormData(prev => ({ ...prev, lastName: e.target.value }))}
                          placeholder="Doe"
                          data-testid="input-user-last-name"
                        />
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <Label htmlFor="user-department">Department</Label>
                        <Input
                          id="user-department"
                          value={userFormData.department}
                          onChange={(e) => setUserFormData(prev => ({ ...prev, department: e.target.value }))}
                          placeholder="Operations"
                          data-testid="input-user-department"
                        />
                      </div>
                      <div>
                        <Label htmlFor="user-team">Team</Label>
                        <Input
                          id="user-team"
                          value={userFormData.team}
                          onChange={(e) => setUserFormData(prev => ({ ...prev, team: e.target.value }))}
                          placeholder="Crisis Response"
                          data-testid="input-user-team"
                        />
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <Button 
                        onClick={() => createUserMutation.mutate(userFormData)}
                        disabled={!userFormData.email || !userFormData.organizationId || createUserMutation.isPending}
                        className="flex-1 bg-green-600 hover:bg-green-700"
                        data-testid="button-create-user"
                      >
                        {createUserMutation.isPending ? "Creating..." : "Create User"}
                      </Button>
                      {userFormData.email && userFormData.password && (
                        <Button
                          variant="outline"
                          onClick={() => copyCredentials(userFormData.email, userFormData.password)}
                          data-testid="button-copy-credentials"
                        >
                          <Copy className="h-4 w-4" />
                        </Button>
                      )}
                    </div>
                  </CardContent>
                </Card>
              </div>

              {/* Instructions */}
              <Alert className="border-purple-200 bg-purple-50">
                <Shield className="h-4 w-4" />
                <AlertDescription>
                  <strong>Stage 1 Complete:</strong> After creating organizations and users, securely share credentials with the customer team. 
                  Their first task is to log in and confirm they see their company's dashboard.
                </AlertDescription>
              </Alert>
            </TabsContent>

            {/* MONITOR TAB */}
            <TabsContent value="monitor" className="space-y-6" data-testid="monitor-content">
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Organizations Monitor */}
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Building2 className="h-5 w-5 text-blue-600" />
                      UAT Organizations
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    {orgLoading ? (
                      <p className="text-sm text-gray-500">Loading organizations...</p>
                    ) : (
                      <div className="space-y-3">
                        {(organizations as UATOrganization[]).slice(0, 5).map((org: UATOrganization) => (
                          <div key={org.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                              <p className="font-medium">{org.name}</p>
                              <p className="text-xs text-gray-500">{org.domain}  {org.type}</p>
                            </div>
                            <Badge variant={org.status === 'Active' ? 'secondary' : 'destructive'}>
                              {org.status}
                            </Badge>
                          </div>
                        ))}
                      </div>
                    )}
                  </CardContent>
                </Card>

                {/* Users Monitor */}
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Users className="h-5 w-5 text-green-600" />
                      UAT Test Users
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    {usersLoading ? (
                      <p className="text-sm text-gray-500">Loading users...</p>
                    ) : (
                      <div className="space-y-3">
                        {(users as UATUser[]).slice(0, 5).map((user: UATUser) => (
                          <div key={user.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                              <p className="font-medium">{user.firstName} {user.lastName}</p>
                              <p className="text-xs text-gray-500">{user.email}</p>
                            </div>
                            <div className="text-right">
                              <p className="text-xs font-medium">{user.department}</p>
                              <p className="text-xs text-gray-500">{user.team}</p>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            {/* VALIDATE TAB - Stage 3 */}
            <TabsContent value="validate" className="space-y-6" data-testid="validate-content">
              <Card className="border-2 border-orange-200">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <Database className="h-5 w-5 text-orange-600" />
                    Decision Outcomes Validation
                    <Badge variant="outline" className="bg-orange-50 text-orange-700">Stage 3</Badge>
                  </CardTitle>
                  <p className="text-sm text-muted-foreground">
                    Monitor decision logging and institutional memory updates from UAT sessions
                  </p>
                </CardHeader>
                <CardContent>
                  {decisionsLoading ? (
                    <p className="text-sm text-gray-500">Loading decision outcomes...</p>
                  ) : (
                    <div className="space-y-4">
                      {(decisionOutcomes as DecisionOutcome[]).slice(0, 3).map((decision: DecisionOutcome) => (
                        <div key={decision.id} className="p-4 border rounded-lg bg-gray-50">
                          <div className="flex items-start justify-between">
                            <div className="flex-1 page-background">
                              <p className="font-medium">{decision.decisionType}</p>
                              <p className="text-sm text-gray-600 mt-1">{decision.decisionDescription}</p>
                              <div className="flex items-center gap-4 mt-2 text-xs text-gray-500">
                                <span>Org: {decision.organizationId}</span>
                                {decision.scenarioId && <span>Scenario: {decision.scenarioId}</span>}
                                <span>{new Date(decision.createdAt).toLocaleString()}</span>
                              </div>
                            </div>
                            <Badge variant="secondary">Logged</Badge>
                          </div>
                        </div>
                      ))}
                      {(decisionOutcomes as DecisionOutcome[]).length === 0 && (
                        <Alert>
                          <AlertTriangle className="h-4 w-4" />
                          <AlertDescription>
                            No decision outcomes logged yet. Decisions will appear here once the UAT team completes Stage 2.
                          </AlertDescription>
                        </Alert>
                      )}
                    </div>
                  )}
                </CardContent>
              </Card>
            </TabsContent>

            {/* UAT SCENARIOS TAB - Stage 2 */}
            <TabsContent value="scenarios" className="space-y-6" data-testid="scenarios-content">
              <Card className="border-2 border-red-200">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <PlayCircle className="h-5 w-5 text-red-600" />
                    Core UAT Scenario: Supply Chain Disruption
                    <Badge variant="outline" className="bg-red-50 text-red-700">Stage 2</Badge>
                  </CardTitle>
                  <p className="text-sm text-muted-foreground">
                    Ready-to-execute scenario for customer workflow simulation
                  </p>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    <Alert className="border-blue-200 bg-blue-50">
                      <Brain className="h-4 w-4" />
                      <AlertDescription>
                        <strong>Scenario Brief:</strong> A sudden supply chain disruption has occurred affecting key suppliers. 
                        The customer team must activate the War Room, collaborate in real-time, and make strategic decisions.
                      </AlertDescription>
                    </Alert>
                    
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <Card>
                        <CardHeader className="pb-2">
                          <CardTitle className="text-sm">1. War Room Activation</CardTitle>
                        </CardHeader>
                        <CardContent>
                          <p className="text-xs text-gray-600">Customer team lead initiates scenario from template</p>
                          <Badge variant="secondary" className="mt-2 text-xs">Ready</Badge>
                        </CardContent>
                      </Card>
                      
                      <Card>
                        <CardHeader className="pb-2">
                          <CardTitle className="text-sm">2. Real-time Collaboration</CardTitle>
                        </CardHeader>
                        <CardContent>
                          <p className="text-xs text-gray-600">All testers join and validate live updates</p>
                          <Badge variant="secondary" className="mt-2 text-xs">Live</Badge>
                        </CardContent>
                      </Card>
                      
                      <Card>
                        <CardHeader className="pb-2">
                          <CardTitle className="text-sm">3. AI-Powered Insight</CardTitle>
                        </CardHeader>
                        <CardContent>
                          <p className="text-xs text-gray-600">Test AI co-pilot with relevant questions</p>
                          <Badge variant="secondary" className="mt-2 text-xs">AI Ready</Badge>
                        </CardContent>
                      </Card>
                    </div>

                    <div className="p-4 bg-gray-50 rounded-lg">
                      <h4 className="font-medium mb-2">Validation Checklist:</h4>
                      <div className="space-y-2 text-sm">
                        <div className="flex items-center gap-2">
                          <input type="checkbox" className="rounded" />
                          <span>Team can access War Room successfully</span>
                        </div>
                        <div className="flex items-center gap-2">
                          <input type="checkbox" className="rounded" />
                          <span>Real-time updates visible to all participants</span>
                        </div>
                        <div className="flex items-center gap-2">
                          <input type="checkbox" className="rounded" />
                          <span>AI provides relevant, valuable insights</span>
                        </div>
                        <div className="flex items-center gap-2">
                          <input type="checkbox" className="rounded" />
                          <span>Decision correctly logged in database</span>
                        </div>
                        <div className="flex items-center gap-2">
                          <input type="checkbox" className="rounded" />
                          <span>Board-ready report generated successfully</span>
                        </div>
                      </div>
                    </div>

                    <Button 
                      className="w-full bg-red-600 hover:bg-red-700"
                      onClick={() => window.open('/war-room', '_blank')}
                      data-testid="button-launch-scenario"
                    >
                      <PlayCircle className="h-4 w-4 mr-2" />
                      Launch UAT Scenario
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>
          </Tabs>
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/UnifiedEnterprisePlatform.tsx
========================================
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Progress } from "@/components/ui/progress";
import { Link } from 'wouter';
import PageLayout from '@/components/layout/PageLayout';
import ScenarioTemplateLibrary from '@/components/ScenarioTemplateLibrary';
import { useQuery } from '@tanstack/react-query';
import { 
  LayoutDashboard,
  Home,
  ArrowLeft,
  BarChart3, 
  AlertTriangle, 
  Target, 
  Brain, 
  PieChart,
  Users,
  Shield,
  Network,
  Zap,
  Command,
  BookOpen,
  Activity,
  TrendingUp,
  CheckCircle,
  Clock,
  Globe,
  MessageSquare,
  FileText,
  Settings,
  Eye,
  Play,
  Pause,
  Calendar,
  Mail,
  Phone,
  DollarSign
} from 'lucide-react';

export default function UnifiedEnterprisePlatform() {
  const [activeTab, setActiveTab] = useState('overview');

  // Fetch organizations data with demo fallback
  const { data: organizations = [{
    id: '1',
    name: 'Global Manufacturing Corp',
    industry: 'Manufacturing',
    employees: 42000,
    regions: ['North America', 'Europe', 'Asia Pacific']
  }, {
    id: '2', 
    name: 'TechVentures International',
    industry: 'Technology',
    employees: 18500,
    regions: ['North America', 'Europe']
  }] } = useQuery({
    queryKey: ['/api/organizations'],
    enabled: false // Use demo data for presentations
  });

  // Real-time metrics
  const metrics = [
    { name: "Global Agility Score", value: "87.6%", change: "+2.4%", color: "text-emerald-400" },
    { name: "Playbook Readiness", value: "98.7%", change: "+0.8%", color: "text-orange-400" },
    { name: "Strategic Intelligence", value: "94.2%", change: "+1.6%", color: "text-blue-400" },
    { name: "Innovation Pipeline", value: "91.4%", change: "+3.2%", color: "text-purple-400" }
  ];

  // AI Intelligence modules
  const aiModules = [
    { name: "Pulse Intelligence", description: "Real-time organizational health monitoring", status: "active", accuracy: 94.2 },
    { name: "Flux Adaptations", description: "Dynamic change management intelligence", status: "active", accuracy: 91.7 },
    { name: "Prism Insights", description: "Multi-dimensional strategic analysis", status: "active", accuracy: 96.1 },
    { name: "Echo Cultural Analytics", description: "Cultural intelligence assessment", status: "active", accuracy: 89.3 },
    { name: "Nova Innovations", description: "Innovation pipeline management", status: "active", accuracy: 92.8 }
  ];

  // Executive Playbooks (formerly Crisis Templates)
  const executivePlaybooks = [
    { name: "Supply Chain Disruption", severity: "high", activationTime: "15 minutes", stakeholders: 12, playbookId: "SCM-001" },
    { name: "Cybersecurity Incident", severity: "critical", activationTime: "5 minutes", stakeholders: 8, playbookId: "SEC-001" },
    { name: "Financial Liquidity Crisis", severity: "critical", activationTime: "10 minutes", stakeholders: 15, playbookId: "FIN-001" },
    { name: "Regulatory Compliance", severity: "medium", activationTime: "30 minutes", stakeholders: 6, playbookId: "REG-001" }
  ];

  // Executive metrics for C-Suite dashboard
  const executiveMetrics = {
    strategicAlignment: 87.6,
    operationalEfficiency: 94.2,
    financialPerformance: 91.4,
    innovationIndex: 89.7,
    riskManagement: 96.3
  };

  // AI Recommendations
  const aiRecommendations = [
    {
      id: 1,
      title: "Market Expansion Opportunity",
      description: "Southeast Asia markets showing 34% growth potential with low competition density",
      priority: "high",
      confidence: 94,
      impact: "$2.4M projected revenue",
      timeframe: "Q2-Q3 2025",
      mlModel: "Market Intelligence v2.1",
      dataPoints: 47392
    },
    {
      id: 2,
      title: "Supply Chain Optimization",
      description: "Alternative supplier network could reduce costs by 18% while improving delivery times",
      priority: "critical",
      confidence: 89,
      impact: "$1.8M cost savings",
      timeframe: "Immediate implementation",
      mlModel: "Supply Chain AI v3.0",
      dataPoints: 23847
    },
    {
      id: 3,
      title: "Talent Retention Strategy",
      description: "Predictive model indicates 23% turnover risk in key positions within 6 months",
      priority: "high",
      confidence: 91,
      impact: "$890K retention savings",
      timeframe: "Next 30 days",
      mlModel: "HR Analytics v1.7",
      dataPoints: 15683
    }
  ];

  // Strategic scenarios
  const strategicScenarios = [
    { name: "Global Market Expansion", status: "active", progress: 78, risk: "medium", roi: "+34%" },
    { name: "Digital Transformation", status: "active", progress: 92, risk: "low", roi: "+28%" },
    { name: "Sustainability Initiative", status: "planning", progress: 15, risk: "high", roi: "+19%" },
    { name: "M&A Integration", status: "active", progress: 65, risk: "medium", roi: "+42%" }
  ];

  // Live collaboration data
  const collaborationData = {
    activeUsers: 247,
    liveSessions: 18,
    globalTeams: {
      northAmerica: { status: "online", users: 89 },
      europe: { status: "online", users: 76 },
      asiaPacific: { status: "online", users: 82 }
    },
    recentActivity: [
      { user: "Chief Strategy Officer", action: "joined strategic planning session", time: "2 minutes ago" },
      { user: "VP Operations", action: "updated playbook execution protocol", time: "5 minutes ago" },
      { user: "Risk Director", action: "completed risk assessment", time: "8 minutes ago" }
    ]
  };

  return (
    <PageLayout>
      <div className="h-full bg-transparent p-3" data-testid="unified-platform">
        <div className="w-full max-w-none space-y-3 h-full flex flex-col">
          
          {/* Breadcrumb Navigation */}
          <div className="mb-2 flex-shrink-0">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <Link to="/">
                <Button variant="ghost" size="sm" className="text-gray-400 hover:text-white p-1 h-auto">
                  <Home className="h-4 w-4" />
                </Button>
              </Link>
              <span>/</span>
              <span>AI Intelligence</span>
              <span>/</span>
              <span className="text-white">Intelligence Command Center</span>
            </div>
          </div>

          {/* Header */}
          <div className="bg-gradient-to-r from-primary to-teal-500 text-white p-3 rounded-lg flex-shrink-0">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <LayoutDashboard className="h-10 w-10" />
                <div>
                  <h1 className="text-2xl font-bold" data-testid="platform-title">
                    M Executive Command Center
                  </h1>
                  <p className="text-primary-foreground/80">Where Strategy Meets Velocity - 12-Minute Execution Platform</p>
                </div>
              </div>
              <div className="flex items-center gap-3">
                <Link to="/hybrid-demo">
                  <Button 
                    className="bg-gradient-to-r from-blue-600 to-teal-600 hover:from-blue-700 hover:to-teal-700 text-white font-semibold shadow-lg hover:shadow-xl transition-all" 
                    data-testid="try-live-demo-btn"
                  >
                    <Play className="h-4 w-4 mr-2" />
                    Try Live Demo
                  </Button>
                </Link>
                <Link to="/">
                  <Button variant="secondary" className="bg-primary/70 hover:bg-primary text-primary-foreground border-primary" data-testid="back-to-dashboard">
                    <ArrowLeft className="h-4 w-4 mr-2" />
                    Dashboard
                  </Button>
                </Link>
                <Badge variant="secondary" className="bg-primary/70 text-primary-foreground border-primary" data-testid="system-status">
                  <div className="w-2 h-2 bg-primary-foreground rounded-full mr-2 animate-pulse"></div>
                  ALL SYSTEMS OPERATIONAL
                </Badge>
              </div>
            </div>
          </div>

          {/* 4-Step NFL Methodology - M's Core */}
          <div className="grid grid-cols-4 gap-3 flex-shrink-0">
            <Card className="border-blue-500/30 bg-gradient-to-br from-blue-950/40 to-gray-950/40 hover:border-blue-500/50 transition-all">
              <CardHeader className="p-3">
                <div className="flex items-center gap-2">
                  <Eye className="h-5 w-5 text-blue-400" />
                  <CardTitle className="text-sm text-white">1. SENSE</CardTitle>
                </div>
              </CardHeader>
              <CardContent className="p-3 pt-0">
                <p className="text-xs text-gray-400 mb-2">24/7 AI Intelligence</p>
                <div className="space-y-1">
                  <div className="flex items-center justify-between text-xs">
                    <span className="text-gray-300">Pulse Active</span>
                    <Badge variant="outline" className="bg-green-500/10 text-green-400 border-green-500/30 text-xs">94%</Badge>
                  </div>
                  <div className="flex items-center justify-between text-xs">
                    <span className="text-gray-300">12 Signals</span>
                    <span className="text-blue-400 font-semibold">Monitoring</span>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card className="border-orange-500/30 bg-gradient-to-br from-orange-950/40 to-gray-950/40 hover:border-orange-500/50 transition-all">
              <CardHeader className="p-3">
                <div className="flex items-center gap-2">
                  <Target className="h-5 w-5 text-orange-400" />
                  <CardTitle className="text-sm text-white">2. DECIDE</CardTitle>
                </div>
              </CardHeader>
              <CardContent className="p-3 pt-0">
                <p className="text-xs text-gray-400 mb-2">Trigger Intelligence</p>
                <div className="space-y-1">
                  <div className="flex items-center justify-between text-xs">
                    <span className="text-gray-300">Preparedness</span>
                    <Badge variant="outline" className="bg-green-500/10 text-green-400 border-green-500/30 text-xs">98.7%</Badge>
                  </div>
                  <div className="flex items-center justify-between text-xs">
                    <span className="text-gray-300">47 Playbooks</span>
                    <span className="text-orange-400 font-semibold">Ready</span>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card className="border-green-500/30 bg-gradient-to-br from-green-950/40 to-gray-950/40 hover:border-green-500/50 transition-all">
              <CardHeader className="p-3">
                <div className="flex items-center gap-2">
                  <Zap className="h-5 w-5 text-green-400" />
                  <CardTitle className="text-sm text-white">3. EXECUTE</CardTitle>
                </div>
              </CardHeader>
              <CardContent className="p-3 pt-0">
                <p className="text-xs text-gray-400 mb-2">12-Minute Coordination</p>
                <div className="space-y-1">
                  <div className="flex items-center justify-between text-xs">
                    <span className="text-gray-300">Avg Speed</span>
                    <Badge variant="outline" className="bg-green-500/10 text-green-400 border-green-500/30 text-xs">12min</Badge>
                  </div>
                  <div className="flex items-center justify-between text-xs">
                    <span className="text-gray-300">vs Industry</span>
                    <span className="text-green-400 font-semibold">360x Faster</span>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card className="border-purple-500/30 bg-gradient-to-br from-purple-950/40 to-gray-950/40 hover:border-purple-500/50 transition-all">
              <CardHeader className="p-3">
                <div className="flex items-center gap-2">
                  <BookOpen className="h-5 w-5 text-purple-400" />
                  <CardTitle className="text-sm text-white">4. LEARN</CardTitle>
                </div>
              </CardHeader>
              <CardContent className="p-3 pt-0">
                <p className="text-xs text-gray-400 mb-2">Institutional Memory</p>
                <div className="space-y-1">
                  <div className="flex items-center justify-between text-xs">
                    <span className="text-gray-300">Executions</span>
                    <Badge variant="outline" className="bg-purple-500/10 text-purple-400 border-purple-500/30 text-xs">1,247</Badge>
                  </div>
                  <div className="flex items-center justify-between text-xs">
                    <span className="text-gray-300">ROI Captured</span>
                    <span className="text-purple-400 font-semibold">$144M</span>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full flex-1 flex flex-col min-h-0">
            <TabsList className="grid w-full grid-cols-4 lg:grid-cols-8 xl:grid-cols-10 gap-1 p-1 bg-muted rounded-lg flex-shrink-0">
              <TabsTrigger value="overview" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-overview">
                <BarChart3 className="h-4 w-4" />
                Overview
              </TabsTrigger>
              <TabsTrigger value="crisis" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-crisis">
                <AlertTriangle className="h-4 w-4" />
                Executive Playbooks
              </TabsTrigger>
              <TabsTrigger value="strategic" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-strategic">
                <Target className="h-4 w-4" />
                Strategic Planning
              </TabsTrigger>
              <TabsTrigger value="templates" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-templates">
                <BookOpen className="h-4 w-4" />
                Scenario Templates
              </TabsTrigger>
              <TabsTrigger value="ai-intelligence" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-ai">
                <Brain className="h-4 w-4" />
                AI Intelligence
              </TabsTrigger>
              <TabsTrigger value="collaboration" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-collaboration">
                <Users className="h-4 w-4" />
                Collaboration
              </TabsTrigger>
              <TabsTrigger value="audit" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-audit">
                <Shield className="h-4 w-4" />
                Audit & Compliance
                <Badge variant="outline" className="ml-1 text-[10px] px-1 py-0 h-4 bg-blue-100 dark:bg-blue-900">V3</Badge>
              </TabsTrigger>
              <TabsTrigger value="integrations" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-integrations">
                <Network className="h-4 w-4" />
                Integrations
                <Badge variant="outline" className="ml-1 text-[10px] px-1 py-0 h-4 bg-blue-100 dark:bg-blue-900">V3</Badge>
              </TabsTrigger>
              <TabsTrigger value="analytics" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-analytics">
                <PieChart className="h-4 w-4" />
                Advanced Analytics
                <Badge variant="outline" className="ml-1 text-[10px] px-1 py-0 h-4 bg-blue-100 dark:bg-blue-900">V2</Badge>
              </TabsTrigger>
              <TabsTrigger value="scenario-triggers" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-triggers">
                <Zap className="h-4 w-4" />
                Scenario Triggers
              </TabsTrigger>
              <TabsTrigger value="c-suite-copilot" className="flex items-center gap-1 whitespace-nowrap px-2 py-1.5 text-xs" data-testid="tab-copilot">
                <Command className="h-4 w-4" />
                C-Suite Co-pilot
              </TabsTrigger>
            </TabsList>

            <TabsContent value="overview" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="overview-content">
              
              {/* V1 Core Loop Banner */}
              <div className="bg-gradient-to-r from-blue-50 via-purple-50/30 to-teal-50 dark:from-blue-950/20 dark:via-purple-950/10 dark:to-teal-950/20 rounded-lg border-2 border-blue-300 dark:border-blue-700 p-4 mb-4">
                <div className="flex items-center justify-between">
                  <div>
                    <h2 className="text-xl font-bold text-gray-900 dark:text-white mb-2">Prepare  Monitor  Execute</h2>
                    <p className="text-sm text-gray-700 dark:text-gray-300">
                      Build playbooks from 80+ templates. AI watches your triggers 24/7. Execute in 12 minutes when conditions hit.
                    </p>
                  </div>
                  <div className="flex gap-2">
                    <Link to="/scenarios">
                      <Button variant="outline" size="sm" data-testid="button-browse-templates">Browse Templates</Button>
                    </Link>
                    <Link to="/what-if-analyzer">
                      <Button size="sm" data-testid="button-practice-scenarios">Practice Scenarios</Button>
                    </Link>
                  </div>
                </div>
              </div>
              
              {/* Real-time Metrics Grid */}
              <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-4">
                {metrics.map((metric, index) => (
                  <Card key={index} className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm" data-testid={`metric-${metric.name.replace(/\s+/g, '-').toLowerCase()}`}>
                    <CardHeader className="pb-2">
                      <div className="flex items-center justify-between">
                        <div className="p-2 rounded-lg bg-blue-500/10">
                          <BarChart3 className="h-5 w-5 text-blue-500" />
                        </div>
                        <Badge variant="outline" className="bg-primary/20 text-primary border-primary/30">
                          EXCELLENT
                        </Badge>
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-1">
                        <div className="flex items-center justify-between">
                          <span className="text-sm font-medium text-slate-300">{metric.name}</span>
                          <span className={`text-sm font-bold ${metric.color}`}>
                            {metric.change}
                          </span>
                        </div>
                        <div className="text-2xl font-bold text-white">{metric.value}</div>
                        <Progress value={75} className="h-2" />
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>

              {/* Decision Velocity - The NFL Coach Advantage */}
              <Card className="border-emerald-500/50 bg-gradient-to-br from-emerald-950/50 to-blue-950/50 backdrop-blur-sm mb-4">
                <CardHeader>
                  <div className="flex items-center justify-between">
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Zap className="h-6 w-6 text-emerald-400" />
                      Decision Velocity Dashboard
                      <Badge variant="outline" className="bg-emerald-600/20 text-emerald-300 border-emerald-500/50 ml-2">
                        NFL COACH MODE
                      </Badge>
                    </CardTitle>
                    <Badge variant="outline" className="bg-blue-600/20 text-blue-300 border-blue-500/50">
                      80+ PLAYS READY
                    </Badge>
                  </div>
                  <p className="text-sm text-gray-300 mt-2">
                    Execute like an NFL coach: From detection to decision in minutes, not days. Your organizational playbook for high-stakes situations.
                  </p>
                </CardHeader>
                <CardContent>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {/* Average Decision Time */}
                    <div className="p-4 bg-slate-800/50 rounded-lg border border-emerald-500/30">
                      <div className="flex items-center gap-2 mb-2">
                        <Clock className="h-5 w-5 text-emerald-400" />
                        <span className="text-sm font-medium text-gray-300">Avg. Decision Time</span>
                      </div>
                      <div className="flex items-baseline gap-2">
                        <span className="text-3xl font-bold text-white">12</span>
                        <span className="text-lg text-gray-400">minutes</span>
                      </div>
                      <div className="mt-2 flex items-center gap-1">
                        <TrendingUp className="h-4 w-4 text-emerald-400" />
                        <span className="text-xs text-emerald-400">85% faster than industry avg (72 hrs)</span>
                      </div>
                    </div>

                    {/* Playbooks Executed */}
                    <div className="p-4 bg-slate-800/50 rounded-lg border border-blue-500/30">
                      <div className="flex items-center gap-2 mb-2">
                        <Target className="h-5 w-5 text-blue-400" />
                        <span className="text-sm font-medium text-gray-300">Plays Executed (30d)</span>
                      </div>
                      <div className="flex items-baseline gap-2">
                        <span className="text-3xl font-bold text-white">47</span>
                        <span className="text-lg text-gray-400">playbooks</span>
                      </div>
                      <div className="mt-2 flex items-center gap-1">
                        <CheckCircle className="h-4 w-4 text-blue-400" />
                        <span className="text-xs text-blue-400">94% execution success rate</span>
                      </div>
                    </div>

                    {/* Value Created */}
                    <div className="p-4 bg-slate-800/50 rounded-lg border border-purple-500/30">
                      <div className="flex items-center gap-2 mb-2">
                        <DollarSign className="h-5 w-5 text-purple-400" />
                        <span className="text-sm font-medium text-gray-300">Value Created (30d)</span>
                      </div>
                      <div className="flex items-baseline gap-2">
                        <span className="text-3xl font-bold text-white">$8.2M</span>
                        <span className="text-lg text-gray-400">saved</span>
                      </div>
                      <div className="mt-2 flex items-center gap-1">
                        <TrendingUp className="h-4 w-4 text-purple-400" />
                        <span className="text-xs text-purple-400">Through rapid decision execution</span>
                      </div>
                    </div>
                  </div>

                  {/* Most Used Playbooks */}
                  <div className="mt-4 p-4 bg-slate-800/30 rounded-lg border border-gray-700">
                    <h4 className="text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2">
                      <Activity className="h-4 w-4 text-gray-400" />
                      Top 5 Playbooks (This Month)
                    </h4>
                    <div className="space-y-2">
                      {[
                        { name: "Supply Chain Disruption", uses: 12, avgTime: "14 min", value: "$3.2M" },
                        { name: "Competitive Price War Response", uses: 8, avgTime: "9 min", value: "$2.1M" },
                        { name: "Cybersecurity Incident", uses: 6, avgTime: "7 min", value: "$1.4M" },
                        { name: "Executive Departure", uses: 5, avgTime: "18 min", value: "$890K" },
                        { name: "Market Opportunity", uses: 4, avgTime: "11 min", value: "$780K" }
                      ].map((playbook, idx) => (
                        <div key={idx} className="flex items-center justify-between py-2 px-3 bg-slate-700/30 rounded">
                          <div className="flex items-center gap-3">
                            <Badge variant="outline" className="text-xs w-6 h-6 flex items-center justify-center p-0">
                              {idx + 1}
                            </Badge>
                            <span className="text-sm text-white font-medium">{playbook.name}</span>
                          </div>
                          <div className="flex items-center gap-4 text-xs">
                            <span className="text-gray-400">{playbook.uses} uses</span>
                            <span className="text-emerald-400">{playbook.avgTime}</span>
                            <span className="text-purple-400 font-semibold">{playbook.value}</span>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </CardContent>
              </Card>

              {/* Strategic Scenarios Overview */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Target className="h-5 w-5 text-blue-500" />
                      Active Strategic Scenarios
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    {strategicScenarios.map((scenario, index) => (
                      <div key={index} className="p-3 bg-slate-800 rounded-lg border border-slate-600">
                        <div className="flex justify-between items-start mb-2">
                          <h4 className="font-semibold text-white">{scenario.name}</h4>
                          <div className="flex gap-2">
                            <Badge variant={scenario.status === 'active' ? 'default' : 'outline'}>
                              {scenario.status.toUpperCase()}
                            </Badge>
                            <Badge variant={scenario.risk === 'low' ? 'default' : scenario.risk === 'medium' ? 'secondary' : 'destructive'}>
                              {scenario.risk.toUpperCase()} RISK
                            </Badge>
                          </div>
                        </div>
                        <div className="space-y-1">
                          <div className="flex justify-between text-sm">
                            <span className="text-slate-300">Progress:</span>
                            <span className="text-blue-400 font-bold">{scenario.progress}%</span>
                          </div>
                          <Progress value={scenario.progress} className="h-2" />
                          <div className="flex justify-between text-sm">
                            <span className="text-slate-300">Projected ROI:</span>
                            <span className="text-green-400 font-bold">{scenario.roi}</span>
                          </div>
                        </div>
                      </div>
                    ))}
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Brain className="h-5 w-5 text-purple-500" />
                      AI Strategic Recommendations
                      <Badge variant="outline" className="ml-2">Powered by ML</Badge>
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    {aiRecommendations.slice(0, 2).map((rec) => (
                      <Card key={rec.id} className="border-l-4 border-l-purple-500 bg-slate-800">
                        <CardContent className="p-3">
                          <div className="flex justify-between items-start mb-2">
                            <Badge variant={rec.priority === 'critical' ? 'destructive' : rec.priority === 'high' ? 'default' : 'secondary'}>
                              {rec.priority.toUpperCase()}
                            </Badge>
                            <div className="flex items-center gap-1">
                              <Brain className="h-4 w-4 text-purple-600" />
                              <span className="text-xs text-gray-400">{rec.confidence}% confidence</span>
                            </div>
                          </div>
                          <h4 className="font-semibold text-sm mb-2 text-white">{rec.title}</h4>
                          <p className="text-xs text-slate-300 mb-3">{rec.description}</p>
                          <div className="space-y-1">
                            <div className="flex items-center gap-2">
                              <span className="text-sm font-medium text-green-400">{rec.impact}</span>
                            </div>
                            <div className="text-xs text-slate-200">
                              {rec.timeframe}  {rec.dataPoints.toLocaleString()} data points
                            </div>
                          </div>
                        </CardContent>
                      </Card>
                    ))}
                  </CardContent>
                </Card>
              </div>

              {/* Executive Performance Dashboard */}
              <Card className="bg-gradient-to-r from-blue-600 to-purple-600 text-white">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-xl">
                    <TrendingUp className="h-6 w-6" />
                    Executive Performance Dashboard
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                    <div className="text-center">
                      <p className="text-3xl font-bold">{executiveMetrics.strategicAlignment}%</p>
                      <p className="text-sm opacity-90">Strategic Alignment</p>
                    </div>
                    <div className="text-center">
                      <p className="text-3xl font-bold">{executiveMetrics.operationalEfficiency}%</p>
                      <p className="text-sm opacity-90">Operational Efficiency</p>
                    </div>
                    <div className="text-center">
                      <p className="text-3xl font-bold">{executiveMetrics.financialPerformance}%</p>
                      <p className="text-sm opacity-90">Financial Performance</p>
                    </div>
                    <div className="text-center">
                      <p className="text-3xl font-bold">{executiveMetrics.innovationIndex}%</p>
                      <p className="text-sm opacity-90">Innovation Index</p>
                    </div>
                    <div className="text-center">
                      <p className="text-3xl font-bold">{executiveMetrics.riskManagement}%</p>
                      <p className="text-sm opacity-90">Risk Management</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            <TabsContent value="crisis" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="crisis-content">
              {/* Executive Playbook Control Panel */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <Card className="border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-950">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-red-800 dark:text-red-200">
                      <AlertTriangle className="h-5 w-5" />
                      Emergency Response Center
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <Button className="w-full bg-red-600 hover:bg-red-700 text-white">
                      <AlertTriangle className="h-4 w-4 mr-2" />
                      Execute Playbook
                    </Button>
                    <div className="grid grid-cols-2 gap-4">
                      <div className="text-center p-3 bg-white dark:bg-red-900 rounded">
                        <div className="text-2xl font-bold text-red-600">24/7</div>
                        <div className="text-sm text-red-800 dark:text-red-200">Command Center</div>
                      </div>
                      <div className="text-center p-3 bg-white dark:bg-red-900 rounded">
                        <div className="text-2xl font-bold text-red-600">15+</div>
                        <div className="text-sm text-red-800 dark:text-red-200">Response Templates</div>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="text-white">Executive Playbooks Library</CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    {executivePlaybooks.map((playbook, index) => (
                      <Link key={index} href="/comprehensive-scenarios">
                        <div className="p-3 bg-slate-800 rounded-lg border border-slate-600 hover:border-blue-500 cursor-pointer transition-colors">
                          <div className="flex justify-between items-start mb-2">
                            <div>
                              <span className="text-xs text-gray-400 font-mono">{playbook.playbookId}</span>
                              <h4 className="font-semibold text-white">{playbook.name}</h4>
                            </div>
                            <Badge variant={playbook.severity === 'critical' ? 'destructive' : playbook.severity === 'high' ? 'default' : 'secondary'}>
                              {playbook.severity.toUpperCase()}
                            </Badge>
                          </div>
                          <div className="text-sm text-slate-300 space-y-1">
                            <div>Execution Time: {playbook.activationTime}</div>
                            <div>Team Size: {playbook.stakeholders}</div>
                          </div>
                        </div>
                      </Link>
                    ))}
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="strategic" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="strategic-content">
              {/* Strategic Planning Command Center */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Target className="h-5 w-5 text-blue-500" />
                      Strategic Initiative Portfolio
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    {strategicScenarios.map((scenario, index) => (
                      <div key={index} className="p-3 bg-slate-800 rounded-lg border border-slate-600">
                        <div className="flex justify-between items-start mb-2">
                          <h4 className="font-semibold text-white text-sm">{scenario.name}</h4>
                          <div className="flex gap-1">
                            <Badge variant={scenario.status === 'active' ? 'default' : 'outline'} className="text-xs">
                              {scenario.status.toUpperCase()}
                            </Badge>
                            <Badge variant={scenario.risk === 'low' ? 'default' : scenario.risk === 'medium' ? 'secondary' : 'destructive'} className="text-xs">
                              {scenario.risk.toUpperCase()}
                            </Badge>
                          </div>
                        </div>
                        <div className="space-y-1">
                          <div className="flex justify-between text-xs">
                            <span className="text-slate-300">Progress:</span>
                            <span className="text-blue-400 font-bold">{scenario.progress}%</span>
                          </div>
                          <Progress value={scenario.progress} className="h-1" />
                          <div className="flex justify-between text-xs">
                            <span className="text-slate-300">Expected ROI:</span>
                            <span className="text-green-400 font-bold">{scenario.roi}</span>
                          </div>
                        </div>
                      </div>
                    ))}
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <TrendingUp className="h-5 w-5 text-green-500" />
                      Enterprise Resource Allocation
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                      <div className="text-center p-3 bg-slate-800 rounded">
                        <div className="text-xl font-bold text-blue-400">$4.2M</div>
                        <div className="text-xs text-slate-300">Active Budget</div>
                      </div>
                      <div className="text-center p-3 bg-slate-800 rounded">
                        <div className="text-xl font-bold text-green-400">189</div>
                        <div className="text-xs text-slate-300">Team Members</div>
                      </div>
                    </div>
                    <div className="space-y-3">
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Budget Utilization</span>
                          <span className="text-blue-400 font-bold">73%</span>
                        </div>
                        <Progress value={73} className="h-2" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Resource Efficiency</span>
                          <span className="text-green-400 font-bold">94%</span>
                        </div>
                        <Progress value={94} className="h-2" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Timeline Adherence</span>
                          <span className="text-orange-400 font-bold">82%</span>
                        </div>
                        <Progress value={82} className="h-2" />
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>

              {/* Strategic Planning Tools */}
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Calendar className="h-5 w-5 text-purple-500" />
                      Strategic Timeline
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Q1 2025 Strategy Review</div>
                        <div className="text-xs text-slate-200">Due in 14 days  High Priority</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Market Expansion Phase 2</div>
                        <div className="text-xs text-slate-200">Due in 28 days  Medium Priority</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Innovation Lab Launch</div>
                        <div className="text-xs text-slate-200">Due in 45 days  High Priority</div>
                      </div>
                    </div>
                    <Button className="w-full bg-purple-600 hover:bg-purple-700 text-xs">
                      <Calendar className="h-3 w-3 mr-1" />
                      View Full Timeline
                    </Button>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Users className="h-5 w-5 text-blue-500" />
                      Stakeholder Management
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div className="flex justify-between items-center">
                        <span className="text-slate-300 text-sm">Executive Sponsors</span>
                        <span className="text-blue-400 font-bold">12</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-300 text-sm">Department Heads</span>
                        <span className="text-green-400 font-bold">34</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-300 text-sm">Key Contributors</span>
                        <span className="text-purple-400 font-bold">167</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-300 text-sm">Engagement Score</span>
                        <span className="text-orange-400 font-bold">89%</span>
                      </div>
                    </div>
                    <Button className="w-full bg-blue-600 hover:bg-blue-700 text-xs">
                      <Users className="h-3 w-3 mr-1" />
                      Manage Stakeholders
                    </Button>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <BarChart3 className="h-5 w-5 text-green-500" />
                      Success Metrics
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-200">Strategic Alignment</span>
                          <span className="text-green-400 font-bold">91%</span>
                        </div>
                        <Progress value={91} className="h-1" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-200">Execution Quality</span>
                          <span className="text-blue-400 font-bold">87%</span>
                        </div>
                        <Progress value={87} className="h-1" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-200">Value Delivery</span>
                          <span className="text-purple-400 font-bold">94%</span>
                        </div>
                        <Progress value={94} className="h-1" />
                      </div>
                    </div>
                    <Button className="w-full bg-green-600 hover:bg-green-700 text-xs">
                      <TrendingUp className="h-3 w-3 mr-1" />
                      View Details
                    </Button>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="templates" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="templates-content">
              <ScenarioTemplateLibrary organizationId={organizations && Array.isArray(organizations) && organizations.length > 0 ? organizations[0].id : "default-org"} />
            </TabsContent>

            <TabsContent value="ai-intelligence" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="ai-content">
              <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                {aiModules.map((module, index) => (
                  <Card key={index} className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-white">
                        <Brain className="h-5 w-5 text-purple-500" />
                        {module.name}
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-3">
                      <p className="text-slate-200 text-sm">{module.description}</p>
                      <div className="flex justify-between items-center">
                        <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30">
                          {module.status.toUpperCase()}
                        </Badge>
                        <span className="text-white font-bold">{module.accuracy}%</span>
                      </div>
                      <Progress value={module.accuracy} className="h-2" />
                    </CardContent>
                  </Card>
                ))}
              </div>
            </TabsContent>

            <TabsContent value="collaboration" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="collaboration-content">
              {/* Real-time Collaboration Hub */}
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Users className="h-5 w-5 text-blue-500" />
                      Real-Time Collaboration
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="text-slate-200">
                      <div className="flex justify-between mb-2">
                        <span>Active Users:</span>
                        <span className="text-green-400 font-bold">{collaborationData.activeUsers}</span>
                      </div>
                      <div className="flex justify-between mb-2">
                        <span>Live Sessions:</span>
                        <span className="text-blue-400 font-bold">{collaborationData.liveSessions}</span>
                      </div>
                      <div className="grid grid-cols-2 gap-2 mt-4">
                        <Button className="bg-blue-600 hover:bg-blue-700 text-xs">
                          <MessageSquare className="h-3 w-3 mr-1" />
                          War Room
                        </Button>
                        <Button variant="outline" className="text-xs border-gray-600">
                          <Eye className="h-3 w-3 mr-1" />
                          Monitor
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Globe className="h-5 w-5 text-green-500" />
                      Global Teams
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="text-slate-200 text-sm space-y-2">
                      <div className="flex justify-between items-center">
                        <span>North America:</span>
                        <div className="flex items-center gap-2">
                          <span className="text-green-400"></span>
                          <span className="text-white font-bold">{collaborationData.globalTeams.northAmerica.users}</span>
                        </div>
                      </div>
                      <div className="flex justify-between items-center">
                        <span>Europe:</span>
                        <div className="flex items-center gap-2">
                          <span className="text-green-400"></span>
                          <span className="text-white font-bold">{collaborationData.globalTeams.europe.users}</span>
                        </div>
                      </div>
                      <div className="flex justify-between items-center">
                        <span>Asia Pacific:</span>
                        <div className="flex items-center gap-2">
                          <span className="text-green-400"></span>
                          <span className="text-white font-bold">{collaborationData.globalTeams.asiaPacific.users}</span>
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Activity className="h-5 w-5 text-purple-500" />
                      Live Activity Feed
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    {collaborationData.recentActivity.map((activity, index) => (
                      <div key={index} className="text-sm">
                        <div className="text-white font-medium">{activity.user}</div>
                        <div className="text-slate-300">{activity.action}</div>
                        <div className="text-xs text-slate-200">{activity.time}</div>
                      </div>
                    ))}
                  </CardContent>
                </Card>
              </div>

              {/* Communication Tools */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <MessageSquare className="h-5 w-5 text-blue-500" />
                      Executive Communication Center
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-2 gap-3">
                      <Button className="bg-red-600 hover:bg-red-700">
                        <AlertTriangle className="h-4 w-4 mr-2" />
                        Emergency Broadcast
                      </Button>
                      <Button className="bg-blue-600 hover:bg-blue-700">
                        <Users className="h-4 w-4 mr-2" />
                        Team Assembly
                      </Button>
                      <Button className="bg-green-600 hover:bg-green-700">
                        <CheckCircle className="h-4 w-4 mr-2" />
                        Status Update
                      </Button>
                      <Button className="bg-purple-600 hover:bg-purple-700">
                        <Calendar className="h-4 w-4 mr-2" />
                        Schedule Meeting
                      </Button>
                    </div>
                    <div className="mt-4 p-3 bg-slate-800 rounded-lg">
                      <div className="text-sm text-slate-300">
                        <div className="flex justify-between mb-1">
                          <span>Messages Today:</span>
                          <span className="text-blue-400 font-bold">147</span>
                        </div>
                        <div className="flex justify-between mb-1">
                          <span>Urgent Alerts:</span>
                          <span className="text-red-400 font-bold">3</span>
                        </div>
                        <div className="flex justify-between">
                          <span>Response Rate:</span>
                          <span className="text-green-400 font-bold">94%</span>
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Network className="h-5 w-5 text-orange-500" />
                      Cross-Functional Integration
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="space-y-3">
                      <div className="flex justify-between items-center p-2 bg-slate-800 rounded">
                        <span className="text-slate-300">Operations Team</span>
                        <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30">SYNC</Badge>
                      </div>
                      <div className="flex justify-between items-center p-2 bg-slate-800 rounded">
                        <span className="text-slate-300">Finance Department</span>
                        <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30">SYNC</Badge>
                      </div>
                      <div className="flex justify-between items-center p-2 bg-slate-800 rounded">
                        <span className="text-slate-300">Legal & Compliance</span>
                        <Badge variant="outline" className="bg-yellow-500/20 text-yellow-400 border-yellow-500/30">PENDING</Badge>
                      </div>
                      <div className="flex justify-between items-center p-2 bg-slate-800 rounded">
                        <span className="text-slate-300">Technology Team</span>
                        <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30">SYNC</Badge>
                      </div>
                    </div>
                    <Button className="w-full bg-orange-600 hover:bg-orange-700">
                      <Network className="h-4 w-4 mr-2" />
                      Initiate Cross-Sync
                    </Button>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="audit" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="audit-content">
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Shield className="h-5 w-5 text-red-500" />
                      Compliance Status
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-center">
                      <div className="text-3xl font-bold text-green-400">98.7%</div>
                      <div className="text-slate-300">Compliance Score</div>
                      <Progress value={98.7} className="h-2 mt-2" />
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <FileText className="h-5 w-5 text-blue-500" />
                      Audit Logs
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-slate-200 text-sm space-y-2">
                      <div>Last Audit: 2 days ago</div>
                      <div>Next Review: 28 days</div>
                      <div>Active Findings: 0</div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <CheckCircle className="h-5 w-5 text-green-500" />
                      Certifications
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-slate-300 text-sm space-y-1">
                      <div>SOX Compliance </div>
                      <div>ISO 27001 </div>
                      <div>GDPR Ready </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="integrations" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="integrations-content">
              {/* Enterprise Integration Hub */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Network className="h-5 w-5 text-blue-500" />
                      Enterprise System Integrations
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="grid grid-cols-1 gap-2">
                      <div className="flex justify-between items-center p-2 bg-slate-800 rounded">
                        <span className="text-slate-300">SAP ERP</span>
                        <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30">ACTIVE</Badge>
                      </div>
                      <div className="flex justify-between items-center p-2 bg-slate-800 rounded">
                        <span className="text-slate-300">Salesforce CRM</span>
                        <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30">ACTIVE</Badge>
                      </div>
                      <div className="flex justify-between items-center p-2 bg-slate-800 rounded">
                        <span className="text-slate-300">Microsoft Dynamics</span>
                        <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30">ACTIVE</Badge>
                      </div>
                      <div className="flex justify-between items-center p-2 bg-slate-800 rounded">
                        <span className="text-slate-300">Oracle Database</span>
                        <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30">ACTIVE</Badge>
                      </div>
                      <div className="flex justify-between items-center p-2 bg-slate-800 rounded">
                        <span className="text-slate-300">Tableau Analytics</span>
                        <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30">ACTIVE</Badge>
                      </div>
                      <div className="flex justify-between items-center p-2 bg-slate-800 rounded">
                        <span className="text-slate-300">Slack Workspace</span>
                        <Badge variant="outline" className="bg-yellow-500/20 text-yellow-400 border-yellow-500/30">SYNC</Badge>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Settings className="h-5 w-5 text-purple-500" />
                      API & Data Management
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                      <div className="text-center p-3 bg-slate-800 rounded">
                        <div className="text-xl font-bold text-blue-400">47</div>
                        <div className="text-xs text-slate-300">Active APIs</div>
                      </div>
                      <div className="text-center p-3 bg-slate-800 rounded">
                        <div className="text-xl font-bold text-green-400">99.97%</div>
                        <div className="text-xs text-slate-300">Uptime SLA</div>
                      </div>
                    </div>
                    <div className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Data Flow Rate:</span>
                        <span className="text-blue-400 font-bold">2.4TB/hour</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">API Calls/min:</span>
                        <span className="text-green-400 font-bold">34,672</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Error Rate:</span>
                        <span className="text-orange-400 font-bold">0.03%</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Data Quality Score:</span>
                        <span className="text-purple-400 font-bold">96.8%</span>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>

              {/* Integration Tools */}
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Zap className="h-5 w-5 text-yellow-500" />
                      Workflow Automation
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Auto-sync Financial Data</div>
                        <div className="text-xs text-slate-200">Every 15 minutes</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Customer Data Pipeline</div>
                        <div className="text-xs text-slate-200">Real-time</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Inventory Updates</div>
                        <div className="text-xs text-slate-200">Hourly</div>
                      </div>
                    </div>
                    <Button className="w-full bg-yellow-600 hover:bg-yellow-700 text-xs">
                      <Zap className="h-3 w-3 mr-1" />
                      Manage Workflows
                    </Button>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Shield className="h-5 w-5 text-red-500" />
                      Security & Compliance
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div className="flex justify-between items-center">
                        <span className="text-slate-300 text-sm">OAuth 2.0 Auth</span>
                        <CheckCircle className="h-4 w-4 text-green-400" />
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-300 text-sm">End-to-End Encryption</span>
                        <CheckCircle className="h-4 w-4 text-green-400" />
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-300 text-sm">Data Masking</span>
                        <CheckCircle className="h-4 w-4 text-green-400" />
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-slate-300 text-sm">Audit Logging</span>
                        <CheckCircle className="h-4 w-4 text-green-400" />
                      </div>
                    </div>
                    <Button className="w-full bg-red-600 hover:bg-red-700 text-xs">
                      <Shield className="h-3 w-3 mr-1" />
                      Security Settings
                    </Button>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Activity className="h-5 w-5 text-green-500" />
                      Real-time Monitoring
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">System Load</span>
                          <span className="text-blue-400 font-bold">67%</span>
                        </div>
                        <Progress value={67} className="h-1" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Network Latency</span>
                          <span className="text-green-400 font-bold">12ms</span>
                        </div>
                        <Progress value={88} className="h-1" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Data Sync Status</span>
                          <span className="text-purple-400 font-bold">98%</span>
                        </div>
                        <Progress value={98} className="h-1" />
                      </div>
                    </div>
                    <Button className="w-full bg-green-600 hover:bg-green-700 text-xs">
                      <Activity className="h-3 w-3 mr-1" />
                      View Dashboard
                    </Button>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="analytics" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="analytics-content">
              {/* Advanced Analytics Control Center */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <PieChart className="h-5 w-5 text-green-500" />
                      Predictive Analytics Engine
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                      <div className="text-center p-3 bg-slate-800 rounded">
                        <div className="text-xl font-bold text-green-400">94.7%</div>
                        <div className="text-xs text-slate-300">Prediction Accuracy</div>
                      </div>
                      <div className="text-center p-3 bg-slate-800 rounded">
                        <div className="text-xl font-bold text-blue-400">2.4M</div>
                        <div className="text-xs text-slate-300">Data Points</div>
                      </div>
                    </div>
                    <div className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Market Forecasting:</span>
                        <span className="text-green-400 font-bold">96.2%</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Risk Prediction:</span>
                        <span className="text-blue-400 font-bold">93.8%</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Revenue Projection:</span>
                        <span className="text-purple-400 font-bold">92.1%</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Customer Behavior:</span>
                        <span className="text-orange-400 font-bold">89.6%</span>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <BarChart3 className="h-5 w-5 text-blue-500" />
                      Business Intelligence Hub
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                      <div className="text-center p-3 bg-slate-800 rounded">
                        <div className="text-xl font-bold text-blue-400">67</div>
                        <div className="text-xs text-slate-300">Active Dashboards</div>
                      </div>
                      <div className="text-center p-3 bg-slate-800 rounded">
                        <div className="text-xl font-bold text-green-400">34</div>
                        <div className="text-xs text-slate-300">Data Sources</div>
                      </div>
                    </div>
                    <div className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Real-time Feeds:</span>
                        <span className="text-green-400 font-bold">18 Active</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Data Processing:</span>
                        <span className="text-blue-400 font-bold">4.7TB/day</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Query Performance:</span>
                        <span className="text-purple-400 font-bold">0.3s avg</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Data Freshness:</span>
                        <span className="text-orange-400 font-bold">Real-time</span>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>

              {/* Analytics Modules */}
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <TrendingUp className="h-5 w-5 text-purple-500" />
                      Market Intelligence
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Competitor Analysis</div>
                        <div className="text-xs text-slate-200">Updated 2 hours ago</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Market Trends</div>
                        <div className="text-xs text-slate-200">Live monitoring</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Industry Benchmarks</div>
                        <div className="text-xs text-slate-200">Daily updates</div>
                      </div>
                    </div>
                    <Button className="w-full bg-purple-600 hover:bg-purple-700 text-xs">
                      <TrendingUp className="h-3 w-3 mr-1" />
                      View Analysis
                    </Button>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Users className="h-5 w-5 text-blue-500" />
                      Customer Analytics
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Customer Satisfaction</span>
                          <span className="text-green-400 font-bold">94.8%</span>
                        </div>
                        <Progress value={94.8} className="h-1" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Retention Rate</span>
                          <span className="text-blue-400 font-bold">87.3%</span>
                        </div>
                        <Progress value={87.3} className="h-1" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Churn Risk</span>
                          <span className="text-orange-400 font-bold">12.7%</span>
                        </div>
                        <Progress value={12.7} className="h-1" />
                      </div>
                    </div>
                    <Button className="w-full bg-blue-600 hover:bg-blue-700 text-xs">
                      <Users className="h-3 w-3 mr-1" />
                      Customer Insights
                    </Button>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <DollarSign className="h-5 w-5 text-green-500" />
                      Financial Analytics
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Revenue Growth:</span>
                        <span className="text-green-400 font-bold">+18.7%</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Profit Margin:</span>
                        <span className="text-blue-400 font-bold">23.4%</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Cost Efficiency:</span>
                        <span className="text-purple-400 font-bold">+12.1%</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">ROI:</span>
                        <span className="text-orange-400 font-bold">267%</span>
                      </div>
                    </div>
                    <Button className="w-full bg-green-600 hover:bg-green-700 text-xs">
                      <DollarSign className="h-3 w-3 mr-1" />
                      Financial Reports
                    </Button>
                  </CardContent>
                </Card>
              </div>

              {/* Advanced Analytics Tools */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Brain className="h-5 w-5 text-purple-500" />
                      Machine Learning Models
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="space-y-3">
                      <div className="p-3 bg-slate-800 rounded">
                        <div className="flex justify-between items-center mb-2">
                          <span className="text-white font-medium text-sm">Revenue Forecasting Model</span>
                          <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30 text-xs">ACTIVE</Badge>
                        </div>
                        <div className="text-xs text-slate-200">Accuracy: 96.2%  Last trained: 2 days ago</div>
                      </div>
                      <div className="p-3 bg-slate-800 rounded">
                        <div className="flex justify-between items-center mb-2">
                          <span className="text-white font-medium text-sm">Customer Churn Prediction</span>
                          <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30 text-xs">ACTIVE</Badge>
                        </div>
                        <div className="text-xs text-slate-200">Accuracy: 89.7%  Last trained: 1 day ago</div>
                      </div>
                      <div className="p-3 bg-slate-800 rounded">
                        <div className="flex justify-between items-center mb-2">
                          <span className="text-white font-medium text-sm">Market Risk Assessment</span>
                          <Badge variant="outline" className="bg-yellow-500/20 text-yellow-400 border-yellow-500/30 text-xs">TRAINING</Badge>
                        </div>
                        <div className="text-xs text-slate-200">Accuracy: 93.4%  Training in progress</div>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Activity className="h-5 w-5 text-blue-500" />
                      Real-time Analytics Feed
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="space-y-2 max-h-48 overflow-y-auto">
                      <div className="text-xs text-slate-300 p-2 bg-slate-800 rounded">
                        <div className="text-white font-medium">Revenue spike detected</div>
                        <div className="text-slate-200">+23% above forecast  2 minutes ago</div>
                      </div>
                      <div className="text-xs text-slate-300 p-2 bg-slate-800 rounded">
                        <div className="text-white font-medium">Customer engagement surge</div>
                        <div className="text-slate-200">Mobile app activity +45%  5 minutes ago</div>
                      </div>
                      <div className="text-xs text-slate-300 p-2 bg-slate-800 rounded">
                        <div className="text-white font-medium">Market trend shift identified</div>
                        <div className="text-slate-200">Tech sector momentum +12%  8 minutes ago</div>
                      </div>
                      <div className="text-xs text-slate-300 p-2 bg-slate-800 rounded">
                        <div className="text-white font-medium">Cost optimization opportunity</div>
                        <div className="text-slate-200">Supply chain efficiency +7%  12 minutes ago</div>
                      </div>
                    </div>
                    <Button className="w-full bg-blue-600 hover:bg-blue-700 text-xs">
                      <Activity className="h-3 w-3 mr-1" />
                      View All Alerts
                    </Button>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="scenario-triggers" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="scenario-triggers-content">
              {/* Enterprise Trigger Management System */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Zap className="h-5 w-5 text-yellow-500" />
                      Intelligent Trigger Engine
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                      <div className="text-center p-3 bg-slate-800 rounded">
                        <div className="text-xl font-bold text-yellow-400">47</div>
                        <div className="text-xs text-slate-300">Active Triggers</div>
                      </div>
                      <div className="text-center p-3 bg-slate-800 rounded">
                        <div className="text-xl font-bold text-green-400">12</div>
                        <div className="text-xs text-slate-300">Triggered Today</div>
                      </div>
                    </div>
                    <div className="space-y-2">
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Success Rate:</span>
                        <span className="text-green-400 font-bold">99.8%</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">Avg Response Time:</span>
                        <span className="text-blue-400 font-bold">147ms</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-slate-300">False Positives:</span>
                        <span className="text-orange-400 font-bold">0.2%</span>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Activity className="h-5 w-5 text-blue-500" />
                      Real-time Trigger Dashboard
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="space-y-3">
                      <div className="p-3 bg-slate-800 rounded">
                        <div className="flex justify-between items-center mb-2">
                          <span className="text-white font-medium text-sm">Market Volatility Alert</span>
                          <Badge variant="outline" className="bg-red-500/20 text-red-400 border-red-500/30 text-xs">ACTIVE</Badge>
                        </div>
                        <div className="text-xs text-slate-200">Threshold: &gt;15% change  Last trigger: 2 hours ago</div>
                      </div>
                      <div className="p-3 bg-slate-800 rounded">
                        <div className="flex justify-between items-center mb-2">
                          <span className="text-white font-medium text-sm">Revenue Target Monitor</span>
                          <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30 text-xs">ACTIVE</Badge>
                        </div>
                        <div className="text-xs text-slate-200">Threshold: 95% of monthly target  Status: On track</div>
                      </div>
                      <div className="p-3 bg-slate-800 rounded">
                        <div className="flex justify-between items-center mb-2">
                          <span className="text-white font-medium text-sm">Customer Churn Risk</span>
                          <Badge variant="outline" className="bg-yellow-500/20 text-yellow-400 border-yellow-500/30 text-xs">MONITORING</Badge>
                        </div>
                        <div className="text-xs text-slate-200">ML Model confidence: 94%  Risk threshold: &gt;20%</div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>

              {/* Trigger Categories */}
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <DollarSign className="h-5 w-5 text-green-500" />
                      Financial Triggers
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Revenue Threshold Alert</div>
                        <div className="text-xs text-slate-200">Trigger when below 90% of target</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Cash Flow Warning</div>
                        <div className="text-xs text-slate-200">Monitor liquidity ratios</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Cost Overrun Detection</div>
                        <div className="text-xs text-slate-200">Budget variance &gt;15%</div>
                      </div>
                    </div>
                    <Button className="w-full bg-green-600 hover:bg-green-700 text-xs">
                      <DollarSign className="h-3 w-3 mr-1" />
                      Manage Financial Triggers
                    </Button>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <AlertTriangle className="h-5 w-5 text-red-500" />
                      Operational Triggers
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">System Performance</div>
                        <div className="text-xs text-slate-200">Response time &gt;2s threshold</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Supply Chain Disruption</div>
                        <div className="text-xs text-slate-200">Vendor delivery delays</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Quality Control Alert</div>
                        <div className="text-xs text-slate-200">Defect rate &gt;3%</div>
                      </div>
                    </div>
                    <Button className="w-full bg-red-600 hover:bg-red-700 text-xs">
                      <Settings className="h-3 w-3 mr-1" />
                      Configure Operations
                    </Button>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Target className="h-5 w-5 text-blue-500" />
                      Strategic Triggers
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="space-y-2">
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Market Share Changes</div>
                        <div className="text-xs text-slate-200">Competitor activity detection</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Customer Sentiment</div>
                        <div className="text-xs text-slate-200">NPS score below 7.0</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded text-sm">
                        <div className="text-white font-medium">Innovation Opportunity</div>
                        <div className="text-xs text-slate-200">Technology trend analysis</div>
                      </div>
                    </div>
                    <Button className="w-full bg-blue-600 hover:bg-blue-700 text-xs">
                      <Target className="h-3 w-3 mr-1" />
                      Strategic Settings
                    </Button>
                  </CardContent>
                </Card>
              </div>

              {/* Advanced Trigger Management */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Brain className="h-5 w-5 text-purple-500" />
                      AI-Powered Trigger Learning
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="space-y-3">
                      <div className="p-3 bg-slate-800 rounded">
                        <div className="flex justify-between items-center mb-2">
                          <span className="text-white font-medium text-sm">Pattern Recognition Model</span>
                          <Badge variant="outline" className="bg-purple-500/20 text-purple-400 border-purple-500/30 text-xs">LEARNING</Badge>
                        </div>
                        <div className="text-xs text-slate-200">Analyzing 47,892 historical trigger events</div>
                        <Progress value={73} className="h-1 mt-2" />
                      </div>
                      <div className="p-3 bg-slate-800 rounded">
                        <div className="flex justify-between items-center mb-2">
                          <span className="text-white font-medium text-sm">Predictive Trigger Engine</span>
                          <Badge variant="outline" className="bg-green-500/20 text-green-400 border-green-500/30 text-xs">ACTIVE</Badge>
                        </div>
                        <div className="text-xs text-slate-200">Accuracy: 94.7%  Last updated: 2 hours ago</div>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Clock className="h-5 w-5 text-orange-500" />
                      Recent Trigger Activity
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="space-y-2 max-h-48 overflow-y-auto">
                      <div className="text-xs text-slate-300 p-2 bg-slate-800 rounded">
                        <div className="text-white font-medium">Market volatility trigger activated</div>
                        <div className="text-slate-200">Backup supplier activated  2 hours ago</div>
                      </div>
                      <div className="text-xs text-slate-300 p-2 bg-slate-800 rounded">
                        <div className="text-white font-medium">Performance threshold reached</div>
                        <div className="text-slate-200">Revenue target achieved  5 hours ago</div>
                      </div>
                      <div className="text-xs text-slate-300 p-2 bg-slate-800 rounded">
                        <div className="text-white font-medium">Customer satisfaction spike</div>
                        <div className="text-slate-200">NPS increased to 9.2  8 hours ago</div>
                      </div>
                    </div>
                    <Button className="w-full bg-orange-600 hover:bg-orange-700 text-xs">
                      <Clock className="h-3 w-3 mr-1" />
                      View Full Activity Log
                    </Button>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="c-suite-copilot" className="flex-1 overflow-y-auto p-3 space-y-3" data-testid="copilot-content">
              {/* Executive Co-pilot Header */}
              <Card className="bg-gradient-to-r from-purple-600 to-pink-600 text-white">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-xl">
                    <Command className="h-6 w-6" />
                    Executive Strategic Co-pilot
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div className="text-center">
                      <div className="text-2xl font-bold">24/7</div>
                      <div className="text-sm opacity-90">AI Assistant</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl font-bold">97.3%</div>
                      <div className="text-sm opacity-90">Accuracy Rate</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl font-bold">156</div>
                      <div className="text-sm opacity-90">Decisions Supported</div>
                    </div>
                  </div>
                  <Button className="w-full mt-4 bg-white text-purple-600 hover:bg-gray-100">
                    <Brain className="h-4 w-4 mr-2" />
                    Launch Executive Assistant
                  </Button>
                </CardContent>
              </Card>

              {/* Advanced AI Recommendations */}
              <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-white">
                    <Brain className="h-5 w-5 text-purple-500" />
                    Advanced AI Strategic Recommendations
                    <Badge variant="outline" className="ml-2">ML-Powered</Badge>
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                    {aiRecommendations.map((rec) => (
                      <Card key={rec.id} className="border-l-4 border-l-purple-500 bg-slate-800">
                        <CardContent className="p-4">
                          <div className="flex justify-between items-start mb-2">
                            <Badge variant={rec.priority === 'critical' ? 'destructive' : rec.priority === 'high' ? 'default' : 'secondary'}>
                              {rec.priority.toUpperCase()}
                            </Badge>
                            <div className="flex items-center gap-1">
                              <Brain className="h-4 w-4 text-purple-600" />
                              <span className="text-xs text-gray-400">{rec.confidence}% confidence</span>
                            </div>
                          </div>
                          <h4 className="font-semibold text-sm mb-2 text-white">{rec.title}</h4>
                          <p className="text-xs text-slate-300 mb-3">{rec.description}</p>
                          <div className="space-y-1">
                            <div className="flex items-center gap-2">
                              <span className="text-sm font-medium text-green-400">{rec.impact}</span>
                            </div>
                            <div className="flex items-center gap-2">
                              <Clock className="h-4 w-4 text-blue-600" />
                              <span className="text-sm text-slate-300">{rec.timeframe}</span>
                            </div>
                            <div className="text-xs text-slate-200">
                              Model: {rec.mlModel}  {rec.dataPoints.toLocaleString()} data points
                            </div>
                          </div>
                        </CardContent>
                      </Card>
                    ))}
                  </div>
                </CardContent>
              </Card>

              {/* Executive Command Center */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <Command className="h-5 w-5 text-blue-500" />
                      Executive Command Center
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="grid grid-cols-2 gap-3">
                      <Button className="bg-red-600 hover:bg-red-700">
                        <AlertTriangle className="h-4 w-4 mr-2" />
                        Crisis Mode
                      </Button>
                      <Button className="bg-blue-600 hover:bg-blue-700">
                        <Target className="h-4 w-4 mr-2" />
                        Strategic Session
                      </Button>
                      <Button className="bg-green-600 hover:bg-green-700">
                        <CheckCircle className="h-4 w-4 mr-2" />
                        Operations Review
                      </Button>
                      <Button className="bg-purple-600 hover:bg-purple-700">
                        <Brain className="h-4 w-4 mr-2" />
                        AI Insights
                      </Button>
                    </div>
                    <div className="p-3 bg-slate-800 rounded-lg">
                      <div className="text-sm text-slate-300 space-y-1">
                        <div className="flex justify-between">
                          <span>Executive Alerts:</span>
                          <span className="text-red-400 font-bold">2</span>
                        </div>
                        <div className="flex justify-between">
                          <span>Pending Decisions:</span>
                          <span className="text-yellow-400 font-bold">7</span>
                        </div>
                        <div className="flex justify-between">
                          <span>Action Items:</span>
                          <span className="text-blue-400 font-bold">23</span>
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="border-gray-700/50 bg-gray-900/50 backdrop-blur-sm">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-white">
                      <TrendingUp className="h-5 w-5 text-green-500" />
                      Real-Time Executive KPIs
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    <div className="space-y-3">
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Revenue Growth</span>
                          <span className="text-green-400 font-bold">+24.7%</span>
                        </div>
                        <Progress value={84.7} className="h-2" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Market Share</span>
                          <span className="text-blue-400 font-bold">18.3%</span>
                        </div>
                        <Progress value={73.3} className="h-2" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Customer Satisfaction</span>
                          <span className="text-purple-400 font-bold">96.2%</span>
                        </div>
                        <Progress value={96.2} className="h-2" />
                      </div>
                      <div>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-slate-300">Operational Efficiency</span>
                          <span className="text-orange-400 font-bold">91.8%</span>
                        </div>
                        <Progress value={91.8} className="h-2" />
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>
          </Tabs>
          
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/VCPresentations.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import PageLayout from '@/components/layout/PageLayout';
import { 
  Briefcase, 
  TrendingUp, 
  DollarSign, 
  Users, 
  Target,
  Globe,
  ArrowRight,
  Download,
  Play,
  FileText,
  BarChart3,
  Presentation,
  Building2,
  Rocket,
  Crown,
  Star,
  CheckCircle,
  Clock
} from 'lucide-react';

export default function VCPresentations() {
  const investmentHighlights = [
    {
      title: "Market Opportunity",
      value: "$847B",
      subtitle: "Enterprise intelligence market size",
      growth: "+18.2% CAGR",
      color: "text-blue-600"
    },
    {
      title: "Current Traction",
      value: "178",
      subtitle: "Enterprise components deployed",
      growth: "98/100 quality score",
      color: "text-green-600"
    },
    {
      title: "Competitive Advantage",
      value: "4 min",
      subtitle: "Crisis response vs 6-month traditional",
      growth: "15,000x faster",
      color: "text-purple-600"
    },
    {
      title: "AI Accuracy",
      value: "85-92%",
      subtitle: "Strategic decision intelligence",
      growth: "Industry leading",
      color: "text-orange-600"
    }
  ];

  const pitchMaterials = [
    {
      title: "Series B Executive Deck",
      description: "Comprehensive pitch presentation for Series B funding round",
      slides: 24,
      duration: "18 min",
      status: "Ready",
      type: "Primary Deck",
      icon: <Presentation className="w-6 h-6 text-blue-500" />
    },
    {
      title: "Financial Projections Model",
      description: "5-year financial model with revenue projections and market analysis",
      slides: 12,
      duration: "8 min", 
      status: "Updated",
      type: "Financial",
      icon: <BarChart3 className="w-6 h-6 text-green-500" />
    },
    {
      title: "Product Demo Presentation",
      description: "Live platform demonstration showcasing AI intelligence and crisis response",
      slides: 16,
      duration: "12 min",
      status: "Live Demo",
      type: "Product",
      icon: <Play className="w-6 h-6 text-purple-500" />
    },
    {
      title: "Competitive Analysis Deep Dive",
      description: "Comprehensive competitive landscape and differentiation strategy",
      slides: 20,
      duration: "15 min",
      status: "Ready",
      type: "Market Analysis",
      icon: <Target className="w-6 h-6 text-red-500" />
    },
    {
      title: "Technology Architecture Overview",
      description: "Platform scalability, security architecture, and technical roadmap",
      slides: 18,
      duration: "14 min",
      status: "Ready",
      type: "Technical",
      icon: <Building2 className="w-6 h-6 text-teal-500" />
    },
    {
      title: "Market Expansion Strategy",
      description: "Go-to-market strategy and international expansion plans",
      slides: 14,
      duration: "10 min",
      status: "In Review",
      type: "Growth Strategy",
      icon: <Globe className="w-6 h-6 text-indigo-500" />
    }
  ];

  const keyInvestmentThesis = [
    "First platform to combine AI intelligence with immediate crisis response",
    "15,000x faster crisis activation than traditional consulting approaches",
    "Fortune 1000 enterprises require both strategic intelligence and crisis readiness",
    "Market-leading AI accuracy (85-92%) for strategic decision support",
    "Scalable enterprise architecture serving organizations with 10,000+ employees"
  ];

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800">
        <div className="p-8">
          {/* VC Header */}
          <div className="flex items-center justify-between mb-8">
            <div className="flex items-center space-x-4">
              <div className="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-xl flex items-center justify-center">
                <Briefcase className="w-7 h-7 text-white" />
              </div>
              <div>
                <h1 className="text-3xl font-bold text-gray-900 dark:text-white">Investor Relations Center</h1>
                <p className="text-gray-600 dark:text-gray-300">Series B Presentation Materials & Financial Projections</p>
              </div>
            </div>
            <div className="flex items-center space-x-3">
              <Badge variant="outline" className="text-yellow-600 border-yellow-500/50">
                <Star className="w-3 h-3 mr-1" />
                Series B Ready
              </Badge>
              <Badge className="bg-yellow-600 text-white">
                Investment Grade
              </Badge>
            </div>
          </div>

          {/* Investment Highlights */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            {investmentHighlights.map((highlight, index) => (
              <Card key={index} className="bg-white/90 dark:bg-slate-800/90 backdrop-blur border-slate-200 dark:border-slate-700">
                <CardHeader className="pb-3">
                  <CardTitle className="text-sm font-medium text-gray-600 dark:text-gray-400">{highlight.title}</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="text-2xl font-bold text-gray-900 dark:text-white mb-1">{highlight.value}</div>
                  <div className="text-sm text-gray-600 dark:text-gray-400 mb-1">{highlight.subtitle}</div>
                  <div className={`text-sm font-medium ${highlight.color}`}>{highlight.growth}</div>
                </CardContent>
              </Card>
            ))}
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {/* Pitch Materials Library */}
            <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
              <CardHeader>
                <CardTitle className="flex items-center text-gray-900 dark:text-white">
                  <FileText className="w-5 h-5 mr-2 text-blue-500" />
                  Series B Presentation Materials
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  {pitchMaterials.map((material, index) => (
                    <div key={index} className="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                      <div className="flex items-center space-x-3">
                        {material.icon}
                        <div>
                          <h4 className="font-semibold text-gray-900 dark:text-white">{material.title}</h4>
                          <p className="text-sm text-gray-600 dark:text-gray-400">{material.description}</p>
                          <div className="flex items-center space-x-4 text-xs text-gray-500 mt-1">
                            <span>{material.slides} slides</span>
                            <span>{material.duration}</span>
                            <Badge variant="outline">{material.type}</Badge>
                          </div>
                        </div>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Badge variant={material.status === 'Ready' ? 'default' : 'secondary'}>
                          {material.status}
                        </Badge>
                        <Button size="sm" variant="outline" data-testid={`button-download-${material.title.toLowerCase().replace(/\s+/g, '-')}`}>
                          <Download className="w-3 h-3" />
                        </Button>
                      </div>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>

            {/* Investment Thesis */}
            <Card className="bg-white/90 dark:bg-slate-800/90 backdrop-blur">
              <CardHeader>
                <CardTitle className="flex items-center text-gray-900 dark:text-white">
                  <Rocket className="w-5 h-5 mr-2 text-purple-500" />
                  Investment Thesis & Value Proposition
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4 mb-6">
                  {keyInvestmentThesis.map((point, index) => (
                    <div key={index} className="flex items-start space-x-3 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                      <CheckCircle className="w-4 h-4 mt-0.5 text-green-500 flex-shrink-0" />
                      <span className="text-sm text-gray-700 dark:text-gray-300">{point}</span>
                    </div>
                  ))}
                </div>
                
                <div className="space-y-3">
                  <Button className="w-full" data-testid="button-full-investor-package">
                    <Crown className="w-4 h-4 mr-2" />
                    Download Complete Investor Package
                  </Button>
                  <Button className="w-full" variant="outline" data-testid="button-schedule-presentation">
                    <Clock className="w-4 h-4 mr-2" />
                    Schedule Investor Presentation
                  </Button>
                </div>

                <div className="mt-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
                  <div className="flex items-center text-green-800 dark:text-green-200">
                    <TrendingUp className="w-4 h-4 mr-2" />
                    <span className="text-sm font-medium">Investment Readiness Score: 96/100</span>
                  </div>
                  <p className="text-xs text-green-700 dark:text-green-300 mt-1">
                    Platform demonstrates clear market leadership with unprecedented competitive advantages in enterprise intelligence and crisis response.
                  </p>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </PageLayout>
  );
}

========================================
FILE: client/src/pages/WhatIfAnalyzer.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Separator } from '@/components/ui/separator';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import PageLayout from '@/components/layout/PageLayout';
import OnboardingTrigger from '@/components/onboarding/OnboardingTrigger';
import {
  FlaskConical,
  TrendingUp,
  AlertTriangle,
  Target,
  Clock,
  Users,
  Zap,
  ArrowRight,
  Play,
  Save,
  Sparkles,
  CheckCircle2,
  XCircle,
  Activity,
  BarChart3,
  Rocket,
  Shield,
  DollarSign,
  Building2,
  FileText,
  Plus,
  Trash2,
  Copy,
  Download,
  Upload,
  TrendingDown,
  MapPin,
  Calendar,
  UserCheck,
  Package,
  Settings,
} from 'lucide-react';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';

interface TestCondition {
  id: string;
  label: string;
  operator: 'greater' | 'less' | 'equals' | 'between';
  value: number | string;
  value2?: number | string; // For 'between' operator
  unit?: string;
  category: 'market' | 'operational' | 'financial' | 'regulatory' | 'environmental';
}

interface ImpactAssessment {
  financial: {
    estimatedCost: number;
    revenueImpact: number;
    budgetAllocation: number;
  };
  operational: {
    affectedDepartments: string[];
    affectedRegions: string[];
    downtimeEstimate: number; // hours
  };
  reputational: {
    riskLevel: 'low' | 'medium' | 'high' | 'critical';
    stakeholderConcerns: string[];
  };
  timeline: {
    detectionToResponse: number; // minutes
    fullResolution: number; // hours
  };
}

interface ResourceRequirement {
  id: string;
  type: 'personnel' | 'budget' | 'technology' | 'external';
  name: string;
  quantity: number;
  estimatedCost: number;
  availability: 'available' | 'limited' | 'unavailable';
}

interface StakeholderGroup {
  id: string;
  name: string;
  role: string;
  priority: 'high' | 'medium' | 'low';
  communicationChannel: string;
}

interface AnalysisResult {
  triggeredAlerts: Array<{ id: string; name: string; severity: string }>;
  recommendedPlaybooks: Array<{ 
    id: string; 
    name: string; 
    executionTime: number; 
    readinessState: string;
    automationCoverage?: number;
  }>;
  projectedExecutionTime: number;
  teamsInvolved: Array<{ name: string; role: string }>;
  decisionVelocityMetrics: {
    ourTime: number;
    industryAverage: number;
    timeSaved: number;
    percentageFaster: number;
  };
  impactScore: number;
  confidenceLevel: number;
}

export default function WhatIfAnalyzer() {
  const { toast } = useToast();
  
  // Basic Info
  const [analysisName, setAnalysisName] = useState('');
  const [analysisDescription, setAnalysisDescription] = useState('');
  const [scenarioType, setScenarioType] = useState<string>('');
  const [industry, setIndustry] = useState<string>('');
  
  // Test Conditions
  const [conditions, setConditions] = useState<TestCondition[]>([]);
  const [newCondition, setNewCondition] = useState<{
    label: string;
    operator: 'greater' | 'less' | 'equals' | 'between';
    value: string;
    value2: string;
    unit: string;
    category: 'market' | 'operational' | 'financial' | 'regulatory' | 'environmental';
  }>({
    label: '',
    operator: 'greater',
    value: '',
    value2: '',
    unit: '',
    category: 'market',
  });

  // Impact Assessment
  const [impactAssessment, setImpactAssessment] = useState<ImpactAssessment>({
    financial: {
      estimatedCost: 0,
      revenueImpact: 0,
      budgetAllocation: 0,
    },
    operational: {
      affectedDepartments: [],
      affectedRegions: [],
      downtimeEstimate: 0,
    },
    reputational: {
      riskLevel: 'medium',
      stakeholderConcerns: [],
    },
    timeline: {
      detectionToResponse: 12,
      fullResolution: 24,
    },
  });

  // Resources & Stakeholders
  const [resources, setResources] = useState<ResourceRequirement[]>([]);
  const [stakeholders, setStakeholders] = useState<StakeholderGroup[]>([]);
  
  // Analysis Results
  const [analysisResult, setAnalysisResult] = useState<AnalysisResult | null>(null);
  const [isAnalyzing, setIsAnalyzing] = useState(false);
  const [selectedTemplate, setSelectedTemplate] = useState<string>('');

  // Fetch organizations for activity tracking
  const { data: organizations = [] } = useQuery<any[]>({
    queryKey: ['/api/organizations'],
  });
  const organizationId = organizations[0]?.id || '95b97862-8e9d-4c4c-8609-7d8f37b68d36';

  // Fetch available triggers
  const { data: triggers = [] } = useQuery<any[]>({
    queryKey: ['/api/executive-triggers'],
  });

  // Fetch available playbooks
  const { data: playbooks = [] } = useQuery<any[]>({
    queryKey: ['/api/scenarios'],
  });

  // Fetch scenario templates
  const { data: scenarioTemplates = [] } = useQuery<any[]>({
    queryKey: ['/api/scenario-templates'],
  });

  // Fetch saved what-if scenarios
  const { data: savedScenarios = [] } = useQuery<any[]>({
    queryKey: ['/api/what-if-scenarios'],
  });

  const loadTemplate = (templateId: string) => {
    const template = scenarioTemplates.find(t => t.id === templateId);
    if (!template) return;

    setSelectedTemplate(templateId);
    setAnalysisName(template.name || '');
    setAnalysisDescription(template.description || '');
    setScenarioType(template.category || '');
    setIndustry(template.industry || '');

    // Load template conditions if available
    if (template.triggerConditions) {
      const templateConditions: TestCondition[] = [];
      Object.entries(template.triggerConditions).forEach(([key, value]: [string, any], index) => {
        templateConditions.push({
          id: `cond_${Date.now()}_${index}`,
          label: key,
          operator: value.operator || 'greater',
          value: value.value || value.threshold || '',
          unit: value.unit || '',
          category: value.category || 'market',
        });
      });
      setConditions(templateConditions);
    }

    toast({
      title: "Template Loaded",
      description: `Loaded scenario: ${template.name}`,
    });
  };

  const addCondition = () => {
    if (!newCondition.label || !newCondition.value) {
      toast({
        title: "Missing Information",
        description: "Please provide both a condition label and value",
        variant: "destructive"
      });
      return;
    }

    const condition: TestCondition = {
      id: `cond_${Date.now()}`,
      label: newCondition.label,
      operator: newCondition.operator,
      value: parseFloat(newCondition.value) || newCondition.value,
      value2: newCondition.value2 ? (parseFloat(newCondition.value2) || newCondition.value2) : undefined,
      unit: newCondition.unit,
      category: newCondition.category,
    };

    setConditions([...conditions, condition]);
    setNewCondition({ label: '', operator: 'greater', value: '', value2: '', unit: '', category: 'market' });
  };

  const removeCondition = (id: string) => {
    setConditions(conditions.filter(c => c.id !== id));
  };

  const addResource = () => {
    const newResource: ResourceRequirement = {
      id: `res_${Date.now()}`,
      type: 'personnel',
      name: '',
      quantity: 1,
      estimatedCost: 0,
      availability: 'available',
    };
    setResources([...resources, newResource]);
  };

  const updateResource = (id: string, field: keyof ResourceRequirement, value: any) => {
    setResources(resources.map(r => r.id === id ? { ...r, [field]: value } : r));
  };

  const removeResource = (id: string) => {
    setResources(resources.filter(r => r.id !== id));
  };

  const addStakeholder = () => {
    const newStakeholder: StakeholderGroup = {
      id: `stake_${Date.now()}`,
      name: '',
      role: '',
      priority: 'medium',
      communicationChannel: 'email',
    };
    setStakeholders([...stakeholders, newStakeholder]);
  };

  const updateStakeholder = (id: string, field: keyof StakeholderGroup, value: any) => {
    setStakeholders(stakeholders.map(s => s.id === id ? { ...s, [field]: value } : s));
  };

  const removeStakeholder = (id: string) => {
    setStakeholders(stakeholders.filter(s => s.id !== id));
  };

  const runAnalysis = async () => {
    if (conditions.length === 0) {
      toast({
        title: "No Conditions",
        description: "Add at least one test condition to run the analysis",
        variant: "destructive"
      });
      return;
    }

    setIsAnalyzing(true);

    try {
      const triggeredAlerts: any[] = [];
      const recommendedPlaybooksList: any[] = [];
      const teamsSet = new Set<string>();

      // Check each trigger against our test conditions
      triggers.forEach((trigger: any) => {
        const shouldTrigger = conditions.some(cond => {
          if (trigger.name?.toLowerCase().includes(cond.label.toLowerCase())) {
            return true;
          }
          if (trigger.dataSource?.toLowerCase().includes(cond.label.toLowerCase())) {
            return true;
          }
          return false;
        });

        if (shouldTrigger) {
          triggeredAlerts.push({
            id: trigger.id,
            name: trigger.name,
            severity: trigger.severity || 'medium'
          });

          if (trigger.recommendedPlaybooks && Array.isArray(trigger.recommendedPlaybooks)) {
            trigger.recommendedPlaybooks.forEach((pbId: string) => {
              const playbook = playbooks.find(p => p.id === pbId);
              if (playbook && !recommendedPlaybooksList.find(p => p.id === pbId)) {
                recommendedPlaybooksList.push({
                  id: playbook.id,
                  name: playbook.name || playbook.title,
                  executionTime: playbook.averageExecutionTime || 12,
                  readinessState: playbook.readinessState || 'green',
                  automationCoverage: playbook.automationCoverage || 75,
                });

                teamsSet.add('Crisis Response Team');
                teamsSet.add('Executive Leadership');
                
                // Add operational teams based on impact assessment
                impactAssessment.operational.affectedDepartments.forEach(dept => {
                  teamsSet.add(dept);
                });
              }
            });
          }
        }
      });

      // Calculate metrics
      const totalExecutionTime = recommendedPlaybooksList.reduce((sum, pb) => sum + pb.executionTime, 0);
      const industryAvg = 4320; // 72 hours in minutes
      const timeSaved = industryAvg - totalExecutionTime;
      const percentageFaster = Math.round((timeSaved / industryAvg) * 100);

      // Calculate impact score (0-100)
      const financialImpact = Math.min(100, (impactAssessment.financial.estimatedCost / 1000000) * 10);
      const operationalImpact = impactAssessment.operational.affectedDepartments.length * 10;
      const reputationalImpact = impactAssessment.reputational.riskLevel === 'critical' ? 40 : 
                                  impactAssessment.reputational.riskLevel === 'high' ? 30 :
                                  impactAssessment.reputational.riskLevel === 'medium' ? 20 : 10;
      const impactScore = Math.min(100, Math.round((financialImpact + operationalImpact + reputationalImpact) / 3));

      // Calculate confidence level based on data completeness
      const dataCompleteness = [
        conditions.length > 0,
        impactAssessment.financial.estimatedCost > 0,
        impactAssessment.operational.affectedDepartments.length > 0,
        resources.length > 0,
        stakeholders.length > 0,
      ].filter(Boolean).length;
      const confidenceLevel = Math.round((dataCompleteness / 5) * 100);

      const result: AnalysisResult = {
        triggeredAlerts,
        recommendedPlaybooks: recommendedPlaybooksList,
        projectedExecutionTime: totalExecutionTime,
        teamsInvolved: Array.from(teamsSet).map(name => ({ name, role: 'Response Team' })),
        decisionVelocityMetrics: {
          ourTime: totalExecutionTime,
          industryAverage: industryAvg,
          timeSaved,
          percentageFaster
        },
        impactScore,
        confidenceLevel,
      };

      setAnalysisResult(result);
      
      toast({
        title: "Analysis Complete",
        description: `Found ${triggeredAlerts.length} triggers and ${recommendedPlaybooksList.length} recommended playbooks`,
      });
    } catch (error) {
      console.error('Analysis error:', error);
      toast({
        title: "Analysis Failed",
        description: "Unable to complete the scenario analysis",
        variant: "destructive"
      });
    } finally {
      setIsAnalyzing(false);
    }
  };

  const saveScenario = async () => {
    if (!analysisName) {
      toast({
        title: "Missing Name",
        description: "Please provide a name for this scenario analysis",
        variant: "destructive"
      });
      return;
    }

    if (!analysisResult) {
      toast({
        title: "No Results",
        description: "Run the analysis first before saving",
        variant: "destructive"
      });
      return;
    }

    try {
      const testConditions: any = {};
      conditions.forEach(cond => {
        testConditions[cond.label] = {
          operator: cond.operator,
          value: cond.value,
          value2: cond.value2,
          unit: cond.unit,
          category: cond.category,
        };
      });

      await apiRequest('POST', '/api/what-if-scenarios', {
        name: analysisName,
        description: analysisDescription,
        scenarioType,
        industry,
        testConditions,
        impactAssessment,
        resources: resources.map(r => ({
          type: r.type,
          name: r.name,
          quantity: r.quantity,
          estimatedCost: r.estimatedCost,
          availability: r.availability,
        })),
        stakeholders: stakeholders.map(s => ({
          name: s.name,
          role: s.role,
          priority: s.priority,
          communicationChannel: s.communicationChannel,
        })),
        triggeredAlerts: analysisResult.triggeredAlerts.map(a => a.id),
        recommendedPlaybooks: analysisResult.recommendedPlaybooks.map(p => p.id),
        projectedExecutionTime: analysisResult.projectedExecutionTime,
        teamsInvolved: analysisResult.teamsInvolved,
        decisionVelocityMetrics: analysisResult.decisionVelocityMetrics,
        impactScore: analysisResult.impactScore,
        confidenceLevel: analysisResult.confidenceLevel,
        tags: ['what-if-analysis', scenarioType, industry].filter(Boolean)
      });

      queryClient.invalidateQueries({ queryKey: ['/api/what-if-scenarios'] });

      // Log preparedness activity
      try {
        await apiRequest('POST', '/api/preparedness/activities', {
          organizationId,
          activityType: 'scenario_practice',
          description: `Completed what-if analysis: ${analysisName}`,
          metadata: {
            scenarioType,
            industry,
            impactScore: analysisResult.impactScore,
            confidenceLevel: analysisResult.confidenceLevel,
          }
        });
        queryClient.invalidateQueries({ queryKey: [`/api/preparedness/score?organizationId=${organizationId}`] });
      } catch (activityError) {
        console.error('Activity logging failed:', activityError);
      }

      toast({
        title: "Scenario Saved",
        description: "Your what-if analysis has been saved for future reference"
      });
    } catch (error) {
      console.error('Save error:', error);
      toast({
        title: "Save Failed",
        description: "Unable to save the scenario analysis",
        variant: "destructive"
      });
    }
  };

  const saveAsTemplate = async () => {
    if (!analysisName) {
      toast({
        title: "Missing Name",
        description: "Please provide a name for this template",
        variant: "destructive"
      });
      return;
    }

    try {
      const triggerConditions: any = {};
      conditions.forEach(cond => {
        triggerConditions[cond.label] = {
          operator: cond.operator,
          threshold: cond.value,
          value: cond.value,
          unit: cond.unit,
          category: cond.category,
        };
      });

      await apiRequest('POST', '/api/scenario-templates', {
        name: analysisName,
        category: scenarioType,
        description: analysisDescription,
        industry,
        isTemplate: true,
        templateCategory: 'custom',
        likelihood: 0.5,
        impact: 'moderate',
        triggerConditions,
        responseStrategy: {
          impactAssessment,
          resources: resources.map(r => ({
            type: r.type,
            name: r.name,
            quantity: r.quantity,
            estimatedCost: r.estimatedCost,
          })),
          stakeholders: stakeholders.map(s => ({
            name: s.name,
            role: s.role,
            priority: s.priority,
          })),
        },
        requiredDataPoints: conditions.map(c => c.label),
        criticalDecisionPoints: stakeholders.filter(s => s.priority === 'high').map(s => `${s.name} approval required`),
        stakeholderMapping: stakeholders.map(s => ({
          group: s.name,
          role: s.role,
          communicationChannel: s.communicationChannel,
        })),
        resourceRequirements: resources.map(r => ({
          type: r.type,
          resource: r.name,
          quantity: r.quantity,
          cost: r.estimatedCost,
        })),
      });

      queryClient.invalidateQueries({ queryKey: ['/api/scenario-templates'] });

      // Log preparedness activity
      try {
        await apiRequest('POST', '/api/preparedness/activities', {
          organizationId,
          activityType: 'scenario_practice',
          description: `Created custom scenario template: ${analysisName}`,
          metadata: {
            scenarioType,
            industry,
            templateType: 'custom',
          }
        });
        queryClient.invalidateQueries({ queryKey: [`/api/preparedness/score?organizationId=${organizationId}`] });
      } catch (activityError) {
        console.error('Activity logging failed:', activityError);
      }

      toast({
        title: "Template Created",
        description: "Your scenario has been saved as a reusable template"
      });
    } catch (error) {
      console.error('Template save error:', error);
      toast({
        title: "Template Save Failed",
        description: "Unable to create the scenario template",
        variant: "destructive"
      });
    }
  };

  return (
    <PageLayout>
      <div className="flex-1 page-background overflow-auto bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800 p-8">
        <div className="max-w-7xl mx-auto space-y-6">
          {/* Header */}
          <div className="flex items-center justify-between">
            <div>
              <div className="flex items-center gap-3 mb-2">
                <div className="p-2 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg">
                  <FlaskConical className="h-6 w-6 text-white" />
                </div>
                <div>
                  <div className="flex items-center gap-3">
                    <h1 className="text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
                      What-If Analyzer
                    </h1>
                    <OnboardingTrigger pageId="what-if-analyzer" autoStart={true} />
                  </div>
                  <p className="text-gray-600 dark:text-gray-400">
                    Model any business situation beyond our 166 templates. Unlimited scenario testing.
                  </p>
                </div>
              </div>
            </div>
            <Badge variant="outline" className="text-purple-600 border-purple-300">
              <Sparkles className="h-3 w-3 mr-1" />
              Unlimited Scenarios
            </Badge>
          </div>

          {/* Quick Start Templates - Tier 2 Enhancement */}
          <Alert className="border-blue-400 bg-blue-50 dark:bg-blue-950/20" data-testid="alert-quick-start">
            <Sparkles className="h-5 w-5 text-blue-600" />
            <div className="ml-2">
              <div className="font-semibold text-blue-900 dark:text-blue-100">Quick Start: Popular Scenarios</div>
              <div className="text-sm text-blue-700 dark:text-blue-300">Select a template to get started in seconds, or create your own custom scenario below.</div>
            </div>
          </Alert>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-4" data-testid="quick-start-templates">
            <Card 
              className="cursor-pointer hover:border-red-400 hover:shadow-lg transition-all border-2 border-transparent"
              onClick={() => {
                setAnalysisName('Product Recall Scenario');
                setAnalysisDescription('Model the impact of a potential product recall including supply chain disruption, customer communication, and regulatory response.');
                setScenarioType('operational');
                setIndustry('manufacturing');
                toast({ title: "Template Loaded", description: "Product Recall Scenario loaded" });
              }}
              data-testid="template-product-recall"
            >
              <CardContent className="p-4 flex items-center gap-3">
                <div className="p-2 bg-red-100 dark:bg-red-900/20 rounded-lg">
                  <AlertTriangle className="h-5 w-5 text-red-600" />
                </div>
                <div>
                  <div className="font-medium text-gray-900 dark:text-white">Product Recall</div>
                  <div className="text-xs text-gray-500 dark:text-gray-400">Crisis Response</div>
                </div>
              </CardContent>
            </Card>

            <Card 
              className="cursor-pointer hover:border-amber-400 hover:shadow-lg transition-all border-2 border-transparent"
              onClick={() => {
                setAnalysisName('Supply Chain Disruption');
                setAnalysisDescription('Analyze the cascading effects of a major supplier failure or logistics disruption on operations, inventory, and customer delivery.');
                setScenarioType('operational');
                setIndustry('general');
                toast({ title: "Template Loaded", description: "Supply Chain Disruption loaded" });
              }}
              data-testid="template-supply-chain"
            >
              <CardContent className="p-4 flex items-center gap-3">
                <div className="p-2 bg-amber-100 dark:bg-amber-900/20 rounded-lg">
                  <Package className="h-5 w-5 text-amber-600" />
                </div>
                <div>
                  <div className="font-medium text-gray-900 dark:text-white">Supply Chain</div>
                  <div className="text-xs text-gray-500 dark:text-gray-400">Operational Risk</div>
                </div>
              </CardContent>
            </Card>

            <Card 
              className="cursor-pointer hover:border-green-400 hover:shadow-lg transition-all border-2 border-transparent"
              onClick={() => {
                setAnalysisName('Market Entry Analysis');
                setAnalysisDescription('Evaluate the strategic implications, competitive response, and resource requirements for entering a new market or launching a new product line.');
                setScenarioType('market');
                setIndustry('general');
                toast({ title: "Template Loaded", description: "Market Entry Analysis loaded" });
              }}
              data-testid="template-market-entry"
            >
              <CardContent className="p-4 flex items-center gap-3">
                <div className="p-2 bg-green-100 dark:bg-green-900/20 rounded-lg">
                  <TrendingUp className="h-5 w-5 text-green-600" />
                </div>
                <div>
                  <div className="font-medium text-gray-900 dark:text-white">Market Entry</div>
                  <div className="text-xs text-gray-500 dark:text-gray-400">Strategic Growth</div>
                </div>
              </CardContent>
            </Card>

            <Card 
              className="cursor-pointer hover:border-blue-400 hover:shadow-lg transition-all border-2 border-transparent"
              onClick={() => {
                setAnalysisName('Cybersecurity Incident');
                setAnalysisDescription('Model response to a data breach or ransomware attack including containment, stakeholder communication, and recovery procedures.');
                setScenarioType('security');
                setIndustry('technology');
                toast({ title: "Template Loaded", description: "Cybersecurity Incident loaded" });
              }}
              data-testid="template-cybersecurity"
            >
              <CardContent className="p-4 flex items-center gap-3">
                <div className="p-2 bg-blue-100 dark:bg-blue-900/20 rounded-lg">
                  <Shield className="h-5 w-5 text-blue-600" />
                </div>
                <div>
                  <div className="font-medium text-gray-900 dark:text-white">Cyber Incident</div>
                  <div className="text-xs text-gray-500 dark:text-gray-400">Security Response</div>
                </div>
              </CardContent>
            </Card>

            <Card 
              className="cursor-pointer hover:border-purple-400 hover:shadow-lg transition-all border-2 border-transparent"
              onClick={() => {
                setAnalysisName('M&A Integration');
                setAnalysisDescription('Plan the integration of an acquired company including culture alignment, systems consolidation, and talent retention strategies.');
                setScenarioType('strategic');
                setIndustry('general');
                toast({ title: "Template Loaded", description: "M&A Integration loaded" });
              }}
              data-testid="template-ma-integration"
            >
              <CardContent className="p-4 flex items-center gap-3">
                <div className="p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg">
                  <Building2 className="h-5 w-5 text-purple-600" />
                </div>
                <div>
                  <div className="font-medium text-gray-900 dark:text-white">M&A Integration</div>
                  <div className="text-xs text-gray-500 dark:text-gray-400">Strategic Change</div>
                </div>
              </CardContent>
            </Card>

            <Card 
              className="cursor-pointer hover:border-cyan-400 hover:shadow-lg transition-all border-2 border-transparent"
              onClick={() => {
                setAnalysisName('Regulatory Change Impact');
                setAnalysisDescription('Assess the operational and financial impact of new regulations, compliance requirements, or policy changes on business operations.');
                setScenarioType('regulatory');
                setIndustry('general');
                toast({ title: "Template Loaded", description: "Regulatory Change loaded" });
              }}
              data-testid="template-regulatory"
            >
              <CardContent className="p-4 flex items-center gap-3">
                <div className="p-2 bg-cyan-100 dark:bg-cyan-900/20 rounded-lg">
                  <FileText className="h-5 w-5 text-cyan-600" />
                </div>
                <div>
                  <div className="font-medium text-gray-900 dark:text-white">Regulatory Change</div>
                  <div className="text-xs text-gray-500 dark:text-gray-400">Compliance Impact</div>
                </div>
              </CardContent>
            </Card>
          </div>

          <Tabs defaultValue="analyzer" className="space-y-6">
            <TabsList className="bg-white dark:bg-slate-800">
              <TabsTrigger value="analyzer" data-testid="tab-analyzer">
                <FlaskConical className="h-4 w-4 mr-2" />
                Scenario Analyzer
              </TabsTrigger>
              <TabsTrigger value="saved" data-testid="tab-saved">
                <Save className="h-4 w-4 mr-2" />
                Saved Scenarios ({savedScenarios.length})
              </TabsTrigger>
            </TabsList>

            <TabsContent value="analyzer" className="space-y-6">
              {/* Load Template Section */}
              <Card className="border-purple-200 bg-purple-50/50 dark:bg-purple-900/10">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <FileText className="h-5 w-5 text-purple-600" />
                    Load Existing Scenario Template
                  </CardTitle>
                  <CardDescription>
                    Start with a pre-configured playbook or create a new scenario from scratch
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <Select value={selectedTemplate} onValueChange={loadTemplate}>
                      <SelectTrigger data-testid="select-template">
                        <SelectValue placeholder="Select a scenario template..." />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="new">Create New Scenario</SelectItem>
                        {scenarioTemplates.map((template: any) => (
                          <SelectItem key={template.id} value={template.id}>
                            {template.name} - {template.category || template.industry}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    <Button
                      variant="outline"
                      onClick={() => {
                        setSelectedTemplate('');
                        setConditions([]);
                        setAnalysisName('');
                        setAnalysisDescription('');
                      }}
                      data-testid="button-clear-template"
                    >
                      <XCircle className="h-4 w-4 mr-2" />
                      Clear All
                    </Button>
                  </div>
                </CardContent>
              </Card>

              <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                {/* Left Panel - Configuration */}
                <div className="lg:col-span-1 space-y-4">
                  {/* Basic Info */}
                  <Card>
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <Settings className="h-5 w-5" />
                        Scenario Information
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-3">
                      <div>
                        <Label htmlFor="scenario-name">Scenario Name</Label>
                        <Input
                          id="scenario-name"
                          placeholder="e.g., Oil Price Spike Q4 2025"
                          value={analysisName}
                          onChange={(e) => setAnalysisName(e.target.value)}
                          data-testid="input-scenario-name"
                        />
                      </div>
                      <div>
                        <Label htmlFor="scenario-description">Description</Label>
                        <Textarea
                          id="scenario-description"
                          placeholder="Describe the scenario and key assumptions..."
                          value={analysisDescription}
                          onChange={(e) => setAnalysisDescription(e.target.value)}
                          rows={3}
                          data-testid="input-scenario-description"
                        />
                      </div>
                      <div>
                        <Label htmlFor="scenario-type">Type</Label>
                        <Select value={scenarioType} onValueChange={setScenarioType}>
                          <SelectTrigger data-testid="select-scenario-type">
                            <SelectValue placeholder="Select type..." />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="security">Security</SelectItem>
                            <SelectItem value="financial">Financial</SelectItem>
                            <SelectItem value="supply-chain">Supply Chain</SelectItem>
                            <SelectItem value="operational">Operational</SelectItem>
                            <SelectItem value="regulatory">Regulatory</SelectItem>
                            <SelectItem value="strategic">Strategic</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label htmlFor="industry">Industry</Label>
                        <Select value={industry} onValueChange={setIndustry}>
                          <SelectTrigger data-testid="select-industry">
                            <SelectValue placeholder="Select industry..." />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="Technology">Technology</SelectItem>
                            <SelectItem value="Financial Services">Financial Services</SelectItem>
                            <SelectItem value="Manufacturing">Manufacturing</SelectItem>
                            <SelectItem value="Healthcare">Healthcare</SelectItem>
                            <SelectItem value="Retail">Retail</SelectItem>
                            <SelectItem value="Energy">Energy</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </CardContent>
                  </Card>

                  {/* Test Conditions */}
                  <Card>
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <Target className="h-5 w-5" />
                        Test Conditions
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div className="space-y-3">
                        <div>
                          <Label htmlFor="condition-label">Condition</Label>
                          <Input
                            id="condition-label"
                            placeholder="e.g., Oil price, Market volatility"
                            value={newCondition.label}
                            onChange={(e) => setNewCondition({ ...newCondition, label: e.target.value })}
                            data-testid="input-condition-label"
                          />
                        </div>

                        <div>
                          <Label htmlFor="condition-category">Category</Label>
                          <Select
                            value={newCondition.category}
                            onValueChange={(value: any) => setNewCondition({ ...newCondition, category: value })}
                          >
                            <SelectTrigger data-testid="select-condition-category">
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="market">Market</SelectItem>
                              <SelectItem value="operational">Operational</SelectItem>
                              <SelectItem value="financial">Financial</SelectItem>
                              <SelectItem value="regulatory">Regulatory</SelectItem>
                              <SelectItem value="environmental">Environmental</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        <div>
                          <Label htmlFor="condition-operator">Operator</Label>
                          <Select
                            value={newCondition.operator}
                            onValueChange={(value: any) => setNewCondition({ ...newCondition, operator: value })}
                          >
                            <SelectTrigger data-testid="select-condition-operator">
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="greater">Greater than (&gt;)</SelectItem>
                              <SelectItem value="less">Less than (&lt;)</SelectItem>
                              <SelectItem value="equals">Equals (=)</SelectItem>
                              <SelectItem value="between">Between</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        <div className="grid grid-cols-2 gap-2">
                          <div>
                            <Label htmlFor="condition-value">Value</Label>
                            <Input
                              id="condition-value"
                              type="number"
                              placeholder="120"
                              value={newCondition.value}
                              onChange={(e) => setNewCondition({ ...newCondition, value: e.target.value })}
                              data-testid="input-condition-value"
                            />
                          </div>
                          {newCondition.operator === 'between' && (
                            <div>
                              <Label htmlFor="condition-value2">Max Value</Label>
                              <Input
                                id="condition-value2"
                                type="number"
                                placeholder="150"
                                value={newCondition.value2}
                                onChange={(e) => setNewCondition({ ...newCondition, value2: e.target.value })}
                                data-testid="input-condition-value2"
                              />
                            </div>
                          )}
                          <div className={newCondition.operator === 'between' ? '' : 'col-span-1'}>
                            <Label htmlFor="condition-unit">Unit</Label>
                            <Input
                              id="condition-unit"
                              placeholder="$/barrel"
                              value={newCondition.unit}
                              onChange={(e) => setNewCondition({ ...newCondition, unit: e.target.value })}
                              data-testid="input-condition-unit"
                            />
                          </div>
                        </div>

                        <Button onClick={addCondition} className="w-full" data-testid="button-add-condition">
                          <Plus className="h-4 w-4 mr-2" />
                          Add Condition
                        </Button>
                      </div>

                      <Separator />

                      <div className="space-y-2">
                        <Label>Active Conditions ({conditions.length})</Label>
                        {conditions.length === 0 ? (
                          <p className="text-sm text-gray-500">No conditions added yet</p>
                        ) : (
                          <div className="space-y-2 max-h-64 overflow-y-auto">
                            {conditions.map(condition => (
                              <div
                                key={condition.id}
                                className="flex items-center justify-between p-2 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800"
                                data-testid={`condition-${condition.id}`}
                              >
                                <div className="text-sm flex-1">
                                  <Badge variant="outline" className="mb-1 text-xs">
                                    {condition.category}
                                  </Badge>
                                  <div>
                                    <span className="font-medium">{condition.label}</span>
                                    <span className="text-gray-600 dark:text-gray-400"> {condition.operator} </span>
                                    <span className="font-medium">{condition.value}</span>
                                    {condition.value2 && <span className="font-medium"> - {condition.value2}</span>}
                                    {condition.unit && <span className="text-gray-600 dark:text-gray-400"> {condition.unit}</span>}
                                  </div>
                                </div>
                                <Button
                                  variant="ghost"
                                  size="sm"
                                  onClick={() => removeCondition(condition.id)}
                                  data-testid={`button-remove-${condition.id}`}
                                >
                                  <Trash2 className="h-4 w-4" />
                                </Button>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>

                      <Button
                        onClick={runAnalysis}
                        disabled={isAnalyzing || conditions.length === 0}
                        className="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700"
                        data-testid="button-run-analysis"
                      >
                        {isAnalyzing ? (
                          <>
                            <Activity className="h-4 w-4 mr-2 animate-spin" />
                            Analyzing...
                          </>
                        ) : (
                          <>
                            <Play className="h-4 w-4 mr-2" />
                            Run Analysis
                          </>
                        )}
                      </Button>
                    </CardContent>
                  </Card>
                </div>

                {/* Middle Panel - Impact & Resources */}
                <div className="lg:col-span-1 space-y-4">
                  {/* Impact Assessment */}
                  <Card>
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <BarChart3 className="h-5 w-5" />
                        Impact Assessment
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div className="space-y-3">
                        <h4 className="font-semibold text-sm flex items-center gap-2">
                          <DollarSign className="h-4 w-4" />
                          Financial Impact
                        </h4>
                        <div>
                          <Label htmlFor="estimated-cost">Estimated Cost ($)</Label>
                          <Input
                            id="estimated-cost"
                            type="number"
                            placeholder="500000"
                            value={impactAssessment.financial.estimatedCost}
                            onChange={(e) => setImpactAssessment({
                              ...impactAssessment,
                              financial: { ...impactAssessment.financial, estimatedCost: parseFloat(e.target.value) || 0 }
                            })}
                            data-testid="input-estimated-cost"
                          />
                        </div>
                        <div>
                          <Label htmlFor="revenue-impact">Revenue Impact ($)</Label>
                          <Input
                            id="revenue-impact"
                            type="number"
                            placeholder="100000"
                            value={impactAssessment.financial.revenueImpact}
                            onChange={(e) => setImpactAssessment({
                              ...impactAssessment,
                              financial: { ...impactAssessment.financial, revenueImpact: parseFloat(e.target.value) || 0 }
                            })}
                            data-testid="input-revenue-impact"
                          />
                        </div>
                        <div>
                          <Label htmlFor="budget-allocation">Budget Allocation ($)</Label>
                          <Input
                            id="budget-allocation"
                            type="number"
                            placeholder="250000"
                            value={impactAssessment.financial.budgetAllocation}
                            onChange={(e) => setImpactAssessment({
                              ...impactAssessment,
                              financial: { ...impactAssessment.financial, budgetAllocation: parseFloat(e.target.value) || 0 }
                            })}
                            data-testid="input-budget-allocation"
                          />
                        </div>
                      </div>

                      <Separator />

                      <div className="space-y-3">
                        <h4 className="font-semibold text-sm flex items-center gap-2">
                          <Building2 className="h-4 w-4" />
                          Operational Impact
                        </h4>
                        <div>
                          <Label htmlFor="affected-departments">Affected Departments</Label>
                          <Textarea
                            id="affected-departments"
                            placeholder="IT, Operations, Finance (comma-separated)"
                            value={impactAssessment.operational.affectedDepartments.join(', ')}
                            onChange={(e) => setImpactAssessment({
                              ...impactAssessment,
                              operational: {
                                ...impactAssessment.operational,
                                affectedDepartments: e.target.value.split(',').map(d => d.trim()).filter(Boolean)
                              }
                            })}
                            rows={2}
                            data-testid="input-affected-departments"
                          />
                        </div>
                        <div>
                          <Label htmlFor="affected-regions">Affected Regions</Label>
                          <Textarea
                            id="affected-regions"
                            placeholder="North America, Europe (comma-separated)"
                            value={impactAssessment.operational.affectedRegions.join(', ')}
                            onChange={(e) => setImpactAssessment({
                              ...impactAssessment,
                              operational: {
                                ...impactAssessment.operational,
                                affectedRegions: e.target.value.split(',').map(r => r.trim()).filter(Boolean)
                              }
                            })}
                            rows={2}
                            data-testid="input-affected-regions"
                          />
                        </div>
                        <div>
                          <Label htmlFor="downtime-estimate">Estimated Downtime (hours)</Label>
                          <Input
                            id="downtime-estimate"
                            type="number"
                            placeholder="4"
                            value={impactAssessment.operational.downtimeEstimate}
                            onChange={(e) => setImpactAssessment({
                              ...impactAssessment,
                              operational: { ...impactAssessment.operational, downtimeEstimate: parseFloat(e.target.value) || 0 }
                            })}
                            data-testid="input-downtime-estimate"
                          />
                        </div>
                      </div>

                      <Separator />

                      <div className="space-y-3">
                        <h4 className="font-semibold text-sm flex items-center gap-2">
                          <Shield className="h-4 w-4" />
                          Reputational Impact
                        </h4>
                        <div>
                          <Label htmlFor="risk-level">Risk Level</Label>
                          <Select
                            value={impactAssessment.reputational.riskLevel}
                            onValueChange={(value: any) => setImpactAssessment({
                              ...impactAssessment,
                              reputational: { ...impactAssessment.reputational, riskLevel: value }
                            })}
                          >
                            <SelectTrigger data-testid="select-risk-level">
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="low">Low</SelectItem>
                              <SelectItem value="medium">Medium</SelectItem>
                              <SelectItem value="high">High</SelectItem>
                              <SelectItem value="critical">Critical</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div>
                          <Label htmlFor="stakeholder-concerns">Stakeholder Concerns</Label>
                          <Textarea
                            id="stakeholder-concerns"
                            placeholder="Media exposure, Customer trust (comma-separated)"
                            value={impactAssessment.reputational.stakeholderConcerns.join(', ')}
                            onChange={(e) => setImpactAssessment({
                              ...impactAssessment,
                              reputational: {
                                ...impactAssessment.reputational,
                                stakeholderConcerns: e.target.value.split(',').map(c => c.trim()).filter(Boolean)
                              }
                            })}
                            rows={2}
                            data-testid="input-stakeholder-concerns"
                          />
                        </div>
                      </div>

                      <Separator />

                      <div className="space-y-3">
                        <h4 className="font-semibold text-sm flex items-center gap-2">
                          <Clock className="h-4 w-4" />
                          Timeline
                        </h4>
                        <div>
                          <Label htmlFor="detection-response">Detection to Response (minutes)</Label>
                          <Input
                            id="detection-response"
                            type="number"
                            placeholder="12"
                            value={impactAssessment.timeline.detectionToResponse}
                            onChange={(e) => setImpactAssessment({
                              ...impactAssessment,
                              timeline: { ...impactAssessment.timeline, detectionToResponse: parseFloat(e.target.value) || 0 }
                            })}
                            data-testid="input-detection-response"
                          />
                        </div>
                        <div>
                          <Label htmlFor="full-resolution">Full Resolution (hours)</Label>
                          <Input
                            id="full-resolution"
                            type="number"
                            placeholder="24"
                            value={impactAssessment.timeline.fullResolution}
                            onChange={(e) => setImpactAssessment({
                              ...impactAssessment,
                              timeline: { ...impactAssessment.timeline, fullResolution: parseFloat(e.target.value) || 0 }
                            })}
                            data-testid="input-full-resolution"
                          />
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  {/* Resource Requirements */}
                  <Card>
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <Package className="h-5 w-5" />
                        Resource Requirements
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-3">
                      {resources.map((resource) => (
                        <div key={resource.id} className="p-3 bg-gray-50 dark:bg-gray-800 rounded border space-y-2">
                          <div className="flex items-center justify-between">
                            <Select
                              value={resource.type}
                              onValueChange={(value: any) => updateResource(resource.id, 'type', value)}
                            >
                              <SelectTrigger className="w-32">
                                <SelectValue />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="personnel">Personnel</SelectItem>
                                <SelectItem value="budget">Budget</SelectItem>
                                <SelectItem value="technology">Technology</SelectItem>
                                <SelectItem value="external">External</SelectItem>
                              </SelectContent>
                            </Select>
                            <Button
                              variant="ghost"
                              size="sm"
                              onClick={() => removeResource(resource.id)}
                            >
                              <Trash2 className="h-4 w-4" />
                            </Button>
                          </div>
                          <Input
                            placeholder="Resource name"
                            value={resource.name}
                            onChange={(e) => updateResource(resource.id, 'name', e.target.value)}
                          />
                          <div className="grid grid-cols-2 gap-2">
                            <Input
                              type="number"
                              placeholder="Quantity"
                              value={resource.quantity}
                              onChange={(e) => updateResource(resource.id, 'quantity', parseInt(e.target.value) || 0)}
                            />
                            <Input
                              type="number"
                              placeholder="Cost ($)"
                              value={resource.estimatedCost}
                              onChange={(e) => updateResource(resource.id, 'estimatedCost', parseFloat(e.target.value) || 0)}
                            />
                          </div>
                        </div>
                      ))}
                      <Button onClick={addResource} variant="outline" className="w-full" data-testid="button-add-resource">
                        <Plus className="h-4 w-4 mr-2" />
                        Add Resource
                      </Button>
                    </CardContent>
                  </Card>

                  {/* Stakeholders */}
                  <Card>
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <UserCheck className="h-5 w-5" />
                        Key Stakeholders
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-3">
                      {stakeholders.map((stakeholder) => (
                        <div key={stakeholder.id} className="p-3 bg-gray-50 dark:bg-gray-800 rounded border space-y-2">
                          <div className="flex items-center justify-between">
                            <Input
                              placeholder="Stakeholder name"
                              value={stakeholder.name}
                              onChange={(e) => updateStakeholder(stakeholder.id, 'name', e.target.value)}
                              className="flex-1 mr-2"
                            />
                            <Button
                              variant="ghost"
                              size="sm"
                              onClick={() => removeStakeholder(stakeholder.id)}
                            >
                              <Trash2 className="h-4 w-4" />
                            </Button>
                          </div>
                          <Input
                            placeholder="Role"
                            value={stakeholder.role}
                            onChange={(e) => updateStakeholder(stakeholder.id, 'role', e.target.value)}
                          />
                          <div className="grid grid-cols-2 gap-2">
                            <Select
                              value={stakeholder.priority}
                              onValueChange={(value: any) => updateStakeholder(stakeholder.id, 'priority', value)}
                            >
                              <SelectTrigger>
                                <SelectValue />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="high">High Priority</SelectItem>
                                <SelectItem value="medium">Medium Priority</SelectItem>
                                <SelectItem value="low">Low Priority</SelectItem>
                              </SelectContent>
                            </Select>
                            <Input
                              placeholder="Channel (email, slack)"
                              value={stakeholder.communicationChannel}
                              onChange={(e) => updateStakeholder(stakeholder.id, 'communicationChannel', e.target.value)}
                            />
                          </div>
                        </div>
                      ))}
                      <Button onClick={addStakeholder} variant="outline" className="w-full" data-testid="button-add-stakeholder">
                        <Plus className="h-4 w-4 mr-2" />
                        Add Stakeholder
                      </Button>
                    </CardContent>
                  </Card>
                </div>

                {/* Right Panel - Results */}
                <div className="lg:col-span-1 space-y-4">
                  {!analysisResult ? (
                    <Card className="h-full flex items-center justify-center min-h-[500px]">
                      <CardContent className="text-center p-12">
                        <FlaskConical className="h-16 w-16 text-gray-300 mx-auto mb-4" />
                        <h3 className="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">
                          Ready to Analyze
                        </h3>
                        <p className="text-gray-500 mb-6 max-w-md">
                          Configure your scenario with test conditions, impact assessment, resources, and stakeholders, then run the analysis
                        </p>
                        <div className="flex items-center justify-center gap-2 text-sm text-gray-500">
                          <Target className="h-4 w-4" />
                          <ArrowRight className="h-4 w-4" />
                          <AlertTriangle className="h-4 w-4" />
                          <ArrowRight className="h-4 w-4" />
                          <Rocket className="h-4 w-4" />
                        </div>
                      </CardContent>
                    </Card>
                  ) : (
                    <div className="space-y-4">
                      {/* Save Controls */}
                      <Card>
                        <CardContent className="p-4">
                          <div className="space-y-3">
                            <div className="flex items-center gap-2">
                              <Button onClick={saveScenario} className="flex-1" data-testid="button-save-scenario">
                                <Save className="h-4 w-4 mr-2" />
                                Save Analysis
                              </Button>
                              <Button onClick={saveAsTemplate} variant="outline" className="flex-1" data-testid="button-save-template">
                                <FileText className="h-4 w-4 mr-2" />
                                Save as Template
                              </Button>
                            </div>
                            <Alert>
                              <AlertDescription className="text-xs">
                                Save as Analysis for reference, or as Template for reusable scenarios
                              </AlertDescription>
                            </Alert>
                          </div>
                        </CardContent>
                      </Card>

                      {/* Analysis Confidence */}
                      <Card className="border-2 border-blue-200 dark:border-blue-800">
                        <CardHeader>
                          <CardTitle className="flex items-center gap-2 justify-between">
                            <span className="flex items-center gap-2">
                              <CheckCircle2 className="h-5 w-5 text-blue-600" />
                              Analysis Confidence
                            </span>
                            <Badge variant="outline" className="text-blue-600">
                              {analysisResult.confidenceLevel}%
                            </Badge>
                          </CardTitle>
                        </CardHeader>
                        <CardContent>
                          <div className="space-y-2">
                            <div className="flex items-center justify-between text-sm">
                              <span>Impact Score:</span>
                              <span className="font-bold text-orange-600">{analysisResult.impactScore}/100</span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-2">
                              <div
                                className="bg-blue-600 h-2 rounded-full"
                                style={{ width: `${analysisResult.confidenceLevel}%` }}
                              />
                            </div>
                            <p className="text-xs text-gray-600">
                              Based on data completeness and scenario depth
                            </p>
                          </div>
                        </CardContent>
                      </Card>

                      {/* Decision Velocity Metrics */}
                      <Card className="border-2 border-green-200 dark:border-green-800 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20">
                        <CardHeader>
                          <CardTitle className="flex items-center gap-2">
                            <Zap className="h-5 w-5 text-green-600" />
                            Decision Velocity Advantage
                          </CardTitle>
                        </CardHeader>
                        <CardContent>
                          <div className="grid grid-cols-2 gap-4">
                            <div className="text-center p-4 bg-white dark:bg-slate-800 rounded-lg">
                              <Clock className="h-6 w-6 text-blue-600 mx-auto mb-2" />
                              <div className="text-2xl font-bold text-blue-600">
                                {analysisResult.decisionVelocityMetrics.ourTime} min
                              </div>
                              <div className="text-sm text-gray-600 dark:text-gray-400">Your Response Time</div>
                            </div>
                            <div className="text-center p-4 bg-white dark:bg-slate-800 rounded-lg">
                              <Activity className="h-6 w-6 text-gray-600 mx-auto mb-2" />
                              <div className="text-2xl font-bold text-gray-600">
                                {Math.round(analysisResult.decisionVelocityMetrics.industryAverage / 60)} hrs
                              </div>
                              <div className="text-sm text-gray-600 dark:text-gray-400">Industry Average</div>
                            </div>
                            <div className="text-center p-4 bg-white dark:bg-slate-800 rounded-lg">
                              <TrendingUp className="h-6 w-6 text-green-600 mx-auto mb-2" />
                              <div className="text-2xl font-bold text-green-600">
                                {analysisResult.decisionVelocityMetrics.percentageFaster}%
                              </div>
                              <div className="text-sm text-gray-600 dark:text-gray-400">Faster</div>
                            </div>
                            <div className="text-center p-4 bg-white dark:bg-slate-800 rounded-lg">
                              <DollarSign className="h-6 w-6 text-purple-600 mx-auto mb-2" />
                              <div className="text-2xl font-bold text-purple-600">
                                {Math.round(analysisResult.decisionVelocityMetrics.timeSaved / 60)} hrs
                              </div>
                              <div className="text-sm text-gray-600 dark:text-gray-400">Time Saved</div>
                            </div>
                          </div>
                        </CardContent>
                      </Card>

                      {/* Triggered Alerts */}
                      <Card>
                        <CardHeader>
                          <CardTitle className="flex items-center gap-2">
                            <AlertTriangle className="h-5 w-5 text-orange-600" />
                            Triggered Alerts ({analysisResult.triggeredAlerts.length})
                          </CardTitle>
                        </CardHeader>
                        <CardContent>
                          {analysisResult.triggeredAlerts.length === 0 ? (
                            <p className="text-gray-500">No triggers would fire under these conditions</p>
                          ) : (
                            <div className="space-y-2">
                              {analysisResult.triggeredAlerts.map(alert => (
                                <div
                                  key={alert.id}
                                  className="flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-900/20 rounded border border-orange-200 dark:border-orange-800"
                                  data-testid={`alert-${alert.id}`}
                                >
                                  <div className="flex items-center gap-3">
                                    <AlertTriangle className="h-5 w-5 text-orange-600" />
                                    <span className="font-medium text-sm">{alert.name}</span>
                                  </div>
                                  <Badge variant={alert.severity === 'high' ? 'destructive' : 'secondary'}>
                                    {alert.severity}
                                  </Badge>
                                </div>
                              ))}
                            </div>
                          )}
                        </CardContent>
                      </Card>

                      {/* Recommended Playbooks */}
                      <Card>
                        <CardHeader>
                          <CardTitle className="flex items-center gap-2">
                            <Rocket className="h-5 w-5 text-blue-600" />
                            Recommended Playbooks ({analysisResult.recommendedPlaybooks.length})
                          </CardTitle>
                        </CardHeader>
                        <CardContent>
                          {analysisResult.recommendedPlaybooks.length === 0 ? (
                            <p className="text-gray-500">No playbooks recommended</p>
                          ) : (
                            <div className="space-y-2">
                              {analysisResult.recommendedPlaybooks.map(playbook => (
                                <div
                                  key={playbook.id}
                                  className="p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800"
                                  data-testid={`playbook-${playbook.id}`}
                                >
                                  <div className="flex items-center justify-between mb-2">
                                    <span className="font-medium text-sm">{playbook.name}</span>
                                    <Badge
                                      variant={playbook.readinessState === 'green' ? 'default' : 'secondary'}
                                      className={playbook.readinessState === 'green' ? 'bg-green-600' : ''}
                                    >
                                      {playbook.readinessState}
                                    </Badge>
                                  </div>
                                  <div className="flex items-center gap-4 text-xs text-gray-600">
                                    <span className="flex items-center gap-1">
                                      <Clock className="h-3 w-3" />
                                      {playbook.executionTime} min
                                    </span>
                                    {playbook.automationCoverage && (
                                      <span className="flex items-center gap-1">
                                        <Zap className="h-3 w-3" />
                                        {playbook.automationCoverage}% automated
                                      </span>
                                    )}
                                  </div>
                                </div>
                              ))}
                            </div>
                          )}
                        </CardContent>
                      </Card>

                      {/* Teams Involved */}
                      <Card>
                        <CardHeader>
                          <CardTitle className="flex items-center gap-2">
                            <Users className="h-5 w-5 text-purple-600" />
                            Teams Mobilized ({analysisResult.teamsInvolved.length})
                          </CardTitle>
                        </CardHeader>
                        <CardContent>
                          <div className="flex flex-wrap gap-2">
                            {analysisResult.teamsInvolved.map((team, idx) => (
                              <Badge key={idx} variant="outline" className="text-purple-600 border-purple-300">
                                {team.name}
                              </Badge>
                            ))}
                          </div>
                        </CardContent>
                      </Card>
                    </div>
                  )}
                </div>
              </div>
            </TabsContent>

            <TabsContent value="saved" className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {savedScenarios.length === 0 ? (
                  <Card className="col-span-full">
                    <CardContent className="text-center p-12">
                      <Save className="h-16 w-16 text-gray-300 mx-auto mb-4" />
                      <h3 className="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">
                        No Saved Scenarios
                      </h3>
                      <p className="text-gray-500">
                        Run an analysis and save it to build your scenario library
                      </p>
                    </CardContent>
                  </Card>
                ) : (
                  savedScenarios.map((scenario: any) => (
                    <Card key={scenario.id} className="hover:shadow-lg transition-shadow">
                      <CardHeader>
                        <CardTitle className="text-lg">{scenario.name}</CardTitle>
                        <CardDescription className="line-clamp-2">{scenario.description}</CardDescription>
                      </CardHeader>
                      <CardContent>
                        <div className="space-y-2">
                          <div className="flex items-center justify-between text-sm">
                            <span className="text-gray-600">Impact Score:</span>
                            <Badge variant="outline">{scenario.impactScore || 'N/A'}</Badge>
                          </div>
                          <div className="flex items-center justify-between text-sm">
                            <span className="text-gray-600">Response Time:</span>
                            <span className="font-medium">{scenario.projectedExecutionTime || 0} min</span>
                          </div>
                          {scenario.tags && scenario.tags.length > 0 && (
                            <div className="flex flex-wrap gap-1 mt-2">
                              {scenario.tags.slice(0, 3).map((tag: string, idx: number) => (
                                <Badge key={idx} variant="secondary" className="text-xs">
                                  {tag}
                                </Badge>
                              ))}
                            </div>
                          )}
                        </div>
                      </CardContent>
                    </Card>
                  ))
                )}
              </div>
            </TabsContent>
          </Tabs>
        </div>
      </div>
    </PageLayout>
  );
}


========================================
FILE: client/src/pages/WhyM.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { 
  ArrowRight, 
  Quote, 
  Lightbulb, 
  Target, 
  Clock, 
  CheckCircle2,
  XCircle,
  Zap,
  BookOpen,
  Radio,
  Shield,
  Users,
  Brain,
  TrendingUp,
  AlertTriangle,
  BarChart3,
  Globe2,
  Play,
  Building2,
  Timer,
  DollarSign
} from "lucide-react";
import { Link } from "wouter";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { useEffect } from "react";
import { updatePageMetadata } from "@/lib/seo";

export default function WhyM() {
  useEffect(() => {
    updatePageMetadata({
      title: "Why M - The Founder Story | Strategic Execution Operating System",
      description: "Discover how 5 years of elite football coaching and 20+ years of Fortune 500 strategic execution led to Mthe first Strategic Execution Operating System.",
      ogTitle: "Why M Exists - Creating a New Category",
      ogDescription: "The insight that created M: Business has no operating system for coordinated response. We're changing that.",
    });
  }, []);

  return (
    <div className="min-h-screen bg-background text-foreground">
      <StandardNav />

      {/* Hero Section - Split Layout with Founder + CTAs */}
      <section className="py-16 md:py-20 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
        <div className="max-w-6xl mx-auto">
          <div className="grid md:grid-cols-2 gap-12 items-center">
            <div>
              <Badge className="mb-6 bg-primary text-white border-0">
                <Lightbulb className="w-4 h-4 mr-2" />
                The Origin Story
              </Badge>
              
              <h1 className="text-4xl md:text-5xl font-bold mb-6 leading-tight" data-testid="heading-why-m">
                Why M Exists
              </h1>
              
              <p className="text-xl text-blue-100 mb-8">
                The insight that created a new software category came from an unexpected place: 
                the football field.
              </p>

              <div className="flex flex-wrap gap-4">
                <Link href="/demo-selector">
                  <Button size="lg" className="bg-white text-slate-900 hover:bg-slate-100">
                    <Play className="mr-2 h-5 w-5" />
                    Watch Demo
                  </Button>
                </Link>
                <Link href="/research">
                  <Button size="lg" variant="outline" className="border-white text-white hover:bg-white/10">
                    View Research
                    <ArrowRight className="ml-2 h-5 w-5" />
                  </Button>
                </Link>
              </div>
            </div>

            <Card className="bg-white/10 border-white/20 backdrop-blur">
              <CardContent className="p-6 md:p-8">
                <Quote className="h-10 w-10 text-blue-300 mb-4 opacity-60" />
                <blockquote className="text-lg text-blue-50 leading-relaxed mb-6 italic">
                  "Business has no operating system for coordinated response. Football teams respond in seconds. Fortune 500 companies take 72 hours. I finally understood why."
                </blockquote>
                <div className="flex items-center gap-4 pt-4 border-t border-white/20">
                  <div className="w-14 h-14 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-xl font-bold">
                    MB
                  </div>
                  <div>
                    <p className="font-bold text-white">Marty Brunke</p>
                    <p className="text-blue-200 text-sm">Founder & CEO, M</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Quick Stats Bar */}
      <section className="py-8 px-6 bg-slate-100 dark:bg-slate-800 border-b border-border">
        <div className="max-w-5xl mx-auto">
          <div className="grid grid-cols-3 gap-6 text-center">
            <div data-testid="stat-coaching">
              <div className="text-3xl md:text-4xl font-bold text-primary mb-1" data-testid="value-coaching">5 yrs</div>
              <p className="text-sm text-muted-foreground" data-testid="label-coaching">Collegiate Football Coaching</p>
            </div>
            <div data-testid="stat-strategy">
              <div className="text-3xl md:text-4xl font-bold text-primary mb-1" data-testid="value-strategy">20+</div>
              <p className="text-sm text-muted-foreground" data-testid="label-strategy">Years Fortune 500 Strategy</p>
            </div>
            <div data-testid="stat-transformations">
              <div className="text-3xl md:text-4xl font-bold text-primary mb-1" data-testid="value-transformations">6</div>
              <p className="text-sm text-muted-foreground" data-testid="label-transformations">Enterprise Transformations</p>
            </div>
          </div>
        </div>
      </section>

      {/* The Insight - Full Quote */}
      <section className="py-16 px-6">
        <div className="max-w-4xl mx-auto">
          <Card className="border-2 border-primary/30 bg-gradient-to-br from-blue-50 to-purple-50 dark:from-slate-800 dark:to-slate-900">
            <CardContent className="p-8 md:p-12">
              <div className="flex items-start gap-6 mb-8">
                <Quote className="h-12 w-12 text-primary shrink-0 opacity-60" />
                <blockquote className="text-xl md:text-2xl text-foreground leading-relaxed italic">
                  "In football, when a play is called, everyone knows exactly what to do. 
                  Assignments are clear, responsibilities are owned, and execution happens in seconds 
                  because the preparation is there. That level of alignment is built long before gameday.
                  <br /><br />
                  In business, I've spent 20 years watching Fortune 500 companies struggle with the 
                  very thing football teams excel at naturallyclarity, coordination, and the ability 
                  to execute with speed and confidence."
                </blockquote>
              </div>
              
              <div className="flex items-center justify-between flex-wrap gap-4 pt-6 border-t border-border">
                <div className="flex items-center gap-4">
                  <div className="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-2xl font-bold">
                    MB
                  </div>
                  <div>
                    <p className="font-bold text-foreground text-lg">Marty Brunke</p>
                    <p className="text-muted-foreground">Founder & CEO, M</p>
                  </div>
                </div>
                <div className="flex flex-wrap gap-2">
                  <Badge variant="outline">Ford</Badge>
                  <Badge variant="outline">Toyota</Badge>
                  <Badge variant="outline">Lockheed Martin</Badge>
                  <Badge variant="outline">Stanford</Badge>
                  <Badge variant="outline">Boyd Gaming</Badge>
                  <Badge variant="outline">Churchill Downs</Badge>
                </div>
              </div>
              <div className="flex justify-center mt-8">
                <Link href="/demo-selector">
                  <Button className="bg-primary text-white hover:bg-primary/90" data-testid="button-demo-insight">
                    <Play className="mr-2 h-4 w-4" />
                    See the Vision in Action
                  </Button>
                </Link>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* Why Now - Market Timing with Icons & Citations */}
      <section className="py-16 px-6 bg-gradient-to-br from-amber-500/5 to-orange-500/5">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-amber-500 text-white border-0">
              <TrendingUp className="w-4 h-4 mr-2" />
              Why Now
            </Badge>
            <h2 className="text-3xl font-bold text-foreground mb-4">
              Three Forces Are Converging
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
              Creating a massive gap between designed operating models and executed strategy.
            </p>
          </div>

          <div className="grid md:grid-cols-3 gap-6 mb-12">
            <Card className="bg-white dark:bg-slate-800 border-amber-500/30">
              <CardContent className="p-6">
                <div className="text-4xl font-bold text-amber-500 mb-3">$50B</div>
                <h3 className="font-bold text-foreground mb-2">Consulting Saturation</h3>
                <p className="text-sm text-muted-foreground">
                  Companies spend $50B/year on strategy consulting, but consultants leave when the deck is done.
                </p>
              </CardContent>
            </Card>
            <Card className="bg-white dark:bg-slate-800 border-orange-500/30">
              <CardContent className="p-6">
                <div className="text-4xl font-bold text-orange-500 mb-3">67%</div>
                <h3 className="font-bold text-foreground mb-2">Operating Model Overhauls</h3>
                <p className="text-sm text-muted-foreground">
                  67% of enterprises redesigned their operating model in the past 2 years (McKinsey, 2025).
                </p>
              </CardContent>
            </Card>
            <Card className="bg-white dark:bg-slate-800 border-red-500/30">
              <CardContent className="p-6">
                <div className="text-4xl font-bold text-red-500 mb-3">12 min</div>
                <h3 className="font-bold text-foreground mb-2">Speed Demands</h3>
                <p className="text-sm text-muted-foreground">
                  Markets move in days, not quarters. The 72-hour response window is now 12 minutes.
                </p>
              </CardContent>
            </Card>
          </div>

          <div className="text-center mb-12">
            <h3 className="text-2xl font-bold text-foreground mb-4">The Market Evidence</h3>
          </div>

          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <Card className="bg-gradient-to-br from-amber-500/10 to-amber-600/5 border-amber-500/20">
              <CardContent className="p-6 text-center">
                <TrendingUp className="h-8 w-8 text-amber-500 mx-auto mb-3" />
                <div className="text-4xl font-bold text-amber-500 mb-2">89%</div>
                <p className="text-sm text-muted-foreground">Say resilience is a top strategic priority</p>
                <p className="text-xs text-muted-foreground/60 mt-2">Source: PwC 2023</p>
              </CardContent>
            </Card>
            
            <Card className="bg-gradient-to-br from-red-500/10 to-red-600/5 border-red-500/20">
              <CardContent className="p-6 text-center">
                <AlertTriangle className="h-8 w-8 text-red-500 mx-auto mb-3" />
                <div className="text-4xl font-bold text-red-500 mb-2">91%</div>
                <p className="text-sm text-muted-foreground">Experienced major disruption beyond COVID</p>
                <p className="text-xs text-muted-foreground/60 mt-2">Source: PwC 2023</p>
              </CardContent>
            </Card>
            
            <Card className="bg-gradient-to-br from-orange-500/10 to-orange-600/5 border-orange-500/20">
              <CardContent className="p-6 text-center">
                <Timer className="h-8 w-8 text-orange-500 mx-auto mb-3" />
                <div className="text-4xl font-bold text-orange-500 mb-2">3.5</div>
                <p className="text-sm text-muted-foreground">Average disruptions every 2 years</p>
                <p className="text-xs text-muted-foreground/60 mt-2">Source: PwC 2023</p>
              </CardContent>
            </Card>
            
            <Card className="bg-gradient-to-br from-purple-500/10 to-purple-600/5 border-purple-500/20">
              <CardContent className="p-6 text-center">
                <DollarSign className="h-8 w-8 text-purple-500 mx-auto mb-3" />
                <div className="text-4xl font-bold text-purple-500 mb-2">70%</div>
                <p className="text-sm text-muted-foreground">Report significant business impact</p>
                <p className="text-xs text-muted-foreground/60 mt-2">Source: PwC 2023</p>
              </CardContent>
            </Card>
          </div>

          <div className="flex justify-center gap-4">
            <Link href="/research">
              <Button variant="outline" className="border-amber-500 text-amber-600 hover:bg-amber-500/10">
                View Full Research
                <ArrowRight className="ml-2 h-4 w-4" />
              </Button>
            </Link>
          </div>
        </div>
      </section>

      {/* The Football Parallel - Complete Preparedness */}
      <section className="py-16 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-white/20 text-white border-white/30">
              <Target className="w-4 h-4 mr-2" />
              The Insight
            </Badge>
            <h2 className="text-3xl font-bold mb-4">
              Offense. Defense. Special Teams.
            </h2>
            <p className="text-xl text-blue-100 max-w-3xl mx-auto">
              Great football programs are prepared for every situation before the game starts. 
              M brings this same complete preparedness to business leadership.
            </p>
          </div>

          <div className="grid md:grid-cols-3 gap-6 mb-12">
            <Card className="bg-white/10 border-white/20 backdrop-blur">
              <CardContent className="p-6 text-center">
                <div className="w-16 h-16 mx-auto mb-4 bg-emerald-500/20 rounded-2xl flex items-center justify-center">
                  <TrendingUp className="h-8 w-8 text-emerald-400" />
                </div>
                <h3 className="text-xl font-bold text-white mb-2">Offense</h3>
                <p className="text-sm text-blue-100 mb-4">Seize opportunities</p>
                <p className="text-sm text-blue-200">
                  M&A targets, market expansion, competitive movesplaybooks ready to capitalize.
                </p>
              </CardContent>
            </Card>
            
            <Card className="bg-white/10 border-white/20 backdrop-blur">
              <CardContent className="p-6 text-center">
                <div className="w-16 h-16 mx-auto mb-4 bg-red-500/20 rounded-2xl flex items-center justify-center">
                  <Shield className="h-8 w-8 text-red-400" />
                </div>
                <h3 className="text-xl font-bold text-white mb-2">Defense</h3>
                <p className="text-sm text-blue-100 mb-4">Protect value</p>
                <p className="text-sm text-blue-200">
                  Regulatory changes, supply chain disruptions, cyber incidentsresponses pre-staged.
                </p>
              </CardContent>
            </Card>
            
            <Card className="bg-white/10 border-white/20 backdrop-blur">
              <CardContent className="p-6 text-center">
                <div className="w-16 h-16 mx-auto mb-4 bg-purple-500/20 rounded-2xl flex items-center justify-center">
                  <Zap className="h-8 w-8 text-purple-400" />
                </div>
                <h3 className="text-xl font-bold text-white mb-2">Special Teams</h3>
                <p className="text-sm text-blue-100 mb-4">Change the game</p>
                <p className="text-sm text-blue-200">
                  AI governance, ESG mandates, workforce transformationemerging plays ready.
                </p>
              </CardContent>
            </Card>
          </div>

          <div className="text-center p-8 bg-white/5 rounded-2xl border border-white/10">
            <p className="text-xl font-medium text-blue-50 max-w-2xl mx-auto">
              No matter the situation, executives using M are prepared to execute 
              <span className="font-bold text-white"> swiftly, efficiently, and effectively.</span>
            </p>
          </div>
        </div>
      </section>

      {/* The Unique Background - Two Column */}
      <section className="py-16 px-6">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <h2 className="text-3xl font-bold text-foreground mb-4">
              A Unique Perspective
            </h2>
            <p className="text-muted-foreground max-w-2xl mx-auto">
              Only someone who's lived in both worlds could see this gap.
            </p>
          </div>

          <div className="grid md:grid-cols-2 gap-8 mb-10">
            <Card className="border-2 border-green-500/30 hover:border-green-500/50 transition-colors">
              <CardContent className="p-8">
                <div className="flex items-center gap-3 mb-6">
                  <div className="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center">
                    <Target className="h-6 w-6 text-green-500" />
                  </div>
                  <div>
                    <h3 className="font-bold text-xl text-foreground">Elite Sports</h3>
                    <p className="text-sm text-muted-foreground">What works</p>
                  </div>
                </div>
                <ul className="space-y-3">
                  <li className="flex items-start gap-2 text-muted-foreground">
                    <CheckCircle2 className="h-5 w-5 text-green-500 mt-0.5 shrink-0" />
                    <span>Pre-designed plays for every situation</span>
                  </li>
                  <li className="flex items-start gap-2 text-muted-foreground">
                    <CheckCircle2 className="h-5 w-5 text-green-500 mt-0.5 shrink-0" />
                    <span>Every player knows their role before the snap</span>
                  </li>
                  <li className="flex items-start gap-2 text-muted-foreground">
                    <CheckCircle2 className="h-5 w-5 text-green-500 mt-0.5 shrink-0" />
                    <span>Split-second coordinated response</span>
                  </li>
                  <li className="flex items-start gap-2 text-muted-foreground">
                    <CheckCircle2 className="h-5 w-5 text-green-500 mt-0.5 shrink-0" />
                    <span>Continuous practice and improvement</span>
                  </li>
                </ul>
              </CardContent>
            </Card>

            <Card className="border-2 border-red-500/30 hover:border-red-500/50 transition-colors">
              <CardContent className="p-8">
                <div className="flex items-center gap-3 mb-6">
                  <div className="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center">
                    <Building2 className="h-6 w-6 text-red-500" />
                  </div>
                  <div>
                    <h3 className="font-bold text-xl text-foreground">Fortune 500</h3>
                    <p className="text-sm text-muted-foreground">What doesn't</p>
                  </div>
                </div>
                <ul className="space-y-3">
                  <li className="flex items-start gap-2 text-muted-foreground">
                    <XCircle className="h-5 w-5 text-red-500 mt-0.5 shrink-0" />
                    <span>72+ hours to coordinate response</span>
                  </li>
                  <li className="flex items-start gap-2 text-muted-foreground">
                    <XCircle className="h-5 w-5 text-red-500 mt-0.5 shrink-0" />
                    <span>No pre-staged playbooks</span>
                  </li>
                  <li className="flex items-start gap-2 text-muted-foreground">
                    <XCircle className="h-5 w-5 text-red-500 mt-0.5 shrink-0" />
                    <span>Improvisation as default mode</span>
                  </li>
                  <li className="flex items-start gap-2 text-muted-foreground">
                    <XCircle className="h-5 w-5 text-red-500 mt-0.5 shrink-0" />
                    <span>Lessons learned but not applied</span>
                  </li>
                </ul>
              </CardContent>
            </Card>
          </div>

          <Card className="bg-gradient-to-r from-primary/10 to-purple-500/10 border-primary/30">
            <CardContent className="p-6 text-center">
              <Lightbulb className="h-10 w-10 text-primary mx-auto mb-3" />
              <p className="text-lg font-semibold text-foreground max-w-2xl mx-auto mb-4">
                This isn't domain expertise. It's a category-defining insight that competitors cannot replicate.
              </p>
              <Link href="/research">
                <Button variant="outline" className="border-primary text-primary hover:bg-primary/10" data-testid="button-research-perspective">
                  Explore the Research
                  <ArrowRight className="ml-2 h-4 w-4" />
                </Button>
              </Link>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* The Transformation - Side by Side */}
      <section className="py-16 px-6 bg-slate-50 dark:bg-slate-900">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-primary text-white border-0">
              <Zap className="w-4 h-4 mr-2" />
              The Transformation
            </Badge>
            <h2 className="text-3xl font-bold text-foreground mb-4">
              From 72 Hours to 12 Minutes
            </h2>
          </div>

          <div className="grid md:grid-cols-2 gap-8">
            <Card className="border-2 border-red-500/30">
              <CardContent className="p-8">
                <h3 className="text-xl font-bold text-red-500 mb-6 flex items-center gap-2">
                  <Clock className="h-6 w-6" />
                  Today: The 72-Hour Scramble
                </h3>
                <div className="space-y-4">
                  <div className="flex items-center gap-3 p-3 bg-red-500/5 rounded-lg">
                    <div className="w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center text-red-500 text-sm font-bold">1</div>
                    <span className="text-muted-foreground">Event occurs  Who should handle this?</span>
                  </div>
                  <div className="flex items-center gap-3 p-3 bg-red-500/5 rounded-lg">
                    <div className="w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center text-red-500 text-sm font-bold">2</div>
                    <span className="text-muted-foreground">Ad-hoc calls  What's our playbook?</span>
                  </div>
                  <div className="flex items-center gap-3 p-3 bg-red-500/5 rounded-lg">
                    <div className="w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center text-red-500 text-sm font-bold">3</div>
                    <span className="text-muted-foreground">Debate  Who has authority?</span>
                  </div>
                  <div className="flex items-center gap-3 p-3 bg-red-500/5 rounded-lg">
                    <div className="w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center text-red-500 text-sm font-bold">4</div>
                    <span className="text-muted-foreground">Discovery  What resources do we have?</span>
                  </div>
                  <div className="text-center pt-4 border-t border-red-500/20">
                    <span className="text-2xl font-bold text-red-500">72 hours later...</span>
                    <p className="text-sm text-muted-foreground mt-1">Response finally begins</p>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card className="border-2 border-green-500/30">
              <CardContent className="p-8">
                <h3 className="text-xl font-bold text-green-500 mb-6 flex items-center gap-2">
                  <Zap className="h-6 w-6" />
                  With M: 12-Minute Activation
                </h3>
                <div className="space-y-4">
                  <div className="flex items-center gap-3 p-3 bg-green-500/5 rounded-lg">
                    <div className="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center text-green-500 text-sm font-bold">1</div>
                    <span className="text-muted-foreground">Signal detected  Pre-configured alert</span>
                  </div>
                  <div className="flex items-center gap-3 p-3 bg-green-500/5 rounded-lg">
                    <div className="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center text-green-500 text-sm font-bold">2</div>
                    <span className="text-muted-foreground">Playbook activates  Pre-staged, pre-assigned</span>
                  </div>
                  <div className="flex items-center gap-3 p-3 bg-green-500/5 rounded-lg">
                    <div className="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center text-green-500 text-sm font-bold">3</div>
                    <span className="text-muted-foreground">Tasks deploy  Auto-created in Jira</span>
                  </div>
                  <div className="flex items-center gap-3 p-3 bg-green-500/5 rounded-lg">
                    <div className="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center text-green-500 text-sm font-bold">4</div>
                    <span className="text-muted-foreground">Teams execute  Clear ownership</span>
                  </div>
                  <div className="text-center pt-4 border-t border-green-500/20">
                    <span className="text-2xl font-bold text-green-500">12 minutes</span>
                    <p className="text-sm text-muted-foreground mt-1">Coordinated response underway</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          <div className="text-center mt-10">
            <Link href="/demo-selector">
              <Button size="lg" className="bg-green-600 text-white hover:bg-green-700" data-testid="button-demo-transformation">
                <Play className="mr-2 h-5 w-5" />
                See the 12-Minute Transformation
              </Button>
            </Link>
          </div>
        </div>
      </section>

      {/* Category Creation */}
      <section className="py-16 px-6">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-primary text-white">Category Creation</Badge>
            <h2 className="text-3xl font-bold text-foreground mb-4">
              We're Creating a New Category
            </h2>
            <p className="text-muted-foreground max-w-2xl mx-auto">
              M isn't entering an existing marketwe're defining a new one.
            </p>
          </div>

          <Card className="mb-8">
            <CardContent className="p-8">
              <h3 className="text-xl font-bold text-foreground mb-6 text-center">
                Strategic Execution Operating System (SEOS)
              </h3>
              
              <div>
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b border-border">
                      <th className="text-left py-3 px-4 font-semibold text-foreground">Existing Category</th>
                      <th className="text-left py-3 px-4 font-semibold text-foreground">What It Does</th>
                      <th className="text-left py-3 px-4 font-semibold text-foreground">What It Misses</th>
                    </tr>
                  </thead>
                  <tbody className="text-muted-foreground">
                    <tr className="border-b border-border">
                      <td className="py-3 px-4 font-medium">Project Management</td>
                      <td className="py-3 px-4">Tracks tasks</td>
                      <td className="py-3 px-4">No pre-staging, triggers, or orchestration</td>
                    </tr>
                    <tr className="border-b border-border">
                      <td className="py-3 px-4 font-medium">Business Continuity</td>
                      <td className="py-3 px-4">Plans for disasters</td>
                      <td className="py-3 px-4">No daily strategic response, no integration</td>
                    </tr>
                    <tr className="border-b border-border">
                      <td className="py-3 px-4 font-medium">GRC Platforms</td>
                      <td className="py-3 px-4">Manages compliance</td>
                      <td className="py-3 px-4">No execution, no coordination</td>
                    </tr>
                    <tr>
                      <td className="py-3 px-4 font-medium">Strategy Software</td>
                      <td className="py-3 px-4">Sets goals</td>
                      <td className="py-3 px-4">No connection to action</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div className="mt-8 p-6 bg-primary/10 rounded-lg">
                <h4 className="font-bold text-foreground mb-4 text-center">SEOS Combines All Four:</h4>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <div className="flex flex-col items-center text-center gap-2">
                    <Shield className="h-8 w-8 text-primary" />
                    <span className="text-sm font-medium text-foreground">Pre-staged Readiness</span>
                  </div>
                  <div className="flex flex-col items-center text-center gap-2">
                    <Radio className="h-8 w-8 text-primary" />
                    <span className="text-sm font-medium text-foreground">Signal Monitoring</span>
                  </div>
                  <div className="flex flex-col items-center text-center gap-2">
                    <Zap className="h-8 w-8 text-primary" />
                    <span className="text-sm font-medium text-foreground">Orchestrated Execution</span>
                  </div>
                  <div className="flex flex-col items-center text-center gap-2">
                    <BookOpen className="h-8 w-8 text-primary" />
                    <span className="text-sm font-medium text-foreground">Continuous Learning</span>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardContent className="p-8">
              <h3 className="text-xl font-bold text-foreground mb-6 text-center">
                Category Creation Precedents
              </h3>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div className="text-center p-4">
                  <div className="text-3xl font-bold text-blue-500 mb-2">$250B+</div>
                  <p className="font-medium text-foreground">Salesforce</p>
                  <p className="text-sm text-muted-foreground">Created CRM</p>
                </div>
                <div className="text-center p-4">
                  <div className="text-3xl font-bold text-purple-500 mb-2">$150B+</div>
                  <p className="font-medium text-foreground">ServiceNow</p>
                  <p className="text-sm text-muted-foreground">Created ITSM</p>
                </div>
                <div className="text-center p-4">
                  <div className="text-3xl font-bold text-green-500 mb-2">$60B+</div>
                  <p className="font-medium text-foreground">Workday</p>
                  <p className="text-sm text-muted-foreground">Created HCM Cloud</p>
                </div>
                <div className="text-center p-4 bg-primary/10 rounded-lg border-2 border-primary/30">
                  <div className="text-3xl font-bold text-primary mb-2">$5B+</div>
                  <p className="font-medium text-foreground">M</p>
                  <p className="text-sm text-muted-foreground">Creating SEOS</p>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      {/* What The Research Shows */}
      <section className="py-16 px-6 bg-slate-50 dark:bg-slate-900">
        <div className="max-w-5xl mx-auto">
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-blue-500 text-white border-0">
              <BarChart3 className="w-4 h-4 mr-2" />
              Industry Research
            </Badge>
            <h2 className="text-3xl font-bold text-foreground mb-4">
              What the Research Proves
            </h2>
          </div>

          <div className="grid md:grid-cols-3 gap-6 mb-8">
            <Card className="border-2 hover:border-primary/30 transition-colors">
              <CardContent className="p-6">
                <Quote className="h-8 w-8 text-primary mb-4 opacity-40" />
                <p className="text-foreground mb-4 italic">
                  "Organizations with pre-defined incident response teams save 35% more on 
                  breach-related costs than those that improvise."
                </p>
                <p className="text-sm text-muted-foreground font-medium">
                   IBM/Ponemon Institute, 2024
                </p>
              </CardContent>
            </Card>

            <Card className="border-2 hover:border-primary/30 transition-colors">
              <CardContent className="p-6">
                <Quote className="h-8 w-8 text-primary mb-4 opacity-40" />
                <p className="text-foreground mb-4 italic">
                  "The first 72 hours of a crisis are critical. Organizations that contain incidents 
                  quickly save an average of $1.76M."
                </p>
                <p className="text-sm text-muted-foreground font-medium">
                   McKinsey / IBM 2024
                </p>
              </CardContent>
            </Card>

            <Card className="border-2 hover:border-primary/30 transition-colors">
              <CardContent className="p-6">
                <Quote className="h-8 w-8 text-primary mb-4 opacity-40" />
                <p className="text-foreground mb-4 italic">
                  "89% of business leaders say resilience is one of their most important 
                  strategic organizational priorities."
                </p>
                <p className="text-sm text-muted-foreground font-medium">
                   PwC Global Crisis Survey, 2023
                </p>
              </CardContent>
            </Card>
          </div>

          <div className="text-center">
            <Link href="/research">
              <Button className="bg-primary text-white hover:bg-primary/90">
                Explore Full Research
                <ArrowRight className="ml-2 h-4 w-4" />
              </Button>
            </Link>
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="py-16 px-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
        <div className="max-w-3xl mx-auto text-center">
          <h2 className="text-3xl font-bold mb-6">
            Ready to Transform How Your Organization Responds?
          </h2>
          <p className="text-xl text-blue-100 mb-8">
            See M in action and discover what 12-minute strategic coordination looks like.
          </p>
          <div className="flex gap-4 justify-center flex-wrap">
            <Link href="/demo-selector">
              <Button size="lg" className="bg-white text-slate-900 hover:bg-slate-100">
                <Play className="mr-2 h-5 w-5" />
                Watch Demo
              </Button>
            </Link>
            <Link href="/research">
              <Button size="lg" variant="outline" className="border-white text-white hover:bg-white/10">
                View Research
              </Button>
            </Link>
            <Link href="/contact">
              <Button size="lg" variant="outline" className="border-white text-white hover:bg-white/10">
                Contact Us
              </Button>
            </Link>
          </div>
        </div>
      </section>

      <Footer />
    </div>
  );
}


========================================
FILE: client/src/navigation/config.ts
========================================
// Centralized navigation types - single source of truth
export type NavigationCategory = 'intelligence' | 'crisis' | 'strategic' | 'system';

export type IconName = 
  | 'LayoutDashboard'
  | 'Brain'
  | 'AlertTriangle'
  | 'Target'
  | 'Building2'
  | 'Settings'
  | 'Activity'
  | 'TrendingUp'
  | 'Users'
  | 'Lightbulb'
  | 'Shield'
  | 'Zap'
  | 'FileText'
  | 'BarChart3'
  | 'MessageSquare'
  | 'Network'
  | 'Layers'
  | 'Rocket'
  | 'Radio'
  | 'PlayCircle'
  | 'Presentation'
  | 'Timer';

export interface NavigationItem {
  id: string;
  label: string;
  icon: IconName;
  path: string;
  badge?: string;
  description: string;
  category: NavigationCategory;
}

// Single source of truth for all navigation items - CONSOLIDATED FOR EXECUTIVES
export const navigationItems: NavigationItem[] = [
  // Executive Dashboard - Unified Command Center
  {
    id: 'executive-dashboard',
    label: 'Executive Dashboard',
    icon: 'LayoutDashboard',
    path: '/executive-dashboard',
    description: 'Unified command center: FRI, velocity, preparedness in one view',
    category: 'intelligence'
  },

  // Playbook Library - PROMOTED TO TOP
  {
    id: 'playbook-library',
    label: 'Playbook Library',
    icon: 'Rocket',
    path: '/playbook-library',
    badge: '166',
    description: '166 strategic playbooks across 9 operational domains',
    category: 'intelligence'
  },

  // AI Intelligence - Consolidated
  {
    id: 'ai-hub',
    label: 'AI Intelligence Hub',
    icon: 'Brain',
    path: '/ai',
    badge: 'AI',
    description: '5 strategic co-pilots: Pulse, Flux, Prism, Echo, Nova',
    category: 'intelligence'
  },
  {
    id: 'ai-radar',
    label: 'Perpetual Foresight Dashboard',
    icon: 'Radio',
    path: '/ai-radar',
    badge: 'LIVE',
    description: '24/7 strategic signal monitoring with AI-powered foresight',
    category: 'intelligence'
  },

  // Strategic Response - Full Suite
  {
    id: 'crisis-response',
    label: 'Strategic Response',
    icon: 'AlertTriangle',
    path: '/crisis',
    badge: 'LIVE',
    description: '12-minute strategic execution vs 72-hour industry standard',
    category: 'strategic'
  },
  {
    id: 'war-room',
    label: 'Situation Room',
    icon: 'Radio',
    path: '/war-room',
    badge: 'LIVE',
    description: 'Real-time collaborative command center',
    category: 'strategic'
  },
  {
    id: 'triggers-management',
    label: 'AI Trigger Monitoring',
    icon: 'Zap',
    path: '/triggers-management',
    badge: '24/7',
    description: 'AI co-pilot monitors triggers and recommends playbooks',
    category: 'strategic'
  },
  {
    id: 'real-time-collab',
    label: 'Team Collaboration',
    icon: 'Users',
    path: '/collaboration',
    badge: 'LIVE',
    description: 'Real-time coordination with WebSocket updates',
    category: 'strategic'
  },
  {
    id: 'preparedness',
    label: 'Strategic Readiness Report',
    icon: 'Shield',
    path: '/preparedness-report',
    description: 'Strategic Readiness Score and Dynamic Strategy benchmarking',
    category: 'strategic'
  },
  {
    id: 'drill-tracking',
    label: 'Practice Drills',
    icon: 'Target',
    path: '/drill-tracking',
    badge: 'V2',
    description: 'Quarterly simulations with performance metrics',
    category: 'strategic'
  },

  // Strategic Planning
  {
    id: 'strategic-planning',
    label: 'Strategic Planning',
    icon: 'Target',
    path: '/strategic',
    description: 'Scenario planning and strategic execution tracking',
    category: 'strategic'
  },
  {
    id: 'what-if',
    label: 'What-If Analyzer',
    icon: 'Target',
    path: '/what-if-analyzer',
    badge: 'PRACTICE',
    description: 'Test scenarios before execution, improve your readiness',
    category: 'strategic'
  },
  {
    id: 'decision-velocity',
    label: 'Decision Velocity Dashboard',
    icon: 'Zap',
    path: '/decision-velocity',
    badge: 'NEW',
    description: 'Your competitive advantage metric for Dynamic Strategy execution',
    category: 'strategic'
  },
  {
    id: 'analytics',
    label: 'Analytics',
    icon: 'BarChart3',
    path: '/analytics',
    description: 'Performance metrics and decision velocity tracking',
    category: 'strategic'
  },
  {
    id: 'institutional-memory',
    label: 'Institutional Memory',
    icon: 'Brain',
    path: '/institutional-memory',
    badge: 'V2',
    description: 'Learn from past decisions and improve AI recommendations',
    category: 'strategic'
  },
  {
    id: 'board-briefings',
    label: 'Board Briefings',
    icon: 'FileText',
    path: '/board-briefings',
    badge: 'V2',
    description: 'Automated reports with evidence traceability',
    category: 'strategic'
  },

  // System Administration
  {
    id: 'vc-presentations',
    label: 'Investor Demos',
    icon: 'Presentation',
    path: '/vc-presentations',
    description: 'Investor presentation and demo materials',
    category: 'system'
  },
  {
    id: 'settings',
    label: 'Settings',
    icon: 'Settings',
    path: '/settings',
    description: 'Platform settings and configuration',
    category: 'system'
  }
];

// Category metadata for navigation grouping
export interface CategoryConfig {
  label: string;
  icon: IconName;
  color: string;
  borderColor: string;
}

export const categories: Record<NavigationCategory, CategoryConfig> = {
  intelligence: {
    label: 'Intelligence & Insights',
    icon: 'Brain',
    color: 'from-blue-600 to-indigo-600',
    borderColor: 'border-blue-500/30'
  },
  crisis: {
    label: 'Strategic Execution',
    icon: 'Shield',
    color: 'from-red-600 to-red-700',
    borderColor: 'border-red-500/30'
  },
  strategic: {
    label: 'Strategic Planning',
    icon: 'Target',
    color: 'from-emerald-600 to-green-600',
    borderColor: 'border-emerald-500/30'
  },
  system: {
    label: 'System',
    icon: 'Settings',
    color: 'from-gray-600 to-slate-600',
    borderColor: 'border-gray-500/30'
  }
};

// Helper functions for working with navigation
export const getItemsByCategory = (category: NavigationCategory) => 
  navigationItems.filter(item => item.category === category);

export const findItemByPath = (path: string) => 
  navigationItems.find(item => item.path === path);

export const findItemById = (id: string) => 
  navigationItems.find(item => item.id === id);


========================================
FILE: client/src/navigation/m-nav.ts
========================================
// M Strategic Execution Operating System Navigation
// Based on 7-Component Ecosystem

import { IconName } from './config';

export interface NavSection {
  id: string;
  label: string;
  description: string;
  icon: IconName;
  items: NavItem[];
  priority?: 'high' | 'medium' | 'low'; // For visual hierarchy
}

export interface NavItem {
  id: string;
  label: string;
  route: string;
  icon: IconName;
  badge?: string;
  description?: string;
}

// Quick Access - Most-used pages for one-click access (Streamlined to 3 core items)
export const quickAccessItems: NavItem[] = [
  {
    id: 'quick-dashboard',
    label: 'Dashboard',
    route: '/dashboard',
    icon: 'LayoutDashboard',
    description: 'Strategic operations center'
  },
  {
    id: 'quick-triggers',
    label: 'Playbook Activation',
    route: '/triggers-management',
    icon: 'Zap',
    description: 'Execute strategic playbooks'
  },
  {
    id: 'quick-ai-radar',
    label: 'AI Radar (Live)',
    route: '/ai-radar',
    icon: 'Radio',
    badge: 'LIVE'
  }
];

// M's IDEA Framework Navigation (Streamlined from 7 sections)
// Aligned to: IDENTIFY  DETECT  EXECUTE  ADVANCE
export const mNavigation: NavSection[] = [
  // 1. IDENTIFY - Strategic Preparation
  {
    id: 'identify',
    label: 'IDENTIFY',
    description: 'Build your depth chart',
    icon: 'Target',
    priority: 'high',
    items: [
      {
        id: 'playbook-library',
        label: 'Playbook Library',
        route: '/playbook-library',
        icon: 'Shield',
        description: '166 strategic templates',
        badge: '166'
      },
      {
        id: 'scenarios',
        label: 'Custom Scenarios',
        route: '/scenarios',
        icon: 'FileText',
        description: 'Organization-specific playbooks'
      },
      {
        id: 'what-if',
        label: 'What-If Analyzer',
        route: '/what-if-analyzer',
        icon: 'Layers',
        description: 'Test strategic approaches'
      },
      {
        id: 'practice-drills',
        label: 'Practice Drills',
        route: '/practice-drills',
        icon: 'Target',
        description: 'Scenario simulations & war games'
      }
    ]
  },

  // 2. DETECT - AI Intelligence & 24/7 Monitoring (Consolidated)
  {
    id: 'detect',
    label: 'DETECT',
    description: 'Monitor signals',
    icon: 'Radio',
    priority: 'high',
    items: [
      {
        id: 'ai-radar',
        label: 'AI Radar Dashboard',
        route: '/ai-radar',
        icon: 'Radio',
        badge: 'LIVE'
      },
      {
        id: 'strategic-monitoring',
        label: 'Strategic Monitoring',
        route: '/strategic-monitoring',
        icon: 'Shield',
        description: 'Opportunity & threat tracking'
      },
      {
        id: 'pulse',
        label: 'Pulse Intelligence',
        route: '/pulse',
        icon: 'Activity',
        description: 'Organizational health metrics'
      },
      {
        id: 'flux',
        label: 'Flux Adaptations',
        route: '/flux',
        icon: 'TrendingUp',
        description: 'Change management signals'
      },
      {
        id: 'prism',
        label: 'Prism Insights',
        route: '/prism',
        icon: 'Layers',
        description: 'Multi-dimensional analysis'
      },
      {
        id: 'echo',
        label: 'Echo Cultural',
        route: '/echo',
        icon: 'Users',
        description: 'Team sentiment & culture'
      }
    ]
  },

  // 3. EXECUTE - Execution Framework
  {
    id: 'execute',
    label: 'EXECUTE',
    description: 'Execute response',
    icon: 'Zap',
    priority: 'high',
    items: [
      {
        id: 'command-center',
        label: 'Command Center',
        route: '/command-center',
        icon: 'Shield',
        description: 'Strategic coordination hub'
      },
      {
        id: 'triggers',
        label: 'Playbook Activation',
        route: '/triggers-management',
        icon: 'Zap',
        description: 'Activate & monitor playbooks'
      },
      {
        id: 'collaboration',
        label: 'Team Coordination',
        route: '/collaboration',
        icon: 'MessageSquare',
        description: 'Real-time collaboration'
      },
      {
        id: 'integrations',
        label: 'Integrations',
        route: '/integrations',
        icon: 'Network',
        description: 'Connect Jira, Slack, Calendar'
      }
    ]
  },

  // 4. ADVANCE - Institutional Memory & Executive Intelligence (Consolidated)
  {
    id: 'advance',
    label: 'ADVANCE',
    description: 'Review the film',
    icon: 'Brain',
    priority: 'high',
    items: [
      {
        id: 'preparedness',
        label: 'Preparedness Report',
        route: '/preparedness-report',
        icon: 'Shield',
        description: 'Executive Preparedness Score'
      },
      {
        id: 'institutional-memory',
        label: 'Institutional Memory',
        route: '/institutional-memory',
        icon: 'FileText',
        description: 'Decision outcomes & learnings'
      },
      {
        id: 'board-briefings',
        label: 'Board Briefings',
        route: '/board-briefings',
        icon: 'FileText',
        description: 'Executive reports'
      },
      {
        id: 'analytics',
        label: 'Advanced Analytics',
        route: '/analytics',
        icon: 'BarChart3',
        description: 'Deep insights & trends'
      },
      {
        id: 'nova',
        label: 'Innovation Pipeline',
        route: '/nova',
        icon: 'Lightbulb',
        description: 'Track innovation initiatives'
      }
    ]
  }
];

// Helper to get current section by route (handles dynamic routes)
export const getSectionByRoute = (route: string): NavSection | null => {
  for (const section of mNavigation) {
    const item = section.items.find(item => {
      // Exact match
      if (item.route === route) return true;
      // Handle dynamic routes (e.g., /strategic-monitoring/:id matches /strategic-monitoring)
      if (route.startsWith(item.route + '/')) return true;
      return false;
    });
    if (item) return section;
  }
  return null;
};

// Helper to get all routes
export const getAllRoutes = (): string[] => {
  return mNavigation.flatMap(section => 
    section.items.map(item => item.route)
  );
};


========================================
FILE: client/src/navigation/routes.ts
========================================
import { ComponentType } from 'react';
import { navigationItems } from './config';

// Route definitions - must match navigation paths
export interface RouteDefinition {
  id: string;
  path: string;
  component: ComponentType;
}

// Import all page components - CONSOLIDATED
import ExecutiveDashboard from '../pages/ExecutiveDashboard';
import AIIntelligenceHub from '../pages/AIIntelligenceHub';
import CrisisResponseCenter from '../pages/CrisisResponseCenter';
import StrategicPlanningHub from '../pages/StrategicPlanningHub';
import PlaybookLibrary from '../pages/PlaybookLibrary';
import WhatIfAnalyzer from '../pages/WhatIfAnalyzer';
import AdvancedAnalytics from '../pages/AdvancedAnalytics';
import UnifiedDemoHub from '../pages/UnifiedDemoHub';
import IntelligenceControlCenter from '../pages/IntelligenceControlCenter';
import Settings from '../pages/Settings';
import NotFound from '../pages/not-found';

// Central route registry - maps navigation items to their components
export const routes: RouteDefinition[] = [
  { id: 'executive-dashboard', path: '/executive-dashboard', component: ExecutiveDashboard },
  { id: 'intelligence', path: '/intelligence', component: IntelligenceControlCenter },
  { id: 'ai-hub', path: '/ai', component: AIIntelligenceHub },
  { id: 'crisis-response', path: '/crisis', component: CrisisResponseCenter },
  { id: 'strategic-planning', path: '/strategic', component: StrategicPlanningHub },
  { id: 'scenarios', path: '/playbook-library', component: PlaybookLibrary },
  { id: 'what-if', path: '/what-if-analyzer', component: WhatIfAnalyzer },
  { id: 'analytics', path: '/analytics', component: AdvancedAnalytics },
  { id: 'demo-hub', path: '/demo-hub', component: UnifiedDemoHub },
  { id: 'settings', path: '/settings', component: Settings }
];

// TypeScript validation: ensure all navigation items have corresponding routes
const navigationPaths = new Set(navigationItems.map(item => item.path));
const routePaths = new Set(routes.map(route => route.path));

// Check for missing routes
const missingRoutes = navigationItems.filter(nav => !routePaths.has(nav.path));
const orphanedRoutes = routes.filter(route => !navigationPaths.has(route.path));

if (missingRoutes.length > 0) {
  console.warn('Navigation items without routes:', missingRoutes.map(item => item.id));
}

if (orphanedRoutes.length > 0) {
  console.warn('Routes without navigation items:', orphanedRoutes.map(route => route.id));
}

// Helper to get route by path
export const findRouteByPath = (path: string) => 
  routes.find(route => route.path === path);

// Helper to get route by nav item id
export const findRouteByNavId = (navId: string) => {
  const navItem = navigationItems.find(item => item.id === navId);
  return navItem ? findRouteByPath(navItem.path) : undefined;
};


========================================
FILE: client/src/navigation/workflow.ts
========================================
// Workflow-based navigation configuration for guided user journeys

import { IconName } from './config';

export type WorkflowPhase = 'demo' | 'detection' | 'planning' | 'response' | 'execution' | 'measurement';

export interface WorkflowStep {
  id: string;
  label: string;
  description: string;
  icon: IconName;
  route: string;
  phase: WorkflowPhase;
  stepNumber: number;
  estimatedDuration?: string;
  badge?: string;
}

export interface PhaseConfig {
  id: WorkflowPhase;
  label: string;
  description: string;
  icon: IconName;
  color: string;
  orderNumber: number;
}

// 6-Phase workflow structure (including Demo)
export const workflowPhases: Record<WorkflowPhase, PhaseConfig> = {
  demo: {
    id: 'demo',
    label: 'Interactive Demo',
    description: 'Experience the Strategic Execution Operating System',
    icon: 'Brain',
    color: 'from-blue-600 to-cyan-600',
    orderNumber: 0
  },
  detection: {
    id: 'detection',
    label: 'Intelligence & Insights',
    description: 'Monitor strategic signals and market intelligence',
    icon: 'Radio',
    color: 'from-blue-600 to-indigo-600',
    orderNumber: 1
  },
  planning: {
    id: 'planning',
    label: 'Strategy & Preparation',
    description: 'Build playbooks and strategic readiness',
    icon: 'Target',
    color: 'from-indigo-600 to-purple-600',
    orderNumber: 2
  },
  response: {
    id: 'response',
    label: 'Execution & Coordination',
    description: 'Activate playbooks and coordinate teams',
    icon: 'Zap',
    color: 'from-amber-600 to-orange-600',
    orderNumber: 3
  },
  execution: {
    id: 'execution',
    label: 'Operations & Performance',
    description: 'Track execution and optimize performance',
    icon: 'Activity',
    color: 'from-green-600 to-emerald-600',
    orderNumber: 4
  },
  measurement: {
    id: 'measurement',
    label: 'Analytics & Intelligence',
    description: 'Measure impact and refine strategies',
    icon: 'BarChart3',
    color: 'from-purple-600 to-violet-600',
    orderNumber: 5
  }
};

// Workflow steps organized by phase
export const workflowSteps: WorkflowStep[] = [
  // Demo Phase
  {
    id: 'executive-demo',
    label: 'Executive Demo',
    description: '8 C-Suite personas with personalized playbooks',
    icon: 'Brain',
    route: '/hybrid-demo',
    phase: 'demo',
    stepNumber: 1,
    estimatedDuration: '5-10 min',
    badge: 'LIVE'
  },
  {
    id: 'what-if-analyzer',
    label: 'What-If Scenario Analyzer',
    description: 'Stress test triggers before they happen',
    icon: 'Layers',
    route: '/what-if-analyzer',
    phase: 'demo',
    stepNumber: 2,
    estimatedDuration: '3-5 min',
    badge: 'AI'
  },
  
  // Intelligence & Insights
  {
    id: 'start-dashboard',
    label: 'Executive Dashboard',
    description: 'Your strategic command center and intelligence hub',
    icon: 'LayoutDashboard',
    route: '/',
    phase: 'detection',
    stepNumber: 3,
    estimatedDuration: '2-3 min'
  },
  {
    id: 'strategic-monitoring',
    label: 'Strategic Monitoring',
    description: 'Monitor opportunities and emerging scenarios',
    icon: 'Radio',
    route: '/strategic-monitoring',
    phase: 'detection',
    stepNumber: 4,
    estimatedDuration: '3-5 min',
    badge: 'LIVE'
  },
  {
    id: 'pulse-intel',
    label: 'Pulse Intelligence',
    description: 'Monitor organizational health and performance',
    icon: 'Activity',
    route: '/pulse',
    phase: 'detection',
    stepNumber: 5,
    estimatedDuration: '2-3 min',
    badge: 'AI'
  },

  // Strategy & Preparation
  {
    id: 'playbook-templates',
    label: 'Playbook Library',
    description: '166 strategic playbooks across 9 domains',
    icon: 'FileText',
    route: '/playbook-library',
    phase: 'planning',
    stepNumber: 6,
    estimatedDuration: '3-4 min',
    badge: 'PRO'
  },
  {
    id: 'strategic-planning',
    label: 'Strategy Builder',
    description: 'Build and customize your strategic playbooks',
    icon: 'Target',
    route: '/strategic',
    phase: 'planning',
    stepNumber: 7,
    estimatedDuration: '5-7 min'
  },
  {
    id: 'prism-insights',
    label: 'Prism Insights',
    description: 'Multi-dimensional scenario analysis',
    icon: 'Layers',
    route: '/prism',
    phase: 'planning',
    stepNumber: 8,
    estimatedDuration: '4-5 min',
    badge: 'AI'
  },

  // Execution & Coordination
  {
    id: 'command-center',
    label: 'Command Center',
    description: 'Activate and coordinate strategic playbooks',
    icon: 'Shield',
    route: '/command-center',
    phase: 'response',
    stepNumber: 9,
    estimatedDuration: '5-10 min',
    badge: 'ACTIVE'
  },
  {
    id: 'triggers',
    label: 'Playbook Activation',
    description: 'Monitor and activate strategic playbooks',
    icon: 'Zap',
    route: '/triggers-management',
    phase: 'response',
    stepNumber: 10,
    estimatedDuration: '2-3 min',
    badge: 'LIVE'
  },
  {
    id: 'collaboration',
    label: 'Team Coordination',
    description: 'Coordinate execution across teams',
    icon: 'MessageSquare',
    route: '/collaboration',
    phase: 'response',
    stepNumber: 11,
    estimatedDuration: '3-5 min',
    badge: 'LIVE'
  },

  // Operations & Performance
  {
    id: 'playbook-library',
    label: 'Playbook Library',
    description: '166 strategic playbooks across 9 domains',
    icon: 'Target',
    route: '/playbook-library',
    phase: 'execution',
    stepNumber: 12,
    estimatedDuration: '5-7 min',
    badge: 'PRO'
  },
  {
    id: 'flux-adapt',
    label: 'Flux Adaptations',
    description: 'Monitor organizational change and adaptation',
    icon: 'TrendingUp',
    route: '/flux',
    phase: 'execution',
    stepNumber: 13,
    estimatedDuration: '3-4 min',
    badge: 'AI'
  },
  {
    id: 'echo-culture',
    label: 'Echo Cultural Analytics',
    description: 'Track team sentiment and performance',
    icon: 'Users',
    route: '/echo',
    phase: 'execution',
    stepNumber: 14,
    estimatedDuration: '3-4 min',
    badge: 'AI'
  },
  {
    id: 'nova-innovation',
    label: 'Nova Innovations',
    description: 'Monitor innovation pipeline and opportunities',
    icon: 'Lightbulb',
    route: '/nova',
    phase: 'execution',
    stepNumber: 15,
    estimatedDuration: '3-4 min',
    badge: 'AI'
  },

  // Analytics & Intelligence
  {
    id: 'exec-analytics',
    label: 'Executive Dashboard',
    description: 'Strategic performance metrics and insights',
    icon: 'TrendingUp',
    route: '/executive-analytics-dashboard',
    phase: 'measurement',
    stepNumber: 16,
    estimatedDuration: '5-7 min',
    badge: 'C-SUITE'
  },
  {
    id: 'advanced-analytics',
    label: 'Advanced Intelligence',
    description: 'Deep analysis and predictive insights',
    icon: 'BarChart3',
    route: '/advanced-analytics',
    phase: 'measurement',
    stepNumber: 17,
    estimatedDuration: '4-6 min',
    badge: 'PRO'
  },
  {
    id: 'audit-compliance',
    label: 'Governance & Compliance',
    description: 'Audit trails and compliance reporting',
    icon: 'Shield',
    route: '/audit-logging-center',
    phase: 'measurement',
    stepNumber: 18,
    estimatedDuration: '3-5 min',
    badge: 'SOX'
  }
];

// Helper functions
export const getStepsByPhase = (phase: WorkflowPhase) => 
  workflowSteps.filter(step => step.phase === phase);

export const getPhaseByRoute = (route: string): WorkflowPhase | null => {
  const step = workflowSteps.find(s => s.route === route);
  return step?.phase || null;
};

export const getNextStep = (currentRoute: string): WorkflowStep | null => {
  const currentIndex = workflowSteps.findIndex(s => s.route === currentRoute);
  return currentIndex >= 0 && currentIndex < workflowSteps.length - 1
    ? workflowSteps[currentIndex + 1]
    : null;
};

export const getCurrentStepNumber = (route: string): number => {
  const step = workflowSteps.find(s => s.route === route);
  return step?.stepNumber || 0;
};

export const getTotalSteps = () => workflowSteps.length;

export const getProgressPercentage = (route: string): number => {
  const currentStep = getCurrentStepNumber(route);
  return Math.round((currentStep / getTotalSteps()) * 100);
};




========================================
FILE: client/src/pages/TaskManagement.tsx
========================================
import { useState, useMemo } from "react";
import { useQuery, useMutation } from "@tanstack/react-query";
import { useLocation } from "wouter";
import StandardNav from "@/components/layout/StandardNav";
import Footer from "@/components/layout/Footer";
import { useCustomer } from "@/contexts/CustomerContext";
import { queryClient, apiRequest } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";

import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Switch } from "@/components/ui/switch";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { ScrollArea } from "@/components/ui/scroll-area";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";

import {
  Plus,
  Search,
  Clock,
  Users,
  CheckCircle2,
  Circle,
  ArrowRight,
  Timer,
  GitBranch,
  Edit,
  Trash2,
  AlertTriangle,
  Layers,
  ListChecks,
  Library,
  Filter,
  Briefcase,
  Shield,
  Zap,
  Target,
  BookOpen,
} from "lucide-react";

import { 
  ENTERPRISE_TASK_LIBRARY, 
  TASK_CATEGORIES, 
  IDEA_PHASES,
  type TaskTemplate,
  type TaskCategory,
  type IdeaPhase,
  getTaskLibraryStats,
} from "@shared/constants/taskLibrary";

interface Task {
  id: string;
  templateId?: string; // Original template ID from library for duplicate detection
  title: string;
  description: string;
  assignedRole: string;
  estimatedMinutes: number;
  priority: 'critical' | 'high' | 'medium' | 'low';
  status: 'pending' | 'in_progress' | 'completed' | 'blocked';
  dependsOn: string[];
  approvalRequired: string;
  deliverables: string;
  playbookId?: string;
  playbookName?: string;
}

const STAKEHOLDER_ROLES = [
  "CEO", "COO", "CFO", "CLO", "CTO", "CISO", "CMO", "CHRO",
  "General Counsel", "VP Operations", "VP Strategy", "VP Communications",
  "Director of Risk", "Director of Compliance", "Project Manager",
  "Legal Counsel", "HR Director", "IT Director", "Security Lead"
];

const PRIORITY_CONFIG = {
  critical: { label: "Critical", color: "bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400" },
  high: { label: "High", color: "bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400" },
  medium: { label: "Medium", color: "bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400" },
  low: { label: "Low", color: "bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400" },
};

const STATUS_CONFIG = {
  pending: { label: "Pending", icon: Circle, color: "text-slate-400" },
  in_progress: { label: "In Progress", icon: Timer, color: "text-blue-500" },
  completed: { label: "Completed", icon: CheckCircle2, color: "text-green-500" },
  blocked: { label: "Blocked", icon: AlertTriangle, color: "text-red-500" },
};

const APPROVAL_TYPES = [
  { value: "none", label: "No approval needed" },
  { value: "manager", label: "Manager approval" },
  { value: "director", label: "Director approval" },
  { value: "vp", label: "VP approval" },
  { value: "c_suite", label: "C-Suite approval" },
  { value: "board", label: "Board approval" }
];

const generateId = () => Math.random().toString(36).substring(2, 11);

// Convert library template to playbook task format
const templateToTask = (template: TaskTemplate): Task => ({
  id: template.id,
  templateId: template.id, // Preserve original template ID for duplicate detection
  title: template.title,
  description: template.description,
  assignedRole: template.suggestedOwner,
  estimatedMinutes: template.estimatedMinutes,
  priority: template.priority,
  status: 'pending',
  dependsOn: [],
  approvalRequired: template.approvalRequired,
  deliverables: template.deliverables,
});

// Pre-load critical tasks from the library - these are the essential tasks everyone needs
const CRITICAL_PRELOADED_TASKS = ENTERPRISE_TASK_LIBRARY
  .filter(t => t.priority === 'critical' || (t.priority === 'high' && t.phase === 'detect'))
  .slice(0, 12)
  .map(templateToTask);

// Build dependency chain for critical tasks - preserve templateId for duplicate detection
const DEFAULT_TASKS: Task[] = CRITICAL_PRELOADED_TASKS.map((task, index) => ({
  ...task,
  id: String(index + 1),
  templateId: task.templateId, // Keep original template ID
  dependsOn: index === 0 ? [] : [String(index)],
}));

export default function TaskManagement() {
  const { organization } = useCustomer();
  const { toast } = useToast();
  const [search, setSearch] = useState("");
  const [tasks, setTasks] = useState<Task[]>(DEFAULT_TASKS);
  const [editingTask, setEditingTask] = useState<Task | null>(null);
  const [deleteId, setDeleteId] = useState<string | null>(null);
  const [isDialogOpen, setIsDialogOpen] = useState(false);
  const [activeTab, setActiveTab] = useState<"playbook" | "library">("playbook");
  
  // Library filters
  const [librarySearch, setLibrarySearch] = useState("");
  const [selectedPhase, setSelectedPhase] = useState<IdeaPhase | "all">("all");
  const [selectedCategory, setSelectedCategory] = useState<TaskCategory | "all">("all");
  
  // Track which library tasks have been added (by templateId for proper duplicate detection)
  const addedLibraryIds = useMemo(() => new Set(tasks.map(t => t.templateId).filter(Boolean)), [tasks]);

  const [formData, setFormData] = useState<Partial<Task>>({
    title: '',
    description: '',
    assignedRole: '',
    estimatedMinutes: 15,
    priority: 'medium',
    status: 'pending',
    dependsOn: [],
    approvalRequired: 'none',
    deliverables: '',
  });
  
  // Filter library tasks
  const filteredLibraryTasks = useMemo(() => {
    return ENTERPRISE_TASK_LIBRARY.filter(task => {
      const matchesSearch = !librarySearch || 
        task.title.toLowerCase().includes(librarySearch.toLowerCase()) ||
        task.description.toLowerCase().includes(librarySearch.toLowerCase()) ||
        task.suggestedOwner.toLowerCase().includes(librarySearch.toLowerCase());
      
      const matchesPhase = selectedPhase === "all" || task.phase === selectedPhase;
      const matchesCategory = selectedCategory === "all" || task.category === selectedCategory;
      
      return matchesSearch && matchesPhase && matchesCategory;
    });
  }, [librarySearch, selectedPhase, selectedCategory]);
  
  // Library stats
  const libraryStats = useMemo(() => getTaskLibraryStats(), []);
  
  // Add task from library
  const handleAddFromLibrary = (template: TaskTemplate) => {
    // Prevent duplicates using templateId
    if (addedLibraryIds.has(template.id)) {
      toast({
        title: "Already Added",
        description: `"${template.title}" is already in your playbook.`,
        variant: "destructive",
      });
      return;
    }
    
    const existingIds = tasks.map(t => parseInt(t.id)).filter(n => !isNaN(n));
    const nextId = Math.max(0, ...existingIds) + 1;
    
    const newTask: Task = {
      ...templateToTask(template),
      id: String(nextId),
      templateId: template.id, // Preserve for duplicate detection
      dependsOn: tasks.length > 0 ? [tasks[tasks.length - 1].id] : [],
    };
    
    setTasks([...tasks, newTask]);
    toast({
      title: "Task Added",
      description: `"${template.title}" has been added to your playbook.`,
    });
  };
  
  // Add multiple tasks from library by phase
  const handleAddPhaseTasksFromLibrary = (phase: IdeaPhase) => {
    // Check by template id for proper duplicate detection
    const phaseTasks = ENTERPRISE_TASK_LIBRARY.filter(t => t.phase === phase && !addedLibraryIds.has(t.id));
    if (phaseTasks.length === 0) {
      toast({
        title: "No New Tasks",
        description: `All ${IDEA_PHASES[phase].label} tasks are already in your playbook.`,
      });
      return;
    }
    
    let lastId = Math.max(0, ...tasks.map(t => parseInt(t.id)).filter(n => !isNaN(n)));
    const newTasks = phaseTasks.map((template, index) => {
      lastId++;
      return {
        ...templateToTask(template),
        id: String(lastId),
        templateId: template.id, // Preserve templateId for duplicate detection
        dependsOn: index === 0 && tasks.length > 0 ? [tasks[tasks.length - 1].id] : index > 0 ? [String(lastId - 1)] : [],
      };
    });
    
    setTasks([...tasks, ...newTasks]);
    toast({
      title: "Tasks Added",
      description: `${newTasks.length} ${IDEA_PHASES[phase].label} tasks have been added.`,
    });
  };

  const filteredTasks = tasks.filter(task =>
    !search || 
    task.title.toLowerCase().includes(search.toLowerCase()) ||
    task.assignedRole.toLowerCase().includes(search.toLowerCase())
  );

  const stats = {
    total: tasks.length,
    pending: tasks.filter(t => t.status === 'pending').length,
    inProgress: tasks.filter(t => t.status === 'in_progress').length,
    completed: tasks.filter(t => t.status === 'completed').length,
    totalMinutes: tasks.reduce((sum, t) => sum + t.estimatedMinutes, 0),
  };

  const handleOpenCreate = () => {
    setFormData({
      title: '',
      description: '',
      assignedRole: '',
      estimatedMinutes: 15,
      priority: 'medium',
      status: 'pending',
      dependsOn: [],
      approvalRequired: 'none',
      deliverables: '',
    });
    setEditingTask(null);
    setIsDialogOpen(true);
  };

  const handleOpenEdit = (task: Task) => {
    setFormData({ ...task });
    setEditingTask(task);
    setIsDialogOpen(true);
  };

  const handleSave = () => {
    if (!formData.title || !formData.assignedRole) {
      toast({
        title: "Missing Fields",
        description: "Please fill in title and assigned role.",
        variant: "destructive",
      });
      return;
    }

    if (editingTask) {
      setTasks(tasks.map(t => 
        t.id === editingTask.id 
          ? { ...t, ...formData } as Task
          : t
      ));
      toast({ title: "Task Updated", description: "The task has been updated." });
    } else {
      const newTask: Task = {
        id: generateId(),
        title: formData.title || '',
        description: formData.description || '',
        assignedRole: formData.assignedRole || '',
        estimatedMinutes: formData.estimatedMinutes || 15,
        priority: formData.priority as Task['priority'] || 'medium',
        status: formData.status as Task['status'] || 'pending',
        dependsOn: formData.dependsOn || [],
        approvalRequired: formData.approvalRequired || 'none',
        deliverables: formData.deliverables || '',
      };
      setTasks([...tasks, newTask]);
      toast({ title: "Task Created", description: "New task has been added." });
    }
    setIsDialogOpen(false);
  };

  const handleDelete = () => {
    if (deleteId) {
      setTasks(tasks.filter(t => t.id !== deleteId));
      setDeleteId(null);
      toast({ title: "Task Deleted", description: "The task has been removed." });
    }
  };

  const handleToggleDependency = (taskId: string) => {
    const current = formData.dependsOn || [];
    if (current.includes(taskId)) {
      setFormData({ ...formData, dependsOn: current.filter(id => id !== taskId) });
    } else {
      setFormData({ ...formData, dependsOn: [...current, taskId] });
    }
  };

  return (
    <>
      <StandardNav />
      
      <main className="max-w-7xl mx-auto px-6 py-12">
        <header className="mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <h1 className="text-3xl font-bold text-slate-900 dark:text-white" data-testid="text-page-title">
              Task Management
            </h1>
            <p className="text-slate-600 dark:text-slate-400 mt-1">
              Define and manage execution tasks with dependencies and approval gates
            </p>
          </div>
          <Button 
            onClick={handleOpenCreate}
            className="bg-purple-600 hover:bg-purple-700"
            data-testid="button-create-task"
          >
            <Plus className="h-4 w-4 mr-2" />
            Add Task
          </Button>
        </header>

        <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
          <Card data-testid="stat-total">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                  <ListChecks className="h-5 w-5 text-slate-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-slate-900 dark:text-white">{stats.total}</p>
                  <p className="text-sm text-slate-500">Total Tasks</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-pending">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg">
                  <Circle className="h-5 w-5 text-slate-400" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-slate-600">{stats.pending}</p>
                  <p className="text-sm text-slate-500">Pending</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-in-progress">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                  <Timer className="h-5 w-5 text-blue-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-blue-600">{stats.inProgress}</p>
                  <p className="text-sm text-slate-500">In Progress</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-completed">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg">
                  <CheckCircle2 className="h-5 w-5 text-green-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-green-600">{stats.completed}</p>
                  <p className="text-sm text-slate-500">Completed</p>
                </div>
              </div>
            </CardContent>
          </Card>
          <Card data-testid="stat-duration">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                  <Clock className="h-5 w-5 text-purple-600" />
                </div>
                <div>
                  <p className="text-2xl font-bold text-purple-600">{stats.totalMinutes}m</p>
                  <p className="text-sm text-slate-500">Total Duration</p>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>

        <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as "playbook" | "library")} className="mb-6">
          <TabsList className="grid w-full max-w-md grid-cols-2">
            <TabsTrigger value="playbook" className="flex items-center gap-2" data-testid="tab-playbook-tasks">
              <ListChecks className="h-4 w-4" />
              Playbook Tasks ({tasks.length})
            </TabsTrigger>
            <TabsTrigger value="library" className="flex items-center gap-2" data-testid="tab-task-library">
              <Library className="h-4 w-4" />
              Task Library ({libraryStats.total})
            </TabsTrigger>
          </TabsList>
          
          <TabsContent value="playbook" className="mt-6">
            <Card className="mb-6">
              <CardContent className="p-4">
                <div className="relative">
                  <Search className="absolute left-3 top-2.5 h-4 w-4 text-slate-400" />
                  <Input
                    placeholder="Search tasks..."
                    value={search}
                    onChange={(e) => setSearch(e.target.value)}
                    className="pl-10"
                    data-testid="input-search"
                  />
                </div>
              </CardContent>
            </Card>

            <div className="space-y-4">
          {filteredTasks.length === 0 ? (
            <Card>
              <CardContent className="py-16 text-center">
                <ListChecks className="h-12 w-12 mx-auto mb-4 text-slate-300" />
                <h3 className="text-lg font-medium text-slate-900 dark:text-white mb-2">No Tasks Found</h3>
                <p className="text-slate-500 mb-6">Start by creating your first execution task.</p>
                <Button onClick={handleOpenCreate} data-testid="button-add-first-task">
                  <Plus className="h-4 w-4 mr-2" />
                  Add Task
                </Button>
              </CardContent>
            </Card>
          ) : (
            filteredTasks.map((task, index) => {
              const StatusIcon = STATUS_CONFIG[task.status].icon;
              const priorityConfig = PRIORITY_CONFIG[task.priority];
              const dependencies = task.dependsOn.map(id => tasks.find(t => t.id === id)?.title || id).join(', ');

              return (
                <Card key={task.id} data-testid={`card-task-${task.id}`}>
                  <CardContent className="p-4">
                    <div className="flex items-start gap-4">
                      <div className="flex flex-col items-center gap-1 min-w-[40px]">
                        <div className="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-sm font-bold">
                          {index + 1}
                        </div>
                        {index < filteredTasks.length - 1 && (
                          <div className="w-0.5 h-8 bg-slate-200 dark:bg-slate-700" />
                        )}
                      </div>
                      
                      <div className="flex-1 min-w-0">
                        <div className="flex items-start justify-between gap-4">
                          <div className="flex-1">
                            <div className="flex items-center gap-2 mb-1">
                              <StatusIcon className={`h-4 w-4 ${STATUS_CONFIG[task.status].color}`} />
                              <h3 className="font-semibold text-slate-900 dark:text-white">{task.title}</h3>
                            </div>
                            <p className="text-sm text-slate-500 mb-3">{task.description}</p>
                            
                            <div className="flex flex-wrap gap-2">
                              <Badge variant="outline" className="text-xs">
                                <Users className="h-3 w-3 mr-1" />
                                {task.assignedRole}
                              </Badge>
                              <Badge variant="outline" className="text-xs">
                                <Clock className="h-3 w-3 mr-1" />
                                {task.estimatedMinutes} min
                              </Badge>
                              <Badge className={priorityConfig.color}>
                                {priorityConfig.label}
                              </Badge>
                              {task.approvalRequired !== 'none' && (
                                <Badge variant="outline" className="text-xs text-purple-600 border-purple-300">
                                  <GitBranch className="h-3 w-3 mr-1" />
                                  {APPROVAL_TYPES.find(a => a.value === task.approvalRequired)?.label}
                                </Badge>
                              )}
                              {task.dependsOn.length > 0 && (
                                <Badge variant="outline" className="text-xs text-amber-600 border-amber-300">
                                  <ArrowRight className="h-3 w-3 mr-1" />
                                  Depends on: {dependencies}
                                </Badge>
                              )}
                            </div>
                          </div>
                          
                          <div className="flex gap-2">
                            <Button 
                              variant="ghost" 
                              size="sm" 
                              onClick={() => handleOpenEdit(task)}
                              data-testid={`button-edit-${task.id}`}
                            >
                              <Edit className="h-4 w-4" />
                            </Button>
                            <Button 
                              variant="ghost" 
                              size="sm" 
                              onClick={() => setDeleteId(task.id)}
                              className="text-red-600 hover:text-red-700"
                              data-testid={`button-delete-${task.id}`}
                            >
                              <Trash2 className="h-4 w-4" />
                            </Button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              );
            })
          )}
            </div>
          </TabsContent>
          
          <TabsContent value="library" className="mt-6">
            <div className="space-y-6">
              {/* Library Header with Stats */}
              <Card className="bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-950/40 dark:to-purple-950/40 border-indigo-200 dark:border-indigo-800">
                <CardContent className="p-6">
                  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                      <h2 className="text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                        <BookOpen className="h-5 w-5 text-indigo-600" />
                        Enterprise Task Library
                      </h2>
                      <p className="text-slate-600 dark:text-slate-400 mt-1">
                        {libraryStats.total} pre-defined tasks across all IDEA phases. Add tasks to your playbook to ensure everyone knows their role.
                      </p>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      <Badge variant="outline" className="bg-white dark:bg-slate-900">
                        <Target className="h-3 w-3 mr-1 text-blue-600" />
                        {libraryStats.phases.identify} IDENTIFY
                      </Badge>
                      <Badge variant="outline" className="bg-white dark:bg-slate-900">
                        <Zap className="h-3 w-3 mr-1 text-amber-600" />
                        {libraryStats.phases.detect} DETECT
                      </Badge>
                      <Badge variant="outline" className="bg-white dark:bg-slate-900">
                        <Shield className="h-3 w-3 mr-1 text-green-600" />
                        {libraryStats.phases.execute} EXECUTE
                      </Badge>
                      <Badge variant="outline" className="bg-white dark:bg-slate-900">
                        <Briefcase className="h-3 w-3 mr-1 text-purple-600" />
                        {libraryStats.phases.advance} ADVANCE
                      </Badge>
                    </div>
                  </div>
                </CardContent>
              </Card>
              
              {/* Quick Add by Phase */}
              <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                {(Object.keys(IDEA_PHASES) as IdeaPhase[]).map((phase) => (
                  <Button
                    key={phase}
                    variant="outline"
                    className="h-auto py-3 flex flex-col items-center gap-1"
                    onClick={() => handleAddPhaseTasksFromLibrary(phase)}
                    data-testid={`button-add-phase-${phase}`}
                  >
                    <span className={`text-xs font-bold ${IDEA_PHASES[phase].color}`}>
                      {IDEA_PHASES[phase].label}
                    </span>
                    <span className="text-xs text-slate-500">Add all tasks</span>
                  </Button>
                ))}
              </div>
              
              {/* Filters */}
              <Card>
                <CardContent className="p-4">
                  <div className="flex flex-col md:flex-row gap-4">
                    <div className="flex-1 relative">
                      <Search className="absolute left-3 top-2.5 h-4 w-4 text-slate-400" />
                      <Input
                        placeholder="Search tasks..."
                        value={librarySearch}
                        onChange={(e) => setLibrarySearch(e.target.value)}
                        className="pl-10"
                        data-testid="input-library-search"
                      />
                    </div>
                    <Select value={selectedPhase} onValueChange={(v) => setSelectedPhase(v as IdeaPhase | "all")}>
                      <SelectTrigger className="w-40" data-testid="select-filter-phase">
                        <Filter className="h-4 w-4 mr-2" />
                        <SelectValue placeholder="Phase" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="all">All Phases</SelectItem>
                        {(Object.keys(IDEA_PHASES) as IdeaPhase[]).map((phase) => (
                          <SelectItem key={phase} value={phase}>{IDEA_PHASES[phase].label}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    <Select value={selectedCategory} onValueChange={(v) => setSelectedCategory(v as TaskCategory | "all")}>
                      <SelectTrigger className="w-48" data-testid="select-filter-category">
                        <Layers className="h-4 w-4 mr-2" />
                        <SelectValue placeholder="Category" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="all">All Categories</SelectItem>
                        {(Object.keys(TASK_CATEGORIES) as TaskCategory[]).map((cat) => (
                          <SelectItem key={cat} value={cat}>{TASK_CATEGORIES[cat].label}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                </CardContent>
              </Card>
              
              {/* Task Library Grid */}
              <div className="grid gap-4 md:grid-cols-2">
                {filteredLibraryTasks.map((template) => {
                  const isAdded = addedLibraryIds.has(template.id);
                  const categoryConfig = TASK_CATEGORIES[template.category];
                  const phaseConfig = IDEA_PHASES[template.phase];
                  
                  return (
                    <Card 
                      key={template.id} 
                      className={`transition-all ${isAdded ? 'opacity-60 bg-green-50 dark:bg-green-950/20' : 'hover:shadow-md'}`}
                      data-testid={`card-library-task-${template.id}`}
                    >
                      <CardContent className="p-4">
                        <div className="flex items-start justify-between gap-3">
                          <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-2 mb-1">
                              <span className={`text-xs font-bold ${phaseConfig.color}`}>
                                {phaseConfig.label}
                              </span>
                              <Badge className={`text-xs ${categoryConfig.color}`}>
                                {categoryConfig.label}
                              </Badge>
                            </div>
                            <h3 className="font-semibold text-slate-900 dark:text-white text-sm mb-1">
                              {template.title}
                            </h3>
                            <p className="text-xs text-slate-500 mb-2 line-clamp-2">
                              {template.description}
                            </p>
                            <div className="flex flex-wrap gap-1.5">
                              <Badge variant="outline" className="text-xs">
                                <Users className="h-3 w-3 mr-1" />
                                {template.suggestedOwner}
                              </Badge>
                              <Badge variant="outline" className="text-xs">
                                <Clock className="h-3 w-3 mr-1" />
                                {template.estimatedMinutes}m
                              </Badge>
                              <Badge className={PRIORITY_CONFIG[template.priority].color}>
                                {PRIORITY_CONFIG[template.priority].label}
                              </Badge>
                            </div>
                          </div>
                          <Button
                            size="sm"
                            variant={isAdded ? "ghost" : "default"}
                            disabled={isAdded}
                            onClick={() => handleAddFromLibrary(template)}
                            className={isAdded ? "text-green-600" : ""}
                            data-testid={`button-add-library-task-${template.id}`}
                          >
                            {isAdded ? (
                              <>
                                <CheckCircle2 className="h-4 w-4 mr-1" />
                                Added
                              </>
                            ) : (
                              <>
                                <Plus className="h-4 w-4 mr-1" />
                                Add
                              </>
                            )}
                          </Button>
                        </div>
                      </CardContent>
                    </Card>
                  );
                })}
              </div>
              
              {filteredLibraryTasks.length === 0 && (
                <Card>
                  <CardContent className="py-12 text-center">
                    <Library className="h-12 w-12 mx-auto mb-4 text-slate-300" />
                    <h3 className="text-lg font-medium text-slate-900 dark:text-white mb-2">No Tasks Found</h3>
                    <p className="text-slate-500">Try adjusting your filters or search terms.</p>
                  </CardContent>
                </Card>
              )}
            </div>
          </TabsContent>
        </Tabs>

        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
          <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
            <DialogHeader>
              <DialogTitle>{editingTask ? 'Edit Task' : 'Create New Task'}</DialogTitle>
              <DialogDescription>
                Define the task details, dependencies, and approval requirements.
              </DialogDescription>
            </DialogHeader>
            
            <div className="space-y-4 py-4">
              <div className="space-y-2">
                <Label htmlFor="title">Task Title *</Label>
                <Input
                  id="title"
                  value={formData.title || ''}
                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                  placeholder="Enter task title"
                  data-testid="input-task-title"
                />
              </div>

              <div className="space-y-2">
                <Label htmlFor="description">Description</Label>
                <Textarea
                  id="description"
                  value={formData.description || ''}
                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  placeholder="Describe what this task involves"
                  data-testid="input-task-description"
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label>Assigned Role *</Label>
                  <Select 
                    value={formData.assignedRole || ''} 
                    onValueChange={(v) => setFormData({ ...formData, assignedRole: v })}
                  >
                    <SelectTrigger data-testid="select-assigned-role">
                      <SelectValue placeholder="Select role" />
                    </SelectTrigger>
                    <SelectContent>
                      {STAKEHOLDER_ROLES.map(role => (
                        <SelectItem key={role} value={role}>{role}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>

                <div className="space-y-2">
                  <Label htmlFor="estimatedMinutes">Estimated Duration (min)</Label>
                  <Input
                    id="estimatedMinutes"
                    type="number"
                    value={formData.estimatedMinutes || 15}
                    onChange={(e) => setFormData({ ...formData, estimatedMinutes: parseInt(e.target.value) || 15 })}
                    data-testid="input-estimated-minutes"
                  />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label>Priority</Label>
                  <Select 
                    value={formData.priority || 'medium'} 
                    onValueChange={(v) => setFormData({ ...formData, priority: v as Task['priority'] })}
                  >
                    <SelectTrigger data-testid="select-priority">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="critical">Critical</SelectItem>
                      <SelectItem value="high">High</SelectItem>
                      <SelectItem value="medium">Medium</SelectItem>
                      <SelectItem value="low">Low</SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                <div className="space-y-2">
                  <Label>Status</Label>
                  <Select 
                    value={formData.status || 'pending'} 
                    onValueChange={(v) => setFormData({ ...formData, status: v as Task['status'] })}
                  >
                    <SelectTrigger data-testid="select-status">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="pending">Pending</SelectItem>
                      <SelectItem value="in_progress">In Progress</SelectItem>
                      <SelectItem value="completed">Completed</SelectItem>
                      <SelectItem value="blocked">Blocked</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>

              <div className="space-y-2">
                <Label>Approval Required</Label>
                <Select 
                  value={formData.approvalRequired || 'none'} 
                  onValueChange={(v) => setFormData({ ...formData, approvalRequired: v })}
                >
                  <SelectTrigger data-testid="select-approval">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    {APPROVAL_TYPES.map(type => (
                      <SelectItem key={type.value} value={type.value}>{type.label}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>

              <div className="space-y-2">
                <Label>Dependencies (Tasks that must complete first)</Label>
                <div className="grid grid-cols-2 gap-2 p-3 border rounded-lg max-h-40 overflow-y-auto">
                  {tasks.filter(t => t.id !== editingTask?.id).map(task => (
                    <div key={task.id} className="flex items-center gap-2">
                      <Switch
                        checked={formData.dependsOn?.includes(task.id) || false}
                        onCheckedChange={() => handleToggleDependency(task.id)}
                      />
                      <span className="text-sm truncate">{task.title}</span>
                    </div>
                  ))}
                </div>
              </div>

              <div className="space-y-2">
                <Label htmlFor="deliverables">Deliverables</Label>
                <Textarea
                  id="deliverables"
                  value={formData.deliverables || ''}
                  onChange={(e) => setFormData({ ...formData, deliverables: e.target.value })}
                  placeholder="Expected outputs from this task"
                  data-testid="input-deliverables"
                />
              </div>
            </div>

            <DialogFooter>
              <Button variant="outline" onClick={() => setIsDialogOpen(false)} data-testid="button-cancel">
                Cancel
              </Button>
              <Button onClick={handleSave} data-testid="button-save-task">
                {editingTask ? 'Update Task' : 'Create Task'}
              </Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>

        <AlertDialog open={!!deleteId} onOpenChange={() => setDeleteId(null)}>
          <AlertDialogContent>
            <AlertDialogHeader>
              <AlertDialogTitle>Delete Task</AlertDialogTitle>
              <AlertDialogDescription>
                Are you sure you want to delete this task? This action cannot be undone.
              </AlertDialogDescription>
            </AlertDialogHeader>
            <AlertDialogFooter>
              <AlertDialogCancel data-testid="button-cancel-delete">Cancel</AlertDialogCancel>
              <AlertDialogAction
                onClick={handleDelete}
                className="bg-red-600 hover:bg-red-700"
                data-testid="button-confirm-delete"
              >
                Delete
              </AlertDialogAction>
            </AlertDialogFooter>
          </AlertDialogContent>
        </AlertDialog>
      </main>

      <Footer />
    </>
  );
}
