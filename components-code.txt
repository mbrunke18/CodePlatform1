# M Platform - Components Code
# UI components, forms, dashboards
# Generated: Fri Jan  2 06:26:13 PM UTC 2026

========================================
FILE: client/src/components/ui/accordion.tsx
========================================
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }


========================================
FILE: client/src/components/ui/alert-dialog.tsx
========================================
import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}


========================================
FILE: client/src/components/ui/alert.tsx
========================================
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }


========================================
FILE: client/src/components/ui/aspect-ratio.tsx
========================================
import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }


========================================
FILE: client/src/components/ui/avatar.tsx
========================================
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }


========================================
FILE: client/src/components/ui/badge.tsx
========================================
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }


========================================
FILE: client/src/components/ui/breadcrumb.tsx
========================================
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:w-3.5 [&>svg]:h-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}


========================================
FILE: client/src/components/ui/button.tsx
========================================
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }


========================================
FILE: client/src/components/ui/calendar.tsx
========================================
import * as React from "react"
import { ChevronLeft, ChevronRight } from "lucide-react"
import { DayPicker } from "react-day-picker"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

export type CalendarProps = React.ComponentProps<typeof DayPicker>

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ className, ...props }) => (
          <ChevronLeft className={cn("h-4 w-4", className)} {...props} />
        ),
        IconRight: ({ className, ...props }) => (
          <ChevronRight className={cn("h-4 w-4", className)} {...props} />
        ),
      }}
      {...props}
    />
  )
}
Calendar.displayName = "Calendar"

export { Calendar }


========================================
FILE: client/src/components/ui/card.tsx
========================================
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }


========================================
FILE: client/src/components/ui/carousel.tsx
========================================
import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}


========================================
FILE: client/src/components/ui/chart.tsx
========================================
"use client"

import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item?.dataKey || item?.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}


========================================
FILE: client/src/components/ui/checkbox.tsx
========================================
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }


========================================
FILE: client/src/components/ui/collapsible.tsx
========================================
"use client"

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }


========================================
FILE: client/src/components/ui/command.tsx
========================================
import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

const CommandDialog = ({ children, ...props }: DialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}


========================================
FILE: client/src/components/ui/context-menu.tsx
========================================
import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}


========================================
FILE: client/src/components/ui/dialog.tsx
========================================
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}


========================================
FILE: client/src/components/ui/drawer.tsx
========================================
"use client"

import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}


========================================
FILE: client/src/components/ui/dropdown-menu.tsx
========================================
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}


========================================
FILE: client/src/components/ui/enterprise-metrics.tsx
========================================
import { useEffect, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { 
  TrendingUp, 
  TrendingDown, 
  Activity, 
  BarChart3, 
  PieChart, 
  Target, 
  Zap,
  Brain,
  Users,
  Shield
} from 'lucide-react';

interface EnterpriseMetric {
  id: string;
  category: string;
  name: string;
  value: number;
  displayValue: string;
  unit: string;
  change: number;
  trend: 'up' | 'down' | 'stable';
  benchmarkPercentile: number;
  confidence: number;
  lastUpdate: Date;
  metadata: Record<string, any>;
}

interface LiveMetricsProps {
  organizationId?: string;
  className?: string;
}

export function LiveEnterpriseMetrics({ organizationId = "demo", className = "" }: LiveMetricsProps) {
  const [metrics, setMetrics] = useState<EnterpriseMetric[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [lastUpdate, setLastUpdate] = useState<Date>(new Date());

  useEffect(() => {
    const fetchMetrics = async () => {
      try {
        const response = await fetch('/api/pulse/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ organizationId })
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.success && data.metrics) {
            const enterpriseMetrics: EnterpriseMetric[] = data.metrics.map((m: any) => ({
              id: m.id,
              category: m.category,
              name: m.metricName,
              value: parseFloat(m.value),
              displayValue: m.value,
              unit: m.unit,
              change: Math.random() * 5 - 2.5, // Simulated change for demo
              trend: Math.random() > 0.3 ? 'up' : 'down',
              benchmarkPercentile: m.metadata?.benchmarkPercentile || 85,
              confidence: m.metadata?.confidence || 0.9,
              lastUpdate: new Date(m.timestamp),
              metadata: m.metadata || {}
            }));
            setMetrics(enterpriseMetrics);
            setLastUpdate(new Date());
          }
        }
      } catch (error) {
        console.error('Error fetching enterprise metrics:', error);
      } finally {
        setIsLoading(false);
      }
    };

    fetchMetrics();
    const interval = setInterval(fetchMetrics, 10000); // Update every 10 seconds
    return () => clearInterval(interval);
  }, [organizationId]);

  const getIcon = (category: string) => {
    switch (category.toLowerCase()) {
      case 'performance': return <BarChart3 className="w-5 h-5" />;
      case 'productivity': return <TrendingUp className="w-5 h-5" />;
      case 'innovation': return <Zap className="w-5 h-5" />;
      case 'culture': return <Users className="w-5 h-5" />;
      case 'strategy': return <Target className="w-5 h-5" />;
      default: return <Activity className="w-5 h-5" />;
    }
  };

  const getColorByCategory = (category: string) => {
    switch (category.toLowerCase()) {
      case 'performance': return { bg: 'from-blue-500/20 to-cyan-500/20', text: 'text-blue-400' };
      case 'productivity': return { bg: 'from-green-500/20 to-emerald-500/20', text: 'text-green-400' };
      case 'innovation': return { bg: 'from-yellow-500/20 to-orange-500/20', text: 'text-yellow-400' };
      case 'culture': return { bg: 'from-purple-500/20 to-indigo-500/20', text: 'text-purple-400' };
      case 'strategy': return { bg: 'from-red-500/20 to-pink-500/20', text: 'text-red-400' };
      default: return { bg: 'from-gray-500/20 to-slate-500/20', text: 'text-gray-400' };
    }
  };

  if (isLoading) {
    return (
      <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 ${className}`}>
        {Array.from({ length: 6 }).map((_, i) => (
          <Card key={i} className="bg-black/40 border-gray-700/50 animate-pulse">
            <CardContent className="p-6">
              <div className="flex items-center space-x-3 mb-4">
                <div className="w-10 h-10 bg-gray-600/50 rounded-lg" />
                <div className="space-y-2">
                  <div className="h-4 w-24 bg-gray-600/50 rounded" />
                  <div className="h-3 w-16 bg-gray-600/50 rounded" />
                </div>
              </div>
              <div className="space-y-3">
                <div className="h-8 w-20 bg-gray-600/50 rounded" />
                <div className="h-2 w-full bg-gray-600/50 rounded" />
                <div className="h-3 w-32 bg-gray-600/50 rounded" />
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
    );
  }

  return (
    <div className={`space-y-6 ${className}`}>
      {/* Metrics Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {metrics.map((metric) => {
          const colors = getColorByCategory(metric.category);
          const icon = getIcon(metric.category);
          
          return (
            <Card key={metric.id} className="bg-black/40 border-gray-700/50 backdrop-blur-sm hover:bg-black/60 transition-all duration-500 group">
              <CardContent className="p-6">
                <div className="flex items-center justify-between mb-4">
                  <div className={`p-3 rounded-lg bg-gradient-to-r ${colors.bg} group-hover:scale-105 transition-transform duration-300`}>
                    <div className={colors.text}>
                      {icon}
                    </div>
                  </div>
                  <div className="text-right">
                    <div className="flex items-center space-x-1">
                      {metric.trend === 'up' ? (
                        <TrendingUp className="w-4 h-4 text-green-400" />
                      ) : metric.trend === 'down' ? (
                        <TrendingDown className="w-4 h-4 text-red-400" />
                      ) : (
                        <div className="w-4 h-4 rounded-full bg-yellow-400" />
                      )}
                      <span className={`text-sm font-medium ${
                        metric.trend === 'up' ? 'text-green-400' : 
                        metric.trend === 'down' ? 'text-red-400' : 'text-yellow-400'
                      }`}>
                        {metric.change > 0 ? '+' : ''}{metric.change.toFixed(1)}%
                      </span>
                    </div>
                  </div>
                </div>

                <div className="space-y-3">
                  <h3 className="font-bold text-white text-lg">{metric.name}</h3>
                  
                  <div className={`text-3xl font-bold ${colors.text} mb-2`}>
                    {metric.displayValue}
                    <span className="text-sm text-gray-400 font-normal ml-2">{metric.unit}</span>
                  </div>

                  <div className="space-y-2">
                    <div className="flex justify-between text-xs">
                      <span className="text-gray-400">Benchmark Percentile</span>
                      <span className="text-gray-300">{metric.benchmarkPercentile}th</span>
                    </div>
                    <Progress 
                      value={metric.benchmarkPercentile} 
                      className="h-2"
                    />
                  </div>

                  <div className="flex items-center justify-between pt-3 border-t border-gray-700/30">
                    <Badge variant="outline" className={`${colors.text} border-gray-600/50 text-xs`}>
                      {metric.category}
                    </Badge>
                    <div className="text-xs text-gray-500">
                      Confidence: {(metric.confidence * 100).toFixed(0)}%
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          );
        })}
      </div>

      {/* Last Update Info */}
      <div className="flex items-center justify-center space-x-4 text-sm text-gray-400">
        <div className="flex items-center">
          <Activity className="w-4 h-4 mr-2 text-green-400" />
          Live Metrics
        </div>
        <div className="w-1 h-1 bg-gray-600 rounded-full" />
        <div>Last updated: {lastUpdate.toLocaleTimeString()}</div>
        <div className="w-1 h-1 bg-gray-600 rounded-full" />
        <div className="flex items-center">
          <Brain className="w-4 h-4 mr-2 text-purple-400" />
          AI Generated
        </div>
      </div>
    </div>
  );
}

========================================
FILE: client/src/components/ui/form.tsx
========================================
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  FormProvider,
  useFormContext,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? "") : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}


========================================
FILE: client/src/components/ui/hover-card.tsx
========================================
"use client"

import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }


========================================
FILE: client/src/components/ui/input-otp.tsx
========================================
import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }


========================================
FILE: client/src/components/ui/input.tsx
========================================
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }


========================================
FILE: client/src/components/ui/label.tsx
========================================
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }


========================================
FILE: client/src/components/ui/menubar.tsx
========================================
"use client"

import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu {...props} />
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group {...props} />
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal {...props} />
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return <MenubarPrimitive.RadioGroup {...props} />
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />
}

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}


========================================
FILE: client/src/components/ui/navigation-menu.tsx
========================================
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}


========================================
FILE: client/src/components/ui/pagination.tsx
========================================
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}


========================================
FILE: client/src/components/ui/popover.tsx
========================================
import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }


========================================
FILE: client/src/components/ui/progress.tsx
========================================
"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }


========================================
FILE: client/src/components/ui/radio-group.tsx
========================================
import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }


========================================
FILE: client/src/components/ui/resizable.tsx
========================================
"use client"

import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }


========================================
FILE: client/src/components/ui/scroll-area.tsx
========================================
import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }


========================================
FILE: client/src/components/ui/select.tsx
========================================
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}


========================================
FILE: client/src/components/ui/separator.tsx
========================================
import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }


========================================
FILE: client/src/components/ui/sheet.tsx
========================================
"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}


========================================
FILE: client/src/components/ui/sidebar.tsx
========================================
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar_state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContextProps = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContextProps | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContextProps>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <SheetHeader className="sr-only">
              <SheetTitle>Sidebar</SheetTitle>
              <SheetDescription>Displays the mobile sidebar.</SheetDescription>
            </SheetHeader>
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden text-sidebar-foreground md:block"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex w-full flex-1 flex-col bg-background",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-[--skeleton-width] flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}


========================================
FILE: client/src/components/ui/skeleton.tsx
========================================
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }


========================================
FILE: client/src/components/ui/slider.tsx
========================================
import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }


========================================
FILE: client/src/components/ui/switch.tsx
========================================
import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }


========================================
FILE: client/src/components/ui/table.tsx
========================================
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}


========================================
FILE: client/src/components/ui/tabs.tsx
========================================
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }


========================================
FILE: client/src/components/ui/textarea.tsx
========================================
import * as React from "react"

import { cn } from "@/lib/utils"

const Textarea = React.forwardRef<
  HTMLTextAreaElement,
  React.ComponentProps<"textarea">
>(({ className, ...props }, ref) => {
  return (
    <textarea
      className={cn(
        "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      ref={ref}
      {...props}
    />
  )
})
Textarea.displayName = "Textarea"

export { Textarea }


========================================
FILE: client/src/components/ui/toaster.tsx
========================================
import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}


========================================
FILE: client/src/components/ui/toast.tsx
========================================
import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}


========================================
FILE: client/src/components/ui/toggle-group.tsx
========================================
"use client"

import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }


========================================
FILE: client/src/components/ui/toggle.tsx
========================================
import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3 min-w-10",
        sm: "h-9 px-2.5 min-w-9",
        lg: "h-11 px-5 min-w-11",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }


========================================
FILE: client/src/components/ui/tooltip.tsx
========================================
"use client"

import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }


========================================
FILE: client/src/components/layout/Footer.tsx
========================================
import { useLocation } from "wouter";

export default function Footer() {
  const [, setLocation] = useLocation();

  const navigateTo = (path: string) => {
    setLocation(path);
    window.scrollTo(0, 0);
  };

  const footerSections = [
    {
      title: "IDENTIFY",
      links: [
        { label: "Playbook Library (166)", path: "/playbooks" },
        { label: "Scenario Planning Hub", path: "/strategic" },
        { label: "Strategic Readiness Report", path: "/preparedness-report" },
        { label: "What-If Analyzer", path: "/what-if-analyzer" },
        { label: "Board Briefings", path: "/board-briefings" },
      ]
    },
    {
      title: "DETECT",
      links: [
        { label: "Signal Intelligence Hub", path: "/signal-intelligence" },
        { label: "AI Trigger Monitoring", path: "/triggers-management" },
        { label: "AI Radar Dashboard", path: "/ai-radar" },
        { label: "Foresight Radar", path: "/foresight-radar" },
        { label: "Weak Signal Detection", path: "/pulse-intelligence" },
      ]
    },
    {
      title: "EXECUTE",
      links: [
        { label: "Command Center", path: "/command-center" },
        { label: "Crisis Response", path: "/crisis" },
        { label: "Situation Room", path: "/war-room" },
        { label: "Practice Drills", path: "/drill-tracking" },
        { label: "Team Collaboration", path: "/collaboration" },
      ]
    },
    {
      title: "ADVANCE",
      links: [
        { label: "Institutional Memory", path: "/institutional-memory" },
        { label: "Decision Velocity", path: "/decision-velocity" },
        { label: "Executive Analytics", path: "/analytics" },
        { label: "AI Intelligence Hub", path: "/ai" },
        { label: "Executive Dashboard", path: "/executive-dashboard" },
      ]
    },
    {
      title: "Demos",
      links: [
        { label: "Interactive Demo", path: "/demo" },
        { label: "Investor Demo", path: "/investor-demo" },
        { label: "Executive Simulation", path: "/executive-simulation" },
        { label: "Industry Scenarios", path: "/industry-demos" },
        { label: "Product Tour", path: "/product-tour" },
      ]
    },
    {
      title: "Company",
      links: [
        { label: "How It Works", path: "/how-it-works" },
        { label: "Our Story", path: "/our-story" },
        { label: "Why M", path: "/why-m" },
        { label: "Integrations", path: "/integrations" },
        { label: "Pricing", path: "/pricing" },
        { label: "Contact", path: "/contact" },
      ]
    },
  ];

  return (
    <footer className="bg-slate-950 border-t border-slate-800">
      {/* 4-Phase Methodology Header */}
      <div className="border-b border-slate-800 bg-slate-900/50">
        <div className="max-w-7xl mx-auto px-6 py-6">
          <div className="flex flex-col md:flex-row items-center justify-between gap-4">
            <div>
              <h3 className="text-white font-semibold">M Strategic Execution Operating System</h3>
              <p className="text-sm text-slate-400">Explore the complete platform capabilities below</p>
            </div>
            <div className="flex items-center gap-3">
              <span className="text-xs font-medium px-3 py-1 rounded-full bg-violet-500/20 text-violet-400">IDENTIFY</span>
              <span className="text-slate-600"></span>
              <span className="text-xs font-medium px-3 py-1 rounded-full bg-blue-500/20 text-blue-400">DETECT</span>
              <span className="text-slate-600"></span>
              <span className="text-xs font-medium px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-400">EXECUTE</span>
              <span className="text-slate-600"></span>
              <span className="text-xs font-medium px-3 py-1 rounded-full bg-amber-500/20 text-amber-400">ADVANCE</span>
            </div>
          </div>
        </div>
      </div>

      {/* Main Footer Grid - 6 Columns */}
      <div className="max-w-7xl mx-auto px-6 py-12">
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-8">
          {footerSections.map((section) => (
            <div key={section.title}>
              <h4 className="font-semibold text-white mb-4 text-sm">
                {section.title}
              </h4>
              <ul className="space-y-2">
                {section.links.map((link) => (
                  <li key={link.path}>
                    <button
                      onClick={() => navigateTo(link.path)}
                      className="text-sm text-slate-400 hover:text-white transition-colors text-left"
                    >
                      {link.label}
                    </button>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>
      </div>

      {/* Key Stats Bar */}
      <div className="border-t border-slate-800 bg-slate-900/30">
        <div className="max-w-7xl mx-auto px-6 py-4">
          <div className="flex flex-wrap items-center justify-center gap-6 md:gap-12 text-center">
            <div>
              <div className="text-xl font-bold text-white">166</div>
              <div className="text-xs text-slate-500">Strategic Playbooks</div>
            </div>
            <div>
              <div className="text-xl font-bold text-white">9</div>
              <div className="text-xs text-slate-500">Executive Domains</div>
            </div>
            <div>
              <div className="text-xl font-bold text-emerald-400">15 min</div>
              <div className="text-xs text-slate-500">Decision Time</div>
            </div>
            <div>
              <div className="text-xl font-bold text-white">24/7</div>
              <div className="text-xs text-slate-500">AI Monitoring</div>
            </div>
            <div>
              <div className="text-xl font-bold text-white">16</div>
              <div className="text-xs text-slate-500">Signal Categories</div>
            </div>
            <div>
              <div className="text-xl font-bold text-white">92</div>
              <div className="text-xs text-slate-500">Data Points</div>
            </div>
          </div>
        </div>
      </div>

      {/* That's the IDEA Tagline */}
      <div className="border-t border-slate-800 bg-gradient-to-r from-slate-900 via-blue-950/30 to-slate-900">
        <div className="max-w-7xl mx-auto px-6 py-8 text-center">
          <p className="text-2xl font-bold text-white mb-2" data-testid="footer-idea-tagline">
            That's the IDEA.
          </p>
          <p className="text-lg text-slate-400 italic mb-4">
            "Comfortable and confident that we are prepared to execute. No matter the situation."
          </p>
          <p className="text-sm text-slate-500">
            Success Favors the Prepared
          </p>
        </div>
      </div>

      {/* Bottom Bar */}
      <div className="border-t border-slate-800">
        <div className="max-w-7xl mx-auto px-6 py-6">
          <div className="flex flex-col md:flex-row items-center justify-between gap-4">
            <div className="flex items-center gap-3">
              <div className="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                <span className="text-white font-bold text-sm">M</span>
              </div>
              <div>
                <p className="text-sm text-slate-400">
                   {new Date().getFullYear()} M Strategic Execution Operating System
                </p>
                <p className="text-xs text-slate-600">The preparation mindset of elite teams, systematized for enterprise execution.</p>
              </div>
            </div>
            <div className="flex items-center gap-6">
              <button 
                onClick={() => navigateTo("/demo")}
                className="text-sm text-emerald-400 hover:text-emerald-300 transition-colors font-medium"
              >
                See Demo 
              </button>
              <button 
                onClick={() => navigateTo("/investor-demo")}
                className="text-sm text-purple-400 hover:text-purple-300 transition-colors font-medium"
              >
                Investors 
              </button>
              <button 
                onClick={() => navigateTo("/contact")}
                className="text-sm text-slate-400 hover:text-white transition-colors"
              >
                Contact
              </button>
            </div>
          </div>
        </div>
      </div>
    </footer>
  );
}


========================================
FILE: client/src/components/layout/PageLayout.tsx
========================================
import { ReactNode } from 'react';
import StandardNav from './StandardNav';

interface PageLayoutProps {
  children: ReactNode;
  className?: string;
}

/**
 * Unified Platform Layout - Single top navigation, full-width content
 * Replaces the old sidebar-based layout with a cleaner horizontal navigation
 */
export default function PageLayout({ children, className = "" }: PageLayoutProps) {
  return (
    <div className={`min-h-screen flex flex-col ${className}`}>
      {/* Unified Navigation - Same header everywhere */}
      <StandardNav />
      
      {/* Full-Width Content Area */}
      <main className="flex-1 w-full overflow-auto">
        {children}
      </main>
    </div>
  );
}


========================================
FILE: client/src/components/layout/StandardNav.tsx
========================================
import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Play, Menu, X, LogIn, LogOut, User, ChevronDown } from "lucide-react";
import { useLocation } from "wouter";
import { useAuth } from "@/hooks/useAuth";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";

export default function StandardNav() {
  const [location, setLocation] = useLocation();
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const { user, isAuthenticated, isLoading, login, logout } = useAuth();

  const navigateTo = (path: string) => {
    setLocation(path);
    setMobileMenuOpen(false);
  };

  const navLinks = [
    { label: "Why M", path: "/why-m" },
    { label: "How It Works", path: "/how-it-works" },
    { label: "Decision Velocity", path: "/decisions" },
    { label: "Pilot Program", path: "/pilot-program" },
    { label: "Pricing", path: "/pricing" },
  ];

  const isActivePath = (path: string) => {
    if (path === "/") return location === "/";
    return location.startsWith(path);
  };

  return (
    <nav className="border-b border-slate-800 bg-slate-950 sticky top-0 z-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6">
        <div className="flex items-center justify-between h-16">
          
          {/* Logo */}
          <div 
            className="flex items-center gap-3 cursor-pointer hover:opacity-80 transition-opacity" 
            onClick={() => navigateTo('/')}
            data-testid="nav-logo"
          >
            <div className="w-9 h-9 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
              <span className="text-white font-bold text-lg">M</span>
            </div>
            <div className="hidden sm:block">
              <span className="font-bold text-white text-lg">M</span>
              <span className="text-slate-500 text-xs ml-1.5 hidden lg:inline">Strategic Execution OS</span>
            </div>
          </div>

          {/* Desktop Navigation Links */}
          <div className="hidden md:flex items-center gap-1">
            <button
              onClick={() => navigateTo("/why-m")}
              className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${
                isActivePath("/why-m") 
                  ? 'text-white bg-slate-800' 
                  : 'text-slate-400 hover:text-white hover:bg-slate-800/50'
              }`}
              data-testid="nav-why-m"
            >
              Why M
            </button>
            <button
              onClick={() => navigateTo("/how-it-works")}
              className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${
                isActivePath("/how-it-works") 
                  ? 'text-white bg-slate-800' 
                  : 'text-slate-400 hover:text-white hover:bg-slate-800/50'
              }`}
              data-testid="nav-how-it-works"
            >
              How It Works
            </button>
            
            {/* Playbooks Dropdown */}
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <button
                  className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors flex items-center gap-1 ${
                    isActivePath("/playbook") 
                      ? 'text-white bg-slate-800' 
                      : 'text-slate-400 hover:text-white hover:bg-slate-800/50'
                  }`}
                  data-testid="nav-playbooks-dropdown"
                >
                  Playbooks
                  <ChevronDown className="h-3 w-3" />
                </button>
              </DropdownMenuTrigger>
              <DropdownMenuContent align="start" className="w-48">
                <DropdownMenuItem onClick={() => navigateTo("/playbooks")} data-testid="nav-playbooks-library">
                  Library (166 Templates)
                </DropdownMenuItem>
                <DropdownMenuItem onClick={() => navigateTo("/playbook-management")} data-testid="nav-playbooks-manage">
                  Manage Playbooks
                </DropdownMenuItem>
                <DropdownMenuItem onClick={() => navigateTo("/task-management")} data-testid="nav-task-manage">
                  Task Management
                </DropdownMenuItem>
                <DropdownMenuItem onClick={() => navigateTo("/stakeholder-management")} data-testid="nav-stakeholder-manage">
                  Stakeholder Directory
                </DropdownMenuItem>
              </DropdownMenuContent>
            </DropdownMenu>

            <button
              onClick={() => navigateTo("/decisions")}
              className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${
                isActivePath("/decisions") 
                  ? 'text-white bg-slate-800' 
                  : 'text-slate-400 hover:text-white hover:bg-slate-800/50'
              }`}
              data-testid="nav-decision-velocity"
            >
              Decision Velocity
            </button>
            <button
              onClick={() => navigateTo("/pilot-program")}
              className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${
                isActivePath("/pilot-program") 
                  ? 'text-white bg-slate-800' 
                  : 'text-slate-400 hover:text-white hover:bg-slate-800/50'
              }`}
              data-testid="nav-pilot-program"
            >
              Pilot Program
            </button>
            <button
              onClick={() => navigateTo("/pricing")}
              className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${
                isActivePath("/pricing") 
                  ? 'text-white bg-slate-800' 
                  : 'text-slate-400 hover:text-white hover:bg-slate-800/50'
              }`}
              data-testid="nav-pricing"
            >
              Pricing
            </button>
          </div>

          {/* Desktop CTAs */}
          <div className="hidden md:flex items-center gap-3">
            <Button 
              onClick={() => navigateTo("/sandbox-demo")}
              className="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold h-9 px-4"
              data-testid="nav-try-it"
            >
              <Play className="h-4 w-4 mr-1.5" />
              Try It
            </Button>
            <Button 
              onClick={() => navigateTo("/demo")}
              variant="outline"
              className="border-emerald-500/50 text-emerald-400 hover:bg-emerald-950 hover:text-emerald-300 h-9 px-4"
              data-testid="nav-see-demo"
            >
              Watch Demo
            </Button>
            
            <Button 
              variant="outline"
              onClick={() => navigateTo("/investor-demo")}
              className="border-purple-500/50 text-purple-300 hover:bg-purple-950 hover:text-purple-200 h-9 px-4"
              data-testid="nav-investors"
            >
              Investors
            </Button>

            {/* Auth */}
            {isLoading ? (
              <div className="h-9 w-20 bg-slate-800 animate-pulse rounded-lg" />
            ) : isAuthenticated && user ? (
              <div className="flex items-center gap-2">
                <div className="hidden lg:flex items-center gap-2 px-3 py-1.5 bg-slate-800 rounded-lg">
                  <User className="h-4 w-4 text-slate-400" />
                  <span className="text-sm text-slate-300">{user.firstName || user.email?.split('@')[0]}</span>
                </div>
                <Button 
                  variant="ghost" 
                  onClick={logout}
                  className="text-slate-400 hover:text-white hover:bg-slate-800 h-9 px-3"
                  data-testid="nav-logout"
                >
                  <LogOut className="h-4 w-4 lg:mr-1.5" />
                  <span className="hidden lg:inline">Sign Out</span>
                </Button>
              </div>
            ) : (
              <Button 
                variant="ghost" 
                onClick={login}
                className="text-slate-400 hover:text-white hover:bg-slate-800 h-9 px-3"
                data-testid="nav-login"
              >
                <LogIn className="h-4 w-4 lg:mr-1.5" />
                <span className="hidden lg:inline">Sign In</span>
              </Button>
            )}
          </div>

          {/* Mobile Menu Button */}
          <div className="flex md:hidden items-center gap-2">
            <Button 
              onClick={() => navigateTo("/sandbox-demo")}
              size="sm"
              className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white"
              data-testid="nav-mobile-try-it"
            >
              <Play className="h-4 w-4" />
            </Button>
            <button
              className="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors"
              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
              data-testid="nav-mobile-menu-toggle"
            >
              {mobileMenuOpen ? <X className="h-6 w-6" /> : <Menu className="h-6 w-6" />}
            </button>
          </div>
        </div>

        {/* Mobile Menu */}
        {mobileMenuOpen && (
          <div className="md:hidden py-4 border-t border-slate-800 animate-in slide-in-from-top-2 duration-200">
            <div className="flex flex-col gap-1">
              {/* Main Links */}
              {navLinks.map((link) => (
                <button
                  key={link.path}
                  onClick={() => navigateTo(link.path)}
                  className={`text-left py-3 px-4 rounded-lg transition-colors ${
                    isActivePath(link.path)
                      ? 'text-white bg-slate-800'
                      : 'text-slate-300 hover:text-white hover:bg-slate-800'
                  }`}
                  data-testid={`nav-mobile-${link.label.toLowerCase().replace(/\s+/g, '-')}`}
                >
                  {link.label}
                </button>
              ))}
              
              {/* Divider */}
              <div className="border-t border-slate-800 my-2" />
              
              {/* CTAs */}
              <Button 
                onClick={() => navigateTo("/sandbox-demo")}
                className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white w-full justify-center h-11"
                data-testid="nav-mobile-try-it-full"
              >
                <Play className="h-4 w-4 mr-2" />
                Try It Yourself
              </Button>
              
              <Button 
                onClick={() => navigateTo("/demo")}
                variant="outline"
                className="border-emerald-500/50 text-emerald-400 hover:bg-emerald-950 w-full justify-center h-11 mt-2"
                data-testid="nav-mobile-see-demo-full"
              >
                Watch Demo
              </Button>
              
              <Button 
                variant="outline"
                onClick={() => navigateTo("/investor-demo")}
                className="border-purple-500/50 text-purple-300 hover:bg-purple-950 w-full justify-center h-11 mt-2"
                data-testid="nav-mobile-investors"
              >
                Investors
              </Button>
              
              {/* Divider */}
              <div className="border-t border-slate-800 my-2" />
              
              {/* Secondary Links */}
              <div className="grid grid-cols-2 gap-1">
                <button
                  onClick={() => navigateTo("/our-story")}
                  className="text-left py-2 px-3 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg"
                  data-testid="nav-mobile-our-story"
                >
                  Our Story
                </button>
                <button
                  onClick={() => navigateTo("/contact")}
                  className="text-left py-2 px-3 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg"
                  data-testid="nav-mobile-contact"
                >
                  Contact
                </button>
                <button
                  onClick={() => navigateTo("/executive-dashboard")}
                  className="text-left py-2 px-3 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg"
                  data-testid="nav-mobile-dashboard"
                >
                  Dashboard
                </button>
                <button
                  onClick={() => navigateTo("/roadshow-resources")}
                  className="text-left py-2 px-3 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg"
                  data-testid="nav-mobile-resources"
                >
                  Resources
                </button>
              </div>
              
              {/* Management Links (for logged-in users) */}
              {isAuthenticated && (
                <>
                  <div className="border-t border-slate-800 my-2" />
                  <p className="px-3 py-1 text-xs text-slate-500 uppercase tracking-wider">Management</p>
                  <div className="grid grid-cols-2 gap-1">
                    <button
                      onClick={() => navigateTo("/playbook-management")}
                      className="text-left py-2 px-3 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg"
                      data-testid="nav-mobile-playbook-mgmt"
                    >
                      Playbooks
                    </button>
                    <button
                      onClick={() => navigateTo("/task-management")}
                      className="text-left py-2 px-3 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg"
                      data-testid="nav-mobile-task-mgmt"
                    >
                      Tasks
                    </button>
                    <button
                      onClick={() => navigateTo("/stakeholder-management")}
                      className="text-left py-2 px-3 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg"
                      data-testid="nav-mobile-stakeholder-mgmt"
                    >
                      Stakeholders
                    </button>
                    <button
                      onClick={() => navigateTo("/triggers-management")}
                      className="text-left py-2 px-3 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg"
                      data-testid="nav-mobile-triggers-mgmt"
                    >
                      Triggers
                    </button>
                  </div>
                </>
              )}
              
              {/* Auth */}
              <div className="border-t border-slate-800 my-2" />
              {isAuthenticated && user ? (
                <div className="flex items-center justify-between px-3 py-2">
                  <div className="flex items-center gap-2">
                    <User className="h-4 w-4 text-slate-400" />
                    <span className="text-sm text-slate-300">{user.firstName || user.email}</span>
                  </div>
                  <Button 
                    variant="ghost" 
                    size="sm"
                    onClick={logout}
                    className="text-slate-400 hover:text-white"
                    data-testid="nav-mobile-signout"
                  >
                    Sign Out
                  </Button>
                </div>
              ) : (
                <Button 
                  variant="ghost" 
                  onClick={login}
                  className="text-slate-300 hover:text-white hover:bg-slate-800 w-full justify-center h-10"
                  data-testid="nav-mobile-signin"
                >
                  <LogIn className="h-4 w-4 mr-2" />
                  Sign In
                </Button>
              )}
            </div>
          </div>
        )}
      </div>
    </nav>
  );
}


========================================
FILE: client/src/components/ActivityFeed.tsx
========================================
import { useQuery } from "@tanstack/react-query";
import { api, type Activity } from "@/lib/api";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader } from "@/components/ui/card";

export default function ActivityFeed() {
  const { data: activities, isLoading } = useQuery<Activity[]>({
    queryKey: ["/api/activities/recent"],
    queryFn: () => api.getRecentActivities(),
  });

  const getActivityIcon = (action: string) => {
    if (action.includes('completed')) return 'fas fa-check text-green-600';
    if (action.includes('created')) return 'fas fa-lightbulb text-blue-600';
    if (action.includes('joined')) return 'fas fa-users text-orange-600';
    return 'fas fa-info text-blue-600';
  };

  const getTimeAgo = (dateString: string) => {
    const date = new Date(dateString);
    const now = new Date();
    const diffInMinutes = Math.floor((now.getTime() - date.getTime()) / (1000 * 60));
    
    if (diffInMinutes < 1) return 'just now';
    if (diffInMinutes < 60) return `${diffInMinutes} minutes ago`;
    if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)} hours ago`;
    return `${Math.floor(diffInMinutes / 1440)} days ago`;
  };

  return (
    <Card>
      <CardHeader className="border-b border-border">
        <h3 className="text-lg font-semibold text-foreground">Recent Activity</h3>
      </CardHeader>
      
      <CardContent className="p-6 space-y-4">
        {isLoading ? (
          <div className="space-y-4">
            {[...Array(4)].map((_, i) => (
              <div key={i} className="animate-pulse flex items-start space-x-3">
                <div className="w-8 h-8 bg-muted rounded-full"></div>
                <div className="flex-1 space-y-2">
                  <div className="h-4 bg-muted rounded w-3/4"></div>
                  <div className="h-3 bg-muted rounded w-1/4"></div>
                </div>
              </div>
            ))}
          </div>
        ) : activities?.length === 0 ? (
          <div className="text-center py-8">
            <i className="fas fa-clock text-muted-foreground text-3xl mb-4"></i>
            <p className="text-muted-foreground">No recent activity</p>
          </div>
        ) : (
          activities?.map((activity, index) => (
            <div key={activity.id} className="flex items-start space-x-3" data-testid={`activity-${index}`}>
              <div className="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                <i className={`${getActivityIcon(activity.action)} w-3`}></i>
              </div>
              <div className="flex-1 min-w-0">
                <p className="text-sm text-foreground">
                  <span className="font-medium" data-testid={`text-activity-user-${index}`}>
                    {activity.userName}
                  </span>
                  <span data-testid={`text-activity-action-${index}`}> {activity.action}</span>
                </p>
                <p className="text-xs text-muted-foreground" data-testid={`text-activity-time-${index}`}>
                  {getTimeAgo(activity.createdAt)}
                </p>
              </div>
            </div>
          ))
        )}
        
        {activities && activities.length > 0 && (
          <Button 
            variant="ghost" 
            className="w-full text-primary hover:text-primary/80"
            data-testid="button-view-all-activity"
          >
            View All Activity
          </Button>
        )}
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/AIChat.tsx
========================================
import { useState, useRef, useEffect } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Badge } from "@/components/ui/badge";
import { Separator } from "@/components/ui/separator";
import { Send, Bot, User, FileText, Clock, TrendingUp } from "lucide-react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { apiRequest } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";

interface ChatMessage {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: string;
  sources?: Array<{
    id: string;
    title: string;
    content: string;
    relevanceScore: number;
    sourceType: string;
  }>;
  metadata?: {
    tokensUsed: number;
    processingTime: number;
    confidence: number;
  };
}

interface AIChatProps {
  organizationId?: string;
  placeholder?: string;
}

export function AIChat({ organizationId, placeholder = "Ask me anything about your organization..." }: AIChatProps) {
  const [messages, setMessages] = useState<ChatMessage[]>([]);
  const [currentQuery, setCurrentQuery] = useState("");
  const [conversationId, setConversationId] = useState<string | undefined>();
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const { toast } = useToast();
  const queryClient = useQueryClient();

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const nlqMutation = useMutation({
    mutationFn: async (query: string) => {
      return apiRequest("POST", "/api/nlq/query", {
        query,
        conversationId,
        organizationId,
      });
    },
    onSuccess: (response: any) => {
      // Set conversation ID for follow-up queries
      if (response.conversationId && !conversationId) {
        setConversationId(response.conversationId);
      }

      // Add assistant response to messages
      const assistantMessage: ChatMessage = {
        id: Date.now().toString(),
        role: 'assistant',
        content: response.response,
        timestamp: new Date().toISOString(),
        sources: response.sources,
        metadata: response.metadata,
      };

      setMessages(prev => [...prev, assistantMessage]);
    },
    onError: (error: any) => {
      toast({
        title: "Query Failed",
        description: error.message || "Failed to process your question. Please try again.",
        variant: "destructive",
      });
    },
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!currentQuery.trim() || nlqMutation.isPending) return;

    // Add user message to chat
    const userMessage: ChatMessage = {
      id: Date.now().toString(),
      role: 'user',
      content: currentQuery.trim(),
      timestamp: new Date().toISOString(),
    };

    setMessages(prev => [...prev, userMessage]);
    
    // Send query to AI
    nlqMutation.mutate(currentQuery.trim());
    
    // Clear input
    setCurrentQuery("");
  };

  const formatTimestamp = (timestamp: string) => {
    return new Date(timestamp).toLocaleTimeString([], { 
      hour: '2-digit', 
      minute: '2-digit' 
    });
  };

  const getConfidenceColor = (confidence: number) => {
    if (confidence >= 0.8) return "bg-green-100 text-green-800";
    if (confidence >= 0.6) return "bg-yellow-100 text-yellow-800";
    return "bg-red-100 text-red-800";
  };

  return (
    <Card className="h-[600px] flex flex-col" data-testid="ai-chat-container">
      <CardHeader className="pb-4">
        <CardTitle className="flex items-center gap-2">
          <Bot className="w-5 h-5 text-blue-600" />
          AI Intelligence Assistant
        </CardTitle>
        <p className="text-sm text-gray-600">
          Ask questions about your organization's data and get insights backed by real information.
        </p>
      </CardHeader>

      <CardContent className="flex-1 flex flex-col p-0">
        <ScrollArea className="flex-1 px-6" data-testid="chat-messages">
          <div className="space-y-4 pb-4">
            {messages.length === 0 && (
              <div className="text-center text-gray-500 py-8">
                <Bot className="w-12 h-12 mx-auto mb-3 text-gray-300" />
                <p className="text-lg font-medium">How can I help you today?</p>
                <p className="text-sm">Ask me about strategic scenarios, team performance, or any organizational data.</p>
              </div>
            )}

            {messages.map((message, index) => (
              <div key={message.id} className={`flex gap-3 ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                <div className={`flex gap-3 max-w-[85%] ${message.role === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>
                  <div className="flex-shrink-0">
                    {message.role === 'user' ? (
                      <div className="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <User className="w-4 h-4 text-white" />
                      </div>
                    ) : (
                      <div className="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center">
                        <Bot className="w-4 h-4 text-white" />
                      </div>
                    )}
                  </div>

                  <div className={`rounded-lg p-4 ${
                    message.role === 'user' 
                      ? 'bg-blue-600 text-white' 
                      : 'bg-gray-50 border'
                  }`}>
                    <div className="space-y-3">
                      <p className="text-sm leading-relaxed whitespace-pre-wrap" data-testid={`message-content-${index}`}>
                        {message.content}
                      </p>

                      {/* Sources for assistant messages */}
                      {message.role === 'assistant' && message.sources && message.sources.length > 0 && (
                        <div className="space-y-2">
                          <Separator />
                          <div>
                            <h4 className="text-xs font-medium text-gray-600 mb-2 flex items-center gap-1">
                              <FileText className="w-3 h-3" />
                              Sources ({message.sources.length})
                            </h4>
                            <div className="space-y-2">
                              {message.sources.map((source, idx) => (
                                <div key={source.id} className="bg-white p-2 rounded border text-xs">
                                  <div className="flex items-center justify-between mb-1">
                                    <span className="font-medium text-gray-800">{source.title}</span>
                                    <Badge variant="outline" className="text-xs">
                                      {Math.round(source.relevanceScore * 100)}% match
                                    </Badge>
                                  </div>
                                  <p className="text-gray-600 line-clamp-2">{source.content}</p>
                                  <Badge variant="secondary" className="mt-1">
                                    {source.sourceType}
                                  </Badge>
                                </div>
                              ))}
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Metadata for assistant messages */}
                      {message.role === 'assistant' && message.metadata && (
                        <div className="flex items-center gap-4 text-xs text-gray-500 pt-2 border-t border-gray-200">
                          <div className="flex items-center gap-1">
                            <Clock className="w-3 h-3" />
                            {message.metadata.processingTime}ms
                          </div>
                          <div className="flex items-center gap-1">
                            <TrendingUp className="w-3 h-3" />
                            <Badge 
                              variant="outline" 
                              className={`text-xs ${getConfidenceColor(message.metadata.confidence)}`}
                            >
                              {Math.round(message.metadata.confidence * 100)}% confidence
                            </Badge>
                          </div>
                          <div className="text-xs">
                            {message.metadata.tokensUsed} tokens
                          </div>
                        </div>
                      )}

                      <div className="text-xs opacity-70">
                        {formatTimestamp(message.timestamp)}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            ))}

            {nlqMutation.isPending && (
              <div className="flex gap-3 justify-start">
                <div className="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center">
                  <Bot className="w-4 h-4 text-white" />
                </div>
                <div className="bg-gray-50 border rounded-lg p-4 max-w-[85%]">
                  <div className="flex items-center gap-2">
                    <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"></div>
                    <span className="text-sm text-gray-600">Thinking...</span>
                  </div>
                </div>
              </div>
            )}
          </div>
          <div ref={messagesEndRef} />
        </ScrollArea>

        <div className="px-6 py-4 border-t">
          <form onSubmit={handleSubmit} className="flex gap-2">
            <Input
              value={currentQuery}
              onChange={(e) => setCurrentQuery(e.target.value)}
              placeholder={placeholder}
              disabled={nlqMutation.isPending}
              className="flex-1"
              data-testid="chat-input"
            />
            <Button 
              type="submit" 
              disabled={!currentQuery.trim() || nlqMutation.isPending}
              data-testid="send-button"
            >
              <Send className="w-4 h-4" />
            </Button>
          </form>
          <p className="text-xs text-gray-500 mt-2">
            AI responses are powered by your organizational data. Ask about scenarios, performance, risks, or any strategic topic.
          </p>
        </div>
      </CardContent>
    </Card>
  );
}

========================================
FILE: client/src/components/AIConfidenceBadge.tsx
========================================
import { Badge } from "@/components/ui/badge";
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip";
import { Brain, TrendingUp, AlertTriangle } from "lucide-react";

interface AIConfidenceBadgeProps {
  confidence: number; // 0-100
  basedOn?: number; // Number of similar scenarios
  context?: string;
  size?: "sm" | "md" | "lg";
  showIcon?: boolean;
}

export default function AIConfidenceBadge({ 
  confidence, 
  basedOn, 
  context = "similar scenarios",
  size = "md",
  showIcon = true 
}: AIConfidenceBadgeProps) {
  
  const getConfidenceLevel = (score: number) => {
    if (score >= 90) return {
      level: "Very High",
      color: "bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800",
      icon: <TrendingUp className="w-3 h-3" />
    };
    if (score >= 70) return {
      level: "High",
      color: "bg-blue-50 dark:bg-blue-950 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-800",
      icon: <Brain className="w-3 h-3" />
    };
    if (score >= 50) return {
      level: "Medium",
      color: "bg-yellow-50 dark:bg-yellow-950 text-yellow-700 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800",
      icon: <AlertTriangle className="w-3 h-3" />
    };
    return {
      level: "Low",
      color: "bg-red-50 dark:bg-red-950 text-red-700 dark:text-red-400 border-red-200 dark:border-red-800",
      icon: <AlertTriangle className="w-3 h-3" />
    };
  };

  const confidenceData = getConfidenceLevel(confidence);
  
  const sizeClasses = {
    sm: "text-xs px-2 py-0.5",
    md: "text-sm px-3 py-1",
    lg: "text-base px-4 py-1.5"
  };

  const tooltipContent = (
    <div className="space-y-2">
      <div className="font-semibold">AI Confidence: {confidence}%</div>
      <div className="text-xs opacity-90">
        {confidenceData.level} confidence level
      </div>
      {basedOn && (
        <div className="text-xs opacity-90">
          Based on {basedOn} {context}
        </div>
      )}
      <div className="text-xs opacity-75 mt-2 pt-2 border-t border-white/20">
        {confidence >= 90 && "AI recommendation has very high accuracy. Safe to execute with minimal review."}
        {confidence >= 70 && confidence < 90 && "AI recommendation is reliable. Executive review recommended."}
        {confidence >= 50 && confidence < 70 && "AI recommendation needs validation. Detailed executive review required."}
        {confidence < 50 && "Limited historical data. Executive judgment strongly recommended."}
      </div>
    </div>
  );

  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <Badge 
            variant="outline" 
            className={`${confidenceData.color} ${sizeClasses[size]} gap-1.5 cursor-help`}
            data-testid={`ai-confidence-badge-${confidenceData.level.toLowerCase().replace(' ', '-')}`}
          >
            {showIcon && confidenceData.icon}
            <span className="font-semibold">{confidence}%</span>
            {size !== "sm" && <span className="opacity-75">AI Confidence</span>}
          </Badge>
        </TooltipTrigger>
        <TooltipContent className="max-w-xs">
          {tooltipContent}
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}


========================================
FILE: client/src/components/AICopilotPanel.tsx
========================================
import { useState } from "react";
import { useMutation } from "@tanstack/react-query";
import { api } from "@/lib/api";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Card, CardContent, CardHeader } from "@/components/ui/card";
import { useToast } from "@/hooks/use-toast";
import { isUnauthorizedError } from "@/lib/authUtils";
import AIConfidenceBadge from "@/components/AIConfidenceBadge";

export default function AICopilotPanel() {
  const [query, setQuery] = useState("");
  const [aiResponse, setAiResponse] = useState<string | null>(null);
  const { toast } = useToast();

  const aiMutation = useMutation({
    mutationFn: (query: string) => api.askAI(query),
    onSuccess: (data) => {
      setAiResponse(data.response);
      setQuery("");
    },
    onError: (error) => {
      if (isUnauthorizedError(error)) {
        toast({
          title: "Unauthorized",
          description: "You are logged out. Logging in again...",
          variant: "destructive",
        });
        setTimeout(() => {
          window.location.href = "/api/login";
        }, 500);
        return;
      }
      toast({
        title: "Error",
        description: "Failed to get AI response",
        variant: "destructive",
      });
    },
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (query.trim()) {
      aiMutation.mutate(query.trim());
    }
  };

  return (
    <div className="space-y-6">
      {/* AI Co-pilot Card */}
      <Card>
        <CardHeader className="border-b border-border">
          <div className="flex items-center space-x-3">
            <div className="w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center">
              <i className="fas fa-robot text-white w-4"></i>
            </div>
            <h3 className="text-lg font-semibold text-foreground">AI Strategic Co-pilot</h3>
          </div>
        </CardHeader>
        
        <CardContent className="p-6 space-y-4">
          {aiResponse && (
            <div className="bg-muted/50 rounded-lg p-4">
              <div className="flex items-start space-x-3">
                <div className="w-6 h-6 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                  <i className="fas fa-sparkles text-white text-xs"></i>
                </div>
                <div className="flex-1 space-y-3">
                  <div className="flex items-center justify-between">
                    <p className="text-sm text-foreground font-medium">Strategic Insight</p>
                    <AIConfidenceBadge 
                      confidence={88} 
                      basedOn={47} 
                      context="similar successful executions"
                      size="sm"
                    />
                  </div>
                  <p className="text-sm text-muted-foreground" data-testid="text-ai-response">
                    {aiResponse}
                  </p>
                </div>
              </div>
            </div>
          )}
          
          <form onSubmit={handleSubmit} className="space-y-2">
            <label className="text-sm font-medium text-foreground">Ask the AI Co-pilot</label>
            <div className="relative">
              <Input
                type="text"
                placeholder="How can we improve our agility score?"
                value={query}
                onChange={(e) => setQuery(e.target.value)}
                className="pr-12"
                disabled={aiMutation.isPending}
                data-testid="input-ai-query"
              />
              <Button
                type="submit"
                variant="ghost"
                size="sm"
                className="absolute right-1 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-primary"
                disabled={aiMutation.isPending || !query.trim()}
                data-testid="button-send-ai-query"
              >
                {aiMutation.isPending ? (
                  <div className="w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"></div>
                ) : (
                  <i className="fas fa-paper-plane w-4"></i>
                )}
              </Button>
            </div>
          </form>
        </CardContent>
      </Card>

      {/* Quick Actions */}
      <Card>
        <CardHeader className="border-b border-border">
          <h3 className="text-lg font-semibold text-foreground">Quick Actions</h3>
        </CardHeader>
        
        <CardContent className="p-6 space-y-3">
          <Button 
            variant="outline" 
            className="w-full justify-start h-auto p-4"
            data-testid="button-create-organization"
          >
            <div className="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
              <i className="fas fa-building text-blue-600 w-4"></i>
            </div>
            <div className="text-left">
              <p className="text-sm font-medium text-foreground">Create Organization</p>
              <p className="text-xs text-muted-foreground">Set up a new organizational unit</p>
            </div>
          </Button>
          
          <Button 
            variant="outline" 
            className="w-full justify-start h-auto p-4"
            data-testid="button-invite-member"
          >
            <div className="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
              <i className="fas fa-user-plus text-green-600 w-4"></i>
            </div>
            <div className="text-left">
              <p className="text-sm font-medium text-foreground">Invite Team Member</p>
              <p className="text-xs text-muted-foreground">Add collaborators to your workspace</p>
            </div>
          </Button>
          
          <Button 
            variant="outline" 
            className="w-full justify-start h-auto p-4"
            data-testid="button-generate-report"
          >
            <div className="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
              <i className="fas fa-chart-pie text-purple-600 w-4"></i>
            </div>
            <div className="text-left">
              <p className="text-sm font-medium text-foreground">Generate Report</p>
              <p className="text-xs text-muted-foreground">Export agility metrics and insights</p>
            </div>
          </Button>
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/BoardDeckGenerator.tsx
========================================
import { useState } from "react";
import { useMutation } from "@tanstack/react-query";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { useToast } from "@/hooks/use-toast";
import { FileText, Download, Sparkles, TrendingUp, Shield, Zap } from "lucide-react";
import { Badge } from "@/components/ui/badge";
import AIConfidenceBadge from "@/components/AIConfidenceBadge";

interface BoardDeckGeneratorProps {
  organizationId: string;
}

export default function BoardDeckGenerator({ organizationId }: BoardDeckGeneratorProps) {
  const [reportType, setReportType] = useState<string>("executive-summary");
  const [period, setPeriod] = useState<string>("quarter");
  const { toast } = useToast();

  const generateMutation = useMutation({
    mutationFn: async () => {
      return new Promise((resolve) => {
        setTimeout(() => {
          resolve({
            url: "/downloads/board-deck-q4-2024.pdf",
            filename: "m-executive-brief-q4-2024.pdf",
          });
        }, 2000);
      });
    },
    onSuccess: () => {
      toast({
        title: "Board Deck Generated",
        description: "Your executive briefing is ready for download.",
      });
    },
    onError: () => {
      toast({
        title: "Error",
        description: "Failed to generate board deck",
        variant: "destructive",
      });
    },
  });

  const handleGenerate = () => {
    generateMutation.mutate();
  };

  return (
    <Card className="border-blue-200 dark:border-blue-800">
      <CardHeader className="border-b border-border pb-4">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
              <FileText className="w-5 h-5 text-white" />
            </div>
            <div>
              <CardTitle className="text-lg">Board Deck Generator</CardTitle>
              <p className="text-sm text-muted-foreground">AI-powered executive briefings</p>
            </div>
          </div>
          <Badge variant="outline" className="bg-purple-50 dark:bg-purple-900/20 text-purple-700 dark:text-purple-400 border-purple-200 dark:border-purple-800">
            <Sparkles className="w-3 h-3 mr-1" />
            AI Generated
          </Badge>
        </div>
      </CardHeader>
      
      <CardContent className="pt-6 space-y-6">
        {/* Configuration */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div className="space-y-2">
            <label className="text-sm font-medium text-foreground">Report Type</label>
            <Select value={reportType} onValueChange={setReportType}>
              <SelectTrigger data-testid="select-report-type">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="executive-summary">Executive Summary</SelectItem>
                <SelectItem value="roi-impact">ROI Impact Report</SelectItem>
                <SelectItem value="readiness-assessment">Readiness Assessment</SelectItem>
                <SelectItem value="decision-velocity">Decision Velocity Dashboard</SelectItem>
                <SelectItem value="institutional-learning">Institutional Learning</SelectItem>
              </SelectContent>
            </Select>
          </div>

          <div className="space-y-2">
            <label className="text-sm font-medium text-foreground">Time Period</label>
            <Select value={period} onValueChange={setPeriod}>
              <SelectTrigger data-testid="select-time-period">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="month">Last Month</SelectItem>
                <SelectItem value="quarter">Last Quarter</SelectItem>
                <SelectItem value="year">Last Year</SelectItem>
                <SelectItem value="ytd">Year to Date</SelectItem>
              </SelectContent>
            </Select>
          </div>
        </div>

        {/* AI Confidence Indicator */}
        <div className="bg-muted/50 rounded-lg p-4">
          <div className="flex items-center justify-between mb-3">
            <p className="text-sm font-medium text-foreground">AI Analysis Ready</p>
            <AIConfidenceBadge 
              confidence={94} 
              basedOn={156} 
              context="historical decision outcomes"
              size="sm"
            />
          </div>
          <p className="text-xs text-muted-foreground">
            Your board deck will include insights from 156 executed playbooks, 47 strategic decisions, and $4.2M in measured ROI impact.
          </p>
        </div>

        {/* Key Metrics Preview */}
        <div className="grid grid-cols-3 gap-3">
          <div className="bg-green-50 dark:bg-green-900/20 rounded-lg p-3">
            <div className="flex items-center gap-2 mb-1">
              <TrendingUp className="w-4 h-4 text-green-600 dark:text-green-400" />
              <p className="text-xs font-medium text-green-700 dark:text-green-400">ROI Impact</p>
            </div>
            <p className="text-lg font-bold text-green-700 dark:text-green-400">$4.2M</p>
            <p className="text-xs text-green-600 dark:text-green-500">Cost savings</p>
          </div>

          <div className="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
            <div className="flex items-center gap-2 mb-1">
              <Zap className="w-4 h-4 text-blue-600 dark:text-blue-400" />
              <p className="text-xs font-medium text-blue-700 dark:text-blue-400">Velocity</p>
            </div>
            <p className="text-lg font-bold text-blue-700 dark:text-blue-400">12 min</p>
            <p className="text-xs text-blue-600 dark:text-blue-500">Avg execution</p>
          </div>

          <div className="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3">
            <div className="flex items-center gap-2 mb-1">
              <Shield className="w-4 h-4 text-purple-600 dark:text-purple-400" />
              <p className="text-xs font-medium text-purple-700 dark:text-purple-400">Readiness</p>
            </div>
            <p className="text-lg font-bold text-purple-700 dark:text-purple-400">87/100</p>
            <p className="text-xs text-purple-600 dark:text-purple-500">Exec score</p>
          </div>
        </div>

        {/* Generate Button */}
        <Button 
          onClick={handleGenerate}
          disabled={generateMutation.isPending}
          className="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700"
          size="lg"
          data-testid="button-generate-board-deck"
        >
          {generateMutation.isPending ? (
            <>
              <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>
              Generating Board Deck...
            </>
          ) : (
            <>
              <Download className="w-4 h-4 mr-2" />
              Generate Executive Brief
            </>
          )}
        </Button>

        {generateMutation.isSuccess && (
          <div className="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
            <div className="flex items-start gap-3">
              <div className="w-8 h-8 bg-green-100 dark:bg-green-900/40 rounded-full flex items-center justify-center flex-shrink-0">
                <FileText className="w-4 h-4 text-green-600 dark:text-green-400" />
              </div>
              <div className="flex-1">
                <p className="text-sm font-medium text-green-900 dark:text-green-100 mb-1">
                  Board Deck Ready
                </p>
                <p className="text-xs text-green-700 dark:text-green-300 mb-3">
                  Your executive briefing has been generated with the latest ROI metrics, decision outcomes, and strategic insights.
                </p>
                <Button 
                  variant="outline" 
                  size="sm" 
                  className="border-green-300 dark:border-green-700 text-green-700 dark:text-green-300 hover:bg-green-100 dark:hover:bg-green-900/40"
                  data-testid="button-download-deck"
                >
                  <Download className="w-3 h-3 mr-2" />
                  Download PDF
                </Button>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/CommandCenterStatusBar.tsx
========================================
import { useQuery } from '@tanstack/react-query';
import { Activity, AlertTriangle, Target, Zap } from 'lucide-react';

interface SystemStatus {
  readinessScore: number;
  activeScenarios: number;
  weakSignalsDetected: number;
  oraclePatternsActive: number;
  playbooksReady: number;
  systemStatus: 'operational' | 'degraded' | 'critical';
  lastUpdated: string;
}

export function CommandCenterStatusBar() {
  const { data: status, isLoading } = useQuery<SystemStatus>({
    queryKey: ['/api/dynamic-strategy/status'],
    refetchInterval: 30000,
  });

  if (isLoading || !status) {
    return null; // Hide status bar while loading to reduce clutter
  }

  const getStatusColor = () => {
    switch (status.systemStatus) {
      case 'operational':
        return 'text-emerald-400';
      case 'degraded':
        return 'text-yellow-400';
      case 'critical':
        return 'text-red-400';
      default:
        return 'text-gray-400';
    }
  };

  const getStatusText = () => {
    switch (status.systemStatus) {
      case 'operational':
        return 'All Systems Operational';
      case 'degraded':
        return 'Performance Degraded';
      case 'critical':
        return 'Critical Status';
      default:
        return 'Unknown';
    }
  };

  return (
    <div className="border-b border-slate-200 bg-slate-50">
      <div className="container mx-auto px-4 py-2.5">
        <div className="flex items-center justify-between text-xs">
          <div className="flex items-center gap-6">
            <div className="flex items-center gap-2">
              <div className={`relative flex h-2 w-2 ${getStatusColor()}`}>
                <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-current opacity-75"></span>
                <span className="relative inline-flex rounded-full h-2 w-2 bg-current"></span>
              </div>
              <span className={`font-medium ${getStatusColor()}`}>
                {getStatusText()}
              </span>
            </div>

            <div className="h-4 w-px bg-border/40" />

            <div className="flex items-center gap-1.5 text-slate-700 transition-colors" data-testid="status-readiness-score">
              <Zap className="h-3.5 w-3.5 text-emerald-600" />
              <span className="font-medium text-emerald-600">{status.readinessScore}%</span>
              <span className="text-xs">Readiness</span>
            </div>

            <div className="flex items-center gap-1.5 text-slate-700 transition-colors" data-testid="status-active-scenarios">
              <Target className="h-3.5 w-3.5 text-blue-600" />
              <span className="font-medium text-blue-600">{status.activeScenarios}</span>
              <span className="text-xs">Active Scenarios</span>
            </div>

            <div className="flex items-center gap-1.5 text-slate-700 transition-colors" data-testid="status-weak-signals">
              <Activity className="h-3.5 w-3.5 text-amber-600" />
              <span className="font-medium text-amber-600">{status.weakSignalsDetected}</span>
              <span className="text-xs">Weak Signals</span>
            </div>

            <div className="flex items-center gap-1.5 text-slate-700 transition-colors" data-testid="status-oracle-patterns">
              <AlertTriangle className="h-3.5 w-3.5 text-purple-600" />
              <span className="font-medium text-purple-600">{status.oraclePatternsActive}</span>
              <span className="text-xs">Oracle Patterns</span>
            </div>
          </div>

          <div className="text-slate-500 text-xs">
            Last updated: {new Date(status.lastUpdated).toLocaleTimeString()}
          </div>
        </div>
      </div>
    </div>
  );
}


========================================
FILE: client/src/components/CreateOrganizationModal.tsx
========================================
import { useMutation } from "@tanstack/react-query";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { api } from "@/lib/api";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { queryClient } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";
import { isUnauthorizedError } from "@/lib/authUtils";

const organizationSchema = z.object({
  name: z.string().min(1, "Name is required"),
  description: z.string().optional(),
});

type OrganizationFormData = z.infer<typeof organizationSchema>;

interface CreateOrganizationModalProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

export default function CreateOrganizationModal({ open, onOpenChange }: CreateOrganizationModalProps) {
  const { toast } = useToast();
  
  const form = useForm<OrganizationFormData>({
    resolver: zodResolver(organizationSchema),
    defaultValues: {
      name: "",
      description: "",
    },
  });

  const createOrganizationMutation = useMutation({
    mutationFn: (data: OrganizationFormData) => api.createOrganization(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/organizations"] });
      queryClient.invalidateQueries({ queryKey: ["/api/dashboard/metrics"] });
      queryClient.invalidateQueries({ queryKey: ["/api/activities/recent"] });
      
      toast({
        title: "Success",
        description: "Organization created successfully",
      });
      
      form.reset();
      onOpenChange(false);
    },
    onError: (error) => {
      if (isUnauthorizedError(error)) {
        toast({
          title: "Unauthorized",
          description: "You are logged out. Logging in again...",
          variant: "destructive",
        });
        setTimeout(() => {
          window.location.href = "/api/login";
        }, 500);
        return;
      }
      toast({
        title: "Error",
        description: "Failed to create organization",
        variant: "destructive",
      });
    },
  });

  const onSubmit = (data: OrganizationFormData) => {
    createOrganizationMutation.mutate(data);
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-md">
        <DialogHeader>
          <DialogTitle>Create New Organization</DialogTitle>
        </DialogHeader>
        
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField
              control={form.control}
              name="name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Organization Name</FormLabel>
                  <FormControl>
                    <Input
                      placeholder="Enter organization name"
                      {...field}
                      data-testid="input-organization-name"
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <FormField
              control={form.control}
              name="description"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Description (Optional)</FormLabel>
                  <FormControl>
                    <Textarea
                      rows={3}
                      placeholder="Describe the organization's purpose and goals"
                      className="resize-none"
                      {...field}
                      data-testid="textarea-organization-description"
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <div className="flex items-center justify-end space-x-3 pt-4">
              <Button 
                type="button" 
                variant="outline" 
                onClick={() => onOpenChange(false)}
                data-testid="button-cancel-organization"
              >
                Cancel
              </Button>
              <Button 
                type="submit" 
                disabled={createOrganizationMutation.isPending}
                data-testid="button-submit-organization"
              >
                {createOrganizationMutation.isPending ? (
                  <>
                    <div className="w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin mr-2"></div>
                    Creating...
                  </>
                ) : (
                  'Create Organization'
                )}
              </Button>
            </div>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}


========================================
FILE: client/src/components/CreateScenarioModal.tsx
========================================
import { useState } from "react";
import { useMutation, useQuery } from "@tanstack/react-query";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { api, type Organization } from "@/lib/api";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { queryClient } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";
import { isUnauthorizedError } from "@/lib/authUtils";

const scenarioSchema = z.object({
  title: z.string().min(1, "Title is required"),
  description: z.string().optional(),
  organizationId: z.string().min(1, "Organization is required"),
});

type ScenarioFormData = z.infer<typeof scenarioSchema>;

interface CreateScenarioModalProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

export default function CreateScenarioModal({ open, onOpenChange }: CreateScenarioModalProps) {
  const { toast } = useToast();
  
  const form = useForm<ScenarioFormData>({
    resolver: zodResolver(scenarioSchema),
    defaultValues: {
      title: "",
      description: "",
      organizationId: "",
    },
  });

  const { data: organizations } = useQuery<Organization[]>({
    queryKey: ["/api/organizations"],
    queryFn: () => api.getOrganizations(),
    enabled: open,
  });

  const createScenarioMutation = useMutation({
    mutationFn: (data: ScenarioFormData) => api.createScenario(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/scenarios/recent"] });
      queryClient.invalidateQueries({ queryKey: ["/api/dashboard/metrics"] });
      queryClient.invalidateQueries({ queryKey: ["/api/activities/recent"] });
      
      toast({
        title: "Success",
        description: "Strategic scenario created successfully",
      });
      
      form.reset();
      onOpenChange(false);
    },
    onError: (error) => {
      if (isUnauthorizedError(error)) {
        toast({
          title: "Unauthorized",
          description: "You are logged out. Logging in again...",
          variant: "destructive",
        });
        setTimeout(() => {
          window.location.href = "/api/login";
        }, 500);
        return;
      }
      toast({
        title: "Error",
        description: "Failed to create scenario",
        variant: "destructive",
      });
    },
  });

  const onSubmit = (data: ScenarioFormData) => {
    createScenarioMutation.mutate(data);
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-2xl">
        <DialogHeader>
          <DialogTitle>Create New Strategic Scenario</DialogTitle>
        </DialogHeader>
        
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField
              control={form.control}
              name="title"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Scenario Title</FormLabel>
                  <FormControl>
                    <Input
                      placeholder="Enter a descriptive title for your scenario"
                      {...field}
                      data-testid="input-scenario-title"
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <FormField
              control={form.control}
              name="description"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Description</FormLabel>
                  <FormControl>
                    <Textarea
                      rows={4}
                      placeholder="Describe the strategic scenario, objectives, and expected outcomes"
                      className="resize-none"
                      {...field}
                      data-testid="textarea-scenario-description"
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <FormField
              control={form.control}
              name="organizationId"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Organization</FormLabel>
                  <Select onValueChange={field.onChange} value={field.value}>
                    <FormControl>
                      <SelectTrigger data-testid="select-organization">
                        <SelectValue placeholder="Select an organization" />
                      </SelectTrigger>
                    </FormControl>
                    <SelectContent>
                      {organizations?.map((org) => (
                        <SelectItem key={org.id} value={org.id}>
                          {org.name}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <div className="flex items-center justify-end space-x-3 pt-4">
              <Button 
                type="button" 
                variant="outline" 
                onClick={() => onOpenChange(false)}
                data-testid="button-cancel-scenario"
              >
                Cancel
              </Button>
              <Button 
                type="submit" 
                disabled={createScenarioMutation.isPending}
                data-testid="button-submit-scenario"
              >
                {createScenarioMutation.isPending ? (
                  <>
                    <div className="w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin mr-2"></div>
                    Creating...
                  </>
                ) : (
                  'Create Scenario'
                )}
              </Button>
            </div>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}


========================================
FILE: client/src/components/CrisisResponseDashboard.tsx
========================================
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { apiRequest } from '@/lib/queryClient';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Progress } from '@/components/ui/progress';
import { useToast } from '@/hooks/use-toast';
import { 
  AlertTriangle, 
  Shield, 
  Truck, 
  DollarSign, 
  Clock, 
  Users, 
  Activity,
  CheckCircle2,
  ArrowRight,
  Zap,
  TrendingUp,
  AlertCircle,
  ExternalLink
} from 'lucide-react';
import { Link } from 'wouter';

interface CrisisTemplate {
  id: string;
  name: string;
  category: string;
  severity: string;
  typicalTimeframe: string;
  description: string;
  responsePhases: any[];
  escalationTriggers: string[];
}

export default function CrisisResponseDashboard({ organizationId }: { organizationId: string }) {
  const { toast } = useToast();
  const queryClient = useQueryClient();

  // Fetch crisis response templates
  const { data: crisisTemplates = [], isLoading } = useQuery<CrisisTemplate[]>({
    queryKey: ['/api/scenario-templates/crisis'],
  });

  // Fetch active scenarios to show crisis response status
  const { data: activeScenarios = [] } = useQuery<any[]>({
    queryKey: [`/api/crises?organizationId=${organizationId}`],
  });

  // Quick activation mutation for crisis scenarios
  const quickActivateMutation = useMutation({
    mutationFn: async ({ templateId }: { templateId: string }) => {
      const timestamp = new Date().toISOString();
      const template = crisisTemplates.find((t: CrisisTemplate) => t.id === templateId);
      return apiRequest('POST', `/api/scenarios/from-template`, { 
        templateId, 
        customData: { 
          organizationId, 
          name: `CRISIS: ${template?.name} - ${timestamp}`,
          activated_at: timestamp,
          activation_type: 'emergency'
        } 
      });
    },
    onSuccess: () => {
      toast({
        title: 'Crisis Response Activated',
        description: 'Emergency scenario is now active with immediate response protocols',
      });
      queryClient.invalidateQueries({ queryKey: ['/api/scenarios'] });
    },
  });

  const getCrisisIcon = (category: string) => {
    switch (category) {
      case 'security': return <Shield className="h-6 w-6 text-red-600" />;
      case 'supply-chain': return <Truck className="h-6 w-6 text-orange-600" />;
      case 'financial': return <DollarSign className="h-6 w-6 text-yellow-600" />;
      default: return <AlertTriangle className="h-6 w-6 text-red-600" />;
    }
  };

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case 'catastrophic': return 'border-red-600 bg-red-50 dark:bg-red-900/20';
      case 'severe': return 'border-orange-500 bg-orange-50 dark:bg-orange-900/20';
      case 'significant': return 'border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20';
      default: return 'border-gray-300 bg-gray-50 dark:bg-gray-800';
    }
  };

  const activeCrisisScenarios = activeScenarios.filter((s: any) => 
    s.status === 'active' && s.scenario && JSON.parse(s.scenario).activation_type === 'emergency'
  );

  if (isLoading) {
    return <div className="flex items-center justify-center py-8">Loading crisis response systems...</div>;
  }

  return (
    <div className="space-y-6" data-testid="crisis-response-dashboard">
      {/* Crisis Status Header */}
      <div className="bg-gradient-to-r from-red-600 to-orange-600 text-white p-6 rounded-lg">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-2xl font-bold">Crisis Response Command Center</h1>
            <p className="text-red-100 mt-1">Enterprise-grade crisis management and immediate response protocols</p>
          </div>
          <div className="text-right">
            <div className="text-3xl font-bold">{activeCrisisScenarios.length}</div>
            <div className="text-red-100">Active Crisis</div>
          </div>
        </div>
      </div>

      {/* Active Crisis Alert */}
      {activeCrisisScenarios.length > 0 && (
        <Alert className="border-red-500 bg-red-50 dark:bg-red-900/20" data-testid="active-crisis-alert">
          <AlertTriangle className="h-5 w-5 text-red-600" />
          <AlertDescription className="text-red-800 dark:text-red-200">
            <div className="font-semibold">Active Crisis Scenarios Detected</div>
            <div className="mt-1">{activeCrisisScenarios.length} emergency scenarios are currently active and require immediate attention</div>
          </AlertDescription>
        </Alert>
      )}

      {/* Active Crisis Scenarios */}
      {activeScenarios.length > 0 && (
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <h2 className="text-xl font-semibold">Active Crisis Scenarios</h2>
            <Badge variant="destructive">{activeScenarios.length} Active</Badge>
          </div>
          
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
            {activeScenarios.map((scenario: any) => (
              <Card key={scenario.id} className="border-red-200 bg-red-50 dark:bg-red-900/20 hover:shadow-lg transition-shadow">
                <CardHeader className="pb-4">
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <CardTitle className="text-lg text-red-800 dark:text-red-200">
                        {scenario.title || scenario.name}
                      </CardTitle>
                      <p className="text-sm text-red-600 dark:text-red-300 mt-1">
                        {scenario.organizationId && 'Organization: ' + scenario.organizationId.split('-')[0]}
                      </p>
                    </div>
                    <Badge variant="destructive">
                      {scenario.status?.toUpperCase() || 'ACTIVE'}
                    </Badge>
                  </div>
                </CardHeader>
                <CardContent className="space-y-4">
                  <p className="text-sm text-gray-700 dark:text-gray-300 line-clamp-3">
                    {scenario.description}
                  </p>
                  
                  <div className="flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400">
                    <Clock className="h-3 w-3" />
                    Created {new Date(scenario.createdAt).toLocaleDateString()}
                  </div>
                  
                  <div className="flex items-center gap-3">
                    <Link href={`/crisis/${scenario.id}`}>
                      <Button className="flex-1" data-testid={`view-crisis-${scenario.id}`}>
                        <ExternalLink className="w-4 h-4 mr-2" />
                        View Crisis Details
                      </Button>
                    </Link>
                    <Button variant="outline" size="sm">
                      Manage
                    </Button>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </div>
      )}

      {/* Crisis Response Templates */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {crisisTemplates.map((template: CrisisTemplate) => (
          <Card 
            key={template.id} 
            className={`${getSeverityColor(template.severity)} border-2 hover:shadow-lg transition-all duration-200`}
            data-testid={`crisis-template-${template.id}`}
          >
            <CardHeader>
              <div className="flex items-center justify-between">
                <CardTitle className="flex items-center gap-3">
                  {getCrisisIcon(template.category)}
                  <div>
                    <div className="text-lg">{template.name}</div>
                    <div className="text-sm font-normal text-gray-600 dark:text-gray-400 capitalize">
                      {template.category.replace('-', ' ')} Crisis
                    </div>
                  </div>
                </CardTitle>
                <div className="text-right">
                  <Badge variant={template.severity === 'severe' ? 'destructive' : 'secondary'} className="mb-1">
                    {template.severity}
                  </Badge>
                  <div className="text-xs text-gray-500 flex items-center gap-1">
                    <Clock className="h-3 w-3" />
                    {template.typicalTimeframe}
                  </div>
                </div>
              </div>
            </CardHeader>
            <CardContent>
              <p className="text-gray-700 dark:text-gray-300 mb-4">{template.description}</p>
              
              {/* Response Overview */}
              <div className="space-y-3 mb-4">
                <div>
                  <div className="text-sm font-medium text-gray-900 dark:text-gray-100 mb-2">Response Phases:</div>
                  <div className="flex items-center gap-2">
                    {template.responsePhases.map((phase: any, index: number) => (
                      <div key={index} className="flex items-center gap-1">
                        <Badge variant="outline" className="text-xs">
                          {phase.phase}
                        </Badge>
                        {index < template.responsePhases.length - 1 && <ArrowRight className="h-3 w-3 text-gray-400" />}
                      </div>
                    ))}
                  </div>
                </div>

                <div>
                  <div className="text-sm font-medium text-gray-900 dark:text-gray-100 mb-2">Escalation Triggers:</div>
                  <div className="text-xs text-gray-600 dark:text-gray-400">
                    {template.escalationTriggers.slice(0, 2).map((trigger, index) => (
                      <div key={index} className="flex items-center gap-1">
                        <AlertCircle className="h-3 w-3 text-orange-500" />
                        {trigger}
                      </div>
                    ))}
                    {template.escalationTriggers.length > 2 && (
                      <div className="text-gray-500 mt-1">+{template.escalationTriggers.length - 2} more triggers</div>
                    )}
                  </div>
                </div>
              </div>

              {/* Action Buttons */}
              <div className="flex items-center gap-3">
                <Button 
                  variant="destructive" 
                  className="flex-1"
                  onClick={() => quickActivateMutation.mutate({ templateId: template.id })}
                  disabled={quickActivateMutation.isPending}
                  data-testid={`quick-activate-${template.id}`}
                >
                  <Zap className="h-4 w-4 mr-2" />
                  {quickActivateMutation.isPending ? 'Activating...' : 'Emergency Activation'}
                </Button>
                <Button variant="outline" size="sm" data-testid={`view-details-${template.id}`}>
                  View Details
                </Button>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* Crisis Readiness Metrics */}
      <Card className="bg-gradient-to-r from-blue-600 to-purple-600 text-white" data-testid="crisis-readiness-metrics">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <TrendingUp className="h-5 w-5" />
            Crisis Readiness Assessment
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div className="text-center">
              <div className="text-2xl font-bold mb-1">{crisisTemplates.length}</div>
              <div className="text-blue-100 text-sm">Response Templates</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold mb-1">24/7</div>
              <div className="text-blue-100 text-sm">Monitoring Status</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold mb-1">&lt;1hr</div>
              <div className="text-blue-100 text-sm">Response Time</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold mb-1">98%</div>
              <div className="text-blue-100 text-sm">Readiness Score</div>
            </div>
          </div>
          
          <div className="mt-6">
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm">Overall Crisis Preparedness</span>
              <span className="text-sm">98%</span>
            </div>
            <Progress value={98} className="bg-blue-400" />
          </div>
        </CardContent>
      </Card>

      {/* Emergency Contact Information */}
      <Card className="border-green-200 bg-green-50 dark:bg-green-900/20" data-testid="emergency-contacts">
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-green-800 dark:text-green-200">
            <Users className="h-5 w-5" />
            Emergency Response Team
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div className="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
              <div className="font-semibold">Crisis Commander</div>
              <div className="text-sm text-gray-600 dark:text-gray-400">24/7 Emergency Line</div>
              <Button variant="outline" size="sm" className="mt-2" data-testid="contact-crisis-commander">
                Contact Now
              </Button>
            </div>
            <div className="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
              <div className="font-semibold">Legal Counsel</div>
              <div className="text-sm text-gray-600 dark:text-gray-400">Regulatory & Compliance</div>
              <Button variant="outline" size="sm" className="mt-2" data-testid="contact-legal">
                Contact Now
              </Button>
            </div>
            <div className="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
              <div className="font-semibold">Communications Lead</div>
              <div className="text-sm text-gray-600 dark:text-gray-400">Media & Stakeholder</div>
              <Button variant="outline" size="sm" className="mt-2" data-testid="contact-communications">
                Contact Now
              </Button>
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

========================================
FILE: client/src/components/CulturalAnalyticsPanel.tsx
========================================
import { useState, useEffect } from "react";
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Heart, Users, TrendingUp, Shield, Lightbulb, Target } from "lucide-react";

interface CulturalMetric {
  id: string;
  dimension: string;
  score: string;
  trend: string;
  assessmentDate: string;
  factors?: any;
  recommendations?: any;
}

export default function CulturalAnalyticsPanel() {
  const [organizationId, setOrganizationId] = useState<string | null>(null);

  const { data: organizations } = useQuery({
    queryKey: ["/api/organizations"],
    enabled: true
  });

  useEffect(() => {
    if (organizations && Array.isArray(organizations) && organizations.length > 0) {
      setOrganizationId(organizations[0].id);
    }
  }, [organizations]);

  const { data: metrics, isLoading } = useQuery({
    queryKey: [`/api/echo-cultural-metrics/${organizationId}/latest`],
    enabled: !!organizationId
  });

  const getDimensionIcon = (dimension: string) => {
    switch (dimension.toLowerCase()) {
      case 'psychological safety': return <Shield className="h-4 w-4" />;
      case 'innovation culture': return <Lightbulb className="h-4 w-4" />;
      case 'collaboration': return <Users className="h-4 w-4" />;
      case 'purpose alignment': return <Target className="h-4 w-4" />;
      case 'leadership trust': return <Heart className="h-4 w-4" />;
      default: return <TrendingUp className="h-4 w-4" />;
    }
  };

  const getTrendColor = (trend: string) => {
    switch (trend.toLowerCase()) {
      case 'improving': return "text-green-600";
      case 'stable': return "text-blue-600";
      case 'declining': return "text-red-600";
      default: return "text-gray-600";
    }
  };

  const getScoreColor = (score: number) => {
    if (score >= 8) return "text-green-600";
    if (score >= 6) return "text-yellow-600";
    return "text-red-600";
  };

  if (isLoading) {
    return (
      <Card data-testid="cultural-analytics-panel" className="h-80">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Heart className="h-5 w-5" />
            Cultural Analytics
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {[1, 2, 3].map(i => (
              <div key={i} className="animate-pulse">
                <div className="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div className="h-2 bg-gray-200 rounded w-full"></div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    );
  }

  const overallHealth = metrics && Array.isArray(metrics) && metrics.length > 0 
    ? metrics.reduce((sum: number, m: CulturalMetric) => sum + parseFloat(m.score), 0) / metrics.length 
    : 0;

  return (
    <Card data-testid="cultural-analytics-panel" className="h-80">
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Heart className="h-5 w-5" />
          Cultural Analytics
        </CardTitle>
        <CardDescription>
          Organizational culture health assessment
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        {metrics && Array.isArray(metrics) && metrics.length > 0 ? (
          <div className="space-y-3">
            {metrics.slice(0, 4).map((metric: CulturalMetric) => {
              const score = parseFloat(metric.score);
              const progressValue = (score / 10) * 100;
              
              return (
                <div key={metric.id} className="flex items-center justify-between">
                  <div className="flex items-center gap-3 flex-1">
                    <div className="p-2 rounded-lg bg-purple-50 text-purple-600">
                      {getDimensionIcon(metric.dimension)}
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center justify-between mb-1">
                        <span className="text-sm font-medium" data-testid={`dimension-${metric.dimension.replace(/\s+/g, '-').toLowerCase()}`}>
                          {metric.dimension}
                        </span>
                        <div className="flex items-center gap-2">
                          <span className={`text-sm font-medium ${getScoreColor(score)}`} data-testid={`score-${metric.dimension.replace(/\s+/g, '-').toLowerCase()}`}>
                            {score.toFixed(1)}/10
                          </span>
                          <Badge 
                            variant="outline" 
                            className={`text-xs ${getTrendColor(metric.trend)}`}
                            data-testid={`trend-${metric.dimension.replace(/\s+/g, '-').toLowerCase()}`}
                          >
                            {metric.trend}
                          </Badge>
                        </div>
                      </div>
                      <Progress value={progressValue} className="h-2" />
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        ) : (
          <div className="text-center py-8">
            <Heart className="h-12 w-12 mx-auto text-muted-foreground mb-4" />
            <p className="text-muted-foreground">No cultural metrics available</p>
            <p className="text-sm text-muted-foreground mt-1">
              Cultural assessment data will appear here
            </p>
          </div>
        )}
        
        {metrics && Array.isArray(metrics) && metrics.length > 0 && (
          <div className="pt-4 border-t">
            <div className="flex items-center justify-between">
              <span className="text-sm text-muted-foreground">Cultural Health</span>
              <div className="flex items-center gap-2">
                <Badge 
                  variant="secondary" 
                  className={`${getScoreColor(overallHealth) === 'text-green-600' ? 'bg-green-50 text-green-700' : 
                              getScoreColor(overallHealth) === 'text-yellow-600' ? 'bg-yellow-50 text-yellow-700' : 
                              'bg-red-50 text-red-700'}`}
                  data-testid="cultural-health-score"
                >
                  {overallHealth.toFixed(1)}/10
                </Badge>
                <span className="text-xs text-muted-foreground">
                  {overallHealth >= 8 ? 'Excellent' : overallHealth >= 6 ? 'Good' : 'Needs Attention'}
                </span>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}

========================================
FILE: client/src/components/DecisionConfidenceScore.tsx
========================================
import { useQuery, useMutation } from "@tanstack/react-query";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { Badge } from "@/components/ui/badge";
import { 
  Target, 
  Users, 
  Database, 
  Shield,
  TrendingUp,
  AlertTriangle
} from "lucide-react";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { useAuth } from "@/hooks/useAuth";
import { useEffect } from "react";

interface DecisionConfidenceScoreProps {
  scenarioId: string;
  stakeholderCount?: number;
  dataSourcesConnected?: number;
}

interface ConfidenceData {
  overallScore: number;
  dataCompletenessScore: number;
  stakeholderAlignmentScore: number;
  historicalPrecedentScore: number;
  riskCoverageScore: number;
  dataSourcesConnected: number;
  stakeholdersMapped: number;
  similarCasesFound: number;
  risksCovered: number;
  totalRisks: number;
  recommendedActions: string[];
  confidenceLevel: 'high' | 'medium' | 'low';
}

export default function DecisionConfidenceScore({ 
  scenarioId, 
  stakeholderCount = 0,
  dataSourcesConnected = 0 
}: DecisionConfidenceScoreProps) {
  const { user } = useAuth();

  const { data: confidence, isLoading } = useQuery<ConfidenceData>({
    queryKey: ['/api/decision-confidence', scenarioId],
    enabled: !!scenarioId && !!user?.id,
  });

  const createConfidenceMutation = useMutation({
    mutationFn: async (data: any) => {
      return await apiRequest('POST', `/api/decision-confidence`, data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/decision-confidence', scenarioId] });
    },
  });

  useEffect(() => {
    if (!confidence && user?.id && !isLoading) {
      const dataCompletenessScore = Math.min(100, (dataSourcesConnected / 5) * 100);
      const stakeholderAlignmentScore = Math.min(100, (stakeholderCount / 8) * 100);
      const historicalPrecedentScore = 75;
      const riskCoverageScore = 80;
      
      const overallScore = Math.round(
        (dataCompletenessScore * 0.3 +
        stakeholderAlignmentScore * 0.3 +
        historicalPrecedentScore * 0.2 +
        riskCoverageScore * 0.2)
      );

      createConfidenceMutation.mutate({
        scenarioId,
        userId: user.id,
        overallScore,
        dataCompletenessScore: Math.round(dataCompletenessScore),
        stakeholderAlignmentScore: Math.round(stakeholderAlignmentScore),
        historicalPrecedentScore,
        riskCoverageScore,
        dataSourcesConnected,
        stakeholdersMapped: stakeholderCount,
        similarCasesFound: 12,
        risksCovered: 15,
        totalRisks: 18,
        recommendedActions: [
          "Connect CRM for customer impact data",
          "Map remaining 3 key stakeholders",
          "Review 2025 supplier disruption case"
        ],
        confidenceLevel: overallScore >= 80 ? 'high' : overallScore >= 60 ? 'medium' : 'low'
      });
    }
  }, [confidence, user, scenarioId, stakeholderCount, dataSourcesConnected, isLoading]);

  if (isLoading || !confidence) {
    return null;
  }

  const scoreColor = confidence.overallScore >= 80 ? 'text-green-600' : 
                     confidence.overallScore >= 60 ? 'text-yellow-600' : 'text-red-600';
  
  const confidenceBadge = confidence.confidenceLevel === 'high' ? 'default' : 
                          confidence.confidenceLevel === 'medium' ? 'secondary' : 'destructive';

  return (
    <Card className="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950 dark:to-indigo-950 border-blue-200 dark:border-blue-800" data-testid="decision-confidence-card">
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="flex items-center gap-2">
            <Target className="h-5 w-5 text-blue-600" />
            Ready to Decide?
          </CardTitle>
          <div className="flex items-center gap-3">
            <Badge variant={confidenceBadge} data-testid="confidence-badge">
              {confidence.confidenceLevel.toUpperCase()}
            </Badge>
            <div className={`text-4xl font-bold ${scoreColor}`} data-testid="confidence-score">
              {confidence.overallScore}%
            </div>
          </div>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2" data-testid="data-completeness-metric">
            <div className="flex items-center justify-between text-sm">
              <div className="flex items-center gap-2">
                <Database className="h-4 w-4 text-blue-600" />
                <span className="font-medium">Your Data</span>
              </div>
              <span className="font-semibold" data-testid="data-completeness-score">{confidence.dataCompletenessScore}%</span>
            </div>
            <Progress value={confidence.dataCompletenessScore} className="h-2" />
            <p className="text-xs text-gray-600 dark:text-gray-400">
              {confidence.dataSourcesConnected} of 5 sources connected
            </p>
          </div>

          <div className="space-y-2" data-testid="stakeholder-alignment-metric">
            <div className="flex items-center justify-between text-sm">
              <div className="flex items-center gap-2">
                <Users className="h-4 w-4 text-purple-600" />
                <span className="font-medium">Team Aligned</span>
              </div>
              <span className="font-semibold" data-testid="stakeholder-alignment-score">{confidence.stakeholderAlignmentScore}%</span>
            </div>
            <Progress value={confidence.stakeholderAlignmentScore} className="h-2" />
            <p className="text-xs text-gray-600 dark:text-gray-400">
              {confidence.stakeholdersMapped} key stakeholders mapped
            </p>
          </div>

          <div className="space-y-2" data-testid="historical-precedent-metric">
            <div className="flex items-center justify-between text-sm">
              <div className="flex items-center gap-2">
                <TrendingUp className="h-4 w-4 text-green-600" />
                <span className="font-medium">Past Plays</span>
              </div>
              <span className="font-semibold" data-testid="historical-precedent-score">{confidence.historicalPrecedentScore}%</span>
            </div>
            <Progress value={confidence.historicalPrecedentScore} className="h-2" />
            <p className="text-xs text-gray-600 dark:text-gray-400">
              {confidence.similarCasesFound} similar cases analyzed
            </p>
          </div>

          <div className="space-y-2" data-testid="risk-coverage-metric">
            <div className="flex items-center justify-between text-sm">
              <div className="flex items-center gap-2">
                <Shield className="h-4 w-4 text-orange-600" />
                <span className="font-medium">Risk Coverage</span>
              </div>
              <span className="font-semibold" data-testid="risk-coverage-score">{confidence.riskCoverageScore}%</span>
            </div>
            <Progress value={confidence.riskCoverageScore} className="h-2" />
            <p className="text-xs text-gray-600 dark:text-gray-400">
              {confidence.risksCovered} of {confidence.totalRisks} risks addressed
            </p>
          </div>
        </div>

        {confidence.recommendedActions && confidence.recommendedActions.length > 0 && (
          <div className="mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800" data-testid="recommended-actions">
            <div className="flex items-start gap-2">
              <AlertTriangle className="h-4 w-4 text-yellow-600 mt-0.5" />
              <div className="flex-1">
                <p className="text-sm font-semibold text-yellow-900 dark:text-yellow-100 mb-1">
                  To boost confidence:
                </p>
                <ul className="text-xs text-yellow-800 dark:text-yellow-200 space-y-1">
                  {confidence.recommendedActions.map((action: string, idx: number) => (
                    <li key={idx} data-testid={`recommended-action-${idx}`}> {action}</li>
                  ))}
                </ul>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/DecisionVelocityDashboard.tsx
========================================
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Button } from '@/components/ui/button';
import { ArrowUp, ArrowDown, TrendingUp, Zap, Target, Clock, Award } from 'lucide-react';

interface DecisionVelocityData {
  velocityScore: number; // 0-100
  averageResponseTime: number; // in minutes
  industryStandard: number; // in minutes
  competitiveAdvantage: number; // in days
  eventsProcessed: number;
  trend: 'up' | 'down' | 'stable';
  trendPercentage: number;
  quarterlyMetrics: {
    totalEvents: number;
    avgDecisionTime: number;
    velocityImprovement: number;
  };
}

export default function DecisionVelocityDashboard({ organizationId }: { organizationId: string }) {
  // Demo data showing Decision Velocity metrics
  const velocityData: DecisionVelocityData = {
    velocityScore: 92,
    averageResponseTime: 12, // 12 minutes
    industryStandard: 4320, // 72 hours = 4320 minutes
    competitiveAdvantage: 5, // 5 days ahead
    eventsProcessed: 47,
    trend: 'up',
    trendPercentage: 23,
    quarterlyMetrics: {
      totalEvents: 142,
      avgDecisionTime: 15,
      velocityImprovement: 85
    }
  };

  const velocityColor = 
    velocityData.velocityScore >= 80 ? 'text-green-600 dark:text-green-400' :
    velocityData.velocityScore >= 60 ? 'text-blue-600 dark:text-blue-400' :
    'text-yellow-600 dark:text-yellow-400';

  const velocityBgColor = 
    velocityData.velocityScore >= 80 ? 'bg-green-100 dark:bg-green-900/20' :
    velocityData.velocityScore >= 60 ? 'bg-blue-100 dark:bg-blue-900/20' :
    'bg-yellow-100 dark:bg-yellow-900/20';

  const timesSaved = Math.floor(velocityData.industryStandard / velocityData.averageResponseTime);

  return (
    <div className="space-y-6">
      <Card className="w-full shadow-lg border-2" data-testid="decision-velocity-dashboard">
        <CardHeader className="pb-3">
          <div className="flex items-center justify-between">
            <div>
              <CardTitle className="text-xl flex items-center gap-2">
                <Zap className="h-6 w-6 text-yellow-500" />
                Decision Velocity Dashboard
              </CardTitle>
              <CardDescription className="text-sm mt-1">
                Your competitive advantage metric for Dynamic Strategy execution
              </CardDescription>
            </div>
            <Badge variant="outline" className="bg-yellow-500/10 text-yellow-600 dark:text-yellow-400 border-yellow-500/20">
              Dynamic Strategy
            </Badge>
          </div>
        </CardHeader>

        <CardContent className="space-y-6">
          {/* Main Velocity Score */}
          <div className={`${velocityBgColor} rounded-xl p-6 text-center`}>
            <div className="flex items-center justify-center gap-3">
              <div className={`text-6xl font-bold ${velocityColor}`} data-testid="velocity-score">
                {velocityData.velocityScore}
              </div>
              <div className="text-left">
                <div className={`text-sm font-medium ${velocityColor}`}>/100</div>
                <Badge variant="default" className="mt-1 bg-green-600">
                  Excellent
                </Badge>
              </div>
            </div>

            {/* Trend */}
            <div className="flex items-center justify-center gap-1 mt-3" data-testid="velocity-trend">
              {velocityData.trend === 'up' ? (
                <ArrowUp className="h-4 w-4 text-green-600 dark:text-green-400" />
              ) : (
                <ArrowDown className="h-4 w-4 text-red-600 dark:text-red-400" />
              )}
              <span className={`text-sm font-medium ${velocityData.trend === 'up' ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}>
                {velocityData.trendPercentage}% improvement
              </span>
              <span className="text-xs text-muted-foreground">this quarter</span>
            </div>
          </div>

          {/* Competitive Advantage Grid */}
          <div className="grid grid-cols-2 gap-4">
            <div className="bg-blue-50 dark:bg-blue-950/20 rounded-lg p-4" data-testid="response-time">
              <div className="flex items-center gap-2 mb-2">
                <Clock className="h-5 w-5 text-blue-600 dark:text-blue-400" />
                <span className="text-sm text-blue-600 dark:text-blue-400 font-medium">Avg Response Time</span>
              </div>
              <div className="text-3xl font-bold text-blue-700 dark:text-blue-300">
                {velocityData.averageResponseTime} min
              </div>
              <div className="text-xs text-muted-foreground mt-1">
                vs {Math.floor(velocityData.industryStandard / 60)}hr industry standard
              </div>
              <div className="mt-2">
                <Badge variant="secondary" className="text-xs bg-blue-600/10 text-blue-700 dark:text-blue-300">
                  {timesSaved}x faster
                </Badge>
              </div>
            </div>

            <div className="bg-green-50 dark:bg-green-950/20 rounded-lg p-4" data-testid="competitive-advantage">
              <div className="flex items-center gap-2 mb-2">
                <Award className="h-5 w-5 text-green-600 dark:text-green-400" />
                <span className="text-sm text-green-600 dark:text-green-400 font-medium">Competitive Edge</span>
              </div>
              <div className="text-3xl font-bold text-green-700 dark:text-green-300">
                {velocityData.competitiveAdvantage} days
              </div>
              <div className="text-xs text-muted-foreground mt-1">
                ahead per strategic move
              </div>
              <div className="mt-2">
                <Badge variant="secondary" className="text-xs bg-green-600/10 text-green-700 dark:text-green-300">
                  Category leader
                </Badge>
              </div>
            </div>
          </div>

          {/* Quarterly Impact */}
          <div className="bg-purple-50 dark:bg-purple-950/20 rounded-lg p-4" data-testid="quarterly-impact">
            <div className="flex items-center gap-2 mb-3">
              <TrendingUp className="h-5 w-5 text-purple-600 dark:text-purple-400" />
              <span className="text-sm font-medium text-purple-700 dark:text-purple-300">Quarterly Impact</span>
            </div>
            
            <div className="grid grid-cols-3 gap-4">
              <div>
                <div className="text-2xl font-bold text-purple-700 dark:text-purple-300">
                  {velocityData.quarterlyMetrics.totalEvents}
                </div>
                <div className="text-xs text-muted-foreground">Strategic events</div>
              </div>
              <div>
                <div className="text-2xl font-bold text-purple-700 dark:text-purple-300">
                  {velocityData.quarterlyMetrics.avgDecisionTime}m
                </div>
                <div className="text-xs text-muted-foreground">Avg decision time</div>
              </div>
              <div>
                <div className="text-2xl font-bold text-purple-700 dark:text-purple-300">
                  {velocityData.quarterlyMetrics.velocityImprovement}%
                </div>
                <div className="text-xs text-muted-foreground">Velocity improvement</div>
              </div>
            </div>
          </div>

          {/* Decision Velocity Premium Calculation */}
          <div className="bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 border-2 border-dashed border-gray-300 dark:border-gray-700" data-testid="velocity-premium">
            <div className="text-sm font-semibold text-gray-900 dark:text-white mb-2">
              Decision Velocity Premium
            </div>
            <div className="text-xs text-muted-foreground space-y-1">
              <div className="flex justify-between">
                <span>Your velocity:</span>
                <span className="font-medium">{velocityData.averageResponseTime} minutes</span>
              </div>
              <div className="flex justify-between">
                <span>Competitor velocity:</span>
                <span className="font-medium">{Math.floor(velocityData.industryStandard / 60)} hours</span>
              </div>
              <div className="flex justify-between">
                <span>Your advantage:</span>
                <span className="font-medium text-green-600 dark:text-green-400">{velocityData.competitiveAdvantage} days per move</span>
              </div>
              <div className="border-t pt-2 mt-2">
                <div className="flex justify-between">
                  <span> {velocityData.eventsProcessed} events this quarter</span>
                  <span className="font-bold text-green-600 dark:text-green-400">{velocityData.competitiveAdvantage * velocityData.eventsProcessed} days total advantage</span>
                </div>
              </div>
            </div>
          </div>

          {/* Board-Ready Messaging */}
          <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-4 text-white" data-testid="board-message">
            <div className="text-sm font-semibold mb-2">Board Presentation Language:</div>
            <div className="text-xs italic">
              "We've operationalized Dynamic Strategy through M. Decision velocity improved {velocityData.quarterlyMetrics.velocityImprovement}%, 
              averaging {velocityData.competitiveAdvantage} days ahead of competitors per strategic initiative. This contributed to our 
              competitive positioning and operational excellence this quarter."
            </div>
          </div>

          {/* Action Button */}
          <Button className="w-full" variant="default" data-testid="button-view-detailed-velocity">
            <Target className="h-4 w-4 mr-2" />
            View Detailed Velocity Analysis
          </Button>
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/EmptyConfigState.tsx
========================================
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Link } from 'wouter';
import { 
  Building2, 
  Target, 
  Layers, 
  BarChart3, 
  Settings,
  ArrowRight,
  Sparkles
} from 'lucide-react';

interface EmptyConfigStateProps {
  type: 'departments' | 'stakeholders' | 'triggers' | 'playbooks' | 'metrics' | 'general';
  title?: string;
  description?: string;
  actionPath?: string;
  actionLabel?: string;
}

const configInfo = {
  departments: {
    icon: Building2,
    title: 'No Departments Configured',
    description: 'Add your organizational departments to enable team coordination during playbook execution.',
    actionPath: '/organization-setup',
    actionLabel: 'Configure Organization',
    color: 'text-blue-500',
    bgColor: 'bg-blue-500/10',
  },
  stakeholders: {
    icon: Building2,
    title: 'No Stakeholders Configured',
    description: 'Add your key decision-makers and team leads to enable approval workflows and notifications.',
    actionPath: '/organization-setup',
    actionLabel: 'Add Stakeholders',
    color: 'text-purple-500',
    bgColor: 'bg-purple-500/10',
  },
  triggers: {
    icon: Target,
    title: 'No Triggers Configured',
    description: 'Set up intelligence monitoring thresholds to automatically detect strategic situations.',
    actionPath: '/triggers-management',
    actionLabel: 'Configure Triggers',
    color: 'text-amber-500',
    bgColor: 'bg-amber-500/10',
  },
  playbooks: {
    icon: Layers,
    title: 'No Playbooks Customized',
    description: 'Customize playbooks from our library of 166 templates to match your organization\'s processes.',
    actionPath: '/playbook-customization',
    actionLabel: 'Customize Playbooks',
    color: 'text-green-500',
    bgColor: 'bg-green-500/10',
  },
  metrics: {
    icon: BarChart3,
    title: 'No Success Metrics Defined',
    description: 'Define your KPIs and targets to measure strategic execution effectiveness.',
    actionPath: '/success-metrics',
    actionLabel: 'Set Metrics',
    color: 'text-indigo-500',
    bgColor: 'bg-indigo-500/10',
  },
  general: {
    icon: Settings,
    title: 'Configuration Required',
    description: 'Complete your M platform setup to unlock full strategic execution capabilities.',
    actionPath: '/onboarding',
    actionLabel: 'Start Setup',
    color: 'text-cyan-500',
    bgColor: 'bg-cyan-500/10',
  },
};

export default function EmptyConfigState({ 
  type, 
  title, 
  description, 
  actionPath, 
  actionLabel 
}: EmptyConfigStateProps) {
  const info = configInfo[type];
  const Icon = info.icon;
  
  return (
    <Card className="border-dashed border-2 border-slate-700 bg-slate-900/50">
      <CardContent className="flex flex-col items-center justify-center py-12 text-center">
        <div className={`w-16 h-16 rounded-full ${info.bgColor} flex items-center justify-center mb-4`}>
          <Icon className={`h-8 w-8 ${info.color}`} />
        </div>
        <h3 className="text-lg font-semibold text-white mb-2">
          {title || info.title}
        </h3>
        <p className="text-slate-400 mb-6 max-w-md">
          {description || info.description}
        </p>
        <Link href={actionPath || info.actionPath}>
          <Button className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700">
            <Sparkles className="h-4 w-4 mr-2" />
            {actionLabel || info.actionLabel}
            <ArrowRight className="h-4 w-4 ml-2" />
          </Button>
        </Link>
      </CardContent>
    </Card>
  );
}

export function QuickSetupBanner() {
  return (
    <Card className="bg-gradient-to-r from-blue-900/50 to-purple-900/50 border-blue-500/30">
      <CardContent className="flex items-center justify-between py-4">
        <div className="flex items-center gap-4">
          <div className="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center">
            <Sparkles className="h-6 w-6 text-blue-400" />
          </div>
          <div>
            <h3 className="font-semibold text-white">Complete Your Setup</h3>
            <p className="text-sm text-slate-300">Configure M for your organization in under 30 minutes</p>
          </div>
        </div>
        <Link href="/onboarding">
          <Button variant="secondary" className="bg-white/10 hover:bg-white/20 text-white border-white/20">
            Start Setup Wizard
            <ArrowRight className="h-4 w-4 ml-2" />
          </Button>
        </Link>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/EnterpriseNavigation.tsx
========================================
/**
 * @deprecated Use PageLayout instead which includes an integrated sidebar.
 * This component is kept for backwards compatibility but should not be used in new pages.
 */
import { useState } from 'react';
import { Link, useLocation } from 'wouter';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { AlertTriangle, Shield } from 'lucide-react';
import { navigationItems, categories, getItemsByCategory, NavigationCategory } from '@/navigation/config';
import { renderIcon } from '@/lib/iconRenderer';

// Now using centralized navigation config from @/navigation/config

export default function EnterpriseNavigation() {
  const [location] = useLocation();
  const [expandedCategory, setExpandedCategory] = useState<NavigationCategory | null>('intelligence');

  // Map centralized categories to display config with gradients
  const categoryDisplayConfig = {
    intelligence: {
      gradient: 'bg-gradient-to-r from-primary via-blue-500 to-teal-500'
    },
    crisis: {
      gradient: 'bg-gradient-to-r from-red-600 to-orange-600'
    },
    strategic: {
      gradient: 'bg-gradient-to-r from-teal-600 to-primary'
    },
    system: {
      gradient: 'bg-gradient-to-r from-gray-600 to-gray-700'
    }
  };

  // Use centralized categories and group items
  const groupedItems = Object.entries(categories).map(([categoryKey, categoryInfo]) => ({
    ...categoryInfo,
    key: categoryKey as NavigationCategory,
    gradient: categoryDisplayConfig[categoryKey as NavigationCategory]?.gradient || 'bg-gradient-to-r from-gray-600 to-gray-700',
    items: getItemsByCategory(categoryKey as NavigationCategory)
  }));

  return (
    <div className="w-96 min-h-screen bg-gray-950/95 backdrop-blur-md border-r border-gray-700/50 overflow-y-auto flex-shrink-0" data-testid="enterprise-navigation">
      <div className="p-6">
        <div className="flex items-center gap-3 mb-6">
          <div className="w-10 h-10 bg-gradient-to-br from-slate-100 to-slate-300 rounded-xl flex items-center justify-center shadow-lg">
            <span className="text-slate-900 font-bold text-xl">M</span>
          </div>
          <div>
            <h1 className="text-xl font-bold text-white">M</h1>
            <p className="text-sm text-gray-300">Strategic Execution OS</p>
          </div>
        </div>

        <div className="space-y-4">
          {groupedItems.map((category) => (
            <div key={category.key}>
              <Button
                variant="ghost"
                className={`w-full justify-start h-auto p-3 ${category.gradient} text-white hover:opacity-90`}
                onClick={() => setExpandedCategory(expandedCategory === category.key ? null : category.key)}
                data-testid={`nav-category-${category.key}`}
              >
                <div className="flex items-center justify-between w-full">
                  <div className="flex items-center gap-2">
                    {renderIcon(category.icon, "h-4 w-4")}
                    <span className="font-medium">{category.label}</span>
                  </div>
                  <Badge variant="secondary" className="bg-white/20 text-white border-white/30">
                    {category.items.length}
                  </Badge>
                </div>
              </Button>

              {expandedCategory === category.key && (
                <div className="mt-2 space-y-1 pl-4">
                  {category.items.map((item) => (
                    <Link key={item.id} to={item.path}>
                      <Button
                        variant="ghost"
                        className={`w-full justify-start h-auto p-3 text-gray-300 hover:text-white hover:bg-gray-800/50 ${location === item.path ? 'bg-primary/20 text-primary-foreground border-l-4 border-l-primary' : ''}`}
                        data-testid={`nav-item-${item.id}`}
                      >
                        <div className="flex items-center justify-between w-full min-w-0">
                          <div className="flex items-center gap-3 min-w-0 flex-1">
                            {renderIcon(item.icon, "h-5 w-5")}
                            <div className="text-left min-w-0 flex-1">
                              <div className="font-medium truncate">{item.label}</div>
                              <div className="text-xs text-gray-400 truncate">{item.description}</div>
                            </div>
                          </div>
                          {item.badge && (
                            <Badge 
                              variant={item.badge === 'LIVE' ? 'destructive' : 'secondary'} 
                              className="text-xs"
                            >
                              {item.badge}
                            </Badge>
                          )}
                        </div>
                      </Button>
                    </Link>
                  ))}
                </div>
              )}
              
              {category.key !== 'system' && <Separator className="my-2" />}
            </div>
          ))}
        </div>

        {/* Crisis Response Quick Access */}
        <Card className="mt-6 border-destructive/30 bg-destructive/20 backdrop-blur-sm" data-testid="crisis-quick-access">
          <CardContent className="p-4">
            <div className="flex items-center gap-2 mb-2">
              <AlertTriangle className="h-4 w-4 text-destructive" />
              <span className="font-semibold text-destructive-foreground">Emergency Response</span>
            </div>
            <p className="text-xs text-destructive-foreground/80 mb-3">
              Immediate access to crisis management protocols
            </p>
            <Link to="/crisis">
              <Button variant="destructive" size="sm" className="w-full" data-testid="emergency-response-button">
                <Shield className="h-4 w-4 mr-2" />
                Activate Crisis Response
              </Button>
            </Link>
          </CardContent>
        </Card>

        {/* Platform Status */}
        <div className="mt-6 p-4 bg-primary/10 backdrop-blur-sm rounded-lg border border-primary/30" data-testid="platform-status">
          <div className="flex items-center gap-2 mb-2">
            <div className="w-2 h-2 bg-primary rounded-full animate-pulse"></div>
            <span className="text-sm font-medium text-primary-foreground">Platform Status</span>
          </div>
          <div className="text-xs text-primary-foreground/80">
            All systems operational  AI modules active  Crisis response ready
          </div>
        </div>
      </div>
    </div>
  );
}

========================================
FILE: client/src/components/ExecutionValidationReport.tsx
========================================
import { useQuery, useMutation } from "@tanstack/react-query";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { 
  CheckCircle2, 
  TrendingUp, 
  TrendingDown,
  Target,
  AlertTriangle,
  FileText,
  BarChart3
} from "lucide-react";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { useEffect } from "react";
import { useAuth } from "@/hooks/useAuth";

interface ValidationReportData {
  scenarioId: string;
  executionId: string;
  executedBy: string;
  predictedOutcomes: {
    timeToResolution: number;
    estimatedCost: number;
    stakeholdersImpacted: number;
    risksIdentified: number;
    successProbability: number;
  };
  actualOutcomes: {
    timeToResolution: number;
    actualCost: number;
    stakeholdersEngaged: number;
    risksRealized: number;
    successAchieved: boolean;
  };
  variance: {
    timeVariance: number;
    costVariance: number;
    stakeholderVariance: number;
    riskVariance: number;
  };
  accuracy: number;
  lessonsLearned: string[];
  improvementAreas: string[];
  validationStatus: string;
  validatedBy: string;
}

interface ExecutionValidationReportProps {
  scenarioId: string;
  executionId: string;
  executionCompleted: boolean;
}

export default function ExecutionValidationReport({ 
  scenarioId, 
  executionId,
  executionCompleted 
}: ExecutionValidationReportProps) {
  const { user } = useAuth();

  const { data: report, isLoading } = useQuery<ValidationReportData>({
    queryKey: ['/api/execution-validation-reports/execution', executionId],
    enabled: !!executionId && executionCompleted,
  });

  const createReportMutation = useMutation({
    mutationFn: async (data: any) => {
      return await apiRequest('POST', `/api/execution-validation-reports`, data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/execution-validation-reports/execution', executionId] });
    },
  });

  useEffect(() => {
    if (!report && executionCompleted && user?.id && !isLoading) {
      const predictedTime = 720;
      const actualTime = 680;
      const predictedCost = 50000;
      const actualCost = 42000;
      const predictedStakeholders = 8;
      const actualStakeholders = 8;
      const predictedRisks = 5;
      const actualRisks = 3;

      const accuracy = Math.round(
        ((1 - Math.abs(predictedTime - actualTime) / predictedTime) * 0.3 +
        (1 - Math.abs(predictedCost - actualCost) / predictedCost) * 0.3 +
        (predictedStakeholders === actualStakeholders ? 1 : 0.7) * 0.2 +
        (1 - Math.abs(predictedRisks - actualRisks) / predictedRisks) * 0.2) * 100
      );

      createReportMutation.mutate({
        scenarioId,
        executionId,
        executedBy: user.id,
        predictedOutcomes: {
          timeToResolution: predictedTime,
          estimatedCost: predictedCost,
          stakeholdersImpacted: predictedStakeholders,
          risksIdentified: predictedRisks,
          successProbability: 85
        },
        actualOutcomes: {
          timeToResolution: actualTime,
          actualCost: actualCost,
          stakeholdersEngaged: actualStakeholders,
          risksRealized: actualRisks,
          successAchieved: true
        },
        variance: {
          timeVariance: ((actualTime - predictedTime) / predictedTime) * 100,
          costVariance: ((actualCost - predictedCost) / predictedCost) * 100,
          stakeholderVariance: 0,
          riskVariance: ((actualRisks - predictedRisks) / predictedRisks) * 100
        },
        accuracy,
        lessonsLearned: [
          "Early stakeholder engagement reduced response time by 6%",
          "Automated notifications prevented cost overrun",
          "Pre-configured playbook eliminated 2 major risks before materialization"
        ],
        improvementAreas: [
          "Risk assessment could be more granular",
          "Cost estimation needs supplier volatility factor"
        ],
        validationStatus: 'validated',
        validatedBy: user.id
      });
    }
  }, [report, executionCompleted, user, scenarioId, executionId, isLoading]);

  if (!executionCompleted || isLoading || !report) {
    return null;
  }

  const timeVariance = report.variance.timeVariance;
  const costVariance = report.variance.costVariance;
  const isTimeUnderBudget = timeVariance < 0;
  const isCostUnderBudget = costVariance < 0;

  return (
    <Card className="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950 dark:to-emerald-950 border-green-200 dark:border-green-800" data-testid="validation-report-card">
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="flex items-center gap-2">
            <BarChart3 className="h-5 w-5 text-green-600" />
            Did It Work?
          </CardTitle>
          <div className="flex items-center gap-3">
            <Badge variant="default" className="bg-green-600" data-testid="validation-status">
              {report.validationStatus.toUpperCase()}
            </Badge>
            <div className="text-center">
              <div className="text-3xl font-bold text-green-600" data-testid="accuracy-score">
                {report.accuracy}%
              </div>
              <div className="text-xs text-gray-600 dark:text-gray-400">Accuracy</div>
            </div>
          </div>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-3" data-testid="time-comparison">
            <div className="flex items-center justify-between">
              <span className="text-sm font-medium">Time</span>
              {isTimeUnderBudget ? (
                <TrendingDown className="h-4 w-4 text-green-600" />
              ) : (
                <TrendingUp className="h-4 w-4 text-red-600" />
              )}
            </div>
            <div className="space-y-1">
              <div className="flex justify-between text-sm">
                <span className="text-gray-600 dark:text-gray-400">Predicted</span>
                <span className="font-semibold">{report.predictedOutcomes.timeToResolution}s</span>
              </div>
              <div className="flex justify-between text-sm">
                <span className="text-gray-600 dark:text-gray-400">Actual</span>
                <span className="font-semibold" data-testid="actual-time">{report.actualOutcomes.timeToResolution}s</span>
              </div>
              <div className={`flex justify-between text-sm font-bold ${
                isTimeUnderBudget ? 'text-green-600' : 'text-red-600'
              }`}>
                <span>Variance</span>
                <span data-testid="time-variance">
                  {isTimeUnderBudget ? '' : '+'}{timeVariance.toFixed(1)}%
                </span>
              </div>
            </div>
          </div>

          <div className="space-y-3" data-testid="cost-comparison">
            <div className="flex items-center justify-between">
              <span className="text-sm font-medium">Cost</span>
              {isCostUnderBudget ? (
                <TrendingDown className="h-4 w-4 text-green-600" />
              ) : (
                <TrendingUp className="h-4 w-4 text-red-600" />
              )}
            </div>
            <div className="space-y-1">
              <div className="flex justify-between text-sm">
                <span className="text-gray-600 dark:text-gray-400">Predicted</span>
                <span className="font-semibold">${report.predictedOutcomes.estimatedCost.toLocaleString()}</span>
              </div>
              <div className="flex justify-between text-sm">
                <span className="text-gray-600 dark:text-gray-400">Actual</span>
                <span className="font-semibold" data-testid="actual-cost">${report.actualOutcomes.actualCost.toLocaleString()}</span>
              </div>
              <div className={`flex justify-between text-sm font-bold ${
                isCostUnderBudget ? 'text-green-600' : 'text-red-600'
              }`}>
                <span>Variance</span>
                <span data-testid="cost-variance">
                  {isCostUnderBudget ? '' : '+'}{costVariance.toFixed(1)}%
                </span>
              </div>
            </div>
          </div>

          <div className="space-y-3" data-testid="stakeholder-comparison">
            <div className="flex items-center justify-between">
              <span className="text-sm font-medium">Team Engaged</span>
              <CheckCircle2 className="h-4 w-4 text-green-600" />
            </div>
            <div className="space-y-1">
              <div className="flex justify-between text-sm">
                <span className="text-gray-600 dark:text-gray-400">Predicted</span>
                <span className="font-semibold">{report.predictedOutcomes.stakeholdersImpacted}</span>
              </div>
              <div className="flex justify-between text-sm">
                <span className="text-gray-600 dark:text-gray-400">Actual</span>
                <span className="font-semibold" data-testid="actual-stakeholders">{report.actualOutcomes.stakeholdersEngaged}</span>
              </div>
              <div className="flex justify-between text-sm font-bold text-green-600">
                <span>Match</span>
                <span data-testid="stakeholder-match">100%</span>
              </div>
            </div>
          </div>

          <div className="space-y-3" data-testid="risk-comparison">
            <div className="flex items-center justify-between">
              <span className="text-sm font-medium">Risks Hit</span>
              <TrendingDown className="h-4 w-4 text-green-600" />
            </div>
            <div className="space-y-1">
              <div className="flex justify-between text-sm">
                <span className="text-gray-600 dark:text-gray-400">Predicted</span>
                <span className="font-semibold">{report.predictedOutcomes.risksIdentified}</span>
              </div>
              <div className="flex justify-between text-sm">
                <span className="text-gray-600 dark:text-gray-400">Actual</span>
                <span className="font-semibold" data-testid="actual-risks">{report.actualOutcomes.risksRealized}</span>
              </div>
              <div className="flex justify-between text-sm font-bold text-green-600">
                <span>Prevented</span>
                <span data-testid="risks-prevented">{report.predictedOutcomes.risksIdentified - report.actualOutcomes.risksRealized}</span>
              </div>
            </div>
          </div>
        </div>

        {report.lessonsLearned && report.lessonsLearned.length > 0 && (
          <div className="mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800" data-testid="lessons-learned">
            <div className="flex items-start gap-2">
              <CheckCircle2 className="h-4 w-4 text-green-600 mt-0.5" />
              <div className="flex-1">
                <p className="text-sm font-semibold text-green-900 dark:text-green-100 mb-1">
                  What Worked:
                </p>
                <ul className="text-xs text-green-800 dark:text-green-200 space-y-1">
                  {report.lessonsLearned.map((lesson: string, idx: number) => (
                    <li key={idx} data-testid={`lesson-${idx}`}> {lesson}</li>
                  ))}
                </ul>
              </div>
            </div>
          </div>
        )}

        {report.improvementAreas && report.improvementAreas.length > 0 && (
          <div className="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800" data-testid="improvement-areas">
            <div className="flex items-start gap-2">
              <AlertTriangle className="h-4 w-4 text-yellow-600 mt-0.5" />
              <div className="flex-1">
                <p className="text-sm font-semibold text-yellow-900 dark:text-yellow-100 mb-1">
                  Do Better Next Time:
                </p>
                <ul className="text-xs text-yellow-800 dark:text-yellow-200 space-y-1">
                  {report.improvementAreas.map((area: string, idx: number) => (
                    <li key={idx} data-testid={`improvement-${idx}`}> {area}</li>
                  ))}
                </ul>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/ExecutionWebSocketDemo.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { useExecutionWebSocket } from "@/hooks/useExecutionWebSocket";
import { CheckCircle2, Clock, Users, Wifi, WifiOff } from "lucide-react";
import { formatDistanceToNow } from "date-fns";

interface ExecutionWebSocketDemoProps {
  executionInstanceId: string;
}

/**
 * Demonstration component showing real-time WebSocket updates
 * for execution coordination tracking
 */
export default function ExecutionWebSocketDemo({
  executionInstanceId,
}: ExecutionWebSocketDemoProps) {
  const {
    acknowledgments,
    isComplete,
    metrics,
    isConnected,
    error,
  } = useExecutionWebSocket(executionInstanceId);

  return (
    <div className="space-y-4">
      {/* Connection Status */}
      <Card className="border-l-4" style={{ borderLeftColor: isConnected ? '#10b981' : '#ef4444' }}>
        <CardHeader className="pb-3">
          <CardTitle className="text-sm flex items-center gap-2">
            {isConnected ? (
              <>
                <Wifi className="h-4 w-4 text-green-600" />
                WebSocket Connected
              </>
            ) : (
              <>
                <WifiOff className="h-4 w-4 text-red-600" />
                WebSocket Disconnected
              </>
            )}
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="text-xs text-muted-foreground">
            {isConnected ? (
              <span className="text-green-600">
                Receiving live updates for execution {executionInstanceId.substring(0, 8)}...
              </span>
            ) : error ? (
              <span className="text-red-600">Error: {error}</span>
            ) : (
              <span className="text-gray-600">Connecting...</span>
            )}
          </div>
        </CardContent>
      </Card>

      {/* Real-time Acknowledgments */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Users className="h-5 w-5" />
            Live Acknowledgments
            <Badge variant="secondary" className="ml-2">
              {acknowledgments.length} received
            </Badge>
          </CardTitle>
        </CardHeader>
        <CardContent>
          {acknowledgments.length === 0 ? (
            <div className="text-sm text-muted-foreground text-center py-8">
              Waiting for stakeholder acknowledgments...
            </div>
          ) : (
            <div className="space-y-3 max-h-96 overflow-y-auto">
              {acknowledgments.map((ack, index) => (
                <div
                  key={index}
                  className="flex items-start gap-3 p-3 bg-green-50 dark:bg-green-950/20 rounded-lg border border-green-200 dark:border-green-900 animate-in fade-in slide-in-from-top-2 duration-500"
                  data-testid={`ack-${index}`}
                >
                  <CheckCircle2 className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
                  <div className="flex-1 min-w-0">
                    <div className="font-medium text-sm">{ack.stakeholderName}</div>
                    <div className="text-xs text-muted-foreground mt-1">
                      Response time: {ack.responseTimeMinutes.toFixed(1)} min
                    </div>
                    <div className="text-xs text-muted-foreground">
                      {formatDistanceToNow(new Date(ack.timestamp), { addSuffix: true })}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>

      {/* Coordination Complete */}
      {isComplete && metrics && (
        <Card className="border-2 border-green-500 bg-green-50 dark:bg-green-950/20 animate-in zoom-in duration-700">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-green-700 dark:text-green-400">
              <CheckCircle2 className="h-6 w-6" />
               Coordination Complete!
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="text-center">
                <div className="text-2xl font-bold text-green-600">
                  {metrics.coordinationTimeMinutes.toFixed(1)}
                </div>
                <div className="text-xs text-muted-foreground mt-1">Minutes</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-green-600">
                  {metrics.acknowledgedCount}
                </div>
                <div className="text-xs text-muted-foreground mt-1">Acknowledged</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-green-600">
                  {metrics.totalStakeholders}
                </div>
                <div className="text-xs text-muted-foreground mt-1">Total Stakeholders</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-green-600">
                  {metrics.acknowledgmentRate.toFixed(0)}%
                </div>
                <div className="text-xs text-muted-foreground mt-1">Response Rate</div>
              </div>
            </div>
            <div className="mt-4 text-xs text-center text-muted-foreground">
              Completed {formatDistanceToNow(new Date(metrics.timestamp), { addSuffix: true })}
            </div>
          </CardContent>
        </Card>
      )}
    </div>
  );
}


========================================
FILE: client/src/components/ExecutiveWarRoom.tsx
========================================
import { useState, useEffect } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Progress } from '@/components/ui/progress';
import { 
  Command, 
  Shield, 
  AlertTriangle, 
  Users, 
  Clock, 
  Target, 
  TrendingUp, 
  Brain,
  Zap,
  FileText,
  CheckCircle,
  XCircle,
  Plus,
  Send,
  Activity,
  BarChart3,
  Settings
} from 'lucide-react';
import { useToast } from '@/hooks/use-toast';
import { apiRequest } from '@/lib/queryClient';

interface WarRoomSession {
  id: string;
  organizationId: string;
  scenarioId?: string;
  name: string;
  description: string;
  status: 'active' | 'standby' | 'closed';
  priority: 'low' | 'medium' | 'high' | 'critical';
  sessionType: 'crisis' | 'opportunity' | 'strategic_planning' | 'risk_mitigation';
  leadExecutive: string;
  participants: string[];
  startTime: string;
  expectedDuration?: number;
  objectives: string[];
  currentPhase: string;
  nextActions: string[];
  resources: any;
  decisionLog: any[];
  communicationPlan: any;
  escalationProtocol: any;
  createdAt: string;
  lastUpdated: string;
}

interface ExecutiveBriefing {
  id: string;
  organizationId: string;
  executiveId: string;
  briefingType: 'daily' | 'weekly' | 'incident' | 'strategic' | 'board_ready';
  title: string;
  summary: string;
  keyInsights: any[];
  actionItems: any[];
  riskAlerts: any[];
  opportunities: any[];
  metrics: any;
  priority: 'low' | 'medium' | 'high' | 'critical';
  readingTime: number;
  acknowledgedAt?: string;
  createdAt: string;
}

interface StrategicAlert {
  id: string;
  organizationId: string;
  alertType: 'opportunity' | 'threat' | 'anomaly' | 'milestone' | 'regulatory';
  title: string;
  description: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  sourceSystem: string;
  triggerConditions: any;
  recommendedActions: any[];
  impactAssessment: any;
  timeframe: string;
  status: 'new' | 'acknowledged' | 'investigating' | 'resolved';
  assignedTo?: string;
  acknowledgedBy?: string;
  acknowledgedAt?: string;
  createdAt: string;
}

interface BoardReport {
  id: string;
  organizationId: string;
  reportType: 'monthly' | 'quarterly' | 'annual' | 'special';
  title: string;
  executiveSummary: string;
  keyMetrics: any;
  strategicInitiatives: any[];
  riskAssessment: any;
  financialHighlights: any;
  recommendations: any[];
  appendices: any[];
  presentationSlides?: any[];
  status: 'draft' | 'review' | 'approved' | 'presented';
  createdBy: string;
  approvedBy?: string;
  approvedAt?: string;
  presentedAt?: string;
  createdAt: string;
}

export function ExecutiveWarRoom() {
  const [selectedSession, setSelectedSession] = useState<string | null>(null);
  const [newSessionForm, setNewSessionForm] = useState(false);
  const [sessionData, setSessionData] = useState({
    name: '',
    description: '',
    sessionType: 'crisis' as const,
    priority: 'medium' as const,
    leadExecutive: '',
    objectives: ['']
  });
  const { toast } = useToast();
  const queryClient = useQueryClient();

  // Fetch War Room Sessions
  const { data: sessions = [], isLoading: sessionsLoading } = useQuery({
    queryKey: ['/api/strategic/war-room/sessions'],
    queryFn: async () => {
      const response = await fetch('/api/strategic/war-room/sessions');
      if (!response.ok) return [];
      return response.json();
    }
  });

  // Fetch Executive Briefings
  const { data: briefings = [] } = useQuery({
    queryKey: ['/api/strategic/briefings'],
    queryFn: async () => {
      const response = await fetch('/api/strategic/briefings');
      if (!response.ok) return [];
      return response.json();
    }
  });

  // Fetch Strategic Alerts
  const { data: alerts = [] } = useQuery({
    queryKey: ['/api/strategic/alerts'],
    queryFn: async () => {
      const response = await fetch('/api/strategic/alerts');
      if (!response.ok) return [];
      return response.json();
    }
  });

  // Fetch Board Reports
  const { data: reports = [] } = useQuery({
    queryKey: ['/api/strategic/reports'],
    queryFn: async () => {
      const response = await fetch('/api/strategic/reports');
      if (!response.ok) return [];
      return response.json();
    }
  });

  // Create War Room Session
  const createSessionMutation = useMutation({
    mutationFn: async (data: any) => {
      const response = await fetch('/api/strategic/war-room/sessions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (!response.ok) throw new Error('Failed to create session');
      return response.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/strategic/war-room/sessions'] });
      setNewSessionForm(false);
      setSessionData({
        name: '',
        description: '',
        sessionType: 'crisis',
        priority: 'medium',
        leadExecutive: '',
        objectives: ['']
      });
      toast({
        title: 'War Room Session Created',
        description: 'Strategic command center activated successfully.'
      });
    }
  });

  // Acknowledge Alert
  const acknowledgeAlertMutation = useMutation({
    mutationFn: async (alertId: string) => {
      const response = await fetch(`/api/strategic/alerts/${alertId}/acknowledge`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ acknowledgedBy: 'Current User' })
      });
      if (!response.ok) throw new Error('Failed to acknowledge alert');
      return response.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/strategic/alerts'] });
      toast({
        title: 'Alert Acknowledged',
        description: 'Strategic alert has been marked as acknowledged.'
      });
    }
  });

  const handleCreateSession = () => {
    if (!sessionData.name || !sessionData.leadExecutive) {
      toast({
        title: 'Validation Error',
        description: 'Please fill in all required fields.',
        variant: 'destructive'
      });
      return;
    }

    createSessionMutation.mutate({
      organizationId: 'default-org',
      ...sessionData,
      participants: [sessionData.leadExecutive],
      currentPhase: 'initialization',
      nextActions: sessionData.objectives,
      resources: {},
      decisionLog: [],
      communicationPlan: {},
      escalationProtocol: {}
    });
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'critical': return 'bg-red-500';
      case 'high': return 'bg-orange-500';
      case 'medium': return 'bg-yellow-500';
      case 'low': return 'bg-green-500';
      default: return 'bg-gray-500';
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'active': return 'bg-green-500';
      case 'standby': return 'bg-yellow-500';
      case 'closed': return 'bg-gray-500';
      case 'new': return 'bg-blue-500';
      case 'acknowledged': return 'bg-orange-500';
      case 'resolved': return 'bg-green-500';
      default: return 'bg-gray-500';
    }
  };

  return (
    <div className="space-y-6 p-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div className="flex items-center space-x-3">
          <div className="p-2 bg-primary rounded-lg">
            <Command className="h-6 w-6 text-white" />
          </div>
          <div>
            <h1 className="text-3xl font-bold text-gray-900 dark:text-white">Executive War Room</h1>
            <p className="text-gray-600 dark:text-gray-400">Strategic Command & Crisis Coordination Center</p>
          </div>
        </div>
        <Button 
          onClick={() => setNewSessionForm(true)}
          className="bg-primary hover:bg-primary/90"
          data-testid="button-new-session"
        >
          <Plus className="h-4 w-4 mr-2" />
          Activate War Room
        </Button>
      </div>

      {/* Quick Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <Card>
          <CardContent className="p-4">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">Active Sessions</p>
                <p className="text-2xl font-bold text-primary">
                  {sessions.filter((s: WarRoomSession) => s.status === 'active').length}
                </p>
              </div>
              <Shield className="h-8 w-8 text-primary" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-4">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">Critical Alerts</p>
                <p className="text-2xl font-bold text-orange-600">
                  {alerts.filter((a: StrategicAlert) => a.severity === 'critical' && a.status === 'new').length}
                </p>
              </div>
              <AlertTriangle className="h-8 w-8 text-orange-600" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-4">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">Today's Briefings</p>
                <p className="text-2xl font-bold text-blue-600">
                  {briefings.filter((b: ExecutiveBriefing) => 
                    new Date(b.createdAt).toDateString() === new Date().toDateString()
                  ).length}
                </p>
              </div>
              <Brain className="h-8 w-8 text-blue-600" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-4">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">Pending Reports</p>
                <p className="text-2xl font-bold text-green-600">
                  {reports.filter((r: BoardReport) => r.status === 'draft').length}
                </p>
              </div>
              <FileText className="h-8 w-8 text-green-600" />
            </div>
          </CardContent>
        </Card>
      </div>

      <Tabs defaultValue="sessions" className="space-y-4">
        <TabsList className="grid w-full grid-cols-4">
          <TabsTrigger value="sessions" data-testid="tab-sessions">Command Center</TabsTrigger>
          <TabsTrigger value="intelligence" data-testid="tab-intelligence">Zero-Click Intel</TabsTrigger>
          <TabsTrigger value="alerts" data-testid="tab-alerts">Strategic Alerts</TabsTrigger>
          <TabsTrigger value="reports" data-testid="tab-reports">Board Reports</TabsTrigger>
        </TabsList>

        {/* Command Center Tab */}
        <TabsContent value="sessions" className="space-y-4">
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-2 space-y-4">
              <div className="flex justify-between items-center">
                <h3 className="text-lg font-semibold">Active Sessions</h3>
              </div>
              
              {sessionsLoading ? (
                <div className="space-y-4">
                  {[1, 2, 3].map(i => (
                    <Card key={i} className="animate-pulse">
                      <CardContent className="p-4">
                        <div className="h-4 bg-gray-200 rounded mb-2"></div>
                        <div className="h-3 bg-gray-200 rounded"></div>
                      </CardContent>
                    </Card>
                  ))}
                </div>
              ) : sessions.length === 0 ? (
                <Card>
                  <CardContent className="p-8 text-center">
                    <Command className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                    <h3 className="text-lg font-semibold text-gray-600 mb-2">No Active Sessions</h3>
                    <p className="text-gray-500 mb-4">All strategic command centers are in standby mode</p>
                    <Button onClick={() => setNewSessionForm(true)} variant="outline">
                      Activate First Session
                    </Button>
                  </CardContent>
                </Card>
              ) : (
                <div className="space-y-4">
                  {sessions.map((session: WarRoomSession) => (
                    <Card key={session.id} className="cursor-pointer hover:shadow-lg transition-shadow" onClick={() => setSelectedSession(session.id)}>
                      <CardContent className="p-4">
                        <div className="flex items-start justify-between mb-3">
                          <div className="flex-1">
                            <div className="flex items-center space-x-2 mb-2">
                              <h4 className="font-semibold text-lg">{session.name}</h4>
                              <Badge className={`${getPriorityColor(session.priority)} text-white`}>
                                {session.priority.toUpperCase()}
                              </Badge>
                              <Badge className={`${getStatusColor(session.status)} text-white`}>
                                {session.status.toUpperCase()}
                              </Badge>
                            </div>
                            <p className="text-gray-600 dark:text-gray-400 mb-2">{session.description}</p>
                            <div className="flex items-center space-x-4 text-sm text-gray-500">
                              <div className="flex items-center">
                                <Users className="h-4 w-4 mr-1" />
                                Lead: {session.leadExecutive}
                              </div>
                              <div className="flex items-center">
                                <Clock className="h-4 w-4 mr-1" />
                                {new Date(session.startTime).toLocaleString()}
                              </div>
                            </div>
                          </div>
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                          <div>
                            <p className="text-xs text-gray-500 mb-1">Current Phase</p>
                            <p className="font-medium">{session.currentPhase}</p>
                          </div>
                          <div>
                            <p className="text-xs text-gray-500 mb-1">Session Type</p>
                            <p className="font-medium capitalize">{session.sessionType.replace('_', ' ')}</p>
                          </div>
                          <div>
                            <p className="text-xs text-gray-500 mb-1">Participants</p>
                            <p className="font-medium">{session.participants.length} members</p>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                </div>
              )}
            </div>

            <div className="space-y-4">
              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center">
                    <Activity className="h-5 w-5 mr-2" />
                    Real-Time Status
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex justify-between items-center">
                    <span className="text-sm">System Health</span>
                    <Badge className="bg-green-500 text-white">OPERATIONAL</Badge>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-sm">AI Radar</span>
                    <Badge className="bg-blue-500 text-white">SCANNING</Badge>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-sm">Command Ready</span>
                    <Badge className="bg-green-500 text-white">READY</Badge>
                  </div>
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center">
                    <TrendingUp className="h-5 w-5 mr-2" />
                    Performance Metrics
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div>
                    <div className="flex justify-between text-sm mb-1">
                      <span>Response Time</span>
                      <span>85%</span>
                    </div>
                    <Progress value={85} className="h-2" />
                  </div>
                  <div>
                    <div className="flex justify-between text-sm mb-1">
                      <span>Decision Speed</span>
                      <span>92%</span>
                    </div>
                    <Progress value={92} className="h-2" />
                  </div>
                  <div>
                    <div className="flex justify-between text-sm mb-1">
                      <span>Execution Rate</span>
                      <span>78%</span>
                    </div>
                    <Progress value={78} className="h-2" />
                  </div>
                </CardContent>
              </Card>
            </div>
          </div>
        </TabsContent>

        {/* Zero-Click Intelligence Tab */}
        <TabsContent value="intelligence" className="space-y-4">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div className="space-y-4">
              <h3 className="text-lg font-semibold flex items-center">
                <Brain className="h-5 w-5 mr-2" />
                Executive Briefings
              </h3>
              {briefings.length === 0 ? (
                <Card>
                  <CardContent className="p-8 text-center">
                    <Brain className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                    <h3 className="text-lg font-semibold text-gray-600 mb-2">No Intelligence Available</h3>
                    <p className="text-gray-500">AI-powered briefings will appear here automatically</p>
                  </CardContent>
                </Card>
              ) : (
                <div className="space-y-4">
                  {briefings.slice(0, 5).map((briefing: ExecutiveBriefing) => (
                    <Card key={briefing.id}>
                      <CardContent className="p-4">
                        <div className="flex items-start justify-between mb-3">
                          <div className="flex-1">
                            <div className="flex items-center space-x-2 mb-2">
                              <h4 className="font-semibold">{briefing.title}</h4>
                              <Badge className={`${getPriorityColor(briefing.priority)} text-white`}>
                                {briefing.briefingType.toUpperCase()}
                              </Badge>
                              {briefing.acknowledgedAt && (
                                <CheckCircle className="h-4 w-4 text-green-600" />
                              )}
                            </div>
                            <p className="text-gray-600 dark:text-gray-400 text-sm mb-2">{briefing.summary}</p>
                            <div className="flex items-center space-x-4 text-xs text-gray-500">
                              <span>{briefing.readingTime} min read</span>
                              <span>{new Date(briefing.createdAt).toLocaleDateString()}</span>
                            </div>
                          </div>
                        </div>
                        
                        {briefing.keyInsights.length > 0 && (
                          <div className="mt-3">
                            <p className="text-xs text-gray-500 mb-1">Key Insights</p>
                            <div className="flex flex-wrap gap-1">
                              {briefing.keyInsights.slice(0, 3).map((insight: any, idx: number) => (
                                <Badge key={idx} variant="outline" className="text-xs">
                                  {insight.title || `Insight ${idx + 1}`}
                                </Badge>
                              ))}
                            </div>
                          </div>
                        )}
                      </CardContent>
                    </Card>
                  ))}
                </div>
              )}
            </div>

            <div className="space-y-4">
              <h3 className="text-lg font-semibold flex items-center">
                <Zap className="h-5 w-5 mr-2" />
                AI Insights Engine
              </h3>
              <Card>
                <CardHeader>
                  <CardTitle>Proactive Intelligence</CardTitle>
                  <CardDescription>AI-powered strategic analysis and recommendations</CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                    <div className="flex items-center mb-2">
                      <Target className="h-5 w-5 text-blue-600 mr-2" />
                      <span className="font-medium text-blue-900 dark:text-blue-100">Strategic Opportunity</span>
                    </div>
                    <p className="text-sm text-blue-800 dark:text-blue-200">
                      Market analysis indicates 23% growth opportunity in Q2. Recommend accelerating Product Line Alpha expansion.
                    </p>
                  </div>

                  <div className="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg">
                    <div className="flex items-center mb-2">
                      <AlertTriangle className="h-5 w-5 text-orange-600 mr-2" />
                      <span className="font-medium text-orange-900 dark:text-orange-100">Risk Alert</span>
                    </div>
                    <p className="text-sm text-orange-800 dark:text-orange-200">
                      Supply chain volatility detected. Suggest diversifying vendor portfolio within 30 days.
                    </p>
                  </div>

                  <div className="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                    <div className="flex items-center mb-2">
                      <TrendingUp className="h-5 w-5 text-green-600 mr-2" />
                      <span className="font-medium text-green-900 dark:text-green-100">Performance Insight</span>
                    </div>
                    <p className="text-sm text-green-800 dark:text-green-200">
                      Team productivity up 18% following strategic process optimization initiatives.
                    </p>
                  </div>
                </CardContent>
              </Card>
            </div>
          </div>
        </TabsContent>

        {/* Strategic Alerts Tab */}
        <TabsContent value="alerts" className="space-y-4">
          <div className="flex justify-between items-center">
            <h3 className="text-lg font-semibold flex items-center">
              <AlertTriangle className="h-5 w-5 mr-2" />
              Strategic Alerts
            </h3>
            <Badge variant="outline">
              {alerts.filter((a: StrategicAlert) => a.status === 'new').length} New
            </Badge>
          </div>

          {alerts.length === 0 ? (
            <Card>
              <CardContent className="p-8 text-center">
                <AlertTriangle className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                <h3 className="text-lg font-semibold text-gray-600 mb-2">No Active Alerts</h3>
                <p className="text-gray-500">Strategic monitoring systems are operating normally</p>
              </CardContent>
            </Card>
          ) : (
            <div className="space-y-4">
              {alerts.map((alert: StrategicAlert) => (
                <Card key={alert.id}>
                  <CardContent className="p-4">
                    <div className="flex items-start justify-between">
                      <div className="flex-1">
                        <div className="flex items-center space-x-2 mb-2">
                          <h4 className="font-semibold">{alert.title}</h4>
                          <Badge className={`${getPriorityColor(alert.severity)} text-white`}>
                            {alert.severity.toUpperCase()}
                          </Badge>
                          <Badge className={`${getStatusColor(alert.status)} text-white`}>
                            {alert.status.replace('_', ' ').toUpperCase()}
                          </Badge>
                          <Badge variant="outline">
                            {alert.alertType.replace('_', ' ').toUpperCase()}
                          </Badge>
                        </div>
                        <p className="text-gray-600 dark:text-gray-400 mb-3">{alert.description}</p>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                          <div>
                            <p className="text-xs text-gray-500 mb-1">Source System</p>
                            <p className="font-medium">{alert.sourceSystem}</p>
                          </div>
                          <div>
                            <p className="text-xs text-gray-500 mb-1">Timeframe</p>
                            <p className="font-medium">{alert.timeframe}</p>
                          </div>
                        </div>

                        {alert.recommendedActions.length > 0 && (
                          <div className="mt-3">
                            <p className="text-xs text-gray-500 mb-2">Recommended Actions</p>
                            <div className="space-y-1">
                              {alert.recommendedActions.slice(0, 2).map((action: any, idx: number) => (
                                <div key={idx} className="flex items-center text-sm">
                                  <Target className="h-3 w-3 mr-2 text-gray-400" />
                                  {action.description || action}
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                      
                      <div className="flex flex-col space-y-2 ml-4">
                        {alert.status === 'new' && (
                          <Button
                            size="sm"
                            onClick={() => acknowledgeAlertMutation.mutate(alert.id)}
                            disabled={acknowledgeAlertMutation.isPending}
                          >
                            <CheckCircle className="h-4 w-4 mr-1" />
                            Acknowledge
                          </Button>
                        )}
                        <Button size="sm" variant="outline">
                          <Settings className="h-4 w-4 mr-1" />
                          Manage
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          )}
        </TabsContent>

        {/* Board Reports Tab */}
        <TabsContent value="reports" className="space-y-4">
          <div className="flex justify-between items-center">
            <h3 className="text-lg font-semibold flex items-center">
              <BarChart3 className="h-5 w-5 mr-2" />
              Board-Ready Reports
            </h3>
            <Button variant="outline">
              <Plus className="h-4 w-4 mr-2" />
              Generate Report
            </Button>
          </div>

          {reports.length === 0 ? (
            <Card>
              <CardContent className="p-8 text-center">
                <FileText className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                <h3 className="text-lg font-semibold text-gray-600 mb-2">No Reports Available</h3>
                <p className="text-gray-500">Board-ready reports will be generated automatically</p>
              </CardContent>
            </Card>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {reports.map((report: BoardReport) => (
                <Card key={report.id}>
                  <CardContent className="p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex-1">
                        <div className="flex items-center space-x-2 mb-2">
                          <h4 className="font-semibold">{report.title}</h4>
                          <Badge variant="outline">
                            {report.reportType.toUpperCase()}
                          </Badge>
                        </div>
                        <p className="text-gray-600 dark:text-gray-400 text-sm mb-3">
                          {report.executiveSummary}
                        </p>
                        
                        <div className="space-y-2">
                          <div className="flex justify-between text-xs">
                            <span className="text-gray-500">Status:</span>
                            <Badge className={`${getStatusColor(report.status)} text-white text-xs`}>
                              {report.status.toUpperCase()}
                            </Badge>
                          </div>
                          <div className="flex justify-between text-xs">
                            <span className="text-gray-500">Created by:</span>
                            <span>{report.createdBy}</span>
                          </div>
                          {report.approvedBy && (
                            <div className="flex justify-between text-xs">
                              <span className="text-gray-500">Approved by:</span>
                              <span>{report.approvedBy}</span>
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                    
                    <div className="flex space-x-2">
                      <Button size="sm" variant="outline" className="flex-1">
                        <FileText className="h-4 w-4 mr-1" />
                        View
                      </Button>
                      {report.status === 'draft' && (
                        <Button size="sm" className="flex-1">
                          <CheckCircle className="h-4 w-4 mr-1" />
                          Approve
                        </Button>
                      )}
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          )}
        </TabsContent>
      </Tabs>

      {/* New Session Modal */}
      {newSessionForm && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <Card className="w-full max-w-md">
            <CardHeader>
              <CardTitle>Activate War Room Session</CardTitle>
              <CardDescription>Deploy strategic command center for crisis or opportunity management</CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-1">Session Name *</label>
                <Input
                  value={sessionData.name}
                  onChange={(e) => setSessionData({...sessionData, name: e.target.value})}
                  placeholder="e.g., Q2 Market Disruption Response"
                  data-testid="input-session-name"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-1">Description</label>
                <Textarea
                  value={sessionData.description}
                  onChange={(e) => setSessionData({...sessionData, description: e.target.value})}
                  placeholder="Brief description of the strategic situation..."
                  rows={3}
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium mb-1">Session Type</label>
                  <Select
                    value={sessionData.sessionType}
                    onValueChange={(value: any) => setSessionData({...sessionData, sessionType: value})}
                  >
                    <SelectTrigger>
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="crisis">Crisis Response</SelectItem>
                      <SelectItem value="opportunity">Strategic Opportunity</SelectItem>
                      <SelectItem value="strategic_planning">Strategic Planning</SelectItem>
                      <SelectItem value="risk_mitigation">Risk Mitigation</SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                <div>
                  <label className="block text-sm font-medium mb-1">Priority Level</label>
                  <Select
                    value={sessionData.priority}
                    onValueChange={(value: any) => setSessionData({...sessionData, priority: value})}
                  >
                    <SelectTrigger>
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="low">Low</SelectItem>
                      <SelectItem value="medium">Medium</SelectItem>
                      <SelectItem value="high">High</SelectItem>
                      <SelectItem value="critical">Critical</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>

              <div>
                <label className="block text-sm font-medium mb-1">Lead Executive *</label>
                <Input
                  value={sessionData.leadExecutive}
                  onChange={(e) => setSessionData({...sessionData, leadExecutive: e.target.value})}
                  placeholder="Executive leading this session"
                  data-testid="input-lead-executive"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-1">Primary Objective</label>
                <Input
                  value={sessionData.objectives[0]}
                  onChange={(e) => setSessionData({...sessionData, objectives: [e.target.value]})}
                  placeholder="Main strategic objective"
                />
              </div>
            </CardContent>
            <div className="p-6 pt-0 flex space-x-3">
              <Button
                variant="outline"
                onClick={() => setNewSessionForm(false)}
                className="flex-1"
                data-testid="button-cancel-session"
              >
                Cancel
              </Button>
              <Button
                onClick={handleCreateSession}
                disabled={createSessionMutation.isPending}
                className="flex-1 bg-red-600 hover:bg-red-700"
                data-testid="button-activate-session"
              >
                {createSessionMutation.isPending ? 'Activating...' : 'Activate Session'}
              </Button>
            </div>
          </Card>
        </div>
      )}
    </div>
  );
}

========================================
FILE: client/src/components/FutureReadinessWidget.tsx
========================================
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Brain, TrendingUp, ArrowRight, Activity, Zap, Target, Eye, Repeat } from 'lucide-react';
import { Link } from 'wouter';

interface ReadinessMetric {
  id: string;
  organizationId: string;
  measurementDate: string;
  overallScore: number;
  foresightScore: number;
  velocityScore: number;
  agilityScore: number;
  learningScore: number;
  adaptabilityScore: number;
  activeScenarios: number;
  weakSignalsDetected: number;
  playbooksReady: number;
  playbooksTotal: number;
  trend: string;
}

interface WeakSignal {
  id: string;
  signalType: string;
  confidence: number;
  impact: string;
  status: string;
}

export default function FutureReadinessWidget({ organizationId }: { organizationId: string }) {
  const { data: readinessData } = useQuery<ReadinessMetric>({
    queryKey: ['/api/dynamic-strategy/readiness', organizationId],
    refetchInterval: 30000,
  });

  const { data: weakSignals = [] } = useQuery<WeakSignal[]>({
    queryKey: ['/api/dynamic-strategy/weak-signals', organizationId],
    refetchInterval: 30000,
  });

  const score = readinessData?.overallScore || 84.4;
  const trend = readinessData?.trend || 'up';
  const activeSignals = weakSignals.filter(s => s.status === 'active').length;

  const capabilities = [
    {
      label: 'FORESIGHT',
      value: readinessData?.foresightScore || 92,
      icon: Eye,
      color: 'from-blue-500 to-blue-600'
    },
    {
      label: 'VELOCITY',
      value: readinessData?.velocityScore || 88,
      icon: Zap,
      color: 'from-purple-500 to-purple-600'
    },
    {
      label: 'AGILITY',
      value: readinessData?.agilityScore || 85,
      icon: Activity,
      color: 'from-green-500 to-green-600'
    },
    {
      label: 'LEARNING',
      value: readinessData?.learningScore || 81,
      icon: Brain,
      color: 'from-orange-500 to-orange-600'
    },
    {
      label: 'ADAPTABILITY',
      value: readinessData?.adaptabilityScore || 76,
      icon: Repeat,
      color: 'from-pink-500 to-pink-600'
    }
  ];

  return (
    <Card className="relative overflow-hidden border-2 bg-gradient-to-br from-blue-50 via-purple-50 to-blue-50 dark:from-blue-950/30 dark:via-purple-950/30 dark:to-blue-950/30" data-testid="widget-future-readiness">
      {/* Gradient Border Effect */}
      <div className="absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 to-blue-500 opacity-20 blur-sm"></div>
      
      <CardContent className="relative pt-8 pb-6 px-6">
        {/* Header */}
        <div className="flex items-center justify-between mb-6">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center shadow-lg">
              <Brain className="h-6 w-6 text-white" />
            </div>
            <div>
              <div className="flex items-center gap-2">
                <h3 className="text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent">
                  Future Readiness Index
                </h3>
                <Badge className="bg-blue-600 text-white text-xs font-semibold">NEW</Badge>
              </div>
              <p className="text-xs text-muted-foreground mt-0.5">
                Real-time strategic preparedness  AI intelligence  Predictive analysis
              </p>
            </div>
          </div>
          <Link to="/future-readiness">
            <Button size="sm" variant="ghost" className="gap-1 text-blue-600 hover:text-blue-700 dark:text-blue-400" data-testid="button-view-full-dashboard">
              Full Dashboard <ArrowRight className="h-3 w-3" />
            </Button>
          </Link>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Readiness Score - Large Display */}
          <div className="lg:col-span-1 flex flex-col items-center justify-center bg-white/50 dark:bg-slate-900/50 rounded-xl p-6 border border-blue-200/50 dark:border-blue-800/50">
            <div className="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2">
              Overall Readiness
            </div>
            <div className="relative">
              <div className="text-6xl font-bold bg-gradient-to-br from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent" data-testid="text-readiness-score">
                {score.toFixed(1)}%
              </div>
              {trend === 'up' && (
                <div className="absolute -top-2 -right-8 flex items-center gap-1 text-green-600 dark:text-green-400">
                  <TrendingUp className="h-4 w-4" />
                  <span className="text-sm font-semibold">+2.3</span>
                </div>
              )}
            </div>
            <div className="mt-3 text-xs text-center text-muted-foreground">
              Target: 84.4%  Industry Avg: 62%
            </div>
          </div>

          {/* Capability Metrics - 5 Dimensions */}
          <div className="lg:col-span-2 space-y-3">
            {capabilities.map((cap) => {
              const Icon = cap.icon;
              return (
                <div key={cap.label} className="flex items-center gap-3" data-testid={`metric-${cap.label.toLowerCase()}`}>
                  <div className={`w-8 h-8 rounded-lg bg-gradient-to-br ${cap.color} flex items-center justify-center flex-shrink-0`}>
                    <Icon className="h-4 w-4 text-white" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center justify-between mb-1">
                      <span className="text-xs font-medium text-muted-foreground uppercase tracking-wide">
                        {cap.label}
                      </span>
                      <span className={`text-sm font-bold bg-gradient-to-r ${cap.color} bg-clip-text text-transparent`}>
                        {cap.value}%
                      </span>
                    </div>
                    <div className="h-2 bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden">
                      <div 
                        className={`h-full bg-gradient-to-r ${cap.color} rounded-full transition-all duration-1000 ease-out`}
                        style={{ width: `${cap.value}%` }}
                      />
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>

        {/* Quick Stats Row */}
        <div className="grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-blue-200/50 dark:border-blue-800/50">
          <div className="text-center">
            <div className="text-2xl font-bold text-blue-600 dark:text-blue-400" data-testid="text-active-scenarios">
              {readinessData?.activeScenarios || 3}
            </div>
            <div className="text-xs text-muted-foreground mt-1">Active Scenarios</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold text-purple-600 dark:text-purple-400" data-testid="text-weak-signals">
              {activeSignals}
            </div>
            <div className="text-xs text-muted-foreground mt-1">Weak Signals Detected</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold text-green-600 dark:text-green-400" data-testid="text-playbooks-ready">
              {readinessData?.playbooksReady || 166}/{readinessData?.playbooksTotal || 166}
            </div>
            <div className="text-xs text-muted-foreground mt-1">Playbooks Ready</div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/GlobalPhaseIndicator.tsx
========================================
import { Target, Radio, Zap, BookOpen } from 'lucide-react';
import { useLocation } from 'wouter';

interface PhaseIndicatorProps {
  scores?: {
    identify: number;
    detect: number;
    execute: number;
    advance: number;
  };
  compact?: boolean;
}

export default function GlobalPhaseIndicator({ 
  scores = { identify: 0, detect: 0, execute: 0, advance: 0 },
  compact = false 
}: PhaseIndicatorProps) {
  const [, setLocation] = useLocation();
  
  const phases = [
    { 
      id: 'identify', 
      label: 'IDENTIFY', 
      icon: Target, 
      color: 'text-violet-400', 
      bgColor: 'bg-violet-500',
      score: scores.identify,
      path: '/playbook-library'
    },
    { 
      id: 'detect', 
      label: 'DETECT', 
      icon: Radio, 
      color: 'text-blue-400', 
      bgColor: 'bg-blue-500',
      score: scores.detect,
      path: '/foresight-radar'
    },
    { 
      id: 'execute', 
      label: 'EXECUTE', 
      icon: Zap, 
      color: 'text-emerald-400', 
      bgColor: 'bg-emerald-500',
      score: scores.execute,
      path: '/command-center'
    },
    { 
      id: 'advance', 
      label: 'ADVANCE', 
      icon: BookOpen, 
      color: 'text-amber-400', 
      bgColor: 'bg-amber-500',
      score: scores.advance,
      path: '/executive-dashboard'
    },
  ];

  if (compact) {
    return (
      <div className="flex items-center gap-1 text-xs" data-testid="phase-indicator-compact">
        {phases.map((phase, index) => {
          const Icon = phase.icon;
          return (
            <div key={phase.id} className="flex items-center">
              <button
                onClick={() => setLocation(phase.path)}
                className={`flex items-center gap-1 px-2 py-1 rounded hover:bg-slate-800 transition-colors ${phase.color}`}
                title={`${phase.label}: ${phase.score}%`}
                data-testid={`phase-compact-${phase.id}`}
              >
                <Icon className="h-3 w-3" />
                <span className="hidden sm:inline">{phase.score}%</span>
              </button>
              {index < phases.length - 1 && (
                <span className="text-slate-600 mx-1"></span>
              )}
            </div>
          );
        })}
      </div>
    );
  }

  return (
    <div className="bg-slate-900/50 border border-slate-800 rounded-lg p-4" data-testid="phase-indicator-full">
      <div className="flex items-center justify-between mb-3">
        <span className="text-sm font-medium text-slate-400">IDEA Framework Readiness</span>
        <span className="text-sm text-slate-500">
          Overall: {Math.round((scores.identify + scores.detect + scores.execute + scores.advance) / 4)}%
        </span>
      </div>
      <div className="flex items-center gap-2">
        {phases.map((phase, index) => {
          const Icon = phase.icon;
          return (
            <div key={phase.id} className="flex items-center flex-1">
              <button
                onClick={() => setLocation(phase.path)}
                className="flex-1 group"
                data-testid={`phase-full-${phase.id}`}
              >
                <div className="flex items-center gap-2 mb-1">
                  <Icon className={`h-4 w-4 ${phase.color}`} />
                  <span className={`text-xs font-medium ${phase.color}`}>{phase.label}</span>
                </div>
                <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div 
                    className={`h-full ${phase.bgColor} transition-all`}
                    style={{ width: `${phase.score}%` }}
                  />
                </div>
                <div className="text-xs text-slate-500 mt-1">{phase.score}%</div>
              </button>
              {index < phases.length - 1 && (
                <div className="text-slate-700 mx-2"></div>
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
}


========================================
FILE: client/src/components/Header.tsx
========================================
import { useAuth } from "@/hooks/useAuth";
import { Button } from "@/components/ui/button";

interface HeaderProps {
  isConnected: boolean;
}

export default function Header({ isConnected }: HeaderProps) {
  const { user } = useAuth();

  return (
    <header className="bg-card border-b border-border px-6 py-4">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl font-bold text-foreground">Dashboard</h2>
          <p className="text-muted-foreground">Strategic execution metrics and real-time monitoring</p>
        </div>
        <div className="flex items-center space-x-4">
          {/* Real-time Status Indicator */}
          <div className="flex items-center space-x-2">
            <div className={`w-2 h-2 rounded-full ${isConnected ? 'bg-green-500 animate-pulse' : 'bg-red-500'}`} data-testid="status-indicator"></div>
            <span className="text-sm text-muted-foreground" data-testid="text-connection-status">
              {isConnected ? 'Live Updates' : 'Disconnected'}
            </span>
          </div>
          
          {/* Notifications */}
          <Button
            variant="ghost"
            size="sm"
            className="relative p-2 text-muted-foreground hover:text-foreground"
            data-testid="button-notifications"
          >
            <i className="fas fa-bell w-5 h-5"></i>
            <span className="absolute -top-1 -right-1 w-3 h-3 bg-destructive rounded-full text-xs text-destructive-foreground flex items-center justify-center">
              3
            </span>
          </Button>
          
          {/* User Menu */}
          <Button
            variant="ghost"
            className="flex items-center space-x-2 px-3 py-2 rounded-md hover:bg-accent"
            data-testid="button-user-menu"
          >
            <div className="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
              <span className="text-sm font-medium text-primary-foreground" data-testid="text-header-user-initials">
                {user?.initials || 'U'}
              </span>
            </div>
            <i className="fas fa-chevron-down text-muted-foreground w-3"></i>
          </Button>
        </div>
      </div>
    </header>
  );
}


========================================
FILE: client/src/components/InnovationPipelinePanel.tsx
========================================
import { useState, useEffect } from "react";
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Rocket, Lightbulb, Zap, CheckCircle, Clock, TrendingUp } from "lucide-react";

interface Innovation {
  id: string;
  title: string;
  description: string;
  category: string;
  stage: string;
  potential: string;
  createdAt: string;
  resources?: any;
  timeline?: any;
}

export default function InnovationPipelinePanel() {
  const [organizationId, setOrganizationId] = useState<string | null>(null);

  const { data: organizations } = useQuery({
    queryKey: ["/api/organizations"],
    enabled: true
  });

  useEffect(() => {
    if (organizations && Array.isArray(organizations) && organizations.length > 0) {
      setOrganizationId(organizations[0].id);
    }
  }, [organizations]);

  const { data: innovations, isLoading } = useQuery({
    queryKey: [`/api/nova-innovations/${organizationId}`],
    enabled: !!organizationId
  });

  const getStageIcon = (stage: string) => {
    switch (stage.toLowerCase()) {
      case 'ideation': return <Lightbulb className="h-4 w-4" />;
      case 'prototyping': return <Zap className="h-4 w-4" />;
      case 'testing': return <Clock className="h-4 w-4" />;
      case 'scaling': return <TrendingUp className="h-4 w-4" />;
      case 'deployed': return <CheckCircle className="h-4 w-4" />;
      default: return <Rocket className="h-4 w-4" />;
    }
  };

  const getStageColor = (stage: string) => {
    switch (stage.toLowerCase()) {
      case 'ideation': return "bg-blue-50 text-blue-600";
      case 'prototyping': return "bg-yellow-50 text-yellow-600";
      case 'testing': return "bg-purple-50 text-purple-600";
      case 'scaling': return "bg-green-50 text-green-600";
      case 'deployed': return "bg-emerald-50 text-emerald-600";
      default: return "bg-gray-50 text-gray-600";
    }
  };

  const getPotentialColor = (potential: string) => {
    switch (potential.toLowerCase()) {
      case 'breakthrough': return "bg-red-50 text-red-700 border-red-200";
      case 'incremental': return "bg-yellow-50 text-yellow-700 border-yellow-200";
      case 'sustaining': return "bg-blue-50 text-blue-700 border-blue-200";
      default: return "bg-gray-50 text-gray-700 border-gray-200";
    }
  };

  const getStageProgress = (stage: string) => {
    switch (stage.toLowerCase()) {
      case 'ideation': return 20;
      case 'prototyping': return 40;
      case 'testing': return 60;
      case 'scaling': return 80;
      case 'deployed': return 100;
      default: return 0;
    }
  };

  if (isLoading) {
    return (
      <Card data-testid="innovation-pipeline-panel" className="h-80">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Rocket className="h-5 w-5" />
            Innovation Pipeline
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {[1, 2, 3].map(i => (
              <div key={i} className="animate-pulse">
                <div className="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div className="h-16 bg-gray-200 rounded w-full"></div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    );
  }

  const stageDistribution = innovations && Array.isArray(innovations) ? {
    ideation: innovations.filter((i: Innovation) => i.stage === 'ideation').length,
    prototyping: innovations.filter((i: Innovation) => i.stage === 'prototyping').length,
    testing: innovations.filter((i: Innovation) => i.stage === 'testing').length,
    scaling: innovations.filter((i: Innovation) => i.stage === 'scaling').length,
    deployed: innovations.filter((i: Innovation) => i.stage === 'deployed').length
  } : null;

  return (
    <Card data-testid="innovation-pipeline-panel" className="h-80">
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Rocket className="h-5 w-5" />
          Innovation Pipeline
        </CardTitle>
        <CardDescription>
          Innovation initiatives and development progress
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        {innovations && Array.isArray(innovations) && innovations.length > 0 ? (
          <div className="space-y-3 max-h-48 overflow-y-auto">
            {innovations.slice(0, 3).map((innovation: Innovation) => {
              const progress = getStageProgress(innovation.stage);
              
              return (
                <div 
                  key={innovation.id} 
                  className="p-3 rounded-lg border bg-card"
                  data-testid={`innovation-${innovation.title.replace(/\s+/g, '-').toLowerCase()}`}
                >
                  <div className="flex items-start justify-between mb-2">
                    <div className="flex items-center gap-2">
                      <div className={`p-1.5 rounded ${getStageColor(innovation.stage)}`}>
                        {getStageIcon(innovation.stage)}
                      </div>
                      <span className="font-medium text-sm" data-testid={`innovation-title-${innovation.id}`}>
                        {innovation.title}
                      </span>
                    </div>
                    <Badge 
                      variant="outline" 
                      className={`text-xs ${getPotentialColor(innovation.potential)}`}
                      data-testid={`potential-${innovation.id}`}
                    >
                      {innovation.potential}
                    </Badge>
                  </div>
                  <p className="text-xs text-muted-foreground mb-2" data-testid={`innovation-description-${innovation.id}`}>
                    {innovation.description && innovation.description.length > 100 
                      ? `${innovation.description.substring(0, 100)}...` 
                      : innovation.description
                    }
                  </p>
                  <div className="space-y-2">
                    <div className="flex items-center justify-between text-xs">
                      <span className="text-muted-foreground">Progress</span>
                      <Badge variant="secondary" className={getStageColor(innovation.stage)} data-testid={`stage-${innovation.id}`}>
                        {innovation.stage}
                      </Badge>
                    </div>
                    <Progress value={progress} className="h-1.5" />
                  </div>
                </div>
              );
            })}
          </div>
        ) : (
          <div className="text-center py-8">
            <Rocket className="h-12 w-12 mx-auto text-muted-foreground mb-4" />
            <p className="text-muted-foreground">No innovations in pipeline</p>
            <p className="text-sm text-muted-foreground mt-1">
              Innovation projects will appear as they are created
            </p>
          </div>
        )}
        
        {stageDistribution && (
          <div className="pt-4 border-t">
            <div className="flex items-center justify-between text-sm">
              <span className="text-muted-foreground">Pipeline Summary</span>
              <div className="flex gap-2" data-testid="pipeline-summary">
                <Badge variant="secondary" className="text-xs">
                  {Object.values(stageDistribution).reduce((a, b) => a + b, 0)} Total
                </Badge>
                <Badge variant="outline" className="text-xs bg-green-50 text-green-700">
                  {stageDistribution.deployed + stageDistribution.scaling} Active
                </Badge>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}

========================================
FILE: client/src/components/IntelligenceReportsPanel.tsx
========================================
import { useState, useEffect } from "react";
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { FileText, Brain, TrendingUp, AlertCircle, CheckCircle, Calendar } from "lucide-react";

interface IntelligenceReport {
  id: string;
  reportType: string;
  title: string;
  executiveSummary: string;
  confidence: string;
  generatedAt: string;
  findings?: any;
  recommendations?: any;
}

export default function IntelligenceReportsPanel() {
  const [organizationId, setOrganizationId] = useState<string | null>(null);

  const { data: organizations } = useQuery({
    queryKey: ["/api/organizations"],
    enabled: true
  });

  useEffect(() => {
    if (organizations && Array.isArray(organizations) && organizations.length > 0) {
      setOrganizationId(organizations[0].id);
    }
  }, [organizations]);

  const { data: report, isLoading } = useQuery({
    queryKey: [`/api/intelligence-reports/${organizationId}/latest`],
    enabled: !!organizationId
  });

  const getReportTypeIcon = (type: string) => {
    switch (type.toLowerCase()) {
      case 'strategic analysis': return <Brain className="h-4 w-4" />;
      case 'market intelligence': return <TrendingUp className="h-4 w-4" />;
      case 'risk assessment': return <AlertCircle className="h-4 w-4" />;
      case 'performance review': return <CheckCircle className="h-4 w-4" />;
      default: return <FileText className="h-4 w-4" />;
    }
  };

  const getReportTypeColor = (type: string) => {
    switch (type.toLowerCase()) {
      case 'strategic analysis': return "bg-blue-50 text-blue-700 border-blue-200";
      case 'market intelligence': return "bg-green-50 text-green-700 border-green-200";
      case 'risk assessment': return "bg-red-50 text-red-700 border-red-200";
      case 'performance review': return "bg-purple-50 text-purple-700 border-purple-200";
      default: return "bg-gray-50 text-gray-700 border-gray-200";
    }
  };

  const getConfidenceColor = (confidence: number) => {
    if (confidence >= 0.8) return "bg-green-100 text-green-800";
    if (confidence >= 0.6) return "bg-yellow-100 text-yellow-800";
    return "bg-red-100 text-red-800";
  };

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  if (isLoading) {
    return (
      <Card data-testid="intelligence-reports-panel" className="h-80">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <FileText className="h-5 w-5" />
            Intelligence Reports
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="animate-pulse">
            <div className="h-4 bg-gray-200 rounded w-3/4 mb-4"></div>
            <div className="h-20 bg-gray-200 rounded w-full mb-4"></div>
            <div className="h-8 bg-gray-200 rounded w-1/2"></div>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card data-testid="intelligence-reports-panel" className="h-80">
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <FileText className="h-5 w-5" />
          Intelligence Reports
        </CardTitle>
        <CardDescription>
          Executive intelligence and strategic recommendations
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        {report ? (
          <div className="space-y-4">
            <div className={`p-3 rounded-lg border ${getReportTypeColor(report.reportType)}`}>
              <div className="flex items-start justify-between mb-3">
                <div className="flex items-center gap-2">
                  {getReportTypeIcon(report.reportType)}
                  <span className="font-medium text-sm" data-testid="report-title">
                    {report.title}
                  </span>
                </div>
                <Badge 
                  variant="secondary" 
                  className={`text-xs ${getConfidenceColor(parseFloat(report.confidence))}`}
                  data-testid="report-confidence"
                >
                  {(parseFloat(report.confidence) * 100).toFixed(0)}%
                </Badge>
              </div>
              
              <div className="mb-3">
                <Badge variant="outline" className="text-xs mb-2" data-testid="report-type">
                  {report.reportType}
                </Badge>
                <p className="text-xs text-muted-foreground leading-relaxed" data-testid="executive-summary">
                  {report.executiveSummary && report.executiveSummary.length > 200 
                    ? `${report.executiveSummary.substring(0, 200)}...` 
                    : report.executiveSummary
                  }
                </p>
              </div>

              <div className="flex items-center justify-between text-xs text-muted-foreground">
                <div className="flex items-center gap-1">
                  <Calendar className="h-3 w-3" />
                  <span data-testid="report-date">
                    {formatDate(report.generatedAt)}
                  </span>
                </div>
              </div>
            </div>

            <div className="pt-2">
              <Button variant="outline" size="sm" className="w-full" data-testid="view-full-report">
                View Full Report
              </Button>
            </div>
          </div>
        ) : (
          <div className="text-center py-8">
            <FileText className="h-12 w-12 mx-auto text-muted-foreground mb-4" />
            <p className="text-muted-foreground">No intelligence reports available</p>
            <p className="text-sm text-muted-foreground mt-1">
              Executive reports will be generated automatically
            </p>
            <Button variant="outline" size="sm" className="mt-4" data-testid="generate-report">
              Generate Report
            </Button>
          </div>
        )}
      </CardContent>
    </Card>
  );
}

========================================
FILE: client/src/components/LiveActivityFeed.tsx
========================================
import { useQuery } from '@tanstack/react-query';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Activity, AlertTriangle, CheckCircle, Info, Zap, Brain, Eye, TrendingUp } from 'lucide-react';
import { formatDistanceToNow } from 'date-fns';

interface ActivityEvent {
  id: string;
  eventType: string;
  title: string;
  description: string | null;
  severity: string;
  createdAt: string;
  relatedEntityType: string | null;
}

const eventIcons: Record<string, any> = {
  'weak_signal_detected': Eye,
  'playbook_activated': Zap,
  'oracle_pattern_detected': Brain,
  'readiness_score_updated': TrendingUp,
  'scenario_triggered': AlertTriangle,
  'execution_completed': CheckCircle,
  'default': Activity
};

const severityColors: Record<string, { badge: string; border: string }> = {
  'critical': { badge: 'bg-red-500 text-white', border: 'border-red-500/20' },
  'high': { badge: 'bg-orange-500 text-white', border: 'border-orange-500/20' },
  'medium': { badge: 'bg-yellow-500 text-white', border: 'border-yellow-500/20' },
  'low': { badge: 'bg-blue-500 text-white', border: 'border-blue-500/20' },
  'info': { badge: 'bg-slate-500 text-white', border: 'border-slate-500/20' }
};

export default function LiveActivityFeed({ organizationId }: { organizationId: string }) {
  const { data: events = [] } = useQuery<ActivityEvent[]>({
    queryKey: ['/api/dynamic-strategy/activity-feed', organizationId],
    refetchInterval: 15000,
  });

  const recentEvents = events.slice(0, 10);

  return (
    <Card data-testid="card-live-activity-feed">
      <CardHeader className="pb-3">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <Activity className="h-5 w-5 text-blue-600 dark:text-blue-400" />
            <CardTitle className="text-lg">Live Activity Feed</CardTitle>
          </div>
          <Badge variant="outline" className="text-xs">
            <div className="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse" />
            Live
          </Badge>
        </div>
        <p className="text-xs text-muted-foreground mt-1">
          Real-time system intelligence and events
        </p>
      </CardHeader>
      <CardContent>
        <ScrollArea className="h-[400px] pr-4">
          {recentEvents.length === 0 ? (
            <div className="flex flex-col items-center justify-center h-full text-center py-12">
              <Activity className="h-12 w-12 text-muted-foreground/30 mb-3" />
              <p className="text-sm text-muted-foreground">No recent activity</p>
              <p className="text-xs text-muted-foreground mt-1">Events will appear here in real-time</p>
            </div>
          ) : (
            <div className="space-y-3">
              {recentEvents.map((event, index) => {
                const Icon = eventIcons[event.eventType] || eventIcons.default;
                const colors = severityColors[event.severity] || severityColors.info;
                
                return (
                  <div 
                    key={event.id}
                    className={`flex gap-3 p-3 rounded-lg border ${colors.border} bg-slate-50/50 dark:bg-slate-900/50 transition-all hover:shadow-sm`}
                    style={{ 
                      animation: index === 0 ? 'slideIn 0.5s ease-out' : 'none' 
                    }}
                    data-testid={`activity-event-${event.id}`}
                  >
                    <div className="flex-shrink-0">
                      <div className={`w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center`}>
                        <Icon className="h-4 w-4 text-white" />
                      </div>
                    </div>
                    <div className="flex-1 min-w-0">
                      <div className="flex items-start justify-between gap-2 mb-1">
                        <h4 className="text-sm font-semibold text-foreground leading-tight">
                          {event.title}
                        </h4>
                        <Badge className={`${colors.badge} text-xs flex-shrink-0`}>
                          {event.severity.toUpperCase()}
                        </Badge>
                      </div>
                      {event.description && (
                        <p className="text-xs text-muted-foreground mb-2 line-clamp-2">
                          {event.description}
                        </p>
                      )}
                      <div className="flex items-center gap-3 text-xs text-muted-foreground">
                        <span>
                          {formatDistanceToNow(new Date(event.createdAt), { addSuffix: true })}
                        </span>
                        {event.relatedEntityType && (
                          <>
                            <span></span>
                            <span className="capitalize">{event.relatedEntityType}</span>
                          </>
                        )}
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          )}
        </ScrollArea>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/MetricsCards.tsx
========================================
import { useQuery } from "@tanstack/react-query";
import { api, type Metrics } from "@/lib/api";
import { Card, CardContent } from "@/components/ui/card";
import { Target, CheckSquare, Users, TrendingUp, Activity, Zap } from "lucide-react";

export default function MetricsCards() {
  const { data: metrics, isLoading } = useQuery<Metrics>({
    queryKey: ["/api/dashboard/metrics"],
    queryFn: () => api.getDashboardMetrics(),
  });

  if (isLoading) {
    return (
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {[...Array(4)].map((_, i) => (
          <Card key={i} className="animate-pulse">
            <CardContent className="p-6">
              <div className="h-20 bg-muted rounded"></div>
            </CardContent>
          </Card>
        ))}
      </div>
    );
  }

  if (!metrics) {
    return (
      <div className="text-center text-muted-foreground">
        Unable to load metrics
      </div>
    );
  }

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <Card className="hover:shadow-lg transition-all duration-300 border-l-4 border-l-blue-500">
        <CardContent className="p-6">
          <div className="flex items-center justify-between">
            <div>
              <div className="flex items-center gap-2 mb-2">
                <Target className="h-4 w-4 text-blue-600" />
                <p className="text-sm font-medium text-muted-foreground">Active Scenarios</p>
              </div>
              <p className="text-3xl font-bold text-foreground" data-testid="text-active-scenarios">
                {metrics.activeScenarios}
              </p>
            </div>
            <div className="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
              <Target className="h-7 w-7 text-white" />
            </div>
          </div>
          <div className="mt-4 flex items-center text-sm">
            <div className="flex items-center">
              <TrendingUp className="h-3 w-3 text-green-600 mr-1" />
              <span className="text-green-600 font-medium">+18%</span>
            </div>
            <span className="text-muted-foreground ml-2">from last month</span>
          </div>
        </CardContent>
      </Card>
      
      <Card className="hover:shadow-lg transition-all duration-300 border-l-4 border-l-amber-500">
        <CardContent className="p-6">
          <div className="flex items-center justify-between">
            <div>
              <div className="flex items-center gap-2 mb-2">
                <CheckSquare className="h-4 w-4 text-amber-600" />
                <p className="text-sm font-medium text-muted-foreground">Pending Tasks</p>
              </div>
              <p className="text-3xl font-bold text-foreground" data-testid="text-pending-tasks">
                {metrics.pendingTasks}
              </p>
            </div>
            <div className="w-14 h-14 bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl flex items-center justify-center shadow-lg">
              <CheckSquare className="h-7 w-7 text-white" />
            </div>
          </div>
          <div className="mt-4 flex items-center text-sm">
            <div className="flex items-center">
              <Activity className="h-3 w-3 text-amber-600 mr-1" />
              <span className="text-amber-600 font-medium">-8%</span>
            </div>
            <span className="text-muted-foreground ml-2">from last week</span>
          </div>
        </CardContent>
      </Card>
      
      <Card className="hover:shadow-lg transition-all duration-300 border-l-4 border-l-emerald-500">
        <CardContent className="p-6">
          <div className="flex items-center justify-between">
            <div>
              <div className="flex items-center gap-2 mb-2">
                <Users className="h-4 w-4 text-emerald-600" />
                <p className="text-sm font-medium text-muted-foreground">Team Members</p>
              </div>
              <p className="text-3xl font-bold text-foreground" data-testid="text-team-members">
                {metrics.teamMembers}
              </p>
            </div>
            <div className="w-14 h-14 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg">
              <Users className="h-7 w-7 text-white" />
            </div>
          </div>
          <div className="mt-4 flex items-center text-sm">
            <div className="flex items-center">
              <TrendingUp className="h-3 w-3 text-emerald-600 mr-1" />
              <span className="text-emerald-600 font-medium">+2</span>
            </div>
            <span className="text-muted-foreground ml-2">new this week</span>
          </div>
        </CardContent>
      </Card>
      
      <Card className="hover:shadow-lg transition-all duration-300 border-l-4 border-l-purple-500">
        <CardContent className="p-6">
          <div className="flex items-center justify-between">
            <div>
              <div className="flex items-center gap-2 mb-2">
                <Zap className="h-4 w-4 text-purple-600" />
                <p className="text-sm font-medium text-muted-foreground">Agility Score</p>
              </div>
              <p className="text-3xl font-bold text-foreground" data-testid="text-agility-score">
                {metrics.agilityScore}
              </p>
            </div>
            <div className="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
              <Zap className="h-7 w-7 text-white" />
            </div>
          </div>
          <div className="mt-4 flex items-center text-sm">
            <div className="flex items-center">
              <TrendingUp className="h-3 w-3 text-purple-600 mr-1" />
              <span className="text-purple-600 font-medium">+0.7</span>
            </div>
            <span className="text-muted-foreground ml-2">this quarter</span>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/NavigationBar.tsx
========================================
/**
 * @deprecated Use StandardNav or PageLayout instead.
 * This component is kept for backwards compatibility but should not be used in new pages.
 * - For marketing/landing pages: use StandardNav
 * - For platform pages with sidebar: use PageLayout
 */
import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import {
  NavigationMenu,
  NavigationMenuContent,
  NavigationMenuItem,
  NavigationMenuLink,
  NavigationMenuList,
  NavigationMenuTrigger,
} from "@/components/ui/navigation-menu";
import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet";
import { Menu, X, Moon, Sun } from "lucide-react";
import { useLocation } from "wouter";
import { CommandCenterStatusBar } from "./CommandCenterStatusBar";

export default function NavigationBar() {
  const [location, setLocation] = useLocation();
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const [isDark, setIsDark] = useState(false);

  useEffect(() => {
    const isDarkMode = document.documentElement.classList.contains('dark');
    setIsDark(isDarkMode);
  }, []);

  const toggleTheme = () => {
    const html = document.documentElement;
    html.classList.toggle('dark');
    const newState = html.classList.contains('dark');
    setIsDark(newState);
    localStorage.setItem('m-theme', newState ? 'dark' : 'light');
  };

  const productLinks = [
    { title: "Executive Dashboard", href: "/executive-dashboard", description: "Unified command center: FRI, velocity, preparedness", featured: true },
    { title: "Playbook Library", href: "/playbook-library", description: "166 pre-built strategic playbooks" },
    { title: "Live Demos", href: "/demo-hub", description: "Watch M in action" },
    { title: "Pricing", href: "/calculator", description: "ROI calculator" },
  ];

  const solutionsLinks = [
    { title: "By Role", href: "/demo-selector", description: "CEO, CFO, COO, CTO, CMO, CRO" },
    { title: "By Industry", href: "/demo-selector", description: "Financial, Healthcare, Manufacturing" },
    { title: "By Use Case", href: "/demo-selector", description: "M&A, Crisis, Launch, Competition" },
  ];

  const dynamicStrategyLinks = [
    { title: "Command Center", href: "/command-center", description: "Real-time execution coordination", featured: true },
    { title: "Playbook Library", href: "/playbook-library", description: "166 strategic playbooks" },
    { title: "Foresight Radar", href: "/foresight-radar", description: "Weak signal detection & Oracle AI" },
    { title: "Future Gym", href: "/future-gym", description: "Strategic training & simulations" },
    { title: "Living Playbooks", href: "/living-playbooks", description: "Self-learning execution guides" },
    { title: "Continuous Mode", href: "/continuous-mode", description: "Always-on operations" },
  ];

  const resourcesLinks = [
    { title: "Documentation", href: "#", description: "Getting started guides" },
    { title: "Case Studies", href: "#", description: "Customer success stories" },
    { title: "Blog", href: "#", description: "Insights and updates" },
    { title: "Support", href: "#", description: "Get help" },
  ];

  const companyLinks = [
    { title: "About Us", href: "#", description: "Our mission and team" },
    { title: "Careers", href: "#", description: "Join our team" },
    { title: "Contact", href: "#", description: "Get in touch" },
  ];

  const navigateAndClose = (href: string) => {
    setLocation(href);
    setMobileMenuOpen(false);
  };

  return (
    <>
      <nav className="sticky top-0 z-50 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 shadow-sm">
        <div className="max-w-7xl mx-auto px-6">
        <div className="flex items-center justify-between h-16">
          {/* Logo */}
          <div 
            className="flex items-center gap-3 cursor-pointer"
            onClick={() => navigateAndClose('/')}
            data-testid="nav-logo"
          >
            <div className="w-10 h-10 bg-slate-900 dark:bg-slate-100 rounded-lg flex items-center justify-center">
              <span className="text-white dark:text-slate-900 font-bold text-xl">M</span>
            </div>
            <div>
              <span className="text-xl font-bold text-slate-900 dark:text-white">M</span>
              <span className="text-xs block text-slate-600 dark:text-slate-400">Strategic Execution OS</span>
            </div>
          </div>

          {/* Desktop Navigation */}
          <div className="hidden lg:flex items-center gap-8">
            <NavigationMenu>
              <NavigationMenuList>
                {/* Product */}
                <NavigationMenuItem>
                  <NavigationMenuTrigger className="text-slate-700 dark:text-slate-300 bg-transparent hover:bg-slate-100 dark:hover:bg-slate-800 data-[state=open]:bg-slate-100 dark:data-[state=open]:bg-slate-800">
                    Product
                  </NavigationMenuTrigger>
                  <NavigationMenuContent>
                    <ul className="grid w-[400px] gap-3 p-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                      {productLinks.map((link) => (
                        <li key={link.href}>
                          <NavigationMenuLink asChild>
                            <button
                              onClick={() => {
                                setLocation(link.href);
                              }}
                              className={`w-full text-left block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors ${
                                (link as any).featured 
                                  ? 'bg-gradient-to-r from-blue-50 dark:from-blue-900 to-purple-50 dark:to-purple-900 hover:from-blue-100 dark:hover:from-blue-800 hover:to-purple-100 dark:hover:to-purple-800 border-2 border-blue-200 dark:border-blue-700' 
                                  : 'hover:bg-blue-50 dark:hover:bg-slate-700 hover:text-blue-700 dark:hover:text-blue-400 focus:bg-blue-50 dark:focus:bg-slate-700 focus:text-blue-700 dark:focus:text-blue-400'
                              }`}
                            >
                              <div className={`text-sm font-medium leading-none ${(link as any).featured ? 'text-blue-700 dark:text-blue-400 flex items-center gap-2' : 'text-slate-900 dark:text-slate-100'}`}>
                                {(link as any).featured && <span className="text-xs px-2 py-0.5 bg-blue-600 dark:bg-blue-500 text-white rounded-full">NEW</span>}
                                {link.title}
                              </div>
                              <p className="line-clamp-2 text-sm leading-snug text-slate-600 dark:text-slate-400">
                                {link.description}
                              </p>
                            </button>
                          </NavigationMenuLink>
                        </li>
                      ))}
                    </ul>
                  </NavigationMenuContent>
                </NavigationMenuItem>

                {/* Solutions */}
                <NavigationMenuItem>
                  <NavigationMenuTrigger className="text-slate-700 dark:text-slate-300 bg-transparent hover:bg-slate-100 dark:hover:bg-slate-800 data-[state=open]:bg-slate-100 dark:data-[state=open]:bg-slate-800">
                    Solutions
                  </NavigationMenuTrigger>
                  <NavigationMenuContent>
                    <ul className="grid w-[400px] gap-3 p-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                      {solutionsLinks.map((link) => (
                        <li key={link.href}>
                          <NavigationMenuLink asChild>
                            <button
                              onClick={() => {
                                setLocation(link.href);
                              }}
                              className="w-full text-left block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-blue-50 dark:hover:bg-slate-700 hover:text-blue-700 dark:hover:text-blue-400 focus:bg-blue-50 dark:focus:bg-slate-700 focus:text-blue-700 dark:focus:text-blue-400"
                            >
                              <div className="text-sm font-medium leading-none text-slate-900 dark:text-slate-100">{link.title}</div>
                              <p className="line-clamp-2 text-sm leading-snug text-slate-600 dark:text-slate-400">
                                {link.description}
                              </p>
                            </button>
                          </NavigationMenuLink>
                        </li>
                      ))}
                    </ul>
                  </NavigationMenuContent>
                </NavigationMenuItem>

                {/* Dynamic Strategy */}
                <NavigationMenuItem>
                  <NavigationMenuTrigger className="text-slate-700 dark:text-slate-300 bg-transparent hover:bg-slate-100 dark:hover:bg-slate-800 data-[state=open]:bg-slate-100 dark:data-[state=open]:bg-slate-800 font-semibold">
                    <span className="flex items-center gap-1">
                      Dynamic Strategy
                      <span className="text-xs px-2 py-0.5 bg-blue-600 dark:bg-blue-500 text-white rounded-full ml-1">NEW</span>
                    </span>
                  </NavigationMenuTrigger>
                  <NavigationMenuContent>
                    <ul className="grid w-[450px] gap-3 p-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                      {dynamicStrategyLinks.map((link) => (
                        <li key={link.href}>
                          <NavigationMenuLink asChild>
                            <button
                              onClick={() => {
                                setLocation(link.href);
                              }}
                              className={`w-full text-left block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors ${
                                (link as any).featured 
                                  ? 'bg-gradient-to-r from-blue-50 dark:from-blue-900 to-purple-50 dark:to-purple-900 hover:from-blue-100 dark:hover:from-blue-800 hover:to-purple-100 dark:hover:to-purple-800 border-2 border-blue-200 dark:border-blue-700' 
                                  : 'hover:bg-blue-50 dark:hover:bg-slate-700 hover:text-blue-700 dark:hover:text-blue-400 focus:bg-blue-50 dark:focus:bg-slate-700 focus:text-blue-700 dark:focus:text-blue-400'
                              }`}
                            >
                              <div className={`text-sm font-medium leading-none ${(link as any).featured ? 'text-blue-700 dark:text-blue-400' : 'text-slate-900 dark:text-slate-100'}`}>
                                {link.title}
                              </div>
                              <p className="line-clamp-2 text-sm leading-snug text-slate-600 dark:text-slate-400">
                                {link.description}
                              </p>
                            </button>
                          </NavigationMenuLink>
                        </li>
                      ))}
                    </ul>
                  </NavigationMenuContent>
                </NavigationMenuItem>

                {/* Resources */}
                <NavigationMenuItem>
                  <NavigationMenuTrigger className="text-slate-700 dark:text-slate-300 bg-transparent hover:bg-slate-100 dark:hover:bg-slate-800 data-[state=open]:bg-slate-100 dark:data-[state=open]:bg-slate-800">
                    Resources
                  </NavigationMenuTrigger>
                  <NavigationMenuContent>
                    <ul className="grid w-[400px] gap-3 p-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                      {resourcesLinks.map((link) => (
                        <li key={link.href}>
                          <NavigationMenuLink asChild>
                            <button
                              onClick={() => {
                                if (link.href !== '#') {
                                  setLocation(link.href);
                                }
                              }}
                              disabled={link.href === '#'}
                              className="w-full text-left block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-blue-50 dark:hover:bg-slate-700 hover:text-blue-700 dark:hover:text-blue-400 focus:bg-blue-50 dark:focus:bg-slate-700 focus:text-blue-700 dark:focus:text-blue-400 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                              <div className="text-sm font-medium leading-none text-slate-900 dark:text-slate-100">{link.title}</div>
                              <p className="line-clamp-2 text-sm leading-snug text-slate-600 dark:text-slate-400">
                                {link.description}
                              </p>
                            </button>
                          </NavigationMenuLink>
                        </li>
                      ))}
                    </ul>
                  </NavigationMenuContent>
                </NavigationMenuItem>

                {/* Company */}
                <NavigationMenuItem>
                  <NavigationMenuTrigger className="text-slate-700 dark:text-slate-300 bg-transparent hover:bg-slate-100 dark:hover:bg-slate-800 data-[state=open]:bg-slate-100 dark:data-[state=open]:bg-slate-800">
                    Company
                  </NavigationMenuTrigger>
                  <NavigationMenuContent>
                    <ul className="grid w-[400px] gap-3 p-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                      {companyLinks.map((link) => (
                        <li key={link.href}>
                          <NavigationMenuLink asChild>
                            <button
                              onClick={() => {
                                if (link.href !== '#') {
                                  setLocation(link.href);
                                }
                              }}
                              disabled={link.href === '#'}
                              className="w-full text-left block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-blue-50 dark:hover:bg-slate-700 hover:text-blue-700 dark:hover:text-blue-400 focus:bg-blue-50 dark:focus:bg-slate-700 focus:text-blue-700 dark:focus:text-blue-400 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                              <div className="text-sm font-medium leading-none text-slate-900 dark:text-slate-100">{link.title}</div>
                              <p className="line-clamp-2 text-sm leading-snug text-slate-600 dark:text-slate-400">
                                {link.description}
                              </p>
                            </button>
                          </NavigationMenuLink>
                        </li>
                      ))}
                    </ul>
                  </NavigationMenuContent>
                </NavigationMenuItem>
              </NavigationMenuList>
            </NavigationMenu>
          </div>

          {/* Right Side - Desktop */}
          <div className="hidden lg:flex items-center gap-4">
            <button
              onClick={toggleTheme}
              className="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors"
              data-testid="button-theme-toggle"
              aria-label="Toggle theme"
            >
              {isDark ? (
                <Sun className="h-5 w-5 text-slate-600 dark:text-slate-400" />
              ) : (
                <Moon className="h-5 w-5 text-slate-600 dark:text-slate-400" />
              )}
            </button>
            <Button
              variant="ghost"
              className="text-slate-700 hover:bg-slate-100"
              data-testid="button-sign-in"
              onClick={() => window.location.href = '/api/login'}
            >
              Sign In
            </Button>
            <Button
              className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white"
              onClick={() => setLocation('/demo-selector')}
              data-testid="button-get-started-nav"
            >
              Get Started
            </Button>
          </div>

          {/* Mobile Menu Button */}
          <div className="lg:hidden">
            <Sheet open={mobileMenuOpen} onOpenChange={setMobileMenuOpen}>
              <SheetTrigger asChild>
                <Button variant="ghost" size="icon" className="text-slate-700" data-testid="button-mobile-menu">
                  {mobileMenuOpen ? <X className="h-6 w-6" /> : <Menu className="h-6 w-6" />}
                </Button>
              </SheetTrigger>
              <SheetContent side="right" className="bg-white border-slate-200 w-[300px]">
                <div className="flex flex-col gap-6 mt-8">
                  {/* Product */}
                  <div>
                    <h3 className="font-bold text-slate-900 mb-3">Product</h3>
                    <ul className="space-y-2">
                      {productLinks.map((link) => (
                        <li key={link.href}>
                          <a
                            href={link.href}
                            onClick={(e) => {
                              e.preventDefault();
                              navigateAndClose(link.href);
                            }}
                            className="text-slate-600 hover:text-blue-600 block py-1"
                          >
                            {link.title}
                          </a>
                        </li>
                      ))}
                    </ul>
                  </div>

                  {/* Solutions */}
                  <div>
                    <h3 className="font-bold text-slate-900 mb-3">Solutions</h3>
                    <ul className="space-y-2">
                      {solutionsLinks.map((link) => (
                        <li key={link.href}>
                          <a
                            href={link.href}
                            onClick={(e) => {
                              e.preventDefault();
                              navigateAndClose(link.href);
                            }}
                            className="text-slate-600 hover:text-blue-600 block py-1"
                          >
                            {link.title}
                          </a>
                        </li>
                      ))}
                    </ul>
                  </div>

                  {/* Resources */}
                  <div>
                    <h3 className="font-bold text-slate-900 mb-3">Resources</h3>
                    <ul className="space-y-2">
                      {resourcesLinks.map((link) => (
                        <li key={link.href}>
                          <a
                            href={link.href}
                            className="text-slate-600 hover:text-blue-600 block py-1"
                          >
                            {link.title}
                          </a>
                        </li>
                      ))}
                    </ul>
                  </div>

                  {/* Company */}
                  <div>
                    <h3 className="font-bold text-slate-900 mb-3">Company</h3>
                    <ul className="space-y-2">
                      {companyLinks.map((link) => (
                        <li key={link.href}>
                          <a
                            href={link.href}
                            className="text-slate-600 hover:text-blue-600 block py-1"
                          >
                            {link.title}
                          </a>
                        </li>
                      ))}
                    </ul>
                  </div>

                  {/* Buttons */}
                  <div className="space-y-3 pt-6 border-t border-slate-200">
                    <Button
                      variant="outline"
                      className="w-full border-blue-600 text-blue-600 hover:bg-blue-50"
                    >
                      Sign In
                    </Button>
                    <Button
                      className="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white"
                      onClick={() => navigateAndClose('/demo-selector')}
                    >
                      Get Started
                    </Button>
                  </div>
                </div>
              </SheetContent>
            </Sheet>
          </div>
        </div>
      </div>
    </nav>
    </>
  );
}


========================================
FILE: client/src/components/OrganizationsOverview.tsx
========================================
import { useState } from "react";
import { useQuery } from "@tanstack/react-query";
import { api, type Organization } from "@/lib/api";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader } from "@/components/ui/card";
import CreateOrganizationModal from "@/components/CreateOrganizationModal";

export default function OrganizationsOverview() {
  const [showCreateModal, setShowCreateModal] = useState(false);
  
  const { data: organizations, isLoading } = useQuery<Organization[]>({
    queryKey: ["/api/organizations"],
    queryFn: () => api.getOrganizations(),
  });

  const getStatusColor = (status: string) => {
    switch (status.toLowerCase()) {
      case 'active': return 'bg-green-100 text-green-800';
      case 'planning': return 'bg-yellow-100 text-yellow-800';
      case 'inactive': return 'bg-gray-100 text-gray-800';
      default: return 'bg-blue-100 text-blue-800';
    }
  };

  const getGradientClass = (index: number) => {
    const gradients = [
      'from-blue-500 to-purple-500',
      'from-green-500 to-teal-500',
      'from-orange-500 to-red-500',
      'from-purple-500 to-pink-500',
      'from-teal-500 to-blue-500',
    ];
    return gradients[index % gradients.length];
  };

  return (
    <Card>
      <CardHeader className="border-b border-border">
        <div className="flex items-center justify-between">
          <h3 className="text-lg font-semibold text-foreground">Your Organizations</h3>
          <Button 
            onClick={() => setShowCreateModal(true)}
            data-testid="button-create-organization"
          >
            <i className="fas fa-plus w-4 mr-2"></i>
            New Organization
          </Button>
        </div>
      </CardHeader>
      
      <CardContent className="p-6">
        {isLoading ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {[...Array(3)].map((_, i) => (
              <div key={i} className="animate-pulse bg-background p-6 rounded-lg border border-border">
                <div className="w-12 h-12 bg-muted rounded-lg mb-4"></div>
                <div className="h-5 bg-muted rounded mb-2"></div>
                <div className="h-4 bg-muted rounded mb-4"></div>
                <div className="flex justify-between">
                  <div className="h-3 bg-muted rounded w-20"></div>
                  <div className="h-3 bg-muted rounded w-20"></div>
                </div>
              </div>
            ))}
          </div>
        ) : organizations?.length === 0 ? (
          <div className="text-center py-8">
            <i className="fas fa-building text-muted-foreground text-3xl mb-4"></i>
            <p className="text-muted-foreground">No organizations created yet</p>
            <Button 
              onClick={() => setShowCreateModal(true)}
              className="mt-4"
              data-testid="button-create-first-organization"
            >
              Create Your First Organization
            </Button>
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {organizations?.map((org, index) => (
              <div 
                key={org.id} 
                className="bg-background p-6 rounded-lg border border-border hover:shadow-md transition-shadow cursor-pointer"
                data-testid={`card-organization-${index}`}
              >
                <div className="flex items-start justify-between mb-4">
                  <div className={`w-12 h-12 bg-gradient-to-r ${getGradientClass(index)} rounded-lg flex items-center justify-center`}>
                    <i className="fas fa-building text-white w-5"></i>
                  </div>
                  <div className="text-right">
                    <span className={`px-2 py-1 text-xs rounded-full ${getStatusColor(org.status)}`}>
                      {org.status}
                    </span>
                  </div>
                </div>
                
                <h4 className="text-base font-semibold text-foreground mb-2" data-testid={`text-org-name-${index}`}>
                  {org.name}
                </h4>
                <p className="text-sm text-muted-foreground mb-4" data-testid={`text-org-description-${index}`}>
                  {org.description || 'No description provided'}
                </p>
                
                <div className="flex items-center justify-between text-sm text-muted-foreground">
                  <span data-testid={`text-org-members-${index}`}>0 members</span>
                  <span data-testid={`text-org-scenarios-${index}`}>0 scenarios</span>
                </div>
              </div>
            ))}
          </div>
        )}
      </CardContent>

      <CreateOrganizationModal
        open={showCreateModal}
        onOpenChange={setShowCreateModal}
      />
    </Card>
  );
}


========================================
FILE: client/src/components/ParticleBackground.tsx
========================================
import { useEffect, useRef } from 'react';

export default function ParticleBackground() {
  const canvasRef = useRef<HTMLCanvasElement>(null);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    // Set canvas size
    const resize = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };
    
    resize();
    window.addEventListener('resize', resize);

    // Particle system
    const particles: Array<{
      x: number;
      y: number;
      vx: number;
      vy: number;
      opacity: number;
      size: number;
    }> = [];

    // Create particles
    for (let i = 0; i < 50; i++) {
      particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        vx: (Math.random() - 0.5) * 0.5,
        vy: (Math.random() - 0.5) * 0.5,
        opacity: Math.random() * 0.3,
        size: Math.random() * 2 + 1,
      });
    }

    // Animation loop
    const animate = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Update and draw particles
      particles.forEach((particle) => {
        particle.x += particle.vx;
        particle.y += particle.vy;

        // Wrap around edges
        if (particle.x < 0) particle.x = canvas.width;
        if (particle.x > canvas.width) particle.x = 0;
        if (particle.y < 0) particle.y = canvas.height;
        if (particle.y > canvas.height) particle.y = 0;

        // Draw particle
        ctx.beginPath();
        ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(59, 130, 246, ${particle.opacity})`;
        ctx.fill();

        // Draw connections
        particles.forEach((otherParticle) => {
          const dx = particle.x - otherParticle.x;
          const dy = particle.y - otherParticle.y;
          const distance = Math.sqrt(dx * dx + dy * dy);

          if (distance < 100) {
            ctx.beginPath();
            ctx.moveTo(particle.x, particle.y);
            ctx.lineTo(otherParticle.x, otherParticle.y);
            ctx.strokeStyle = `rgba(59, 130, 246, ${(1 - distance / 100) * 0.1})`;
            ctx.lineWidth = 1;
            ctx.stroke();
          }
        });
      });

      requestAnimationFrame(animate);
    };

    animate();

    return () => {
      window.removeEventListener('resize', resize);
    };
  }, []);

  return (
    <canvas
      ref={canvasRef}
      className="absolute inset-0 pointer-events-none opacity-60"
      style={{ zIndex: 1 }}
    />
  );
}

========================================
FILE: client/src/components/PerformanceAnalytics.tsx
========================================
import { Card, CardContent, CardHeader } from "@/components/ui/card";

export default function PerformanceAnalytics() {
  return (
    <Card>
      <CardHeader className="border-b border-border">
        <h3 className="text-lg font-semibold text-foreground">Performance Analytics</h3>
      </CardHeader>
      
      <CardContent className="p-6 space-y-6">
        {/* Agility Score Trend */}
        <div>
          <div className="flex items-center justify-between mb-3">
            <span className="text-sm font-medium text-foreground">Agility Score Trend</span>
            <span className="text-sm text-muted-foreground">Last 30 days</span>
          </div>
          <div className="relative h-20 bg-muted/30 rounded-lg" data-testid="chart-agility-trend">
            {/* Simulated chart area */}
            <div className="absolute inset-0 flex items-end justify-between px-2 pb-2">
              <div className="w-2 bg-primary h-8 rounded-t"></div>
              <div className="w-2 bg-primary h-12 rounded-t"></div>
              <div className="w-2 bg-primary h-10 rounded-t"></div>
              <div className="w-2 bg-primary h-16 rounded-t"></div>
              <div className="w-2 bg-primary h-14 rounded-t"></div>
              <div className="w-2 bg-primary h-18 rounded-t"></div>
              <div className="w-2 bg-primary h-16 rounded-t"></div>
            </div>
          </div>
        </div>
        
        {/* Key Performance Indicators */}
        <div className="space-y-4">
          <div>
            <div className="flex items-center justify-between">
              <span className="text-sm text-foreground">Scenario Completion Rate</span>
              <span className="text-sm font-medium text-foreground" data-testid="text-completion-rate">87%</span>
            </div>
            <div className="w-full bg-muted rounded-full h-2 mt-1">
              <div className="bg-green-500 h-2 rounded-full" style={{ width: '87%' }}></div>
            </div>
          </div>
          
          <div>
            <div className="flex items-center justify-between">
              <span className="text-sm text-foreground">Task Velocity</span>
              <span className="text-sm font-medium text-foreground" data-testid="text-task-velocity">2.3/day</span>
            </div>
            <div className="w-full bg-muted rounded-full h-2 mt-1">
              <div className="bg-blue-500 h-2 rounded-full" style={{ width: '76%' }}></div>
            </div>
          </div>
          
          <div>
            <div className="flex items-center justify-between">
              <span className="text-sm text-foreground">Team Engagement</span>
              <span className="text-sm font-medium text-foreground" data-testid="text-team-engagement">94%</span>
            </div>
            <div className="w-full bg-muted rounded-full h-2 mt-1">
              <div className="bg-purple-500 h-2 rounded-full" style={{ width: '94%' }}></div>
            </div>
          </div>
        </div>
        
        {/* AI Insights */}
        <div className="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-200">
          <div className="flex items-start space-x-3">
            <div className="w-6 h-6 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
              <i className="fas fa-lightbulb text-white text-xs"></i>
            </div>
            <div>
              <p className="text-sm font-medium text-foreground mb-1">AI Insight</p>
              <p className="text-xs text-muted-foreground" data-testid="text-ai-insight">
                Your team's velocity has increased 23% this month. Consider scaling successful practices to other projects.
              </p>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/PreparednessScoreWidget.tsx
========================================
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Button } from '@/components/ui/button';
import { ArrowUp, ArrowDown, TrendingUp, Shield, AlertTriangle, Target } from 'lucide-react';
import { Link } from 'wouter';
import { demoData } from '@/lib/demoData';

interface PreparednessScoreData {
  score: number;
  previousScore: number;
  scoreDelta: number;
  scenariosPracticed: number;
  drillsCompleted: number;
  industryBenchmark: number;
  peerPercentile: number;
  executiveRole: string;
  coverageGaps: any[];
  readinessMetrics: {
    scenariosPracticed: number;
    drillsCompleted: number;
    triggersCovered: number;
    playbookReadiness: number;
    recentActivity: number;
    coverageGaps: number;
  };
}

export default function PreparednessScoreWidget({ organizationId }: { organizationId: string }) {
  const { data: scoreData, isLoading } = useQuery<PreparednessScoreData>({
    queryKey: [`/api/preparedness/score?organizationId=${organizationId}`],
    enabled: !!organizationId,
  });

  // Use enhanced demo data as fallback if API fails
  // Convert percentage scores to realistic counts matching UI expectations
  const displayData = scoreData || {
    score: demoData.preparedness.overall, // 94
    previousScore: demoData.preparedness.timeline[demoData.preparedness.timeline.length - 2]?.score || 89,
    scoreDelta: demoData.preparedness.overall - (demoData.preparedness.timeline[demoData.preparedness.timeline.length - 2]?.score || 89), // +5
    scenariosPracticed: 26, // 26 out of 30 scenarios
    drillsCompleted: 22, // 22 out of 25 drills
    industryBenchmark: 72,
    peerPercentile: 96,
    executiveRole: 'CEO',
    coverageGaps: [],
    readinessMetrics: {
      scenariosPracticed: 26, // 26/30 = 87%
      drillsCompleted: 22, // 22/25 = 88%
      triggersCovered: 18, // 18/20 = 90%
      playbookReadiness: 14, // 14/15 = 93%
      recentActivity: 10, // 10/10 = 100%
      coverageGaps: 2 // 2 gaps remaining
    }
  };

  if (isLoading) {
    return (
      <Card className="w-full" data-testid="preparedness-score-widget">
        <CardHeader>
          <CardTitle>Strategic Readiness Score</CardTitle>
          <CardDescription>Loading your strategic readiness metrics...</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="h-40 flex items-center justify-center">
            <div className="animate-pulse text-muted-foreground">Calculating...</div>
          </div>
        </CardContent>
      </Card>
    );
  }

  const scoreColor = 
    displayData.score >= 80 ? 'text-green-600 dark:text-green-400' :
    displayData.score >= 60 ? 'text-blue-600 dark:text-blue-400' :
    displayData.score >= 40 ? 'text-yellow-600 dark:text-yellow-400' :
    'text-red-600 dark:text-red-400';

  const scoreBgColor = 
    displayData.score >= 80 ? 'bg-green-100 dark:bg-green-900/20' :
    displayData.score >= 60 ? 'bg-blue-100 dark:bg-blue-900/20' :
    displayData.score >= 40 ? 'bg-yellow-100 dark:bg-yellow-900/20' :
    'bg-red-100 dark:bg-red-900/20';

  const scoreStatus = 
    displayData.score >= 80 ? 'Excellent' :
    displayData.score >= 60 ? 'Good' :
    displayData.score >= 40 ? 'Fair' :
    'Needs Attention';

  const peerComparison = displayData.score > displayData.industryBenchmark ? 'above' : 'below';
  const delta = Math.abs(displayData.score - displayData.industryBenchmark);

  return (
    <Card className="w-full shadow-lg border-2" data-testid="preparedness-score-widget">
      <CardHeader className="pb-3">
        <div className="flex items-center justify-between">
          <div>
            <CardTitle className="text-xl">Strategic Readiness Score</CardTitle>
            <CardDescription className="text-sm mt-1">
              Your organizational readiness for Dynamic Strategy execution
            </CardDescription>
          </div>
          <Shield className={`h-8 w-8 ${scoreColor}`} />
        </div>
      </CardHeader>

      <CardContent className="space-y-4">
        {/* Main Score Display */}
        <div className={`${scoreBgColor} rounded-xl p-6 text-center relative`}>
          <div className="flex items-center justify-center gap-3">
            <div className={`text-6xl font-bold ${scoreColor}`} data-testid="preparedness-score-value">
              {displayData.score}
            </div>
            <div className="text-left">
              <div className={`text-sm font-medium ${scoreColor}`}>/100</div>
              <Badge variant={displayData.score >= 60 ? 'default' : 'destructive'} className="mt-1">
                {scoreStatus}
              </Badge>
            </div>
          </div>

          {/* Score Delta */}
          {displayData.scoreDelta !== 0 && (
            <div className="flex items-center justify-center gap-1 mt-3" data-testid="score-delta">
              {displayData.scoreDelta > 0 ? (
                <ArrowUp className="h-4 w-4 text-green-600 dark:text-green-400" />
              ) : (
                <ArrowDown className="h-4 w-4 text-red-600 dark:text-red-400" />
              )}
              <span className={`text-sm font-medium ${displayData.scoreDelta > 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}>
                {Math.abs(displayData.scoreDelta)} points
              </span>
              <span className="text-xs text-muted-foreground">since last check</span>
            </div>
          )}
        </div>

        {/* Peer Comparison */}
        <div className="bg-muted/50 dark:bg-muted/20 rounded-lg p-4" data-testid="peer-comparison">
          <div className="flex items-center justify-between mb-2">
            <div className="flex items-center gap-2">
              <TrendingUp className="h-4 w-4 text-muted-foreground" />
              <span className="text-sm font-medium">Industry Benchmark</span>
            </div>
            <Badge variant="outline" className="text-xs">
              {displayData.executiveRole}
            </Badge>
          </div>
          
          <div className="flex items-baseline gap-2">
            <span className="text-2xl font-bold">{displayData.industryBenchmark}</span>
            <span className="text-sm text-muted-foreground">avg score</span>
          </div>

          <div className="mt-2 text-sm">
            You're <span className={`font-semibold ${peerComparison === 'above' ? 'text-green-600 dark:text-green-400' : 'text-yellow-600 dark:text-yellow-400'}`}>
              {delta} points {peerComparison}
            </span> industry average
          </div>

          <div className="mt-2 flex items-center gap-2">
            <span className="text-xs text-muted-foreground">Your Percentile:</span>
            <Badge variant="secondary" className="text-xs">
              Top {100 - displayData.peerPercentile}%
            </Badge>
          </div>
        </div>

        {/* Quick Stats */}
        <div className="grid grid-cols-2 gap-3">
          <div className="bg-blue-50 dark:bg-blue-950/20 rounded-lg p-3" data-testid="scenarios-practiced">
            <div className="flex items-center gap-2 mb-1">
              <Target className="h-4 w-4 text-blue-600 dark:text-blue-400" />
              <span className="text-xs text-blue-600 dark:text-blue-400 font-medium">Scenarios</span>
            </div>
            <div className="text-2xl font-bold text-blue-700 dark:text-blue-300">
              {displayData.scenariosPracticed}
            </div>
            <div className="text-xs text-muted-foreground">practiced</div>
          </div>

          <div className="bg-green-50 dark:bg-green-950/20 rounded-lg p-3" data-testid="drills-completed">
            <div className="flex items-center gap-2 mb-1">
              <Shield className="h-4 w-4 text-green-600 dark:text-green-400" />
              <span className="text-xs text-green-600 dark:text-green-400 font-medium">Drills</span>
            </div>
            <div className="text-2xl font-bold text-green-700 dark:text-green-300">
              {displayData.drillsCompleted}
            </div>
            <div className="text-xs text-muted-foreground">completed</div>
          </div>
        </div>

        {/* Coverage Gaps Warning */}
        {displayData.coverageGaps && displayData.coverageGaps.length > 0 && (
          <div className="bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3" data-testid="coverage-gaps-alert">
            <div className="flex items-start gap-2">
              <AlertTriangle className="h-4 w-4 text-yellow-600 dark:text-yellow-400 mt-0.5" />
              <div className="flex-1">
                <div className="text-sm font-medium text-yellow-700 dark:text-yellow-300">
                  {displayData.coverageGaps.length} Coverage Gap{displayData.coverageGaps.length > 1 ? 's' : ''} Identified
                </div>
                <div className="text-xs text-yellow-600 dark:text-yellow-400 mt-1">
                  High-risk scenarios not yet addressed
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Action Button */}
        <Link href="/preparedness-report">
          <Button className="w-full" variant="default" data-testid="button-view-full-report">
            View Full Report
          </Button>
        </Link>

        {/* Score Breakdown */}
        <div className="pt-3 border-t">
          <div className="text-xs font-medium text-muted-foreground mb-3">Score Breakdown</div>
          <div className="space-y-2">
            <div>
              <div className="flex justify-between text-xs mb-1">
                <span>Scenarios Practiced</span>
                <span className="font-medium">{displayData.readinessMetrics?.scenariosPracticed || 0}/30</span>
              </div>
              <Progress value={(displayData.readinessMetrics?.scenariosPracticed || 0) / 30 * 100} className="h-1.5" data-testid="progress-scenarios" />
            </div>

            <div>
              <div className="flex justify-between text-xs mb-1">
                <span>Drills Completed</span>
                <span className="font-medium">{displayData.readinessMetrics?.drillsCompleted || 0}/25</span>
              </div>
              <Progress value={(displayData.readinessMetrics?.drillsCompleted || 0) / 25 * 100} className="h-1.5" data-testid="progress-drills" />
            </div>

            <div>
              <div className="flex justify-between text-xs mb-1">
                <span>Triggers Configured</span>
                <span className="font-medium">{displayData.readinessMetrics?.triggersCovered || 0}/20</span>
              </div>
              <Progress value={(displayData.readinessMetrics?.triggersCovered || 0) / 20 * 100} className="h-1.5" data-testid="progress-triggers" />
            </div>

            <div>
              <div className="flex justify-between text-xs mb-1">
                <span>Playbook Readiness</span>
                <span className="font-medium">{displayData.readinessMetrics?.playbookReadiness || 0}/15</span>
              </div>
              <Progress value={(displayData.readinessMetrics?.playbookReadiness || 0) / 15 * 100} className="h-1.5" data-testid="progress-playbooks" />
            </div>

            <div>
              <div className="flex justify-between text-xs mb-1">
                <span>Recent Activity</span>
                <span className="font-medium">{displayData.readinessMetrics?.recentActivity || 0}/10</span>
              </div>
              <Progress value={(displayData.readinessMetrics?.recentActivity || 0) / 10 * 100} className="h-1.5" data-testid="progress-activity" />
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/ProactiveRadar.tsx
========================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useToast } from '@/hooks/use-toast';
import { 
  Radar, 
  Brain, 
  TrendingUp, 
  AlertTriangle, 
  CheckCircle, 
  Clock, 
  RefreshCw,
  Lightbulb,
  Target,
  Search,
  BarChart3,
  Activity,
  Eye,
  Zap
} from 'lucide-react';

interface RadarStatus {
  isScanning: boolean;
  activeDataStreams: number;
  totalDataStreams: number;
  activeAlertTriggers: number;
  totalAlertTriggers: number;
  lastScanTime?: string;
}

interface RadarResponse {
  success: boolean;
  status: RadarStatus;
  timestamp: string;
}

interface SyntheticScenario {
  title: string;
  description: string;
  category: string;
  likelihood: number;
  potentialImpact: string;
  timeHorizon: string;
  triggerSigns: string[];
  keyStakeholders: string[];
  strategicImplications: string;
}

interface IntuitionValidation {
  validation: string;
  validationScore: number;
  supportingData: string[];
  contradictingData: string[];
  recommendedActions: string[];
  reasoning: string;
}

/**
 * Proactive AI Radar Component - The Executive Strategic Co-pilot
 * 
 * This component provides C-suite executives with:
 * - Real-time AI radar monitoring status
 * - Manual trigger capabilities for immediate insights
 * - Synthetic scenario generation beyond historical templates
 * - Executive intuition validation with data backing
 */
export default function ProactiveRadar() {
  const [activeTab, setActiveTab] = useState('status');
  const [scenarioQuery, setScenarioQuery] = useState('');
  const [intuitionForm, setIntuitionForm] = useState({
    title: '',
    description: '',
    timeframe: 'medium-term',
    relatedDomain: 'general',
    confidenceLevel: 'medium'
  });

  const { toast } = useToast();
  const queryClient = useQueryClient();

  // Query AI Radar status
  const { data: radarStatus, isLoading: statusLoading } = useQuery<RadarResponse>({
    queryKey: ['/api/ai-radar/status'],
    refetchInterval: 30000, // Refresh every 30 seconds
  });

  // Manual scan mutation
  const scanMutation = useMutation({
    mutationFn: async () => {
      const response = await fetch('/api/ai-radar/scan', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
      });
      return response.json();
    },
    onSuccess: () => {
      toast({
        title: "AI Radar Scan Completed",
        description: "Proactive analysis completed. Check your dashboard for new strategic insights.",
      });
      queryClient.invalidateQueries({ queryKey: ['/api/ai-radar/status'] });
    },
    onError: () => {
      toast({
        title: "Scan Failed",
        description: "AI Radar scan encountered an issue. Please try again.",
        variant: "destructive",
      });
    },
  });

  // Synthetic scenarios mutation
  const scenarioMutation = useMutation({
    mutationFn: async (query: string) => {
      const response = await fetch('/api/synthetic-scenarios', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          query,
          organizationId: 'current-org' 
        }),
      });
      return response.json();
    },
    onSuccess: () => {
      toast({
        title: "Synthetic Scenarios Generated",
        description: "AI has generated novel strategic scenarios based on your query.",
      });
      setScenarioQuery('');
    },
    onError: () => {
      toast({
        title: "Generation Failed",
        description: "Failed to generate synthetic scenarios. Please try again.",
        variant: "destructive",
      });
    },
  });

  // Intuition validation mutation
  const intuitionMutation = useMutation({
    mutationFn: async (intuition: typeof intuitionForm) => {
      const response = await fetch('/api/intuition-validation', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(intuition),
      });
      return response.json();
    },
    onSuccess: () => {
      toast({
        title: "Intuition Validated",
        description: "AI has analyzed your strategic hunch with data-driven insights.",
      });
      setIntuitionForm({
        title: '',
        description: '',
        timeframe: 'medium-term',
        relatedDomain: 'general',
        confidenceLevel: 'medium'
      });
    },
    onError: () => {
      toast({
        title: "Validation Failed",
        description: "Failed to validate executive intuition. Please try again.",
        variant: "destructive",
      });
    },
  });

  const handleScenarioGeneration = () => {
    if (!scenarioQuery.trim()) {
      toast({
        title: "Query Required",
        description: "Please enter a strategic question or context for scenario generation.",
        variant: "destructive",
      });
      return;
    }
    scenarioMutation.mutate(scenarioQuery);
  };

  const handleIntuitionValidation = () => {
    if (!intuitionForm.title.trim() || !intuitionForm.description.trim()) {
      toast({
        title: "Missing Information",
        description: "Please provide both a title and description for your intuition.",
        variant: "destructive",
      });
      return;
    }
    intuitionMutation.mutate(intuitionForm);
  };

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case 'critical': return 'bg-red-500';
      case 'high': return 'bg-orange-500';
      case 'medium': return 'bg-yellow-500';
      case 'low': return 'bg-green-500';
      default: return 'bg-gray-500';
    }
  };

  return (
    <div className="space-y-6" data-testid="proactive-radar-dashboard">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div className="flex items-center space-x-3">
          <div className="p-2 bg-blue-100 rounded-lg">
            <Radar className="h-6 w-6 text-blue-600" />
          </div>
          <div>
            <h2 className="text-2xl font-bold">Proactive AI Radar</h2>
            <p className="text-gray-600">Strategic Co-pilot for Executive Decision Making</p>
          </div>
        </div>
        
        <Button 
          onClick={() => scanMutation.mutate()}
          disabled={scanMutation.isPending}
          className="bg-blue-600 hover:bg-blue-700"
          data-testid="button-manual-scan"
        >
          {scanMutation.isPending ? (
            <RefreshCw className="h-4 w-4 animate-spin mr-2" />
          ) : (
            <Search className="h-4 w-4 mr-2" />
          )}
          {scanMutation.isPending ? 'Scanning...' : 'Manual Scan'}
        </Button>
      </div>

      <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
        <TabsList className="grid w-full grid-cols-4">
          <TabsTrigger value="status" data-testid="tab-status">Radar Status</TabsTrigger>
          <TabsTrigger value="scenarios" data-testid="tab-scenarios">Synthetic Futures</TabsTrigger>
          <TabsTrigger value="intuition" data-testid="tab-intuition">Intuition Validation</TabsTrigger>
          <TabsTrigger value="insights" data-testid="tab-insights">Live Insights</TabsTrigger>
        </TabsList>

        {/* Radar Status Tab */}
        <TabsContent value="status" className="space-y-4">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            {/* System Status */}
            <Card data-testid="card-system-status">
              <CardHeader className="pb-3">
                <CardTitle className="text-sm font-medium flex items-center">
                  <Activity className="h-4 w-4 mr-2" />
                  System Status
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="flex items-center space-x-2">
                  {radarStatus?.status?.isScanning ? (
                    <>
                      <div className="h-2 w-2 bg-green-500 rounded-full animate-pulse"></div>
                      <span className="text-sm font-medium text-green-600">Active Scanning</span>
                    </>
                  ) : (
                    <>
                      <div className="h-2 w-2 bg-yellow-500 rounded-full"></div>
                      <span className="text-sm font-medium text-yellow-600">Standby Mode</span>
                    </>
                  )}
                </div>
                <div className="mt-2 text-xs text-gray-500" data-testid="text-last-scan">
                  Last Scan: {radarStatus?.status?.lastScanTime ? 
                    new Date(radarStatus.status.lastScanTime).toLocaleTimeString() : 
                    'Never'
                  }
                </div>
              </CardContent>
            </Card>

            {/* Data Streams */}
            <Card data-testid="card-data-streams">
              <CardHeader className="pb-3">
                <CardTitle className="text-sm font-medium flex items-center">
                  <BarChart3 className="h-4 w-4 mr-2" />
                  Data Streams
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-2xl font-bold" data-testid="text-active-streams">
                  {radarStatus?.status?.activeDataStreams || 0}/{radarStatus?.status?.totalDataStreams || 0}
                </div>
                <div className="text-xs text-gray-500">Active Monitoring</div>
                <Progress 
                  value={radarStatus?.status?.totalDataStreams ? 
                    (radarStatus.status.activeDataStreams / radarStatus.status.totalDataStreams) * 100 : 0
                  } 
                  className="mt-2 h-2"
                />
              </CardContent>
            </Card>

            {/* Alert Triggers */}
            <Card data-testid="card-alert-triggers">
              <CardHeader className="pb-3">
                <CardTitle className="text-sm font-medium flex items-center">
                  <AlertTriangle className="h-4 w-4 mr-2" />
                  Alert Triggers
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-2xl font-bold" data-testid="text-active-triggers">
                  {radarStatus?.status?.activeAlertTriggers || 0}/{radarStatus?.status?.totalAlertTriggers || 0}
                </div>
                <div className="text-xs text-gray-500">Ready to Alert</div>
                <Progress 
                  value={radarStatus?.status?.totalAlertTriggers ? 
                    (radarStatus.status.activeAlertTriggers / radarStatus.status.totalAlertTriggers) * 100 : 0
                  } 
                  className="mt-2 h-2"
                />
              </CardContent>
            </Card>
          </div>
        </TabsContent>

        {/* Synthetic Scenarios Tab */}
        <TabsContent value="scenarios" className="space-y-4">
          <Card data-testid="card-scenario-generator">
            <CardHeader>
              <CardTitle className="flex items-center">
                <Brain className="h-5 w-5 mr-2" />
                Synthetic Futures Engine
              </CardTitle>
              <p className="text-sm text-gray-600">
                Generate novel strategic scenarios beyond historical templates using AI intelligence.
              </p>
            </CardHeader>
            <CardContent className="space-y-4">
              <div>
                <Label htmlFor="scenario-query">Executive Query</Label>
                <Textarea
                  id="scenario-query"
                  placeholder="Ask strategic questions like: 'What are the three most likely black swan events for our industry in the next 18 months?' or 'How might AI disruption affect our supply chain over the next 2 years?'"
                  value={scenarioQuery}
                  onChange={(e) => setScenarioQuery(e.target.value)}
                  className="mt-1"
                  data-testid="textarea-scenario-query"
                />
              </div>
              
              <Button 
                onClick={handleScenarioGeneration}
                disabled={scenarioMutation.isPending}
                className="w-full"
                data-testid="button-generate-scenarios"
              >
                {scenarioMutation.isPending ? (
                  <RefreshCw className="h-4 w-4 animate-spin mr-2" />
                ) : (
                  <Lightbulb className="h-4 w-4 mr-2" />
                )}
                {scenarioMutation.isPending ? 'Generating...' : 'Generate Synthetic Scenarios'}
              </Button>

              {scenarioMutation.data?.scenarios && (
                <div className="space-y-3 mt-4" data-testid="div-generated-scenarios">
                  <h4 className="font-medium">Generated Scenarios:</h4>
                  {scenarioMutation.data.scenarios.map((scenario: SyntheticScenario, index: number) => (
                    <Alert key={index} className="border-blue-200">
                      <Target className="h-4 w-4" />
                      <AlertDescription>
                        <div className="space-y-2">
                          <div className="font-medium">{scenario.title}</div>
                          <div className="text-sm text-gray-600">{scenario.description}</div>
                          <div className="flex space-x-4 text-xs">
                            <Badge variant="outline">Likelihood: {(scenario.likelihood * 100).toFixed(0)}%</Badge>
                            <Badge variant="outline">Impact: {scenario.potentialImpact}</Badge>
                            <Badge variant="outline">Timeline: {scenario.timeHorizon}</Badge>
                          </div>
                        </div>
                      </AlertDescription>
                    </Alert>
                  ))}
                </div>
              )}
            </CardContent>
          </Card>
        </TabsContent>

        {/* Intuition Validation Tab */}
        <TabsContent value="intuition" className="space-y-4">
          <Card data-testid="card-intuition-validator">
            <CardHeader>
              <CardTitle className="flex items-center">
                <Eye className="h-5 w-5 mr-2" />
                Intuition Validation
              </CardTitle>
              <p className="text-sm text-gray-600">
                Submit your strategic hunches for AI validation and data-driven analysis.
              </p>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <Label htmlFor="intuition-title">Intuition Title</Label>
                  <Input
                    id="intuition-title"
                    placeholder="Brief title for your strategic hunch"
                    value={intuitionForm.title}
                    onChange={(e) => setIntuitionForm({...intuitionForm, title: e.target.value})}
                    data-testid="input-intuition-title"
                  />
                </div>
                
                <div>
                  <Label htmlFor="intuition-timeframe">Timeframe</Label>
                  <Select 
                    value={intuitionForm.timeframe} 
                    onValueChange={(value) => setIntuitionForm({...intuitionForm, timeframe: value})}
                  >
                    <SelectTrigger data-testid="select-intuition-timeframe">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="immediate">Immediate (0-3 months)</SelectItem>
                      <SelectItem value="short-term">Short-term (3-12 months)</SelectItem>
                      <SelectItem value="medium-term">Medium-term (1-3 years)</SelectItem>
                      <SelectItem value="long-term">Long-term (3+ years)</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>

              <div>
                <Label htmlFor="intuition-description">Detailed Description</Label>
                <Textarea
                  id="intuition-description"
                  placeholder="Describe your strategic intuition in detail. What patterns do you see? What makes you think this might happen?"
                  value={intuitionForm.description}
                  onChange={(e) => setIntuitionForm({...intuitionForm, description: e.target.value})}
                  className="mt-1"
                  data-testid="textarea-intuition-description"
                />
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <Label htmlFor="intuition-domain">Related Domain</Label>
                  <Select 
                    value={intuitionForm.relatedDomain} 
                    onValueChange={(value) => setIntuitionForm({...intuitionForm, relatedDomain: value})}
                  >
                    <SelectTrigger data-testid="select-intuition-domain">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="general">General Business</SelectItem>
                      <SelectItem value="market">Market Dynamics</SelectItem>
                      <SelectItem value="technology">Technology</SelectItem>
                      <SelectItem value="regulation">Regulatory</SelectItem>
                      <SelectItem value="competitive">Competitive Landscape</SelectItem>
                      <SelectItem value="financial">Financial Markets</SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                <div>
                  <Label htmlFor="intuition-confidence">Your Confidence</Label>
                  <Select 
                    value={intuitionForm.confidenceLevel} 
                    onValueChange={(value) => setIntuitionForm({...intuitionForm, confidenceLevel: value})}
                  >
                    <SelectTrigger data-testid="select-intuition-confidence">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="low">Low Confidence</SelectItem>
                      <SelectItem value="medium">Medium Confidence</SelectItem>
                      <SelectItem value="high">High Confidence</SelectItem>
                      <SelectItem value="very_high">Very High Confidence</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>

              <Button 
                onClick={handleIntuitionValidation}
                disabled={intuitionMutation.isPending}
                className="w-full"
                data-testid="button-validate-intuition"
              >
                {intuitionMutation.isPending ? (
                  <RefreshCw className="h-4 w-4 animate-spin mr-2" />
                ) : (
                  <CheckCircle className="h-4 w-4 mr-2" />
                )}
                {intuitionMutation.isPending ? 'Validating...' : 'Validate with AI Analysis'}
              </Button>

              {intuitionMutation.data?.validation && (
                <Alert className="border-green-200 mt-4" data-testid="alert-validation-results">
                  <CheckCircle className="h-4 w-4" />
                  <AlertDescription>
                    <div className="space-y-2">
                      <div className="font-medium">AI Validation Results</div>
                      <div className="text-sm">
                        <strong>Assessment:</strong> {intuitionMutation.data.validation.validation}
                      </div>
                      <div className="text-sm">
                        <strong>Confidence Score:</strong> {(intuitionMutation.data.validation.validationScore * 100).toFixed(0)}%
                      </div>
                      <div className="text-sm">
                        <strong>Reasoning:</strong> {intuitionMutation.data.validation.reasoning}
                      </div>
                    </div>
                  </AlertDescription>
                </Alert>
              )}
            </CardContent>
          </Card>
        </TabsContent>

        {/* Live Insights Tab */}
        <TabsContent value="insights" className="space-y-4">
          <Card data-testid="card-live-insights">
            <CardHeader>
              <CardTitle className="flex items-center">
                <Zap className="h-5 w-5 mr-2" />
                Live Strategic Insights
              </CardTitle>
              <p className="text-sm text-gray-600">
                Real-time AI-generated insights and proactive alerts from continuous monitoring.
              </p>
            </CardHeader>
            <CardContent>
              <div className="text-center py-8 text-gray-500" data-testid="div-insights-placeholder">
                <TrendingUp className="h-12 w-12 mx-auto mb-4 opacity-50" />
                <p>AI Radar is continuously scanning for strategic opportunities and risks.</p>
                <p className="text-sm mt-2">New insights will appear here as they are discovered.</p>
                <Button 
                  variant="outline" 
                  className="mt-4"
                  onClick={() => scanMutation.mutate()}
                  disabled={scanMutation.isPending}
                  data-testid="button-trigger-scan"
                >
                  Trigger Immediate Scan
                </Button>
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  );
}

========================================
FILE: client/src/components/PulseMetricsPanel.tsx
========================================
import { useState, useEffect } from "react";
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { TrendingUp, TrendingDown, Activity, Target, Users, Zap } from "lucide-react";

interface PulseMetric {
  id: string;
  metricName: string;
  value: string;
  unit: string;
  category: string;
  timestamp: string;
  metadata?: any;
}

export default function PulseMetricsPanel() {
  const [organizationId, setOrganizationId] = useState<string | null>(null);

  // Get user's organizations first
  const { data: organizations } = useQuery({
    queryKey: ["/api/organizations"],
    enabled: true
  });

  useEffect(() => {
    if (organizations && Array.isArray(organizations) && organizations.length > 0) {
      setOrganizationId(organizations[0].id);
    }
  }, [organizations]);

  const { data: metrics, isLoading } = useQuery({
    queryKey: [`/api/pulse-metrics/${organizationId}/latest`],
    enabled: !!organizationId
  });

  const getMetricIcon = (category: string) => {
    switch (category.toLowerCase()) {
      case 'performance': return <Target className="h-4 w-4" />;
      case 'productivity': return <Zap className="h-4 w-4" />;
      case 'innovation': return <TrendingUp className="h-4 w-4" />;
      case 'culture': return <Users className="h-4 w-4" />;
      case 'strategy': return <Activity className="h-4 w-4" />;
      default: return <Activity className="h-4 w-4" />;
    }
  };

  const getMetricColor = (value: number) => {
    if (value >= 8) return "text-green-600 bg-green-50";
    if (value >= 6) return "text-yellow-600 bg-yellow-50"; 
    return "text-red-600 bg-red-50";
  };

  const formatMetricValue = (value: string, unit: string) => {
    const numValue = parseFloat(value);
    if (unit === 'percentage') return `${numValue.toFixed(1)}%`;
    if (unit === 'score') return `${numValue.toFixed(1)}/10`;
    return `${numValue.toFixed(1)} ${unit}`;
  };

  if (isLoading) {
    return (
      <Card data-testid="pulse-metrics-panel" className="h-80">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Activity className="h-5 w-5" />
            Pulse Metrics
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {[1, 2, 3].map(i => (
              <div key={i} className="animate-pulse">
                <div className="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div className="h-2 bg-gray-200 rounded w-full"></div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card data-testid="pulse-metrics-panel" className="h-80">
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Activity className="h-5 w-5" />
          Pulse Metrics
        </CardTitle>
        <CardDescription>
          Real-time organizational health indicators
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        {metrics && Array.isArray(metrics) && metrics.length > 0 ? (
          metrics.slice(0, 4).map((metric: PulseMetric) => {
            const value = parseFloat(metric.value);
            const progressValue = (value / 10) * 100;
            
            return (
              <div key={metric.id} className="flex items-center justify-between">
                <div className="flex items-center gap-3 flex-1">
                  <div className={`p-2 rounded-lg ${getMetricColor(value)}`}>
                    {getMetricIcon(metric.category)}
                  </div>
                  <div className="flex-1">
                    <div className="flex items-center justify-between mb-1">
                      <span className="text-sm font-medium" data-testid={`metric-name-${metric.metricName.replace(/\s+/g, '-').toLowerCase()}`}>
                        {metric.metricName}
                      </span>
                      <span className="text-sm text-muted-foreground" data-testid={`metric-value-${metric.metricName.replace(/\s+/g, '-').toLowerCase()}`}>
                        {formatMetricValue(metric.value, metric.unit)}
                      </span>
                    </div>
                    <Progress value={progressValue} className="h-2" />
                  </div>
                </div>
              </div>
            );
          })
        ) : (
          <div className="text-center py-8">
            <Activity className="h-12 w-12 mx-auto text-muted-foreground mb-4" />
            <p className="text-muted-foreground">No pulse metrics available</p>
            <p className="text-sm text-muted-foreground mt-1">
              Metrics will appear as data is collected
            </p>
          </div>
        )}
        
        {metrics && Array.isArray(metrics) && metrics.length > 0 && (
          <div className="pt-4 border-t">
            <div className="flex items-center justify-between text-sm">
              <span className="text-muted-foreground">Overall Health</span>
              <Badge variant="secondary" className="bg-blue-50 text-blue-700" data-testid="overall-health-score">
                {Array.isArray(metrics) && metrics.length > 0 ? 
                  `${(metrics.reduce((sum: number, m: PulseMetric) => sum + parseFloat(m.value), 0) / metrics.length).toFixed(1)}/10` 
                  : 'N/A'
                }
              </Badge>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}

========================================
FILE: client/src/components/ROIDashboard.tsx
========================================
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { Badge } from "@/components/ui/badge";

interface ROIMetrics {
  totalValueGenerated: number;
  totalCostAvoided: number;
  avgTimeToResolution: number;
  completedTasks: number;
  completedSimulations: number;
  efficiencyGains: number;
  qualityScore: number;
  monthlyTrend: number;
}

interface ValueEvent {
  id: string;
  eventType: string;
  entityType: string;
  valueGenerated: number;
  costAvoided: number;
  timeToResolution: number;
  qualityScore: number;
  createdAt: string;
  evidenceData?: any;
}

export default function ROIDashboard() {
  const { data: roiMetrics, isLoading: metricsLoading } = useQuery<ROIMetrics>({
    queryKey: ["/api/roi-metrics"],
    refetchInterval: 30000, // Update every 30 seconds
  });

  const { data: recentEvents, isLoading: eventsLoading } = useQuery<ValueEvent[]>({
    queryKey: ["/api/roi-events/recent"],
    refetchInterval: 30000,
  });

  const formatCurrency = (amount: number) => 
    new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 }).format(amount);

  const formatNumber = (num: number) => 
    new Intl.NumberFormat('en-US').format(num);

  if (metricsLoading) {
    return (
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {[...Array(6)].map((_, i) => (
          <Card key={i} className="animate-pulse">
            <CardContent className="p-6">
              <div className="h-24 bg-muted rounded"></div>
            </CardContent>
          </Card>
        ))}
      </div>
    );
  }

  if (!roiMetrics) {
    return (
      <div className="text-center text-muted-foreground p-8">
        ROI data unavailable. Complete strategic tasks and crisis simulations to see value metrics.
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Key ROI Metrics */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {/* Total Value Generated */}
        <Card className="border-l-4 border-l-green-500">
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-muted-foreground">Value Generated</p>
                <p className="text-2xl font-bold text-green-600" data-testid="text-value-generated">
                  {formatCurrency(roiMetrics.totalValueGenerated)}
                </p>
                <p className="text-xs text-muted-foreground mt-1">
                  From strategic work completion
                </p>
              </div>
              <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                <i className="fas fa-chart-line text-green-600 w-6"></i>
              </div>
            </div>
            {roiMetrics.monthlyTrend > 0 && (
              <div className="mt-4 flex items-center text-sm">
                <span className="text-green-600 font-medium">+{roiMetrics.monthlyTrend}%</span>
                <span className="text-muted-foreground ml-2">this month</span>
              </div>
            )}
          </CardContent>
        </Card>

        {/* Cost Avoided */}
        <Card className="border-l-4 border-l-blue-500">
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-muted-foreground">Cost Avoided</p>
                <p className="text-2xl font-bold text-blue-600" data-testid="text-cost-avoided">
                  {formatCurrency(roiMetrics.totalCostAvoided)}
                </p>
                <p className="text-xs text-muted-foreground mt-1">
                  From crisis preparedness & efficiency
                </p>
              </div>
              <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                <i className="fas fa-shield-alt text-blue-600 w-6"></i>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Efficiency Gains */}
        <Card className="border-l-4 border-l-purple-500">
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-muted-foreground">Efficiency Score</p>
                <p className="text-2xl font-bold text-purple-600" data-testid="text-efficiency-score">
                  {roiMetrics.qualityScore * 100}%
                </p>
                <p className="text-xs text-muted-foreground mt-1">
                  Avg resolution: {roiMetrics.avgTimeToResolution}min
                </p>
              </div>
              <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                <i className="fas fa-tachometer-alt text-purple-600 w-6"></i>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Strategic Activities */}
        <Card className="border-l-4 border-l-orange-500">
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-muted-foreground">Completed Activities</p>
                <p className="text-2xl font-bold text-orange-600" data-testid="text-activities-completed">
                  {formatNumber(roiMetrics.completedTasks + roiMetrics.completedSimulations)}
                </p>
                <p className="text-xs text-muted-foreground mt-1">
                  {roiMetrics.completedTasks} tasks, {roiMetrics.completedSimulations} simulations
                </p>
              </div>
              <div className="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                <i className="fas fa-tasks text-orange-600 w-6"></i>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* ROI Breakdown */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center space-x-2">
              <i className="fas fa-chart-pie text-primary w-5"></i>
              <span>ROI Value Sources</span>
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div>
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-foreground">Strategic Task Completion</span>
                <span className="text-sm font-medium text-foreground">
                  {formatCurrency(roiMetrics.totalValueGenerated * 0.6)}
                </span>
              </div>
              <Progress value={60} className="h-2" />
            </div>
            
            <div>
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-foreground">Crisis Preparedness</span>
                <span className="text-sm font-medium text-foreground">
                  {formatCurrency(roiMetrics.totalValueGenerated * 0.35)}
                </span>
              </div>
              <Progress value={35} className="h-2" />
            </div>
            
            <div>
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-foreground">Process Optimization</span>
                <span className="text-sm font-medium text-foreground">
                  {formatCurrency(roiMetrics.totalValueGenerated * 0.05)}
                </span>
              </div>
              <Progress value={5} className="h-2" />
            </div>
          </CardContent>
        </Card>

        {/* Recent Value Events */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center space-x-2">
              <i className="fas fa-clock text-primary w-5"></i>
              <span>Recent Value Creation</span>
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              {eventsLoading ? (
                <div className="text-sm text-muted-foreground">Loading recent activities...</div>
              ) : recentEvents && recentEvents.length > 0 ? (
                recentEvents.slice(0, 5).map((event) => (
                  <div key={event.id} className="flex items-center justify-between py-2 border-b last:border-b-0">
                    <div className="flex items-center space-x-3">
                      <div className="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center">
                        <i className={`fas ${
                          event.eventType === 'task_completed' ? 'fa-check' : 
                          event.eventType === 'crisis_simulation_completed' ? 'fa-shield-alt' : 
                          'fa-star'
                        } text-primary w-3`}></i>
                      </div>
                      <div>
                        <p className="text-sm font-medium text-foreground">
                          {event.eventType === 'task_completed' ? 'Strategic Task Completed' :
                           event.eventType === 'crisis_simulation_completed' ? 'Crisis Simulation' :
                           'Strategic Activity'}
                        </p>
                        <p className="text-xs text-muted-foreground">
                          {new Date(event.createdAt).toLocaleDateString()}  {event.timeToResolution}min
                        </p>
                      </div>
                    </div>
                    <div className="text-right">
                      <Badge variant="secondary" className="text-green-600 bg-green-50">
                        +{formatCurrency(event.valueGenerated)}
                      </Badge>
                    </div>
                  </div>
                ))
              ) : (
                <div className="text-sm text-muted-foreground text-center py-4">
                  Complete strategic tasks and crisis simulations to see value tracking here.
                </div>
              )}
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Executive Summary */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center space-x-2">
            <i className="fas fa-brain text-primary w-5"></i>
            <span>Strategic Intelligence ROI Summary</span>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg p-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div className="text-center">
                <p className="text-2xl font-bold text-primary">
                  {((roiMetrics.totalValueGenerated / Math.max(roiMetrics.totalValueGenerated * 0.3, 1)) * 100 - 100).toFixed(0)}%
                </p>
                <p className="text-sm text-muted-foreground">Platform ROI</p>
              </div>
              <div className="text-center">
                <p className="text-2xl font-bold text-primary">{roiMetrics.avgTimeToResolution}min</p>
                <p className="text-sm text-muted-foreground">Avg Decision Speed</p>
              </div>
              <div className="text-center">
                <p className="text-2xl font-bold text-primary">{(roiMetrics.qualityScore * 100).toFixed(0)}%</p>
                <p className="text-sm text-muted-foreground">Executive Efficiency</p>
              </div>
            </div>
            <div className="mt-4 text-center">
              <p className="text-sm text-muted-foreground">
                Your strategic intelligence platform has generated <strong className="text-primary">
                {formatCurrency(roiMetrics.totalValueGenerated)}</strong> in measurable business value 
                through enhanced decision-making and crisis preparedness.
              </p>
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

========================================
FILE: client/src/components/ROISummaryCard.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { TrendingUp, Clock, DollarSign, Zap, ArrowRight, Loader2 } from "lucide-react";
import { Link } from "wouter";
import { useQuery } from "@tanstack/react-query";
import { demoData } from "@/lib/demoData";

interface ROIMetrics {
  totalSaved: number;
  hoursRecovered: number;
  playbooksExecuted: number;
  velocityMultiplier: number;
  confidence: number;
}

interface ROISummaryCardProps {
  organizationId: string;
  period?: "week" | "month" | "quarter" | "year";
}

export default function ROISummaryCard({ organizationId, period = "quarter" }: ROISummaryCardProps) {
  
  const { data: roiData, isLoading, error } = useQuery<ROIMetrics>({
    queryKey: ['/api/roi-metrics', organizationId, period],
    queryFn: async () => {
      const response = await fetch(`/api/roi-metrics/${organizationId}?period=${period}`);
      if (!response.ok) {
        throw new Error('Failed to fetch ROI metrics');
      }
      return response.json();
    },
    enabled: !!organizationId,
  });

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(amount);
  };

  const formatNumber = (num: number) => {
    return new Intl.NumberFormat('en-US').format(num);
  };

  const getPeriodLabel = () => {
    const labels = {
      week: "This Week",
      month: "This Month",
      quarter: "This Quarter",
      year: "This Year"
    };
    return labels[period];
  };

  if (isLoading) {
    return (
      <Card className="border-2 border-blue-200 dark:border-blue-800 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20" data-testid="roi-summary-card">
        <CardContent className="flex items-center justify-center py-12">
          <Loader2 className="w-8 h-8 animate-spin text-blue-600 dark:text-blue-400" />
        </CardContent>
      </Card>
    );
  }

  // Use enhanced demo data as fallback if API fails
  const displayData = roiData || {
    totalSaved: demoData.roi.totalCostSavings,
    hoursRecovered: demoData.roi.hoursRecovered,
    playbooksExecuted: demoData.roi.playbookActivations,
    velocityMultiplier: demoData.roi.executionSpeedImprovement,
    confidence: demoData.ai.averageConfidence
  };

  return (
    <Card className="border-2 border-blue-200 dark:border-blue-800 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20" data-testid="roi-summary-card">
      <CardHeader className="pb-3">
        <div className="flex items-center justify-between">
          <CardTitle className="text-lg font-semibold text-slate-900 dark:text-white">
            Your Impact {getPeriodLabel()}
          </CardTitle>
          <div className="flex items-center gap-1.5 px-3 py-1 bg-green-100 dark:bg-green-900/30 rounded-full">
            <TrendingUp className="w-3.5 h-3.5 text-green-600 dark:text-green-400" />
            <span className="text-xs font-semibold text-green-700 dark:text-green-400">
              {displayData.confidence}% Confidence
            </span>
          </div>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Key Metrics Grid */}
        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-1">
            <div className="flex items-center gap-1.5 text-xs text-slate-600 dark:text-slate-400">
              <DollarSign className="w-3.5 h-3.5" />
              <span>Value Created</span>
            </div>
            <div className="text-2xl font-bold text-slate-900 dark:text-white" data-testid="roi-value-saved">
              {formatCurrency(displayData.totalSaved)}
            </div>
          </div>

          <div className="space-y-1">
            <div className="flex items-center gap-1.5 text-xs text-slate-600 dark:text-slate-400">
              <Clock className="w-3.5 h-3.5" />
              <span>Time Recovered</span>
            </div>
            <div className="text-2xl font-bold text-slate-900 dark:text-white" data-testid="roi-hours-saved">
              {formatNumber(displayData.hoursRecovered)} hrs
            </div>
          </div>
        </div>

        {/* Execution Metrics */}
        <div className="flex items-center justify-between pt-3 border-t border-blue-200 dark:border-blue-800">
          <div className="space-y-1">
            <div className="text-xs text-slate-600 dark:text-slate-400">Playbooks Executed</div>
            <div className="text-lg font-semibold text-slate-900 dark:text-white" data-testid="roi-playbooks-executed">
              {displayData.playbooksExecuted}
            </div>
          </div>
          <div className="space-y-1 text-right">
            <div className="text-xs text-slate-600 dark:text-slate-400">vs Traditional</div>
            <div className="flex items-center gap-1 text-lg font-semibold text-blue-600 dark:text-blue-400" data-testid="roi-velocity-multiplier">
              <Zap className="w-4 h-4" />
              {displayData.velocityMultiplier}x faster
            </div>
          </div>
        </div>

        {/* CTA */}
        <Link href="/institutional-memory">
          <Button 
            variant="outline" 
            className="w-full mt-2 border-blue-300 dark:border-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30"
            data-testid="button-view-detailed-roi"
          >
            View Detailed ROI Report
            <ArrowRight className="w-4 h-4 ml-2" />
          </Button>
        </Link>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/ScenariosSection.tsx
========================================
import { useState } from "react";
import { useQuery } from "@tanstack/react-query";
import { api, type StrategicScenario } from "@/lib/api";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader } from "@/components/ui/card";
import CreateScenarioModal from "@/components/CreateScenarioModal";

export default function ScenariosSection() {
  const [showCreateModal, setShowCreateModal] = useState(false);
  
  const { data: scenarios, isLoading } = useQuery<StrategicScenario[]>({
    queryKey: ["/api/scenarios/recent"],
    queryFn: () => api.getRecentScenarios(),
  });

  const getStatusColor = (status: string) => {
    switch (status.toLowerCase()) {
      case 'active': return 'bg-green-100 text-green-800';
      case 'review': return 'bg-yellow-100 text-yellow-800';
      case 'complete': return 'bg-blue-100 text-blue-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const getTimeAgo = (dateString: string) => {
    const date = new Date(dateString);
    const now = new Date();
    const diffInMinutes = Math.floor((now.getTime() - date.getTime()) / (1000 * 60));
    
    if (diffInMinutes < 60) return `${diffInMinutes} minutes ago`;
    if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)} hours ago`;
    return `${Math.floor(diffInMinutes / 1440)} days ago`;
  };

  return (
    <div className="lg:col-span-2">
      <Card>
        <CardHeader className="border-b border-border">
          <div className="flex items-center justify-between">
            <h3 className="text-lg font-semibold text-foreground">Recent Strategic Scenarios</h3>
            <Button 
              onClick={() => setShowCreateModal(true)}
              data-testid="button-create-scenario"
            >
              <i className="fas fa-plus w-4 mr-2"></i>
              New Scenario
            </Button>
          </div>
        </CardHeader>
        
        <CardContent className="p-6 space-y-4">
          {isLoading ? (
            <div className="space-y-4">
              {[...Array(3)].map((_, i) => (
                <div key={i} className="animate-pulse flex items-start space-x-4 p-4 rounded-lg border border-border">
                  <div className="w-10 h-10 bg-muted rounded-lg"></div>
                  <div className="flex-1 space-y-2">
                    <div className="h-4 bg-muted rounded w-3/4"></div>
                    <div className="h-3 bg-muted rounded w-1/2"></div>
                  </div>
                </div>
              ))}
            </div>
          ) : scenarios?.length === 0 ? (
            <div className="text-center py-8">
              <i className="fas fa-lightbulb text-muted-foreground text-3xl mb-4"></i>
              <p className="text-muted-foreground">No scenarios created yet</p>
              <Button 
                onClick={() => setShowCreateModal(true)}
                className="mt-4"
                data-testid="button-create-first-scenario"
              >
                Create Your First Scenario
              </Button>
            </div>
          ) : (
            scenarios?.map((scenario, index) => (
              <div 
                key={scenario.id} 
                className="flex items-start space-x-4 p-4 rounded-lg border border-border hover:bg-accent/50 cursor-pointer"
                data-testid={`card-scenario-${index}`}
              >
                <div className="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                  <i className="fas fa-lightbulb text-primary w-5"></i>
                </div>
                <div className="flex-1 min-w-0">
                  <h4 className="text-sm font-semibold text-foreground mb-1" data-testid={`text-scenario-title-${index}`}>
                    {scenario.title}
                  </h4>
                  <p className="text-sm text-muted-foreground mb-2" data-testid={`text-scenario-description-${index}`}>
                    {scenario.description}
                  </p>
                  <div className="flex items-center space-x-4 text-xs text-muted-foreground">
                    <span data-testid={`text-scenario-creator-${index}`}>
                      Created by {scenario.creatorName}
                    </span>
                    <span data-testid={`text-scenario-date-${index}`}>
                      {getTimeAgo(scenario.createdAt)}
                    </span>
                    <span className={`px-2 py-1 rounded-full ${getStatusColor(scenario.status)}`}>
                      {scenario.status}
                    </span>
                  </div>
                </div>
                <div className="text-sm text-muted-foreground">
                  <span data-testid={`text-scenario-tasks-${index}`}>
                    {scenario.taskCount} tasks
                  </span>
                </div>
              </div>
            ))
          )}
        </CardContent>
      </Card>

      <CreateScenarioModal 
        open={showCreateModal} 
        onOpenChange={setShowCreateModal} 
      />
    </div>
  );
}


========================================
FILE: client/src/components/ScenarioTemplateLibrary.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { apiRequest } from '@/lib/queryClient';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { useToast } from '@/hooks/use-toast';
import { AlertTriangle, Shield, DollarSign, Users, Clock, CheckCircle, ArrowRight, Zap, AlertCircle, Brain, Star, Award, TrendingUp, Bookmark, Filter, Wand2, Building, Gavel } from 'lucide-react';

interface ComprehensiveScenarioTemplate {
  id: string;
  name: string;
  category: string;
  description: string;
  likelihood: string;
  severity: string;
  typicalTimeframe: string;
  requiredDataPoints: any[];
  criticalDecisionPoints: string[];
  stakeholderMapping: any[];
  resourceRequirements: any[];
  successMetrics: string[];
  responsePhases: any[];
  escalationTriggers: string[];
  communicationPlan: any[];
  recoveryMetrics: string[];
  // Enhanced AI & Industry Features
  industry?: string;
  complianceFrameworks?: string[];
  aiGenerated?: boolean;
  customizable?: boolean;
  effectiveness?: {
    usageCount: number;
    successRate: number;
    avgResolutionTime: string;
    userRating: number;
  };
  aiSuggestions?: {
    confidence: number;
    reasoning: string;
    improvements: string[];
    relatedTemplates: string[];
  };
  lastUpdated?: string;
  version?: string;
  tags?: string[];
  certificationLevel?: 'basic' | 'advanced' | 'expert' | 'certified';
}

export default function ScenarioTemplateLibrary({ organizationId }: { organizationId: string }) {
  const { toast } = useToast();
  const queryClient = useQueryClient();
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [selectedIndustry, setSelectedIndustry] = useState('all');
  const [selectedTemplate, setSelectedTemplate] = useState<ComprehensiveScenarioTemplate | null>(null);
  const [templateData, setTemplateData] = useState<Record<string, any>>({});
  const [showAiSuggestions, setShowAiSuggestions] = useState(false);
  const [filterCompliance, setFilterCompliance] = useState('all');
  const [sortBy, setSortBy] = useState('effectiveness');
  const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);

  // Fetch all scenario templates
  const { data: allTemplates = [], isLoading } = useQuery<ComprehensiveScenarioTemplate[]>({
    queryKey: ['/api/scenario-templates'],
  });

  // Fetch crisis templates
  const { data: crisisTemplates = [] } = useQuery<ComprehensiveScenarioTemplate[]>({
    queryKey: ['/api/scenario-templates/crisis'],
  });

  // Create scenario from template mutation
  const createFromTemplateMutation = useMutation({
    mutationFn: async ({ templateId, customData }: { templateId: string; customData: any }) => {
      return apiRequest('POST', `/api/scenarios/from-template`, { templateId, customData: { ...customData, organizationId } });
    },
    onSuccess: () => {
      toast({
        title: 'Crisis Scenario Activated',
        description: 'Strategic scenario successfully created from template',
      });
      queryClient.invalidateQueries({ queryKey: ['/api/scenarios'] });
      setSelectedTemplate(null);
      setTemplateData({});
    },
    onError: (error: Error) => {
      toast({
        title: 'Template Creation Failed',
        description: error.message,
        variant: 'destructive',
      });
    },
  });

  const getSeverityIcon = (severity: string) => {
    switch (severity) {
      case 'catastrophic': return <AlertTriangle className="h-5 w-5 text-red-600" />;
      case 'severe': return <AlertCircle className="h-5 w-5 text-orange-600" />;
      case 'significant': return <AlertCircle className="h-5 w-5 text-yellow-600" />;
      case 'moderate': return <AlertCircle className="h-5 w-5 text-blue-600" />;
      default: return <CheckCircle className="h-5 w-5 text-green-600" />;
    }
  };

  const getCategoryIcon = (category: string) => {
    switch (category) {
      case 'security': return <Shield className="h-5 w-5" />;
      case 'financial': return <DollarSign className="h-5 w-5" />;
      case 'supply-chain': return <ArrowRight className="h-5 w-5" />;
      case 'human-capital': return <Users className="h-5 w-5" />;
      case 'strategic': return <Zap className="h-5 w-5" />;
      case 'operational': return <AlertCircle className="h-5 w-5" />;
      case 'technology': return <AlertCircle className="h-5 w-5" />;
      case 'regulatory': return <AlertCircle className="h-5 w-5" />;
      default: return <AlertCircle className="h-5 w-5" />;
    }
  };

  // Enhanced template data with AI and industry features
  const enhancedTemplates = allTemplates.map((template: ComprehensiveScenarioTemplate) => ({
    ...template,
    industry: template.industry || getIndustryFromCategory(template.category),
    complianceFrameworks: template.complianceFrameworks || getComplianceFrameworks(template.category),
    aiGenerated: template.aiGenerated || false,
    customizable: template.customizable || true,
    effectiveness: template.effectiveness || {
      usageCount: Math.floor(Math.random() * 100) + 50,
      successRate: Math.floor(Math.random() * 30) + 70,
      avgResolutionTime: generateRandomTime(),
      userRating: Math.floor(Math.random() * 20) + 80 / 20
    },
    aiSuggestions: template.aiSuggestions || generateAiSuggestions(template),
    lastUpdated: template.lastUpdated || new Date().toISOString().split('T')[0],
    version: template.version || '1.0',
    tags: template.tags || generateTags(template),
    certificationLevel: template.certificationLevel || 'advanced'
  }));

  // Map strategic categories to specific playbook types
  const getCategoryFilter = (strategicCategory: string) => {
    switch (strategicCategory) {
      case 'risk-security':
        return ['security', 'regulatory'];
      case 'operations':
        return ['operational', 'strategic', 'supply-chain'];
      case 'financial':
        return ['financial', 'technology', 'human-capital'];
      default:
        return []; // 'all' shows everything
    }
  };

  // Advanced filtering and sorting
  const filteredTemplates = enhancedTemplates.filter((template: any) => {
    const categoryFilter = getCategoryFilter(selectedCategory);
    const categoryMatch = selectedCategory === 'all' || categoryFilter.includes(template.category);
    const industryMatch = selectedIndustry === 'all' || template.industry === selectedIndustry;
    const complianceMatch = filterCompliance === 'all' || 
      (template.complianceFrameworks && template.complianceFrameworks.includes(filterCompliance));
    return categoryMatch && industryMatch && complianceMatch;
  }).sort((a: any, b: any) => {
    switch (sortBy) {
      case 'effectiveness':
        return b.effectiveness.successRate - a.effectiveness.successRate;
      case 'usage':
        return b.effectiveness.usageCount - a.effectiveness.usageCount;
      case 'rating':
        return b.effectiveness.userRating - a.effectiveness.userRating;
      case 'recent':
        return new Date(b.lastUpdated).getTime() - new Date(a.lastUpdated).getTime();
      default:
        return 0;
    }
  });

  // Helper functions
  function getIndustryFromCategory(category: string): string {
    const mapping: Record<string, string> = {
      'security': 'Technology',
      'financial': 'Financial Services',
      'supply-chain': 'Manufacturing',
      'operational': 'Operations',
      'strategic': 'Consulting',
      'technology': 'Technology',
      'regulatory': 'Legal & Compliance',
      'human-capital': 'Human Resources'
    };
    return mapping[category] || 'General';
  }

  function getComplianceFrameworks(category: string): string[] {
    const mapping: Record<string, string[]> = {
      'security': ['SOC2', 'ISO 27001', 'NIST'],
      'financial': ['SOX', 'PCI DSS', 'Basel III'],
      'supply-chain': ['ISO 9001', 'SCOR'],
      'regulatory': ['GDPR', 'HIPAA', 'SOX'],
      'operational': ['ISO 9001', 'Six Sigma'],
      'technology': ['ITIL', 'COBIT', 'ISO 27001']
    };
    return mapping[category] || ['Industry Standard'];
  }

  function generateRandomTime(): string {
    const times = ['2-4 hours', '4-8 hours', '1-2 days', '2-5 days', '1-2 weeks'];
    return times[Math.floor(Math.random() * times.length)];
  }

  function generateAiSuggestions(template: ComprehensiveScenarioTemplate) {
    return {
      confidence: Math.floor(Math.random() * 30) + 70,
      reasoning: `This template shows strong performance in ${template.category} scenarios`,
      improvements: ['Add stakeholder communication matrix', 'Include post-incident review checklist'],
      relatedTemplates: ['business-continuity', 'crisis-communication']
    };
  }

  function generateTags(template: ComprehensiveScenarioTemplate): string[] {
    const baseTags = [template.category, template.severity];
    const additionalTags = ['urgent', 'verified', 'best-practice', 'industry-standard'];
    return [...baseTags, ...additionalTags.slice(0, 2)];
  }

  const handleCreateScenario = (formData: Record<string, any>) => {
    if (!selectedTemplate) return;
    
    createFromTemplateMutation.mutate({
      templateId: selectedTemplate.id,
      customData: {
        name: formData.name || `${selectedTemplate.name} - ${new Date().toLocaleDateString()}`,
        title: formData.name || `${selectedTemplate.name} - ${new Date().toLocaleDateString()}`,
        description: formData.description || selectedTemplate.description,
        organizationId: "ec61b8f6-7d87-41fd-9969-cb990ed0b10b", // Use correct organization ID
        type: selectedTemplate.category,
        ...formData // Include all collected form data
      }
    });
  };

  if (isLoading) {
    return <div className="flex items-center justify-center py-8">Loading enterprise templates...</div>;
  }


  return (
    <div className="space-y-6" data-testid="scenario-template-library">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl font-bold text-gray-900 dark:text-white">Enterprise Intelligence Templates</h2>
          <p className="text-gray-600 dark:text-gray-400 mt-2">World-class crisis response and strategic planning templates</p>
        </div>
        <Badge variant="secondary" className="px-3 py-1">
          {allTemplates.length} Templates Available
        </Badge>
      </div>

      {/* Crisis Response Quick Access */}
      {crisisTemplates.length > 0 && (
        <Card className="border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800" data-testid="crisis-templates-section">
          <CardHeader className="pb-3">
            <CardTitle className="flex items-center gap-2 text-red-800 dark:text-red-200">
              <AlertTriangle className="h-5 w-5" />
              Critical Crisis Response Templates
            </CardTitle>
            <p className="text-red-700 dark:text-red-300 text-sm">Immediate response templates for enterprise-critical situations</p>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {crisisTemplates.map((template: ComprehensiveScenarioTemplate) => (
                <Card key={template.id} className="border-red-300 bg-white dark:bg-gray-800 hover:shadow-md transition-shadow" data-testid={`crisis-template-${template.id}`}>
                  <CardHeader className="pb-2">
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-lg">{template.name}</CardTitle>
                      {getSeverityIcon(template.severity)}
                    </div>
                  </CardHeader>
                  <CardContent>
                    <p className="text-gray-600 dark:text-gray-400 text-sm mb-3">{template.description}</p>
                    <div className="flex items-center justify-between">
                      <Badge variant={template.severity === 'severe' ? 'destructive' : 'secondary'}>
                        {template.severity}
                      </Badge>
                      <Dialog>
                        <DialogTrigger asChild>
                          <Button 
                            variant="destructive" 
                            size="sm" 
                            onClick={() => setSelectedTemplate(template)}
                            data-testid={`activate-template-${template.id}`}
                          >
                            Activate Crisis Response
                          </Button>
                        </DialogTrigger>
                        <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
                          <DialogHeader>
                            <DialogTitle className="flex items-center gap-2">
                              {getSeverityIcon(template.severity)}
                              {template.name}
                            </DialogTitle>
                          </DialogHeader>
                          {selectedTemplate && <TemplateDetailsForm template={selectedTemplate} onSubmit={handleCreateScenario} isLoading={createFromTemplateMutation.isPending} />}
                        </DialogContent>
                      </Dialog>
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </CardContent>
        </Card>
      )}

      {/* Template Library */}
      {/* Enhanced AI Suggestions Panel */}
      {showAiSuggestions && (
        <Card className="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 border-purple-200 dark:border-purple-700">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Brain className="h-5 w-5 text-purple-600" />
              AI-Powered Template Recommendations
              <Badge className="bg-purple-100 text-purple-700">Beta</Badge>
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <Card className="border-purple-200">
                <CardContent className="p-4">
                  <div className="flex items-center gap-2 mb-2">
                    <Wand2 className="h-4 w-4 text-purple-600" />
                    <span className="font-medium">Smart Suggestions</span>
                  </div>
                  <p className="text-sm text-gray-600">AI recommends templates based on your organization's risk profile</p>
                  <Button size="sm" className="mt-2 bg-purple-600 hover:bg-purple-700">
                    Generate Suggestions
                  </Button>
                </CardContent>
              </Card>
              <Card className="border-blue-200">
                <CardContent className="p-4">
                  <div className="flex items-center gap-2 mb-2">
                    <Building className="h-4 w-4 text-blue-600" />
                    <span className="font-medium">Industry Analysis</span>
                  </div>
                  <p className="text-sm text-gray-600">Templates optimized for your specific industry requirements</p>
                  <Button size="sm" variant="outline" className="mt-2 border-blue-300 text-blue-600">
                    Analyze Industry
                  </Button>
                </CardContent>
              </Card>
              <Card className="border-green-200">
                <CardContent className="p-4">
                  <div className="flex items-center gap-2 mb-2">
                    <Award className="h-4 w-4 text-green-600" />
                    <span className="font-medium">Compliance Check</span>
                  </div>
                  <p className="text-sm text-gray-600">Verify templates meet regulatory requirements</p>
                  <Button size="sm" variant="outline" className="mt-2 border-green-300 text-green-600">
                    Run Compliance
                  </Button>
                </CardContent>
              </Card>
            </div>
          </CardContent>
        </Card>
      )}

      <Card data-testid="template-library">
        <CardHeader>
          <div className="flex items-center justify-between">
            <div>
              <CardTitle className="flex items-center gap-2">
                Comprehensive Template Library
                <Badge variant="outline" className="bg-blue-50 text-blue-700">
                  {filteredTemplates.length} Templates
                </Badge>
              </CardTitle>
              <p className="text-sm text-gray-600 mt-1">
                Enterprise-grade starting templates with AI optimization and compliance frameworks. Customize and expand as you build YOUR playbooks.
              </p>
            </div>
            <Button 
              variant="outline" 
              size="sm"
              onClick={() => setShowAiSuggestions(!showAiSuggestions)}
              className="border-purple-300 text-purple-600 hover:bg-purple-50"
            >
              <Brain className="h-4 w-4 mr-1" />
              AI Assist
            </Button>
          </div>
        </CardHeader>
        <CardContent>
          {/* Enhanced Filtering Controls */}
          <div className="mb-6 space-y-4">
            {/* Simplified Strategic Category Tabs */}
            <div className="flex items-center justify-between gap-4">
              <Tabs value={selectedCategory} onValueChange={setSelectedCategory} className="flex-1">
                <TabsList className="grid w-full grid-cols-4" data-testid="template-category-tabs">
                  <TabsTrigger value="all">All Playbooks</TabsTrigger>
                  <TabsTrigger value="risk-security">Risk & Security</TabsTrigger>
                  <TabsTrigger value="operations">Operations & Growth</TabsTrigger>
                  <TabsTrigger value="financial">Financial & Tech</TabsTrigger>
                </TabsList>
              </Tabs>
              
              <Button 
                variant="outline" 
                size="sm"
                onClick={() => setShowAdvancedFilters(!showAdvancedFilters)}
                className="flex-shrink-0"
              >
                <Filter className="h-4 w-4 mr-2" />
                {showAdvancedFilters ? 'Hide Filters' : 'Refine Templates'}
              </Button>
            </div>

            {/* Collapsible Advanced Filters */}
            {showAdvancedFilters && (
              <div className="flex items-center justify-between bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                <div className="flex items-center gap-4 flex-wrap">
                  <div>
                    <Label className="text-xs text-gray-600 dark:text-gray-400">Industry</Label>
                    <Select value={selectedIndustry} onValueChange={setSelectedIndustry}>
                      <SelectTrigger className="w-40">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="all">All Industries</SelectItem>
                        <SelectItem value="Technology">Technology</SelectItem>
                        <SelectItem value="Financial Services">Financial Services</SelectItem>
                        <SelectItem value="Manufacturing">Manufacturing</SelectItem>
                        <SelectItem value="Healthcare">Healthcare</SelectItem>
                        <SelectItem value="Retail">Retail</SelectItem>
                        <SelectItem value="Energy">Energy</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  <div>
                    <Label className="text-xs text-gray-600 dark:text-gray-400">Compliance</Label>
                    <Select value={filterCompliance} onValueChange={setFilterCompliance}>
                      <SelectTrigger className="w-32">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="all">All</SelectItem>
                        <SelectItem value="SOX">SOX</SelectItem>
                        <SelectItem value="ISO 27001">ISO 27001</SelectItem>
                        <SelectItem value="GDPR">GDPR</SelectItem>
                        <SelectItem value="HIPAA">HIPAA</SelectItem>
                        <SelectItem value="PCI DSS">PCI DSS</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>

                  <div>
                    <Label className="text-xs text-gray-600 dark:text-gray-400">Sort by</Label>
                    <Select value={sortBy} onValueChange={setSortBy}>
                      <SelectTrigger className="w-40">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="effectiveness">Effectiveness</SelectItem>
                        <SelectItem value="usage">Usage Count</SelectItem>
                        <SelectItem value="rating">User Rating</SelectItem>
                        <SelectItem value="recent">Recently Updated</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  <Button variant="outline" size="sm" className="mt-5">
                    <Bookmark className="h-4 w-4 mr-1" />
                    Favorites
                  </Button>
                </div>
              </div>
            )}
          </div>

          <Tabs value={selectedCategory} onValueChange={setSelectedCategory}>
            <TabsContent value={selectedCategory}>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {filteredTemplates.map((template: any) => (
                  <Card key={template.id} className="hover:shadow-lg transition-all duration-200 relative" data-testid={`template-card-${template.id}`}>
                    {/* Certification Badge */}
                    {template.certificationLevel === 'certified' && (
                      <div className="absolute -top-2 -right-2 z-10">
                        <Badge className="bg-gold-500 text-white border-gold-600">
                          <Award className="h-3 w-3 mr-1" />
                          Certified
                        </Badge>
                      </div>
                    )}
                    
                    <CardHeader>
                      <div className="flex items-center justify-between">
                        <CardTitle className="text-lg flex items-center gap-2">
                          {getCategoryIcon(template.category)}
                          {template.name}
                          {template.aiGenerated && (
                            <Badge variant="outline" className="text-xs bg-purple-50 text-purple-600">
                              <Brain className="h-3 w-3 mr-1" />
                              AI
                            </Badge>
                          )}
                        </CardTitle>
                        <div className="flex items-center gap-1">
                          {getSeverityIcon(template.severity)}
                          <div className="flex items-center text-xs text-yellow-500">
                            <Star className="h-3 w-3 fill-current" />
                            <span className="ml-1">{template.effectiveness.userRating.toFixed(1)}</span>
                          </div>
                        </div>
                      </div>
                      
                      <div className="flex items-center gap-2 mt-2">
                        <Badge variant="outline" className="w-fit text-xs">
                          {template.category.replace('-', ' ')}
                        </Badge>
                        <Badge variant="secondary" className="w-fit text-xs">
                          {template.industry}
                        </Badge>
                        {template.complianceFrameworks && template.complianceFrameworks.length > 0 && (
                          <Badge variant="outline" className="w-fit text-xs border-green-300 text-green-600">
                            <Gavel className="h-3 w-3 mr-1" />
                            {template.complianceFrameworks[0]}
                          </Badge>
                        )}
                      </div>
                    </CardHeader>
                    <CardContent>
                      <p className="text-gray-600 dark:text-gray-400 text-sm mb-4">{template.description}</p>
                      
                      {/* Effectiveness Metrics */}
                      <div className="mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                        <div className="grid grid-cols-3 gap-2 text-xs">
                          <div className="text-center">
                            <div className="font-medium text-blue-600">{template.effectiveness.usageCount}</div>
                            <div className="text-gray-500">Uses</div>
                          </div>
                          <div className="text-center">
                            <div className="font-medium text-green-600">{template.effectiveness.successRate}%</div>
                            <div className="text-gray-500">Success</div>
                          </div>
                          <div className="text-center">
                            <div className="font-medium text-purple-600">{template.effectiveness.avgResolutionTime}</div>
                            <div className="text-gray-500">Avg Time</div>
                          </div>
                        </div>
                      </div>

                      {/* AI Suggestions */}
                      {template.aiSuggestions && (
                        <div className="mb-4 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-700">
                          <div className="flex items-center justify-between mb-2">
                            <div className="flex items-center gap-1">
                              <Brain className="h-3 w-3 text-purple-600" />
                              <span className="text-xs font-medium text-purple-700">AI Insights</span>
                            </div>
                            <Badge variant="outline" className="text-xs border-purple-300 text-purple-600">
                              {template.aiSuggestions.confidence}%
                            </Badge>
                          </div>
                          <p className="text-xs text-purple-600 dark:text-purple-400">{template.aiSuggestions.reasoning}</p>
                        </div>
                      )}
                      
                      <div className="space-y-3">
                        <div className="flex items-center justify-between text-sm">
                          <span className="flex items-center gap-1">
                            <Clock className="h-4 w-4" />
                            Response Time:
                          </span>
                          <Badge variant="secondary">{template.typicalTimeframe}</Badge>
                        </div>
                        
                        <div className="text-sm">
                          <div className="font-medium text-gray-900 dark:text-gray-100 mb-1">Key Decision Points:</div>
                          <ul className="text-gray-600 dark:text-gray-400 space-y-1">
                            {template.criticalDecisionPoints.slice(0, 2).map((point: string, index: number) => (
                              <li key={index} className="text-xs"> {point}</li>
                            ))}
                            {template.criticalDecisionPoints.length > 2 && (
                              <li className="text-xs text-gray-500">+{template.criticalDecisionPoints.length - 2} more</li>
                            )}
                          </ul>
                        </div>
                      </div>

                      <Dialog>
                        <DialogTrigger asChild>
                          <Button 
                            className="w-full mt-4" 
                            onClick={() => setSelectedTemplate(template)}
                            data-testid={`use-template-${template.id}`}
                          >
                            Use This Template
                          </Button>
                        </DialogTrigger>
                        <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
                          <DialogHeader>
                            <DialogTitle className="flex items-center gap-2">
                              {getCategoryIcon(template.category)}
                              {template.name}
                            </DialogTitle>
                          </DialogHeader>
                          {selectedTemplate && <TemplateDetailsForm template={selectedTemplate} onSubmit={handleCreateScenario} isLoading={createFromTemplateMutation.isPending} />}
                        </DialogContent>
                      </Dialog>
                    </CardContent>
                  </Card>
                ))}
              </div>
              
              {filteredTemplates.length === 0 && (
                <div className="text-center py-8 text-gray-500 dark:text-gray-400" data-testid="no-templates">
                  No templates found in this category
                </div>
              )}
            </TabsContent>
          </Tabs>
        </CardContent>
      </Card>
    </div>
  );
}

function TemplateDetailsForm({ template, onSubmit, isLoading }: {
  template: ComprehensiveScenarioTemplate;
  onSubmit: (formData: Record<string, any>) => void;
  isLoading: boolean;
}) {
  const [formData, setFormData] = useState<Record<string, any>>({});

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    onSubmit(formData); // Pass the collected form data
  };

  const updateFormData = (fieldName: string, value: any) => {
    setFormData(prev => ({ ...prev, [fieldName]: value }));
  };

  return (
    <div className="space-y-6" data-testid="template-details-form">
      {/* Template Overview */}
      <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
          <div>
            <div className="font-medium text-gray-900 dark:text-gray-100">Severity</div>
            <Badge variant={template.severity === 'severe' ? 'destructive' : 'secondary'}>
              {template.severity}
            </Badge>
          </div>
          <div>
            <div className="font-medium text-gray-900 dark:text-gray-100">Likelihood</div>
            <Badge variant="outline">{template.likelihood}</Badge>
          </div>
          <div>
            <div className="font-medium text-gray-900 dark:text-gray-100">Response Time</div>
            <Badge variant="secondary">{template.typicalTimeframe}</Badge>
          </div>
          <div>
            <div className="font-medium text-gray-900 dark:text-gray-100">Category</div>
            <Badge variant="outline">{template.category.replace('-', ' ')}</Badge>
          </div>
        </div>
      </div>

      {/* Response Phases */}
      <div>
        <h4 className="font-semibold text-gray-900 dark:text-gray-100 mb-3">Response Phases</h4>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {template.responsePhases.map((phase: any, index: number) => (
            <Card key={index} className="border-l-4 border-l-blue-500">
              <CardHeader className="pb-2">
                <CardTitle className="text-sm font-medium capitalize">{phase.phase}</CardTitle>
                <div className="text-xs text-gray-500">{phase.timeline}</div>
              </CardHeader>
              <CardContent className="pt-0">
                <div className="space-y-2 text-xs">
                  <div>
                    <div className="font-medium">Objectives:</div>
                    <ul className="text-gray-600 dark:text-gray-400">
                      {phase.objectives.slice(0, 2).map((obj: string, i: number) => (
                        <li key={i}> {obj}</li>
                      ))}
                    </ul>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </div>

      {/* Data Collection Form */}
      <form onSubmit={handleSubmit} className="space-y-4">
        {/* Basic Scenario Information */}
        <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
          <h4 className="font-semibold text-gray-900 dark:text-gray-100 mb-3">Basic Scenario Information</h4>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <Label htmlFor="scenario-name">Scenario Name</Label>
              <Input
                id="scenario-name"
                placeholder={`${template.name} - ${new Date().toLocaleDateString()}`}
                value={formData.name || ''}
                onChange={(e) => updateFormData('name', e.target.value)}
                data-testid="input-scenario-name"
              />
            </div>
            <div>
              <Label htmlFor="scenario-description">Scenario Description</Label>
              <Input
                id="scenario-description"
                placeholder="Describe the specific situation..."
                value={formData.description || ''}
                onChange={(e) => updateFormData('description', e.target.value)}
                data-testid="input-scenario-description"
              />
            </div>
          </div>
        </div>

        {/* Comprehensive Data Collection Fields */}
        <div className="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg">
          <div className="flex items-center justify-between mb-4">
            <h4 className="font-semibold text-gray-900 dark:text-gray-100 text-lg">
               Comprehensive Data Collection
            </h4>
            <Badge variant="outline" className="bg-green-100 text-green-800">
              {template.requiredDataPoints.length} Critical Fields
            </Badge>
          </div>
          <p className="text-sm text-gray-600 dark:text-gray-400 mb-6">
            Complete assessment requires detailed information across all relevant categories for executive decision-making
          </p>
          
          <div className="space-y-8">
            {/* Group fields by category */}
            {['situation', 'financial', 'resources', 'stakeholders', 'timeline', 'regulatory', 'organization'].map(category => {
              const categoryFields = template.requiredDataPoints.filter((field: any) => field.category === category);
              if (categoryFields.length === 0) return null;
              
              return (
                <div key={category} className="space-y-4">
                  <div className="flex items-center gap-2 pb-2 border-b border-gray-200 dark:border-gray-600">
                    <div className="w-3 h-3 rounded-full bg-blue-500"></div>
                    <h5 className="font-medium text-gray-900 dark:text-gray-100 capitalize">
                      {category.replace('-', ' ')} Information
                    </h5>
                    <Badge variant="secondary" className="text-xs">
                      {categoryFields.length} fields
                    </Badge>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {categoryFields.map((field: any) => (
                      <div key={field.fieldName} className="space-y-2">
                        <Label htmlFor={field.fieldName} className="flex items-center gap-1 font-medium">
                          {field.label}
                          {field.required && <span className="text-red-500">*</span>}
                        </Label>
                        {field.fieldType === 'select' ? (
                          <Select onValueChange={(value) => updateFormData(field.fieldName, value)} required={field.required}>
                            <SelectTrigger data-testid={`select-${field.fieldName}`} className="h-10">
                              <SelectValue placeholder={field.placeholder || `Select ${field.label}`} />
                            </SelectTrigger>
                            <SelectContent>
                              {field.options?.map((option: string) => (
                                <SelectItem key={option} value={option}>{option}</SelectItem>
                              ))}
                            </SelectContent>
                          </Select>
                        ) : field.fieldType === 'multiselect' ? (
                          <div className="space-y-2">
                            <div className="text-xs text-gray-600">Select all that apply:</div>
                            <div className="grid grid-cols-2 gap-2">
                              {field.options?.map((option: string) => (
                                <label key={option} className="flex items-center space-x-2">
                                  <input
                                    type="checkbox"
                                    className="rounded"
                                    onChange={(e) => {
                                      const current = formData[field.fieldName] || [];
                                      if (e.target.checked) {
                                        updateFormData(field.fieldName, [...current, option]);
                                      } else {
                                        updateFormData(field.fieldName, current.filter((item: string) => item !== option));
                                      }
                                    }}
                                  />
                                  <span className="text-sm">{option}</span>
                                </label>
                              ))}
                            </div>
                          </div>
                        ) : field.fieldType === 'textarea' ? (
                          <Textarea
                            id={field.fieldName}
                            placeholder={field.placeholder || `Enter ${field.label.toLowerCase()}...`}
                            required={field.required}
                            value={formData[field.fieldName] || ''}
                            onChange={(e) => updateFormData(field.fieldName, e.target.value)}
                            data-testid={`textarea-${field.fieldName}`}
                            rows={3}
                          />
                        ) : field.fieldType === 'currency' ? (
                          <div className="relative">
                            <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                            <Input
                              id={field.fieldName}
                              type="number"
                              placeholder={field.placeholder || "0.00"}
                              required={field.required}
                              value={formData[field.fieldName] || ''}
                              onChange={(e) => updateFormData(field.fieldName, e.target.value)}
                              data-testid={`input-${field.fieldName}`}
                              className="pl-8"
                            />
                          </div>
                        ) : field.fieldType === 'percentage' ? (
                          <div className="relative">
                            <Input
                              id={field.fieldName}
                              type="number"
                              min="0"
                              max="100"
                              placeholder={field.placeholder || "0"}
                              required={field.required}
                              value={formData[field.fieldName] || ''}
                              onChange={(e) => updateFormData(field.fieldName, e.target.value)}
                              data-testid={`input-${field.fieldName}`}
                              className="pr-8"
                            />
                            <span className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">%</span>
                          </div>
                        ) : (
                          <Input
                            id={field.fieldName}
                            type={field.fieldType}
                            placeholder={field.placeholder || `Enter ${field.label.toLowerCase()}...`}
                            required={field.required}
                            value={formData[field.fieldName] || ''}
                            onChange={(e) => updateFormData(field.fieldName, e.target.value)}
                            data-testid={`input-${field.fieldName}`}
                          />
                        )}
                        {field.helpText && (
                          <p className="text-xs text-blue-600 dark:text-blue-400 mt-1"> {field.helpText}</p>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              );
            })}
          </div>
        </div>

        {/* Critical Decision Points */}
        <div>
          <h4 className="font-semibold text-gray-900 dark:text-gray-100 mb-3">Critical Decision Points</h4>
          <div className="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
            <ul className="space-y-2">
              {template.criticalDecisionPoints.map((point, index) => (
                <li key={index} className="flex items-center gap-2 text-sm">
                  <AlertTriangle className="h-4 w-4 text-yellow-600" />
                  {point}
                </li>
              ))}
            </ul>
          </div>
        </div>

        {/* Stakeholder Mapping */}
        <div>
          <h4 className="font-semibold text-gray-900 dark:text-gray-100 mb-3">Key Stakeholders</h4>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {template.stakeholderMapping.slice(0, 4).map((stakeholder: any, index: number) => (
              <Card key={index} className="bg-blue-50 dark:bg-blue-900/20">
                <CardContent className="p-3">
                  <div className="flex items-center justify-between mb-2">
                    <div className="font-medium text-sm">{stakeholder.role}</div>
                    <Badge variant={stakeholder.decisionAuthority === 'critical' ? 'destructive' : 'secondary'} className="text-xs">
                      {stakeholder.decisionAuthority}
                    </Badge>
                  </div>
                  <div className="text-xs text-gray-600 dark:text-gray-400">
                    {stakeholder.department}  {stakeholder.communicationPriority}
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </div>

        {/* Action Buttons */}
        <div className="flex items-center justify-between pt-4 border-t">
          <div className="text-sm text-gray-500">
            This will create a strategic scenario based on the template
          </div>
          <Button 
            type="submit" 
            disabled={isLoading}
            className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700"
            data-testid="button-create-scenario"
          >
            {isLoading ? 'Creating Scenario...' : 'Create Strategic Scenario'}
          </Button>
        </div>
      </form>
    </div>
  );
}

========================================
FILE: client/src/components/ScrollToTop.tsx
========================================
import { useEffect } from "react";
import { useLocation } from "wouter";

export function ScrollToTop() {
  const [location] = useLocation();

  useEffect(() => {
    window.scrollTo(0, 0);
  }, [location]);

  return null;
}


========================================
FILE: client/src/components/Sidebar.tsx
========================================
/**
 * @deprecated Use PageLayout instead which includes an integrated sidebar.
 * This component is kept for backwards compatibility but should not be used in new pages.
 */
import { useAuth } from "@/hooks/useAuth";
import { Button } from "@/components/ui/button";

export default function Sidebar() {
  const { user } = useAuth();

  const handleLogout = () => {
    window.location.href = "/api/logout";
  };

  return (
    <aside className="w-64 bg-card border-r border-border flex flex-col">
      <div className="p-6 border-b border-border">
        <div className="flex items-center space-x-3">
          <div className="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
            <i className="fas fa-bolt text-primary-foreground text-sm"></i>
          </div>
          <h1 className="text-xl font-bold text-foreground">M</h1>
        </div>
        <p className="text-sm text-muted-foreground mt-1">Command Every Decision.</p>
      </div>
      
      <nav className="flex-1 p-4 space-y-2">
        <a 
          href="#" 
          className="flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium bg-accent text-accent-foreground"
          data-testid="nav-dashboard"
        >
          <i className="fas fa-chart-line w-5"></i>
          <span>Dashboard</span>
        </a>
        <a 
          href="#" 
          className="flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent"
          data-testid="nav-organizations"
        >
          <i className="fas fa-building w-5"></i>
          <span>Organizations</span>
        </a>
        <a 
          href="#" 
          className="flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent"
          data-testid="nav-scenarios"
        >
          <i className="fas fa-lightbulb w-5"></i>
          <span>Strategic Scenarios</span>
        </a>
        <a 
          href="#" 
          className="flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent"
          data-testid="nav-tasks"
        >
          <i className="fas fa-tasks w-5"></i>
          <span>Task Management</span>
        </a>
        <a 
          href="#" 
          className="flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent"
          data-testid="nav-ai"
        >
          <i className="fas fa-robot w-5"></i>
          <span>AI Co-pilot</span>
        </a>
        <a 
          href="#" 
          className="flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent"
          data-testid="nav-team"
        >
          <i className="fas fa-users w-5"></i>
          <span>Team Members</span>
        </a>
      </nav>
      
      <div className="p-4 border-t border-border">
        <div className="flex items-center space-x-3">
          <div className="w-8 h-8 bg-muted rounded-full flex items-center justify-center">
            <span className="text-sm font-medium text-muted-foreground" data-testid="text-user-initials">
              {user?.initials || 'U'}
            </span>
          </div>
          <div className="flex-1 min-w-0">
            <p className="text-sm font-medium text-foreground truncate" data-testid="text-user-name">
              {user?.firstName} {user?.lastName}
            </p>
            <p className="text-xs text-muted-foreground" data-testid="text-user-role">
              {user?.role || 'User'}
            </p>
          </div>
          <Button
            variant="ghost"
            size="sm"
            onClick={handleLogout}
            className="text-muted-foreground hover:text-foreground p-1"
            data-testid="button-logout"
          >
            <i className="fas fa-sign-out-alt w-4"></i>
          </Button>
        </div>
      </div>
    </aside>
  );
}


========================================
FILE: client/src/components/SimulatorControlPanel.tsx
========================================
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { useDynamicStrategySimulator } from '@/hooks/useDynamicStrategySimulator';
import { Play, Pause, Zap, Activity, Brain, TrendingUp, Target } from 'lucide-react';

export function SimulatorControlPanel() {
  const { isRunning, status, start, stop, launchScenario } = useDynamicStrategySimulator();

  const scenarios = [
    { id: 'ransomware', name: 'Ransomware Response', icon: '' },
    { id: 'ma_integration', name: 'M&A Integration', icon: '' },
    { id: 'supply_crisis', name: 'Supply Chain Crisis', icon: '' },
    { id: 'product_launch', name: 'Product Launch', icon: '' }
  ];

  return (
    <Card className="border-2 border-blue-200 dark:border-blue-800 bg-gradient-to-br from-blue-50/50 to-purple-50/50 dark:from-blue-950/20 dark:to-purple-950/20">
      <CardHeader>
        <div className="flex items-center justify-between">
          <div>
            <CardTitle className="flex items-center gap-2">
              <Brain className="h-5 w-5 text-blue-600" />
              Dynamic Strategy Simulator
            </CardTitle>
            <CardDescription>
              Real-time automation: weak signals, patterns, continuous operations
            </CardDescription>
          </div>
          <div className="flex items-center gap-2">
            {isRunning ? (
              <>
                <div className="relative flex h-3 w-3">
                  <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                  <span className="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                </div>
                <Badge variant="default" className="bg-green-600">ACTIVE</Badge>
                <Button
                  onClick={stop}
                  variant="outline"
                  size="sm"
                  data-testid="btn-stop-simulator"
                >
                  <Pause className="h-4 w-4 mr-1" />
                  Stop
                </Button>
              </>
            ) : (
              <Button
                onClick={start}
                variant="default"
                size="sm"
                className="bg-blue-600 hover:bg-blue-700"
                data-testid="btn-start-simulator"
              >
                <Play className="h-4 w-4 mr-1" />
                Start Simulator
              </Button>
            )}
          </div>
        </div>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
          <div className="p-3 rounded-lg bg-white/50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700">
            <div className="flex items-center gap-2 mb-1">
              <Zap className="h-4 w-4 text-emerald-600" />
              <div className="text-xs text-muted-foreground">Readiness</div>
            </div>
            <div className="text-xl font-bold text-emerald-600">
              {status.readinessScore.toFixed(1)}%
            </div>
          </div>

          <div className="p-3 rounded-lg bg-white/50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700">
            <div className="flex items-center gap-2 mb-1">
              <Activity className="h-4 w-4 text-amber-600" />
              <div className="text-xs text-muted-foreground">Weak Signals</div>
            </div>
            <div className="text-xl font-bold text-amber-600">
              {status.weakSignals}
            </div>
          </div>

          <div className="p-3 rounded-lg bg-white/50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700">
            <div className="flex items-center gap-2 mb-1">
              <Brain className="h-4 w-4 text-purple-600" />
              <div className="text-xs text-muted-foreground">Patterns</div>
            </div>
            <div className="text-xl font-bold text-purple-600">
              {status.oraclePatterns}
            </div>
          </div>

          <div className="p-3 rounded-lg bg-white/50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700">
            <div className="flex items-center gap-2 mb-1">
              <Target className="h-4 w-4 text-blue-600" />
              <div className="text-xs text-muted-foreground">Scenarios</div>
            </div>
            <div className="text-xl font-bold text-blue-600">
              {status.activeScenarios}
            </div>
          </div>

          <div className="p-3 rounded-lg bg-white/50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700">
            <div className="flex items-center gap-2 mb-1">
              <TrendingUp className="h-4 w-4 text-green-600" />
              <div className="text-xs text-muted-foreground">Continuous</div>
            </div>
            <div className="text-xl font-bold text-green-600">
              {status.continuousMode ? 'ON' : 'OFF'}
            </div>
          </div>
        </div>

        {isRunning && (
          <div>
            <div className="text-sm font-medium mb-3">Quick Launch Scenarios:</div>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
              {scenarios.map(scenario => (
                <Button
                  key={scenario.id}
                  onClick={() => launchScenario(scenario.id, scenario.name)}
                  variant="outline"
                  size="sm"
                  className="justify-start"
                  data-testid={`btn-launch-${scenario.id}`}
                >
                  <span className="mr-2">{scenario.icon}</span>
                  {scenario.name}
                </Button>
              ))}
            </div>
          </div>
        )}

        {isRunning && (
          <div className="mt-4 p-3 rounded-lg bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800">
            <div className="flex items-start gap-2">
              <Activity className="h-4 w-4 text-blue-600 mt-0.5" />
              <div className="text-xs text-blue-900 dark:text-blue-100">
                <strong>Automation Active:</strong> The system is now detecting weak signals every 5 seconds, 
                scanning for Oracle patterns every 30 seconds, and updating readiness metrics in real-time. 
                Activity feed is being populated automatically.
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/StakeholderAlignmentDashboard.tsx
========================================
import { useQuery, useMutation } from "@tanstack/react-query";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Progress } from "@/components/ui/progress";
import { 
  Users, 
  CheckCircle2, 
  Clock, 
  Send,
  User,
  Mail,
  AlertCircle
} from "lucide-react";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { Link } from "wouter";

interface StakeholderAlignmentData {
  id: string;
  stakeholderName: string;
  stakeholderRole: string;
  stakeholderEmail: string;
  notificationMethod: string;
  acknowledged: boolean;
  acknowledgedAt: Date | null;
  tasksAssigned: number;
  tasksCompleted: number;
  responseTime: number | null;
  status: string;
  priority: string;
}

interface StakeholderAlignmentDashboardProps {
  scenarioId: string;
  executionId?: string;
}

export default function StakeholderAlignmentDashboard({ 
  scenarioId, 
  executionId 
}: StakeholderAlignmentDashboardProps) {
  const { data: alignmentData = [], isLoading } = useQuery<StakeholderAlignmentData[]>({
    queryKey: ['/api/stakeholder-alignment', scenarioId, executionId],
    enabled: !!scenarioId,
  });

  const createAlignmentMutation = useMutation({
    mutationFn: async (data: any) => {
      return await apiRequest('POST', `/api/stakeholder-alignment`, data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/stakeholder-alignment', scenarioId] });
    },
  });

  const updateAlignmentMutation = useMutation({
    mutationFn: async ({ id, ...data }: any) => {
      return await apiRequest('PUT', `/api/stakeholder-alignment/${id}`, data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/stakeholder-alignment', scenarioId] });
    },
  });

  // Note: Stakeholder data now comes from organization configuration
  // Users should configure stakeholders in Organization Setup before activating playbooks

  if (isLoading) {
    return null;
  }

  if (!alignmentData || alignmentData.length === 0) {
    return (
      <Card className="border-dashed border-2 border-slate-700 bg-slate-900/50" data-testid="stakeholder-alignment-empty">
        <CardContent className="flex flex-col items-center justify-center py-8 text-center">
          <div className="w-12 h-12 rounded-full bg-purple-500/10 flex items-center justify-center mb-4">
            <AlertCircle className="h-6 w-6 text-purple-500" />
          </div>
          <h3 className="text-lg font-semibold text-white mb-2">
            No Stakeholders Assigned
          </h3>
          <p className="text-slate-400 mb-4 max-w-sm">
            Configure your organization's stakeholders to enable alignment tracking during playbook execution.
          </p>
          <Link href="/organization-setup">
            <Button className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700">
              Configure Stakeholders
            </Button>
          </Link>
        </CardContent>
      </Card>
    );
  }

  const safeAlignmentData = alignmentData || [];
  const acknowledgedCount = safeAlignmentData.filter((s: any) => s.acknowledged).length;
  const totalCount = safeAlignmentData.length;
  const alignmentPercentage = totalCount > 0 ? Math.round((acknowledgedCount / totalCount) * 100) : 0;

  const totalTasks = safeAlignmentData.reduce((sum: number, s: any) => sum + (s.tasksAssigned || 0), 0);
  const completedTasks = safeAlignmentData.reduce((sum: number, s: any) => sum + (s.tasksCompleted || 0), 0);
  const taskProgress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

  return (
    <Card data-testid="stakeholder-alignment-card">
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="flex items-center gap-2">
            <Users className="h-5 w-5 text-purple-600" />
            Who's On Board?
          </CardTitle>
          <div className="flex items-center gap-4">
            <div className="text-center">
              <div className="text-2xl font-bold text-purple-600" data-testid="alignment-percentage">
                {alignmentPercentage}%
              </div>
              <div className="text-xs text-gray-600 dark:text-gray-400">Acknowledged</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold text-blue-600" data-testid="task-progress-percentage">
                {taskProgress}%
              </div>
              <div className="text-xs text-gray-600 dark:text-gray-400">Tasks Complete</div>
            </div>
          </div>
        </div>
      </CardHeader>
      <CardContent>
        <div className="space-y-3">
          {safeAlignmentData.map((stakeholder: any, idx: number) => (
            <div 
              key={stakeholder.id} 
              className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"
              data-testid={`stakeholder-item-${idx}`}
            >
              <div className="flex items-center gap-3 flex-1">
                <div className={`p-2 rounded-full ${
                  stakeholder.acknowledged 
                    ? 'bg-green-100 dark:bg-green-900' 
                    : 'bg-gray-200 dark:bg-gray-700'
                }`}>
                  <User className={`h-4 w-4 ${
                    stakeholder.acknowledged 
                      ? 'text-green-600' 
                      : 'text-gray-400'
                  }`} />
                </div>
                <div className="flex-1">
                  <div className="flex items-center gap-2">
                    <span className="font-semibold" data-testid={`stakeholder-name-${idx}`}>
                      {stakeholder.stakeholderName}
                    </span>
                    <Badge 
                      variant={stakeholder.priority === 'critical' ? 'destructive' : 'secondary'}
                      className="text-xs"
                      data-testid={`stakeholder-priority-${idx}`}
                    >
                      {stakeholder.priority}
                    </Badge>
                  </div>
                  <div className="text-sm text-gray-600 dark:text-gray-400" data-testid={`stakeholder-role-${idx}`}>
                    {stakeholder.stakeholderRole}
                  </div>
                  {stakeholder.tasksAssigned > 0 && (
                    <div className="flex items-center gap-2 mt-1">
                      <Progress 
                        value={(stakeholder.tasksCompleted / stakeholder.tasksAssigned) * 100} 
                        className="h-1.5 w-24" 
                      />
                      <span className="text-xs text-gray-500" data-testid={`stakeholder-tasks-${idx}`}>
                        {stakeholder.tasksCompleted}/{stakeholder.tasksAssigned} tasks
                      </span>
                    </div>
                  )}
                </div>
              </div>
              <div className="flex items-center gap-2">
                {stakeholder.acknowledged ? (
                  <div className="flex items-center gap-2" data-testid={`stakeholder-acknowledged-${idx}`}>
                    <CheckCircle2 className="h-5 w-5 text-green-600" />
                    <div className="text-right">
                      <div className="text-sm font-semibold text-green-600">Acknowledged</div>
                      {stakeholder.responseTime && (
                        <div className="text-xs text-gray-500">{stakeholder.responseTime}min response</div>
                      )}
                    </div>
                  </div>
                ) : (
                  <div className="flex items-center gap-2" data-testid={`stakeholder-pending-${idx}`}>
                    <Clock className="h-5 w-5 text-gray-400" />
                    <div className="text-right">
                      <div className="text-sm font-semibold text-gray-600 dark:text-gray-400">Pending</div>
                      <Button 
                        variant="ghost" 
                        size="sm" 
                        className="h-6 text-xs"
                        data-testid={`resend-notification-${idx}`}
                      >
                        <Send className="h-3 w-3 mr-1" />
                        Resend
                      </Button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>

        <div className="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
          <div className="flex items-center gap-2 text-sm">
            <Mail className="h-4 w-4 text-blue-600" />
            <span className="text-blue-900 dark:text-blue-100">
              <strong>{acknowledgedCount}</strong> of <strong>{totalCount}</strong> executives ready
              {taskProgress > 0 && (
                <>  <strong>{completedTasks}</strong> of <strong>{totalTasks}</strong> tasks done</>
              )}
            </span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/StrategicInsightsPanel.tsx
========================================
import { useState, useEffect } from "react";
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Brain, TrendingUp, AlertTriangle, Lightbulb, Eye } from "lucide-react";

interface PrismInsight {
  id: string;
  insightType: string;
  title: string;
  content: string;
  confidence: string;
  createdAt: string;
  sources?: any;
}

export default function StrategicInsightsPanel() {
  const [organizationId, setOrganizationId] = useState<string | null>(null);

  const { data: organizations } = useQuery({
    queryKey: ["/api/organizations"],
    enabled: true
  });

  useEffect(() => {
    if (organizations && Array.isArray(organizations) && organizations.length > 0) {
      setOrganizationId(organizations[0].id);
    }
  }, [organizations]);

  const { data: insights, isLoading } = useQuery({
    queryKey: [`/api/prism-insights/${organizationId}/latest`],
    enabled: !!organizationId
  });

  const getInsightIcon = (type: string) => {
    switch (type.toLowerCase()) {
      case 'strategic opportunity': return <TrendingUp className="h-4 w-4" />;
      case 'risk assessment': return <AlertTriangle className="h-4 w-4" />;
      case 'innovation catalyst': return <Lightbulb className="h-4 w-4" />;
      case 'market intelligence': return <Eye className="h-4 w-4" />;
      default: return <Brain className="h-4 w-4" />;
    }
  };

  const getInsightColor = (type: string) => {
    switch (type.toLowerCase()) {
      case 'strategic opportunity': return "bg-green-50 text-green-700 border-green-200";
      case 'risk assessment': return "bg-red-50 text-red-700 border-red-200";
      case 'innovation catalyst': return "bg-purple-50 text-purple-700 border-purple-200";
      case 'market intelligence': return "bg-blue-50 text-blue-700 border-blue-200";
      default: return "bg-gray-50 text-gray-700 border-gray-200";
    }
  };

  const getConfidenceColor = (confidence: number) => {
    if (confidence >= 0.8) return "bg-green-100 text-green-800";
    if (confidence >= 0.6) return "bg-yellow-100 text-yellow-800";
    return "bg-red-100 text-red-800";
  };

  if (isLoading) {
    return (
      <Card data-testid="strategic-insights-panel" className="h-96">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Brain className="h-5 w-5" />
            Strategic Insights
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {[1, 2, 3].map(i => (
              <div key={i} className="animate-pulse">
                <div className="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div className="h-16 bg-gray-200 rounded w-full"></div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card data-testid="strategic-insights-panel" className="h-96">
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Brain className="h-5 w-5" />
          Strategic Insights
        </CardTitle>
        <CardDescription>
          AI-powered strategic intelligence and recommendations
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        {insights && Array.isArray(insights) && insights.length > 0 ? (
          <div className="space-y-3 max-h-72 overflow-y-auto">
            {insights.slice(0, 3).map((insight: PrismInsight) => {
              const confidence = parseFloat(insight.confidence);
              
              return (
                <div 
                  key={insight.id} 
                  className={`p-3 rounded-lg border ${getInsightColor(insight.insightType)}`}
                  data-testid={`insight-${insight.insightType.replace(/\s+/g, '-').toLowerCase()}`}
                >
                  <div className="flex items-start justify-between mb-2">
                    <div className="flex items-center gap-2">
                      {getInsightIcon(insight.insightType)}
                      <span className="font-medium text-sm" data-testid={`insight-title-${insight.id}`}>
                        {insight.title}
                      </span>
                    </div>
                    <Badge 
                      variant="secondary" 
                      className={`text-xs ${getConfidenceColor(confidence)}`}
                      data-testid={`confidence-${insight.id}`}
                    >
                      {(confidence * 100).toFixed(0)}%
                    </Badge>
                  </div>
                  <p className="text-xs text-muted-foreground leading-relaxed" data-testid={`insight-content-${insight.id}`}>
                    {insight.content.length > 150 
                      ? `${insight.content.substring(0, 150)}...` 
                      : insight.content
                    }
                  </p>
                  <div className="flex items-center justify-between mt-2">
                    <Badge variant="outline" className="text-xs" data-testid={`insight-type-${insight.id}`}>
                      {insight.insightType}
                    </Badge>
                  </div>
                </div>
              );
            })}
          </div>
        ) : (
          <div className="text-center py-8">
            <Brain className="h-12 w-12 mx-auto text-muted-foreground mb-4" />
            <p className="text-muted-foreground">No strategic insights available</p>
            <p className="text-sm text-muted-foreground mt-1">
              AI analysis will generate insights as data is processed
            </p>
          </div>
        )}
        
        {insights && Array.isArray(insights) && insights.length > 0 && (
          <div className="pt-4 border-t">
            <Button variant="outline" size="sm" className="w-full" data-testid="view-all-insights">
              View All Insights
            </Button>
          </div>
        )}
      </CardContent>
    </Card>
  );
}

========================================
FILE: client/src/components/TaskPanel.tsx
========================================
import { useQuery, useMutation } from "@tanstack/react-query";
import { api, type Task } from "@/lib/api";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader } from "@/components/ui/card";
import { Checkbox } from "@/components/ui/checkbox";
import { queryClient } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";
import { isUnauthorizedError } from "@/lib/authUtils";

export default function TaskPanel() {
  const { toast } = useToast();
  
  const { data: tasks, isLoading } = useQuery<Task[]>({
    queryKey: ["/api/tasks/priority"],
    queryFn: () => api.getPriorityTasks(),
  });

  const updateTaskMutation = useMutation({
    mutationFn: ({ taskId, completed }: { taskId: string; completed: boolean }) =>
      api.updateTaskStatus(taskId, completed),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/tasks/priority"] });
      queryClient.invalidateQueries({ queryKey: ["/api/activities/recent"] });
      queryClient.invalidateQueries({ queryKey: ["/api/dashboard/metrics"] });
    },
    onError: (error) => {
      if (isUnauthorizedError(error)) {
        toast({
          title: "Unauthorized",
          description: "You are logged out. Logging in again...",
          variant: "destructive",
        });
        setTimeout(() => {
          window.location.href = "/api/login";
        }, 500);
        return;
      }
      toast({
        title: "Error",
        description: "Failed to update task",
        variant: "destructive",
      });
    },
  });

  const getPriorityColor = (priority: string) => {
    switch (priority.toLowerCase()) {
      case 'high': return 'bg-red-100 text-red-800';
      case 'medium': return 'bg-orange-100 text-orange-800';
      case 'low': return 'bg-blue-100 text-blue-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const getDueStatus = (dueDate?: string, completed?: string) => {
    if (completed) return 'Completed';
    if (!dueDate) return '';
    
    const due = new Date(dueDate);
    const now = new Date();
    const diffInDays = Math.ceil((due.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));
    
    if (diffInDays < 0) return 'Overdue';
    if (diffInDays === 0) return 'Due today';
    if (diffInDays === 1) return 'Due tomorrow';
    return `Due in ${diffInDays} days`;
  };

  const handleTaskToggle = (taskId: string, completed: boolean) => {
    updateTaskMutation.mutate({ taskId, completed });
  };

  return (
    <Card>
      <CardHeader className="border-b border-border">
        <div className="flex items-center justify-between">
          <h3 className="text-lg font-semibold text-foreground">Priority Tasks</h3>
          <Button 
            variant="ghost" 
            size="sm"
            className="text-primary hover:text-primary/80"
            data-testid="button-view-all-tasks"
          >
            View All
          </Button>
        </div>
      </CardHeader>
      
      <CardContent className="p-6 space-y-3">
        {isLoading ? (
          <div className="space-y-3">
            {[...Array(4)].map((_, i) => (
              <div key={i} className="animate-pulse flex items-center space-x-3 p-3 rounded-lg border border-border">
                <div className="w-4 h-4 bg-muted rounded"></div>
                <div className="flex-1 space-y-2">
                  <div className="h-4 bg-muted rounded w-3/4"></div>
                  <div className="h-3 bg-muted rounded w-1/2"></div>
                </div>
              </div>
            ))}
          </div>
        ) : tasks?.length === 0 ? (
          <div className="text-center py-8">
            <i className="fas fa-tasks text-muted-foreground text-3xl mb-4"></i>
            <p className="text-muted-foreground">No priority tasks</p>
          </div>
        ) : (
          tasks?.map((task, index) => (
            <div 
              key={task.id} 
              className="flex items-center space-x-3 p-3 rounded-lg border border-border"
              data-testid={`task-${index}`}
            >
              <Checkbox
                checked={task.status === 'Completed'}
                onCheckedChange={(checked) => handleTaskToggle(task.id, !!checked)}
                disabled={updateTaskMutation.isPending}
                data-testid={`checkbox-task-${index}`}
              />
              <div className="flex-1 min-w-0">
                <p 
                  className={`text-sm font-medium ${task.status === 'Completed' ? 'text-muted-foreground line-through' : 'text-foreground'}`}
                  data-testid={`text-task-description-${index}`}
                >
                  {task.description}
                </p>
                <div className="flex items-center space-x-2 mt-1">
                  <span className={`px-2 py-1 text-xs rounded-full ${
                    task.status === 'Completed' 
                      ? 'bg-green-100 text-green-800' 
                      : getPriorityColor(task.priority)
                  }`}>
                    {task.status === 'Completed' ? 'Completed' : task.priority}
                  </span>
                  <span className="text-xs text-muted-foreground" data-testid={`text-task-due-${index}`}>
                    {getDueStatus(task.dueDate, task.completed)}
                  </span>
                </div>
              </div>
            </div>
          ))
        )}
        
        <Button 
          variant="secondary" 
          className="w-full mt-4"
          data-testid="button-add-task"
        >
          <i className="fas fa-plus w-4 mr-2"></i>
          Add New Task
        </Button>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/ThemeProvider.tsx
========================================
import { ReactNode, useEffect, useState } from 'react';

interface ThemeProviderProps {
  children: ReactNode;
}

export function ThemeProvider({ children }: ThemeProviderProps) {
  const [theme, setTheme] = useState<'light' | 'dark'>('light');

  useEffect(() => {
    // Load theme from localStorage or system preference
    const stored = localStorage.getItem('m-theme') as 'light' | 'dark' | null;
    if (stored) {
      setTheme(stored);
      applyTheme(stored);
    } else {
      // Check system preference
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const initial = prefersDark ? 'dark' : 'light';
      setTheme(initial);
      applyTheme(initial);
    }
  }, []);

  const applyTheme = (t: 'light' | 'dark') => {
    const html = document.documentElement;
    if (t === 'dark') {
      html.classList.add('dark');
    } else {
      html.classList.remove('dark');
    }
  };

  const toggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
    applyTheme(newTheme);
    localStorage.setItem('m-theme', newTheme);
  };

  return (
    <>
      {children}
      <div className="fixed bottom-4 right-4 z-40" data-testid="theme-provider-context">
        <input
          type="hidden"
          value={theme}
          onChange={(e) => {
            const t = e.target.value as 'light' | 'dark';
            toggleTheme();
          }}
          data-testid="theme-context-value"
        />
      </div>
      {/* Make theme toggle available globally */}
      <script>
        {`window.__toggleTheme = () => {
          const html = document.documentElement;
          const current = html.classList.contains('dark') ? 'dark' : 'light';
          const next = current === 'dark' ? 'light' : 'dark';
          html.classList.toggle('dark');
          localStorage.setItem('m-theme', next);
        }`}
      </script>
    </>
  );
}


========================================
FILE: client/src/components/playbook/FourPhasePlaybookWizard.tsx
========================================
import { useState, useEffect } from 'react';
import { useMutation, useQuery } from '@tanstack/react-query';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';
import { 
  ChevronLeft, ChevronRight, Check, Lightbulb, 
  Target, Radar, Zap, BookOpen, Shield,
  Users, FileText, DollarSign, Bell, Eye, 
  CheckCircle2, Clock, AlertTriangle, Settings
} from 'lucide-react';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';

import SituationDefinitionStep from './wizard/SituationDefinitionStep';
import StakeholderMatrixStep from './wizard/StakeholderMatrixStep';
import DecisionTreesStep from './wizard/DecisionTreesStep';
import CommunicationTemplatesStep from './wizard/CommunicationTemplatesStep';
import TaskSequencesStep from './wizard/TaskSequencesStep';
import BudgetAuthorityStep from './wizard/BudgetAuthorityStep';
import SuccessMetricsStep from './wizard/SuccessMetricsStep';
import LessonsLearnedStep from './wizard/LessonsLearnedStep';

interface FourPhasePlaybookWizardProps {
  playbook: any;
  organizationId: string;
  isOpen: boolean;
  onClose: () => void;
}

const PHASES = [
  {
    id: 'identify',
    name: 'IDENTIFY',
    icon: Target,
    color: 'violet',
    description: 'Build your depth chart',
    weight: 40,
    steps: [
      { id: 1, name: 'Stakeholder Matrix', component: StakeholderMatrixStep, aiTip: 'Define 3-tier stakeholder hierarchy for cascade communications', itemType: 'stakeholder_assignment' },
      { id: 2, name: 'Communication Templates', component: CommunicationTemplatesStep, aiTip: 'Pre-write messages for each stakeholder tier', itemType: 'document_template' },
      { id: 3, name: 'Budget Authority', component: BudgetAuthorityStep, aiTip: 'Pre-approve budgets and vendor contracts for rapid execution', itemType: 'budget_approval' },
    ]
  },
  {
    id: 'detect',
    name: 'DETECT',
    icon: Radar,
    color: 'blue',
    description: 'Monitor signals',
    weight: 20,
    steps: [
      { id: 4, name: 'Situation Definition', component: SituationDefinitionStep, aiTip: 'Set severity, time sensitivity, and trigger conditions for automated activation', itemType: 'trigger' },
    ]
  },
  {
    id: 'execute',
    name: 'EXECUTE',
    icon: Zap,
    color: 'emerald',
    description: 'Execute response',
    weight: 30,
    steps: [
      { id: 5, name: 'Decision Trees', component: DecisionTreesStep, aiTip: 'Map escalation paths and conditional decision logic', itemType: 'decision_tree' },
      { id: 6, name: 'Task Sequences', component: TaskSequencesStep, aiTip: 'Sequence parallel and dependent tasks with timelines', itemType: 'task_sequence' },
      { id: 7, name: 'Success Metrics', component: SuccessMetricsStep, aiTip: 'Define KPIs to measure execution quality and speed', itemType: 'success_metrics' },
    ]
  },
  {
    id: 'advance',
    name: 'ADVANCE',
    icon: BookOpen,
    color: 'amber',
    description: 'Review the film',
    weight: 10,
    steps: [
      { id: 8, name: 'Lessons Learned', component: LessonsLearnedStep, aiTip: 'Capture insights post-execution for continuous improvement', itemType: 'after_action_review' },
    ]
  }
];

function PhaseReadinessScore({ phase, score, isActive }: { phase: typeof PHASES[0], score: number, isActive: boolean }) {
  const PhaseIcon = phase.icon;
  const colorClasses = {
    violet: 'bg-violet-500',
    blue: 'bg-blue-500',
    emerald: 'bg-emerald-500',
    amber: 'bg-amber-500',
  };
  
  return (
    <div 
      className={`flex items-center gap-3 p-3 rounded-lg transition-all ${
        isActive 
          ? 'ring-2 ring-primary bg-primary/5' 
          : 'bg-muted/50 hover:bg-muted/80'
      }`}
    >
      <div className={`p-2 rounded-lg ${colorClasses[phase.color as keyof typeof colorClasses]} bg-opacity-20`}>
        <PhaseIcon className={`w-5 h-5 text-${phase.color}-600`} />
      </div>
      <div className="flex-1 min-w-0">
        <div className="flex items-center justify-between">
          <span className="font-semibold text-sm">{phase.name}</span>
          <Badge 
            variant={score >= 80 ? 'default' : score >= 50 ? 'secondary' : 'outline'}
            className="text-xs"
          >
            {score}%
          </Badge>
        </div>
        <div className="text-xs text-muted-foreground truncate">{phase.description}</div>
        <Progress value={score} className="h-1.5 mt-1" />
      </div>
    </div>
  );
}

function OverallReadinessCard({ readinessData }: { readinessData: any }) {
  const score = readinessData?.score?.overallScore ?? 0;
  const scoreColor = score >= 80 ? 'text-green-600' : score >= 60 ? 'text-amber-600' : 'text-red-600';
  
  return (
    <Card className="bg-gradient-to-br from-slate-900 to-slate-800 text-white border-0">
      <CardHeader className="pb-2">
        <CardTitle className="flex items-center gap-2 text-lg">
          <Shield className="w-5 h-5" />
          Playbook Readiness
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="flex items-center justify-between">
          <div className="text-center">
            <div className={`text-5xl font-bold ${scoreColor}`}>{score}%</div>
            <div className="text-xs text-slate-400 mt-1">Overall Score</div>
          </div>
          <div className="flex-1 ml-6 space-y-2">
            <div className="flex justify-between text-xs">
              <span className="flex items-center gap-1"><Target className="w-3 h-3" /> IDENTIFY</span>
              <span>{readinessData?.score?.prepareScore ?? 0}%</span>
            </div>
            <div className="flex justify-between text-xs">
              <span className="flex items-center gap-1"><Radar className="w-3 h-3" /> DETECT</span>
              <span>{readinessData?.score?.monitorScore ?? 0}%</span>
            </div>
            <div className="flex justify-between text-xs">
              <span className="flex items-center gap-1"><Zap className="w-3 h-3" /> EXECUTE</span>
              <span>{readinessData?.score?.executeScore ?? 0}%</span>
            </div>
            <div className="flex justify-between text-xs">
              <span className="flex items-center gap-1"><BookOpen className="w-3 h-3" /> ADVANCE</span>
              <span>{readinessData?.score?.learnScore ?? 0}%</span>
            </div>
          </div>
        </div>
        <div className="mt-4 grid grid-cols-3 gap-2 text-center">
          <div className="bg-slate-700/50 rounded-lg p-2">
            <div className="text-lg font-bold">{readinessData?.breakdown?.prepare?.completed ?? 0}/{readinessData?.breakdown?.prepare?.total ?? 0}</div>
            <div className="text-[10px] text-slate-400">Prep Items</div>
          </div>
          <div className="bg-slate-700/50 rounded-lg p-2">
            <div className="text-lg font-bold">{readinessData?.breakdown?.monitor?.active ?? 0}/{readinessData?.breakdown?.monitor?.total ?? 0}</div>
            <div className="text-[10px] text-slate-400">Active Triggers</div>
          </div>
          <div className="bg-slate-700/50 rounded-lg p-2">
            <div className="text-lg font-bold">{readinessData?.breakdown?.learn?.configured ?? 0}</div>
            <div className="text-[10px] text-slate-400">Learn Items</div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

export default function FourPhasePlaybookWizard({
  playbook,
  organizationId,
  isOpen,
  onClose,
}: FourPhasePlaybookWizardProps) {
  const [activePhase, setActivePhase] = useState('prepare');
  const [currentStepIndex, setCurrentStepIndex] = useState(0);
  const [formData, setFormData] = useState<any>({
    severityScore: playbook?.severityScore || 50,
    timeSensitivity: playbook?.timeSensitivity || 24,
    activationFrequencyTier: playbook?.activationFrequencyTier || 'MEDIUM',
    triggerCriteria: playbook?.triggerCriteria || '',
    triggerDataSources: playbook?.triggerDataSources || [],
    tier1Stakeholders: playbook?.tier1Stakeholders || [],
    tier2Stakeholders: playbook?.tier2Stakeholders || [],
    tier3Stakeholders: playbook?.tier3Stakeholders || [],
    externalPartners: playbook?.externalPartners || [],
    decisionCheckpoints: [],
    escalationPaths: [],
    communicationTemplates: [],
    taskSequences: [],
    preApprovedBudget: playbook?.preApprovedBudget || 0,
    budgetApprovalRequired: playbook?.budgetApprovalRequired !== false,
    vendorContracts: playbook?.vendorContracts || [],
    targetResponseSpeed: playbook?.targetResponseSpeed || 12,
    targetStakeholderReach: playbook?.targetStakeholderReach || 1.0,
    outcomeMetrics: playbook?.outcomeMetrics || [],
    lessonsLearned: [],
  });

  const { toast } = useToast();

  const { data: readinessData, isLoading: readinessLoading } = useQuery({
    queryKey: ['/api/playbook-library', playbook?.id, 'readiness', { organizationId }],
    queryFn: async () => {
      const res = await fetch(`/api/playbook-library/${playbook?.id}/readiness?organizationId=${organizationId}`);
      if (!res.ok) throw new Error('Failed to fetch readiness');
      return res.json();
    },
    enabled: !!playbook?.id && !!organizationId,
  });

  const saveCustomizationMutation = useMutation({
    mutationFn: async (data: any) => {
      return apiRequest('PATCH', `/api/playbook-library/${playbook.id}/customize`, data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library'] });
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbook?.id, 'readiness'] });
      toast({
        title: 'Playbook Customized',
        description: 'Your playbook template has been customized successfully',
      });
      onClose();
    },
    onError: () => {
      toast({
        title: 'Error',
        description: 'Failed to save playbook customization',
        variant: 'destructive',
      });
    },
  });

  const currentPhase = PHASES.find(p => p.id === activePhase) || PHASES[0];
  const currentStep = currentPhase.steps[currentStepIndex];
  const CurrentStepComponent = currentStep?.component;

  const allSteps = PHASES.flatMap(p => p.steps);
  const totalSteps = allSteps.length;
  const completedSteps = allSteps.findIndex(s => s.id === currentStep?.id) + 1;
  const progress = (completedSteps / totalSteps) * 100;

  const handlePhaseChange = (phaseId: string) => {
    setActivePhase(phaseId);
    setCurrentStepIndex(0);
  };

  const handleNext = () => {
    if (currentStepIndex < currentPhase.steps.length - 1) {
      setCurrentStepIndex(currentStepIndex + 1);
    } else {
      const currentPhaseIndex = PHASES.findIndex(p => p.id === activePhase);
      if (currentPhaseIndex < PHASES.length - 1) {
        setActivePhase(PHASES[currentPhaseIndex + 1].id);
        setCurrentStepIndex(0);
      }
    }
  };

  const handleBack = () => {
    if (currentStepIndex > 0) {
      setCurrentStepIndex(currentStepIndex - 1);
    } else {
      const currentPhaseIndex = PHASES.findIndex(p => p.id === activePhase);
      if (currentPhaseIndex > 0) {
        const prevPhase = PHASES[currentPhaseIndex - 1];
        setActivePhase(prevPhase.id);
        setCurrentStepIndex(prevPhase.steps.length - 1);
      }
    }
  };

  const handleSave = () => {
    saveCustomizationMutation.mutate({
      organizationId,
      playbookId: playbook.id,
      customizations: formData,
    });
  };

  const updateFormData = (stepData: any) => {
    setFormData({ ...formData, ...stepData });
  };

  const isFirstStep = activePhase === 'prepare' && currentStepIndex === 0;
  const isLastStep = activePhase === 'learn' && currentStepIndex === currentPhase.steps.length - 1;

  const getPhaseScore = (phaseId: string) => {
    switch (phaseId) {
      case 'prepare': return readinessData?.score?.prepareScore ?? 0;
      case 'monitor': return readinessData?.score?.monitorScore ?? 0;
      case 'execute': return readinessData?.score?.executeScore ?? 0;
      case 'learn': return readinessData?.score?.learnScore ?? 0;
      default: return 0;
    }
  };

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0" data-testid="dialog-four-phase-wizard">
        <DialogHeader className="p-6 pb-4 border-b">
          <DialogTitle className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <Shield className="w-6 h-6 text-primary" />
              <div>
                <div className="text-lg">Configure Playbook: {playbook?.name}</div>
                <div className="text-sm font-normal text-muted-foreground">4-Phase Strategic Readiness</div>
              </div>
            </div>
            <Badge variant="outline" className="text-sm" data-testid="badge-phase-progress">
              Phase {PHASES.findIndex(p => p.id === activePhase) + 1} of {PHASES.length}
            </Badge>
          </DialogTitle>
        </DialogHeader>

        <div className="flex flex-1 overflow-hidden">
          <div className="w-80 bg-muted/30 border-r p-4 space-y-4 overflow-y-auto">
            <OverallReadinessCard readinessData={readinessData} />
            
            <div className="space-y-2">
              <h4 className="text-sm font-semibold text-muted-foreground px-1">PHASES</h4>
              {PHASES.map((phase) => (
                <button
                  key={phase.id}
                  onClick={() => handlePhaseChange(phase.id)}
                  className="w-full text-left"
                  data-testid={`button-phase-${phase.id}`}
                >
                  <PhaseReadinessScore 
                    phase={phase} 
                    score={getPhaseScore(phase.id)} 
                    isActive={activePhase === phase.id}
                  />
                </button>
              ))}
            </div>
          </div>

          <div className="flex-1 flex flex-col overflow-hidden">
            <div className="p-4 border-b bg-background">
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center gap-2">
                  {(() => {
                    const PhaseIcon = currentPhase.icon;
                    return <PhaseIcon className="w-5 h-5" />;
                  })()}
                  <span className="font-semibold">{currentPhase.name}</span>
                  <span className="text-muted-foreground"></span>
                  <span>{currentStep?.name}</span>
                </div>
                <Badge variant="secondary" className="text-xs">
                  Step {currentStepIndex + 1} of {currentPhase.steps.length}
                </Badge>
              </div>
              <Progress value={progress} className="h-2" data-testid="progress-wizard" />
              <div className="flex items-center gap-2 mt-2 text-xs text-blue-600 dark:text-blue-400">
                <Lightbulb className="w-3 h-3" />
                <span>{currentStep?.aiTip}</span>
              </div>
            </div>

            <div className="flex gap-2 p-3 border-b overflow-x-auto bg-muted/20">
              {currentPhase.steps.map((step, idx) => (
                <button
                  key={step.id}
                  onClick={() => setCurrentStepIndex(idx)}
                  className={`flex-shrink-0 px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${
                    currentStepIndex === idx
                      ? 'bg-primary text-primary-foreground'
                      : currentStepIndex > idx
                      ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300'
                      : 'bg-muted text-muted-foreground hover:bg-muted/80'
                  }`}
                  data-testid={`button-step-${step.id}`}
                >
                  {currentStepIndex > idx && <Check className="h-3 w-3 inline mr-1" />}
                  {step.name}
                </button>
              ))}
            </div>

            <div className="flex-1 overflow-y-auto p-6">
              <Card className="bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-900 p-3 mb-4">
                <div className="flex gap-2">
                  <Lightbulb className="w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5" />
                  <div className="text-sm text-blue-900 dark:text-blue-100">
                    <span className="font-semibold">Pro Tip:</span> Customize each section with your organization's specific context. M pre-fills 80%+ of content from best practices.
                  </div>
                </div>
              </Card>
              
              {CurrentStepComponent && (
                <CurrentStepComponent
                  data={formData}
                  onChange={updateFormData}
                  playbook={playbook}
                />
              )}
            </div>

            <div className="flex justify-between p-4 border-t bg-background">
              <Button
                variant="outline"
                onClick={handleBack}
                disabled={isFirstStep}
                data-testid="button-back"
              >
                <ChevronLeft className="h-4 w-4 mr-1" />
                Back
              </Button>

              <div className="flex gap-2">
                <Button variant="outline" onClick={onClose} data-testid="button-cancel">
                  Cancel
                </Button>
                {isLastStep ? (
                  <Button
                    onClick={handleSave}
                    disabled={saveCustomizationMutation.isPending}
                    className="bg-green-600 hover:bg-green-700"
                    data-testid="button-save-playbook"
                  >
                    <Check className="h-4 w-4 mr-1" />
                    {saveCustomizationMutation.isPending ? 'Saving...' : 'Complete Setup'}
                  </Button>
                ) : (
                  <Button onClick={handleNext} data-testid="button-next">
                    Next
                    <ChevronRight className="h-4 w-4 ml-1" />
                  </Button>
                )}
              </div>
            </div>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
}


========================================
FILE: client/src/components/playbook/LearnPhaseView.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Checkbox } from '@/components/ui/checkbox';
import {
  MessageSquare,
  ClipboardList,
  FileText,
  RefreshCw,
  BarChart3,
  Users,
  Plus,
  Clock,
  BookOpen,
  ChevronDown,
  ChevronUp,
  Trash2,
  AlertCircle,
} from 'lucide-react';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';

interface LearnPhaseViewProps {
  playbookId: string;
  organizationId: string;
  isEditable?: boolean;
}

type LearnType = 
  | 'debrief_meeting'
  | 'survey'
  | 'documentation'
  | 'playbook_update'
  | 'metrics_review'
  | 'process_improvement';

type Timing = 
  | 'within_24_hours'
  | 'within_48_hours'
  | 'within_1_week'
  | 'within_1_month'
  | 'quarterly';

interface LearnItem {
  id: string;
  playbookId: string;
  organizationId: string;
  learnType: LearnType;
  title: string;
  description?: string;
  timing: Timing;
  offsetHours: number;
  responsibleRole?: string;
  isRequired: boolean;
  sequence: number;
}

const LEARN_TYPE_CONFIG: Record<LearnType, { icon: any; label: string; color: string }> = {
  debrief_meeting: { icon: MessageSquare, label: 'Debrief Meeting', color: 'text-blue-500' },
  survey: { icon: ClipboardList, label: 'Feedback Survey', color: 'text-green-500' },
  documentation: { icon: FileText, label: 'Documentation', color: 'text-purple-500' },
  playbook_update: { icon: RefreshCw, label: 'Playbook Update', color: 'text-orange-500' },
  metrics_review: { icon: BarChart3, label: 'Metrics Review', color: 'text-cyan-500' },
  process_improvement: { icon: Users, label: 'Process Improvement', color: 'text-pink-500' },
};

const TIMING_CONFIG: Record<Timing, { label: string; description: string }> = {
  within_24_hours: { label: 'Within 24 Hours', description: 'Immediate post-execution' },
  within_48_hours: { label: 'Within 48 Hours', description: 'Short-term follow-up' },
  within_1_week: { label: 'Within 1 Week', description: 'Weekly review cycle' },
  within_1_month: { label: 'Within 1 Month', description: 'Monthly analysis' },
  quarterly: { label: 'Quarterly', description: 'Strategic review cycle' },
};

export function LearnPhaseView({ playbookId, organizationId, isEditable = true }: LearnPhaseViewProps) {
  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);
  const [expandedItems, setExpandedItems] = useState<Set<string>>(new Set());
  const [newItem, setNewItem] = useState({
    learnType: 'debrief_meeting' as LearnType,
    title: '',
    description: '',
    timing: 'within_24_hours' as Timing,
    responsibleRole: '',
    isRequired: true,
  });
  const { toast } = useToast();

  const { data: items = [], isLoading } = useQuery<LearnItem[]>({
    queryKey: ['/api/playbook-library', playbookId, 'learn-items', { organizationId }],
    queryFn: async () => {
      const response = await fetch(
        `/api/playbook-library/${playbookId}/learn-items?organizationId=${organizationId}`
      );
      if (!response.ok) throw new Error('Failed to fetch learn items');
      return response.json();
    },
    enabled: !!playbookId && !!organizationId,
  });

  const createItemMutation = useMutation({
    mutationFn: async (data: Partial<LearnItem>) => {
      const timingToHours: Record<Timing, number> = {
        within_24_hours: 24,
        within_48_hours: 48,
        within_1_week: 168,
        within_1_month: 720,
        quarterly: 2160,
      };
      
      const response = await apiRequest('POST', `/api/playbook-library/${playbookId}/learn-items`, {
        ...data,
        organizationId,
        sequence: items.length + 1,
        offsetHours: timingToHours[data.timing as Timing] || 24,
      });
      return response.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbookId, 'learn-items'] });
      setIsAddDialogOpen(false);
      setNewItem({
        learnType: 'debrief_meeting',
        title: '',
        description: '',
        timing: 'within_24_hours',
        responsibleRole: '',
        isRequired: true,
      });
      toast({ title: 'Learn item added', description: 'Post-execution activity configured.' });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to add learn item.', variant: 'destructive' });
    },
  });

  const deleteItemMutation = useMutation({
    mutationFn: async (itemId: string) => {
      await apiRequest('DELETE', `/api/playbook-library/${playbookId}/learn-items/${itemId}`);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbookId, 'learn-items'] });
      toast({ title: 'Item deleted' });
    },
  });

  const toggleExpanded = (itemId: string) => {
    const newExpanded = new Set(expandedItems);
    if (newExpanded.has(itemId)) {
      newExpanded.delete(itemId);
    } else {
      newExpanded.add(itemId);
    }
    setExpandedItems(newExpanded);
  };

  const requiredItems = items.filter((i) => i.isRequired);
  const totalItems = items.length;

  const groupedByTiming = items.reduce((acc, item) => {
    if (!acc[item.timing]) acc[item.timing] = [];
    acc[item.timing].push(item);
    return acc;
  }, {} as Record<Timing, LearnItem[]>);

  const timingOrder: Timing[] = ['within_24_hours', 'within_48_hours', 'within_1_week', 'within_1_month', 'quarterly'];

  if (isLoading) {
    return (
      <div className="space-y-4 animate-pulse">
        <div className="h-24 bg-slate-200 dark:bg-slate-800 rounded-lg" />
        <div className="h-48 bg-slate-200 dark:bg-slate-800 rounded-lg" />
      </div>
    );
  }

  return (
    <div className="space-y-6" data-testid="learn-phase-view">
      <Card className="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/30 dark:to-emerald-950/30">
        <CardHeader>
          <div className="flex items-center justify-between">
            <div>
              <CardTitle className="flex items-center gap-2">
                <span className="text-2xl"></span>
                ADVANCE Phase  Review the Film
              </CardTitle>
              <CardDescription>
                Post-execution activities to capture learnings and improve playbooks
              </CardDescription>
            </div>
            <div className="text-right">
              <div className="text-3xl font-bold text-green-600 dark:text-green-400" data-testid="learn-items-count">
                {totalItems}
              </div>
              <div className="text-xs text-muted-foreground">Learning Activities</div>
            </div>
          </div>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            {Object.entries(LEARN_TYPE_CONFIG).slice(0, 4).map(([type, config]) => {
              const Icon = config.icon;
              const count = items.filter((i) => i.learnType === type).length;
              return (
                <div key={type} className="p-3 bg-white dark:bg-slate-900 rounded-lg text-center">
                  <Icon className={`h-5 w-5 mx-auto mb-1 ${config.color}`} />
                  <div className="text-lg font-semibold">{count}</div>
                  <div className="text-xs text-muted-foreground truncate">{config.label}</div>
                </div>
              );
            })}
          </div>
        </CardContent>
      </Card>

      <Card>
        <CardHeader className="pb-3">
          <CardTitle className="text-base flex items-center gap-2">
            <Clock className="h-5 w-5" />
            Learning Timeline
          </CardTitle>
          <CardDescription>
            Activities are automatically scheduled based on execution completion
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="relative">
            <div className="absolute left-4 top-0 bottom-0 w-0.5 bg-gradient-to-b from-green-500 via-emerald-400 to-green-300 dark:from-green-600 dark:via-emerald-500 dark:to-green-400" />
            
            {timingOrder.map((timing) => {
              const timingItems = groupedByTiming[timing] || [];
              if (timingItems.length === 0) return null;
              
              const timingConfig = TIMING_CONFIG[timing];
              
              return (
                <div key={timing} className="relative pl-10 pb-8" data-testid={`learn-timing-${timing}`}>
                  <div className="absolute left-2 w-5 h-5 rounded-full bg-green-500 border-4 border-white dark:border-slate-900 flex items-center justify-center">
                    <Clock className="h-2.5 w-2.5 text-white" />
                  </div>
                  
                  <div className="mb-3">
                    <h4 className="font-medium">{timingConfig.label}</h4>
                    <p className="text-xs text-muted-foreground">{timingConfig.description}</p>
                  </div>
                  
                  <div className="space-y-2">
                    {timingItems.map((item) => {
                      const typeConfig = LEARN_TYPE_CONFIG[item.learnType];
                      const TypeIcon = typeConfig.icon;
                      const isExpanded = expandedItems.has(item.id);

                      return (
                        <div
                          key={item.id}
                          className="border rounded-lg p-3 bg-card hover:bg-accent/50 transition-all"
                          data-testid={`learn-item-${item.id}`}
                        >
                          <div className="flex items-center gap-3">
                            <TypeIcon className={`h-5 w-5 ${typeConfig.color} shrink-0`} />
                            <div className="flex-1 min-w-0">
                              <div className="flex items-center gap-2">
                                <span className="font-medium truncate">{item.title}</span>
                                {item.isRequired && (
                                  <Badge variant="outline" className="text-xs shrink-0">
                                    Required
                                  </Badge>
                                )}
                              </div>
                              {item.responsibleRole && (
                                <span className="text-xs text-muted-foreground">
                                  Owner: {item.responsibleRole}
                                </span>
                              )}
                            </div>
                            <Badge variant="secondary" className="text-xs shrink-0">
                              {typeConfig.label}
                            </Badge>
                            <Button
                              variant="ghost"
                              size="sm"
                              onClick={() => toggleExpanded(item.id)}
                              data-testid={`expand-${item.id}`}
                            >
                              {isExpanded ? <ChevronUp className="h-4 w-4" /> : <ChevronDown className="h-4 w-4" />}
                            </Button>
                          </div>
                          {isExpanded && (
                            <div className="mt-3 pt-3 border-t text-sm text-muted-foreground">
                              <p>{item.description || 'No description provided.'}</p>
                              {isEditable && (
                                <Button
                                  variant="ghost"
                                  size="sm"
                                  className="mt-2 text-red-500 hover:text-red-600"
                                  onClick={() => deleteItemMutation.mutate(item.id)}
                                  data-testid={`delete-${item.id}`}
                                >
                                  <Trash2 className="h-4 w-4 mr-1" /> Delete
                                </Button>
                              )}
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>
              );
            })}
          </div>
        </CardContent>
      </Card>

      {items.length === 0 && (
        <Card className="border-dashed">
          <CardContent className="py-12 text-center">
            <BookOpen className="h-12 w-12 mx-auto mb-4 text-muted-foreground" />
            <h3 className="font-medium mb-2">No Learning Activities Configured</h3>
            <p className="text-sm text-muted-foreground mb-4">
              Add debrief meetings, surveys, and documentation tasks to capture learnings after execution.
            </p>
            {isEditable && (
              <Button onClick={() => setIsAddDialogOpen(true)} data-testid="button-add-first-learn-item">
                <Plus className="h-4 w-4 mr-2" /> Add First Activity
              </Button>
            )}
          </CardContent>
        </Card>
      )}

      {isEditable && items.length > 0 && (
        <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>
          <DialogTrigger asChild>
            <Button className="w-full" variant="outline" data-testid="button-add-learn-item">
              <Plus className="h-4 w-4 mr-2" /> Add Learning Activity
            </Button>
          </DialogTrigger>
          <DialogContent>
            <DialogHeader>
              <DialogTitle>Add Learning Activity</DialogTitle>
              <DialogDescription>
                Configure a post-execution activity to capture and apply learnings.
              </DialogDescription>
            </DialogHeader>
            <div className="space-y-4 py-4">
              <div className="space-y-2">
                <Label>Activity Type</Label>
                <Select
                  value={newItem.learnType}
                  onValueChange={(v) => setNewItem({ ...newItem, learnType: v as LearnType })}
                >
                  <SelectTrigger data-testid="select-learn-type">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    {Object.entries(LEARN_TYPE_CONFIG).map(([type, config]) => (
                      <SelectItem key={type} value={type}>
                        {config.label}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
              <div className="space-y-2">
                <Label>Title</Label>
                <Input
                  value={newItem.title}
                  onChange={(e) => setNewItem({ ...newItem, title: e.target.value })}
                  placeholder="e.g., Team Debrief Session"
                  data-testid="input-learn-title"
                />
              </div>
              <div className="space-y-2">
                <Label>Description</Label>
                <Textarea
                  value={newItem.description}
                  onChange={(e) => setNewItem({ ...newItem, description: e.target.value })}
                  placeholder="Describe the activity objectives..."
                  data-testid="input-learn-description"
                />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label>Timing</Label>
                  <Select
                    value={newItem.timing}
                    onValueChange={(v) => setNewItem({ ...newItem, timing: v as Timing })}
                  >
                    <SelectTrigger data-testid="select-timing">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      {Object.entries(TIMING_CONFIG).map(([timing, config]) => (
                        <SelectItem key={timing} value={timing}>
                          {config.label}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label>Responsible Role</Label>
                  <Input
                    value={newItem.responsibleRole}
                    onChange={(e) => setNewItem({ ...newItem, responsibleRole: e.target.value })}
                    placeholder="e.g., Operations, HR"
                    data-testid="input-learn-role"
                  />
                </div>
              </div>
              <div className="flex items-center gap-2">
                <Checkbox
                  id="isLearnRequired"
                  checked={newItem.isRequired}
                  onCheckedChange={(checked) => setNewItem({ ...newItem, isRequired: !!checked })}
                  data-testid="checkbox-learn-required"
                />
                <Label htmlFor="isLearnRequired">Required after every execution</Label>
              </div>
            </div>
            <DialogFooter>
              <Button variant="outline" onClick={() => setIsAddDialogOpen(false)}>
                Cancel
              </Button>
              <Button
                onClick={() => createItemMutation.mutate(newItem)}
                disabled={!newItem.title || createItemMutation.isPending}
                data-testid="button-save-learn-item"
              >
                {createItemMutation.isPending ? 'Saving...' : 'Add Activity'}
              </Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>
      )}
    </div>
  );
}

export default LearnPhaseView;


========================================
FILE: client/src/components/playbook/MonitorPhaseView.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Switch } from '@/components/ui/switch';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import {
  Radio,
  Radar,
  Activity,
  TrendingUp,
  Globe,
  Scale,
  DollarSign,
  Users,
  Boxes,
  Plus,
  Signal,
  SignalHigh,
  SignalLow,
  AlertTriangle,
  ChevronDown,
  ChevronUp,
  Trash2,
  Zap,
} from 'lucide-react';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';

interface MonitorPhaseViewProps {
  playbookId: string;
  organizationId: string;
  isEditable?: boolean;
}

type SignalType = 
  | 'competitive'
  | 'market'
  | 'regulatory'
  | 'operational'
  | 'financial'
  | 'talent'
  | 'supply_chain'
  | 'technology';

type TriggerType = 'event' | 'threshold' | 'pattern' | 'scheduled';

interface MonitorItem {
  id: string;
  playbookId: string;
  organizationId: string;
  signalType: SignalType;
  signalName: string;
  signalDescription?: string;
  triggerType: TriggerType;
  triggerConditions?: Record<string, any>;
  severity: 'critical' | 'high' | 'medium' | 'low';
  isActive: boolean;
  sequence: number;
  lastTriggeredAt?: string;
}

const SIGNAL_TYPE_CONFIG: Record<SignalType, { icon: any; label: string; color: string }> = {
  competitive: { icon: Radar, label: 'Competitive Intelligence', color: 'text-red-500' },
  market: { icon: TrendingUp, label: 'Market Dynamics', color: 'text-blue-500' },
  regulatory: { icon: Scale, label: 'Regulatory & Compliance', color: 'text-purple-500' },
  operational: { icon: Activity, label: 'Operational', color: 'text-orange-500' },
  financial: { icon: DollarSign, label: 'Financial', color: 'text-green-500' },
  talent: { icon: Users, label: 'Talent & Leadership', color: 'text-pink-500' },
  supply_chain: { icon: Boxes, label: 'Supply Chain', color: 'text-amber-500' },
  technology: { icon: Globe, label: 'Technology', color: 'text-cyan-500' },
};

const TRIGGER_TYPE_CONFIG: Record<TriggerType, { label: string; description: string }> = {
  event: { label: 'Event-based', description: 'Triggers when a specific event occurs' },
  threshold: { label: 'Threshold', description: 'Triggers when a metric crosses a threshold' },
  pattern: { label: 'Pattern Detection', description: 'AI-powered pattern matching' },
  scheduled: { label: 'Scheduled', description: 'Time-based monitoring intervals' },
};

const SEVERITY_CONFIG = {
  critical: { label: 'Critical', color: 'bg-red-100 text-red-700 dark:bg-red-950 dark:text-red-300', icon: SignalHigh },
  high: { label: 'High', color: 'bg-orange-100 text-orange-700 dark:bg-orange-950 dark:text-orange-300', icon: Signal },
  medium: { label: 'Medium', color: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-950 dark:text-yellow-300', icon: SignalLow },
  low: { label: 'Low', color: 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300', icon: Radio },
};

export function MonitorPhaseView({ playbookId, organizationId, isEditable = true }: MonitorPhaseViewProps) {
  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);
  const [expandedItems, setExpandedItems] = useState<Set<string>>(new Set());
  const [newItem, setNewItem] = useState<{
    signalType: SignalType;
    signalName: string;
    signalDescription: string;
    triggerType: TriggerType;
    severity: 'critical' | 'high' | 'medium' | 'low';
  }>({
    signalType: 'competitive',
    signalName: '',
    signalDescription: '',
    triggerType: 'event',
    severity: 'high',
  });
  const { toast } = useToast();

  const { data: items = [], isLoading } = useQuery<MonitorItem[]>({
    queryKey: ['/api/playbook-library', playbookId, 'monitor-items', { organizationId }],
    queryFn: async () => {
      const response = await fetch(
        `/api/playbook-library/${playbookId}/monitor-items?organizationId=${organizationId}`
      );
      if (!response.ok) throw new Error('Failed to fetch monitor items');
      return response.json();
    },
    enabled: !!playbookId && !!organizationId,
  });

  const createItemMutation = useMutation({
    mutationFn: async (data: Partial<MonitorItem>) => {
      const response = await apiRequest('POST', `/api/playbook-library/${playbookId}/monitor-items`, {
        ...data,
        organizationId,
        sequence: items.length + 1,
        isActive: true,
      });
      return response.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbookId, 'monitor-items'] });
      setIsAddDialogOpen(false);
      setNewItem({
        signalType: 'competitive',
        signalName: '',
        signalDescription: '',
        triggerType: 'event',
        severity: 'high',
      });
      toast({ title: 'Monitor trigger added', description: 'The signal is now being monitored.' });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to add monitor trigger.', variant: 'destructive' });
    },
  });

  const toggleItemMutation = useMutation({
    mutationFn: async (itemId: string) => {
      const response = await apiRequest(
        'PATCH',
        `/api/playbook-library/${playbookId}/monitor-items/${itemId}/toggle`
      );
      return response.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbookId, 'monitor-items'] });
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbookId, 'readiness'] });
    },
  });

  const deleteItemMutation = useMutation({
    mutationFn: async (itemId: string) => {
      await apiRequest('DELETE', `/api/playbook-library/${playbookId}/monitor-items/${itemId}`);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbookId, 'monitor-items'] });
      toast({ title: 'Trigger deleted' });
    },
  });

  const toggleExpanded = (itemId: string) => {
    const newExpanded = new Set(expandedItems);
    if (newExpanded.has(itemId)) {
      newExpanded.delete(itemId);
    } else {
      newExpanded.add(itemId);
    }
    setExpandedItems(newExpanded);
  };

  const activeCount = items.filter((i) => i.isActive).length;
  const criticalCount = items.filter((i) => i.severity === 'critical' && i.isActive).length;
  const progressPercent = items.length > 0 ? Math.round((activeCount / items.length) * 100) : 0;

  const groupedItems = items.reduce((acc, item) => {
    if (!acc[item.signalType]) acc[item.signalType] = [];
    acc[item.signalType].push(item);
    return acc;
  }, {} as Record<SignalType, MonitorItem[]>);

  if (isLoading) {
    return (
      <div className="space-y-4 animate-pulse">
        <div className="h-24 bg-slate-200 dark:bg-slate-800 rounded-lg" />
        <div className="h-48 bg-slate-200 dark:bg-slate-800 rounded-lg" />
      </div>
    );
  }

  return (
    <div className="space-y-6" data-testid="monitor-phase-view">
      <Card className="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30">
        <CardHeader>
          <div className="flex items-center justify-between">
            <div>
              <CardTitle className="flex items-center gap-2">
                <span className="text-2xl"></span>
                DETECT Phase  Monitor Signals
              </CardTitle>
              <CardDescription>
                Human insight amplified by AI-powered pattern matching. Configure the signals that matter.
              </CardDescription>
            </div>
            <div className="text-right">
              <div className="text-3xl font-bold text-blue-600 dark:text-blue-400" data-testid="active-triggers-count">
                {activeCount}
              </div>
              <div className="text-xs text-muted-foreground">Active Triggers</div>
            </div>
          </div>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-3 gap-4 text-center">
            <div className="p-3 bg-white dark:bg-slate-900 rounded-lg">
              <div className="text-lg font-semibold text-red-500">{criticalCount}</div>
              <div className="text-xs text-muted-foreground">Critical</div>
            </div>
            <div className="p-3 bg-white dark:bg-slate-900 rounded-lg">
              <div className="text-lg font-semibold">{items.length}</div>
              <div className="text-xs text-muted-foreground">Total Signals</div>
            </div>
            <div className="p-3 bg-white dark:bg-slate-900 rounded-lg">
              <div className="text-lg font-semibold text-green-500">
                {Object.keys(groupedItems).length}
              </div>
              <div className="text-xs text-muted-foreground">Categories</div>
            </div>
          </div>
        </CardContent>
      </Card>

      {Object.entries(groupedItems).map(([type, typeItems]) => {
        const config = SIGNAL_TYPE_CONFIG[type as SignalType];
        const Icon = config.icon;

        return (
          <Card key={type} data-testid={`monitor-section-${type}`}>
            <CardHeader className="pb-3">
              <CardTitle className="text-base flex items-center gap-2">
                <Icon className={`h-5 w-5 ${config.color}`} />
                {config.label}
                <Badge variant="outline" className="ml-auto">
                  {typeItems.filter((i) => i.isActive).length}/{typeItems.length} active
                </Badge>
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-2">
              {typeItems.map((item) => {
                const severityConfig = SEVERITY_CONFIG[item.severity];
                const SeverityIcon = severityConfig.icon;
                const isExpanded = expandedItems.has(item.id);

                return (
                  <div
                    key={item.id}
                    className={`border rounded-lg p-3 transition-all ${
                      item.isActive
                        ? 'bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800'
                        : 'bg-slate-50 dark:bg-slate-900/50 border-slate-200 dark:border-slate-700 opacity-60'
                    }`}
                    data-testid={`monitor-item-${item.id}`}
                  >
                    <div className="flex items-center gap-3">
                      {isEditable && (
                        <Switch
                          checked={item.isActive}
                          onCheckedChange={() => toggleItemMutation.mutate(item.id)}
                          data-testid={`switch-${item.id}`}
                        />
                      )}
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2">
                          <SeverityIcon className={`h-4 w-4 ${item.isActive ? severityConfig.color.split(' ')[1] : 'text-slate-400'}`} />
                          <span className="font-medium truncate">{item.signalName}</span>
                          <Badge className={`text-xs shrink-0 ${severityConfig.color}`}>
                            {severityConfig.label}
                          </Badge>
                        </div>
                        <div className="flex items-center gap-2 mt-1 text-xs text-muted-foreground">
                          <Zap className="h-3 w-3" />
                          {TRIGGER_TYPE_CONFIG[item.triggerType].label}
                        </div>
                      </div>
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={() => toggleExpanded(item.id)}
                        data-testid={`expand-${item.id}`}
                      >
                        {isExpanded ? <ChevronUp className="h-4 w-4" /> : <ChevronDown className="h-4 w-4" />}
                      </Button>
                    </div>
                    {isExpanded && (
                      <div className="mt-3 pt-3 border-t text-sm text-muted-foreground">
                        <p>{item.signalDescription || 'No description provided.'}</p>
                        {item.triggerConditions && (
                          <div className="mt-2 p-2 bg-slate-100 dark:bg-slate-800 rounded text-xs font-mono">
                            {JSON.stringify(item.triggerConditions, null, 2)}
                          </div>
                        )}
                        {item.lastTriggeredAt && (
                          <p className="mt-2 text-xs">
                            Last triggered: {new Date(item.lastTriggeredAt).toLocaleDateString()}
                          </p>
                        )}
                        {isEditable && (
                          <Button
                            variant="ghost"
                            size="sm"
                            className="mt-2 text-red-500 hover:text-red-600"
                            onClick={() => deleteItemMutation.mutate(item.id)}
                            data-testid={`delete-${item.id}`}
                          >
                            <Trash2 className="h-4 w-4 mr-1" /> Delete
                          </Button>
                        )}
                      </div>
                    )}
                  </div>
                );
              })}
            </CardContent>
          </Card>
        );
      })}

      {items.length === 0 && (
        <Card className="border-dashed">
          <CardContent className="py-12 text-center">
            <AlertTriangle className="h-12 w-12 mx-auto mb-4 text-amber-500" />
            <h3 className="font-medium mb-2">No Monitoring Triggers Configured</h3>
            <p className="text-sm text-muted-foreground mb-4">
              Add signals and triggers to automatically detect when this playbook should be activated.
            </p>
            {isEditable && (
              <Button onClick={() => setIsAddDialogOpen(true)} data-testid="button-add-first-trigger">
                <Plus className="h-4 w-4 mr-2" /> Add First Trigger
              </Button>
            )}
          </CardContent>
        </Card>
      )}

      {isEditable && items.length > 0 && (
        <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>
          <DialogTrigger asChild>
            <Button className="w-full" variant="outline" data-testid="button-add-monitor-trigger">
              <Plus className="h-4 w-4 mr-2" /> Add Monitor Trigger
            </Button>
          </DialogTrigger>
          <DialogContent>
            <DialogHeader>
              <DialogTitle>Add Monitor Trigger</DialogTitle>
              <DialogDescription>
                Configure a new signal to monitor for playbook activation.
              </DialogDescription>
            </DialogHeader>
            <div className="space-y-4 py-4">
              <div className="space-y-2">
                <Label>Signal Type</Label>
                <Select
                  value={newItem.signalType}
                  onValueChange={(v) => setNewItem({ ...newItem, signalType: v as SignalType })}
                >
                  <SelectTrigger data-testid="select-signal-type">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    {Object.entries(SIGNAL_TYPE_CONFIG).map(([type, config]) => (
                      <SelectItem key={type} value={type}>
                        {config.label}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
              <div className="space-y-2">
                <Label>Signal Name</Label>
                <Input
                  value={newItem.signalName}
                  onChange={(e) => setNewItem({ ...newItem, signalName: e.target.value })}
                  placeholder="e.g., Competitor Patent Filing Alert"
                  data-testid="input-signal-name"
                />
              </div>
              <div className="space-y-2">
                <Label>Description</Label>
                <Textarea
                  value={newItem.signalDescription}
                  onChange={(e) => setNewItem({ ...newItem, signalDescription: e.target.value })}
                  placeholder="Describe what this signal monitors..."
                  data-testid="input-signal-description"
                />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label>Trigger Type</Label>
                  <Select
                    value={newItem.triggerType}
                    onValueChange={(v) => setNewItem({ ...newItem, triggerType: v as TriggerType })}
                  >
                    <SelectTrigger data-testid="select-trigger-type">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      {Object.entries(TRIGGER_TYPE_CONFIG).map(([type, config]) => (
                        <SelectItem key={type} value={type}>
                          {config.label}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label>Severity</Label>
                  <Select
                    value={newItem.severity}
                    onValueChange={(v) => setNewItem({ ...newItem, severity: v as 'critical' | 'high' | 'medium' | 'low' })}
                  >
                    <SelectTrigger data-testid="select-severity">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="critical">Critical</SelectItem>
                      <SelectItem value="high">High</SelectItem>
                      <SelectItem value="medium">Medium</SelectItem>
                      <SelectItem value="low">Low</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>
            </div>
            <DialogFooter>
              <Button variant="outline" onClick={() => setIsAddDialogOpen(false)}>
                Cancel
              </Button>
              <Button
                onClick={() => createItemMutation.mutate(newItem)}
                disabled={!newItem.signalName || createItemMutation.isPending}
                data-testid="button-save-trigger"
              >
                {createItemMutation.isPending ? 'Saving...' : 'Add Trigger'}
              </Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>
      )}
    </div>
  );
}

export default MonitorPhaseView;


========================================
FILE: client/src/components/playbook/PhaseProgressBar.tsx
========================================
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { CheckCircle, Circle, AlertCircle } from 'lucide-react';

interface PhaseProgressBarProps {
  prepareScore: number;
  monitorScore: number;
  executeScore: number;
  learnScore: number;
  currentPhase?: 'identify' | 'detect' | 'execute' | 'advance';
  compact?: boolean;
}

export function PhaseProgressBar({
  prepareScore,
  monitorScore,
  executeScore,
  learnScore,
  currentPhase,
  compact = false
}: PhaseProgressBarProps) {
  const phases = [
    { id: 'identify', name: 'Identify', tagline: 'Build Your Depth Chart', score: prepareScore, color: 'bg-blue-500', textColor: 'text-blue-500' },
    { id: 'detect', name: 'Detect', tagline: 'Monitor Signals', score: monitorScore, color: 'bg-amber-500', textColor: 'text-amber-500' },
    { id: 'execute', name: 'Execute', tagline: 'Execute Response', score: executeScore, color: 'bg-green-500', textColor: 'text-green-500' },
    { id: 'advance', name: 'Advance', tagline: 'Review the Film', score: learnScore, color: 'bg-purple-500', textColor: 'text-purple-500' },
  ];

  const overallScore = Math.round(
    (prepareScore * 0.4) + 
    (monitorScore * 0.2) + 
    (executeScore * 0.3) + 
    (learnScore * 0.1)
  );

  if (compact) {
    return (
      <div className="flex items-center gap-2" data-testid="phase-progress-compact">
        <Badge 
          variant={overallScore >= 80 ? 'default' : overallScore >= 50 ? 'secondary' : 'destructive'}
          className="text-xs"
          data-testid="readiness-badge"
        >
          {overallScore}% Ready
        </Badge>
        <div className="flex gap-1">
          {phases.map((phase) => (
            <div
              key={phase.id}
              className={`w-2 h-2 rounded-full ${
                phase.score === 100 
                  ? phase.color
                  : phase.score > 0 
                    ? 'bg-yellow-500' 
                    : 'bg-slate-600'
              }`}
              title={`${phase.name}: ${phase.score}%`}
              data-testid={`phase-dot-${phase.id}`}
            />
          ))}
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-3" data-testid="phase-progress-full">
      <div className="flex items-center justify-between mb-2">
        <span className="text-sm font-medium text-slate-600 dark:text-slate-300">IDEA Framework Progress</span>
      </div>
      
      <div className="space-y-2">
        {phases.map((phase) => (
          <div 
            key={phase.id}
            className={`p-2.5 rounded-lg transition-all ${
              currentPhase === phase.id 
                ? 'bg-slate-100 dark:bg-slate-800 ring-1 ring-slate-300 dark:ring-slate-600' 
                : 'bg-slate-50 dark:bg-slate-900/50'
            }`}
            data-testid={`phase-row-${phase.id}`}
          >
            <div className="flex items-center justify-between mb-1.5">
              <div className="flex items-center gap-2">
                <div className={`w-2 h-2 rounded-full ${phase.color}`} />
                <span className={`text-sm font-semibold ${phase.textColor}`}>{phase.name}</span>
                <span className="text-xs text-slate-400 italic hidden sm:inline">{phase.tagline}</span>
              </div>
              <div className="flex items-center gap-2">
                <span className="text-xs font-medium text-slate-600 dark:text-slate-400">{phase.score}%</span>
                {phase.score === 100 ? (
                  <CheckCircle className="h-3.5 w-3.5 text-green-500" />
                ) : phase.score > 0 ? (
                  <Circle className="h-3.5 w-3.5 text-amber-500" />
                ) : (
                  <AlertCircle className="h-3.5 w-3.5 text-red-500" />
                )}
              </div>
            </div>
            <Progress value={phase.score} className="h-1.5" />
          </div>
        ))}
      </div>
    </div>
  );
}

export default PhaseProgressBar;


========================================
FILE: client/src/components/playbook/PlaybookCustomizationWizard.tsx
========================================
import { useState } from 'react';
import { useMutation } from '@tanstack/react-query';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { Card } from '@/components/ui/card';
import { ChevronLeft, ChevronRight, Check, Lightbulb, Lock } from 'lucide-react';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';

// Step components
import SituationDefinitionStep from './wizard/SituationDefinitionStep';
import StakeholderMatrixStep from './wizard/StakeholderMatrixStep';
import DecisionTreesStep from './wizard/DecisionTreesStep';
import CommunicationTemplatesStep from './wizard/CommunicationTemplatesStep';
import TaskSequencesStep from './wizard/TaskSequencesStep';
import BudgetAuthorityStep from './wizard/BudgetAuthorityStep';
import SuccessMetricsStep from './wizard/SuccessMetricsStep';
import LessonsLearnedStep from './wizard/LessonsLearnedStep';
import PrepareOverviewStep from './wizard/PrepareOverviewStep';
import MonitorTriggersStep from './wizard/MonitorTriggersStep';
import ExecuteTasksStep from './wizard/ExecuteTasksStep';
import LearnConfigStep from './wizard/LearnConfigStep';

interface PlaybookCustomizationWizardProps {
  playbook: any;
  organizationId: string;
  isOpen: boolean;
  onClose: () => void;
}

const STEPS = [
  { id: 1, phase: 'prepare', name: 'PREPARE Overview', prefilled: '85%', component: PrepareOverviewStep, aiTip: 'Configure stakeholders, documents, budgets, and vendor contracts', icon: '', isPhaseOverview: true },
  { id: 2, phase: 'prepare', name: 'Stakeholder Matrix', prefilled: '90%', component: StakeholderMatrixStep, aiTip: 'Define who does what when this playbook activates', icon: '' },
  { id: 3, phase: 'prepare', name: 'Communication Templates', prefilled: '80%', component: CommunicationTemplatesStep, aiTip: 'Pre-write messages for rapid deployment', icon: '' },
  { id: 4, phase: 'prepare', name: 'Budget & Resources', prefilled: '100%', component: BudgetAuthorityStep, aiTip: 'Pre-approve budgets and vendor contracts', icon: '' },
  { id: 5, phase: 'monitor', name: 'MONITOR Triggers', prefilled: '100%', component: MonitorTriggersStep, aiTip: 'Define signals and conditions that activate this playbook', icon: '', isPhaseOverview: true },
  { id: 6, phase: 'execute', name: 'EXECUTE Tasks', prefilled: '75%', component: ExecuteTasksStep, aiTip: 'Define tasks across immediate/coordinate/resolve/close sub-phases', icon: '', isPhaseOverview: true },
  { id: 7, phase: 'execute', name: 'Decision Trees', prefilled: '85%', component: DecisionTreesStep, aiTip: 'Map escalation paths and conditional logic', icon: '' },
  { id: 8, phase: 'learn', name: 'LEARN Activities', prefilled: '80%', component: LearnConfigStep, aiTip: 'Configure post-execution learning and improvement', icon: '', isPhaseOverview: true },
  { id: 9, phase: 'learn', name: 'Success Metrics', prefilled: '80%', component: SuccessMetricsStep, aiTip: 'Define KPIs to measure execution quality', icon: '' },
];

const PHASE_STYLES = {
  prepare: {
    active: 'bg-purple-100 dark:bg-purple-950 text-purple-700 dark:text-purple-300 font-medium ring-1 ring-purple-300 dark:ring-purple-700',
  },
  monitor: {
    active: 'bg-blue-100 dark:bg-blue-950 text-blue-700 dark:text-blue-300 font-medium ring-1 ring-blue-300 dark:ring-blue-700',
  },
  execute: {
    active: 'bg-orange-100 dark:bg-orange-950 text-orange-700 dark:text-orange-300 font-medium ring-1 ring-orange-300 dark:ring-orange-700',
  },
  learn: {
    active: 'bg-green-100 dark:bg-green-950 text-green-700 dark:text-green-300 font-medium ring-1 ring-green-300 dark:ring-green-700',
  },
} as const;

const PHASES = [
  { id: 'prepare' as const, name: 'Prepare', icon: '', steps: [1, 2, 3, 4] },
  { id: 'monitor' as const, name: 'Monitor', icon: '', steps: [5] },
  { id: 'execute' as const, name: 'Execute', icon: '', steps: [6, 7] },
  { id: 'learn' as const, name: 'Learn', icon: '', steps: [8, 9] },
];

export default function PlaybookCustomizationWizard({
  playbook,
  organizationId,
  isOpen,
  onClose,
}: PlaybookCustomizationWizardProps) {
  const [currentStep, setCurrentStep] = useState(1);
  const [formData, setFormData] = useState<any>({
    // Step 1: Situation Definition
    severityScore: playbook?.severityScore || 50,
    timeSensitivity: playbook?.timeSensitivity || 24,
    activationFrequencyTier: playbook?.activationFrequencyTier || 'MEDIUM',
    triggerCriteria: playbook?.triggerCriteria || '',
    triggerDataSources: playbook?.triggerDataSources || [],
    
    // Step 2: Stakeholder Matrix
    tier1Stakeholders: playbook?.tier1Stakeholders || [],
    tier2Stakeholders: playbook?.tier2Stakeholders || [],
    tier3Stakeholders: playbook?.tier3Stakeholders || [],
    externalPartners: playbook?.externalPartners || [],
    
    // Step 3: Decision Trees
    decisionCheckpoints: [],
    escalationPaths: [],
    
    // Step 4: Communication Templates
    communicationTemplates: [],
    
    // Step 5: Task Sequences
    taskSequences: [],
    
    // Step 6: Budget Authority
    preApprovedBudget: playbook?.preApprovedBudget || 0,
    budgetApprovalRequired: playbook?.budgetApprovalRequired !== false,
    vendorContracts: playbook?.vendorContracts || [],
    
    // Step 7: Success Metrics
    targetResponseSpeed: playbook?.targetResponseSpeed || 12,
    targetStakeholderReach: playbook?.targetStakeholderReach || 1.0,
    outcomeMetrics: playbook?.outcomeMetrics || [],
    
    // Step 8: Lessons Learned
    lessonsLearned: [],
  });

  const { toast } = useToast();

  const saveCustomizationMutation = useMutation({
    mutationFn: async (data: any) => {
      return apiRequest('PATCH', `/api/playbook-library/${playbook.id}/customize`, data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library'] });
      toast({
        title: 'Playbook Customized',
        description: 'Your playbook template has been customized successfully',
      });
      onClose();
    },
    onError: () => {
      toast({
        title: 'Error',
        description: 'Failed to save playbook customization',
        variant: 'destructive',
      });
    },
  });

  const handleNext = () => {
    if (currentStep < STEPS.length) {
      setCurrentStep(currentStep + 1);
    }
  };

  const handleBack = () => {
    if (currentStep > 1) {
      setCurrentStep(currentStep - 1);
    }
  };

  const handleSave = () => {
    saveCustomizationMutation.mutate({
      organizationId,
      playbookId: playbook.id,
      customizations: formData,
    });
  };

  const updateFormData = (stepData: any) => {
    setFormData({ ...formData, ...stepData });
  };

  const progress = (currentStep / STEPS.length) * 100;
  const CurrentStepComponent = STEPS[currentStep - 1].component;

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-4xl max-h-[90vh] overflow-hidden flex flex-col" data-testid="dialog-playbook-wizard">
        <DialogHeader>
          <DialogTitle className="flex items-center justify-between">
            <span>Customize Playbook: {playbook?.name}</span>
            <Badge variant="outline" data-testid="badge-progress">
              Step {currentStep} of {STEPS.length}
            </Badge>
          </DialogTitle>
        </DialogHeader>

        {/* Progress Bar with AI Tip */}
        <div className="space-y-2">
          <Progress value={progress} className="h-2" data-testid="progress-wizard" />
          <div className="flex justify-between items-start text-xs text-muted-foreground">
            <div>
              <div>{STEPS[currentStep - 1].name}</div>
              <div className="flex items-center gap-1 mt-1 text-blue-600 dark:text-blue-400">
                <Lightbulb className="w-3 h-3" />
                <span>{STEPS[currentStep - 1].aiTip}</span>
              </div>
            </div>
            <Badge variant="secondary">{STEPS[currentStep - 1].prefilled} Pre-filled</Badge>
          </div>
        </div>

        {/* Phase Indicators */}
        <div className="flex justify-between mb-2 px-2">
          {PHASES.map((phase) => {
            const phaseSteps = STEPS.filter(s => s.phase === phase.id);
            const completedSteps = phaseSteps.filter(s => currentStep > s.id).length;
            const isCurrentPhase = phaseSteps.some(s => s.id === currentStep);
            const isCompleted = completedSteps === phaseSteps.length;
            
            let className = 'flex items-center gap-2 px-3 py-1 rounded-full text-xs transition-colors ';
            if (isCurrentPhase) {
              className += PHASE_STYLES[phase.id].active;
            } else if (isCompleted) {
              className += 'bg-green-100 dark:bg-green-950 text-green-700 dark:text-green-300';
            } else {
              className += 'text-muted-foreground bg-muted/50';
            }
            
            return (
              <div 
                key={phase.id}
                className={className}
                data-testid={`phase-indicator-${phase.id}`}
              >
                <span>{phase.icon}</span>
                <span>{phase.name}</span>
                {isCompleted && <Check className="h-3 w-3" />}
              </div>
            );
          })}
        </div>

        {/* Step Navigation with Drag Hint */}
        <div className="flex gap-2 overflow-x-auto pb-2">
          {STEPS.map((step) => (
            <button
              key={step.id}
              onClick={() => setCurrentStep(step.id)}
              className={`flex-shrink-0 px-3 py-1.5 rounded-md text-xs font-medium transition-colors relative group ${
                currentStep === step.id
                  ? 'bg-primary text-primary-foreground'
                  : currentStep > step.id
                  ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300'
                  : 'bg-muted text-muted-foreground hover:bg-muted/80'
              }`}
              data-testid={`button-step-${step.id}`}
              title={`Step ${step.id}: ${step.name}`}
            >
              {currentStep > step.id && <Check className="h-3 w-3 inline mr-1" />}
              {step.id}. {step.name}
              {currentStep > step.id && <Lock className="h-3 w-3 inline ml-1 opacity-50" />}
            </button>
          ))}
        </div>

        {/* Step Content with Validation */}
        <div className="flex-1 overflow-y-auto py-4 space-y-4">
          {/* Quick Tips Card */}
          <Card className="bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-900 p-3">
            <div className="flex gap-2">
              <Lightbulb className="w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5" />
              <div className="text-sm text-blue-900 dark:text-blue-100">
                <span className="font-semibold">Pro Tip:</span> Customize each section with your organization's specific context, roles, and communication preferences for optimal execution velocity.
              </div>
            </div>
          </Card>
          
          <CurrentStepComponent
            data={formData}
            onChange={updateFormData}
            playbook={playbook}
          />
        </div>

        {/* Action Buttons */}
        <div className="flex justify-between border-t pt-4">
          <Button
            variant="outline"
            onClick={handleBack}
            disabled={currentStep === 1}
            data-testid="button-back"
          >
            <ChevronLeft className="h-4 w-4 mr-1" />
            Back
          </Button>

          <div className="flex gap-2">
            {currentStep < STEPS.length ? (
              <Button onClick={handleNext} data-testid="button-next">
                Next
                <ChevronRight className="h-4 w-4 ml-1" />
              </Button>
            ) : (
              <Button
                onClick={handleSave}
                disabled={saveCustomizationMutation.isPending}
                className="bg-green-600 hover:bg-green-700"
                data-testid="button-save-playbook"
              >
                <Check className="h-4 w-4 mr-1" />
                {saveCustomizationMutation.isPending ? 'Saving...' : 'Save Customization'}
              </Button>
            )}
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
}


========================================
FILE: client/src/components/playbook/PlaybookLearningsPanel.tsx
========================================
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Progress } from "@/components/ui/progress";
import { 
  Brain, 
  TrendingUp, 
  Clock, 
  MessageSquare, 
  Users, 
  Zap,
  GitBranch,
  CheckCircle2,
  AlertCircle,
  Lightbulb,
  History
} from "lucide-react";
import { format } from "date-fns";

interface PlaybookLearning {
  id: string;
  scenarioId: string;
  executionInstanceId: string;
  learning: string;
  category: string;
  impact: string;
  confidence: string;
  status: string;
  extractedAt: string;
  appliedAt?: string;
}

interface PlaybookVersion {
  id: string;
  scenarioId: string;
  versionNumber: number;
  changes: string[];
  createdAt: string;
  createdBy: string;
  metadata: Record<string, any>;
}

interface PlaybookLearningsPanelProps {
  scenarioId: string;
}

export default function PlaybookLearningsPanel({ scenarioId }: PlaybookLearningsPanelProps) {
  const { data: learnings = [], isLoading: learningsLoading } = useQuery<PlaybookLearning[]>({
    queryKey: ['/api/dynamic-strategy/playbook-learnings', scenarioId],
  });

  const getCategoryIcon = (category: string) => {
    switch (category) {
      case 'communication': return <MessageSquare className="h-4 w-4" />;
      case 'timing': return <Clock className="h-4 w-4" />;
      case 'resource_allocation': return <Users className="h-4 w-4" />;
      case 'escalation': return <Zap className="h-4 w-4" />;
      default: return <Lightbulb className="h-4 w-4" />;
    }
  };

  const getCategoryColor = (category: string) => {
    switch (category) {
      case 'communication': return 'text-blue-600 dark:text-blue-400';
      case 'timing': return 'text-purple-600 dark:text-purple-400';
      case 'resource_allocation': return 'text-green-600 dark:text-green-400';
      case 'escalation': return 'text-red-600 dark:text-red-400';
      default: return 'text-slate-600 dark:text-slate-400';
    }
  };

  const getImpactBadge = (impact: string) => {
    const variants: Record<string, "default" | "secondary" | "destructive" | "outline"> = {
      high: 'destructive',
      medium: 'default',
      low: 'secondary'
    };
    return variants[impact] || 'outline';
  };

  const getStatusBadge = (status: string) => {
    const variants: Record<string, "default" | "secondary" | "destructive" | "outline"> = {
      pending: 'outline',
      under_review: 'default',
      applied: 'secondary',
      rejected: 'destructive'
    };
    return variants[status] || 'outline';
  };

  // Ensure learnings is always an array
  const safeLearnings = learnings || [];

  // Group learnings by category
  const learningsByCategory = safeLearnings.reduce((acc, learning) => {
    const category = learning.category || 'other';
    if (!acc[category]) {
      acc[category] = [];
    }
    acc[category].push(learning);
    return acc;
  }, {} as Record<string, PlaybookLearning[]>);

  const categories = Object.keys(learningsByCategory);

  // Calculate learning stats
  const totalLearnings = safeLearnings.length;
  const appliedLearnings = safeLearnings.filter(l => l.status === 'applied').length;
  const pendingLearnings = safeLearnings.filter(l => l.status === 'pending' || l.status === 'under_review').length;
  const avgConfidence = safeLearnings.length > 0 
    ? safeLearnings.reduce((sum, l) => sum + parseFloat(l.confidence), 0) / safeLearnings.length 
    : 0;

  return (
    <div className="space-y-6">
      {/* Learning Statistics */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <Card>
          <CardContent className="pt-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-slate-600 dark:text-slate-400">Total Learnings</p>
                <p className="text-3xl font-bold text-slate-900 dark:text-white">{totalLearnings}</p>
              </div>
              <Brain className="h-8 w-8 text-blue-500" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="pt-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-slate-600 dark:text-slate-400">Applied</p>
                <p className="text-3xl font-bold text-green-600 dark:text-green-400">{appliedLearnings}</p>
              </div>
              <CheckCircle2 className="h-8 w-8 text-green-500" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="pt-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-slate-600 dark:text-slate-400">Pending Review</p>
                <p className="text-3xl font-bold text-yellow-600 dark:text-yellow-400">{pendingLearnings}</p>
              </div>
              <AlertCircle className="h-8 w-8 text-yellow-500" />
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="pt-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-slate-600 dark:text-slate-400">Avg Confidence</p>
                <p className="text-3xl font-bold text-purple-600 dark:text-purple-400">
                  {(avgConfidence * 100).toFixed(0)}%
                </p>
              </div>
              <TrendingUp className="h-8 w-8 text-purple-500" />
            </div>
            <Progress value={avgConfidence * 100} className="h-2 mt-2" />
          </CardContent>
        </Card>
      </div>

      {/* Learnings by Category */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Brain className="h-5 w-5 text-blue-600" />
            AI-Extracted Learnings
          </CardTitle>
          <CardDescription>
            Automatically captured insights from past executions
          </CardDescription>
        </CardHeader>
        <CardContent>
          {learningsLoading ? (
            <div className="flex items-center justify-center py-12">
              <div className="text-center">
                <Brain className="h-12 w-12 text-slate-400 mx-auto mb-4 animate-pulse" />
                <p className="text-slate-600 dark:text-slate-400">Loading learnings...</p>
              </div>
            </div>
          ) : safeLearnings.length === 0 ? (
            <div className="flex items-center justify-center py-12">
              <div className="text-center">
                <Lightbulb className="h-12 w-12 text-slate-400 mx-auto mb-4" />
                <p className="text-slate-600 dark:text-slate-400">No learnings captured yet</p>
                <p className="text-sm text-slate-500 mt-2">
                  Execute this playbook to start building institutional knowledge
                </p>
              </div>
            </div>
          ) : (
            <Tabs defaultValue={categories[0] || 'all'} className="space-y-4">
              <TabsList className="grid w-full" style={{ gridTemplateColumns: `repeat(${categories.length}, 1fr)` }}>
                {categories.map((category) => (
                  <TabsTrigger 
                    key={category} 
                    value={category}
                    className="gap-2"
                    data-testid={`tab-learning-${category}`}
                  >
                    <span className={getCategoryColor(category)}>
                      {getCategoryIcon(category)}
                    </span>
                    <span className="capitalize">{category.replace('_', ' ')}</span>
                    <Badge variant="outline" className="ml-1">
                      {learningsByCategory[category].length}
                    </Badge>
                  </TabsTrigger>
                ))}
              </TabsList>

              {categories.map((category) => (
                <TabsContent key={category} value={category} className="space-y-4">
                  <ScrollArea className="h-[400px]">
                    <div className="space-y-3">
                      {learningsByCategory[category].map((learning) => (
                        <Card key={learning.id} className="border-l-4" style={{
                          borderLeftColor: category === 'communication' ? '#3b82f6' :
                                         category === 'timing' ? '#a855f7' :
                                         category === 'resource_allocation' ? '#22c55e' :
                                         category === 'escalation' ? '#ef4444' : '#64748b'
                        }}>
                          <CardContent className="pt-4">
                            <div className="flex items-start justify-between mb-3">
                              <div className="flex-1">
                                <div className="flex items-center gap-2 mb-2">
                                  <Badge variant={getStatusBadge(learning.status)}>
                                    {learning.status.replace('_', ' ')}
                                  </Badge>
                                  <Badge variant={getImpactBadge(learning.impact)}>
                                    {learning.impact} impact
                                  </Badge>
                                  <Badge variant="outline">
                                    {(parseFloat(learning.confidence) * 100).toFixed(0)}% confidence
                                  </Badge>
                                </div>
                                <p className="text-slate-900 dark:text-white font-medium">
                                  {learning.learning}
                                </p>
                                <div className="flex items-center gap-4 mt-2 text-xs text-slate-500">
                                  <span className="flex items-center gap-1">
                                    <Clock className="h-3 w-3" />
                                    {format(new Date(learning.extractedAt), 'PPp')}
                                  </span>
                                  {learning.appliedAt && (
                                    <span className="flex items-center gap-1 text-green-600">
                                      <CheckCircle2 className="h-3 w-3" />
                                      Applied {format(new Date(learning.appliedAt), 'PP')}
                                    </span>
                                  )}
                                </div>
                              </div>
                            </div>
                            {learning.status === 'pending' && (
                              <div className="flex gap-2 mt-3">
                                <Button 
                                  size="sm" 
                                  variant="outline"
                                  className="gap-2"
                                  data-testid={`button-apply-learning-${learning.id}`}
                                >
                                  <CheckCircle2 className="h-4 w-4" />
                                  Apply to Playbook
                                </Button>
                                <Button 
                                  size="sm" 
                                  variant="ghost"
                                  data-testid={`button-review-learning-${learning.id}`}
                                >
                                  Review Later
                                </Button>
                              </div>
                            )}
                          </CardContent>
                        </Card>
                      ))}
                    </div>
                  </ScrollArea>
                </TabsContent>
              ))}
            </Tabs>
          )}
        </CardContent>
      </Card>

      {/* Version History Placeholder */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <GitBranch className="h-5 w-5 text-purple-600" />
            Version History
          </CardTitle>
          <CardDescription>
            Track playbook evolution over time
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-center py-12">
            <div className="text-center">
              <History className="h-12 w-12 text-slate-400 mx-auto mb-4" />
              <p className="text-slate-600 dark:text-slate-400">Version tracking coming soon</p>
              <p className="text-sm text-slate-500 mt-2">
                Playbook changes will be automatically versioned
              </p>
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/playbook/PlaybookReadinessDashboard.tsx
========================================
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Skeleton } from '@/components/ui/skeleton';
import { 
  Shield, Target, Radar, Zap, BookOpen, 
  TrendingUp, AlertTriangle, CheckCircle2, Clock,
  Users, FileText, DollarSign, Bell, RefreshCw
} from 'lucide-react';
import { Button } from '@/components/ui/button';

interface PlaybookReadinessDashboardProps {
  playbookId: string;
  organizationId: string;
  compact?: boolean;
}

const PHASE_CONFIG = {
  identify: { name: 'IDENTIFY', icon: Target, color: 'violet', description: 'Pre-execution readiness' },
  detect: { name: 'DETECT', icon: Radar, color: 'blue', description: 'Trigger monitoring' },
  execute: { name: 'EXECUTE', icon: Zap, color: 'emerald', description: 'Execution capability' },
  advance: { name: 'ADVANCE', icon: BookOpen, color: 'amber', description: 'Learning infrastructure' },
};

function PhaseScoreCard({ 
  phase, 
  score, 
  items 
}: { 
  phase: keyof typeof PHASE_CONFIG; 
  score: number; 
  items?: { completed?: number; total?: number; active?: number; configured?: number } 
}) {
  const config = PHASE_CONFIG[phase];
  const Icon = config.icon;
  
  const getStatusBadge = () => {
    if (score >= 80) return <Badge variant="default" className="bg-green-600 text-xs">Ready</Badge>;
    if (score >= 50) return <Badge variant="secondary" className="text-xs">Partial</Badge>;
    return <Badge variant="outline" className="text-xs text-amber-600 border-amber-600">Setup Needed</Badge>;
  };

  const getItemStatus = () => {
    if (phase === 'identify' && items) {
      return `${items.completed ?? 0}/${items.total ?? 0} items`;
    }
    if (phase === 'detect' && items) {
      return `${items.active ?? 0}/${items.total ?? 0} active`;
    }
    if (phase === 'advance' && items) {
      return `${items.configured ?? 0} configured`;
    }
    return null;
  };

  return (
    <Card className="overflow-hidden">
      <CardContent className="p-4">
        <div className="flex items-start justify-between mb-3">
          <div className="flex items-center gap-2">
            <div className={`p-2 rounded-lg bg-${config.color}-100 dark:bg-${config.color}-900/30`}>
              <Icon className={`w-4 h-4 text-${config.color}-600 dark:text-${config.color}-400`} />
            </div>
            <div>
              <div className="font-semibold text-sm">{config.name}</div>
              <div className="text-xs text-muted-foreground">{config.description}</div>
            </div>
          </div>
          {getStatusBadge()}
        </div>
        <div className="space-y-2">
          <div className="flex justify-between items-center">
            <span className="text-2xl font-bold">{score}%</span>
            {getItemStatus() && (
              <span className="text-xs text-muted-foreground">{getItemStatus()}</span>
            )}
          </div>
          <Progress value={score} className="h-2" />
        </div>
      </CardContent>
    </Card>
  );
}

function ReadinessMetricCard({ icon: Icon, label, value, subtext }: { icon: any; label: string; value: string | number; subtext?: string }) {
  return (
    <div className="flex items-center gap-3 p-3 bg-muted/30 rounded-lg">
      <Icon className="w-5 h-5 text-muted-foreground" />
      <div>
        <div className="text-xs text-muted-foreground">{label}</div>
        <div className="font-semibold">{value}</div>
        {subtext && <div className="text-xs text-muted-foreground">{subtext}</div>}
      </div>
    </div>
  );
}

export default function PlaybookReadinessDashboard({
  playbookId,
  organizationId,
  compact = false,
}: PlaybookReadinessDashboardProps) {
  const { data: readinessData, isLoading, refetch } = useQuery({
    queryKey: ['/api/playbook-library', playbookId, 'readiness', { organizationId }],
    queryFn: async () => {
      const res = await fetch(`/api/playbook-library/${playbookId}/readiness?organizationId=${organizationId}`);
      if (!res.ok) throw new Error('Failed to fetch readiness');
      return res.json();
    },
    enabled: !!playbookId && !!organizationId,
  });

  if (isLoading) {
    return (
      <Card>
        <CardHeader>
          <Skeleton className="h-6 w-48" />
        </CardHeader>
        <CardContent className="space-y-4">
          <Skeleton className="h-24 w-full" />
          <div className="grid grid-cols-2 gap-4">
            <Skeleton className="h-20" />
            <Skeleton className="h-20" />
            <Skeleton className="h-20" />
            <Skeleton className="h-20" />
          </div>
        </CardContent>
      </Card>
    );
  }

  const score = readinessData?.score;
  const breakdown = readinessData?.breakdown;
  const overallScore = score?.overallScore ?? 0;

  const getOverallStatus = () => {
    if (overallScore >= 80) return { label: 'Fully Ready', color: 'green', icon: CheckCircle2 };
    if (overallScore >= 60) return { label: 'Mostly Ready', color: 'blue', icon: TrendingUp };
    if (overallScore >= 40) return { label: 'Needs Attention', color: 'amber', icon: AlertTriangle };
    return { label: 'Setup Required', color: 'red', icon: Clock };
  };

  const status = getOverallStatus();
  const StatusIcon = status.icon;

  if (compact) {
    return (
      <div className="flex items-center gap-4 p-4 bg-gradient-to-r from-slate-900 to-slate-800 text-white rounded-lg">
        <div className="text-center">
          <div className={`text-3xl font-bold text-${status.color}-400`}>{overallScore}%</div>
          <div className="text-xs text-slate-400">Readiness</div>
        </div>
        <div className="flex-1 grid grid-cols-4 gap-2 text-xs">
          <div className="text-center">
            <div className="text-violet-400">{score?.prepareScore ?? 0}%</div>
            <div className="text-slate-500">IDENTIFY</div>
          </div>
          <div className="text-center">
            <div className="text-blue-400">{score?.monitorScore ?? 0}%</div>
            <div className="text-slate-500">DETECT</div>
          </div>
          <div className="text-center">
            <div className="text-emerald-400">{score?.executeScore ?? 0}%</div>
            <div className="text-slate-500">EXECUTE</div>
          </div>
          <div className="text-center">
            <div className="text-amber-400">{score?.learnScore ?? 0}%</div>
            <div className="text-slate-500">ADVANCE</div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <Card className="bg-gradient-to-br from-slate-900 to-slate-800 text-white border-0">
        <CardHeader className="pb-3">
          <div className="flex items-center justify-between">
            <CardTitle className="flex items-center gap-2 text-lg">
              <Shield className="w-5 h-5" />
              Playbook Readiness Score
            </CardTitle>
            <Button 
              variant="ghost" 
              size="sm" 
              onClick={() => refetch()}
              className="text-white hover:bg-white/10"
              data-testid="button-refresh-readiness"
            >
              <RefreshCw className="w-4 h-4" />
            </Button>
          </div>
        </CardHeader>
        <CardContent>
          <div className="flex items-center gap-6">
            <div className="text-center">
              <div className={`text-6xl font-bold text-${status.color}-400`}>{overallScore}%</div>
              <div className="flex items-center justify-center gap-1 mt-1">
                <StatusIcon className={`w-4 h-4 text-${status.color}-400`} />
                <span className={`text-sm text-${status.color}-400`}>{status.label}</span>
              </div>
            </div>
            <div className="flex-1 h-24 flex items-end gap-2">
              {[
                { phase: 'identify', score: score?.prepareScore ?? 0 },
                { phase: 'detect', score: score?.monitorScore ?? 0 },
                { phase: 'execute', score: score?.executeScore ?? 0 },
                { phase: 'advance', score: score?.learnScore ?? 0 },
              ].map(({ phase, score: phaseScore }) => {
                const config = PHASE_CONFIG[phase as keyof typeof PHASE_CONFIG];
                return (
                  <div key={phase} className="flex-1 flex flex-col items-center">
                    <div 
                      className={`w-full bg-${config.color}-600 rounded-t-sm transition-all duration-500`}
                      style={{ height: `${Math.max(phaseScore * 0.8, 4)}px` }}
                    />
                    <div className="text-[10px] text-slate-400 mt-1">{config.name}</div>
                    <div className="text-xs font-semibold">{phaseScore}%</div>
                  </div>
                );
              })}
            </div>
          </div>

          <div className="grid grid-cols-4 gap-3 mt-4 pt-4 border-t border-slate-700">
            <ReadinessMetricCard 
              icon={Users} 
              label="Stakeholders" 
              value={`${score?.stakeholdersAssigned ?? 0}/${score?.stakeholdersTotal ?? 0}`}
            />
            <ReadinessMetricCard 
              icon={FileText} 
              label="Documents" 
              value={`${score?.documentsReady ?? 0}/${score?.documentsTotal ?? 0}`}
            />
            <ReadinessMetricCard 
              icon={Bell} 
              label="Triggers" 
              value={`${score?.triggersActive ?? 0}/${score?.triggersConfigured ?? 0}`}
            />
            <ReadinessMetricCard 
              icon={DollarSign} 
              label="Resources" 
              value={`${score?.resourcesStaged ?? 0}/${score?.resourcesTotal ?? 0}`}
            />
          </div>
        </CardContent>
      </Card>

      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <PhaseScoreCard 
          phase="identify" 
          score={score?.prepareScore ?? 0} 
          items={{ completed: breakdown?.prepare?.completed, total: breakdown?.prepare?.total }}
        />
        <PhaseScoreCard 
          phase="detect" 
          score={score?.monitorScore ?? 0}
          items={{ active: breakdown?.monitor?.active, total: breakdown?.monitor?.total }}
        />
        <PhaseScoreCard 
          phase="execute" 
          score={score?.executeScore ?? 0}
        />
        <PhaseScoreCard 
          phase="advance" 
          score={score?.learnScore ?? 0}
          items={{ configured: breakdown?.learn?.configured }}
        />
      </div>

      <Card>
        <CardHeader className="pb-3">
          <CardTitle className="text-sm font-medium">Weight Distribution</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="flex gap-1 h-4 rounded-full overflow-hidden">
            <div 
              className="bg-violet-500 flex items-center justify-center text-[10px] text-white font-medium"
              style={{ width: `${score?.prepareWeight ?? 40}%` }}
            >
              {score?.prepareWeight ?? 40}%
            </div>
            <div 
              className="bg-blue-500 flex items-center justify-center text-[10px] text-white font-medium"
              style={{ width: `${score?.monitorWeight ?? 20}%` }}
            >
              {score?.monitorWeight ?? 20}%
            </div>
            <div 
              className="bg-emerald-500 flex items-center justify-center text-[10px] text-white font-medium"
              style={{ width: `${score?.executeWeight ?? 30}%` }}
            >
              {score?.executeWeight ?? 30}%
            </div>
            <div 
              className="bg-amber-500 flex items-center justify-center text-[10px] text-white font-medium"
              style={{ width: `${score?.learnWeight ?? 10}%` }}
            >
              {score?.learnWeight ?? 10}%
            </div>
          </div>
          <div className="flex justify-between mt-2 text-xs text-muted-foreground">
            <span>IDENTIFY</span>
            <span>DETECT</span>
            <span>EXECUTE</span>
            <span>ADVANCE</span>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/playbook/PreparePhaseView.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Checkbox } from '@/components/ui/checkbox';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import {
  Users,
  FileText,
  DollarSign,
  Building2,
  MessageSquare,
  Package,
  Plus,
  CheckCircle2,
  Circle,
  Clock,
  AlertCircle,
  ChevronDown,
  ChevronUp,
  Trash2,
} from 'lucide-react';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';

interface PreparePhaseViewProps {
  playbookId: string;
  organizationId: string;
  isEditable?: boolean;
}

type PrepareItemType = 
  | 'stakeholder_assignment'
  | 'document_template'
  | 'vendor_contract'
  | 'budget_approval'
  | 'communication_template'
  | 'resource_staging';

interface PrepareItem {
  id: string;
  playbookId: string;
  organizationId: string;
  itemType: PrepareItemType;
  title: string;
  description?: string;
  responsibleRole?: string;
  status: 'not_started' | 'in_progress' | 'completed';
  priority: 'critical' | 'high' | 'medium' | 'low';
  isRequired: boolean;
  sequence: number;
  completedAt?: string;
  completedBy?: string;
}

const ITEM_TYPE_CONFIG: Record<PrepareItemType, { icon: any; label: string; color: string }> = {
  stakeholder_assignment: { icon: Users, label: 'Stakeholder Assignment', color: 'text-blue-500' },
  document_template: { icon: FileText, label: 'Document Template', color: 'text-green-500' },
  vendor_contract: { icon: Building2, label: 'Vendor Contract', color: 'text-purple-500' },
  budget_approval: { icon: DollarSign, label: 'Budget Approval', color: 'text-yellow-500' },
  communication_template: { icon: MessageSquare, label: 'Communication Template', color: 'text-indigo-500' },
  resource_staging: { icon: Package, label: 'Resource Staging', color: 'text-orange-500' },
};

const PRIORITY_CONFIG = {
  critical: { label: 'Critical', color: 'bg-red-100 text-red-700 dark:bg-red-950 dark:text-red-300' },
  high: { label: 'High', color: 'bg-orange-100 text-orange-700 dark:bg-orange-950 dark:text-orange-300' },
  medium: { label: 'Medium', color: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-950 dark:text-yellow-300' },
  low: { label: 'Low', color: 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300' },
};

const STATUS_CONFIG = {
  not_started: { label: 'Not Started', icon: Circle, color: 'text-slate-400' },
  in_progress: { label: 'In Progress', icon: Clock, color: 'text-yellow-500' },
  completed: { label: 'Completed', icon: CheckCircle2, color: 'text-green-500' },
};

export function PreparePhaseView({ playbookId, organizationId, isEditable = true }: PreparePhaseViewProps) {
  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);
  const [expandedItems, setExpandedItems] = useState<Set<string>>(new Set());
  const [newItem, setNewItem] = useState<{
    itemType: PrepareItemType;
    title: string;
    description: string;
    responsibleRole: string;
    priority: 'critical' | 'high' | 'medium' | 'low';
    isRequired: boolean;
  }>({
    itemType: 'stakeholder_assignment',
    title: '',
    description: '',
    responsibleRole: '',
    priority: 'high',
    isRequired: true,
  });
  const { toast } = useToast();

  const { data: items = [], isLoading } = useQuery<PrepareItem[]>({
    queryKey: ['/api/playbook-library', playbookId, 'prepare-items', { organizationId }],
    queryFn: async () => {
      const response = await fetch(
        `/api/playbook-library/${playbookId}/prepare-items?organizationId=${organizationId}`
      );
      if (!response.ok) throw new Error('Failed to fetch prepare items');
      return response.json();
    },
    enabled: !!playbookId && !!organizationId,
  });

  const createItemMutation = useMutation({
    mutationFn: async (data: Partial<PrepareItem>) => {
      const response = await apiRequest('POST', `/api/playbook-library/${playbookId}/prepare-items`, {
        ...data,
        organizationId,
        sequence: items.length + 1,
        status: 'not_started',
      });
      return response.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbookId, 'prepare-items'] });
      setIsAddDialogOpen(false);
      setNewItem({
        itemType: 'stakeholder_assignment',
        title: '',
        description: '',
        responsibleRole: '',
        priority: 'high',
        isRequired: true,
      });
      toast({ title: 'Prepare item added', description: 'The item has been added to your playbook.' });
    },
    onError: () => {
      toast({ title: 'Error', description: 'Failed to add prepare item.', variant: 'destructive' });
    },
  });

  const completeItemMutation = useMutation({
    mutationFn: async (itemId: string) => {
      const response = await apiRequest(
        'PATCH',
        `/api/playbook-library/${playbookId}/prepare-items/${itemId}/complete`,
        { completedBy: 'current-user' }
      );
      return response.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbookId, 'prepare-items'] });
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbookId, 'readiness'] });
      toast({ title: 'Item completed', description: 'Readiness score updated.' });
    },
  });

  const deleteItemMutation = useMutation({
    mutationFn: async (itemId: string) => {
      await apiRequest('DELETE', `/api/playbook-library/${playbookId}/prepare-items/${itemId}`);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/playbook-library', playbookId, 'prepare-items'] });
      toast({ title: 'Item deleted' });
    },
  });

  const toggleExpanded = (itemId: string) => {
    const newExpanded = new Set(expandedItems);
    if (newExpanded.has(itemId)) {
      newExpanded.delete(itemId);
    } else {
      newExpanded.add(itemId);
    }
    setExpandedItems(newExpanded);
  };

  const completedCount = items.filter((i) => i.status === 'completed').length;
  const requiredItems = items.filter((i) => i.isRequired);
  const requiredCompleted = requiredItems.filter((i) => i.status === 'completed').length;
  const progressPercent = items.length > 0 ? Math.round((completedCount / items.length) * 100) : 0;

  const groupedItems = items.reduce((acc, item) => {
    if (!acc[item.itemType]) acc[item.itemType] = [];
    acc[item.itemType].push(item);
    return acc;
  }, {} as Record<PrepareItemType, PrepareItem[]>);

  if (isLoading) {
    return (
      <div className="space-y-4 animate-pulse">
        <div className="h-24 bg-slate-200 dark:bg-slate-800 rounded-lg" />
        <div className="h-48 bg-slate-200 dark:bg-slate-800 rounded-lg" />
      </div>
    );
  }

  return (
    <div className="space-y-6" data-testid="prepare-phase-view">
      <Card>
        <CardHeader>
          <div className="flex items-center justify-between">
            <div>
              <CardTitle className="flex items-center gap-2">
                <span className="text-2xl"></span>
                IDENTIFY Phase  Build Your Depth Chart
              </CardTitle>
              <CardDescription>
                Assign stakeholders, stage documents, and configure resources before activation
              </CardDescription>
            </div>
            <Badge
              variant={progressPercent >= 80 ? 'default' : progressPercent >= 50 ? 'secondary' : 'destructive'}
              className="text-lg px-3 py-1"
              data-testid="prepare-progress-badge"
            >
              {progressPercent}%
            </Badge>
          </div>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            <div className="flex items-center gap-4 text-sm text-muted-foreground">
              <span>{completedCount} of {items.length} items complete</span>
              <span></span>
              <span className="text-amber-500">
                {requiredCompleted}/{requiredItems.length} required
              </span>
            </div>
            <Progress value={progressPercent} className="h-3" data-testid="prepare-progress-bar" />
          </div>
        </CardContent>
      </Card>

      {Object.entries(groupedItems).map(([type, typeItems]) => {
        const config = ITEM_TYPE_CONFIG[type as PrepareItemType];
        const Icon = config.icon;

        return (
          <Card key={type} data-testid={`prepare-section-${type}`}>
            <CardHeader className="pb-3">
              <CardTitle className="text-base flex items-center gap-2">
                <Icon className={`h-5 w-5 ${config.color}`} />
                {config.label}
                <Badge variant="outline" className="ml-auto">
                  {typeItems.filter((i) => i.status === 'completed').length}/{typeItems.length}
                </Badge>
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-2">
              {typeItems.map((item) => {
                const statusConfig = STATUS_CONFIG[item.status];
                const StatusIcon = statusConfig.icon;
                const isExpanded = expandedItems.has(item.id);

                return (
                  <div
                    key={item.id}
                    className={`border rounded-lg p-3 transition-all ${
                      item.status === 'completed'
                        ? 'bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800'
                        : 'bg-card border-border hover:border-blue-300 dark:hover:border-blue-700'
                    }`}
                    data-testid={`prepare-item-${item.id}`}
                  >
                    <div className="flex items-center gap-3">
                      {isEditable && item.status !== 'completed' && (
                        <Checkbox
                          checked={false}
                          onCheckedChange={() => completeItemMutation.mutate(item.id)}
                          data-testid={`checkbox-${item.id}`}
                        />
                      )}
                      {item.status === 'completed' && (
                        <CheckCircle2 className="h-5 w-5 text-green-500 shrink-0" />
                      )}
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2">
                          <span className="font-medium truncate">{item.title}</span>
                          {item.isRequired && (
                            <Badge variant="outline" className="text-xs shrink-0">
                              Required
                            </Badge>
                          )}
                          <Badge className={`text-xs shrink-0 ${PRIORITY_CONFIG[item.priority].color}`}>
                            {PRIORITY_CONFIG[item.priority].label}
                          </Badge>
                        </div>
                        {item.responsibleRole && (
                          <span className="text-xs text-muted-foreground">
                            Responsible: {item.responsibleRole}
                          </span>
                        )}
                      </div>
                      <StatusIcon className={`h-4 w-4 ${statusConfig.color} shrink-0`} />
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={() => toggleExpanded(item.id)}
                        data-testid={`expand-${item.id}`}
                      >
                        {isExpanded ? <ChevronUp className="h-4 w-4" /> : <ChevronDown className="h-4 w-4" />}
                      </Button>
                    </div>
                    {isExpanded && (
                      <div className="mt-3 pt-3 border-t text-sm text-muted-foreground">
                        <p>{item.description || 'No description provided.'}</p>
                        {item.completedAt && (
                          <p className="mt-2 text-xs">
                            Completed: {new Date(item.completedAt).toLocaleDateString()}
                          </p>
                        )}
                        {isEditable && (
                          <Button
                            variant="ghost"
                            size="sm"
                            className="mt-2 text-red-500 hover:text-red-600"
                            onClick={() => deleteItemMutation.mutate(item.id)}
                            data-testid={`delete-${item.id}`}
                          >
                            <Trash2 className="h-4 w-4 mr-1" /> Delete
                          </Button>
                        )}
                      </div>
                    )}
                  </div>
                );
              })}
            </CardContent>
          </Card>
        );
      })}

      {items.length === 0 && (
        <Card className="border-dashed">
          <CardContent className="py-12 text-center">
            <AlertCircle className="h-12 w-12 mx-auto mb-4 text-muted-foreground" />
            <h3 className="font-medium mb-2">No Prepare Items Configured</h3>
            <p className="text-sm text-muted-foreground mb-4">
              Add stakeholder assignments, document templates, and resource staging to prepare for execution.
            </p>
            {isEditable && (
              <Button onClick={() => setIsAddDialogOpen(true)} data-testid="button-add-first-item">
                <Plus className="h-4 w-4 mr-2" /> Add First Item
              </Button>
            )}
          </CardContent>
        </Card>
      )}

      {isEditable && items.length > 0 && (
        <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>
          <DialogTrigger asChild>
            <Button className="w-full" variant="outline" data-testid="button-add-prepare-item">
              <Plus className="h-4 w-4 mr-2" /> Add Prepare Item
            </Button>
          </DialogTrigger>
          <DialogContent>
            <DialogHeader>
              <DialogTitle>Add Prepare Item</DialogTitle>
              <DialogDescription>
                Configure a new preparation item for this playbook.
              </DialogDescription>
            </DialogHeader>
            <div className="space-y-4 py-4">
              <div className="space-y-2">
                <Label>Item Type</Label>
                <Select
                  value={newItem.itemType}
                  onValueChange={(v) => setNewItem({ ...newItem, itemType: v as PrepareItemType })}
                >
                  <SelectTrigger data-testid="select-item-type">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    {Object.entries(ITEM_TYPE_CONFIG).map(([type, config]) => (
                      <SelectItem key={type} value={type}>
                        {config.label}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
              <div className="space-y-2">
                <Label>Title</Label>
                <Input
                  value={newItem.title}
                  onChange={(e) => setNewItem({ ...newItem, title: e.target.value })}
                  placeholder="e.g., Assign General Counsel as lead"
                  data-testid="input-title"
                />
              </div>
              <div className="space-y-2">
                <Label>Description</Label>
                <Textarea
                  value={newItem.description}
                  onChange={(e) => setNewItem({ ...newItem, description: e.target.value })}
                  placeholder="Describe what needs to be done..."
                  data-testid="input-description"
                />
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label>Responsible Role</Label>
                  <Input
                    value={newItem.responsibleRole}
                    onChange={(e) => setNewItem({ ...newItem, responsibleRole: e.target.value })}
                    placeholder="e.g., Legal, Finance"
                    data-testid="input-role"
                  />
                </div>
                <div className="space-y-2">
                  <Label>Priority</Label>
                  <Select
                    value={newItem.priority}
                    onValueChange={(v) => setNewItem({ ...newItem, priority: v as 'critical' | 'high' | 'medium' | 'low' })}
                  >
                    <SelectTrigger data-testid="select-priority">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="critical">Critical</SelectItem>
                      <SelectItem value="high">High</SelectItem>
                      <SelectItem value="medium">Medium</SelectItem>
                      <SelectItem value="low">Low</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>
              <div className="flex items-center gap-2">
                <Checkbox
                  id="isRequired"
                  checked={newItem.isRequired}
                  onCheckedChange={(checked) => setNewItem({ ...newItem, isRequired: !!checked })}
                  data-testid="checkbox-required"
                />
                <Label htmlFor="isRequired">Required for activation</Label>
              </div>
            </div>
            <DialogFooter>
              <Button variant="outline" onClick={() => setIsAddDialogOpen(false)}>
                Cancel
              </Button>
              <Button
                onClick={() => createItemMutation.mutate(newItem)}
                disabled={!newItem.title || createItemMutation.isPending}
                data-testid="button-save-item"
              >
                {createItemMutation.isPending ? 'Saving...' : 'Add Item'}
              </Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>
      )}
    </div>
  );
}

export default PreparePhaseView;


========================================
FILE: client/src/components/demo/AIRadarSimulation.tsx
========================================
import { useState, useEffect } from 'react';
import { Card } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { AlertTriangle, TrendingDown, Activity } from 'lucide-react';
import { aiDataStreams } from '@shared/luxury-demo-data';

interface DataStream {
  id: string;
  name: string;
  description: string;
  status: string;
}

interface AIRadarSimulationProps {
  title?: string;
  subtitle?: string;
  dataStreams?: DataStream[];
  playbookId?: string;
  playbookName?: string;
  onTriggerFired?: () => void;
  autoStart?: boolean;
}

export default function AIRadarSimulation({ 
  title = "AI Intelligence Monitoring",
  subtitle = "Real-time crisis detection across data streams",
  dataStreams: customDataStreams,
  playbookId = "#044",
  playbookName = "Revenue Shortfall - Asia Pacific",
  onTriggerFired, 
  autoStart = false 
}: AIRadarSimulationProps) {
  const [confidence, setConfidence] = useState(65);
  const [isMonitoring, setIsMonitoring] = useState(false);
  const [triggered, setTriggered] = useState(false);
  
  // Use custom data streams if provided, otherwise fall back to default luxury demo data
  const initialStreams = customDataStreams || aiDataStreams;
  const [streams, setStreams] = useState(initialStreams.map(s => ({ ...s, confidence: 65 })));

  useEffect(() => {
    if (autoStart) {
      setIsMonitoring(true);
    }
  }, [autoStart]);

  useEffect(() => {
    if (!isMonitoring || triggered) return;

    const interval = setInterval(() => {
      setConfidence(prev => {
        const next = Math.min(prev + Math.random() * 3, 95);
        
        // Fire trigger at 88%
        if (next >= 88 && !triggered) {
          setTriggered(true);
          setTimeout(() => {
            onTriggerFired?.();
          }, 500);
        }
        
        return next;
      });

      // Update stream statuses
      setStreams(prev => prev.map(stream => ({
        ...stream,
        confidence: Math.min(stream.confidence + Math.random() * 5, 95)
      })));
    }, 800);

    return () => clearInterval(interval);
  }, [isMonitoring, triggered, onTriggerFired]);

  const getConfidenceColor = (conf: number) => {
    if (conf >= 85) return 'text-red-600 dark:text-red-400';
    if (conf >= 70) return 'text-yellow-600 dark:text-yellow-400';
    return 'text-green-600 dark:text-green-400';
  };

  const getStreamStatus = (conf: number) => {
    if (conf >= 85) return 'critical';
    if (conf >= 70) return 'warning';
    return 'normal';
  };

  return (
    <div className="space-y-6">
      <div className="text-center mb-6">
        <h2 className="text-3xl font-bold text-white mb-2">{title}</h2>
        <p className="text-xl text-blue-200">{subtitle}</p>
      </div>

      {/* Main Confidence Meter */}
      <Card className={`p-6 bg-slate-900/50 border-blue-800/30 ${triggered ? 'border-red-500 border-2 animate-pulse' : ''}`}>
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-2">
            <Activity className={`h-5 w-5 ${isMonitoring ? 'animate-pulse text-green-500' : 'text-blue-400'}`} />
            <h3 className="font-semibold text-white">AI Trigger Monitoring</h3>
          </div>
          <Badge variant={triggered ? 'destructive' : isMonitoring ? 'default' : 'outline'} data-testid="badge-monitoring">
            {triggered ? ' TRIGGERED' : isMonitoring ? ' Live' : ' Inactive'}
          </Badge>
        </div>

        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <span className="text-sm text-muted-foreground">Trigger Confidence</span>
            <span className={`text-2xl font-bold ${getConfidenceColor(confidence)}`} data-testid="text-confidence">
              {confidence.toFixed(1)}%
            </span>
          </div>
          
          <Progress value={confidence} className="h-3" data-testid="progress-confidence" />
          
          <div className="flex items-center justify-between text-xs text-muted-foreground">
            <span>Threshold: 85%</span>
            {triggered && (
              <span className="text-red-600 dark:text-red-400 font-semibold flex items-center gap-1">
                <AlertTriangle className="h-3 w-3" />
                THRESHOLD EXCEEDED
              </span>
            )}
          </div>
        </div>
      </Card>

      {/* Trigger Alert */}
      {triggered && (
        <Card className="p-6 bg-red-950/50 border-red-500 border-2 animate-pulse" data-testid="card-trigger-alert">
          <div className="flex items-start gap-4">
            <div className="p-2 bg-red-500 rounded-full">
              <AlertTriangle className="h-6 w-6 text-white" />
            </div>
            <div className="flex-1">
              <h4 className="font-bold text-lg mb-1 text-white">Playbook {playbookId} Recommended</h4>
              <p className="text-sm text-red-200 mb-3">
                {playbookName}
              </p>
              <div className="bg-slate-900/50 p-3 rounded border border-red-800/30">
                <p className="text-xs font-mono text-red-200">
                  <TrendingDown className="inline h-3 w-3 mr-1" />
                  Confidence: {confidence.toFixed(1)}% | Playbook activation recommended
                </p>
              </div>
            </div>
          </div>
        </Card>
      )}

      {/* Data Streams */}
      <Card className="p-6">
        <h4 className="font-semibold mb-4">Intelligence Data Streams</h4>
        <div className="space-y-3">
          {streams.map(stream => (
            <div key={stream.id} className="flex items-center justify-between">
              <div className="flex items-center gap-2 flex-1">
                <div className={`w-2 h-2 rounded-full ${
                  getStreamStatus(stream.confidence) === 'critical' ? 'bg-red-500 animate-pulse' :
                  getStreamStatus(stream.confidence) === 'warning' ? 'bg-yellow-500' :
                  'bg-green-500'
                }`} />
                <span className="text-sm">{stream.name}</span>
              </div>
              <div className="flex items-center gap-3">
                <Progress value={stream.confidence} className="w-20 h-2" />
                <span className={`text-xs font-mono w-12 text-right ${getConfidenceColor(stream.confidence)}`}>
                  {stream.confidence.toFixed(0)}%
                </span>
              </div>
            </div>
          ))}
        </div>
      </Card>

      {!isMonitoring && (
        <button
          onClick={() => setIsMonitoring(true)}
          className="w-full py-3 bg-primary text-primary-foreground rounded-lg font-semibold hover:bg-primary/90"
          data-testid="button-start-monitoring"
        >
          Start AI Monitoring Simulation
        </button>
      )}
    </div>
  );
}


========================================
FILE: client/src/components/demo/BeforeAfterComparison.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { X, Check, Clock, Users, Mail, Phone } from 'lucide-react';
import { Card } from '@/components/ui/card';
import { useEffect, useState } from 'react';

export function BeforeAfterComparison() {
  const demoController = useDemoController();
  const [show, setShow] = useState(false);

  useEffect(() => {
    if (!demoController.state.isActive) {
      setShow(false);
      return;
    }

    if (demoController.state.currentExecutiveStep === 3) {
      setShow(true);
      const hideTimer = setTimeout(() => setShow(false), 6000);
      return () => clearTimeout(hideTimer);
    } else {
      setShow(false);
    }
  }, [demoController.state.isActive, demoController.state.currentExecutiveStep]);

  if (!show) return null;

  const traditionalApproach = [
    { icon: Clock, text: '72 hours to coordinate', bad: true },
    { icon: Mail, text: 'Sequential email chains', bad: true },
    { icon: Phone, text: '47 individual phone calls', bad: true },
    { icon: Users, text: 'Conflicting instructions', bad: true },
    { icon: X, text: 'Departments out of sync', bad: true },
  ];

  const vexorCoordination = [
    { icon: Clock, text: '12 minutes full coordination', bad: false },
    { icon: Check, text: 'Parallel playbook distribution', bad: false },
    { icon: Users, text: 'Everyone knows their role', bad: false },
    { icon: Check, text: 'Real-time task tracking', bad: false },
    { icon: Check, text: 'Automated stakeholder sync', bad: false },
  ];

  return (
    <div className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 pointer-events-none" data-testid="before-after-comparison">
      <Card className="bg-slate-900/95 border-slate-700 backdrop-blur-md shadow-2xl max-w-4xl">
        <div className="p-6">
          <div className="text-center mb-6">
            <h3 className="text-2xl font-bold text-white mb-2">
              Traditional Response vs M
            </h3>
            <p className="text-slate-400">Same crisis. Radically different outcomes.</p>
          </div>

          <div className="grid grid-cols-2 gap-6">
            {/* Traditional Approach */}
            <div className="space-y-4">
              <div className="text-center pb-3 border-b border-red-500/30">
                <div className="text-lg font-bold text-red-400">Traditional Approach</div>
                <div className="text-sm text-red-300/70">72-Hour Coordination Process</div>
              </div>
              
              <div className="space-y-3">
                {traditionalApproach.map((item, index) => {
                  const Icon = item.icon;
                  return (
                    <div key={index} className="flex items-center gap-3 bg-red-950/30 border border-red-500/20 rounded-lg p-3">
                      <div className="flex-shrink-0 w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center">
                        <Icon className="h-4 w-4 text-red-400" />
                      </div>
                      <span className="text-sm text-red-200">{item.text}</span>
                    </div>
                  );
                })}
              </div>

              <div className="text-center pt-3 border-t border-red-500/30">
                <div className="text-3xl font-bold text-red-400">72hrs</div>
                <div className="text-xs text-red-300/70">Average Response Time</div>
              </div>
            </div>

            {/* M Coordination */}
            <div className="space-y-4">
              <div className="text-center pb-3 border-b border-emerald-500/30">
                <div className="text-lg font-bold text-emerald-400">M Platform</div>
                <div className="text-sm text-emerald-300/70">12-Minute Orchestrated Response</div>
              </div>
              
              <div className="space-y-3">
                {vexorCoordination.map((item, index) => {
                  const Icon = item.icon;
                  return (
                    <div key={index} className="flex items-center gap-3 bg-emerald-950/30 border border-emerald-500/20 rounded-lg p-3">
                      <div className="flex-shrink-0 w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center">
                        <Icon className="h-4 w-4 text-emerald-400" />
                      </div>
                      <span className="text-sm text-emerald-200">{item.text}</span>
                    </div>
                  );
                })}
              </div>

              <div className="text-center pt-3 border-t border-emerald-500/30">
                <div className="text-3xl font-bold text-emerald-400">12min</div>
                <div className="text-xs text-emerald-300/70">M Response Time</div>
              </div>
            </div>
          </div>

          {/* Bottom Impact Line */}
          <div className="mt-6 pt-4 border-t border-slate-700 text-center">
            <div className="text-amber-400 font-bold text-lg">
              6,000% Faster Response Time
            </div>
            <div className="text-slate-400 text-sm mt-1">
              This is the competitive advantage Fortune 1000 executives demand
            </div>
          </div>
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/ChaosSimulator.tsx
========================================
import { useState, useEffect, useCallback, useRef } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { 
  AlertTriangle, 
  Clock, 
  DollarSign, 
  MessageSquare,
  Mail,
  Phone,
  Calendar,
  Bell,
  TrendingDown,
  Shield,
  Users,
  Zap,
  Volume2,
  VolumeX
} from 'lucide-react';
import { SiSlack } from 'react-icons/si';

export type ChaosScenario = 'ransomware' | 'competitor' | 'regulatory' | 'supply_chain' | 'pr_crisis';

interface ChaosMessage {
  id: string;
  type: 'slack' | 'email' | 'text' | 'calendar' | 'call';
  sender: string;
  content: string;
  urgency: 'critical' | 'high' | 'medium';
  timestamp: Date;
}

interface ChaosSimulatorProps {
  scenario: ChaosScenario;
  companyName?: string;
  onComplete: () => void;
  autoStart?: boolean;
  autoAdvanceDelay?: number;
}

const SCENARIO_CONFIG: Record<ChaosScenario, {
  title: string;
  triggerMessage: string;
  triggerSender: string;
  revenuePerMinute: number;
  messages: Omit<ChaosMessage, 'id' | 'timestamp'>[];
}> = {
  ransomware: {
    title: 'CRITICAL: Ransomware Attack Detected',
    triggerMessage: 'URGENT: Our systems are being encrypted. Ransom note appeared on 47 servers. Customer data may be compromised. I need you in the war room NOW.',
    triggerSender: 'CISO - Marcus Chen',
    revenuePerMinute: 8500,
    messages: [
      { type: 'slack', sender: 'IT Security', content: ' CRITICAL: File encryption detected on production servers. Spreading rapidly.', urgency: 'critical' },
      { type: 'email', sender: 'Legal Team', content: 'RE: Breach notification requirements - We have 72 hours under GDPR. Need incident details ASAP.', urgency: 'critical' },
      { type: 'slack', sender: 'CFO Office', content: 'Board is asking for immediate update. What do we tell them?', urgency: 'critical' },
      { type: 'calendar', sender: 'Emergency Meeting', content: 'Crisis Response - War Room A - In 15 minutes', urgency: 'critical' },
      { type: 'text', sender: 'Board Chair', content: 'Just saw the news alert. Call me immediately.', urgency: 'critical' },
      { type: 'slack', sender: 'Customer Success', content: '47 enterprise customers reporting system access issues. What do we tell them?', urgency: 'high' },
      { type: 'email', sender: 'PR Team', content: 'TechCrunch is calling. They have sources saying we\'ve been breached. Response needed in 30 min.', urgency: 'critical' },
      { type: 'slack', sender: 'HR Director', content: 'Employees are panicking. Social media posts appearing. Need comms guidance NOW.', urgency: 'high' },
      { type: 'call', sender: 'FBI Cyber Division', content: 'Incoming call regarding potential ransomware investigation', urgency: 'critical' },
      { type: 'email', sender: 'Insurance Broker', content: 'RE: Cyber policy activation - Need incident details for coverage determination', urgency: 'high' },
      { type: 'slack', sender: 'Engineering Lead', content: 'Should we shut down all systems? This will impact 200K users.', urgency: 'critical' },
      { type: 'text', sender: 'CEO', content: 'In flight to NYC. Landing in 2 hours. What\'s our status?', urgency: 'critical' },
      { type: 'slack', sender: 'SOC Team', content: 'Ransom demand received: $15M in Bitcoin. 48-hour deadline.', urgency: 'critical' },
      { type: 'email', sender: 'Investor Relations', content: 'Major shareholders demanding update call. Stock already down 8% on rumors.', urgency: 'high' },
      { type: 'calendar', sender: 'Board Emergency Session', content: 'Virtual Board Meeting - Crisis Update - 1 hour', urgency: 'critical' },
    ]
  },
  competitor: {
    title: 'URGENT: Major Competitor Price War',
    triggerMessage: 'BREAKING: TechGiant just announced 40% price cuts across their entire enterprise line. Our sales team is getting hammered with calls. This is an existential threat.',
    triggerSender: 'VP Sales - Rachel Torres',
    revenuePerMinute: 12000,
    messages: [
      { type: 'slack', sender: 'Enterprise Sales', content: ' Acme Corp just put our $2.4M renewal on hold. Citing competitor pricing.', urgency: 'critical' },
      { type: 'email', sender: 'Sales Ops', content: 'Pipeline at risk: $47M in deals now reconsidering. Competitor offering 40% discounts.', urgency: 'critical' },
      { type: 'slack', sender: 'Channel Partners', content: 'Three major partners asking about our response. Threatening to switch recommendations.', urgency: 'high' },
      { type: 'text', sender: 'Board Member', content: 'Seeing the news. We need a response strategy today. Not tomorrow.', urgency: 'critical' },
      { type: 'slack', sender: 'Marketing', content: 'Should we counter with our own campaign? Need budget approval and messaging.', urgency: 'high' },
      { type: 'email', sender: 'CFO', content: 'If we match pricing, margin impact is $180M annually. Options?', urgency: 'critical' },
      { type: 'slack', sender: 'Customer Success', content: 'Renewal calls today are disasters. Customers demanding price matching.', urgency: 'high' },
      { type: 'calendar', sender: 'Emergency Pricing Committee', content: 'War Room - Competitive Response - NOW', urgency: 'critical' },
      { type: 'slack', sender: 'Product Team', content: 'Can we accelerate the Q3 feature release to differentiate?', urgency: 'medium' },
      { type: 'email', sender: 'Analyst Relations', content: 'Gartner calling for comment. They\'re updating their MQ assessment.', urgency: 'high' },
      { type: 'text', sender: 'CEO', content: 'Wall Street Journal wants a statement. What\'s our position?', urgency: 'critical' },
      { type: 'slack', sender: 'Field Sales', content: '6 demos cancelled today. Prospects saying "why bother when competitor is cheaper"', urgency: 'high' },
    ]
  },
  regulatory: {
    title: 'ALERT: SEC Investigation Notice',
    triggerMessage: 'Just received formal notice from SEC enforcement. They\'re investigating our Q3 revenue recognition. Requesting documents within 48 hours. This is serious.',
    triggerSender: 'General Counsel - Jennifer Walsh',
    revenuePerMinute: 5000,
    messages: [
      { type: 'email', sender: 'SEC Enforcement', content: 'Formal Document Preservation Notice - All employees must retain communications.', urgency: 'critical' },
      { type: 'slack', sender: 'Audit Committee Chair', content: 'Need emergency meeting with external auditors. Today.', urgency: 'critical' },
      { type: 'email', sender: 'External Counsel', content: 'Initiating investigation response protocol. $500K retainer required immediately.', urgency: 'critical' },
      { type: 'text', sender: 'CFO', content: 'Auditors want to review ALL Q3 deal documentation. Full freeze on document deletion.', urgency: 'critical' },
      { type: 'slack', sender: 'Investor Relations', content: 'Filing 8-K required within 4 business days. Draft needed.', urgency: 'high' },
      { type: 'calendar', sender: 'Legal Hold Meeting', content: 'All executives - Document preservation briefing - MANDATORY', urgency: 'critical' },
      { type: 'email', sender: 'Board Secretary', content: 'Special board session scheduled. D&O insurance review required.', urgency: 'high' },
      { type: 'slack', sender: 'Finance Team', content: 'Restatement scenarios being modeled. Potential impact: $45M-$120M.', urgency: 'critical' },
      { type: 'text', sender: 'Board Chair', content: 'WSJ has the story. Running tomorrow morning. We need to get ahead of this.', urgency: 'critical' },
      { type: 'email', sender: 'HR Legal', content: 'Executive compensation clawback provisions activated. Review required.', urgency: 'high' },
      { type: 'slack', sender: 'Communications', content: 'Employee town hall needed. Rumors spreading. Morale tanking.', urgency: 'high' },
    ]
  },
  supply_chain: {
    title: 'CRITICAL: Primary Supplier Bankruptcy',
    triggerMessage: 'AcmeParts just filed Chapter 11. They supply 67% of our critical components. We have 3 weeks of inventory. Production will halt if we don\'t act NOW.',
    triggerSender: 'VP Operations - David Kim',
    revenuePerMinute: 15000,
    messages: [
      { type: 'slack', sender: 'Supply Chain', content: ' AcmeParts facilities locked. No shipments. Zero visibility on alternatives.', urgency: 'critical' },
      { type: 'email', sender: 'Manufacturing', content: 'Production line 3 will halt in 72 hours without components. $2M/day impact.', urgency: 'critical' },
      { type: 'slack', sender: 'Procurement', content: 'Called 12 alternative suppliers. Lead times are 8-12 weeks minimum.', urgency: 'critical' },
      { type: 'text', sender: 'CEO', content: 'Customer commitments at risk. What\'s our backup plan?', urgency: 'critical' },
      { type: 'calendar', sender: 'Emergency Supply Review', content: 'All hands - Supply chain crisis response - Conference Room A', urgency: 'critical' },
      { type: 'slack', sender: 'Sales', content: 'Enterprise customers asking about delivery guarantees. What do I tell them?', urgency: 'high' },
      { type: 'email', sender: 'Legal', content: 'Force majeure clause review needed for customer contracts. 47 at risk.', urgency: 'high' },
      { type: 'slack', sender: 'Finance', content: 'Cash flow impact modeling shows $180M exposure. Need board approval for emergency spending.', urgency: 'critical' },
      { type: 'text', sender: 'Board Member', content: 'Competitor just announced expanded capacity. Timing suspicious. Response?', urgency: 'high' },
      { type: 'email', sender: 'Investor Relations', content: 'Guidance revision may be needed. Material impact to Q4 projections.', urgency: 'critical' },
      { type: 'slack', sender: 'HR', content: 'If production halts, 2,400 workers affected. Union contract requires 48hr notice.', urgency: 'high' },
      { type: 'slack', sender: 'Quality Assurance', content: 'Alternative suppliers need 6-week qualification process. Can we accelerate?', urgency: 'high' },
    ]
  },
  pr_crisis: {
    title: 'VIRAL: Executive Misconduct Video',
    triggerMessage: 'A video of our COO making offensive comments at a private event is going viral. 2M views in 2 hours. #BoycottBrand is trending. This is a firestorm.',
    triggerSender: 'Chief Communications Officer',
    revenuePerMinute: 25000,
    messages: [
      { type: 'slack', sender: 'Social Media', content: ' #BoycottBrand now #1 trending. 50K tweets in last hour. Growing exponentially.', urgency: 'critical' },
      { type: 'email', sender: 'PR Agency', content: 'CNN, NYT, WSJ all requesting comment. Deadline: 2 hours or they run without us.', urgency: 'critical' },
      { type: 'text', sender: 'Board Chair', content: 'Board is getting calls from major investors. We need a position. NOW.', urgency: 'critical' },
      { type: 'slack', sender: 'Employee Resource Groups', content: 'ERG leaders demanding meeting. Employees are devastated. Resignations threatened.', urgency: 'critical' },
      { type: 'calendar', sender: 'Crisis Communications War Room', content: 'Executive team only - IMMEDIATE', urgency: 'critical' },
      { type: 'email', sender: 'Legal', content: 'Employment review of COO initiated. Termination implications being assessed.', urgency: 'critical' },
      { type: 'slack', sender: 'Partnership Team', content: 'Nike and Apple pausing partnership discussions pending our response.', urgency: 'critical' },
      { type: 'text', sender: 'CEO', content: 'Do we have the full video? Context? I need facts before I make a statement.', urgency: 'critical' },
      { type: 'email', sender: 'Customer Success', content: '340 enterprise customers have emailed asking for our position. Response?', urgency: 'high' },
      { type: 'slack', sender: 'Recruiting', content: '27 candidates just withdrew applications citing the incident.', urgency: 'high' },
      { type: 'slack', sender: 'Sales', content: 'Q4 pipeline at risk. Multiple prospects asking to postpone decisions.', urgency: 'high' },
      { type: 'email', sender: 'DEI Council', content: 'Statement from DEI leadership needed. Internal trust is shattered.', urgency: 'critical' },
      { type: 'text', sender: 'COO', content: 'The video is taken out of context. I can explain. Should I release a statement?', urgency: 'critical' },
    ]
  }
};

const MESSAGE_ICONS = {
  slack: SiSlack,
  email: Mail,
  text: Phone,
  calendar: Calendar,
  call: Phone,
};

const URGENCY_COLORS = {
  critical: 'bg-red-500 border-red-600 text-white',
  high: 'bg-orange-500 border-orange-600 text-white',
  medium: 'bg-yellow-500 border-yellow-600 text-black',
};

export function ChaosSimulator({ scenario, companyName = 'Meridian Industries', onComplete, autoStart = false, autoAdvanceDelay }: ChaosSimulatorProps) {
  const [isActive, setIsActive] = useState(autoStart);
  const [messages, setMessages] = useState<ChaosMessage[]>([]);
  const [elapsedSeconds, setElapsedSeconds] = useState(0);
  const [revenueLost, setRevenueLost] = useState(0);
  const [stressLevel, setStressLevel] = useState(0);
  const [showOverwhelm, setShowOverwhelm] = useState(false);
  const [isMuted, setIsMuted] = useState(true);
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const audioRef = useRef<HTMLAudioElement | null>(null);
  
  const config = SCENARIO_CONFIG[scenario];
  
  useEffect(() => {
    if (showOverwhelm && autoAdvanceDelay) {
      const timer = setTimeout(() => {
        onComplete();
      }, autoAdvanceDelay);
      return () => clearTimeout(timer);
    }
  }, [showOverwhelm, autoAdvanceDelay, onComplete]);
  
  const skipToEnd = useCallback(() => {
    setMessages(config.messages.map((msg, i) => ({
      ...msg,
      id: `msg-${i}`,
      timestamp: new Date(),
    })));
    setStressLevel(100);
    setRevenueLost(config.revenuePerMinute * 3);
    setTimeout(() => setShowOverwhelm(true), 500);
  }, [config]);
  
  const scrollToBottom = useCallback(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, []);
  
  useEffect(() => {
    if (!isActive) return;
    
    const timer = setInterval(() => {
      setElapsedSeconds(prev => prev + 1);
      setRevenueLost(prev => prev + (config.revenuePerMinute / 60));
    }, 1000);
    
    return () => clearInterval(timer);
  }, [isActive, config.revenuePerMinute]);
  
  useEffect(() => {
    if (!isActive || messages.length >= config.messages.length) {
      if (messages.length >= config.messages.length && isActive) {
        setTimeout(() => setShowOverwhelm(true), 2000);
      }
      return;
    }
    
    const baseDelay = Math.max(800, 2500 - (messages.length * 120));
    const randomDelay = baseDelay + Math.random() * 1000;
    
    const timer = setTimeout(() => {
      const nextMessage = config.messages[messages.length];
      const newMessage: ChaosMessage = {
        ...nextMessage,
        id: `msg-${messages.length}`,
        timestamp: new Date(),
      };
      
      setMessages(prev => [...prev, newMessage]);
      setStressLevel(prev => Math.min(100, prev + 7));
      
      if (!isMuted) {
        const audio = new Audio('/notification.mp3');
        audio.volume = 0.3;
        audio.play().catch(() => {});
      }
    }, randomDelay);
    
    return () => clearTimeout(timer);
  }, [isActive, messages.length, config.messages, isMuted]);
  
  useEffect(() => {
    scrollToBottom();
  }, [messages, scrollToBottom]);
  
  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };
  
  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(amount);
  };
  
  const startSimulation = () => {
    setIsActive(true);
    setMessages([]);
    setElapsedSeconds(0);
    setRevenueLost(0);
    setStressLevel(10);
    setShowOverwhelm(false);
  };

  if (!isActive && messages.length === 0) {
    return (
      <div className="min-h-[600px] flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-xl p-8" data-testid="chaos-simulator-start">
        <div className="text-center max-w-2xl">
          <div className="mb-8">
            <div className="w-20 h-20 mx-auto bg-red-500/20 rounded-full flex items-center justify-center mb-6 animate-pulse">
              <AlertTriangle className="w-10 h-10 text-red-500" />
            </div>
            <h2 className="text-3xl font-bold text-white mb-4">Experience the Chaos</h2>
            <p className="text-slate-300 text-lg mb-2">
              You're the Chief Strategy Officer of <span className="text-white font-semibold">{companyName}</span>.
            </p>
            <p className="text-slate-400">
              It's 2:47 PM on a Tuesday. Your day is about to change.
            </p>
          </div>
          
          <Card className="bg-slate-800/50 border-red-500/30 mb-8">
            <CardContent className="p-6">
              <div className="flex items-start gap-4">
                <div className="w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center flex-shrink-0">
                  <Bell className="w-6 h-6 text-red-500" />
                </div>
                <div className="text-left">
                  <p className="text-sm text-red-400 font-medium mb-1">{config.triggerSender}</p>
                  <p className="text-white font-medium">{config.triggerMessage}</p>
                </div>
              </div>
            </CardContent>
          </Card>
          
          <Button 
            onClick={startSimulation}
            size="lg"
            className="bg-red-600 hover:bg-red-700 text-white px-8 py-6 text-lg"
            data-testid="button-start-chaos"
          >
            <Zap className="w-5 h-5 mr-2" />
            Begin Crisis Simulation
          </Button>
        </div>
      </div>
    );
  }

  if (showOverwhelm) {
    return (
      <div className="min-h-[600px] flex items-center justify-center bg-gradient-to-br from-slate-900 via-red-900/20 to-slate-900 rounded-xl p-8" data-testid="chaos-simulator-overwhelm">
        <div className="text-center max-w-2xl">
          <div className="mb-8">
            <div className="grid grid-cols-4 gap-2 mb-8 opacity-30">
              {messages.slice(-8).map((msg, i) => (
                <div key={i} className="h-8 bg-slate-700 rounded animate-pulse" />
              ))}
            </div>
            
            <div className="space-y-4 mb-8">
              <h2 className="text-4xl font-bold text-white">This was 3 minutes.</h2>
              <p className="text-2xl text-red-400">{messages.length} critical messages.</p>
              <p className="text-2xl text-orange-400">{formatCurrency(revenueLost)} at risk.</p>
            </div>
            
            <div className="bg-slate-800/80 rounded-xl p-8 border border-slate-700 mb-8">
              <h3 className="text-2xl font-semibold text-white mb-4">
                How long would it take your team to get aligned?
              </h3>
              <div className="grid grid-cols-4 gap-4 mb-6">
                {['30 min', '1 hour', '4 hours', '1 day+'].map((time, i) => (
                  <div 
                    key={time}
                    className={`p-4 rounded-lg border-2 cursor-pointer transition-all ${
                      i === 0 ? 'border-green-500 bg-green-500/10' : 'border-slate-600 hover:border-slate-500'
                    }`}
                  >
                    <p className="text-white font-semibold">{time}</p>
                    {i === 0 && <p className="text-xs text-green-400 mt-1">With M</p>}
                  </div>
                ))}
              </div>
              <p className="text-slate-400 text-sm">
                The average Fortune 1000 company takes <span className="text-white font-semibold">4.2 hours</span> to coordinate a crisis response.
                <br />
                M reduces that to <span className="text-green-400 font-semibold">12 minutes</span>.
              </p>
            </div>
          </div>
          
          <Button 
            onClick={onComplete}
            size="lg"
            className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-6 text-lg"
            data-testid="button-continue-demo"
          >
            See How M Changes Everything
          </Button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-[600px] bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-xl overflow-hidden" data-testid="chaos-simulator-active">
      <div className="sticky top-0 z-10 bg-slate-900/95 backdrop-blur border-b border-red-500/30 p-4">
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-4">
            <Badge className="bg-red-600 text-white animate-pulse px-4 py-1">
              <AlertTriangle className="w-4 h-4 mr-2" />
              {config.title}
            </Badge>
            <Button
              variant="ghost"
              size="sm"
              onClick={() => setIsMuted(!isMuted)}
              className="text-slate-400 hover:text-white"
              data-testid="button-toggle-sound"
            >
              {isMuted ? <VolumeX className="w-4 h-4" /> : <Volume2 className="w-4 h-4" />}
            </Button>
          </div>
          <div className="flex items-center gap-6">
            <div className="flex items-center gap-2 text-white">
              <Clock className="w-5 h-5 text-orange-400" />
              <span className="font-mono text-xl">{formatTime(elapsedSeconds)}</span>
            </div>
            <div className="flex items-center gap-2 text-white">
              <TrendingDown className="w-5 h-5 text-red-400" />
              <span className="font-mono text-xl text-red-400">{formatCurrency(revenueLost)}</span>
            </div>
          </div>
        </div>
        
        <div className="space-y-2">
          <div className="flex items-center justify-between text-sm">
            <span className="text-slate-400">Organizational Stress Level</span>
            <span className="text-red-400 font-semibold">{stressLevel}%</span>
          </div>
          <Progress value={stressLevel} className="h-2 bg-slate-700" />
        </div>
      </div>
      
      <div className="h-[450px] overflow-y-auto p-4 space-y-3">
        {messages.map((message, index) => {
          const Icon = MESSAGE_ICONS[message.type];
          const delay = index * 50;
          
          return (
            <div 
              key={message.id}
              className={`flex items-start gap-3 animate-in slide-in-from-right duration-300`}
              style={{ animationDelay: `${delay}ms` }}
              data-testid={`chaos-message-${message.id}`}
            >
              <div className={`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${URGENCY_COLORS[message.urgency]}`}>
                <Icon className="w-5 h-5" />
              </div>
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2 mb-1">
                  <span className="text-sm font-medium text-slate-300">{message.sender}</span>
                  <Badge variant="outline" className={`text-xs ${
                    message.urgency === 'critical' ? 'border-red-500 text-red-400' :
                    message.urgency === 'high' ? 'border-orange-500 text-orange-400' :
                    'border-yellow-500 text-yellow-400'
                  }`}>
                    {message.urgency.toUpperCase()}
                  </Badge>
                  <span className="text-xs text-slate-500">
                    {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </span>
                </div>
                <p className="text-white text-sm">{message.content}</p>
              </div>
            </div>
          );
        })}
        <div ref={messagesEndRef} />
      </div>
      
      <div className="border-t border-slate-700 p-4 bg-slate-900/50">
        <div className="flex items-center justify-between text-sm">
          <div className="flex items-center gap-4 text-slate-400">
            <span className="flex items-center gap-1">
              <MessageSquare className="w-4 h-4" />
              {messages.length} messages
            </span>
            <span className="flex items-center gap-1">
              <Users className="w-4 h-4" />
              {new Set(messages.map(m => m.sender)).size} stakeholders waiting
            </span>
          </div>
          <div className="flex items-center gap-4">
            <span className="text-red-400 animate-pulse">More incoming...</span>
            <Button
              variant="ghost"
              size="sm"
              onClick={skipToEnd}
              className="text-slate-400 hover:text-white"
              data-testid="button-skip-chaos"
            >
              Skip to overwhelm
            </Button>
          </div>
        </div>
      </div>
    </div>
  );
}

export default ChaosSimulator;


========================================
FILE: client/src/components/demo/CompetitorLagClock.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { Clock, TrendingDown } from 'lucide-react';
import { Card } from '@/components/ui/card';
import { useEffect, useState } from 'react';

export function CompetitorLagClock() {
  const demoController = useDemoController();
  const [vexorTime, setMTime] = useState(0);
  const [competitorTime, setCompetitorTime] = useState(0);
  const [show, setShow] = useState(false);

  useEffect(() => {
    if (!demoController.state.isActive) {
      setShow(false);
      setMTime(0);
      setCompetitorTime(0);
      return;
    }

    if (demoController.state.currentExecutiveStep === 1) {
      setShow(true);
      const hideTimer = setTimeout(() => setShow(false), 6000);
      return () => clearTimeout(hideTimer);
    } else {
      setShow(false);
      setMTime(0);
      setCompetitorTime(0);
    }
  }, [demoController.state.isActive, demoController.state.currentExecutiveStep]);

  useEffect(() => {
    if (!show) return;
    const interval = setInterval(() => {
      setMTime(prev => {
        const newTime = prev + 1;
        if (newTime >= 12) {
          clearInterval(interval);
          return 12;
        }
        return newTime;
      });
      
      setCompetitorTime(prev => Math.min(prev + 6, 72));
    }, 1000);

    return () => clearInterval(interval);
  }, [show]);

  if (!show) return null;

  const timeSaved = competitorTime - vexorTime;
  const advantageHours = Math.floor(timeSaved / 60);
  const advantageMinutes = timeSaved % 60;

  return (
    <div className="fixed bottom-6 right-6 z-40" data-testid="competitor-lag-clock">
      <Card className="bg-gradient-to-br from-red-950/90 to-orange-950/90 border-red-500/30 backdrop-blur-sm shadow-2xl">
        <div className="p-4 space-y-3">
          <div className="flex items-center justify-between gap-3">
            <div className="text-xs font-semibold text-red-300 uppercase tracking-wider">
              Decision Velocity
            </div>
            <Clock className="h-4 w-4 text-red-400 animate-pulse" />
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div className="text-center">
              <div className="text-xs text-emerald-400 font-medium mb-1">
                M
              </div>
              <div className="text-3xl font-bold text-emerald-400 tabular-nums">
                {vexorTime}
              </div>
              <div className="text-xs text-emerald-300/70">minutes</div>
            </div>

            <div className="text-center border-l border-red-500/30 pl-4">
              <div className="text-xs text-gray-400 font-medium mb-1">
                COMPETITORS
              </div>
              <div className="text-3xl font-bold text-gray-300 tabular-nums">
                {competitorTime}
              </div>
              <div className="text-xs text-gray-400">minutes</div>
            </div>
          </div>
          
          {/* Time Compression Indicator */}
          <div className="text-center pt-2 border-t border-red-500/20">
            <div className="text-xs text-amber-400/70 font-medium">
               Demo Speed: 1 sec = 1 min realtime
            </div>
          </div>

          {timeSaved > 0 && (
            <div className="pt-3 border-t border-red-500/30">
              <div className="flex items-center justify-center gap-2 text-amber-400">
                <TrendingDown className="h-4 w-4" />
                <span className="text-sm font-semibold">
                  {advantageHours}h {advantageMinutes}m Competitive Advantage
                </span>
              </div>
            </div>
          )}

          {vexorTime === 12 && (
            <div className="text-center pt-2">
              <div className="text-xs font-bold text-emerald-400 animate-pulse">
                 CRISIS RESOLVED
              </div>
              <div className="text-xs text-gray-400 mt-1">
                While competitors are still discovering the problem...
              </div>
            </div>
          )}
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/CostOfInactionOverlay.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { useEffect, useState } from 'react';
import { TrendingDown, Clock, Users, DollarSign, AlertTriangle } from 'lucide-react';
import { Card } from '@/components/ui/card';

export function CostOfInactionOverlay() {
  const demoController = useDemoController();
  const [show, setShow] = useState(false);
  const [elapsedDays, setElapsedDays] = useState(0);

  useEffect(() => {
    if (demoController.state.currentExecutiveStep === 1) {
      setShow(true);
      const hideTimer = setTimeout(() => setShow(false), 7000);
      return () => clearTimeout(hideTimer);
    } else {
      setShow(false);
    }
  }, [demoController.state.currentExecutiveStep]);

  useEffect(() => {
    if (!show) {
      setElapsedDays(0);
      return;
    }
    
    const interval = setInterval(() => {
      setElapsedDays(prev => Math.min(prev + 1, 90));
    }, 50);
    
    return () => clearInterval(interval);
  }, [show]);

  if (!show) return null;

  const dailyLosses = {
    revenue: 847000,
    marketShare: 0.3,
    competitiveAdvantage: 12,
    executiveHours: 47
  };

  const totalRevenueLost = (dailyLosses.revenue * elapsedDays).toLocaleString();
  const totalMarketShareLost = (dailyLosses.marketShare * elapsedDays).toFixed(1);
  const totalHoursWasted = (dailyLosses.executiveHours * elapsedDays).toLocaleString();

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
      <div className="absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300" />
      
      <Card className="relative w-[900px] bg-gradient-to-br from-red-950/95 via-red-900/95 to-orange-950/95 border-red-500/50 p-8 shadow-2xl animate-in zoom-in-95 duration-500">
        <div className="space-y-6">
          {/* Header */}
          <div className="text-center space-y-3">
            <div className="flex items-center justify-center gap-3">
              <div className="p-3 bg-red-600/30 rounded-lg">
                <AlertTriangle className="h-8 w-8 text-red-400 animate-pulse" />
              </div>
              <h2 className="text-3xl font-bold text-red-100">Every Day You Wait...</h2>
            </div>
            <p className="text-xl text-red-200/90">The cost of traditional crisis response adds up</p>
          </div>

          {/* Counter */}
          <div className="bg-black/40 rounded-lg p-4 border border-red-500/30">
            <div className="text-center">
              <p className="text-red-300 text-sm mb-2">Days Without M</p>
              <div className="text-6xl font-bold text-red-400 tabular-nums">
                {elapsedDays}
              </div>
            </div>
          </div>

          {/* Loss Metrics */}
          <div className="grid grid-cols-2 gap-4">
            <div className="bg-black/30 rounded-lg p-4 border border-red-500/20">
              <div className="flex items-start gap-3">
                <div className="p-2 bg-red-600/20 rounded">
                  <DollarSign className="h-5 w-5 text-red-400" />
                </div>
                <div>
                  <p className="text-red-300 text-sm">Revenue at Risk</p>
                  <p className="text-2xl font-bold text-red-100">${totalRevenueLost}</p>
                  <p className="text-xs text-red-400 mt-1">From delayed crisis responses</p>
                </div>
              </div>
            </div>

            <div className="bg-black/30 rounded-lg p-4 border border-red-500/20">
              <div className="flex items-start gap-3">
                <div className="p-2 bg-red-600/20 rounded">
                  <TrendingDown className="h-5 w-5 text-red-400" />
                </div>
                <div>
                  <p className="text-red-300 text-sm">Market Share Lost</p>
                  <p className="text-2xl font-bold text-red-100">{totalMarketShareLost}%</p>
                  <p className="text-xs text-red-400 mt-1">To faster-moving competitors</p>
                </div>
              </div>
            </div>

            <div className="bg-black/30 rounded-lg p-4 border border-red-500/20">
              <div className="flex items-start gap-3">
                <div className="p-2 bg-red-600/20 rounded">
                  <Clock className="h-5 w-5 text-red-400" />
                </div>
                <div>
                  <p className="text-red-300 text-sm">Executive Hours Wasted</p>
                  <p className="text-2xl font-bold text-red-100">{totalHoursWasted}</p>
                  <p className="text-xs text-red-400 mt-1">In reactive crisis coordination</p>
                </div>
              </div>
            </div>

            <div className="bg-black/30 rounded-lg p-4 border border-red-500/20">
              <div className="flex items-start gap-3">
                <div className="p-2 bg-red-600/20 rounded">
                  <Users className="h-5 w-5 text-red-400" />
                </div>
                <div>
                  <p className="text-red-300 text-sm">Opportunities Missed</p>
                  <p className="text-2xl font-bold text-red-100">{elapsedDays * 3}</p>
                  <p className="text-xs text-red-400 mt-1">Competitive advantages lost forever</p>
                </div>
              </div>
            </div>
          </div>

          {/* Bottom Message */}
          <div className="bg-red-600/20 rounded-lg p-4 border border-red-500/30">
            <p className="text-center text-red-100 text-lg font-semibold">
              Your competitors aren't waiting. Neither should you.
            </p>
          </div>
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/CrisisResolvedCelebration.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { CheckCircle, Trophy, Zap, TrendingUp } from 'lucide-react';
import { Card } from '@/components/ui/card';
import { useEffect, useState } from 'react';

export function CrisisResolvedCelebration() {
  const demoController = useDemoController();
  const [show, setShow] = useState(false);

  useEffect(() => {
    if (!demoController.state.isActive) {
      setShow(false);
      return;
    }

    if (demoController.state.currentExecutiveStep === 5) {
      setShow(true);
      const hideTimer = setTimeout(() => setShow(false), 5000);
      return () => clearTimeout(hideTimer);
    } else {
      setShow(false);
    }
  }, [demoController.state.isActive, demoController.state.currentExecutiveStep]);

  if (!show) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-500" data-testid="crisis-resolved-celebration">
      <Card className="bg-gradient-to-br from-emerald-950 via-green-900 to-emerald-950 border-emerald-500 shadow-2xl max-w-2xl animate-in zoom-in duration-500">
        <div className="p-8 space-y-6 text-center">
          {/* Success Icon */}
          <div className="flex justify-center">
            <div className="relative">
              <div className="absolute inset-0 bg-emerald-400 rounded-full blur-2xl opacity-50 animate-pulse"></div>
              <div className="relative w-24 h-24 bg-emerald-500 rounded-full flex items-center justify-center">
                <CheckCircle className="h-16 w-16 text-white" strokeWidth={3} />
              </div>
            </div>
          </div>

          {/* Main Message */}
          <div className="space-y-2">
            <h2 className="text-4xl font-bold text-white">
              Crisis Resolved!
            </h2>
            <p className="text-xl text-emerald-300">
              12-Minute Coordinated Response Complete
            </p>
          </div>

          {/* Key Metrics */}
          <div className="grid grid-cols-3 gap-4 py-6 border-y border-emerald-500/30">
            <div className="space-y-2">
              <Zap className="h-8 w-8 text-amber-400 mx-auto" />
              <div className="text-3xl font-bold text-white">12min</div>
              <div className="text-sm text-emerald-300">Response Time</div>
            </div>
            
            <div className="space-y-2 border-x border-emerald-500/30">
              <Trophy className="h-8 w-8 text-amber-400 mx-auto" />
              <div className="text-3xl font-bold text-white">$12M</div>
              <div className="text-sm text-emerald-300">Value Protected</div>
            </div>
            
            <div className="space-y-2">
              <TrendingUp className="h-8 w-8 text-amber-400 mx-auto" />
              <div className="text-3xl font-bold text-white">71hrs</div>
              <div className="text-sm text-emerald-300">Time Saved</div>
            </div>
          </div>

          {/* Competitive Advantage */}
          <div className="bg-amber-500/20 border border-amber-500/30 rounded-lg p-4">
            <div className="text-amber-400 font-bold text-lg mb-2">
               Competitive Advantage Secured
            </div>
            <p className="text-amber-100 text-sm">
              While your competitors are still discovering this crisis through news alerts 
              (3 days behind), you've already resolved it, protected revenue, and maintained 
              stakeholder confidence. This is executive leadership in the AI era.
            </p>
          </div>

          {/* Preparedness Score Increase */}
          <div className="bg-purple-500/20 border border-purple-500/30 rounded-lg p-4">
            <div className="flex items-center justify-center gap-3">
              <span className="text-purple-300">Executive Preparedness Score</span>
              <div className="flex items-center gap-2">
                <span className="text-2xl font-bold text-purple-400">85</span>
                <span className="text-emerald-400 font-bold">+8</span>
              </div>
              <span className="text-purple-300"></span>
              <span className="text-3xl font-bold text-purple-400">93</span>
            </div>
            <div className="text-sm text-purple-300 mt-2">
              You're now in the Top 1% of Fortune 1000 CEOs for crisis preparedness
            </div>
          </div>

          {/* Fireworks Effect */}
          <div className="text-6xl animate-bounce">
            
          </div>
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/DemoCompletionScreen.tsx
========================================
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { 
  CheckCircle, 
  ArrowRight, 
  Calendar, 
  Share2,
  TrendingUp,
  Target,
  DollarSign,
  Users,
  BarChart3,
  Clock,
  Trophy,
  Play
} from 'lucide-react';
import { useLocation } from 'wouter';
import { motion } from 'framer-motion';

interface DemoCompletionScreenProps {
  onClose: () => void;
  onShareDemo?: () => void;
  onRestart?: () => void;
  persona?: 'ceo' | 'coo' | 'chro' | 'cto' | 'cio' | 'cdo' | 'ciso' | 'cfo' | 'general';
  elapsedTime?: number;
  stakeholdersReached?: number;
  totalStakeholders?: number;
  scenarioTitle?: string;
  valueSaved?: string;
}

export default function DemoCompletionScreen({ 
  onClose, 
  onShareDemo,
  onRestart, 
  persona = 'general',
  elapsedTime = 720,
  stakeholdersReached = 47,
  totalStakeholders = 50,
  scenarioTitle = "Strategic Response",
  valueSaved = "$283K"
}: DemoCompletionScreenProps) {
  const [, setLocation] = useLocation();

  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const completionRate = Math.round((stakeholdersReached / totalStakeholders) * 100);
  
  const valueHighlights = [
    {
      icon: Clock,
      value: formatTime(elapsedTime),
      title: "Execution Time",
      description: "vs 72 hours traditional",
      color: "text-emerald-400"
    },
    {
      icon: Users,
      value: stakeholdersReached.toString(),
      title: "Stakeholders Aligned",
      description: `${completionRate}% completion rate`,
      color: "text-blue-400"
    },
    {
      icon: TrendingUp,
      value: "360x",
      title: "Speed Increase",
      description: "Faster than manual coordination",
      color: "text-purple-400"
    },
    {
      icon: DollarSign,
      value: valueSaved,
      title: "Value Protected",
      description: "Executive time + opportunity cost",
      color: "text-amber-400"
    }
  ];

  const nextSteps = [
    {
      icon: Calendar,
      title: "Schedule Implementation Call",
      description: "30-minute consultation with our executive team",
      action: "Schedule Now",
      variant: "default" as const,
      testId: "schedule-call-btn",
      onClick: () => setLocation('/contact')
    },
    {
      icon: BarChart3,
      title: "Custom ROI Calculator",
      description: "Calculate your organization's potential savings",
      action: "Calculate ROI",
      variant: "outline" as const,
      testId: "roi-report-btn",
      onClick: () => setLocation('/calculator')
    },
    {
      icon: Target,
      title: "Explore Playbook Library",
      description: "Browse 166 pre-built strategic playbooks",
      action: "View Playbooks",
      variant: "outline" as const,
      testId: "explore-playbooks-btn",
      onClick: () => setLocation('/playbook-library')
    }
  ];

  const personaMessages: Record<NonNullable<typeof persona>, string> = {
    ceo: "As CEO, you've seen how M delivers strategic advantage through rapid execution. From your strategic stronghold, you protect market share and accelerate competitive response.",
    coo: "As COO, you've experienced operational excellence in action. Our playbook system reduces coordination overhead by 85%, freeing your teams to focus on execution.",
    chro: "As CHRO, you've seen how M improves workforce stability and cultural health. Customers report 34% better retention during crisis situations.",
    cto: "As CTO, you've experienced how M ensures technical resilience and accelerates innovation. Our platform protects your architecture while enabling rapid response.",
    cio: "As CIO, you've seen how M ensures digital continuity and compliance. Our playbook system maintains operational reliability while reducing incident response time.",
    cdo: "As CDO, you've experienced how M protects data integrity and accelerates analytics. Our platform ensures data governance while enabling rapid insight delivery.",
    ciso: "As CISO, you've seen how M strengthens security posture and reduces risk. Our playbook system provides instant threat response while maintaining compliance.",
    cfo: "As CFO, you've experienced how M protects financial stability and optimizes costs. Our platform reduces risk exposure while delivering measurable ROI.",
    general: "You've experienced the M difference. Pre-configured playbooks executed in minutes, mobilizing entire organizations with coordinated precision."
  };

  return (
    <motion.div 
      className="fixed inset-0 z-[10001] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"
      data-testid="demo-completion-screen"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ duration: 0.3 }}
    >
      <motion.div
        initial={{ scale: 0.95, y: 20 }}
        animate={{ scale: 1, y: 0 }}
        transition={{ delay: 0.1, duration: 0.4 }}
        className="w-full max-w-4xl max-h-[90vh] overflow-y-auto"
      >
        <Card className="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 border-2 border-emerald-500/50 shadow-2xl shadow-emerald-500/10">
          <CardContent className="p-6 md:p-8 space-y-6">
            
            <div className="text-center space-y-3">
              <motion.div 
                className="flex items-center justify-center"
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                transition={{ delay: 0.3, type: "spring", stiffness: 200 }}
              >
                <div className="w-16 h-16 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-full flex items-center justify-center mb-2">
                  <Trophy className="h-8 w-8 text-white" />
                </div>
              </motion.div>
              <Badge className="bg-emerald-500 text-white text-sm px-3 py-1">
                Demo Complete
              </Badge>
              <h1 className="text-3xl md:text-4xl font-bold text-white">
                Execution Successful
              </h1>
              <p className="text-lg text-slate-300 max-w-2xl mx-auto">
                {personaMessages[persona]}
              </p>
            </div>

            <div className="bg-gradient-to-r from-emerald-950/60 to-teal-950/60 rounded-xl p-6 border border-emerald-500/30">
              <div className="flex items-center justify-center gap-6 text-center flex-wrap">
                <div>
                  <div className="text-3xl md:text-4xl font-bold text-red-400/70 line-through">72 hours</div>
                  <div className="text-sm text-slate-500">Traditional Response</div>
                </div>
                <ArrowRight className="h-8 w-8 text-emerald-400 hidden md:block" />
                <div className="text-2xl text-emerald-400 md:hidden"></div>
                <div>
                  <div className="text-3xl md:text-4xl font-bold text-emerald-400">{formatTime(elapsedTime)}</div>
                  <div className="text-sm text-emerald-300">With M Platform</div>
                </div>
              </div>
            </div>

            <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
              {valueHighlights.map((highlight, index) => (
                <motion.div 
                  key={index} 
                  className="bg-slate-800/60 rounded-xl p-4 border border-slate-700 text-center"
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.4 + index * 0.1 }}
                >
                  <highlight.icon className={`h-6 w-6 ${highlight.color} mx-auto mb-2`} />
                  <div className={`text-2xl font-bold ${highlight.color}`}>{highlight.value}</div>
                  <div className="text-sm font-medium text-white">{highlight.title}</div>
                  <div className="text-xs text-slate-400 mt-1">{highlight.description}</div>
                </motion.div>
              ))}
            </div>

            <div className="space-y-3">
              <h2 className="text-xl font-bold text-white flex items-center gap-2">
                <ArrowRight className="h-5 w-5 text-emerald-400" />
                Ready to Get Started?
              </h2>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                {nextSteps.map((step, index) => (
                  <Card key={index} className="bg-slate-800/50 border-slate-700 hover:border-emerald-500/50 transition-all">
                    <CardContent className="p-4 space-y-3">
                      <div className="flex items-start gap-3">
                        <div className="p-2 bg-emerald-600/20 rounded-lg flex-shrink-0">
                          <step.icon className="h-5 w-5 text-emerald-400" />
                        </div>
                        <div className="flex-1 min-w-0">
                          <h3 className="text-sm font-semibold text-white">{step.title}</h3>
                          <p className="text-xs text-slate-400">{step.description}</p>
                        </div>
                      </div>
                      <Button 
                        variant={step.variant}
                        size="sm"
                        className={step.variant === 'default' 
                          ? 'w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white' 
                          : 'w-full border-slate-600 hover:bg-slate-700 text-slate-300'}
                        onClick={step.onClick}
                        data-testid={step.testId}
                      >
                        {step.action}
                      </Button>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </div>

            <div className="flex flex-col sm:flex-row items-center justify-center gap-3 pt-4 border-t border-slate-700">
              <Button
                variant="outline"
                className="border-slate-600 text-slate-300 hover:bg-slate-700"
                onClick={() => setLocation('/demo')}
                data-testid="try-another-demo-btn"
              >
                <Play className="h-4 w-4 mr-2" />
                Try Another Demo
              </Button>
              
              {onShareDemo && (
                <Button 
                  onClick={onShareDemo}
                  variant="outline"
                  className="border-purple-500/50 text-purple-300 hover:bg-purple-600/20"
                  data-testid="share-demo-btn"
                >
                  <Share2 className="h-4 w-4 mr-2" />
                  Share Demo
                </Button>
              )}
              
              {onRestart && (
                <Button
                  onClick={onRestart}
                  variant="ghost"
                  className="text-slate-400 hover:text-white"
                  data-testid="restart-demo-btn"
                >
                  Restart This Demo
                </Button>
              )}
              
              <Button
                onClick={onClose}
                variant="ghost"
                className="text-slate-500 hover:text-white"
                data-testid="completion-close-btn"
              >
                Return to Platform
              </Button>
            </div>

          </CardContent>
        </Card>
      </motion.div>
    </motion.div>
  );
}


========================================
FILE: client/src/components/demo/DemoConfigPanel.tsx
========================================
import { useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Switch } from '@/components/ui/switch';
import { Settings, Clock, Users, Building2, Briefcase, X, Target, Zap, Brain, BarChart3, Shield, DollarSign } from 'lucide-react';
import { useDemoController } from '@/contexts/DemoController';

interface DemoConfigPanelProps {
  onClose: () => void;
  onStartDemo: () => void;
}

export default function DemoConfigPanel({ onClose, onStartDemo }: DemoConfigPanelProps) {
  const { setPersona, setIndustry } = useDemoController();
  
  const [selectedPreset, setSelectedPreset] = useState<string>('full');
  const [selectedPersona, setSelectedPersona] = useState<'ceo' | 'coo' | 'chro' | 'cto' | 'cio' | 'cdo' | 'ciso' | 'cfo'>('ceo');
  const [selectedIndustry, setSelectedIndustry] = useState<'healthcare' | 'finance' | 'manufacturing' | 'retail' | 'general'>('general');
  const [autoAdvance, setAutoAdvance] = useState(true);
  const [showROI, setShowROI] = useState(true);

  // Demo presets with different time configurations
  const presets = {
    quick: {
      name: 'Quick Demo',
      duration: '2 minutes',
      description: 'Essential features for busy executives',
      icon: <Clock className="h-4 w-4" />,
      scenes: 5
    },
    standard: {
      name: 'Standard Demo',
      duration: '5 minutes',
      description: 'Comprehensive platform overview',
      icon: <Briefcase className="h-4 w-4" />,
      scenes: 7
    },
    full: {
      name: 'Full Experience',
      duration: '10 minutes',
      description: 'Complete interactive demonstration',
      icon: <Building2 className="h-4 w-4" />,
      scenes: 12
    },
    custom: {
      name: 'Custom Flow',
      duration: 'Variable',
      description: 'Tailor-made for specific needs',
      icon: <Settings className="h-4 w-4" />,
      scenes: 0
    }
  };

  const handleStartDemo = () => {
    // Apply configuration
    setPersona(selectedPersona);
    setIndustry(selectedIndustry);
    
    // Start demo with selected configuration
    onStartDemo();
    
    // Close the config panel
    onClose();
  };

  return (
    <div 
      className="fixed inset-0 z-[10002] flex items-center justify-center bg-black/60 backdrop-blur-sm"
      data-testid="demo-config-panel"
    >
      <Card className="bg-gray-900/98 border-blue-500/70 shadow-2xl backdrop-blur-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <CardContent className="p-8 space-y-6">
          {/* Header */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 bg-gradient-to-br from-blue-600 to-teal-600 rounded-lg flex items-center justify-center">
                <Settings className="h-6 w-6 text-white" />
              </div>
              <div>
                <h2 className="text-2xl font-bold text-white">Demo Configuration</h2>
                <p className="text-gray-400 text-sm">Customize your presentation experience</p>
              </div>
            </div>
            <Button 
              variant="ghost" 
              size="sm"
              onClick={onClose}
              className="text-gray-400 hover:text-white hover:bg-white/10"
              data-testid="config-close-btn"
            >
              <X className="h-5 w-5" />
            </Button>
          </div>

          {/* Preset Selection */}
          <div className="space-y-3">
            <Label className="text-white font-semibold">Demo Length</Label>
            <div className="grid grid-cols-2 gap-3">
              {Object.entries(presets).map(([key, preset]) => (
                <Button
                  key={key}
                  variant="outline"
                  onClick={() => setSelectedPreset(key)}
                  className={`h-auto p-4 flex flex-col items-start justify-start space-y-2 ${
                    selectedPreset === key
                      ? 'bg-blue-600/30 border-blue-500 text-white'
                      : 'bg-gray-800/50 border-gray-700 text-gray-300 hover:bg-gray-800 hover:text-white'
                  }`}
                  data-testid={`preset-${key}`}
                >
                  <div className="flex items-center gap-2 w-full">
                    {preset.icon}
                    <span className="font-semibold">{preset.name}</span>
                  </div>
                  <div className="text-xs text-left space-y-1">
                    <div className="opacity-90">{preset.description}</div>
                    <div className="flex items-center gap-2">
                      <Badge variant="secondary" className="text-xs">
                        {preset.duration}
                      </Badge>
                      {preset.scenes > 0 && (
                        <span className="opacity-75">{preset.scenes} scenes</span>
                      )}
                    </div>
                  </div>
                </Button>
              ))}
            </div>
          </div>

          {/* Persona Selection */}
          <div className="space-y-3">
            <Label className="text-white font-semibold">Executive Persona</Label>
            <Select value={selectedPersona} onValueChange={(value: any) => setSelectedPersona(value)}>
              <SelectTrigger className="bg-gray-800 border-gray-700 text-white" data-testid="select-persona">
                <SelectValue placeholder="Select persona" />
              </SelectTrigger>
              <SelectContent className="bg-gray-800 border-gray-700">
                <SelectItem value="ceo" className="text-white hover:bg-gray-700">
                  <div className="flex items-center gap-2">
                    <Target className="h-4 w-4" />
                    CEO - Strategic Leadership
                  </div>
                </SelectItem>
                <SelectItem value="coo" className="text-white hover:bg-gray-700">
                  <div className="flex items-center gap-2">
                    <Zap className="h-4 w-4" />
                    COO - Operational Excellence
                  </div>
                </SelectItem>
                <SelectItem value="chro" className="text-white hover:bg-gray-700">
                  <div className="flex items-center gap-2">
                    <Users className="h-4 w-4" />
                    CHRO - People & Culture
                  </div>
                </SelectItem>
                <SelectItem value="cto" className="text-white hover:bg-gray-700">
                  <div className="flex items-center gap-2">
                    <Brain className="h-4 w-4" />
                    CTO - Technology Innovation
                  </div>
                </SelectItem>
                <SelectItem value="cio" className="text-white hover:bg-gray-700">
                  <div className="flex items-center gap-2">
                    <Settings className="h-4 w-4" />
                    CIO - Digital Transformation
                  </div>
                </SelectItem>
                <SelectItem value="cdo" className="text-white hover:bg-gray-700">
                  <div className="flex items-center gap-2">
                    <BarChart3 className="h-4 w-4" />
                    CDO - Data & Analytics
                  </div>
                </SelectItem>
                <SelectItem value="ciso" className="text-white hover:bg-gray-700">
                  <div className="flex items-center gap-2">
                    <Shield className="h-4 w-4" />
                    CISO - Security & Risk
                  </div>
                </SelectItem>
                <SelectItem value="cfo" className="text-white hover:bg-gray-700">
                  <div className="flex items-center gap-2">
                    <DollarSign className="h-4 w-4" />
                    CFO - Financial Strategy
                  </div>
                </SelectItem>
              </SelectContent>
            </Select>
            <p className="text-xs text-gray-400">Tailors narration and focus areas to specific executive priorities</p>
          </div>

          {/* Industry Selection */}
          <div className="space-y-3">
            <Label className="text-white font-semibold">Industry Context</Label>
            <Select value={selectedIndustry} onValueChange={(value: any) => setSelectedIndustry(value)}>
              <SelectTrigger className="bg-gray-800 border-gray-700 text-white" data-testid="select-industry">
                <SelectValue placeholder="Select industry" />
              </SelectTrigger>
              <SelectContent className="bg-gray-800 border-gray-700">
                <SelectItem value="general" className="text-white hover:bg-gray-700">
                  General Enterprise
                </SelectItem>
                <SelectItem value="healthcare" className="text-white hover:bg-gray-700">
                   Healthcare & Life Sciences
                </SelectItem>
                <SelectItem value="finance" className="text-white hover:bg-gray-700">
                   Financial Services
                </SelectItem>
                <SelectItem value="manufacturing" className="text-white hover:bg-gray-700">
                   Manufacturing
                </SelectItem>
                <SelectItem value="retail" className="text-white hover:bg-gray-700">
                   Retail & E-Commerce
                </SelectItem>
              </SelectContent>
            </Select>
            <p className="text-xs text-gray-400">Shows crisis scenarios relevant to your industry</p>
          </div>

          {/* Advanced Options */}
          <div className="space-y-3 pt-4 border-t border-gray-700">
            <Label className="text-white font-semibold">Advanced Options</Label>
            
            <div className="flex items-center justify-between bg-gray-800/50 p-3 rounded-lg">
              <div>
                <div className="text-white text-sm font-medium">Auto-advance scenes</div>
                <div className="text-gray-400 text-xs">Automatically progress through demo</div>
              </div>
              <Switch 
                checked={autoAdvance} 
                onCheckedChange={setAutoAdvance}
                data-testid="switch-auto-advance"
              />
            </div>

            <div className="flex items-center justify-between bg-gray-800/50 p-3 rounded-lg">
              <div>
                <div className="text-white text-sm font-medium">Show ROI calculator</div>
                <div className="text-gray-400 text-xs">Display interactive value proposition</div>
              </div>
              <Switch 
                checked={showROI} 
                onCheckedChange={setShowROI}
                data-testid="switch-show-roi"
              />
            </div>
          </div>

          {/* Start Button */}
          <div className="pt-4">
            <Button 
              onClick={handleStartDemo}
              className="w-full bg-gradient-to-r from-blue-600 to-teal-600 hover:from-blue-700 hover:to-teal-700 text-white font-semibold py-6 text-lg"
              data-testid="config-start-demo-btn"
            >
              Launch Personalized Demo
            </Button>
            <p className="text-center text-xs text-gray-400 mt-2">
              Estimated duration: {presets[selectedPreset as keyof typeof presets].duration}
            </p>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/DemoNavHeader.tsx
========================================
import { Button } from "@/components/ui/button";
import { ArrowLeft, BookOpen } from "lucide-react";
import { useLocation } from "wouter";

interface DemoNavHeaderProps {
  title?: string;
  showBackButton?: boolean;
}

export default function DemoNavHeader({ 
  title = "Interactive Demo", 
  showBackButton = true 
}: DemoNavHeaderProps) {
  const [, setLocation] = useLocation();

  const handleBack = () => {
    // Try to go back in history, fallback to industry demos hub
    if (window.history.length > 1) {
      window.history.back();
    } else {
      setLocation('/industry-demos');
    }
  };

  return (
    <header 
      className="fixed top-0 left-0 right-0 z-50 bg-slate-950/80 backdrop-blur-md border-b border-white/10"
      data-testid="demo-nav-header"
    >
      <div className="container mx-auto px-6 py-4">
        <div className="flex items-center justify-between">
          {/* Left: Logo + Title */}
          <div className="flex items-center gap-6">
            <button
              onClick={() => setLocation('/')}
              className="flex items-center gap-3 hover:opacity-80 transition-opacity"
              data-testid="button-home"
            >
              <div className="w-9 h-9 bg-gradient-to-br from-slate-100 to-slate-300 rounded-lg flex items-center justify-center shadow-lg">
                <span className="text-slate-900 font-bold text-lg">M</span>
              </div>
              <div className="hidden md:block">
                <div className="text-white font-bold text-lg">M</div>
                <div className="text-blue-400 text-xs">Strategic Execution OS</div>
              </div>
            </button>
            
            <div className="hidden md:flex items-center gap-2 text-sm text-blue-300">
              <span className="text-white/50">/</span>
              <span>{title}</span>
            </div>
          </div>

          {/* Right: Navigation Actions */}
          <div className="flex items-center gap-3">
            {showBackButton && (
              <Button
                variant="ghost"
                size="sm"
                onClick={handleBack}
                className="text-white hover:bg-white/10"
                data-testid="button-back"
              >
                <ArrowLeft className="h-4 w-4 mr-2" />
                <span className="hidden sm:inline">Back</span>
              </Button>
            )}
            
            <Button
              size="sm"
              onClick={() => setLocation('/playbook-library')}
              className="bg-blue-600 hover:bg-blue-500 text-white"
              data-testid="button-explore-playbooks"
            >
              <BookOpen className="h-4 w-4 mr-2" />
              <span className="hidden sm:inline">Explore</span> Playbooks
            </Button>
          </div>
        </div>
      </div>
    </header>
  );
}


========================================
FILE: client/src/components/demo/DemoShareModal.tsx
========================================
import { useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Badge } from '@/components/ui/badge';
import { useToast } from '@/hooks/use-toast';
import { 
  X, 
  Copy, 
  Mail, 
  Share2,
  CheckCircle,
  Link as LinkIcon,
  Users
} from 'lucide-react';

interface DemoShareModalProps {
  onClose: () => void;
  persona?: 'ceo' | 'coo' | 'chro' | 'cto' | 'cio' | 'cdo' | 'ciso' | 'cfo';
  industry?: 'healthcare' | 'finance' | 'manufacturing' | 'retail' | 'general';
}

export default function DemoShareModal({ onClose, persona = 'ceo', industry = 'general' }: DemoShareModalProps) {
  const { toast } = useToast();
  const [copied, setCopied] = useState(false);
  const [emailText, setEmailText] = useState('');
  
  // Generate personalized demo URL
  const baseUrl = typeof window !== 'undefined' ? window.location.origin : '';
  const demoUrl = `${baseUrl}/hybrid-demo?persona=${persona}&industry=${industry}&autostart=true`;
  
  // Generate email template
  const emailTemplates = {
    ceo: {
      subject: "Executive Decision Velocity Platform - Live Demo",
      body: `I wanted to share this interactive demo showcasing how Fortune 1000 companies achieve 12-minute execution vs the 72-hour industry standard.

Key highlights:
 Strategic ROI: $8.2M monthly value creation
 Decision Velocity: 85% faster than traditional coordination
 Comprehensive template library (12+ starting templates) + What-If Analyzer to build YOUR playbooks
 Real-time threat detection and response

The demo is fully interactive and takes about 5-10 minutes. It's personalized for CEO-level strategic priorities.

Launch Demo: ${demoUrl}

Best regards`
    },
    coo: {
      subject: "Operational Excellence Platform - Interactive Demo",
      body: `I wanted to share an interactive demo showing operational excellence in action - 12-minute coordination that typically takes 72 hours.

Key benefits:
 85% reduction in coordination time
 94% first-time execution success rate
 Automated playbook activation
 Real-time progress tracking

This 5-10 minute demo is tailored for operational leaders and shows the complete execution workflow.

Launch Demo: ${demoUrl}

Best regards`
    },
    chro: {
      subject: "Workforce Intelligence Platform - Live Demo",
      body: `I wanted to share this demo showing how our platform improves workforce stability and organizational health during crisis situations.

Key features:
 34% better retention during disruptions
 41% higher employee morale
 Automated workforce communication
 Cultural analytics and insights

The demo takes 5-10 minutes and focuses on people-first crisis management.

Launch Demo: ${demoUrl}

Best regards`
    },
    cto: {
      subject: "Technical Resilience Platform - Interactive Demo",
      body: `I wanted to share a demo showing how our Strategic Execution Operating System enables technical resilience and innovation velocity through AI intelligence, 24/7 monitoring, and coordinated execution. Launch Demo: ${demoUrl}`
    },
    cio: {
      subject: "Digital Continuity Platform - Interactive Demo",
      body: `I wanted to share a demo showing how our Strategic Execution Operating System ensures IT compliance and operational reliability with complete ecosystem integration and institutional memory. Launch Demo: ${demoUrl}`
    },
    cdo: {
      subject: "Data Governance Platform - Interactive Demo",
      body: `I wanted to share a demo showing how our Strategic Execution Operating System protects data integrity and accelerates analytics through AI-powered monitoring and strategic preparation. Launch Demo: ${demoUrl}`
    },
    ciso: {
      subject: "Security Response Platform - Interactive Demo",
      body: `I wanted to share a demo showing how our Strategic Execution Operating System strengthens cybersecurity posture with 12-minute response capabilities and complete integration hub. Launch Demo: ${demoUrl}`
    },
    cfo: {
      subject: "Financial Stability Platform - Interactive Demo",
      body: `I wanted to share a demo showing how our Strategic Execution Operating System protects liquidity and optimizes costs with executive intelligence and institutional memory. Launch Demo: ${demoUrl}`
    },
    general: {
      subject: "M - Strategic Execution Operating System Demo",
      body: `I wanted to share this interactive demo of M's Strategic Execution Operating System.

See how Fortune 1000 companies achieve:
 12-minute execution (vs 72-hour standard)
 $8.2M monthly value creation
 94% execution success rate
 Comprehensive template library (12+ starting templates) + What-If Analyzer to build YOUR playbooks

Experience "Certainty, Engineered" - the demo is fully interactive and takes about 5-10 minutes.

Launch Demo: ${demoUrl}

Best regards`
    }
  } as const;

  const template = emailTemplates[persona];

  const handleCopyLink = async () => {
    try {
      await navigator.clipboard.writeText(demoUrl);
      setCopied(true);
      toast({
        title: "Link Copied!",
        description: "Demo URL has been copied to your clipboard"
      });
      setTimeout(() => setCopied(false), 3000);
    } catch (error) {
      toast({
        title: "Copy Failed",
        description: "Please manually copy the link",
        variant: "destructive"
      });
    }
  };

  const handleCopyEmail = async () => {
    const fullEmail = `Subject: ${template.subject}\n\n${template.body}`;
    try {
      await navigator.clipboard.writeText(fullEmail);
      toast({
        title: "Email Template Copied!",
        description: "Paste into your email client"
      });
    } catch (error) {
      toast({
        title: "Copy Failed",
        description: "Please manually copy the email text",
        variant: "destructive"
      });
    }
  };

  const handleEmailClient = () => {
    const mailtoLink = `mailto:?subject=${encodeURIComponent(template.subject)}&body=${encodeURIComponent(template.body)}`;
    window.location.href = mailtoLink;
  };

  return (
    <div 
      className="fixed inset-0 z-[10002] flex items-center justify-center bg-black/60 backdrop-blur-sm"
      data-testid="demo-share-modal"
    >
      <Card className="bg-gray-900/98 border-blue-500/70 shadow-2xl backdrop-blur-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <CardContent className="p-8 space-y-6">
          
          {/* Header */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                <Share2 className="h-6 w-6 text-white" />
              </div>
              <div>
                <h2 className="text-2xl font-bold text-white">Share Demo</h2>
                <p className="text-gray-400 text-sm">Send this experience to your team</p>
              </div>
            </div>
            <Button 
              variant="ghost" 
              size="sm"
              onClick={onClose}
              className="text-gray-400 hover:text-white hover:bg-white/10"
              data-testid="share-close-btn"
            >
              <X className="h-5 w-5" />
            </Button>
          </div>

          {/* Personalization Info */}
          <div className="flex items-center gap-2 bg-blue-950/30 rounded-lg p-3 border border-blue-500/30">
            <Users className="h-5 w-5 text-blue-400" />
            <span className="text-sm text-gray-300">
              This demo link is personalized for:
            </span>
            <Badge variant="outline" className="bg-blue-600/20 text-blue-300 border-blue-500/50">
              {persona.toUpperCase()}
            </Badge>
            <Badge variant="outline" className="bg-purple-600/20 text-purple-300 border-purple-500/50">
              {industry.charAt(0).toUpperCase() + industry.slice(1)}
            </Badge>
          </div>

          {/* Direct Link */}
          <div className="space-y-3">
            <Label className="text-white font-semibold flex items-center gap-2">
              <LinkIcon className="h-4 w-4" />
              Direct Demo Link
            </Label>
            <div className="flex gap-2">
              <Input 
                value={demoUrl}
                readOnly
                className="bg-gray-800 border-gray-700 text-gray-300 font-mono text-sm"
                data-testid="demo-url-input"
              />
              <Button 
                onClick={handleCopyLink}
                variant="outline"
                className={`${copied ? 'border-green-500 text-green-300' : 'border-blue-500 text-blue-300'} hover:bg-blue-600/20 min-w-[100px]`}
                data-testid="copy-link-btn"
              >
                {copied ? (
                  <>
                    <CheckCircle className="h-4 w-4 mr-2" />
                    Copied!
                  </>
                ) : (
                  <>
                    <Copy className="h-4 w-4 mr-2" />
                    Copy
                  </>
                )}
              </Button>
            </div>
            <p className="text-xs text-gray-400">
              This link will automatically start the demo with your selected settings
            </p>
          </div>

          {/* Email Template */}
          <div className="space-y-3">
            <Label className="text-white font-semibold flex items-center gap-2">
              <Mail className="h-4 w-4" />
              Email Template
            </Label>
            
            {/* Subject */}
            <div className="space-y-2">
              <Label className="text-sm text-gray-400">Subject Line</Label>
              <Input 
                value={template.subject}
                readOnly
                className="bg-gray-800 border-gray-700 text-gray-300"
                data-testid="email-subject-input"
              />
            </div>

            {/* Body */}
            <div className="space-y-2">
              <Label className="text-sm text-gray-400">Email Body</Label>
              <Textarea 
                value={template.body}
                readOnly
                rows={12}
                className="bg-gray-800 border-gray-700 text-gray-300 font-mono text-sm"
                data-testid="email-body-textarea"
              />
            </div>

            {/* Email Actions */}
            <div className="flex gap-2">
              <Button 
                onClick={handleEmailClient}
                className="flex-1 bg-blue-600 hover:bg-blue-700"
                data-testid="open-email-client-btn"
              >
                <Mail className="h-4 w-4 mr-2" />
                Open in Email Client
              </Button>
              <Button 
                onClick={handleCopyEmail}
                variant="outline"
                className="border-gray-600 hover:bg-gray-800"
                data-testid="copy-email-btn"
              >
                <Copy className="h-4 w-4 mr-2" />
                Copy Template
              </Button>
            </div>
          </div>

          {/* Usage Tips */}
          <div className="bg-purple-950/30 rounded-lg p-4 border border-purple-500/30">
            <h3 className="text-white font-semibold mb-2 flex items-center gap-2">
              <Share2 className="h-4 w-4 text-purple-400" />
              Sharing Tips
            </h3>
            <ul className="text-sm text-gray-300 space-y-1 list-disc list-inside">
              <li>Demo auto-starts when recipients click the link</li>
              <li>Takes 5-10 minutes depending on selected duration</li>
              <li>Fully interactive - no installation required</li>
              <li>Recipients can pause/replay any scene</li>
              <li>Perfect for board presentations and executive reviews</li>
            </ul>
          </div>

        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/DemoStrategicSimulation.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Button } from '@/components/ui/button';
import { 
  AlertTriangle, 
  Clock, 
  DollarSign, 
  Users, 
  Building2,
  TrendingDown,
  CheckCircle,
  Play,
  Zap
} from 'lucide-react';
import { useEffect, useState } from 'react';

export function DemoStrategicAlert() {
  const { state, currentSceneData } = useDemoController();
  
  if (!state.isActive) return null;
  
  const sceneId = currentSceneData?.id || '';
  
  const showAlert = ['trigger-alert', 'situation-analysis', 'decision-activation', 'playbook-activation', 'execution-tracking'].includes(sceneId);
  
  if (!showAlert) return null;
  
  return (
    <div className="mb-6" data-testid="demo-strategic-alert">
      <Alert className="border-red-500 bg-red-50 dark:bg-red-900/20">
        <AlertTriangle className="h-5 w-5 text-red-600" />
        <AlertDescription className="ml-2">
          <div className="flex items-center justify-between">
            <div>
              <span className="font-semibold text-red-900 dark:text-red-100">STRATEGIC TRIGGER ACTIVATED:</span>
              <span className="text-red-800 dark:text-red-200 ml-2">
                Primary Supplier Financial Distress - AcmeParts Inc
              </span>
            </div>
            <Badge className="bg-red-600 text-white">CRITICAL</Badge>
          </div>
        </AlertDescription>
      </Alert>
    </div>
  );
}

export function DemoActiveStrategicCard() {
  const { state, currentSceneData } = useDemoController();
  const [elapsedTime, setElapsedTime] = useState(0);
  const [taskProgress, setTaskProgress] = useState(0);
  
  useEffect(() => {
    const sceneId = currentSceneData?.id || '';
    
    if (['playbook-activation', 'execution-tracking'].includes(sceneId)) {
      const timer = setInterval(() => {
        setElapsedTime(prev => Math.min(prev + 1, 720)); // 12 minutes max
        setTaskProgress(prev => Math.min(prev + 3, 94));
      }, 1000);
      
      return () => clearInterval(timer);
    }
  }, [currentSceneData?.id]);
  
  if (!state.isActive) return null;
  
  const sceneId = currentSceneData?.id || '';
  const showStrategicCard = ['trigger-alert', 'situation-analysis', 'decision-activation', 'playbook-activation', 'execution-tracking'].includes(sceneId);
  
  if (!showStrategicCard) return null;
  
  const isActivated = ['playbook-activation', 'execution-tracking'].includes(sceneId);
  const showAnalysis = ['situation-analysis', 'decision-activation', 'playbook-activation', 'execution-tracking'].includes(sceneId);
  
  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };
  
  return (
    <Card className="border-red-300 bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 shadow-lg" data-testid="demo-active-strategic-card">
      <CardHeader>
        <div className="flex items-start justify-between">
          <div className="flex-1">
            <div className="flex items-center gap-2 mb-2">
              <AlertTriangle className="h-6 w-6 text-red-600" />
              <CardTitle className="text-xl text-red-900 dark:text-red-100">
                Supply Chain Disruption - AcmeParts Inc
              </CardTitle>
            </div>
            <div className="flex gap-2">
              <Badge className="bg-red-600 text-white">CRITICAL</Badge>
              <Badge variant="outline" className="border-orange-500 text-orange-700 dark:text-orange-300">
                Supply Chain
              </Badge>
              {isActivated && (
                <Badge className="bg-green-600 text-white">
                  <Zap className="h-3 w-3 mr-1" />
                  PLAYBOOK ACTIVE
                </Badge>
              )}
            </div>
          </div>
          <div className="text-right">
            <div className="text-sm text-gray-600 dark:text-gray-400 mb-1">Detected</div>
            <div className="font-semibold text-gray-900 dark:text-gray-100">
              3 days ago
            </div>
            {isActivated && (
              <div className="mt-2 text-sm font-mono bg-blue-100 dark:bg-blue-900/30 px-3 py-1 rounded">
                Elapsed: {formatTime(elapsedTime)}
              </div>
            )}
          </div>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="bg-white dark:bg-gray-900/50 rounded-lg p-4 border border-red-200 dark:border-red-800">
          <h4 className="font-semibold text-gray-900 dark:text-gray-100 mb-3">Trigger Conditions Met</h4>
          <div className="space-y-2 text-sm">
            <div className="flex items-start gap-2">
              <CheckCircle className="h-4 w-4 text-red-600 mt-0.5" />
              <span className="text-gray-700 dark:text-gray-300">
                Supplier credit rating dropped to <strong>B-</strong> (threshold: B-)
              </span>
            </div>
            <div className="flex items-start gap-2">
              <CheckCircle className="h-4 w-4 text-red-600 mt-0.5" />
              <span className="text-gray-700 dark:text-gray-300">
                Stock price fell <strong>42%</strong> in 5 days (threshold: 40%)
              </span>
            </div>
            <div className="flex items-start gap-2">
              <CheckCircle className="h-4 w-4 text-red-600 mt-0.5" />
              <span className="text-gray-700 dark:text-gray-300">
                Detected <strong>72 hours before competitors</strong> - 5-day head start
              </span>
            </div>
          </div>
        </div>
        
        {showAnalysis && (
          <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
            <div className="bg-white dark:bg-gray-900/50 rounded-lg p-3 border border-gray-200 dark:border-gray-700">
              <div className="flex items-center gap-2 mb-1">
                <DollarSign className="h-4 w-4 text-yellow-600" />
                <span className="text-xs text-gray-600 dark:text-gray-400">Financial Exposure</span>
              </div>
              <div className="text-lg font-bold text-yellow-700 dark:text-yellow-400">$12M</div>
              <div className="text-xs text-gray-500">Quarterly revenue at risk</div>
            </div>
            
            <div className="bg-white dark:bg-gray-900/50 rounded-lg p-3 border border-gray-200 dark:border-gray-700">
              <div className="flex items-center gap-2 mb-1">
                <Users className="h-4 w-4 text-blue-600" />
                <span className="text-xs text-gray-600 dark:text-gray-400">Workforce Impact</span>
              </div>
              <div className="text-lg font-bold text-blue-700 dark:text-blue-400">847</div>
              <div className="text-xs text-gray-500">Employees affected</div>
            </div>
            
            <div className="bg-white dark:bg-gray-900/50 rounded-lg p-3 border border-gray-200 dark:border-gray-700">
              <div className="flex items-center gap-2 mb-1">
                <Building2 className="h-4 w-4 text-purple-600" />
                <span className="text-xs text-gray-600 dark:text-gray-400">Facilities</span>
              </div>
              <div className="text-lg font-bold text-purple-700 dark:text-purple-400">3</div>
              <div className="text-xs text-gray-500">Production sites at risk</div>
            </div>
            
            <div className="bg-white dark:bg-gray-900/50 rounded-lg p-3 border border-gray-200 dark:border-gray-700">
              <div className="flex items-center gap-2 mb-1">
                <TrendingDown className="h-4 w-4 text-red-600" />
                <span className="text-xs text-gray-600 dark:text-gray-400">Capacity Risk</span>
              </div>
              <div className="text-lg font-bold text-red-700 dark:text-red-400">35%</div>
              <div className="text-xs text-gray-500">Manufacturing capacity</div>
            </div>
          </div>
        )}
        
        {isActivated && (
          <div className="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
            <div className="flex items-center justify-between mb-3">
              <h4 className="font-semibold text-blue-900 dark:text-blue-100">
                Coordinated Response Execution
              </h4>
              <span className="text-sm font-semibold text-blue-700 dark:text-blue-300">
                {taskProgress}% Complete
              </span>
            </div>
            <Progress value={taskProgress} className="mb-3" />
            <div className="grid grid-cols-2 gap-2 text-sm">
              <div className="flex items-center gap-2">
                <CheckCircle className="h-4 w-4 text-green-600" />
                <span className="text-gray-700 dark:text-gray-300">Procurement: Alternative suppliers identified</span>
              </div>
              <div className="flex items-center gap-2">
                <CheckCircle className="h-4 w-4 text-green-600" />
                <span className="text-gray-700 dark:text-gray-300">Production: Revised schedules deployed</span>
              </div>
              <div className="flex items-center gap-2">
                <CheckCircle className="h-4 w-4 text-green-600" />
                <span className="text-gray-700 dark:text-gray-300">Finance: Payment protocols activated</span>
              </div>
              <div className="flex items-center gap-2">
                <Clock className="h-4 w-4 text-yellow-600 animate-pulse" />
                <span className="text-gray-700 dark:text-gray-300">Legal: Contract review in progress</span>
              </div>
            </div>
          </div>
        )}
        
        {!isActivated && sceneId === 'decision-activation' && (
          <Button className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white" size="lg" data-testid="demo-activate-playbook-btn">
            <Play className="h-5 w-5 mr-2" />
            Activate Supply Chain Disruption Playbook SCM-001
          </Button>
        )}
      </CardContent>
    </Card>
  );
}

export function DemoStrategicROIResults() {
  const { state, currentSceneData } = useDemoController();
  
  if (!state.isActive || currentSceneData?.id !== 'results-roi') return null;
  
  return (
    <div className="space-y-4" data-testid="demo-strategic-roi-results">
      <Card className="border-green-300 bg-gradient-to-br from-green-50 to-teal-50 dark:from-green-900/20 dark:to-teal-900/20">
        <CardHeader>
          <CardTitle className="text-2xl text-green-900 dark:text-green-100 flex items-center gap-2">
            <CheckCircle className="h-7 w-7 text-green-600" />
            Situation Resolved - Quantified Results
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div className="bg-white dark:bg-gray-900/50 rounded-lg p-4 border border-green-200 dark:border-green-700">
              <div className="text-sm text-gray-600 dark:text-gray-400 mb-1">Response Time</div>
              <div className="text-3xl font-bold text-green-700 dark:text-green-400">12 min</div>
              <div className="text-xs text-green-600 dark:text-green-400">vs 72 hours traditional</div>
            </div>
            
            <div className="bg-white dark:bg-gray-900/50 rounded-lg p-4 border border-green-200 dark:border-green-700">
              <div className="text-sm text-gray-600 dark:text-gray-400 mb-1">Time Saved</div>
              <div className="text-3xl font-bold text-blue-700 dark:text-blue-400">71.8 hrs</div>
              <div className="text-xs text-blue-600 dark:text-blue-400">Decision velocity advantage</div>
            </div>
            
            <div className="bg-white dark:bg-gray-900/50 rounded-lg p-4 border border-green-200 dark:border-green-700">
              <div className="text-sm text-gray-600 dark:text-gray-400 mb-1">Revenue Protected</div>
              <div className="text-3xl font-bold text-yellow-700 dark:text-yellow-400">$12M</div>
              <div className="text-xs text-yellow-600 dark:text-yellow-400">Quarterly revenue secured</div>
            </div>
            
            <div className="bg-white dark:bg-gray-900/50 rounded-lg p-4 border border-green-200 dark:border-green-700">
              <div className="text-sm text-gray-600 dark:text-gray-400 mb-1">Competitive Edge</div>
              <div className="text-3xl font-bold text-purple-700 dark:text-purple-400">5 days</div>
              <div className="text-xs text-purple-600 dark:text-purple-400">Head start vs competitors</div>
            </div>
          </div>
          
          <div className="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
            <h4 className="font-semibold text-blue-900 dark:text-blue-100 mb-2">Execution Success Metrics</h4>
            <div className="grid grid-cols-3 gap-3 text-sm">
              <div>
                <div className="text-gray-600 dark:text-gray-400">Task Completion</div>
                <div className="text-lg font-bold text-blue-700 dark:text-blue-300">94%</div>
              </div>
              <div>
                <div className="text-gray-600 dark:text-gray-400">Team Coordination</div>
                <div className="text-lg font-bold text-blue-700 dark:text-blue-300">47 members</div>
              </div>
              <div>
                <div className="text-gray-600 dark:text-gray-400">Departments</div>
                <div className="text-lg font-bold text-blue-700 dark:text-blue-300">8 teams</div>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/DemoWelcomeScreen.tsx
========================================
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { 
  Rocket, 
  Clock, 
  Target, 
  TrendingUp, 
  Users, 
  CheckCircle,
  Zap,
  Building2,
  DollarSign
} from 'lucide-react';

interface DemoWelcomeScreenProps {
  onStartDemo: () => void;
  onClose: () => void;
}

export default function DemoWelcomeScreen({ onStartDemo, onClose }: DemoWelcomeScreenProps) {

  const keyStats = [
    { 
      icon: Clock, 
      value: "12 min", 
      label: "Target Execution Time",
      comparison: "Design goal vs 72-hour industry standard",
      color: "text-green-400"
    },
    { 
      icon: Target, 
      value: "5 AI", 
      label: "Intelligence Modules",
      comparison: "Pulse, Flux, Prism, Echo, Nova",
      color: "text-blue-400"
    },
    { 
      icon: CheckCircle, 
      value: "13", 
      label: "Strategic Scenarios",
      comparison: "Pre-built playbook templates",
      color: "text-purple-400"
    },
    { 
      icon: Zap, 
      value: "166", 
      label: "Playbook Templates",
      comparison: "Strategic response frameworks",
      color: "text-orange-400"
    }
  ];

  const demoHighlights = [
    "12-Minute Execution Playbooks (vs 72-hour industry standard)",
    "Strategic Work Breakdown Structure with phases & dependencies",
    "All 5 AI Intelligence Modules in action",
    "Trigger-activated coordinated execution",
    "166 strategic playbook templates across 9 operational domains",
    "Interactive ROI calculations showing 360x velocity",
    "Practice drills and strategic rehearsals"
  ];

  return (
    <div 
      className="fixed inset-0 z-[10001] flex items-center justify-center bg-black/70 backdrop-blur-sm"
      data-testid="demo-welcome-screen"
    >
      <Card className="bg-gray-900/98 border-blue-500/70 shadow-2xl backdrop-blur-lg max-w-5xl w-full max-h-[90vh] overflow-y-auto">
        <CardContent className="p-8 space-y-6">
          
          {/* Header */}
          <div className="text-center space-y-3">
            <div className="flex items-center justify-center gap-3">
              <div className="w-16 h-16 bg-gradient-to-br from-blue-600 to-teal-600 rounded-xl flex items-center justify-center">
                <Rocket className="h-8 w-8 text-white" />
              </div>
            </div>
            <h1 className="text-4xl font-bold text-white">
              Welcome to M's Live Demo
            </h1>
            <p className="text-xl text-gray-300 max-w-3xl mx-auto">
              See how M's elite methodology transforms 72-hour strategic coordination into 12-minute executionthe Strategic Execution Operating System in action
            </p>
          </div>

          {/* Key Stats */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            {keyStats.map((stat, index) => (
              <Card key={index} className="bg-gray-800/50 border-gray-700">
                <CardContent className="p-4 text-center">
                  <stat.icon className={`h-8 w-8 ${stat.color} mx-auto mb-2`} />
                  <div className="text-2xl font-bold text-white mb-1">{stat.value}</div>
                  <div className="text-sm font-medium text-gray-300">{stat.label}</div>
                  <div className="text-xs text-gray-400 mt-1">{stat.comparison}</div>
                </CardContent>
              </Card>
            ))}
          </div>

          {/* What You'll See */}
          <div className="space-y-3">
            <h2 className="text-2xl font-bold text-white flex items-center gap-2">
              <Target className="h-6 w-6 text-blue-400" />
              What You'll Experience
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
              {demoHighlights.map((highlight, index) => (
                <div key={index} className="flex items-center gap-2 text-gray-300">
                  <CheckCircle className="h-5 w-5 text-green-400 flex-shrink-0" />
                  <span>{highlight}</span>
                </div>
              ))}
            </div>
          </div>

          {/* Early Access Program */}
          <div className="bg-gradient-to-r from-purple-950/50 to-pink-950/50 rounded-lg p-6 border border-purple-500/30">
            <h3 className="text-lg font-semibold text-white mb-3 flex items-center gap-2">
              <Building2 className="h-5 w-5 text-purple-400" />
              Built for Fortune 1000 Strategic Execution
            </h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
              <div>
                <div className="text-3xl font-bold text-white mb-1">10</div>
                <div className="text-xs text-gray-300">Pilot Program Target</div>
              </div>
              <div>
                <div className="text-3xl font-bold text-white mb-1">90</div>
                <div className="text-xs text-gray-300">Day Validation Period</div>
              </div>
              <div>
                <div className="text-3xl font-bold text-white mb-1">Q1</div>
                <div className="text-xs text-gray-300">2025 Planned Launch</div>
              </div>
              <div>
                <div className="text-3xl font-bold text-white mb-1">100%</div>
                <div className="text-xs text-gray-300">Risk-Free Trial</div>
              </div>
            </div>
          </div>

          {/* Demo Disclaimer */}
          <div className="bg-yellow-900/30 rounded-lg p-6 border border-yellow-600/30">
            <div className="flex items-start gap-4">
              <div className="w-12 h-12 bg-yellow-600/20 rounded-lg flex items-center justify-center flex-shrink-0">
                <Target className="h-6 w-6 text-yellow-400" />
              </div>
              <div>
                <p className="text-gray-300 mb-2">
                  <strong className="text-white">Interactive Demo:</strong> Sample data shown for illustration purposes. Scenarios and workflows reflect M's design capabilities and championship-level execution methodology.
                </p>
                <p className="text-gray-400 text-sm">
                  Experience how preparation-driven execution transforms 72-hour coordination into 12-minute strategic response.
                </p>
              </div>
            </div>
          </div>

          {/* Duration Info */}
          <div className="flex items-center justify-center gap-6 text-sm text-gray-400">
            <div className="flex items-center gap-2">
              <Clock className="h-4 w-4" />
              <span>Demo Duration: 2-10 minutes (your choice)</span>
            </div>
            <div className="flex items-center gap-2">
              <TrendingUp className="h-4 w-4" />
              <span>Interactive & Fully Automated</span>
            </div>
          </div>

          {/* CTA Buttons */}
          <div className="flex items-center justify-center gap-4 pt-4">
            <Button
              onClick={onClose}
              variant="outline"
              className="border-gray-600 text-gray-300 hover:bg-gray-800"
              data-testid="welcome-close-btn"
            >
              Maybe Later
            </Button>
            <Button 
              onClick={onStartDemo}
              className="bg-gradient-to-r from-blue-600 to-teal-600 hover:from-blue-700 hover:to-teal-700 text-white font-semibold px-8 py-6 text-lg"
              data-testid="welcome-start-demo-btn"
            >
              <Rocket className="h-5 w-5 mr-2" />
              Launch Demo Experience
            </Button>
          </div>

        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/ExecutionTimelineDemo.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { 
  Clock, 
  CheckCircle2, 
  ArrowRight, 
  Users, 
  Timer,
  AlertCircle,
  TrendingUp
} from 'lucide-react';
import { DEMO_EXECUTION_PLANS } from '@/lib/demoData';

interface ExecutionTimelineDemoProps {
  planType?: 'competitive_response' | 'compliance_deadline';
  showHeader?: boolean;
}

export default function ExecutionTimelineDemo({ 
  planType = 'competitive_response',
  showHeader = true 
}: ExecutionTimelineDemoProps) {
  const plan = DEMO_EXECUTION_PLANS[planType];

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'critical':
        return 'bg-red-500/20 text-red-400 border-red-500/50';
      case 'high':
        return 'bg-orange-500/20 text-orange-400 border-orange-500/50';
      case 'medium':
        return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50';
      default:
        return 'bg-blue-500/20 text-blue-400 border-blue-500/50';
    }
  };

  const getPhaseColor = (phaseName: string) => {
    if (phaseName.includes('IMMEDIATE')) return 'from-red-600 to-orange-600';
    if (phaseName.includes('SECONDARY')) return 'from-orange-600 to-yellow-600';
    if (phaseName.includes('FOLLOW')) return 'from-yellow-600 to-green-600';
    return 'from-blue-600 to-teal-600';
  };

  return (
    <div className="space-y-6" data-testid="execution-timeline-demo">
      
      {showHeader && (
        <div className="space-y-4">
          {/* Header */}
          <div className="flex items-start justify-between">
            <div className="space-y-2">
              <h2 className="text-2xl font-bold text-white">{plan.name}</h2>
              <p className="text-gray-400">{plan.description}</p>
            </div>
            <div className="text-right">
              <div className="flex items-center gap-2 text-green-400 mb-1">
                <Timer className="h-5 w-5" />
                <span className="text-3xl font-bold">{plan.targetExecutionTime} min</span>
              </div>
              <p className="text-sm text-gray-400">Target Execution Time</p>
            </div>
          </div>

          {/* Scenario & Trigger */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <Card className="bg-gray-800/50 border-gray-700">
              <CardHeader className="pb-3">
                <CardTitle className="text-sm text-gray-400 flex items-center gap-2">
                  <AlertCircle className="h-4 w-4" />
                  Scenario
                </CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-white text-sm">{plan.scenario}</p>
              </CardContent>
            </Card>

            <Card className="bg-gray-800/50 border-gray-700">
              <CardHeader className="pb-3">
                <CardTitle className="text-sm text-gray-400 flex items-center gap-2">
                  <Zap className="h-4 w-4" />
                  Trigger Condition
                </CardTitle>
              </CardHeader>
              <CardContent>
                <code className="text-green-400 text-sm font-mono">{plan.trigger}</code>
              </CardContent>
            </Card>
          </div>

          {/* Stakeholders */}
          <Card className="bg-gray-800/50 border-gray-700">
            <CardHeader className="pb-3">
              <CardTitle className="text-sm text-gray-400 flex items-center gap-2">
                <Users className="h-4 w-4" />
                {plan.stakeholders.length} Stakeholders Coordinated
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="flex flex-wrap gap-2">
                {plan.stakeholders.map((stakeholder, idx) => (
                  <Badge 
                    key={idx} 
                    variant="outline" 
                    className="bg-blue-500/10 border-blue-500/30 text-blue-400"
                  >
                    {stakeholder.role}: {stakeholder.name}
                  </Badge>
                ))}
              </div>
            </CardContent>
          </Card>

          {/* Performance Metrics */}
          {plan.historicalPerformance && (
            <div className="bg-gradient-to-r from-green-950/50 to-emerald-950/50 rounded-lg p-4 border border-green-500/30">
              <div className="grid grid-cols-4 gap-4 text-center">
                <div>
                  <div className="text-2xl font-bold text-green-400">{plan.historicalPerformance.actualTime} min</div>
                  <div className="text-xs text-gray-400">Last Execution Time</div>
                </div>
                <div>
                  <div className="text-2xl font-bold text-green-400">{plan.historicalPerformance.successRate}%</div>
                  <div className="text-xs text-gray-400">Success Rate</div>
                </div>
                <div>
                  <div className="text-2xl font-bold text-green-400">{plan.historicalPerformance.totalExecutions}</div>
                  <div className="text-xs text-gray-400">Total Executions</div>
                </div>
                <div>
                  <div className="text-sm font-semibold text-green-400 flex items-center justify-center gap-1">
                    <TrendingUp className="h-4 w-4" />
                    {plan.historicalPerformance.outcome}
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      )}

      {/* Execution Timeline - 3 Phases */}
      <div className="space-y-6">
        {Object.entries(plan.phases).map(([phaseKey, phase], phaseIdx) => (
          <Card key={phaseKey} className="bg-gray-800/50 border-gray-700 overflow-hidden">
            <div className={`bg-gradient-to-r ${getPhaseColor(phase.name)} p-4`}>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white font-bold">
                    {phaseIdx + 1}
                  </div>
                  <div>
                    <h3 className="text-xl font-bold text-white">{phase.name}</h3>
                    <p className="text-white/80 text-sm">{phase.timeWindow}</p>
                  </div>
                </div>
                <div className="text-right">
                  <div className="text-white font-semibold">{phase.tasks.length} Tasks</div>
                  {'dependsOn' in phase && phase.dependsOn && (
                    <div className="text-white/70 text-xs flex items-center gap-1">
                      <ArrowRight className="h-3 w-3" />
                      Depends on {phase.dependsOn}
                    </div>
                  )}
                </div>
              </div>
            </div>

            <CardContent className="p-6 space-y-4">
              {phase.tasks.map((task, taskIdx) => (
                <div 
                  key={taskIdx}
                  className="border-l-4 border-blue-500/50 pl-4 py-3 bg-gray-900/30 rounded-r-lg"
                  data-testid={`task-${phaseKey}-${taskIdx}`}
                >
                  <div className="flex items-start justify-between gap-4 mb-2">
                    <div className="flex items-start gap-3 flex-1">
                      <div className="w-8 h-8 bg-blue-600/20 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                        <span className="text-blue-400 text-sm font-bold">{task.sequence}</span>
                      </div>
                      <div className="flex-1 min-w-0">
                        <h4 className="text-white font-semibold mb-1 leading-tight">{task.title}</h4>
                        <p className="text-gray-400 text-sm mb-2">{task.description}</p>
                        
                        {/* Expected Outcome */}
                        <div className="flex items-start gap-2 text-green-400 text-sm">
                          <CheckCircle2 className="h-4 w-4 mt-0.5 flex-shrink-0" />
                          <span className="italic">{task.expectedOutcome}</span>
                        </div>
                      </div>
                    </div>

                    <div className="flex flex-col items-end gap-2 flex-shrink-0">
                      <Badge className={getPriorityColor(task.priority)}>
                        {task.priority.toUpperCase()}
                      </Badge>
                      <Badge variant="outline" className="bg-purple-500/10 border-purple-500/30 text-purple-400">
                        {task.role}
                      </Badge>
                      <div className="flex items-center gap-1 text-gray-400">
                        <Clock className="h-3 w-3" />
                        <span className="text-xs">{task.estimatedMinutes} min</span>
                      </div>
                    </div>
                  </div>

                  {/* Dependency Indicator */}
                  {'dependsOn' in task && task.dependsOn && (
                    <div className="flex items-center gap-2 text-orange-400 text-xs mt-2 pt-2 border-t border-gray-700">
                      <ArrowRight className="h-3 w-3" />
                      <span className="italic">Depends on: {task.dependsOn}</span>
                    </div>
                  )}
                </div>
              ))}
            </CardContent>
          </Card>
        ))}
      </div>

      {/* Execution Summary */}
      <Card className="bg-gradient-to-r from-blue-950/50 to-teal-950/50 border-blue-500/30">
        <CardContent className="p-6">
          <div className="space-y-4">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                <Timer className="h-5 w-5 text-blue-400" />
                Execution Summary
              </h3>
              <div className="text-right">
                <div className="text-3xl font-bold text-blue-400">{plan.targetExecutionTime} minutes</div>
                <div className="text-sm text-gray-400">Total Coordinated Response</div>
              </div>
            </div>
            
            <Progress value={100} className="h-2" />
            
            <div className="grid grid-cols-3 gap-4 text-center pt-2">
              <div>
                <div className="text-2xl font-bold text-white">
                  {Object.values(plan.phases).reduce((sum, phase) => sum + phase.tasks.length, 0)}
                </div>
                <div className="text-xs text-gray-400">Total Tasks</div>
              </div>
              <div>
                <div className="text-2xl font-bold text-white">{plan.stakeholders.length}</div>
                <div className="text-xs text-gray-400">Stakeholders</div>
              </div>
              <div>
                <div className="text-2xl font-bold text-green-400">360x</div>
                <div className="text-xs text-gray-400">Faster than 72 hours</div>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>

    </div>
  );
}

function Zap({ className }: { className?: string }) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
      <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
    </svg>
  );
}


========================================
FILE: client/src/components/demo/ExecutiveTestimonialOverlay.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { useEffect, useState } from 'react';
import { Quote, ArrowRight, Sparkles } from 'lucide-react';
import { Card } from '@/components/ui/card';

export function ExecutiveTestimonialOverlay() {
  const demoController = useDemoController();
  const [show, setShow] = useState(false);
  const [phase, setPhase] = useState<'before' | 'after'>('before');

  useEffect(() => {
    if (demoController.state.currentExecutiveStep === 4) {
      setShow(true);
      
      const phaseTimer = setTimeout(() => {
        setPhase('after');
      }, 3500);
      
      const hideTimer = setTimeout(() => setShow(false), 8000);
      
      return () => {
        clearTimeout(phaseTimer);
        clearTimeout(hideTimer);
      };
    } else {
      setShow(false);
      setPhase('before');
    }
  }, [demoController.state.currentExecutiveStep]);

  if (!show) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
      <div className="absolute inset-0 bg-black/75 backdrop-blur-sm animate-in fade-in duration-300" />
      
      <Card className="relative w-[950px] bg-gradient-to-br from-slate-950/95 via-slate-900/95 to-slate-950/95 border-slate-500/50 p-8 shadow-2xl animate-in zoom-in-95 duration-500">
        <div className="space-y-6">
          {/* Header */}
          <div className="text-center space-y-2">
            <div className="flex items-center justify-center gap-3">
              <Quote className="h-8 w-8 text-slate-400" />
              <h2 className="text-2xl font-bold text-slate-200">The Cost of Unpreparedness</h2>
            </div>
            <p className="text-slate-400 text-sm">Illustrative Scenario: Before vs After M Methodology (Sample Data)</p>
          </div>

          {/* Testimonial Content */}
          <div className="relative min-h-[280px]">
            {/* Before */}
            <div className={`absolute inset-0 transition-all duration-700 ${
              phase === 'before' ? 'opacity-100 translate-x-0' : 'opacity-0 -translate-x-full'
            }`}>
              <div className="bg-red-950/40 rounded-lg p-6 border border-red-500/30">
                <div className="flex items-start gap-4">
                  <div className="p-3 bg-red-600/30 rounded-full">
                    <Quote className="h-6 w-6 text-red-400" />
                  </div>
                  <div className="flex-1 space-y-4">
                    <p className="text-sm text-red-400 font-semibold uppercase tracking-wide">
                      Without Preparation Framework
                    </p>
                    <blockquote className="text-xl text-red-100 leading-relaxed">
                      Traditional ad-hoc approach: When crisis hits, executives scramble to coordinate response. 
                      No playbooks, no rehearsed roles, no pre-built execution plans.
                    </blockquote>
                    <div className="space-y-2 pt-2">
                      <p className="text-red-200/80 italic"> Typical result: 72-hour coordination delay</p>
                      <p className="text-red-200/80 italic"> Common outcome: Missed execution windows</p>
                      <p className="text-red-200/80 italic"> Industry standard: Reactive vs anticipatory</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* After */}
            <div className={`absolute inset-0 transition-all duration-700 ${
              phase === 'after' ? 'opacity-100 translate-x-0' : 'opacity-0 translate-x-full'
            }`}>
              <div className="bg-emerald-950/40 rounded-lg p-6 border border-emerald-500/30">
                <div className="flex items-start gap-4">
                  <div className="p-3 bg-emerald-600/30 rounded-full">
                    <Sparkles className="h-6 w-6 text-emerald-400" />
                  </div>
                  <div className="flex-1 space-y-4">
                    <p className="text-sm text-emerald-400 font-semibold uppercase tracking-wide">
                      With M Methodology
                    </p>
                    <blockquote className="text-xl text-emerald-100 leading-relaxed">
                      NFL-inspired approach: Pre-built playbooks for every scenario. Roles rehearsed. 
                      AI monitoring for early warning. One-click coordinated execution when trigger fires.
                    </blockquote>
                    <div className="space-y-2 pt-2">
                      <p className="text-emerald-200/80 italic"> Design goal: 12-minute execution from trigger</p>
                      <p className="text-emerald-200/80 italic"> Projected outcome: Capture windows competitors miss</p>
                      <p className="text-emerald-200/80 italic"> System capability: Preparation-driven velocity</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Transition Arrow */}
            <div className={`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 transition-all duration-500 ${
              phase === 'after' ? 'opacity-100 scale-100' : 'opacity-0 scale-50'
            }`}>
              <div className="p-4 bg-gradient-to-r from-red-600 to-emerald-600 rounded-full">
                <ArrowRight className="h-8 w-8 text-white" />
              </div>
            </div>
          </div>

          {/* Bottom Message */}
          <div className="bg-gradient-to-r from-slate-800/50 to-slate-700/50 rounded-lg p-5 border border-slate-600/40">
            <p className="text-center text-slate-200 text-lg">
              {phase === 'before' ? (
                <span className="text-red-300">The question isn't IF a crisis will hitit's whether you'll be prepared.</span>
              ) : (
                <span className="text-emerald-300 font-semibold">M turns strategic preparation into your competitive advantage.</span>
              )}
            </p>
          </div>
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/FOMOScoreboard.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { Trophy, TrendingUp, Users } from 'lucide-react';
import { Card } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { useEffect, useState } from 'react';
import { demoData } from '@/lib/demoData';

export function FOMOScoreboard() {
  const demoController = useDemoController();
  const [show, setShow] = useState(false);

  useEffect(() => {
    if (!demoController.state.isActive) {
      setShow(false);
      return;
    }

    if (demoController.state.currentExecutiveStep === 2) {
      setShow(true);
      const hideTimer = setTimeout(() => setShow(false), 6000);
      return () => clearTimeout(hideTimer);
    } else {
      setShow(false);
    }
  }, [demoController.state.isActive, demoController.state.currentExecutiveStep]);

  if (!show) return null;

  // Use enhanced demo data for WOW factor
  const yourScore = demoData.preparedness.overall; // 94
  const yourRank = 12; // Improved from 23
  const totalExecutives = 500;
  const percentile = Math.round((1 - (yourRank / totalExecutives)) * 100);
  const industryAverage = 72; // Improved from 62 to show better delta

  const topPeers = [
    { rank: 1, name: 'Anonymous CEO', company: 'Tech Fortune 100', score: 98 },
    { rank: 2, name: 'Anonymous CEO', company: 'Pharma Fortune 50', score: 97 },
    { rank: 3, name: 'Anonymous CEO', company: 'Finance Fortune 100', score: 96 },
  ];

  return (
    <div className="fixed bottom-6 left-6 z-40" data-testid="fomo-scoreboard">
      <Card className="bg-gradient-to-br from-purple-950/90 to-indigo-950/90 border-purple-500/30 backdrop-blur-sm shadow-2xl">
        <div className="p-4 space-y-3 min-w-[320px]">
          <div className="flex items-center justify-between gap-3">
            <div className="text-xs font-semibold text-purple-300 uppercase tracking-wider">
              Executive Preparedness
            </div>
            <Trophy className="h-4 w-4 text-purple-400 animate-pulse" />
          </div>

          {/* Your Score */}
          <div className="text-center py-2 bg-purple-900/30 rounded-lg border border-purple-500/20">
            <div className="text-xs text-purple-400 mb-1">YOUR SCORE</div>
            <div className="flex items-baseline justify-center gap-2">
              <span className="text-5xl font-bold text-purple-400 tabular-nums">
                {yourScore}
              </span>
              <span className="text-xl text-purple-300">/100</span>
            </div>
            <div className="text-xs text-purple-300 mt-1">
              Top {percentile}% of Fortune 1000 CEOs
            </div>
          </div>

          {/* Ranking */}
          <div className="grid grid-cols-2 gap-3">
            <div className="text-center">
              <div className="text-xs text-purple-400/70 mb-1">Your Rank</div>
              <div className="text-2xl font-bold text-purple-400">
                #{yourRank}
              </div>
              <div className="text-xs text-purple-300/70">of {totalExecutives}</div>
            </div>
            
            <div className="text-center border-l border-purple-500/20">
              <div className="text-xs text-purple-400/70 mb-1">vs Average</div>
              <div className="text-2xl font-bold text-emerald-400">
                +{yourScore - industryAverage}
              </div>
              <div className="text-xs text-purple-300/70">points ahead</div>
            </div>
          </div>

          {/* Progress to Top Tier */}
          <div className="space-y-2 pt-2 border-t border-purple-500/20">
            <div className="flex items-center justify-between text-xs">
              <span className="text-purple-300">To Top 5 (Score 96)</span>
              <span className="text-purple-400 font-semibold">2 pts</span>
            </div>
            <Progress value={(yourScore / 96) * 100} className="h-2" />
          </div>

          {/* Top 3 Leaderboard */}
          <div className="space-y-2 pt-2 border-t border-purple-500/20">
            <div className="text-xs text-purple-300 font-semibold flex items-center gap-2">
              <Users className="h-3 w-3" />
              Top 3 CEOs
            </div>
            {topPeers.map((peer) => (
              <div key={peer.rank} className="flex items-center justify-between text-xs bg-purple-900/20 rounded px-2 py-1">
                <div className="flex items-center gap-2">
                  <span className="text-amber-400 font-bold">#{peer.rank}</span>
                  <div>
                    <div className="text-purple-200">{peer.name}</div>
                    <div className="text-purple-400/70 text-xs">{peer.company}</div>
                  </div>
                </div>
                <span className="font-bold text-purple-300">{peer.score}</span>
              </div>
            ))}
          </div>

          {/* Competitive Pressure */}
          <div className="pt-2 border-t border-purple-500/30 bg-amber-500/10 rounded px-3 py-2">
            <div className="flex items-center gap-2 text-amber-400 text-xs">
              <TrendingUp className="h-3 w-3" />
              <span className="font-semibold">
                12 executives practicing scenarios this week
              </span>
            </div>
            <div className="text-xs text-amber-300/70 mt-1">
              Don't fall behind in preparedness rankings
            </div>
          </div>
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/FourOutcomesScorecard.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { CheckCircle2, Clock, Users, Heart, TrendingUp, Award, Shield, ExternalLink, BarChart3, Zap } from 'lucide-react';

interface OutcomeScore {
  name: string;
  score: number;
  description: string;
  icon: React.ReactNode;
  color: string;
  details: string[];
}

interface FourOutcomesScorecardProps {
  stakeholdersTotal: number;
  stakeholdersAcknowledged: number;
  coordinationTime: string;
  avgResponseTime: string;
  tasksCompleted: number;
  tasksTotal: number;
  engagementRate: number;
  overrideCount?: number;
}

export default function FourOutcomesScorecard({
  stakeholdersTotal,
  stakeholdersAcknowledged,
  coordinationTime,
  avgResponseTime,
  tasksCompleted,
  tasksTotal,
  engagementRate,
  overrideCount = 0
}: FourOutcomesScorecardProps) {
  
  const calculateClarity = (): number => {
    if (stakeholdersTotal === 0 || tasksTotal === 0) return 0;
    const acknowledgmentRate = (stakeholdersAcknowledged / stakeholdersTotal) * 100;
    const taskClarityRate = (tasksCompleted / tasksTotal) * 100;
    const score = (acknowledgmentRate * 0.6 + taskClarityRate * 0.4);
    return Math.round(Math.min(100, Math.max(0, score)));
  };

  const calculateSpeed = (): number => {
    const timeParts = coordinationTime.split(':');
    if (timeParts.length < 2) return 0;
    
    const coordinationMinutes = parseFloat(timeParts[0]) + parseFloat(timeParts[1]) / 60;
    if (isNaN(coordinationMinutes)) return 0;
    
    const coordinationScore = 100 - ((coordinationMinutes - 12) * 5);
    
    const responseMinutes = parseFloat(avgResponseTime);
    if (isNaN(responseMinutes)) return 0;
    
    const responseScore = 100 - ((responseMinutes - 2) * 10);
    
    const score = (coordinationScore * 0.7 + responseScore * 0.3);
    return Math.round(Math.min(100, Math.max(0, score)));
  };

  const calculateSkills = (): number => {
    if (tasksTotal === 0) return 0;
    const completionRate = (tasksCompleted / tasksTotal) * 100;
    return Math.round(Math.min(100, Math.max(0, completionRate)));
  };

  const calculateCommitment = (): number => {
    if (stakeholdersTotal === 0) return 0;
    const acknowledgmentRate = (stakeholdersAcknowledged / stakeholdersTotal) * 100;
    const score = (engagementRate * 0.6 + acknowledgmentRate * 0.4);
    return Math.round(Math.min(100, Math.max(0, score)));
  };

  const outcomes: OutcomeScore[] = [
    {
      name: 'Clarity',
      score: calculateClarity(),
      description: 'Resources and accountabilities aligned to strategy',
      icon: <CheckCircle2 className="w-6 h-6" />,
      color: 'text-blue-600 dark:text-blue-400',
      details: [
        `${stakeholdersAcknowledged}/${stakeholdersTotal} stakeholders understood their role (${Math.round((stakeholdersAcknowledged/stakeholdersTotal)*100)}%)`,
        `${tasksCompleted}/${tasksTotal} tasks had clear ownership (${Math.round((tasksCompleted/tasksTotal)*100)}%)`,
        '0 decisions required escalation',
        'All accountabilities transparent'
      ]
    },
    {
      name: 'Speed',
      score: calculateSpeed(),
      description: 'Workflows are fast, tech-enabled, and frictionless',
      icon: <Clock className="w-6 h-6" />,
      color: 'text-green-600 dark:text-green-400',
      details: [
        `Coordination time: ${coordinationTime} (vs 72 hours traditional)`,
        `Average response time: ${avgResponseTime}`,
        '360x faster than email/meetings',
        'Time to first action: 37 seconds'
      ]
    },
    {
      name: 'Skills',
      score: calculateSkills(),
      description: 'Future-ready workforce equipped to deliver value',
      icon: <Users className="w-6 h-6" />,
      color: 'text-purple-600 dark:text-purple-400',
      details: [
        '100% of required skills available',
        'No critical skill gaps identified',
        'Cross-functional expertise present',
        'Team capabilities matched to objectives'
      ]
    },
    {
      name: 'Commitment',
      score: calculateCommitment(),
      description: 'Performance-oriented culture drives execution',
      icon: <Heart className="w-6 h-6" />,
      color: 'text-red-600 dark:text-red-400',
      details: [
        `${engagementRate}% team engagement rate`,
        `${stakeholdersAcknowledged}/${stakeholdersTotal} active participation`,
        'Strong organizational alignment',
        'Shared ownership of outcomes'
      ]
    }
  ];

  const overallScore = Math.round(
    outcomes.reduce((sum, outcome) => sum + outcome.score, 0) / outcomes.length
  );

  const getScoreLabel = (score: number): string => {
    if (score >= 90) return 'Excellent';
    if (score >= 80) return 'Very Good';
    if (score >= 70) return 'Good';
    if (score >= 60) return 'Fair';
    return 'Needs Improvement';
  };

  const getScoreColor = (score: number): string => {
    if (score >= 90) return 'bg-green-500';
    if (score >= 80) return 'bg-blue-500';
    if (score >= 70) return 'bg-yellow-500';
    if (score >= 60) return 'bg-orange-500';
    return 'bg-red-500';
  };

  const humanDecisionRate = 100;
  const systemOverrideRate = tasksTotal > 0 ? Math.round((overrideCount / tasksTotal) * 100) : 0;

  return (
    <div className="w-full max-w-6xl mx-auto space-y-6 p-6" data-testid="scorecard-four-outcomes">
      <div className="text-center space-y-2">
        <div className="flex items-center justify-center gap-2">
          <Award className="w-8 h-8 text-yellow-500" />
          <h2 className="text-3xl font-bold" data-testid="text-scorecard-title">Execution Performance Scorecard</h2>
        </div>
        <p className="text-lg text-muted-foreground">
          McKinsey's Four Outcomes That Drive Organizational Performance
        </p>
      </div>

      <Card className="border-2 border-primary">
        <CardHeader>
          <CardTitle className="flex items-center justify-between">
            <span>Overall Execution Score</span>
            <Badge className={`${getScoreColor(overallScore)} text-white text-xl px-4 py-2`} data-testid="badge-overall-score">
              {overallScore}/100
            </Badge>
          </CardTitle>
          <CardDescription className="text-lg">
            {getScoreLabel(overallScore)} - This activation demonstrated{' '}
            {overallScore >= 80 ? 'excellent' : 'good'} organizational execution capability
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Progress value={overallScore} className="h-4" data-testid="progress-overall-score" />
        </CardContent>
      </Card>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {outcomes.map((outcome) => (
          <Card key={outcome.name} className="hover:shadow-lg transition-shadow" data-testid={`card-outcome-${outcome.name.toLowerCase()}`}>
            <CardHeader>
              <CardTitle className="flex items-center gap-3">
                <div className={outcome.color}>
                  {outcome.icon}
                </div>
                <div className="flex-1">
                  <div className="flex items-center justify-between">
                    <span>{outcome.name}</span>
                    <Badge variant="secondary" className="text-lg" data-testid={`badge-${outcome.name.toLowerCase()}-score`}>
                      {outcome.score}/100
                    </Badge>
                  </div>
                </div>
              </CardTitle>
              <CardDescription>{outcome.description}</CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <Progress value={outcome.score} className="h-3" />
              
              <div className="space-y-2">
                {outcome.details.map((detail, idx) => (
                  <div key={idx} className="flex items-start gap-2 text-sm">
                    <CheckCircle2 className="w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0" />
                    <span className="text-muted-foreground">{detail}</span>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      <Card className="bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-300 dark:border-blue-700" data-testid="card-trust-indicators">
        <CardHeader>
          <CardTitle className="flex items-center gap-3">
            <Shield className="w-6 h-6 text-blue-600 dark:text-blue-400" />
            <span>Trust & Transparency</span>
          </CardTitle>
          <CardDescription className="text-base">
            Augmented Execution means humans stay in control
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span className="font-medium">Stakeholder Engagement</span>
                <span className="font-semibold text-blue-600 dark:text-blue-400">{engagementRate}%</span>
              </div>
              <Progress value={engagementRate} className="h-2 bg-blue-100 dark:bg-blue-900" />
              <p className="text-xs text-muted-foreground">{stakeholdersAcknowledged}/{stakeholdersTotal} participated actively</p>
            </div>

            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span className="font-medium">Human Decision Rate</span>
                <span className="font-semibold text-green-600 dark:text-green-400">{humanDecisionRate}%</span>
              </div>
              <Progress value={humanDecisionRate} className="h-2 bg-green-100 dark:bg-green-900" />
              <p className="text-xs text-muted-foreground">All critical decisions human-approved</p>
            </div>

            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span className="font-medium">System Override Rate</span>
                <span className="font-semibold text-purple-600 dark:text-purple-400">{systemOverrideRate}%</span>
              </div>
              <Progress value={systemOverrideRate} className="h-2 bg-purple-100 dark:bg-purple-900" />
              <p className="text-xs text-muted-foreground">{overrideCount} task{overrideCount !== 1 ? 's' : ''} modified by stakeholder choice</p>
            </div>

            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span className="font-medium">Governance Compliance</span>
                <span className="font-semibold text-green-600 dark:text-green-400">100%</span>
              </div>
              <Progress value={100} className="h-2 bg-green-100 dark:bg-green-900" />
              <p className="text-xs text-muted-foreground">Full audit trail maintained</p>
            </div>
          </div>

          <div className="pt-4 border-t border-blue-200 dark:border-blue-800 space-y-3">
            <p className="text-sm text-muted-foreground">
              M augments human execution by eliminating coordination friction while keeping humans in full control. 
              This activation demonstrated high trust through transparent stakeholder engagement, human oversight of all 
              critical decisions, and the ability to override system recommendations when needed.
            </p>
            <div className="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 border border-purple-200 dark:border-purple-800">
              <p className="text-xs text-purple-900 dark:text-purple-100">
                <strong>Future Enhancement:</strong> Conversational activation via Slack/Teams will enable 10-second command-to-execution, 
                AI autonomous tasks (drafting comms, generating reports), and rapid hypothesis testingall while maintaining 
                the same 100% human decision rate and override capability you see above.
              </p>
            </div>
          </div>
        </CardContent>
      </Card>

      <Card data-testid="card-benchmark-comparison">
        <CardHeader>
          <CardTitle>Industry Benchmark Comparison</CardTitle>
          <CardDescription>
            How this activation compares to industry averages
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span className="font-semibold">Your Score</span>
                <span className="font-bold text-lg text-primary">{overallScore}/100</span>
              </div>
              <Progress value={overallScore} className="h-3" />
            </div>
            
            <div className="space-y-2 opacity-60">
              <div className="flex justify-between text-sm text-muted-foreground">
                <span>Industry Average (Without M)</span>
                <span>45/100</span>
              </div>
              <Progress value={45} className="h-2" />
            </div>
            
            <div className="space-y-2 opacity-60">
              <div className="flex justify-between text-sm text-muted-foreground">
                <span>Top Performers (Fortune 100)</span>
                <span>72/100</span>
              </div>
              <Progress value={72} className="h-2" />
            </div>

            <div className="pt-4 border-t space-y-2">
              <div className="flex items-start gap-2">
                <CheckCircle2 className="w-5 h-5 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0" />
                <p className="text-sm">
                  Your score is <span className="font-bold text-primary">{overallScore - 45} points</span> above industry average
                </p>
              </div>
              <div className="flex items-start gap-2">
                <CheckCircle2 className="w-5 h-5 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0" />
                <p className="text-sm">
                  M users score <span className="font-bold text-primary">107% higher</span> than organizations using traditional coordination methods
                </p>
              </div>
              <div className="flex items-start gap-2">
                <CheckCircle2 className="w-5 h-5 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0" />
                <p className="text-sm">
                  You're outperforming <span className="font-bold text-primary">94%</span> of Fortune 100 companies
                </p>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <Card className="bg-gradient-to-br from-blue-50 to-white dark:from-blue-900/20 dark:to-background border-blue-200 dark:border-blue-800" data-testid="card-citation-mckinsey">
          <CardContent className="pt-6 space-y-3">
            <div className="flex items-center gap-2">
              <TrendingUp className="w-5 h-5 text-blue-600 dark:text-blue-400" />
              <h3 className="font-semibold text-sm">McKinsey "Organize to Value"</h3>
            </div>
            <p className="text-xs text-muted-foreground leading-relaxed">
              McKinsey research (June 2025) shows that operating models delivering these four outcomes
              Clarity, Speed, Skills, and Commitmentcan close the 30% strategy-to-execution gap that 
              even high-performing companies experience.
            </p>
            <Button 
              variant="link" 
              size="sm" 
              className="h-auto p-0 text-xs text-blue-600 dark:text-blue-400"
              asChild
            >
              <a 
                href="https://www.mckinsey.com/capabilities/people-and-organizational-performance/our-insights/a-new-operating-model-for-a-new-world" 
                target="_blank" 
                rel="noopener noreferrer"
                className="inline-flex items-center gap-1"
                data-testid="link-mckinsey-research"
              >
                Read McKinsey research
                <ExternalLink className="w-3 h-3" />
              </a>
            </Button>
          </CardContent>
        </Card>

        <Card className="bg-gradient-to-br from-purple-50 to-white dark:from-purple-900/20 dark:to-background border-purple-200 dark:border-purple-800" data-testid="card-citation-augmented">
          <CardContent className="pt-6 space-y-3">
            <div className="flex items-center gap-2">
              <Users className="w-5 h-5 text-purple-600 dark:text-purple-400" />
              <h3 className="font-semibold text-sm">Augmented Execution Philosophy</h3>
            </div>
            <p className="text-xs text-muted-foreground leading-relaxed">
              Based on Torsten D.'s framework: Human + Machine collaboration where humans stay in the loop 
              for critical decisions while machines handle coordination friction. "The real question isn't 
              what can we automate, it's where should humans stay in the loop."
            </p>
            <Button 
              variant="link" 
              size="sm" 
              className="h-auto p-0 text-xs text-purple-600 dark:text-purple-400"
              asChild
            >
              <a 
                href="#" 
                onClick={(e) => e.preventDefault()}
                className="inline-flex items-center gap-1"
                data-testid="link-augmented-execution"
              >
                Learn about Augmented Execution
                <ExternalLink className="w-3 h-3" />
              </a>
            </Button>
          </CardContent>
        </Card>

        <Card className="bg-gradient-to-br from-green-50 to-white dark:from-green-900/20 dark:to-background border-green-200 dark:border-green-800" data-testid="card-citation-mit">
          <CardContent className="pt-6 space-y-3">
            <div className="flex items-center gap-2">
              <BarChart3 className="w-5 h-5 text-green-600 dark:text-green-400" />
              <h3 className="font-semibold text-sm">MIT CIO-Validated Metrics</h3>
            </div>
            <p className="text-xs text-muted-foreground leading-relaxed">
              MIT Technology Review research with 600+ CIOs shows AI adoption delivers 22% efficiency gains 
              and 17% innovation velocity increases. Organizations with strong governance (like M's 
              human-in-the-loop model) achieve 14.3% better ROI and 24% lower compliance risk.
            </p>
            <Button 
              variant="link" 
              size="sm" 
              className="h-auto p-0 text-xs text-green-600 dark:text-green-400"
              asChild
            >
              <a 
                href="#" 
                onClick={(e) => e.preventDefault()}
                className="inline-flex items-center gap-1"
                data-testid="link-mit-research"
              >
                View MIT research
                <ExternalLink className="w-3 h-3" />
              </a>
            </Button>
          </CardContent>
        </Card>

        <Card className="bg-gradient-to-br from-orange-50 to-white dark:from-orange-900/20 dark:to-background border-orange-200 dark:border-orange-800" data-testid="card-citation-salesforce">
          <CardContent className="pt-6 space-y-3">
            <div className="flex items-center gap-2">
              <Zap className="w-5 h-5 text-orange-600 dark:text-orange-400" />
              <h3 className="font-semibold text-sm">Speed as Competitive Advantage</h3>
            </div>
            <p className="text-xs text-muted-foreground leading-relaxed">
              Salesforce research shows companies winning today aren't those with the best plans, but those 
              who execute fastest. The timeline from idea to execution has collapsed from years to months. 
              M collapses it from months to minutes.
            </p>
            <Button 
              variant="link" 
              size="sm" 
              className="h-auto p-0 text-xs text-orange-600 dark:text-orange-400"
              asChild
            >
              <a 
                href="#" 
                onClick={(e) => e.preventDefault()}
                className="inline-flex items-center gap-1"
                data-testid="link-salesforce-research"
              >
                Read Salesforce insights
                <ExternalLink className="w-3 h-3" />
              </a>
            </Button>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


========================================
FILE: client/src/components/demo/GuidedOverlay.tsx
========================================
import { useEffect, useState, useCallback, useRef } from 'react';
import { createPortal } from 'react-dom';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { useDemoController } from '@/contexts/DemoController';
import { 
  Play, 
  Pause, 
  SkipForward, 
  SkipBack, 
  X, 
  Maximize, 
  Minimize,
  Volume2,
  VolumeX,
  Settings
} from 'lucide-react';

interface HighlightedElement {
  element: HTMLElement;
  originalStyle: {
    zIndex: string;
    position: string;
    boxShadow: string;
    border: string;
  };
}

export default function GuidedOverlay() {
  const { 
    state, 
    currentSceneData, 
    pauseDemo, 
    resumeDemo, 
    nextScene, 
    prevScene, 
    stopDemo, 
    togglePresentationMode,
    jumpToScene,
    makeDecision
  } = useDemoController();
  
  const [highlightedElements, setHighlightedElements] = useState<HighlightedElement[]>([]);
  const [narrationVisible, setNarrationVisible] = useState(true);
  const [speechEnabled, setSpeechEnabled] = useState(true);
  const [isSpeaking, setIsSpeaking] = useState(false);
  const speechSynthRef = useRef<SpeechSynthesisUtterance | null>(null);

  // Highlight target elements
  const highlightElements = useCallback((targetIds: string[]) => {
    // Clear previous highlights
    setHighlightedElements(prev => {
      prev.forEach(({ element, originalStyle }) => {
        element.style.zIndex = originalStyle.zIndex;
        element.style.position = originalStyle.position;
        element.style.boxShadow = originalStyle.boxShadow;
        element.style.border = originalStyle.border;
      });
      return [];
    });

    const newHighlighted: HighlightedElement[] = [];

    targetIds.forEach(targetId => {
      const element = document.querySelector(`[data-testid="${targetId}"]`) as HTMLElement;
      if (element) {
        const originalStyle = {
          zIndex: element.style.zIndex || '',
          position: element.style.position || '',
          boxShadow: element.style.boxShadow || '',
          border: element.style.border || ''
        };

        // Apply highlight styling
        element.style.zIndex = '9999';
        element.style.position = 'relative';
        element.style.boxShadow = '0 0 0 4px rgba(59, 130, 246, 0.6), 0 0 20px rgba(59, 130, 246, 0.4)';
        element.style.border = '2px solid rgb(59, 130, 246)';
        
        newHighlighted.push({ element, originalStyle });
      }
    });

    setHighlightedElements(newHighlighted);
  }, []);

  // Text-to-Speech functions
  const stopSpeech = useCallback(() => {
    if (window.speechSynthesis) {
      window.speechSynthesis.cancel();
      setIsSpeaking(false);
    }
  }, []);

  const speakNarration = useCallback((text: string) => {
    if (!window.speechSynthesis || !speechEnabled) return;

    // Stop any ongoing speech
    stopSpeech();

    // Create new utterance
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = 0.95; // Slightly slower for clarity
    utterance.pitch = 1.0;
    utterance.volume = 1.0;

    utterance.onstart = () => setIsSpeaking(true);
    utterance.onend = () => setIsSpeaking(false);
    utterance.onerror = () => setIsSpeaking(false);

    speechSynthRef.current = utterance;
    window.speechSynthesis.speak(utterance);
  }, [speechEnabled, stopSpeech]);

  const toggleSpeech = useCallback(() => {
    if (speechEnabled) {
      stopSpeech();
      setSpeechEnabled(false);
    } else {
      setSpeechEnabled(true);
      // Start speaking current narration if available
      if (currentSceneData?.narration) {
        speakNarration(currentSceneData.narration);
      }
    }
  }, [speechEnabled, stopSpeech, currentSceneData, speakNarration]);

  // Speak narration when scene changes (if speech is enabled)
  useEffect(() => {
    if (speechEnabled && currentSceneData?.narration && !state.isPaused) {
      speakNarration(currentSceneData.narration);
    }
    return () => stopSpeech();
  }, [currentSceneData?.id, speechEnabled, state.isPaused, speakNarration, stopSpeech]);

  // Stop speech when demo pauses or stops
  useEffect(() => {
    if (state.isPaused || !state.isActive) {
      stopSpeech();
    }
  }, [state.isPaused, state.isActive, stopSpeech]);

  // Clear highlights when demo stops or scene changes
  useEffect(() => {
    if (!state.isActive) {
      setHighlightedElements(prev => {
        prev.forEach(({ element, originalStyle }) => {
          element.style.zIndex = originalStyle.zIndex;
          element.style.position = originalStyle.position;
          element.style.boxShadow = originalStyle.boxShadow;
          element.style.border = originalStyle.border;
        });
        return [];
      });
      return;
    }

    if (currentSceneData?.targetElements) {
      // Small delay to ensure page is rendered
      const timer = setTimeout(() => {
        highlightElements(currentSceneData.targetElements || []);
      }, 500);
      
      return () => clearTimeout(timer);
    }
  }, [state.isActive, currentSceneData?.id, highlightElements]);

  // Execute scene actions
  useEffect(() => {
    if (!currentSceneData?.actions || !state.isActive || state.isPaused) return;

    const executeActions = async () => {
      if (!currentSceneData.actions) return;
      
      for (const action of currentSceneData.actions) {
        if (action.delay) {
          await new Promise(resolve => setTimeout(resolve, action.delay));
        }

        const targetElement = action.target 
          ? document.querySelector(`[data-testid="${action.target}"]`) as HTMLElement
          : null;

        switch (action.type) {
          case 'click':
            if (targetElement) {
              targetElement.click();
            }
            break;
          case 'hover':
            if (targetElement) {
              targetElement.dispatchEvent(new MouseEvent('mouseenter', { bubbles: true }));
            }
            break;
          case 'scroll':
            if (targetElement) {
              targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            break;
          case 'wait':
            // Just wait, already handled by delay
            break;
        }
      }
    };

    executeActions();
  }, [currentSceneData, state.isActive, state.isPaused, state.currentScene]);

  // Only show GuidedOverlay during HybridDemoNavigator, not ExecutiveDemo
  if (!state.isActive || !currentSceneData || window.location.pathname === '/executive-demo') return null;

  return createPortal(
    <>
      {/* Backdrop for presentation mode */}
      {state.presentationMode && (
        <div className="fixed inset-0 bg-black/50 z-[9998]" data-testid="demo-backdrop" />
      )}

      {/* Floating Control Bar */}
      <div 
        className={`fixed top-4 right-4 z-[10000] ${state.presentationMode ? 'top-6 right-6' : ''}`}
        data-testid="demo-control-bar"
      >
        <Card className="bg-gray-900/95 border-blue-500/50 shadow-2xl backdrop-blur-md">
          <CardContent className="p-4">
            <div className="flex items-center gap-3">
              {/* Demo Info */}
              <div className="flex items-center gap-2 text-white">
                <Badge variant="outline" className="bg-blue-600/20 text-blue-300 border-blue-500/50">
                  LIVE DEMO
                </Badge>
                <span className="text-sm">
                  {state.currentScene + 1} / {state.totalScenes}
                </span>
              </div>

              {/* Playback Controls */}
              <div className="flex items-center gap-1">
                <Button 
                  size="sm" 
                  variant="ghost" 
                  onClick={prevScene}
                  disabled={state.currentScene === 0}
                  className="text-white hover:bg-white/10"
                  data-testid="demo-prev-btn"
                >
                  <SkipBack className="h-4 w-4" />
                </Button>
                
                <Button 
                  size="sm" 
                  variant="ghost"
                  onClick={state.isPaused ? resumeDemo : pauseDemo}
                  className="text-white hover:bg-white/10"
                  data-testid="demo-play-pause-btn"
                >
                  {state.isPaused ? <Play className="h-4 w-4" /> : <Pause className="h-4 w-4" />}
                </Button>
                
                <Button 
                  size="sm" 
                  variant="ghost"
                  onClick={nextScene}
                  disabled={state.currentScene >= state.totalScenes - 1}
                  className="text-white hover:bg-white/10"
                  data-testid="demo-next-btn"
                >
                  <SkipForward className="h-4 w-4" />
                </Button>
              </div>

              {/* Additional Controls */}
              <div className="flex items-center gap-1">
                <Button 
                  size="sm" 
                  variant="ghost"
                  onClick={togglePresentationMode}
                  className="text-white hover:bg-white/10"
                  data-testid="demo-presentation-mode-btn"
                >
                  {state.presentationMode ? <Minimize className="h-4 w-4" /> : <Maximize className="h-4 w-4" />}
                </Button>
                
                <Button 
                  size="sm" 
                  variant="ghost"
                  onClick={toggleSpeech}
                  className={`text-white hover:bg-white/10 ${speechEnabled ? 'bg-blue-600/30' : ''}`}
                  data-testid="demo-speech-toggle-btn"
                  title={speechEnabled ? 'Disable narration audio' : 'Enable narration audio'}
                >
                  {speechEnabled ? <Volume2 className="h-4 w-4" /> : <VolumeX className="h-4 w-4" />}
                </Button>
                
                <Button 
                  size="sm" 
                  variant="ghost"
                  onClick={stopDemo}
                  className="text-white hover:bg-white/10 hover:text-red-400"
                  data-testid="demo-stop-btn"
                >
                  <X className="h-4 w-4" />
                </Button>
              </div>
            </div>

            {/* Progress Bar */}
            <div className="mt-2 w-full bg-gray-700/50 rounded-full h-1">
              <div 
                className="bg-blue-500 h-1 rounded-full transition-all duration-1000"
                style={{ width: `${state.progress}%` }}
              />
            </div>

            {/* Progress Display */}
            <div className="mt-1 text-center text-xs text-gray-400">
              <span>{Math.round(state.progress)}% Complete</span>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Narration Card - Positioned above split-screen comparison */}
      {narrationVisible && !currentSceneData.isDecisionPoint && (
        <div 
          className={`fixed right-4 z-[10000] max-w-lg ${state.presentationMode ? 'right-6' : ''}`}
          style={{ bottom: state.presentationMode ? '44vh' : '42vh' }}
          data-testid="demo-narration-card"
        >
          <Card className="bg-gray-900/95 border-blue-500/50 shadow-2xl backdrop-blur-sm max-h-64 overflow-hidden flex flex-col">
            <CardContent className="p-4 overflow-y-auto">
              <div className="flex items-start gap-3">
                <div className="flex-shrink-0">
                  <div className={`w-10 h-10 rounded-md flex items-center justify-center ${isSpeaking && speechEnabled ? 'bg-blue-600 animate-pulse' : 'bg-blue-600/60'}`}>
                    <Volume2 className={`h-5 w-5 text-white ${isSpeaking && speechEnabled ? 'animate-pulse' : ''}`} />
                  </div>
                </div>
                
                <div className="flex-1 min-w-0">
                  <div className="flex items-center justify-between mb-2">
                    <h3 className="text-sm font-bold text-white">
                      {currentSceneData.title}
                    </h3>
                    {speechEnabled && (
                      <Badge className="bg-green-600/80 text-white text-xs">
                         Audio On
                      </Badge>
                    )}
                  </div>
                  
                  <p className="text-white text-sm leading-relaxed">
                    {currentSceneData.narration}
                  </p>
                  
                  {!speechEnabled && (
                    <p className="text-blue-300 text-xs mt-2 italic">
                       Tip: Click the volume icon in the control bar to enable audio narration
                    </p>
                  )}
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Decision Point Card - Interactive persona selection */}
      {currentSceneData.isDecisionPoint && currentSceneData.decisionOptions && (
        <div 
          className={`fixed inset-4 z-[10001] flex items-center justify-center ${state.presentationMode ? 'inset-6' : ''}`}
          data-testid="demo-decision-card"
        >
          <Card className="bg-gray-900/98 border-blue-500/70 shadow-2xl backdrop-blur-lg max-w-6xl w-full max-h-[90vh] overflow-hidden">
            <CardContent className="p-8 overflow-y-auto max-h-[90vh]">
              <div className="text-center mb-6">
                <div className="w-16 h-16 bg-gradient-to-br from-blue-600 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-4">
                  <Settings className="h-8 w-8 text-white" />
                </div>
                <h2 className="text-2xl font-bold text-white mb-2">
                  {currentSceneData.title}
                </h2>
                <p className="text-gray-300 text-base">
                  {currentSceneData.narration}
                </p>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                {currentSceneData.decisionOptions.map((option) => (
                  <Button
                    key={option.id}
                    onClick={() => makeDecision(option.id)}
                    className="bg-gradient-to-r from-blue-600 to-teal-600 hover:from-blue-700 hover:to-teal-700 text-white p-4 h-auto text-left justify-start transition-all duration-300 transform hover:scale-105"
                    data-testid={`decision-option-${option.id}`}
                  >
                    <div className="space-y-1.5 w-full">
                      <div className="font-bold text-base">{option.label}</div>
                      <div className="text-xs text-blue-100 opacity-90 leading-snug">
                        {option.description}
                      </div>
                      <div className="text-xs text-blue-200 opacity-75 font-medium">
                        Click to continue with {option.focus} focus 
                      </div>
                    </div>
                  </Button>
                ))}
              </div>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Scene Preview Sidebar (in presentation mode) */}
      {state.presentationMode && (
        <div 
          className="fixed left-6 top-1/2 transform -translate-y-1/2 z-[10000] w-64"
          data-testid="demo-scene-preview"
        >
          <Card className="bg-gray-900/95 border-blue-500/50 shadow-2xl backdrop-blur-md">
            <CardContent className="p-4">
              <h4 className="text-white font-semibold mb-3">Demo Scenes</h4>
              <div className="space-y-2 max-h-64 overflow-y-auto">
                {hybridDemoScenarios.map((scene, index) => (
                  <Button
                    key={scene.id}
                    variant="ghost"
                    size="sm"
                    onClick={() => jumpToScene(index)}
                    className={`w-full justify-start text-left h-auto p-2 ${
                      index === state.currentScene
                        ? 'bg-blue-600/30 text-blue-300 border border-blue-500/50'
                        : 'text-gray-400 hover:text-white hover:bg-white/5'
                    }`}
                    data-testid={`demo-scene-${index}`}
                  >
                    <div>
                      <div className="text-xs font-medium">
                        {index + 1}. {scene.title}
                      </div>
                      <div className="text-xs opacity-70">
                        {scene.subtitle}
                      </div>
                    </div>
                  </Button>
                ))}
              </div>
            </CardContent>
          </Card>
        </div>
      )}
    </>,
    document.body
  );
}

// Import hybridDemoScenarios for the scene preview
import { hybridDemoScenarios } from '@/contexts/DemoController';

========================================
FILE: client/src/components/demo/HeroMetricsOverlay.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { Shield, Zap, Target, Dumbbell } from 'lucide-react';
import { Card } from '@/components/ui/card';
import { useEffect, useState } from 'react';

export function HeroMetricsOverlay() {
  const demoController = useDemoController();
  const [show, setShow] = useState(false);

  useEffect(() => {
    if (!demoController.state.isActive) {
      setShow(false);
      return;
    }

    if (demoController.state.currentExecutiveStep === 0) {
      setShow(true);
      const hideTimer = setTimeout(() => setShow(false), 6000);
      return () => clearTimeout(hideTimer);
    } else {
      setShow(false);
    }
  }, [demoController.state.isActive, demoController.state.currentExecutiveStep]);

  const metrics = [
    {
      icon: Zap,
      label: 'Decision Velocity',
      value: '12 min',
      comparison: 'vs 72 hrs',
      color: 'text-amber-400',
      bgColor: 'bg-amber-500/10',
      borderColor: 'border-amber-500/30'
    },
    {
      icon: Shield,
      label: 'Preparedness Score',
      value: '85',
      comparison: 'Top 3%',
      color: 'text-blue-400',
      bgColor: 'bg-blue-500/10',
      borderColor: 'border-blue-500/30'
    },
    {
      icon: Target,
      label: 'Active Triggers',
      value: '24/7',
      comparison: 'AI Monitoring',
      color: 'text-purple-400',
      bgColor: 'bg-purple-500/10',
      borderColor: 'border-purple-500/30'
    },
    {
      icon: Dumbbell,
      label: 'Practice Mode',
      value: 'Live',
      comparison: 'What-If Ready',
      color: 'text-emerald-400',
      bgColor: 'bg-emerald-500/10',
      borderColor: 'border-emerald-500/30'
    }
  ];

  if (!show) return null;

  return (
    <div className="fixed top-20 right-6 z-40 space-y-2" data-testid="hero-metrics-overlay">
      <div className="text-xs font-semibold text-white/60 text-right mb-2">
        YOUR COMPETITIVE ADVANTAGE
      </div>
      
      {metrics.map((metric, index) => {
        const Icon = metric.icon;
        return (
          <Card 
            key={index}
            className={`${metric.bgColor} ${metric.borderColor} border backdrop-blur-sm transition-all duration-300 hover:scale-105`}
            style={{
              animation: `slideInRight 0.5s ease-out ${index * 0.1}s both`
            }}
          >
            <div className="p-3 flex items-center gap-3">
              <div className={`${metric.color}`}>
                <Icon className="h-5 w-5" />
              </div>
              <div className="flex-1 min-w-0">
                <div className="text-xs text-white/70 font-medium truncate">
                  {metric.label}
                </div>
                <div className="flex items-baseline gap-2">
                  <span className={`text-lg font-bold ${metric.color}`}>
                    {metric.value}
                  </span>
                  <span className="text-xs text-white/50">
                    {metric.comparison}
                  </span>
                </div>
              </div>
            </div>
          </Card>
        );
      })}

      <style>{`
        @keyframes slideInRight {
          from {
            opacity: 0;
            transform: translateX(100px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
      `}</style>
    </div>
  );
}


========================================
FILE: client/src/components/demo/InteractiveDecisionPoint.tsx
========================================
import { useState, useEffect, useCallback } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { 
  Clock, 
  CheckCircle2, 
  XCircle, 
  AlertTriangle,
  Zap,
  Brain,
  ArrowRight,
  Target,
  Shield,
  TrendingUp
} from 'lucide-react';

export type DecisionScenario = 
  | 'ransomware_initial' 
  | 'competitor_response' 
  | 'regulatory_disclosure'
  | 'supply_chain_action'
  | 'crisis_communication';

interface DecisionOption {
  id: string;
  label: string;
  description: string;
  isOptimal: boolean;
  consequence: string;
  reasoning: string;
}

interface DecisionConfig {
  title: string;
  context: string;
  timeLimit: number;
  options: DecisionOption[];
  mRecommendation: string;
  mReasoning: string;
}

interface InteractiveDecisionPointProps {
  scenario: DecisionScenario;
  onComplete: (selectedOption: string, wasOptimal: boolean) => void;
  decisionNumber?: number;
  totalDecisions?: number;
}

const DECISION_CONFIGS: Record<DecisionScenario, DecisionConfig> = {
  ransomware_initial: {
    title: 'Board Communication Strategy',
    context: 'Your CISO just confirmed ransomware encryption is spreading. The Board Chair is calling in 30 minutes demanding an update. You have incomplete information.',
    timeLimit: 45,
    options: [
      {
        id: 'wait',
        label: 'Wait for Full Assessment',
        description: 'Delay the board call until you have complete information',
        isOptimal: false,
        consequence: 'Board loses confidence. Rumors fill the information vacuum. Media gets the story first.',
        reasoning: 'In crisis, speed beats perfection. Stakeholders prefer honest uncertainty over silence.'
      },
      {
        id: 'brief',
        label: 'Brief with What You Know',
        description: 'Share current status, unknowns, and next steps with timeline',
        isOptimal: true,
        consequence: 'Board appreciates transparency. They provide resources and air cover. Trust maintained.',
        reasoning: 'Structured uncertainty communication builds trust. "Here\'s what we know, don\'t know, and are doing."'
      },
      {
        id: 'delegate',
        label: 'Delegate to CISO',
        description: 'Have your CISO handle board communications while you manage response',
        isOptimal: false,
        consequence: 'Board feels leadership is absent. CISO struggles with business context. Message gets confused.',
        reasoning: 'Strategic crises require C-suite presence. Delegation signals lack of gravity.'
      }
    ],
    mRecommendation: 'Brief with What You Know',
    mReasoning: 'M\'s Crisis Communication Playbook provides a pre-approved "Fog of War" template designed for exactly this situation: structured updates with explicit uncertainty acknowledgment. Your board was briefed on this protocol during onboarding.'
  },
  competitor_response: {
    title: 'Competitive Counter-Strategy',
    context: 'Your main competitor just announced 40% price cuts. Your sales team is panicking. CFO says matching prices cuts $180M from margins. You have a board meeting in 2 hours.',
    timeLimit: 60,
    options: [
      {
        id: 'match',
        label: 'Match Their Pricing',
        description: 'Immediately announce matching discounts to protect market share',
        isOptimal: false,
        consequence: '$180M margin hit. Competitor was baiting you. They have lower cost structure and win the attrition war.',
        reasoning: 'Reactive price wars favor the aggressor. You\'re playing their game.'
      },
      {
        id: 'differentiate',
        label: 'Double Down on Value',
        description: 'Launch campaign highlighting unique capabilities competitor lacks',
        isOptimal: true,
        consequence: 'Premium customers stay loyal. You lose price-sensitive segment but protect margins. Competitor\'s low-price customers become support burden.',
        reasoning: 'Differentiation breaks the commoditization trap. Your unique value justifies premium.'
      },
      {
        id: 'bundle',
        label: 'Create Bundled Offering',
        description: 'Package products with services to obscure direct price comparison',
        isOptimal: false,
        consequence: 'Adds complexity. Sales team struggles with new positioning. Implementation takes 6 weekstoo slow.',
        reasoning: 'Bundling is a long-term strategy, not a crisis response. Too slow for urgent threat.'
      }
    ],
    mRecommendation: 'Double Down on Value',
    mReasoning: 'M\'s Competitive Response Playbook #47 (Price War Defense) shows that value differentiation outperforms price matching 73% of the time in enterprise markets. Your pre-staged campaign assets are ready for immediate deployment.'
  },
  regulatory_disclosure: {
    title: 'Investor Communication Timing',
    context: 'SEC investigation notice received. Your legal team says you have 48 hours before formal disclosure required. Stock is trading normally. Insider trading rules now apply to everyone.',
    timeLimit: 45,
    options: [
      {
        id: 'immediate',
        label: 'Disclose Immediately',
        description: 'File 8-K today and get ahead of any leaks',
        isOptimal: true,
        consequence: 'Stock drops 12% but stabilizes. Investor relations team controls narrative. No insider trading issues.',
        reasoning: 'Proactive disclosure signals strong governance. Markets punish surprises, not problems.'
      },
      {
        id: 'wait',
        label: 'Wait Full 48 Hours',
        description: 'Use all available time to prepare comprehensive response',
        isOptimal: false,
        consequence: 'Word leaks. Stock drops 18% on rumors. SEC views delay as obstruction. Class action lawyers circle.',
        reasoning: 'In 48 hours, too many people know. Leaks are inevitable. Control is illusion.'
      },
      {
        id: 'partial',
        label: 'Limited Disclosure',
        description: 'Acknowledge inquiry without details, promise update when appropriate',
        isOptimal: false,
        consequence: 'SEC views as inadequate disclosure. Shareholder lawsuits multiply. Credibility damaged for years.',
        reasoning: 'Half-truths are worse than silence. Regulators and investors see through them.'
      }
    ],
    mRecommendation: 'Disclose Immediately',
    mReasoning: 'M\'s Regulatory Response Playbook includes pre-drafted 8-K templates and investor talking points. Your IR team can execute the "Proactive Disclosure" protocol within 4 hourswell within market close.'
  },
  supply_chain_action: {
    title: 'Supply Chain Continuity',
    context: 'Primary supplier filed bankruptcy. You have 3 weeks of inventory. Alternative suppliers quote 8-12 week lead times. Production halt costs $2M per day.',
    timeLimit: 60,
    options: [
      {
        id: 'premium',
        label: 'Pay Premium for Rush',
        description: 'Offer 3x premium to alternative suppliers for emergency 2-week delivery',
        isOptimal: true,
        consequence: 'Higher costs but production continues. Premium price is $8M vs $56M in halt costs. Customer commitments met.',
        reasoning: 'Premium supply costs < production halt costs. Math is clear.'
      },
      {
        id: 'negotiate',
        label: 'Negotiate Bankruptcy Claims',
        description: 'Work with bankrupt supplier to maintain shipments during restructuring',
        isOptimal: false,
        consequence: 'Legal process takes 6 weeks. Shipments stop anyway. Lost 6 critical weeks.',
        reasoning: 'Bankruptcy processes are slow and unpredictable. Not a viable contingency.'
      },
      {
        id: 'redesign',
        label: 'Emergency Redesign',
        description: 'Have engineering modify products to use available alternative components',
        isOptimal: false,
        consequence: 'Redesign takes 4 weeks minimum. Quality issues emerge. Recalls follow.',
        reasoning: 'Rushed engineering creates quality debt. "Move fast and break things" doesn\'t apply to manufacturing.'
      }
    ],
    mRecommendation: 'Pay Premium for Rush',
    mReasoning: 'M\'s Supply Chain Disruption Playbook includes pre-qualified alternative suppliers with emergency pricing agreements already negotiated. Your procurement team can activate these relationships immediatelyno negotiation needed.'
  },
  crisis_communication: {
    title: 'Public Statement Strategy',
    context: 'Viral video of executive misconduct. #BoycottBrand trending. Major media requesting comment in 2 hours. Employee morale collapsing. Partners reconsidering relationships.',
    timeLimit: 45,
    options: [
      {
        id: 'swift',
        label: 'Swift Accountability',
        description: 'Immediately announce investigation and executive administrative leave',
        isOptimal: true,
        consequence: 'Narrative shifts to "company taking action." Employee morale stabilizes. Partners appreciate decisiveness.',
        reasoning: 'Action speaks louder than words. Visible accountability defuses boycott momentum.'
      },
      {
        id: 'investigate',
        label: 'Promise Investigation',
        description: 'Announce formal investigation before taking any personnel action',
        isOptimal: false,
        consequence: 'Seen as protecting the executive. Boycott intensifies. Top talent begins updating resumes.',
        reasoning: 'Public has already convicted. Due process argument falls flat in court of public opinion.'
      },
      {
        id: 'context',
        label: 'Provide Context',
        description: 'Explain circumstances, note video was edited, defend executive',
        isOptimal: false,
        consequence: 'Backfires spectacularly. "Company defends misconduct" becomes the story. Boycott goes nuclear.',
        reasoning: '"Context" sounds like excuses. Never defend the indefensible in public.'
      }
    ],
    mRecommendation: 'Swift Accountability',
    mReasoning: 'M\'s Crisis Communications Playbook #23 (Executive Misconduct) provides a decision tree and pre-approved statement templates. The "Swift Action Protocol" has an 89% success rate in containing reputational damage within 72 hours.'
  }
};

export function InteractiveDecisionPoint({ 
  scenario, 
  onComplete, 
  decisionNumber = 1, 
  totalDecisions = 3 
}: InteractiveDecisionPointProps) {
  const [timeRemaining, setTimeRemaining] = useState<number | null>(null);
  const [selectedOption, setSelectedOption] = useState<string | null>(null);
  const [showConsequence, setShowConsequence] = useState(false);
  const [showMRecommendation, setShowMRecommendation] = useState(false);
  const [hasStarted, setHasStarted] = useState(false);
  
  const config = DECISION_CONFIGS[scenario];
  
  useEffect(() => {
    if (!hasStarted || timeRemaining === null || timeRemaining <= 0 || selectedOption) return;
    
    const timer = setInterval(() => {
      setTimeRemaining(prev => {
        if (prev === null || prev <= 1) {
          clearInterval(timer);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
    
    return () => clearInterval(timer);
  }, [hasStarted, timeRemaining, selectedOption]);
  
  useEffect(() => {
    if (timeRemaining === 0 && !selectedOption) {
      const suboptimalOption = config.options.find(o => !o.isOptimal)?.id || config.options[0].id;
      handleSelect(suboptimalOption);
    }
  }, [timeRemaining, selectedOption]);
  
  const handleStart = () => {
    setHasStarted(true);
    setTimeRemaining(config.timeLimit);
  };
  
  const handleSelect = (optionId: string) => {
    setSelectedOption(optionId);
    setShowConsequence(true);
    
    setTimeout(() => {
      setShowMRecommendation(true);
    }, 2000);
  };
  
  const handleContinue = () => {
    const selected = config.options.find(o => o.id === selectedOption);
    onComplete(selectedOption || '', selected?.isOptimal || false);
  };
  
  const getTimeColor = () => {
    if (timeRemaining === null) return 'text-slate-400';
    if (timeRemaining > 30) return 'text-green-400';
    if (timeRemaining > 15) return 'text-yellow-400';
    return 'text-red-400 animate-pulse';
  };
  
  const selectedOptionData = config.options.find(o => o.id === selectedOption);

  if (!hasStarted) {
    return (
      <div className="min-h-[500px] flex items-center justify-center bg-gradient-to-br from-slate-900 to-blue-900/20 rounded-xl p-8" data-testid="decision-point-start">
        <div className="text-center max-w-2xl">
          <Badge className="bg-blue-600 text-white mb-6 px-4 py-1">
            Decision Point {decisionNumber} of {totalDecisions}
          </Badge>
          <h2 className="text-3xl font-bold text-white mb-4">{config.title}</h2>
          <p className="text-slate-300 text-lg mb-8">{config.context}</p>
          <div className="flex items-center justify-center gap-2 text-slate-400 mb-8">
            <Clock className="w-5 h-5" />
            <span>You have {config.timeLimit} seconds to decide</span>
          </div>
          <Button 
            onClick={handleStart}
            size="lg"
            className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-6 text-lg"
            data-testid="button-start-decision"
          >
            <Target className="w-5 h-5 mr-2" />
            Make Your Decision
          </Button>
        </div>
      </div>
    );
  }

  if (showMRecommendation) {
    return (
      <div className="min-h-[500px] bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-8" data-testid="decision-point-result">
        <div className="max-w-3xl mx-auto">
          <div className="text-center mb-8">
            <Badge className={`mb-4 px-4 py-1 ${selectedOptionData?.isOptimal ? 'bg-green-600' : 'bg-orange-600'} text-white`}>
              {selectedOptionData?.isOptimal ? 'Optimal Choice' : 'Learning Opportunity'}
            </Badge>
            <h2 className="text-2xl font-bold text-white mb-2">
              You chose: {selectedOptionData?.label}
            </h2>
          </div>
          
          <div className="grid gap-6 mb-8">
            <Card className={`border-2 ${selectedOptionData?.isOptimal ? 'border-green-500 bg-green-500/10' : 'border-orange-500 bg-orange-500/10'}`}>
              <CardHeader>
                <CardTitle className="flex items-center gap-2 text-white">
                  {selectedOptionData?.isOptimal ? (
                    <CheckCircle2 className="w-6 h-6 text-green-400" />
                  ) : (
                    <AlertTriangle className="w-6 h-6 text-orange-400" />
                  )}
                  Consequence
                </CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-slate-300">{selectedOptionData?.consequence}</p>
                <p className="text-slate-400 text-sm mt-4 italic">{selectedOptionData?.reasoning}</p>
              </CardContent>
            </Card>
            
            <Card className="border-2 border-blue-500 bg-blue-500/10">
              <CardHeader>
                <CardTitle className="flex items-center gap-2 text-white">
                  <Brain className="w-6 h-6 text-blue-400" />
                  M's Recommendation
                </CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-lg font-semibold text-blue-400 mb-2">{config.mRecommendation}</p>
                <p className="text-slate-300">{config.mReasoning}</p>
              </CardContent>
            </Card>
          </div>
          
          {!selectedOptionData?.isOptimal && (
            <div className="bg-slate-800/50 rounded-lg p-6 mb-8 border border-slate-700">
              <p className="text-slate-300 text-center">
                <span className="text-white font-semibold">94% of executives</span> make similar choices without M's guidance.
                <br />
                <span className="text-blue-400">The difference is preparation, not intelligence.</span>
              </p>
            </div>
          )}
          
          <div className="text-center">
            <Button 
              onClick={handleContinue}
              size="lg"
              className="bg-blue-600 hover:bg-blue-700 text-white px-8"
              data-testid="button-continue-decision"
            >
              Continue
              <ArrowRight className="w-5 h-5 ml-2" />
            </Button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-[500px] bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-8" data-testid="decision-point-active">
      <div className="max-w-3xl mx-auto">
        <div className="flex items-center justify-between mb-6">
          <Badge className="bg-blue-600 text-white px-4 py-1">
            Decision Point {decisionNumber} of {totalDecisions}
          </Badge>
          <div className={`flex items-center gap-2 font-mono text-2xl ${getTimeColor()}`}>
            <Clock className="w-6 h-6" />
            <span>{timeRemaining}s</span>
          </div>
        </div>
        
        <div className="mb-4">
          <Progress 
            value={timeRemaining ? (timeRemaining / config.timeLimit) * 100 : 0} 
            className="h-2"
          />
        </div>
        
        <h2 className="text-2xl font-bold text-white mb-4">{config.title}</h2>
        <p className="text-slate-300 mb-8">{config.context}</p>
        
        <div className="space-y-4">
          {config.options.map((option) => (
            <Card 
              key={option.id}
              className={`cursor-pointer transition-all duration-200 border-2 ${
                selectedOption === option.id 
                  ? 'border-blue-500 bg-blue-500/20' 
                  : 'border-slate-700 hover:border-slate-500 bg-slate-800/50'
              }`}
              onClick={() => !selectedOption && handleSelect(option.id)}
              data-testid={`decision-option-${option.id}`}
            >
              <CardContent className="p-6">
                <div className="flex items-start gap-4">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                    selectedOption === option.id ? 'bg-blue-500 text-white' : 'bg-slate-700 text-slate-300'
                  }`}>
                    {selectedOption === option.id ? (
                      <CheckCircle2 className="w-5 h-5" />
                    ) : (
                      <Target className="w-5 h-5" />
                    )}
                  </div>
                  <div>
                    <h3 className="text-lg font-semibold text-white mb-1">{option.label}</h3>
                    <p className="text-slate-400">{option.description}</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
        
        {showConsequence && selectedOptionData && (
          <div className="mt-8 animate-in fade-in slide-in-from-bottom duration-500">
            <Card className={`border-2 ${selectedOptionData.isOptimal ? 'border-green-500 bg-green-500/10' : 'border-orange-500 bg-orange-500/10'}`}>
              <CardContent className="p-6">
                <div className="flex items-start gap-3">
                  {selectedOptionData.isOptimal ? (
                    <CheckCircle2 className="w-6 h-6 text-green-400 flex-shrink-0" />
                  ) : (
                    <AlertTriangle className="w-6 h-6 text-orange-400 flex-shrink-0" />
                  )}
                  <div>
                    <h4 className="font-semibold text-white mb-2">
                      {selectedOptionData.isOptimal ? 'Strong Choice' : 'Consider the Consequence'}
                    </h4>
                    <p className="text-slate-300">{selectedOptionData.consequence}</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        )}
      </div>
    </div>
  );
}

export default InteractiveDecisionPoint;


========================================
FILE: client/src/components/demo/InteractiveROICalculator.tsx
========================================
import { useState, useEffect } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Slider } from '@/components/ui/slider';
import { TrendingUp, DollarSign, Users, Clock, Target } from 'lucide-react';

interface ROICalculatorProps {
  persona?: 'ceo' | 'coo' | 'chro' | 'cto' | 'cio' | 'cdo' | 'ciso' | 'cfo' | 'general';
  industry?: 'healthcare' | 'finance' | 'manufacturing' | 'retail' | 'general';
}

export default function InteractiveROICalculator({ persona = 'general', industry = 'general' }: ROICalculatorProps) {
  const [companySize, setCompanySize] = useState(5000);
  const [currentCrisisResponse, setCurrentCrisisResponse] = useState(72);
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const timer = setTimeout(() => setIsVisible(true), 500);
    return () => clearTimeout(timer);
  }, []);

  // Industry-specific multipliers and metrics
  const industryMetrics = {
    healthcare: {
      name: 'Healthcare & Life Sciences',
      costPerHour: 12500,
      complianceRisk: 0.35,
      reputationImpact: 0.45
    },
    finance: {
      name: 'Financial Services',
      costPerHour: 25000,
      complianceRisk: 0.50,
      reputationImpact: 0.40
    },
    manufacturing: {
      name: 'Manufacturing',
      costPerHour: 8500,
      complianceRisk: 0.20,
      reputationImpact: 0.30
    },
    retail: {
      name: 'Retail & E-Commerce',
      costPerHour: 6000,
      complianceRisk: 0.15,
      reputationImpact: 0.35
    },
    general: {
      name: 'Enterprise',
      costPerHour: 10000,
      complianceRisk: 0.25,
      reputationImpact: 0.35
    }
  };

  const metrics = industryMetrics[industry];

  // Calculate improvements with M - 12 MINUTE average execution
  const mResponseMinutes = 12; // Our core value proposition: 12 minutes
  const mResponseHours = mResponseMinutes / 60; // Convert to hours for calculations
  const timeSaved = currentCrisisResponse - mResponseHours;
  const improvementPercentage = ((timeSaved / currentCrisisResponse) * 100);
  
  // Financial calculations
  const hoursSavedPerCrisis = timeSaved;
  const costSavingsPerCrisis = hoursSavedPerCrisis * metrics.costPerHour;
  const averageCrisesPerYear = Math.floor(companySize / 1000) + 2; // More crises for larger companies
  const annualTimeSavings = hoursSavedPerCrisis * averageCrisesPerYear;
  const annualCostSavings = costSavingsPerCrisis * averageCrisesPerYear;
  
  // Risk reduction
  const complianceRiskReduction = metrics.complianceRisk * 0.75; // 75% reduction
  const reputationProtection = metrics.reputationImpact * 0.80; // 80% improvement
  
  // Total ROI calculation
  const platformCost = 120000; // Annual platform cost
  const roi = ((annualCostSavings - platformCost) / platformCost) * 100;
  const paybackMonths = (platformCost / (annualCostSavings / 12));

  // Persona-specific messaging
  const personaMessages: Record<NonNullable<typeof persona>, {primary: string; secondary: string; focus: string}> = {
    ceo: {
      primary: 'Shareholder Value Impact',
      secondary: 'Strategic advantage through faster crisis response',
      focus: 'ROI & Competitive Position'
    },
    coo: {
      primary: 'Operational Efficiency Gains',
      secondary: 'Reduced downtime and improved process execution',
      focus: 'Cost Savings & Productivity'
    },
    chro: {
      primary: 'Workforce Stability',
      secondary: 'Protected jobs and improved employee confidence',
      focus: 'People Impact & Retention'
    },
    cto: {
      primary: 'Technical Resilience',
      secondary: 'Architecture stability and innovation velocity',
      focus: 'System Reliability & Innovation'
    },
    cio: {
      primary: 'Digital Continuity',
      secondary: 'IT compliance and operational reliability',
      focus: 'Compliance & Uptime'
    },
    cdo: {
      primary: 'Data Governance Value',
      secondary: 'Data integrity and analytics acceleration',
      focus: 'Data Quality & Insights'
    },
    ciso: {
      primary: 'Security Posture',
      secondary: 'Threat mitigation and risk reduction',
      focus: 'Cybersecurity & Risk'
    },
    cfo: {
      primary: 'Financial Stability',
      secondary: 'Liquidity protection and cost optimization',
      focus: 'Financial Risk & ROI'
    },
    general: {
      primary: 'Enterprise Value Creation',
      secondary: 'Comprehensive risk mitigation and performance improvement',
      focus: 'Total Business Impact'
    }
  };

  const message = personaMessages[persona];

  return (
    <div 
      className={`transition-all duration-1000 ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'}`}
      data-testid="roi-calculator"
    >
      <Card className="bg-gradient-to-br from-gray-900 to-blue-900/30 border-blue-500/50 shadow-2xl">
        <CardContent className="p-6 space-y-6">
          {/* Header */}
          <div className="text-center space-y-2">
            <div className="flex items-center justify-center gap-2 mb-2">
              <TrendingUp className="h-6 w-6 text-blue-400" />
              <h3 className="text-xl font-bold text-white">{message.primary}</h3>
            </div>
            <p className="text-blue-200 text-sm">{message.secondary}</p>
            <Badge variant="outline" className="bg-blue-600/20 text-blue-300 border-blue-500/50">
              {metrics.name} | {message.focus}
            </Badge>
          </div>

          {/* Interactive Controls */}
          <div className="space-y-4">
            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span className="text-gray-300">Company Size (Employees)</span>
                <span className="text-white font-semibold">{companySize.toLocaleString()}</span>
              </div>
              <Slider
                value={[companySize]}
                onValueChange={(value) => setCompanySize(value[0])}
                min={1000}
                max={50000}
                step={1000}
                className="cursor-pointer"
                data-testid="slider-company-size"
              />
            </div>

            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span className="text-gray-300">Current Crisis Response Time (Hours)</span>
                <span className="text-white font-semibold">{currentCrisisResponse}h</span>
              </div>
              <Slider
                value={[currentCrisisResponse]}
                onValueChange={(value) => setCurrentCrisisResponse(value[0])}
                min={12}
                max={168}
                step={6}
                className="cursor-pointer"
                data-testid="slider-response-time"
              />
            </div>
          </div>

          {/* Coordination Time Savings Highlight */}
          <div className="bg-gradient-to-r from-green-950/70 to-emerald-950/70 rounded-lg p-4 border-2 border-green-500/50">
            <div className="text-center space-y-2">
              <div className="text-sm text-gray-300 font-medium">Coordination Time Savings</div>
              <div className="flex items-center justify-center gap-4">
                <div>
                  <div className="text-sm text-gray-400">Industry Standard</div>
                  <div className="text-3xl font-bold text-red-400">72 hours</div>
                </div>
                <div className="text-2xl text-gray-500"></div>
                <div>
                  <div className="text-sm text-gray-400">M Execution</div>
                  <div className="text-3xl font-bold text-green-400">12 minutes</div>
                </div>
              </div>
              <div className="pt-2 border-t border-green-500/30">
                <div className="text-2xl font-bold text-white">360x Faster</div>
                <div className="text-xs text-green-300">99.7% time reduction</div>
              </div>
            </div>
          </div>

          {/* Results Grid */}
          <div className="grid grid-cols-2 gap-4">
            <div className="bg-blue-950/50 rounded-lg p-4 border border-blue-500/30">
              <div className="flex items-center gap-2 mb-1">
                <Clock className="h-4 w-4 text-blue-400" />
                <span className="text-xs text-gray-400">Decision Velocity</span>
              </div>
              <div className="text-2xl font-bold text-green-400">{mResponseMinutes} min</div>
              <div className="text-xs text-blue-300 mt-1">
                vs {currentCrisisResponse}h industry avg ({improvementPercentage.toFixed(0)}% faster)
              </div>
            </div>

            <div className="bg-green-950/50 rounded-lg p-4 border border-green-500/30">
              <div className="flex items-center gap-2 mb-1">
                <DollarSign className="h-4 w-4 text-green-400" />
                <span className="text-xs text-gray-400">Annual Savings</span>
              </div>
              <div className="text-2xl font-bold text-white">
                ${(annualCostSavings / 1000000).toFixed(2)}M
              </div>
              <div className="text-xs text-green-300 mt-1">
                ${(costSavingsPerCrisis / 1000).toFixed(0)}K per crisis
              </div>
            </div>

            <div className="bg-purple-950/50 rounded-lg p-4 border border-purple-500/30">
              <div className="flex items-center gap-2 mb-1">
                <Target className="h-4 w-4 text-purple-400" />
                <span className="text-xs text-gray-400">ROI</span>
              </div>
              <div className="text-2xl font-bold text-white">{roi.toFixed(0)}%</div>
              <div className="text-xs text-purple-300 mt-1">
                {paybackMonths.toFixed(1)} month payback
              </div>
            </div>

            <div className="bg-orange-950/50 rounded-lg p-4 border border-orange-500/30">
              <div className="flex items-center gap-2 mb-1">
                <Users className="h-4 w-4 text-orange-400" />
                <span className="text-xs text-gray-400">Risk Reduction</span>
              </div>
              <div className="text-2xl font-bold text-white">
                {(complianceRiskReduction * 100).toFixed(0)}%
              </div>
              <div className="text-xs text-orange-300 mt-1">
                Compliance & reputation
              </div>
            </div>
          </div>

          {/* Summary */}
          <div className="bg-gradient-to-r from-blue-600/20 to-teal-600/20 rounded-lg p-4 border border-blue-500/30">
            <h4 className="text-white font-semibold mb-2 text-sm"> Championship Execution Through Preparation</h4>
            <ul className="text-xs text-gray-300 space-y-1">
              <li> <strong className="text-green-400">{mResponseMinutes}-minute playbook execution</strong> vs {currentCrisisResponse}-hour industry standard</li>
              <li> {annualTimeSavings.toFixed(0)} hours saved annually across {averageCrisesPerYear} scenarios</li>
              <li> ${(annualCostSavings / 1000000).toFixed(2)}M cost avoidance from rapid decision velocity</li>
              <li> {(reputationProtection * 100).toFixed(0)}% improvement in brand protection with pre-configured playbooks</li>
              <li> <strong className="text-purple-400">{paybackMonths.toFixed(1)}-month payback</strong> with {roi.toFixed(0)}% annual ROI</li>
            </ul>
          </div>

          {/* CTA */}
          <Button 
            className="w-full bg-gradient-to-r from-blue-600 to-teal-600 hover:from-blue-700 hover:to-teal-700 text-white font-semibold"
            data-testid="roi-schedule-demo-btn"
          >
            Schedule Custom ROI Analysis
          </Button>
        </CardContent>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/LiveROICounter.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { useTimelineState } from '@/contexts/DemoTimelineContext';
import { DollarSign, TrendingUp } from 'lucide-react';
import { Card } from '@/components/ui/card';
import { useEffect, useState, useMemo } from 'react';
import { demoData } from '@/lib/demoData';

export function LiveROICounter() {
  const demoController = useDemoController();
  const timelineState = useTimelineState();
  
  const [show, setShow] = useState(false);

  const targetAmount = demoData.roi.totalCostSavings;
  const targetHours = demoData.roi.hoursRecovered;

  const isActive = demoController.state.isActive;
  const currentStep = demoController.state.currentExecutiveStep;
  
  const elapsedSeconds = timelineState.elapsedSeconds;
  const isSharedTimelineRunning = timelineState.isRunning;

  useEffect(() => {
    if (!isActive) {
      setShow(false);
      return;
    }

    if (currentStep === 4 || (isSharedTimelineRunning && elapsedSeconds >= 300)) {
      setShow(true);
      const hideTimer = setTimeout(() => setShow(false), 6000);
      return () => clearTimeout(hideTimer);
    } else {
      setShow(false);
    }
  }, [isActive, currentStep, isSharedTimelineRunning, elapsedSeconds]);

  const { savedAmount, timeSavedHours } = useMemo(() => {
    if (!show) {
      return { savedAmount: 0, timeSavedHours: 0 };
    }

    if (timelineState.isRunning || timelineState.isComplete) {
      const progress = Math.min(timelineState.progress / 100, 1);
      return {
        savedAmount: targetAmount * progress,
        timeSavedHours: targetHours * progress
      };
    }

    const progress = Math.min(elapsedSeconds / 720, 1);
    return {
      savedAmount: targetAmount * progress,
      timeSavedHours: targetHours * progress
    };
  }, [show, timelineState, elapsedSeconds, targetAmount, targetHours]);

  if (!show) return null;

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(amount);
  };

  const isComplete = savedAmount >= targetAmount;

  return (
    <div className="fixed top-20 left-6 z-40" data-testid="live-roi-counter">
      <Card className="bg-gradient-to-br from-emerald-950/90 to-green-950/90 border-emerald-500/30 backdrop-blur-sm shadow-2xl">
        <div className="p-4 space-y-3 min-w-[280px]">
          <div className="flex items-center justify-between gap-3">
            <div className="text-xs font-semibold text-emerald-300 uppercase tracking-wider">
              Live ROI Calculation
            </div>
            <DollarSign className="h-4 w-4 text-emerald-400 animate-pulse" />
          </div>

          <div className="space-y-2">
            <div className="text-center">
              <div className="text-xs text-emerald-400/70 font-medium mb-1">
                Revenue Protected
              </div>
              <div className="text-4xl font-bold text-emerald-400 tabular-nums tracking-tight" data-testid="text-roi-amount">
                {formatCurrency(savedAmount)}
              </div>
            </div>

            <div className="grid grid-cols-2 gap-3 pt-3 border-t border-emerald-500/20">
              <div className="text-center">
                <div className="text-xs text-emerald-300/70 mb-1">
                  Time Saved
                </div>
                <div className="text-xl font-bold text-emerald-300 tabular-nums" data-testid="text-time-saved">
                  {Math.floor(timeSavedHours)}h {Math.floor((timeSavedHours % 1) * 60)}m
                </div>
              </div>
              
              <div className="text-center border-l border-emerald-500/20">
                <div className="text-xs text-emerald-300/70 mb-1">
                  Cost/Hour
                </div>
                <div className="text-xl font-bold text-emerald-300 tabular-nums">
                  {formatCurrency(targetAmount / targetHours)}
                </div>
              </div>
            </div>
          </div>

          {isComplete && (
            <div className="pt-3 border-t border-emerald-500/30">
              <div className="flex items-center justify-center gap-2 text-emerald-400 animate-pulse">
                <TrendingUp className="h-4 w-4" />
                <span className="text-sm font-bold">
                   Full Crisis Value Protected!
                </span>
              </div>
            </div>
          )}
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/OrganizationReadinessScore.tsx
========================================
import { useState, useEffect, useMemo } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { Separator } from '@/components/ui/separator';
import { 
  Shield, 
  TrendingUp, 
  Clock, 
  DollarSign,
  Users,
  Target,
  AlertTriangle,
  CheckCircle2,
  ArrowRight,
  Zap,
  BookOpen,
  Radio,
  Calendar,
  Building2,
  ChevronRight
} from 'lucide-react';

type Industry = 
  | 'technology' 
  | 'financial_services' 
  | 'healthcare' 
  | 'manufacturing' 
  | 'retail' 
  | 'energy'
  | 'pharmaceuticals'
  | 'telecommunications';

interface OrganizationReadinessScoreProps {
  companyName: string;
  industry: Industry;
  employeeCount?: number;
  annualRevenue?: number;
  onScheduleCall: () => void;
  onStartTrial?: () => void;
}

interface ReadinessMetric {
  name: string;
  currentScore: number;
  industryAverage: number;
  topPerformers: number;
  icon: typeof Shield;
  description: string;
}

interface TransformationMilestone {
  day: number;
  title: string;
  description: string;
  impact: string;
}

const INDUSTRY_BENCHMARKS: Record<Industry, {
  avgReadinessScore: number;
  topQuartileScore: number;
  avgResponseTime: number; // hours
  riskMultiplier: number;
  typicalEvents: number; // per year
}> = {
  technology: { avgReadinessScore: 34, topQuartileScore: 82, avgResponseTime: 3.2, riskMultiplier: 1.4, typicalEvents: 14 },
  financial_services: { avgReadinessScore: 41, topQuartileScore: 88, avgResponseTime: 2.8, riskMultiplier: 1.8, typicalEvents: 18 },
  healthcare: { avgReadinessScore: 29, topQuartileScore: 76, avgResponseTime: 4.5, riskMultiplier: 1.6, typicalEvents: 12 },
  manufacturing: { avgReadinessScore: 26, topQuartileScore: 72, avgResponseTime: 5.1, riskMultiplier: 1.3, typicalEvents: 10 },
  retail: { avgReadinessScore: 31, topQuartileScore: 74, avgResponseTime: 3.8, riskMultiplier: 1.2, typicalEvents: 16 },
  energy: { avgReadinessScore: 38, topQuartileScore: 81, avgResponseTime: 3.5, riskMultiplier: 2.0, typicalEvents: 8 },
  pharmaceuticals: { avgReadinessScore: 35, topQuartileScore: 84, avgResponseTime: 3.0, riskMultiplier: 1.9, typicalEvents: 11 },
  telecommunications: { avgReadinessScore: 37, topQuartileScore: 79, avgResponseTime: 2.5, riskMultiplier: 1.5, typicalEvents: 15 },
};

const INDUSTRY_LABELS: Record<Industry, string> = {
  technology: 'Technology',
  financial_services: 'Financial Services',
  healthcare: 'Healthcare',
  manufacturing: 'Manufacturing',
  retail: 'Retail',
  energy: 'Energy',
  pharmaceuticals: 'Pharmaceuticals',
  telecommunications: 'Telecommunications',
};

export function OrganizationReadinessScore({
  companyName,
  industry,
  employeeCount = 5000,
  annualRevenue = 2000000000,
  onScheduleCall,
  onStartTrial
}: OrganizationReadinessScoreProps) {
  const [isAnimating, setIsAnimating] = useState(true);
  const [displayedScore, setDisplayedScore] = useState(0);
  const [showDetails, setShowDetails] = useState(false);
  
  const benchmarks = INDUSTRY_BENCHMARKS[industry];
  
  // Calculate score only once when component mounts or industry changes
  const currentScore = useMemo(() => {
    return Math.max(15, benchmarks.avgReadinessScore - 8 + Math.floor(Math.random() * 10));
  }, [benchmarks.avgReadinessScore]);
  
  const scoreGap = benchmarks.topQuartileScore - currentScore;
  
  const riskExposure = Math.round(
    (annualRevenue * 0.03) * 
    (scoreGap / 100) * 
    benchmarks.riskMultiplier
  );
  
  const executiveTimeWasted = Math.round(
    benchmarks.avgResponseTime * 
    benchmarks.typicalEvents * 
    (100 - currentScore) / 100 * 
    12
  );
  
  useEffect(() => {
    if (!isAnimating) return;
    
    const duration = 2000;
    const steps = 60;
    const increment = currentScore / steps;
    let current = 0;
    
    const timer = setInterval(() => {
      current += increment;
      if (current >= currentScore) {
        setDisplayedScore(currentScore);
        setIsAnimating(false);
        setTimeout(() => setShowDetails(true), 500);
        clearInterval(timer);
      } else {
        setDisplayedScore(Math.round(current));
      }
    }, duration / steps);
    
    return () => clearInterval(timer);
  }, [currentScore, isAnimating]);
  
  const getScoreColor = (score: number) => {
    if (score >= 70) return 'text-green-400';
    if (score >= 50) return 'text-yellow-400';
    if (score >= 30) return 'text-orange-400';
    return 'text-red-400';
  };
  
  const getProgressColor = (score: number) => {
    if (score >= 70) return 'bg-green-500';
    if (score >= 50) return 'bg-yellow-500';
    if (score >= 30) return 'bg-orange-500';
    return 'bg-red-500';
  };
  
  const formatCurrency = (amount: number) => {
    if (amount >= 1000000000) {
      return `$${(amount / 1000000000).toFixed(1)}B`;
    }
    if (amount >= 1000000) {
      return `$${(amount / 1000000).toFixed(0)}M`;
    }
    return `$${(amount / 1000).toFixed(0)}K`;
  };
  
  const readinessMetrics: ReadinessMetric[] = [
    {
      name: 'Playbook Coverage',
      currentScore: Math.round(currentScore * 0.7),
      industryAverage: benchmarks.avgReadinessScore,
      topPerformers: benchmarks.topQuartileScore,
      icon: BookOpen,
      description: 'Percentage of critical scenarios with prepared playbooks'
    },
    {
      name: 'Coordination Speed',
      currentScore: Math.round(currentScore * 0.6),
      industryAverage: benchmarks.avgReadinessScore - 5,
      topPerformers: benchmarks.topQuartileScore - 5,
      icon: Zap,
      description: 'Ability to align stakeholders in minutes vs hours'
    },
    {
      name: 'Signal Detection',
      currentScore: Math.round(currentScore * 0.5),
      industryAverage: benchmarks.avgReadinessScore - 10,
      topPerformers: benchmarks.topQuartileScore - 8,
      icon: Radio,
      description: 'Early warning detection before events become crises'
    },
    {
      name: 'Resource Staging',
      currentScore: Math.round(currentScore * 0.65),
      industryAverage: benchmarks.avgReadinessScore - 8,
      topPerformers: benchmarks.topQuartileScore - 6,
      icon: Users,
      description: 'Pre-approved budgets and pre-assigned stakeholders'
    },
  ];
  
  const transformationTimeline: TransformationMilestone[] = [
    {
      day: 7,
      title: 'Core Playbooks Active',
      description: 'Top 10 critical scenarios customized and stakeholders assigned',
      impact: '40% risk reduction on priority scenarios'
    },
    {
      day: 30,
      title: 'Signal Network Live',
      description: 'AI monitoring active across 16 intelligence categories',
      impact: '47-minute early warning advantage'
    },
    {
      day: 60,
      title: 'Full Coordination',
      description: 'Enterprise integrations connected, drill system operational',
      impact: '12-minute response capability achieved'
    },
    {
      day: 90,
      title: 'Learning Loop Active',
      description: 'Institutional memory capturing, playbooks self-improving',
      impact: 'Continuous readiness optimization'
    },
  ];

  return (
    <div className="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-xl p-8" data-testid="readiness-score-container">
      <div className="max-w-4xl mx-auto">
        <div className="text-center mb-8">
          <Badge className="bg-blue-600 text-white mb-4 px-4 py-1">
            Organizational Readiness Assessment
          </Badge>
          <h2 className="text-3xl font-bold text-white mb-2">
            {companyName} Readiness Profile
          </h2>
          <p className="text-slate-400">
            Based on {INDUSTRY_LABELS[industry]} industry benchmarks
          </p>
        </div>
        
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <Card className="col-span-1 bg-slate-800/50 border-slate-700">
            <CardContent className="p-8 text-center">
              <div className="relative inline-block mb-4">
                <svg className="w-32 h-32 transform -rotate-90">
                  <circle
                    cx="64"
                    cy="64"
                    r="56"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="12"
                    className="text-slate-700"
                  />
                  <circle
                    cx="64"
                    cy="64"
                    r="56"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="12"
                    strokeDasharray={`${(displayedScore / 100) * 352} 352`}
                    strokeLinecap="round"
                    className={getScoreColor(displayedScore).replace('text-', 'stroke-').replace('-400', '-500')}
                  />
                </svg>
                <div className="absolute inset-0 flex items-center justify-center">
                  <span className={`text-4xl font-bold ${getScoreColor(displayedScore)}`}>
                    {displayedScore}%
                  </span>
                </div>
              </div>
              <h3 className="text-xl font-semibold text-white mb-2">Current Readiness</h3>
              <p className="text-slate-400 text-sm">
                Industry average: {benchmarks.avgReadinessScore}%
              </p>
              <p className="text-slate-400 text-sm">
                Top performers: {benchmarks.topQuartileScore}%
              </p>
            </CardContent>
          </Card>
          
          <Card className="col-span-1 md:col-span-2 bg-slate-800/50 border-slate-700">
            <CardHeader>
              <CardTitle className="text-white flex items-center gap-2">
                <AlertTriangle className="w-5 h-5 text-orange-400" />
                Gap Analysis
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-6">
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-red-500/10 rounded-lg p-4 border border-red-500/30">
                  <div className="flex items-center gap-2 text-red-400 mb-1">
                    <DollarSign className="w-5 h-5" />
                    <span className="text-sm font-medium">Annual Risk Exposure</span>
                  </div>
                  <p className="text-2xl font-bold text-white">{formatCurrency(riskExposure)}</p>
                  <p className="text-xs text-slate-400 mt-1">
                    Based on {scoreGap}% readiness gap
                  </p>
                </div>
                
                <div className="bg-orange-500/10 rounded-lg p-4 border border-orange-500/30">
                  <div className="flex items-center gap-2 text-orange-400 mb-1">
                    <Clock className="w-5 h-5" />
                    <span className="text-sm font-medium">Executive Hours Wasted</span>
                  </div>
                  <p className="text-2xl font-bold text-white">{executiveTimeWasted} hrs/year</p>
                  <p className="text-xs text-slate-400 mt-1">
                    On uncoordinated responses
                  </p>
                </div>
              </div>
              
              <div className="bg-slate-900/50 rounded-lg p-4">
                <div className="flex items-center justify-between mb-3">
                  <span className="text-slate-300 font-medium">Your Position vs Industry</span>
                  <span className="text-slate-400 text-sm">
                    {currentScore < benchmarks.avgReadinessScore ? 'Below Average' : 'Above Average'}
                  </span>
                </div>
                <div className="relative h-8 bg-slate-700 rounded-full overflow-hidden">
                  <div 
                    className={`absolute left-0 top-0 h-full ${getProgressColor(currentScore)} transition-all duration-1000`}
                    style={{ width: `${currentScore}%` }}
                  />
                  <div 
                    className="absolute top-0 h-full w-0.5 bg-yellow-400"
                    style={{ left: `${benchmarks.avgReadinessScore}%` }}
                  />
                  <div 
                    className="absolute top-0 h-full w-0.5 bg-green-400"
                    style={{ left: `${benchmarks.topQuartileScore}%` }}
                  />
                </div>
                <div className="flex justify-between text-xs text-slate-400 mt-2">
                  <span>0%</span>
                  <span className="text-yellow-400">Industry Avg ({benchmarks.avgReadinessScore}%)</span>
                  <span className="text-green-400">Top Quartile ({benchmarks.topQuartileScore}%)</span>
                  <span>100%</span>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
        
        {showDetails && (
          <div className="animate-in fade-in slide-in-from-bottom duration-500">
            <Card className="bg-slate-800/50 border-slate-700 mb-8">
              <CardHeader>
                <CardTitle className="text-white flex items-center gap-2">
                  <Target className="w-5 h-5 text-blue-400" />
                  Capability Breakdown
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {readinessMetrics.map((metric, index) => {
                    const Icon = metric.icon;
                    return (
                      <div key={index} className="space-y-2">
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <Icon className="w-4 h-4 text-slate-400" />
                            <span className="text-white font-medium">{metric.name}</span>
                          </div>
                          <span className={getScoreColor(metric.currentScore)}>
                            {metric.currentScore}%
                          </span>
                        </div>
                        <Progress 
                          value={metric.currentScore} 
                          className="h-2 bg-slate-700"
                        />
                        <p className="text-xs text-slate-500">{metric.description}</p>
                      </div>
                    );
                  })}
                </div>
              </CardContent>
            </Card>
            
            <Card className="bg-slate-800/50 border-slate-700 mb-8">
              <CardHeader>
                <CardTitle className="text-white flex items-center gap-2">
                  <Calendar className="w-5 h-5 text-green-400" />
                  90-Day Transformation Roadmap
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="relative">
                  <div className="absolute left-4 top-0 bottom-0 w-0.5 bg-slate-700" />
                  
                  <div className="space-y-6">
                    {transformationTimeline.map((milestone, index) => (
                      <div key={index} className="relative flex gap-6 pl-12">
                        <div className="absolute left-0 w-8 h-8 rounded-full bg-blue-500/20 border-2 border-blue-500 flex items-center justify-center">
                          <CheckCircle2 className="w-4 h-4 text-blue-400" />
                        </div>
                        <div className="flex-1 bg-slate-900/50 rounded-lg p-4">
                          <div className="flex items-center justify-between mb-2">
                            <h4 className="font-semibold text-white">{milestone.title}</h4>
                            <Badge variant="outline" className="border-blue-500 text-blue-400">
                              Day {milestone.day}
                            </Badge>
                          </div>
                          <p className="text-slate-400 text-sm mb-2">{milestone.description}</p>
                          <p className="text-green-400 text-sm font-medium">{milestone.impact}</p>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="bg-gradient-to-r from-blue-900/50 to-blue-800/30 border-blue-500/30">
              <CardContent className="p-8">
                <div className="flex flex-col md:flex-row items-center justify-between gap-6">
                  <div>
                    <h3 className="text-2xl font-bold text-white mb-2">
                      Close the {scoreGap}% Gap
                    </h3>
                    <p className="text-slate-300">
                      Join {INDUSTRY_LABELS[industry]} leaders achieving {benchmarks.topQuartileScore}%+ readiness.
                      <br />
                      <span className="text-blue-400 font-medium">
                        First playbook live in under 3 weeks.
                      </span>
                    </p>
                  </div>
                  <div className="flex flex-col sm:flex-row gap-4">
                    {onStartTrial && (
                      <Button 
                        variant="outline"
                        size="lg"
                        onClick={onStartTrial}
                        className="border-blue-500 text-blue-400 hover:bg-blue-500/10"
                        data-testid="button-start-trial"
                      >
                        Start Free Trial
                      </Button>
                    )}
                    <Button 
                      size="lg"
                      onClick={onScheduleCall}
                      className="bg-blue-600 hover:bg-blue-700 text-white"
                      data-testid="button-schedule-call"
                    >
                      Schedule Strategy Call
                      <ChevronRight className="w-5 h-5 ml-2" />
                    </Button>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        )}
      </div>
    </div>
  );
}

export default OrganizationReadinessScore;


========================================
FILE: client/src/components/demo/PeerAdoptionOverlay.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { useEffect, useState } from 'react';
import { Building2, CheckCircle2, TrendingUp, Users } from 'lucide-react';
import { Card } from '@/components/ui/card';

export function PeerAdoptionOverlay() {
  const demoController = useDemoController();
  const [show, setShow] = useState(false);
  const [visibleCompanies, setVisibleCompanies] = useState(0);

  useEffect(() => {
    if (demoController.state.currentExecutiveStep === 3) {
      setShow(true);
      const hideTimer = setTimeout(() => setShow(false), 8000);
      return () => clearTimeout(hideTimer);
    } else {
      setShow(false);
      setVisibleCompanies(0);
    }
  }, [demoController.state.currentExecutiveStep]);

  useEffect(() => {
    if (!show) return;
    
    const interval = setInterval(() => {
      setVisibleCompanies(prev => {
        if (prev < 6) return prev + 1;
        return prev;
      });
    }, 400);
    
    return () => clearInterval(interval);
  }, [show]);

  if (!show) return null;

  const adoptingCompanies = [
    { name: 'Major Healthcare System', role: 'CEO', industry: 'Healthcare', employees: '147K' },
    { name: 'Global Financial Services', role: 'COO', industry: 'Finance', employees: '89K' },
    { name: 'Tech Manufacturing Giant', role: 'CTO', industry: 'Manufacturing', employees: '203K' },
    { name: 'Fortune 100 Retailer', role: 'CHRO', industry: 'Retail', employees: '312K' },
    { name: 'International Bank', role: 'CRO', industry: 'Finance', employees: '156K' },
    { name: 'Pharmaceutical Leader', role: 'CFO', industry: 'Healthcare', employees: '91K' }
  ];

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
      <div className="absolute inset-0 bg-black/70 backdrop-blur-sm animate-in fade-in duration-300" />
      
      <Card className="relative w-[950px] bg-gradient-to-br from-blue-950/95 via-indigo-950/95 to-purple-950/95 border-blue-500/50 p-8 shadow-2xl animate-in zoom-in-95 duration-500">
        <div className="space-y-6">
          {/* Header */}
          <div className="text-center space-y-3">
            <div className="flex items-center justify-center gap-3">
              <div className="p-3 bg-blue-600/30 rounded-lg">
                <Users className="h-8 w-8 text-blue-400" />
              </div>
              <h2 className="text-3xl font-bold text-blue-100">While You're Deciding...</h2>
            </div>
            <p className="text-xl text-blue-200/90">Your Fortune 1000 peers are already executing</p>
          </div>

          {/* Stats Bar */}
          <div className="grid grid-cols-3 gap-4">
            <div className="bg-blue-600/20 rounded-lg p-4 border border-blue-500/30">
              <div className="text-center">
                <p className="text-3xl font-bold text-blue-300">847</p>
                <p className="text-blue-400 text-sm mt-1">Fortune 1000 Executives</p>
              </div>
            </div>
            <div className="bg-blue-600/20 rounded-lg p-4 border border-blue-500/30">
              <div className="text-center">
                <p className="text-3xl font-bold text-blue-300">12 min</p>
                <p className="text-blue-400 text-sm mt-1">Average Response Time</p>
              </div>
            </div>
            <div className="bg-blue-600/20 rounded-lg p-4 border border-blue-500/30">
              <div className="text-center">
                <p className="text-3xl font-bold text-blue-300">94%</p>
                <p className="text-blue-400 text-sm mt-1">Crisis Success Rate</p>
              </div>
            </div>
          </div>

          {/* Recently Adopted */}
          <div>
            <div className="flex items-center gap-2 mb-4">
              <TrendingUp className="h-5 w-5 text-blue-400" />
              <p className="text-blue-200 font-semibold">Adopted in the Last 30 Days</p>
            </div>
            
            <div className="grid grid-cols-2 gap-3">
              {adoptingCompanies.map((company, idx) => (
                <div
                  key={idx}
                  className={`bg-black/40 rounded-lg p-4 border border-blue-500/30 transition-all duration-500 ${
                    idx < visibleCompanies ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'
                  }`}
                >
                  <div className="flex items-start gap-3">
                    <div className="p-2 bg-blue-600/30 rounded">
                      <Building2 className="h-4 w-4 text-blue-400" />
                    </div>
                    <div className="flex-1 min-w-0">
                      <div className="flex items-start justify-between gap-2">
                        <p className="text-blue-100 font-semibold text-sm truncate">{company.name}</p>
                        <CheckCircle2 className="h-4 w-4 text-green-400 flex-shrink-0" />
                      </div>
                      <div className="flex items-center gap-2 mt-1 text-xs text-blue-300">
                        <span>{company.role}</span>
                        <span></span>
                        <span>{company.industry}</span>
                        <span></span>
                        <span>{company.employees} employees</span>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* Bottom Message */}
          <div className="bg-gradient-to-r from-blue-600/30 to-purple-600/30 rounded-lg p-5 border border-blue-500/40">
            <div className="text-center space-y-2">
              <p className="text-blue-100 text-xl font-bold">
                They Had the Same Doubts You Do
              </p>
              <p className="text-blue-200/80 text-lg">
                Now they're responding to crises 6x faster than their competitors
              </p>
            </div>
          </div>
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/PersonalReputationRiskOverlay.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { useEffect, useState } from 'react';
import { UserX, TrendingDown, AlertCircle, MessageSquare } from 'lucide-react';
import { Card } from '@/components/ui/card';

export function PersonalReputationRiskOverlay() {
  const demoController = useDemoController();
  const [show, setShow] = useState(false);

  useEffect(() => {
    if (demoController.state.currentExecutiveStep === 2) {
      setShow(true);
      const hideTimer = setTimeout(() => setShow(false), 7000);
      return () => clearTimeout(hideTimer);
    } else {
      setShow(false);
    }
  }, [demoController.state.currentExecutiveStep]);

  if (!show) return null;

  const scenarios = [
    {
      icon: MessageSquare,
      stakeholder: 'Board Member',
      quote: '"Why did our competitors respond 3 days faster than us?"',
      impact: 'Credibility questioned',
      color: 'from-orange-600 to-red-600'
    },
    {
      icon: TrendingDown,
      stakeholder: 'Activist Investor',
      quote: '"$12M lost because leadership was unprepared?"',
      impact: 'Competence challenged',
      color: 'from-red-600 to-pink-600'
    },
    {
      icon: AlertCircle,
      stakeholder: 'Major Shareholder',
      quote: '"Other Fortune 1000s had playbooks ready. Why didn\'t we?"',
      impact: 'Leadership effectiveness disputed',
      color: 'from-pink-600 to-purple-600'
    }
  ];

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
      <div className="absolute inset-0 bg-black/70 backdrop-blur-sm animate-in fade-in duration-300" />
      
      <Card className="relative w-[950px] bg-gradient-to-br from-slate-950/95 via-red-950/95 to-slate-950/95 border-red-500/50 p-8 shadow-2xl animate-in zoom-in-95 duration-500">
        <div className="space-y-6">
          {/* Header */}
          <div className="text-center space-y-3">
            <div className="flex items-center justify-center gap-3">
              <div className="p-3 bg-red-600/30 rounded-lg">
                <UserX className="h-8 w-8 text-red-400" />
              </div>
              <h2 className="text-3xl font-bold text-red-100">What They'll Ask You</h2>
            </div>
            <p className="text-xl text-red-200/90">72 hours later, when the damage is done</p>
          </div>

          {/* Scenarios */}
          <div className="space-y-4">
            {scenarios.map((scenario, idx) => {
              const Icon = scenario.icon;
              return (
                <div 
                  key={idx}
                  className="bg-black/40 rounded-lg p-5 border border-red-500/30 hover:border-red-500/50 transition-all"
                  style={{
                    animation: `slideIn 0.5s ease-out ${idx * 0.2}s backwards`
                  }}
                >
                  <div className="flex items-start gap-4">
                    <div className={`p-3 bg-gradient-to-br ${scenario.color} rounded-lg`}>
                      <Icon className="h-6 w-6 text-white" />
                    </div>
                    <div className="flex-1 space-y-2">
                      <div className="flex items-center justify-between">
                        <p className="text-red-300 font-semibold">{scenario.stakeholder}</p>
                        <span className="text-xs text-red-400 bg-red-600/20 px-2 py-1 rounded">
                          {scenario.impact}
                        </span>
                      </div>
                      <blockquote className="text-lg text-red-100 italic border-l-2 border-red-500/50 pl-4">
                        {scenario.quote}
                      </blockquote>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>

          {/* Bottom Warning */}
          <div className="bg-gradient-to-r from-red-600/30 to-orange-600/30 rounded-lg p-5 border border-red-500/40">
            <div className="text-center space-y-2">
              <p className="text-red-100 text-xl font-bold">
                Your Reputation Takes Decades to Build
              </p>
              <p className="text-red-200/80 text-lg">
                One 72-hour delay can destroy it
              </p>
            </div>
          </div>

          {/* CTA Hint */}
          <div className="text-center">
            <p className="text-red-300/70 text-sm">
              M executives answer these questions with data, not excuses
            </p>
          </div>
        </div>
      </Card>

      <style>{`
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateX(-20px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
      `}</style>
    </div>
  );
}


========================================
FILE: client/src/components/demo/PlaybookLibraryDemo.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { 
  Target, 
  TrendingDown, 
  Flame, 
  Scale, 
  AlertTriangle,
  Users,
  Building2,
  Star,
  Shield,
  CheckCircle,
  Clock,
  Zap
} from 'lucide-react';
import { useState } from 'react';

const DEMO_DOMAINS = [
  {
    id: '1',
    name: 'Market Dynamics',
    icon: Target,
    color: 'bg-blue-100 dark:bg-blue-950 text-blue-700 dark:text-blue-300',
    playbookCount: 18,
    description: 'Competitive moves, market opportunities, and strategic positioning',
    samplePlaybooks: [
      'New Market Entrant (Funded Startup)',
      'Competitive Product Launch',
      'Pricing War Response'
    ]
  },
  {
    id: '2',
    name: 'Financial Strategy',
    icon: TrendingDown,
    color: 'bg-green-100 dark:bg-green-950 text-green-700 dark:text-green-300',
    playbookCount: 15,
    description: 'Capital allocation, financial performance, and investment decisions',
    samplePlaybooks: [
      'Strategic M&A Opportunity',
      'Cash Flow Optimization',
      'Investment Round Execution'
    ]
  },
  {
    id: '3',
    name: 'Operational Excellence',
    icon: Flame,
    color: 'bg-orange-100 dark:bg-orange-950 text-orange-700 dark:text-orange-300',
    playbookCount: 14,
    description: 'Process optimization, efficiency gains, and operational resilience',
    samplePlaybooks: [
      'Supply Chain Disruption Response',
      'Production Scale-Up',
      'Quality Initiative Launch'
    ]
  },
  {
    id: '4',
    name: 'Technology & Innovation',
    icon: AlertTriangle,
    color: 'bg-indigo-100 dark:bg-indigo-950 text-indigo-700 dark:text-indigo-300',
    playbookCount: 13,
    description: 'Digital transformation, technology adoption, and innovation initiatives',
    samplePlaybooks: [
      'Cloud Migration Strategy',
      'AI/ML Initiative Launch',
      'Security Incident Response'
    ]
  },
  {
    id: '5',
    name: 'Talent & Leadership',
    icon: Users,
    color: 'bg-pink-100 dark:bg-pink-950 text-pink-700 dark:text-pink-300',
    playbookCount: 12,
    description: 'Leadership development, talent acquisition, and organizational capability',
    samplePlaybooks: [
      'Executive Leadership Transition',
      'Top Talent Retention Program',
      'Culture Transformation Initiative'
    ]
  },
  {
    id: '6',
    name: 'Brand & Reputation',
    icon: Building2,
    color: 'bg-yellow-100 dark:bg-yellow-950 text-yellow-700 dark:text-yellow-300',
    playbookCount: 14,
    description: 'Brand strategy, stakeholder relations, and reputation management',
    samplePlaybooks: [
      'Brand Repositioning Campaign',
      'Stakeholder Communication Event',
      'Media Relations Strategy'
    ]
  },
  {
    id: '7',
    name: 'Regulatory & Compliance',
    icon: Scale,
    color: 'bg-purple-100 dark:bg-purple-950 text-purple-700 dark:text-purple-300',
    playbookCount: 10,
    description: 'Compliance initiatives, regulatory changes, and governance improvements',
    samplePlaybooks: [
      'New Regulation Compliance',
      'Audit Preparation Protocol',
      'Governance Framework Update'
    ]
  },
  {
    id: '8',
    name: 'Market Opportunities',
    icon: Star,
    color: 'bg-teal-100 dark:bg-teal-950 text-teal-700 dark:text-teal-300',
    playbookCount: 14,
    description: 'Market expansion, strategic partnerships, and growth initiatives',
    samplePlaybooks: [
      'Geographic Expansion Plan',
      'Strategic Partnership Formation',
      'New Product Market Entry'
    ]
  }
];

export default function PlaybookLibraryDemo() {
  const [selectedDomain, setSelectedDomain] = useState(DEMO_DOMAINS[0]);
  const [showDetails, setShowDetails] = useState(false);

  return (
    <Card className="bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950 border-2 border-blue-200 dark:border-blue-800" data-testid="playbook-library-demo">
      <CardHeader>
        <div className="flex items-center justify-between">
          <div>
            <CardTitle className="text-2xl flex items-center gap-2">
              <Shield className="h-6 w-6 text-blue-600" />
              Interactive Playbook Library
            </CardTitle>
            <p className="text-sm text-muted-foreground mt-1">
              Explore 166 strategic decision frameworks across 9 operational domains
            </p>
          </div>
          <Badge className="bg-blue-600 text-white px-4 py-2 text-lg">
            166 Playbooks
          </Badge>
        </div>
      </CardHeader>
      <CardContent className="space-y-6">
        {/* Domain Selection Grid */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
          {DEMO_DOMAINS.map((domain) => {
            const Icon = domain.icon;
            const isSelected = selectedDomain.id === domain.id;
            return (
              <button
                key={domain.id}
                onClick={() => {
                  setSelectedDomain(domain);
                  setShowDetails(true);
                }}
                className={`p-4 rounded-lg border-2 transition-all ${
                  isSelected 
                    ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/30 shadow-md' 
                    : 'border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700'
                }`}
                data-testid={`domain-card-${domain.id}`}
              >
                <div className={`w-12 h-12 rounded-lg ${domain.color} flex items-center justify-center mx-auto mb-2`}>
                  <Icon className="h-6 w-6" />
                </div>
                <div className="text-sm font-semibold text-center mb-1">{domain.name}</div>
                <div className="text-xs text-muted-foreground text-center">
                  {domain.playbookCount} playbooks
                </div>
              </button>
            );
          })}
        </div>

        {/* Selected Domain Details */}
        {showDetails && (
          <Card className="bg-white dark:bg-slate-800 border-blue-300 dark:border-blue-700">
            <CardContent className="p-6">
              <div className="flex items-start gap-4 mb-4">
                <div className={`w-16 h-16 rounded-lg ${selectedDomain.color} flex items-center justify-center flex-shrink-0`}>
                  <selectedDomain.icon className="h-8 w-8" />
                </div>
                <div className="flex-1">
                  <h3 className="text-xl font-bold mb-1">{selectedDomain.name}</h3>
                  <p className="text-sm text-muted-foreground">{selectedDomain.description}</p>
                </div>
                <Badge variant="outline" className="text-lg px-3 py-1">
                  {selectedDomain.playbookCount} Playbooks
                </Badge>
              </div>

              <div className="space-y-3">
                <div className="flex items-center gap-2 text-sm font-semibold text-blue-600 dark:text-blue-400">
                  <Zap className="h-4 w-4" />
                  Sample Strategic Playbooks
                </div>
                {selectedDomain.samplePlaybooks.map((playbook, index) => (
                  <div key={index} className="flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                    <CheckCircle className="h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0" />
                    <div className="flex-1">
                      <div className="font-medium">{playbook}</div>
                    </div>
                    <div className="flex items-center gap-4 text-xs text-muted-foreground">
                      <div className="flex items-center gap-1">
                        <Clock className="h-3 w-3" />
                        12 min
                      </div>
                      <Badge variant="outline" className="bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 border-green-300 dark:border-green-700">
                        80% Pre-filled
                      </Badge>
                    </div>
                  </div>
                ))}
              </div>

              <div className="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                <div className="flex items-start gap-3">
                  <Shield className="h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5" />
                  <div className="flex-1">
                    <div className="font-semibold text-sm text-blue-900 dark:text-blue-100 mb-1">
                      Enterprise-Ready Templates
                    </div>
                    <div className="text-xs text-blue-700 dark:text-blue-300">
                      Each playbook includes: Stakeholder matrix, Communication templates, Decision trees, Budget authorities, Success metrics, and Trigger definitions
                    </div>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        )}

        {/* Call to Action */}
        <div className="flex items-center justify-between p-4 bg-gradient-to-r from-blue-600 to-cyan-600 rounded-lg text-white">
          <div>
            <div className="font-semibold">Ready to explore the full library?</div>
            <div className="text-sm text-blue-100">Browse all 166 strategic playbook templates</div>
          </div>
          <Button 
            variant="secondary" 
            className="bg-white text-blue-600 hover:bg-blue-50"
            data-testid="explore-library-btn"
          >
            Explore Library
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/demo/PowerfulCTA.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { Calendar, ArrowRight, Shield, Zap, Users } from 'lucide-react';
import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { useEffect, useState } from 'react';

export function PowerfulCTA() {
  const demoController = useDemoController();
  const [show, setShow] = useState(false);

  useEffect(() => {
    if (!demoController.state.isActive) {
      setShow(false);
      return;
    }

    if (demoController.state.currentExecutiveStep === 5) {
      const showTimer = setTimeout(() => setShow(true), 5000);
      return () => clearTimeout(showTimer);
    } else {
      setShow(false);
    }
  }, [demoController.state.isActive, demoController.state.currentExecutiveStep]);

  if (!show) return null;

  const urgencyPoints = [
    { icon: Zap, text: 'Your competitors are seeing this demo too', color: 'text-amber-400' },
    { icon: Shield, text: 'Every day without M = increased crisis risk', color: 'text-red-400' },
    { icon: Users, text: '23 Fortune 1000 CEOs activated last month', color: 'text-emerald-400' },
  ];

  return (
    <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50" data-testid="powerful-cta">
      <Card className="bg-gradient-to-r from-blue-950 via-purple-950 to-indigo-950 border-blue-500 shadow-2xl backdrop-blur-sm">
        <div className="p-6 space-y-4 max-w-3xl">
          {/* Main CTA */}
          <div className="text-center space-y-3">
            <h3 className="text-2xl font-bold text-white">
              Ready to Transform Your Crisis Response?
            </h3>
            <p className="text-lg text-blue-200">
              Schedule your personalized war room workshop and activate your executive triggers within 48 hours
            </p>
          </div>

          {/* Urgency Points */}
          <div className="grid grid-cols-3 gap-4 py-4 border-y border-blue-500/30">
            {urgencyPoints.map((point, index) => {
              const Icon = point.icon;
              return (
                <div key={index} className="flex items-center gap-2">
                  <Icon className={`h-5 w-5 ${point.color}`} />
                  <span className="text-sm text-blue-100">{point.text}</span>
                </div>
              );
            })}
          </div>

          {/* CTA Buttons */}
          <div className="flex items-center gap-4 justify-center">
            <Button 
              size="lg"
              className="bg-emerald-600 hover:bg-emerald-700 text-white font-bold px-8 py-6 text-lg shadow-lg hover:shadow-emerald-500/50 transition-all duration-200"
              data-testid="cta-schedule-workshop"
            >
              <Calendar className="h-5 w-5 mr-2" />
              Schedule War Room Workshop
              <ArrowRight className="h-5 w-5 ml-2" />
            </Button>
            
            <Button 
              size="lg"
              variant="outline"
              className="border-blue-500 text-blue-200 hover:bg-blue-900/50 px-8 py-6 text-lg"
              data-testid="cta-contact-sales"
            >
              Contact Executive Sales
            </Button>
          </div>

          {/* Value Props */}
          <div className="flex items-center justify-center gap-8 pt-4 text-sm text-blue-300">
            <div className="flex items-center gap-2">
              <div className="w-2 h-2 bg-emerald-400 rounded-full"></div>
              <span>48-hour activation</span>
            </div>
            <div className="flex items-center gap-2">
              <div className="w-2 h-2 bg-emerald-400 rounded-full"></div>
              <span>White-glove onboarding</span>
            </div>
            <div className="flex items-center gap-2">
              <div className="w-2 h-2 bg-emerald-400 rounded-full"></div>
              <span>Board-ready ROI in 30 days</span>
            </div>
          </div>

          {/* Social Proof */}
          <div className="text-center pt-4 border-t border-blue-500/30">
            <p className="text-sm text-blue-300">
              Trusted by <span className="font-bold text-blue-200">127 Fortune 1000 companies</span> protecting 
              <span className="font-bold text-emerald-400"> $47B</span> in combined annual revenue
            </p>
          </div>
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/PracticeDrillsDemo.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { 
  Target, 
  Clock, 
  Play,
  CheckCircle,
  Users,
  TrendingUp,
  AlertTriangle,
  Trophy,
  Zap,
  BarChart3
} from 'lucide-react';
import { useState, useEffect } from 'react';

const DEMO_DRILL_SCENARIOS = [
  {
    id: '1',
    name: 'Competitive Response Simulation',
    domain: 'Market Dynamics',
    difficulty: 'Medium',
    duration: '15 min',
    participants: 8,
    description: 'Practice responding to a competitor product launch with coordinated pricing and marketing actions',
    objectives: [
      'Activate pricing playbook within 3 minutes',
      'Coordinate 8 stakeholders across 3 departments',
      'Execute communication plan in parallel'
    ],
    successRate: 87
  },
  {
    id: '2',
    name: 'Supply Chain Disruption Drill',
    domain: 'Operational Excellence',
    difficulty: 'High',
    duration: '20 min',
    participants: 12,
    description: 'War game a critical supplier failure scenario with alternative sourcing and production adjustments',
    objectives: [
      'Identify alternative suppliers within 5 minutes',
      'Adjust production schedules across 3 facilities',
      'Communicate with customers and stakeholders'
    ],
    successRate: 74
  },
  {
    id: '3',
    name: 'Talent Retention Strategy',
    domain: 'Talent & Leadership',
    difficulty: 'Low',
    duration: '12 min',
    participants: 5,
    description: 'Practice executive retention protocols when a key leader receives external offer',
    objectives: [
      'Activate retention playbook',
      'Coordinate compensation and career discussions',
      'Execute decision within 24 hours'
    ],
    successRate: 92
  }
];

export default function PracticeDrillsDemo() {
  const [selectedDrill, setSelectedDrill] = useState(DEMO_DRILL_SCENARIOS[0]);
  const [isRunning, setIsRunning] = useState(false);
  const [progress, setProgress] = useState(0);
  const [elapsedTime, setElapsedTime] = useState(0);
  const [completedObjectives, setCompletedObjectives] = useState<number[]>([]);

  useEffect(() => {
    let timer: NodeJS.Timeout;
    if (isRunning) {
      timer = setInterval(() => {
        setElapsedTime(prev => {
          const next = prev + 1;
          // Simulate progress
          setProgress(Math.min(95, (next / 720) * 100)); // 720 seconds = 12 min
          
          // Simulate objectives being completed
          if (next === 30 && !completedObjectives.includes(0)) {
            setCompletedObjectives(prev => [...prev, 0]);
          }
          if (next === 90 && !completedObjectives.includes(1)) {
            setCompletedObjectives(prev => [...prev, 1]);
          }
          if (next === 150 && !completedObjectives.includes(2)) {
            setCompletedObjectives(prev => [...prev, 2]);
          }
          
          return next;
        });
      }, 100); // Fast simulation
    }
    return () => clearInterval(timer);
  }, [isRunning, completedObjectives]);

  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const getDifficultyColor = (difficulty: string) => {
    switch (difficulty) {
      case 'Low': return 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400';
      case 'Medium': return 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400';
      case 'High': return 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400';
      default: return 'bg-gray-100 text-gray-700';
    }
  };

  const handleStart = () => {
    setIsRunning(true);
    setProgress(0);
    setElapsedTime(0);
    setCompletedObjectives([]);
  };

  const handleStop = () => {
    setIsRunning(false);
  };

  return (
    <Card className="bg-gradient-to-br from-slate-50 to-purple-50 dark:from-slate-900 dark:to-purple-950 border-2 border-purple-200 dark:border-purple-800" data-testid="practice-drills-demo">
      <CardHeader>
        <div className="flex items-center justify-between">
          <div>
            <CardTitle className="text-2xl flex items-center gap-2">
              <Target className="h-6 w-6 text-purple-600" />
              Interactive Strategic Simulations
            </CardTitle>
            <p className="text-sm text-muted-foreground mt-1">
              Practice decision execution through realistic scenario testing
            </p>
          </div>
          <Badge className="bg-purple-600 text-white px-4 py-2 text-lg">
            <Trophy className="h-4 w-4 mr-1" />
            War Games
          </Badge>
        </div>
      </CardHeader>
      <CardContent className="space-y-6">
        {/* Drill Selection */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {DEMO_DRILL_SCENARIOS.map((drill) => {
            const isSelected = selectedDrill.id === drill.id;
            return (
              <button
                key={drill.id}
                onClick={() => {
                  setSelectedDrill(drill);
                  setIsRunning(false);
                  setProgress(0);
                  setElapsedTime(0);
                  setCompletedObjectives([]);
                }}
                className={`p-4 rounded-lg border-2 text-left transition-all ${
                  isSelected 
                    ? 'border-purple-500 bg-purple-50 dark:bg-purple-900/30 shadow-md' 
                    : 'border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700'
                }`}
                data-testid={`drill-card-${drill.id}`}
              >
                <div className="font-semibold mb-2">{drill.name}</div>
                <div className="space-y-2 text-xs">
                  <div className="flex items-center justify-between">
                    <Badge variant="outline" className={getDifficultyColor(drill.difficulty)}>
                      {drill.difficulty}
                    </Badge>
                    <span className="text-muted-foreground">{drill.duration}</span>
                  </div>
                  <div className="flex items-center gap-2 text-muted-foreground">
                    <Users className="h-3 w-3" />
                    {drill.participants} participants
                  </div>
                  <div className="flex items-center gap-2">
                    <TrendingUp className="h-3 w-3 text-green-600" />
                    <span className="text-green-600 dark:text-green-400 font-medium">{drill.successRate}% success rate</span>
                  </div>
                </div>
              </button>
            );
          })}
        </div>

        {/* Drill Details and Execution */}
        <Card className="bg-white dark:bg-slate-800 border-purple-300 dark:border-purple-700">
          <CardContent className="p-6 space-y-6">
            {/* Header */}
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <h3 className="text-xl font-bold mb-2">{selectedDrill.name}</h3>
                <p className="text-sm text-muted-foreground mb-3">{selectedDrill.description}</p>
                <div className="flex items-center gap-4 text-sm">
                  <Badge variant="outline" className="bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400">
                    {selectedDrill.domain}
                  </Badge>
                  <div className="flex items-center gap-1 text-muted-foreground">
                    <Clock className="h-4 w-4" />
                    {selectedDrill.duration}
                  </div>
                  <div className="flex items-center gap-1 text-muted-foreground">
                    <Users className="h-4 w-4" />
                    {selectedDrill.participants} participants
                  </div>
                </div>
              </div>
              <div className="flex flex-col gap-2">
                {!isRunning ? (
                  <Button 
                    onClick={handleStart} 
                    className="bg-gradient-to-r from-purple-600 to-pink-600 text-white"
                    data-testid="start-drill-btn"
                  >
                    <Play className="h-4 w-4 mr-2" />
                    Start Simulation
                  </Button>
                ) : (
                  <Button 
                    onClick={handleStop} 
                    variant="outline"
                    className="border-red-500 text-red-600 hover:bg-red-50"
                    data-testid="stop-drill-btn"
                  >
                    Stop Drill
                  </Button>
                )}
              </div>
            </div>

            {/* Objectives */}
            <div className="space-y-2">
              <div className="font-semibold text-sm flex items-center gap-2 text-purple-600 dark:text-purple-400">
                <Zap className="h-4 w-4" />
                Practice Objectives
              </div>
              {selectedDrill.objectives.map((objective, index) => {
                const isCompleted = completedObjectives.includes(index);
                return (
                  <div 
                    key={index} 
                    className={`flex items-center gap-3 p-3 rounded-lg transition-all ${
                      isCompleted 
                        ? 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800' 
                        : 'bg-slate-50 dark:bg-slate-700/50'
                    }`}
                  >
                    {isCompleted ? (
                      <CheckCircle className="h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0" />
                    ) : (
                      <div className="w-5 h-5 rounded-full border-2 border-gray-300 dark:border-gray-600 flex-shrink-0" />
                    )}
                    <div className={`flex-1 ${isCompleted ? 'font-medium text-green-900 dark:text-green-100' : ''}`}>
                      {objective}
                    </div>
                  </div>
                );
              })}
            </div>

            {/* Progress (only shown when running) */}
            {isRunning && (
              <div className="space-y-3 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <Clock className="h-5 w-5 text-purple-600" />
                    <span className="font-semibold">Simulation Running</span>
                  </div>
                  <div className="text-2xl font-mono font-bold text-purple-600">
                    {formatTime(elapsedTime)}
                  </div>
                </div>
                <Progress value={progress} className="h-3" />
                <div className="text-xs text-purple-700 dark:text-purple-300">
                  {completedObjectives.length} of {selectedDrill.objectives.length} objectives completed
                </div>
              </div>
            )}

            {/* Stats */}
            <div className="grid grid-cols-2 gap-4 pt-4 border-t border-gray-200 dark:border-gray-700">
              <div className="text-center">
                <div className="text-2xl font-bold text-purple-600">{selectedDrill.successRate}%</div>
                <div className="text-xs text-muted-foreground">Average Success Rate</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-blue-600">{selectedDrill.participants}</div>
                <div className="text-xs text-muted-foreground">Stakeholders Coordinated</div>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Call to Action */}
        <div className="flex items-center justify-between p-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg text-white">
          <div>
            <div className="font-semibold">Build execution confidence through practice</div>
            <div className="text-sm text-purple-100">Schedule regular war games and strategic rehearsals</div>
          </div>
          <Button 
            variant="secondary" 
            className="bg-white text-purple-600 hover:bg-purple-50"
            data-testid="schedule-drill-btn"
          >
            <BarChart3 className="h-4 w-4 mr-2" />
            View All Drills
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/demo/ROIComparison.tsx
========================================
import { Card } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { TrendingDown, TrendingUp, Turtle, Zap } from 'lucide-react';

interface ROISideProps {
  label: string;
  duration: string;
  approach?: string;
  outcome: string;
  points: string[]; // Can be consequences or benefits
  details?: Record<string, any>;
}

interface ROIComparisonProps {
  traditional: ROISideProps;
  vexor: ROISideProps;
  bottomLine: {
    value: string;
    metric: string;
  };
}

export default function ROIComparison({ traditional, vexor, bottomLine }: ROIComparisonProps) {
  return (
    <div className="space-y-6">
      <div className="grid md:grid-cols-2 gap-6">
        {/* Traditional Approach */}
        <Card className="p-6 border-red-500 border-2 bg-red-950/30">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-2">
              <Turtle className="h-5 w-5 text-red-400" />
              <h3 className="font-bold text-lg text-white">{traditional.label}</h3>
            </div>
            <Badge variant="destructive">{traditional.duration}</Badge>
          </div>

          <div className="space-y-4">
            {traditional.approach && (
              <div className="border-b border-red-800/30 pb-3">
                <p className="text-xs text-red-300">
                  {traditional.approach}
                </p>
              </div>
            )}

            <div className="border-b border-red-800/30 pb-3">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-red-200 flex items-center gap-1">
                  <TrendingDown className="h-4 w-4" />
                  Outcome
                </span>
              </div>
              <span className="font-bold text-xl text-red-400" data-testid="text-traditional-lost">
                {traditional.outcome}
              </span>
            </div>

            <div className="bg-slate-900/50 p-3 rounded border border-red-800/30">
              <p className="text-xs font-semibold mb-2 text-red-200">The Impact:</p>
              <ul className="text-xs space-y-1 text-red-300">
                {traditional.points.map((point, idx) => (
                  <li key={idx}> {point}</li>
                ))}
              </ul>
            </div>
          </div>
        </Card>

        {/* M Approach */}
        <Card className="p-6 border-green-500 border-2 bg-green-950/30">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-2">
              <Zap className="h-5 w-5 text-green-400" />
              <h3 className="font-bold text-lg text-white">{vexor.label}</h3>
            </div>
            <Badge className="bg-green-600">{vexor.duration}</Badge>
          </div>

          <div className="space-y-4">
            {vexor.approach && (
              <div className="border-b border-green-800/30 pb-3">
                <p className="text-xs text-green-300">
                  {vexor.approach}
                </p>
              </div>
            )}

            <div className="border-b border-green-800/30 pb-3">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-green-200 flex items-center gap-1">
                  <TrendingUp className="h-4 w-4" />
                  Outcome
                </span>
              </div>
              <span className="font-bold text-xl text-green-400" data-testid="text-vexor-preserved">
                {vexor.outcome}
              </span>
            </div>

            <div className="bg-slate-900/50 p-3 rounded border border-green-800/30">
              <p className="text-xs font-semibold mb-2 text-green-200">The Benefits:</p>
              <ul className="text-xs space-y-1 text-green-300">
                {vexor.points.map((point, idx) => (
                  <li key={idx}> {point}</li>
                ))}
              </ul>
            </div>
          </div>
        </Card>
      </div>

      {/* Bottom Line */}
      <Card className="p-6 bg-gradient-to-r from-blue-950/50 to-purple-950/50 border-blue-500">
        <div className="text-center">
          <div className="text-sm text-blue-300 mb-2">Bottom Line</div>
          <div className="text-3xl font-bold text-white mb-2">{bottomLine.value}</div>
          <div className="text-sm text-blue-200">{bottomLine.metric}</div>
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/SplitScreenComparison.tsx
========================================
import { useDemoController } from '@/contexts/DemoController';
import { useEffect, useState } from 'react';
import { useLocation } from 'wouter';
import { 
  TrendingDown, 
  TrendingUp, 
  Clock, 
  DollarSign, 
  AlertTriangle,
  CheckCircle,
  Users,
  MessageSquare,
  Shield,
  Zap
} from 'lucide-react';
import { Card } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';

interface ComparisonMetric {
  traditional: {
    value: string;
    sublabel: string;
    trend: 'danger' | 'warning';
  };
  m: {
    value: string;
    sublabel: string;
    trend: 'success';
  };
}

interface StepData {
  title: string;
  traditionalState: string;
  mState: string;
  metrics: ComparisonMetric[];
  executivePressure: {
    traditional: string[];
    m: string[];
  };
}

const stepData: Record<number, StepData> = {
  0: {
    title: 'Signal Detection',
    traditionalState: 'Unaware - Crisis brewing',
    mState: 'Alert triggered - AI detected',
    metrics: [
      {
        traditional: { value: '0 hours', sublabel: 'No awareness yet', trend: 'danger' },
        m: { value: '2 min', sublabel: 'Threat identified', trend: 'success' }
      },
      {
        traditional: { value: '$0', sublabel: 'Unknown risk exposure', trend: 'danger' },
        m: { value: '$50M', sublabel: 'Risk quantified', trend: 'success' }
      }
    ],
    executivePressure: {
      traditional: [
        ' Leadership unaware of competitive threat',
        ' No crisis protocols activated',
        ' Competitors gaining advantage silently'
      ],
      m: [
        ' CEO notified instantly',
        ' War room protocol ready',
        ' 72-hour head start vs competitors'
      ]
    }
  },
  1: {
    title: 'Trigger Activation',
    traditionalState: 'Day 1 - Teams scrambling',
    mState: '8 min - Response launched',
    metrics: [
      {
        traditional: { value: '24 hours', sublabel: 'To assemble team', trend: 'danger' },
        m: { value: '8 min', sublabel: 'Team assembled', trend: 'success' }
      },
      {
        traditional: { value: '$847K', sublabel: 'Revenue bleeding daily', trend: 'danger' },
        m: { value: '$0', sublabel: 'Losses prevented', trend: 'success' }
      },
      {
        traditional: { value: '0%', sublabel: 'Plan completion', trend: 'danger' },
        m: { value: '100%', sublabel: 'Playbook activated', trend: 'success' }
      }
    ],
    executivePressure: {
      traditional: [
        ' Board calling for emergency session',
        ' No clear response plan yet',
        ' Media starting to notice',
        ' Customer inquiries spiking'
      ],
      m: [
        ' Board briefed with action plan',
        ' 47 stakeholders coordinated',
        ' PR strategy deployed',
        ' Customer comms ready'
      ]
    }
  },
  2: {
    title: 'Scenario Planning',
    traditionalState: 'Day 2 - Still planning',
    mState: '10 min - Strategy set',
    metrics: [
      {
        traditional: { value: '48 hours', sublabel: 'To create plan', trend: 'danger' },
        m: { value: '10 min', sublabel: 'Strategy deployed', trend: 'success' }
      },
      {
        traditional: { value: '2.7%', sublabel: 'Market share lost', trend: 'danger' },
        m: { value: '0%', sublabel: 'Position protected', trend: 'success' }
      },
      {
        traditional: { value: '94 hrs', sublabel: 'Executive time wasted', trend: 'danger' },
        m: { value: '2 hrs', sublabel: 'Executive oversight', trend: 'success' }
      }
    ],
    executivePressure: {
      traditional: [
        ' Investors demanding answers',
        ' Strategy still being debated',
        ' Competitors announced response',
        ' Stock price dropping'
      ],
      m: [
        ' Investors briefed and confident',
        ' 3 strategic pathways mapped',
        ' Ahead of competitor response',
        ' Market confidence maintained'
      ]
    }
  },
  3: {
    title: 'Crisis Response',
    traditionalState: 'Day 3 - Executing slowly',
    mState: '11 min - Fully coordinated',
    metrics: [
      {
        traditional: { value: '72 hours', sublabel: 'Response time', trend: 'danger' },
        m: { value: '11 min', sublabel: 'Full deployment', trend: 'success' }
      },
      {
        traditional: { value: '$2.5M', sublabel: 'Lost revenue', trend: 'danger' },
        m: { value: '$2.5M', sublabel: 'Revenue protected', trend: 'success' }
      },
      {
        traditional: { value: '23%', sublabel: 'Employee confidence', trend: 'danger' },
        m: { value: '94%', sublabel: 'Team confidence', trend: 'success' }
      }
    ],
    executivePressure: {
      traditional: [
        ' Reputation damage accelerating',
        ' Key employees nervous',
        ' Analyst downgrades expected',
        ' Crisis fatigue setting in'
      ],
      m: [
        ' Reputation intact',
        ' Team morale high',
        ' Analyst confidence strong',
        ' Leadership viewed as decisive'
      ]
    }
  },
  4: {
    title: 'Intelligence Coordination',
    traditionalState: 'Day 3 - Data gaps remain',
    mState: '11.5 min - Full visibility',
    metrics: [
      {
        traditional: { value: '37%', sublabel: 'Information complete', trend: 'danger' },
        m: { value: '100%', sublabel: 'AI-powered intel', trend: 'success' }
      },
      {
        traditional: { value: '8', sublabel: 'Departments siloed', trend: 'danger' },
        m: { value: '1', sublabel: 'Unified command center', trend: 'success' }
      }
    ],
    executivePressure: {
      traditional: [
        ' Still missing critical data',
        ' Teams working in silos',
        ' Duplicate effort waste',
        ' Decision delays continue'
      ],
      m: [
        ' Complete intelligence picture',
        ' Cross-functional coordination',
        ' AI insights delivered',
        ' Confident decision-making'
      ]
    }
  },
  5: {
    title: 'Resolution & Results',
    traditionalState: 'Day 3 - CRISIS UNRESOLVED',
    mState: '12 min - CRISIS RESOLVED ',
    metrics: [
      {
        traditional: { value: '72+ hrs', sublabel: 'Still responding', trend: 'danger' },
        m: { value: '12 min', sublabel: 'Crisis resolved', trend: 'success' }
      },
      {
        traditional: { value: '$2.5M', sublabel: 'Revenue lost', trend: 'danger' },
        m: { value: '$2.5M', sublabel: 'Revenue saved', trend: 'success' }
      },
      {
        traditional: { value: '141 hrs', sublabel: 'Executive time burned', trend: 'danger' },
        m: { value: '3 hrs', sublabel: 'Strategic oversight', trend: 'success' }
      }
    ],
    executivePressure: {
      traditional: [
        ' Crisis continues into next week',
        ' Permanent reputation damage',
        ' Board confidence shaken',
        ' "How did this happen?" questions'
      ],
      m: [
        ' Crisis contained and resolved',
        ' Reputation as decisive leader',
        ' Board impressed with response',
        ' "How did we do this so fast?" praise'
      ]
    }
  }
};

export function SplitScreenComparison() {
  const { state } = useDemoController();
  const [location] = useLocation();
  const [show, setShow] = useState(false);
  
  // Use currentExecutiveStep for Executive Demo, currentScene for Hybrid Demo
  const currentStep = location === '/executive-demo' 
    ? state.currentExecutiveStep 
    : Math.min(state.currentScene, 5); // Cap at 5 since we have 6 steps (0-5)
  
  const data = stepData[currentStep] || stepData[0];

  useEffect(() => {
    // Only show split screen on demo pages AND when demo is active
    const isDemoPage = location === '/executive-demo' || location === '/hybrid-demo';
    
    // Show if on Executive Demo page AND user has advanced past step 0
    // OR if on Hybrid Demo page AND demo is active
    const shouldShow = (location === '/executive-demo' && currentStep > 0) ||
                       (location === '/hybrid-demo' && state.isActive);
    
    if (isDemoPage && shouldShow) {
      setShow(true);
    } else {
      setShow(false);
    }
  }, [currentStep, location, state.isActive, state.currentScene]);

  if (!show) return null;

  return (
    <div className="fixed bottom-0 left-0 right-0 z-40 animate-in slide-in-from-bottom duration-700 h-[40vh]">
      <Card className="rounded-t-xl rounded-b-none border-t-2 border-x-0 border-b-0 border-blue-500/50 bg-gray-950/98 backdrop-blur-xl shadow-2xl h-full overflow-y-auto">
        <div className="grid grid-cols-2 divide-x divide-gray-700">
          {/* TRADITIONAL SIDE - PAIN */}
          <div className="p-6 bg-gradient-to-br from-red-950/40 to-orange-950/40">
            <div className="space-y-4">
              {/* Header */}
              <div className="flex items-center justify-between">
                <div>
                  <Badge variant="outline" className="bg-red-600/20 text-red-300 border-red-500/50">
                    Traditional Response
                  </Badge>
                  <h3 className="text-lg font-bold text-red-100 mt-2">{data.traditionalState}</h3>
                </div>
                <AlertTriangle className="h-8 w-8 text-red-400 animate-pulse" />
              </div>

              {/* Metrics */}
              <div className="space-y-2">
                {data.metrics.map((metric, idx) => (
                  <div key={idx} className="bg-black/30 rounded-lg p-3 border border-red-500/20">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-2xl font-bold text-red-100">{metric.traditional.value}</p>
                        <p className="text-xs text-red-300">{metric.traditional.sublabel}</p>
                      </div>
                      <TrendingDown className="h-5 w-5 text-red-400" />
                    </div>
                  </div>
                ))}
              </div>

              {/* Executive Pressure */}
              <div className="bg-red-950/30 rounded-lg p-3 border border-red-500/30">
                <p className="text-xs font-semibold text-red-300 mb-2">Executive Pressure</p>
                <div className="space-y-1">
                  {data.executivePressure.traditional.map((item, idx) => (
                    <p key={idx} className="text-xs text-red-200/90">{item}</p>
                  ))}
                </div>
              </div>
            </div>
          </div>

          {/* M SIDE - POWER */}
          <div className="p-6 bg-gradient-to-br from-blue-950/40 to-teal-950/40">
            <div className="space-y-4">
              {/* Header */}
              <div className="flex items-center justify-between">
                <div>
                  <Badge variant="outline" className="bg-blue-600/20 text-blue-300 border-blue-500/50">
                    M Response
                  </Badge>
                  <h3 className="text-lg font-bold text-blue-100 mt-2">{data.mState}</h3>
                </div>
                {currentStep === 5 ? (
                  <CheckCircle className="h-8 w-8 text-green-400 animate-pulse" />
                ) : (
                  <Zap className="h-8 w-8 text-blue-400 animate-pulse" />
                )}
              </div>

              {/* Metrics */}
              <div className="space-y-2">
                {data.metrics.map((metric, idx) => (
                  <div key={idx} className="bg-black/30 rounded-lg p-3 border border-blue-500/20">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-2xl font-bold text-blue-100">{metric.m.value}</p>
                        <p className="text-xs text-blue-300">{metric.m.sublabel}</p>
                      </div>
                      <TrendingUp className="h-5 w-5 text-green-400" />
                    </div>
                  </div>
                ))}
              </div>

              {/* Executive Confidence */}
              <div className="bg-blue-950/30 rounded-lg p-3 border border-blue-500/30">
                <p className="text-xs font-semibold text-blue-300 mb-2">Executive Confidence</p>
                <div className="space-y-1">
                  {data.executivePressure.m.map((item, idx) => (
                    <p key={idx} className="text-xs text-blue-200/90">{item}</p>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Progress indicator */}
        <div className="px-6 py-3 bg-gray-900/50 border-t border-gray-700">
          <div className="flex items-center justify-between mb-2">
            <p className="text-xs text-gray-400">Crisis Response Progress: {data.title}</p>
            <p className="text-xs font-mono text-gray-400">Step {currentStep + 1} / 6</p>
          </div>
          <Progress value={((currentStep + 1) / 6) * 100} className="h-1" />
        </div>
      </Card>
    </div>
  );
}


========================================
FILE: client/src/components/demo/TwelveMinuteTimer.tsx
========================================
import { useEffect, useCallback, useRef } from 'react';
import { Card } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { CheckCircle2, Clock, Send, Phone, DollarSign, AlertCircle, Users } from 'lucide-react';
import { twelveMinuteTimeline, DemoTimelineEvent } from '@shared/luxury-demo-data';
import { useTimelineState, useTimelineOrchestrator } from '@/contexts/DemoTimelineContext';

interface TwelveMinuteTimerProps {
  title?: string;
  subtitle?: string;
  timelineEvents?: any[];
  onComplete?: () => void;
  autoStart?: boolean;
  useSharedTimeline?: boolean;
}

export default function TwelveMinuteTimer({ 
  title = "Rapid Response Coordination",
  subtitle = "Initiating parallel execution across all stakeholders",
  timelineEvents,
  onComplete, 
  autoStart = false
}: TwelveMinuteTimerProps) {
  const timelineState = useTimelineState();
  const orchestrator = useTimelineOrchestrator();
  const completedCallbackRef = useRef(false);
  
  const currentSecond = timelineState.elapsedSeconds;
  const isRunning = timelineState.isRunning;
  const completed = timelineState.isComplete;
  
  const normalizeTimelineEvents = (events: any[]): DemoTimelineEvent[] => {
    return events.map(event => {
      let timeInSeconds = 0;
      if (typeof event.time === 'string') {
        const [mins, secs] = event.time.split(':').map(Number);
        timeInSeconds = mins * 60 + (secs || 0);
      } else {
        timeInSeconds = event.time;
      }
      
      return {
        time: timeInSeconds,
        label: event.label || event.title || `T+${event.time}`,
        description: event.description,
        icon: (event.icon || 'alert').toLowerCase() as any,
        stakeholderCount: event.stakeholderCount
      };
    });
  };
  
  const timeline = timelineEvents 
    ? normalizeTimelineEvents(timelineEvents)
    : twelveMinuteTimeline;

  const handleStart = useCallback(() => {
    orchestrator.startOnce({ duration: 720000, speedMultiplier: 20 });
  }, [orchestrator]);

  useEffect(() => {
    if (autoStart && !isRunning && !completed) {
      handleStart();
    }
  }, [autoStart, isRunning, completed, handleStart]);

  useEffect(() => {
    if (!completed && timelineState.elapsedMs === 0) {
      completedCallbackRef.current = false;
    }
  }, [completed, timelineState.elapsedMs]);

  useEffect(() => {
    if (completed && onComplete && !completedCallbackRef.current) {
      completedCallbackRef.current = true;
      onComplete();
    }
  }, [completed, onComplete]);

  const getIcon = (iconType: string) => {
    switch (iconType) {
      case 'alert': return <AlertCircle className="h-4 w-4" />;
      case 'user': return <Users className="h-4 w-4" />;
      case 'check': return <CheckCircle2 className="h-4 w-4" />;
      case 'dollar': return <DollarSign className="h-4 w-4" />;
      case 'send': return <Send className="h-4 w-4" />;
      case 'phone': return <Phone className="h-4 w-4" />;
      default: return <Clock className="h-4 w-4" />;
    }
  };

  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  return (
    <div className="space-y-6">
      <div className="text-center mb-4">
        <h2 className="text-3xl font-bold text-white mb-2">{title}</h2>
        <p className="text-xl text-blue-200">{subtitle}</p>
      </div>

      <Card className="p-4 bg-gradient-to-br from-blue-950 to-indigo-950 border-blue-800/30 max-w-md mx-auto">
        <div className="flex items-center justify-center gap-4">
          <Clock className={`h-5 w-5 text-blue-400 ${isRunning ? 'animate-pulse' : ''}`} />
          <div className="text-4xl font-bold text-white" data-testid="text-timer">
            {timelineState.formattedTime}
          </div>
          <span className="text-sm text-blue-200">
            {completed ? ' Complete' : 'Coordinating...'}
          </span>
        </div>
      </Card>

      <div className="relative">
        <div className="absolute left-6 top-0 bottom-0 w-0.5 bg-gradient-to-b from-blue-500 to-green-500" />

        <div className="space-y-4">
          {timeline.map((event, index) => {
            const isActive = currentSecond >= event.time;
            const isLast = index === timeline.length - 1;

            return (
              <div
                key={event.time}
                className={`relative pl-16 transition-all duration-500 ${
                  isActive ? 'opacity-100' : 'opacity-30'
                }`}
                data-testid={`timeline-event-${event.time}`}
              >
                <div className={`absolute left-4 w-5 h-5 rounded-full flex items-center justify-center transition-all duration-500 ${
                  isActive 
                    ? isLast 
                      ? 'bg-green-500 ring-4 ring-green-200 dark:ring-green-800' 
                      : 'bg-blue-500 ring-4 ring-blue-200 dark:ring-blue-800'
                    : 'bg-gray-300 dark:bg-gray-700'
                }`}>
                  {isActive && (
                    <div className="text-white">
                      {getIcon(event.icon)}
                    </div>
                  )}
                </div>

                <Card className={`p-4 ${isActive ? 'border-blue-500 border-2' : ''}`}>
                  <div className="flex items-start justify-between mb-2">
                    <div>
                      <Badge variant={isActive ? 'default' : 'outline'} className="mb-2">
                        {event.label}
                      </Badge>
                      <p className="font-semibold text-sm">{event.description}</p>
                    </div>
                    {event.stakeholderCount && isActive && (
                      <Badge variant="secondary" className="ml-2">
                        {event.stakeholderCount} people
                      </Badge>
                    )}
                  </div>
                </Card>
              </div>
            );
          })}
        </div>
      </div>

      {completed && (
        <Card className="p-6 bg-green-50 dark:bg-green-950 border-green-500 border-2" data-testid="card-completion">
          <div className="grid grid-cols-3 gap-4 text-center">
            <div>
              <div className="text-2xl font-bold text-green-700 dark:text-green-300">12:00</div>
              <div className="text-xs text-muted-foreground">Total Time</div>
            </div>
            <div>
              <div className="text-2xl font-bold text-green-700 dark:text-green-300">193</div>
              <div className="text-xs text-muted-foreground">Stakeholders</div>
            </div>
            <div>
              <div className="text-2xl font-bold text-green-700 dark:text-green-300">$50M</div>
              <div className="text-xs text-muted-foreground">Budget Activated</div>
            </div>
          </div>
        </Card>
      )}

      {!isRunning && !completed && (
        <button
          onClick={handleStart}
          className="w-full py-3 bg-primary text-primary-foreground rounded-lg font-semibold hover:bg-primary/90"
          data-testid="button-start-timer"
        >
          Start Response Coordination
        </button>
      )}
    </div>
  );
}


========================================
FILE: client/src/components/demo/WhatIfAnalyzer.tsx
========================================
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Slider } from '@/components/ui/slider';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { 
  Sparkles, 
  TrendingUp, 
  TrendingDown, 
  AlertTriangle,
  CheckCircle,
  Loader2
} from 'lucide-react';
import { apiRequest } from '@/lib/queryClient';

interface WhatIfAnalyzerProps {
  scenario: {
    name: string;
    department: string;
    stakeholders: string;
  };
}

export default function WhatIfAnalyzer({ scenario }: WhatIfAnalyzerProps) {
  const [variables, setVariables] = useState({
    resourceAllocation: [70],
    stakeholderAlignment: [75],
    marketVolatility: [50],
    timelineCompression: [30]
  });
  const [analysis, setAnalysis] = useState<any>(null);
  const [isLoading, setIsLoading] = useState(false);

  const runAnalysis = async () => {
    setIsLoading(true);
    try {
      const response = await apiRequest('POST', '/api/demo/what-if-analysis', {
        scenario,
        variables: {
          'Resource Allocation': `${variables.resourceAllocation[0]}%`,
          'Stakeholder Alignment': `${variables.stakeholderAlignment[0]}%`,
          'Market Volatility': `${variables.marketVolatility[0]}%`,
          'Timeline Compression': `${variables.timelineCompression[0]}%`
        }
      });
      
      const data = await response.json();
      setAnalysis(data.analysis);
    } catch (error) {
      console.error('Failed to run what-if analysis:', error);
      // Set fallback analysis
      setAnalysis({
        mostLikely: { 
          probability: 70, 
          description: "Strong execution with manageable challenges. Expected completion within timeline with minor adjustments." 
        },
        bestCase: { 
          probability: 20, 
          description: "Exceptional outcomes exceeding targets. All stakeholders aligned, resources optimized, market conditions favorable." 
        },
        worstCase: { 
          probability: 10, 
          description: "Significant obstacles requiring strategic pivot. Resource constraints or external factors create delays." 
        },
        successFactors: [
          "Executive sponsorship and clear authority",
          "Cross-functional stakeholder alignment",
          "Adequate resource allocation"
        ],
        risks: [
          "Timeline compression leading to quality concerns",
          "Stakeholder misalignment or competing priorities",
          "External market volatility"
        ],
        recommendations: [
          "Establish weekly executive steering committee",
          "Implement early warning system for risk triggers",
          "Build contingency plans for critical path items"
        ]
      });
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <Card className="border-cyan-500/30 bg-gradient-to-br from-slate-900 via-cyan-950/20 to-slate-900">
      <CardHeader>
        <CardTitle className="text-white flex items-center gap-2">
          <Sparkles className="h-5 w-5 text-cyan-400" />
          AI-Powered What-If Analyzer
        </CardTitle>
        <p className="text-gray-400 text-sm">
          Adjust variables to see AI-predicted outcomes for your scenario
        </p>
      </CardHeader>
      <CardContent className="space-y-6">
        {/* Variable Controls */}
        <div className="grid md:grid-cols-2 gap-6">
          <div className="space-y-2">
            <Label className="text-white">
              Resource Allocation: {variables.resourceAllocation[0]}%
            </Label>
            <Slider
              value={variables.resourceAllocation}
              onValueChange={(value) => setVariables({ ...variables, resourceAllocation: value })}
              min={0}
              max={100}
              step={5}
              data-testid="slider-resource-allocation"
            />
            <p className="text-xs text-gray-500">Budget and team capacity allocated</p>
          </div>

          <div className="space-y-2">
            <Label className="text-white">
              Stakeholder Alignment: {variables.stakeholderAlignment[0]}%
            </Label>
            <Slider
              value={variables.stakeholderAlignment}
              onValueChange={(value) => setVariables({ ...variables, stakeholderAlignment: value })}
              min={0}
              max={100}
              step={5}
              data-testid="slider-stakeholder-alignment"
            />
            <p className="text-xs text-gray-500">Executive and team consensus level</p>
          </div>

          <div className="space-y-2">
            <Label className="text-white">
              Market Volatility: {variables.marketVolatility[0]}%
            </Label>
            <Slider
              value={variables.marketVolatility}
              onValueChange={(value) => setVariables({ ...variables, marketVolatility: value })}
              min={0}
              max={100}
              step={5}
              data-testid="slider-market-volatility"
            />
            <p className="text-xs text-gray-500">External market uncertainty factor</p>
          </div>

          <div className="space-y-2">
            <Label className="text-white">
              Timeline Compression: {variables.timelineCompression[0]}%
            </Label>
            <Slider
              value={variables.timelineCompression}
              onValueChange={(value) => setVariables({ ...variables, timelineCompression: value })}
              min={0}
              max={100}
              step={5}
              data-testid="slider-timeline-compression"
            />
            <p className="text-xs text-gray-500">Schedule acceleration vs standard timeline</p>
          </div>
        </div>

        {/* Run Analysis Button */}
        <Button
          onClick={runAnalysis}
          disabled={isLoading}
          className="w-full bg-cyan-600 hover:bg-cyan-700 text-white"
          data-testid="button-run-analysis"
        >
          {isLoading ? (
            <>
              <Loader2 className="h-4 w-4 mr-2 animate-spin" />
              AI Analyzing Scenarios...
            </>
          ) : (
            <>
              <Sparkles className="h-4 w-4 mr-2" />
              Run AI What-If Analysis
            </>
          )}
        </Button>

        {/* Analysis Results */}
        {analysis && (
          <div className="space-y-4 animate-in fade-in duration-500">
            {/* Outcome Scenarios */}
            <div className="grid gap-4">
              {/* Most Likely */}
              <div className="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                    <TrendingUp className="h-5 w-5 text-blue-400" />
                    <h4 className="font-semibold text-blue-300">Most Likely Outcome</h4>
                  </div>
                  <Badge className="bg-blue-600/20 text-blue-300 border-blue-500/50">
                    {analysis.mostLikely.probability}% Probability
                  </Badge>
                </div>
                <p className="text-gray-300 text-sm">{analysis.mostLikely.description}</p>
              </div>

              {/* Best Case */}
              <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                    <CheckCircle className="h-5 w-5 text-green-400" />
                    <h4 className="font-semibold text-green-300">Best Case Scenario</h4>
                  </div>
                  <Badge className="bg-green-600/20 text-green-300 border-green-500/50">
                    {analysis.bestCase.probability}% Probability
                  </Badge>
                </div>
                <p className="text-gray-300 text-sm">{analysis.bestCase.description}</p>
              </div>

              {/* Worst Case */}
              <div className="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                    <TrendingDown className="h-5 w-5 text-red-400" />
                    <h4 className="font-semibold text-red-300">Worst Case Scenario</h4>
                  </div>
                  <Badge className="bg-red-600/20 text-red-300 border-red-500/50">
                    {analysis.worstCase.probability}% Probability
                  </Badge>
                </div>
                <p className="text-gray-300 text-sm">{analysis.worstCase.description}</p>
              </div>
            </div>

            {/* Success Factors & Risks */}
            <div className="grid md:grid-cols-2 gap-4">
              <div className="bg-slate-800/50 rounded-lg p-4">
                <h4 className="font-semibold text-green-400 mb-3 flex items-center gap-2">
                  <CheckCircle className="h-4 w-4" />
                  Key Success Factors
                </h4>
                <ul className="space-y-2">
                  {analysis.successFactors.map((factor: string, index: number) => (
                    <li key={index} className="text-gray-300 text-sm flex items-start gap-2">
                      <span className="text-green-400 mt-0.5"></span>
                      {factor}
                    </li>
                  ))}
                </ul>
              </div>

              <div className="bg-slate-800/50 rounded-lg p-4">
                <h4 className="font-semibold text-yellow-400 mb-3 flex items-center gap-2">
                  <AlertTriangle className="h-4 w-4" />
                  Critical Risks
                </h4>
                <ul className="space-y-2">
                  {analysis.risks.map((risk: string, index: number) => (
                    <li key={index} className="text-gray-300 text-sm flex items-start gap-2">
                      <span className="text-yellow-400 mt-0.5"></span>
                      {risk}
                    </li>
                  ))}
                </ul>
              </div>
            </div>

            {/* Recommendations */}
            <div className="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
              <h4 className="font-semibold text-purple-300 mb-3">AI Recommendations</h4>
              <ul className="space-y-2">
                {analysis.recommendations.map((rec: string, index: number) => (
                  <li key={index} className="text-gray-300 text-sm flex items-start gap-2">
                    <span className="text-purple-400 font-bold mt-0.5">{index + 1}.</span>
                    {rec}
                  </li>
                ))}
              </ul>
            </div>

            <p className="text-xs text-gray-500 text-center italic">
              Analysis powered by OpenAI GPT-5 with strategic execution frameworks
            </p>
          </div>
        )}
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/execution/ActivationButton.tsx
========================================
import { useState } from "react";
import { useMutation } from "@tanstack/react-query";
import { Button } from "@/components/ui/button";
import { 
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from "@/components/ui/alert-dialog";
import { Progress } from "@/components/ui/progress";
import { Badge } from "@/components/ui/badge";
import { 
  Rocket, 
  CheckCircle2, 
  AlertCircle, 
  Loader2,
  FileText,
  Users,
  DollarSign,
  ExternalLink,
  Clock
} from "lucide-react";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";

interface ActivationRequest {
  organizationId: string;
  scenarioId?: string | null;
  executionPlanId: string;
  playbookId: string;
  triggeredBy?: string;
  syncPlatform?: 'jira' | 'asana' | 'monday' | 'ms_project' | 'servicenow';
  skipPreflight?: boolean;
}

interface ActivationResult {
  success: boolean;
  executionInstanceId?: string;
  deadline?: string;
  preflightResult?: {
    canProceed: boolean;
    readinessScore: number;
  };
  projectSync?: {
    platform: string;
    projectUrl?: string;
    tasksCreated: number;
  };
  documentsGenerated: number;
  stakeholdersNotified: number;
  budgetUnlocked?: {
    totalAmount: number;
    currency: string;
    categories: string[];
  };
  errors: string[];
  events: Array<{
    type: string;
    success: boolean;
    durationMs: number;
  }>;
}

interface ActivationButtonProps {
  organizationId: string;
  scenarioId?: string | null;
  executionPlanId: string;
  playbookId: string;
  playbookName: string;
  userId?: string;
  syncPlatform?: 'jira' | 'asana' | 'monday' | 'ms_project' | 'servicenow';
  canActivate?: boolean;
  readinessScore?: number;
  onActivationComplete?: (result: ActivationResult) => void;
  size?: "default" | "sm" | "lg";
  variant?: "default" | "outline" | "destructive";
}

const eventLabels: Record<string, { label: string; icon: typeof CheckCircle2 }> = {
  activation_started: { label: "Activation Started", icon: Rocket },
  preflight_passed: { label: "Pre-flight Passed", icon: CheckCircle2 },
  preflight_failed: { label: "Pre-flight Failed", icon: AlertCircle },
  project_created: { label: "Project Created", icon: ExternalLink },
  documents_generated: { label: "Documents Generated", icon: FileText },
  stakeholders_notified: { label: "Stakeholders Notified", icon: Users },
  budget_unlocked: { label: "Budget Unlocked", icon: DollarSign },
  activation_completed: { label: "Activation Complete", icon: CheckCircle2 },
  activation_failed: { label: "Activation Failed", icon: AlertCircle },
};

export function ActivationButton({
  organizationId,
  scenarioId,
  executionPlanId,
  playbookId,
  playbookName,
  userId,
  syncPlatform,
  canActivate = true,
  readinessScore = 100,
  onActivationComplete,
  size = "lg",
  variant = "default",
}: ActivationButtonProps) {
  const { toast } = useToast();
  const [showProgress, setShowProgress] = useState(false);
  const [currentProgress, setCurrentProgress] = useState(0);
  const [currentStep, setCurrentStep] = useState("");

  const activationMutation = useMutation({
    mutationFn: async (request: ActivationRequest): Promise<ActivationResult> => {
      const response = await apiRequest("POST", "/api/execution/activate", request);
      return response.json();
    },
    onMutate: () => {
      setShowProgress(true);
      setCurrentProgress(10);
      setCurrentStep("Starting activation...");
    },
    onSuccess: (result) => {
      if (result.success) {
        let progress = 20;
        result.events.forEach((event, idx) => {
          setTimeout(() => {
            const eventConfig = eventLabels[event.type];
            setCurrentStep(eventConfig?.label || event.type);
            setCurrentProgress(20 + ((idx + 1) / result.events.length) * 80);
          }, idx * 300);
        });

        setTimeout(() => {
          setCurrentProgress(100);
          setCurrentStep("Activation complete!");
          
          toast({
            title: "Playbook Activated",
            description: `${playbookName} is now executing. ${result.stakeholdersNotified} stakeholders notified.`,
          });

          queryClient.invalidateQueries({ queryKey: ['/api/execution'] });
          
          if (onActivationComplete) {
            onActivationComplete(result);
          }

          setTimeout(() => setShowProgress(false), 2000);
        }, result.events.length * 300 + 500);
      } else {
        toast({
          title: "Activation Failed",
          description: result.errors.join(", ") || "Unknown error occurred",
          variant: "destructive",
        });
        setShowProgress(false);
      }
    },
    onError: (error: any) => {
      toast({
        title: "Activation Failed",
        description: error.message || "Failed to activate playbook",
        variant: "destructive",
      });
      setShowProgress(false);
    },
  });

  const handleActivate = () => {
    activationMutation.mutate({
      organizationId,
      scenarioId,
      executionPlanId,
      playbookId,
      triggeredBy: userId,
      syncPlatform,
    });
  };

  if (showProgress) {
    return (
      <div className="w-full space-y-3 p-4 bg-muted/50 rounded-lg" data-testid="activation-progress">
        <div className="flex items-center gap-2">
          <Loader2 className="h-5 w-5 animate-spin text-primary" />
          <span className="font-medium">{currentStep}</span>
        </div>
        <Progress value={currentProgress} className="h-2" />
        <div className="flex justify-between text-xs text-muted-foreground">
          <span>Executing coordinated response</span>
          <span>{Math.round(currentProgress)}%</span>
        </div>
      </div>
    );
  }

  const buttonDisabled = !canActivate || activationMutation.isPending;

  return (
    <AlertDialog>
      <AlertDialogTrigger asChild>
        <Button 
          size={size}
          variant={variant}
          disabled={buttonDisabled}
          className="gap-2"
          data-testid="button-activate-playbook"
        >
          <Rocket className="h-5 w-5" />
          {activationMutation.isPending ? "Activating..." : "Activate Playbook"}
          {readinessScore < 100 && (
            <Badge variant="secondary" className="ml-1">
              {readinessScore}% Ready
            </Badge>
          )}
        </Button>
      </AlertDialogTrigger>
      <AlertDialogContent data-testid="activation-confirm-dialog">
        <AlertDialogHeader>
          <AlertDialogTitle className="flex items-center gap-2">
            <Rocket className="h-5 w-5 text-primary" />
            Activate {playbookName}?
          </AlertDialogTitle>
          <AlertDialogDescription className="space-y-4">
            <p>
              This will trigger the coordinated response immediately. The following actions will occur:
            </p>
            <div className="grid grid-cols-2 gap-3 py-2">
              <div className="flex items-center gap-2 text-sm">
                <FileText className="h-4 w-4 text-muted-foreground" />
                <span>Generate execution documents</span>
              </div>
              <div className="flex items-center gap-2 text-sm">
                <Users className="h-4 w-4 text-muted-foreground" />
                <span>Notify all stakeholders</span>
              </div>
              {syncPlatform && (
                <div className="flex items-center gap-2 text-sm">
                  <ExternalLink className="h-4 w-4 text-muted-foreground" />
                  <span>Create {syncPlatform} project</span>
                </div>
              )}
              <div className="flex items-center gap-2 text-sm">
                <DollarSign className="h-4 w-4 text-muted-foreground" />
                <span>Unlock pre-approved budgets</span>
              </div>
              <div className="flex items-center gap-2 text-sm col-span-2">
                <Clock className="h-4 w-4 text-muted-foreground" />
                <span className="font-medium">12-minute execution window begins</span>
              </div>
            </div>
            <p className="text-sm font-medium text-orange-600 dark:text-orange-400">
              This action cannot be undone. Are you ready to proceed?
            </p>
          </AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel data-testid="button-cancel-activation">Cancel</AlertDialogCancel>
          <AlertDialogAction
            onClick={handleActivate}
            className="bg-primary"
            data-testid="button-confirm-activation"
          >
            <Rocket className="h-4 w-4 mr-2" />
            Activate Now
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}


========================================
FILE: client/src/components/execution/DocumentTemplateDesigner.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Textarea } from '@/components/ui/textarea';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  FileText,
  Newspaper,
  Briefcase,
  FileWarning,
  ClipboardList,
  FileCheck,
  Presentation,
  Mail,
  Scale,
  DollarSign,
  Users,
  Download,
  Eye,
  Wand2,
  Copy,
  Check,
  Loader2,
  ChevronRight,
  FileEdit,
} from 'lucide-react';
import { cn } from '@/lib/utils';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';

interface DocumentTemplateDesignerProps {
  executionInstanceId?: string;
  scenarioId?: string;
  organizationId?: string;
  onDocumentGenerated?: (document: GeneratedDocument) => void;
}

interface TemplateType {
  type: string;
  name: string;
  description: string;
}

interface TemplateVariable {
  name: string;
  type: string;
  required: boolean;
  defaultValue?: any;
  description?: string;
  source?: string;
}

interface GeneratedDocument {
  id: string;
  name: string;
  content: string;
  format: string;
  metadata: {
    templateId: string;
    generatedAt: string;
    variablesUsed: Record<string, any>;
    wordCount: number;
  };
}

const templateIcons: Record<string, any> = {
  press_release: Newspaper,
  stakeholder_memo: FileText,
  executive_briefing: Briefcase,
  project_charter: ClipboardList,
  risk_assessment: FileWarning,
  action_plan: FileCheck,
  status_report: FileEdit,
  board_presentation: Presentation,
  customer_communication: Mail,
  regulatory_filing: Scale,
  budget_request: DollarSign,
  resource_allocation: Users,
};

export function DocumentTemplateDesigner({
  executionInstanceId,
  scenarioId,
  organizationId,
  onDocumentGenerated,
}: DocumentTemplateDesignerProps) {
  const { toast } = useToast();
  const [selectedTemplate, setSelectedTemplate] = useState<string | null>(null);
  const [variableValues, setVariableValues] = useState<Record<string, any>>({});
  const [showPreview, setShowPreview] = useState(false);
  const [generatedDoc, setGeneratedDoc] = useState<GeneratedDocument | null>(null);
  const [copied, setCopied] = useState(false);
  
  const { data: templateTypes = [], isLoading: loadingTemplates } = useQuery<TemplateType[]>({
    queryKey: ['/api/documents/template-types'],
  });
  
  const { data: templateVariables = [], isLoading: loadingVariables } = useQuery<TemplateVariable[]>({
    queryKey: ['/api/documents/template-types', selectedTemplate, 'variables'],
    enabled: !!selectedTemplate,
  });
  
  const generateMutation = useMutation({
    mutationFn: async () => {
      const response = await apiRequest('POST', '/api/documents/generate-from-type', {
        templateType: selectedTemplate,
        variables: variableValues,
        executionInstanceId,
        scenarioId,
        organizationId,
      });
      return response.json();
    },
    onSuccess: (data: GeneratedDocument) => {
      setGeneratedDoc(data);
      setShowPreview(true);
      toast({
        title: 'Document Generated',
        description: `${data.name} has been created successfully.`,
      });
      onDocumentGenerated?.(data);
    },
    onError: (error) => {
      toast({
        title: 'Generation Failed',
        description: error instanceof Error ? error.message : 'Failed to generate document',
        variant: 'destructive',
      });
    },
  });
  
  const handleVariableChange = (name: string, value: any) => {
    setVariableValues((prev) => ({
      ...prev,
      [name]: value,
    }));
  };
  
  const handleCopyToClipboard = () => {
    if (generatedDoc) {
      navigator.clipboard.writeText(generatedDoc.content);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
      toast({
        title: 'Copied',
        description: 'Document content copied to clipboard.',
      });
    }
  };
  
  const handleDownload = () => {
    if (!generatedDoc) return;
    
    const blob = new Blob([generatedDoc.content], { type: 'text/markdown' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${generatedDoc.name.replace(/\s+/g, '_')}.md`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    toast({
      title: 'Downloaded',
      description: 'Document saved to your downloads.',
    });
  };
  
  const getRequiredVariables = () => 
    templateVariables.filter(v => v.required && v.source === 'user_input');
  
  const getOptionalVariables = () => 
    templateVariables.filter(v => !v.required || v.source !== 'user_input');
  
  const canGenerate = () => {
    const required = getRequiredVariables();
    return required.every(v => variableValues[v.name] && String(variableValues[v.name]).trim());
  };
  
  const renderTemplateSelection = () => {
    if (loadingTemplates) {
      return (
        <div className="flex items-center justify-center py-12">
          <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
        </div>
      );
    }
    
    return (
      <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
        {templateTypes.map((template) => {
          const Icon = templateIcons[template.type] || FileText;
          const isSelected = selectedTemplate === template.type;
          
          return (
            <button
              key={template.type}
              onClick={() => {
                setSelectedTemplate(template.type);
                setVariableValues({});
                setGeneratedDoc(null);
              }}
              className={cn(
                "flex flex-col items-center gap-2 p-4 rounded-lg border text-center transition-all",
                isSelected 
                  ? "border-primary bg-primary/5 shadow-sm" 
                  : "border-border hover:border-primary/50 hover:bg-muted/50"
              )}
              data-testid={`template-type-${template.type}`}
            >
              <div className={cn(
                "w-10 h-10 rounded-lg flex items-center justify-center",
                isSelected ? "bg-primary text-primary-foreground" : "bg-muted"
              )}>
                <Icon className="h-5 w-5" />
              </div>
              <span className="font-medium text-sm">{template.name}</span>
            </button>
          );
        })}
      </div>
    );
  };
  
  const renderVariableForm = () => {
    if (!selectedTemplate) {
      return (
        <div className="text-center py-8 text-muted-foreground">
          Select a template type to configure variables
        </div>
      );
    }
    
    if (loadingVariables) {
      return (
        <div className="flex items-center justify-center py-8">
          <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
        </div>
      );
    }
    
    const required = getRequiredVariables();
    const optional = getOptionalVariables();
    
    return (
      <ScrollArea className="h-[400px] pr-4">
        <div className="space-y-6">
          {required.length > 0 && (
            <div className="space-y-4">
              <h4 className="font-medium text-sm flex items-center gap-2">
                Required Information
                <Badge variant="secondary" className="text-xs">
                  {required.length} fields
                </Badge>
              </h4>
              {required.map((variable) => (
                <div key={variable.name} className="space-y-2">
                  <Label htmlFor={variable.name} className="flex items-center gap-1">
                    {formatVariableName(variable.name)}
                    <span className="text-destructive">*</span>
                  </Label>
                  {variable.type === 'string' && variable.name.includes('content') || 
                   variable.name.includes('summary') || 
                   variable.name.includes('description') ||
                   variable.name.includes('body') ? (
                    <Textarea
                      id={variable.name}
                      value={variableValues[variable.name] || ''}
                      onChange={(e) => handleVariableChange(variable.name, e.target.value)}
                      placeholder={variable.description || `Enter ${formatVariableName(variable.name).toLowerCase()}`}
                      rows={4}
                      data-testid={`input-${variable.name}`}
                    />
                  ) : (
                    <Input
                      id={variable.name}
                      type={variable.type === 'date' ? 'date' : 'text'}
                      value={variableValues[variable.name] || ''}
                      onChange={(e) => handleVariableChange(variable.name, e.target.value)}
                      placeholder={variable.description || `Enter ${formatVariableName(variable.name).toLowerCase()}`}
                      data-testid={`input-${variable.name}`}
                    />
                  )}
                </div>
              ))}
            </div>
          )}
          
          {optional.length > 0 && (
            <div className="space-y-4">
              <h4 className="font-medium text-sm flex items-center gap-2 text-muted-foreground">
                Optional / Auto-filled
                <Badge variant="outline" className="text-xs">
                  {optional.length} fields
                </Badge>
              </h4>
              {optional.filter(v => v.source === 'user_input').map((variable) => (
                <div key={variable.name} className="space-y-2">
                  <Label htmlFor={variable.name} className="text-muted-foreground">
                    {formatVariableName(variable.name)}
                    {variable.source !== 'user_input' && (
                      <span className="text-xs ml-2">({variable.source})</span>
                    )}
                  </Label>
                  <Input
                    id={variable.name}
                    type={variable.type === 'date' ? 'date' : 'text'}
                    value={variableValues[variable.name] || variable.defaultValue || ''}
                    onChange={(e) => handleVariableChange(variable.name, e.target.value)}
                    placeholder={variable.description}
                    data-testid={`input-${variable.name}`}
                  />
                </div>
              ))}
            </div>
          )}
        </div>
      </ScrollArea>
    );
  };
  
  const formatVariableName = (name: string) => {
    return name
      .split('_')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');
  };
  
  const renderMarkdownPreview = (content: string) => {
    return (
      <div 
        className="prose prose-sm dark:prose-invert max-w-none"
        dangerouslySetInnerHTML={{ 
          __html: content
            .replace(/^### (.+)$/gm, '<h3>$1</h3>')
            .replace(/^## (.+)$/gm, '<h2>$1</h2>')
            .replace(/^# (.+)$/gm, '<h1>$1</h1>')
            .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.+?)\*/g, '<em>$1</em>')
            .replace(/^> (.+)$/gm, '<blockquote>$1</blockquote>')
            .replace(/^- (.+)$/gm, '<li>$1</li>')
            .replace(/\n\n/g, '</p><p>')
            .replace(/\n/g, '<br>')
        }}
      />
    );
  };
  
  return (
    <Card className="h-full">
      <CardHeader>
        <div className="flex items-center justify-between">
          <div>
            <CardTitle className="flex items-center gap-2">
              <Wand2 className="h-5 w-5" />
              Document Generator
            </CardTitle>
            <CardDescription>
              Auto-generate professional documents from execution context
            </CardDescription>
          </div>
          {selectedTemplate && (
            <Button
              onClick={() => generateMutation.mutate()}
              disabled={!canGenerate() || generateMutation.isPending}
              data-testid="button-generate-document"
            >
              {generateMutation.isPending ? (
                <>
                  <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                  Generating...
                </>
              ) : (
                <>
                  <Wand2 className="h-4 w-4 mr-2" />
                  Generate
                </>
              )}
            </Button>
          )}
        </div>
      </CardHeader>
      <CardContent>
        <Tabs defaultValue="template" className="space-y-4">
          <TabsList>
            <TabsTrigger value="template" data-testid="tab-template">
              <FileText className="h-4 w-4 mr-2" />
              Template
            </TabsTrigger>
            <TabsTrigger value="variables" data-testid="tab-variables" disabled={!selectedTemplate}>
              <FileEdit className="h-4 w-4 mr-2" />
              Variables
            </TabsTrigger>
          </TabsList>
          
          <TabsContent value="template">
            {renderTemplateSelection()}
          </TabsContent>
          
          <TabsContent value="variables">
            {renderVariableForm()}
          </TabsContent>
        </Tabs>
      </CardContent>
      
      <Dialog open={showPreview} onOpenChange={setShowPreview}>
        <DialogContent className="max-w-3xl max-h-[80vh]">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <FileText className="h-5 w-5" />
              {generatedDoc?.name}
            </DialogTitle>
            <DialogDescription>
              {generatedDoc?.metadata.wordCount} words generated
            </DialogDescription>
          </DialogHeader>
          <ScrollArea className="h-[50vh] pr-4">
            {generatedDoc && renderMarkdownPreview(generatedDoc.content)}
          </ScrollArea>
          <DialogFooter className="flex gap-2">
            <Button
              variant="outline"
              onClick={handleCopyToClipboard}
              data-testid="button-copy-document"
            >
              {copied ? (
                <>
                  <Check className="h-4 w-4 mr-2" />
                  Copied!
                </>
              ) : (
                <>
                  <Copy className="h-4 w-4 mr-2" />
                  Copy
                </>
              )}
            </Button>
            <Button onClick={handleDownload} data-testid="button-download-document">
              <Download className="h-4 w-4 mr-2" />
              Download
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </Card>
  );
}


========================================
FILE: client/src/components/execution/ExecutionCommandCenter.tsx
========================================
import { useState, useEffect } from "react";
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Button } from "@/components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { ScrollArea } from "@/components/ui/scroll-area";
import { 
  Clock, 
  CheckCircle2, 
  AlertCircle, 
  Users, 
  FileText, 
  DollarSign,
  ExternalLink,
  Activity,
  Timer,
  Loader2
} from "lucide-react";
import { PreFlightChecklist } from "./PreFlightChecklist";
import { ActivationButton } from "./ActivationButton";

interface ExecutionStatus {
  instance: {
    id: string;
    status: string;
    currentPhase: string;
    startedAt: string;
    completedAt?: string;
    actualExecutionTime?: number;
  };
  events: Array<{
    id: string;
    eventType: string;
    eventData: any;
    success: boolean;
    durationMs: number;
    createdAt: string;
  }>;
  stakeholderAcks: Array<{
    id: string;
    stakeholderId: string;
    userId: string;
    acknowledgedAt?: string;
    notificationChannel: string;
  }>;
  documents: Array<{
    id: string;
    documentName: string;
    documentType: string;
    format: string;
    createdAt: string;
  }>;
  projectSync: {
    platform: string;
    externalProjectKey: string;
    externalProjectUrl: string;
    tasksCreated: number;
    syncStatus: string;
  } | null;
  budgets: Array<{
    id: string;
    budgetCategory: string;
    preApprovedAmount: string;
    currency: string;
    status: string;
    unlockedAt: string;
  }>;
}

interface ExecutionCommandCenterProps {
  executionInstanceId?: string;
  executionPlanId?: string;
  organizationId: string;
  scenarioId?: string | null;
  playbookId: string;
  playbookName: string;
  userId?: string;
  syncPlatform?: 'jira' | 'asana' | 'monday' | 'ms_project' | 'servicenow';
}

function CountdownTimer({ deadline }: { deadline: Date }) {
  const [timeLeft, setTimeLeft] = useState<{ minutes: number; seconds: number }>({ minutes: 0, seconds: 0 });
  const [isExpired, setIsExpired] = useState(false);

  useEffect(() => {
    const interval = setInterval(() => {
      const now = new Date();
      const diff = deadline.getTime() - now.getTime();
      
      if (diff <= 0) {
        setIsExpired(true);
        setTimeLeft({ minutes: 0, seconds: 0 });
      } else {
        const minutes = Math.floor(diff / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        setTimeLeft({ minutes, seconds });
      }
    }, 1000);

    return () => clearInterval(interval);
  }, [deadline]);

  const progressPercent = isExpired ? 100 : Math.max(0, 100 - ((timeLeft.minutes * 60 + timeLeft.seconds) / 720) * 100);

  return (
    <div className="space-y-2" data-testid="countdown-timer">
      <div className="flex items-center justify-between">
        <span className="text-sm text-muted-foreground">Time Remaining</span>
        <span className={`text-2xl font-mono font-bold ${isExpired ? 'text-red-500' : timeLeft.minutes < 2 ? 'text-orange-500' : 'text-green-500'}`}>
          {isExpired ? "EXPIRED" : `${timeLeft.minutes.toString().padStart(2, '0')}:${timeLeft.seconds.toString().padStart(2, '0')}`}
        </span>
      </div>
      <Progress value={progressPercent} className="h-2" />
      <div className="text-xs text-muted-foreground text-right">
        12-minute execution window
      </div>
    </div>
  );
}

export function ExecutionCommandCenter({
  executionInstanceId,
  executionPlanId,
  organizationId,
  scenarioId,
  playbookId,
  playbookName,
  userId,
  syncPlatform,
}: ExecutionCommandCenterProps) {
  const [activeInstanceId, setActiveInstanceId] = useState(executionInstanceId);
  const [canActivate, setCanActivate] = useState(true);
  const [readinessScore, setReadinessScore] = useState(100);
  const [deadline, setDeadline] = useState<Date | null>(null);

  const { data: status, isLoading } = useQuery<ExecutionStatus>({
    queryKey: ['/api/execution/status', activeInstanceId],
    enabled: !!activeInstanceId,
    refetchInterval: 5000,
  });

  useEffect(() => {
    if (status?.instance?.startedAt) {
      const startTime = new Date(status.instance.startedAt);
      const deadlineTime = new Date(startTime.getTime() + 12 * 60 * 1000);
      setDeadline(deadlineTime);
    }
  }, [status?.instance?.startedAt]);

  const handleReadyChange = (ready: boolean, score: number) => {
    setCanActivate(ready);
    setReadinessScore(score);
  };

  const handleActivationComplete = (result: any) => {
    if (result.executionInstanceId) {
      setActiveInstanceId(result.executionInstanceId);
      if (result.deadline) {
        setDeadline(new Date(result.deadline));
      }
    }
  };

  const totalAcks = status?.stakeholderAcks?.length || 0;
  const completedAcks = status?.stakeholderAcks?.filter(a => a.acknowledgedAt)?.length || 0;
  const totalBudget = status?.budgets?.reduce((sum, b) => sum + parseFloat(b.preApprovedAmount || '0'), 0) || 0;

  return (
    <div className="space-y-6" data-testid="execution-command-center">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl font-bold flex items-center gap-2">
            <Activity className="h-6 w-6" />
            Command Center
          </h2>
          <p className="text-muted-foreground">{playbookName}</p>
        </div>
        {!activeInstanceId && executionPlanId && (
          <ActivationButton
            organizationId={organizationId}
            scenarioId={scenarioId}
            executionPlanId={executionPlanId}
            playbookId={playbookId}
            playbookName={playbookName}
            userId={userId}
            syncPlatform={syncPlatform}
            canActivate={canActivate}
            readinessScore={readinessScore}
            onActivationComplete={handleActivationComplete}
          />
        )}
      </div>

      {!activeInstanceId && executionPlanId && (
        <PreFlightChecklist
          executionPlanId={executionPlanId}
          organizationId={organizationId}
          onReadyChange={handleReadyChange}
        />
      )}

      {!activeInstanceId && !executionPlanId && (
        <Card className="border-orange-200 dark:border-orange-800 bg-orange-50/50 dark:bg-orange-950/20">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-orange-700 dark:text-orange-400">
              <Clock className="h-5 w-5" />
              Ready for One-Click Activation
            </CardTitle>
            <CardDescription>
              When triggered, M will execute this playbook in under 12 minutes
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="grid grid-cols-2 gap-4">
              <div className="flex items-center gap-2 text-sm">
                <FileText className="h-4 w-4 text-muted-foreground" />
                <span>Auto-generate documents</span>
              </div>
              <div className="flex items-center gap-2 text-sm">
                <Users className="h-4 w-4 text-muted-foreground" />
                <span>Notify all stakeholders</span>
              </div>
              <div className="flex items-center gap-2 text-sm">
                <ExternalLink className="h-4 w-4 text-muted-foreground" />
                <span>Create Jira/Asana project</span>
              </div>
              <div className="flex items-center gap-2 text-sm">
                <DollarSign className="h-4 w-4 text-muted-foreground" />
                <span>Unlock pre-approved budgets</span>
              </div>
            </div>
            <div className="text-center py-4">
              <div className="text-4xl font-bold text-orange-500 mb-2">
                72 hrs  12 min
              </div>
              <p className="text-sm text-muted-foreground">
                M eliminates the planning phase entirely
              </p>
            </div>
            <ActivationButton
              organizationId={organizationId}
              scenarioId={scenarioId}
              executionPlanId={playbookId}
              playbookId={playbookId}
              playbookName={playbookName}
              userId={userId}
              syncPlatform={syncPlatform}
              canActivate={true}
              readinessScore={100}
              onActivationComplete={handleActivationComplete}
            />
          </CardContent>
        </Card>
      )}

      {activeInstanceId && (
        <>
          {deadline && (
            <Card data-testid="deadline-card">
              <CardHeader className="pb-2">
                <CardTitle className="text-lg flex items-center gap-2">
                  <Timer className="h-5 w-5" />
                  Execution Deadline
                </CardTitle>
              </CardHeader>
              <CardContent>
                <CountdownTimer deadline={deadline} />
              </CardContent>
            </Card>
          )}

          {isLoading ? (
            <Card>
              <CardContent className="py-8 flex items-center justify-center">
                <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
              </CardContent>
            </Card>
          ) : status ? (
            <Tabs defaultValue="overview" className="space-y-4">
              <TabsList>
                <TabsTrigger value="overview" data-testid="tab-overview">Overview</TabsTrigger>
                <TabsTrigger value="stakeholders" data-testid="tab-stakeholders">
                  Stakeholders
                  <Badge variant="secondary" className="ml-2">{completedAcks}/{totalAcks}</Badge>
                </TabsTrigger>
                <TabsTrigger value="documents" data-testid="tab-documents">
                  Documents
                  <Badge variant="secondary" className="ml-2">{status.documents?.length || 0}</Badge>
                </TabsTrigger>
                <TabsTrigger value="events" data-testid="tab-events">Events</TabsTrigger>
              </TabsList>

              <TabsContent value="overview">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                  <Card data-testid="status-card">
                    <CardHeader className="pb-2">
                      <CardDescription>Status</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center gap-2">
                        {status.instance.status === 'completed' ? (
                          <CheckCircle2 className="h-5 w-5 text-green-500" />
                        ) : status.instance.status === 'failed' ? (
                          <AlertCircle className="h-5 w-5 text-red-500" />
                        ) : (
                          <Activity className="h-5 w-5 text-blue-500 animate-pulse" />
                        )}
                        <span className="text-xl font-semibold capitalize">
                          {status.instance.status?.replace('_', ' ')}
                        </span>
                      </div>
                      <p className="text-sm text-muted-foreground mt-1">
                        Phase: {status.instance.currentPhase || 'N/A'}
                      </p>
                    </CardContent>
                  </Card>

                  <Card data-testid="stakeholders-card">
                    <CardHeader className="pb-2">
                      <CardDescription>Stakeholders Acknowledged</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center gap-2">
                        <Users className="h-5 w-5 text-muted-foreground" />
                        <span className="text-xl font-semibold">
                          {completedAcks} / {totalAcks}
                        </span>
                      </div>
                      <Progress value={totalAcks > 0 ? (completedAcks / totalAcks) * 100 : 0} className="h-2 mt-2" />
                    </CardContent>
                  </Card>

                  <Card data-testid="documents-card">
                    <CardHeader className="pb-2">
                      <CardDescription>Documents Generated</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center gap-2">
                        <FileText className="h-5 w-5 text-muted-foreground" />
                        <span className="text-xl font-semibold">
                          {status.documents?.length || 0}
                        </span>
                      </div>
                    </CardContent>
                  </Card>

                  <Card data-testid="budget-card">
                    <CardHeader className="pb-2">
                      <CardDescription>Budget Unlocked</CardDescription>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center gap-2">
                        <DollarSign className="h-5 w-5 text-muted-foreground" />
                        <span className="text-xl font-semibold">
                          ${totalBudget.toLocaleString()}
                        </span>
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {status.projectSync && (
                  <Card className="mt-4" data-testid="project-sync-card">
                    <CardHeader>
                      <CardTitle className="text-lg flex items-center gap-2">
                        <ExternalLink className="h-5 w-5" />
                        External Project
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="font-medium capitalize">{status.projectSync.platform}</p>
                          <p className="text-sm text-muted-foreground">
                            {status.projectSync.tasksCreated} tasks synced
                          </p>
                        </div>
                        <Button variant="outline" size="sm" asChild>
                          <a 
                            href={status.projectSync.externalProjectUrl} 
                            target="_blank" 
                            rel="noopener noreferrer"
                            data-testid="link-external-project"
                          >
                            Open in {status.projectSync.platform}
                            <ExternalLink className="h-4 w-4 ml-2" />
                          </a>
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                )}
              </TabsContent>

              <TabsContent value="stakeholders">
                <Card>
                  <CardHeader>
                    <CardTitle>Stakeholder Acknowledgments</CardTitle>
                    <CardDescription>
                      Track who has acknowledged the activation
                    </CardDescription>
                  </CardHeader>
                  <CardContent>
                    <ScrollArea className="h-[300px]">
                      <div className="space-y-3">
                        {status.stakeholderAcks?.map((ack, idx) => (
                          <div 
                            key={ack.id} 
                            className="flex items-center justify-between p-3 rounded-lg bg-muted/50"
                            data-testid={`stakeholder-ack-${idx}`}
                          >
                            <div className="flex items-center gap-3">
                              {ack.acknowledgedAt ? (
                                <CheckCircle2 className="h-5 w-5 text-green-500" />
                              ) : (
                                <Clock className="h-5 w-5 text-yellow-500" />
                              )}
                              <div>
                                <p className="font-medium">Stakeholder #{ack.stakeholderId?.slice(-4) || idx + 1}</p>
                                <p className="text-sm text-muted-foreground capitalize">
                                  via {ack.notificationChannel?.replace('_', ' ')}
                                </p>
                              </div>
                            </div>
                            <Badge variant={ack.acknowledgedAt ? "default" : "secondary"}>
                              {ack.acknowledgedAt ? "Acknowledged" : "Pending"}
                            </Badge>
                          </div>
                        ))}
                        {(!status.stakeholderAcks || status.stakeholderAcks.length === 0) && (
                          <p className="text-center text-muted-foreground py-4">
                            No stakeholders to notify
                          </p>
                        )}
                      </div>
                    </ScrollArea>
                  </CardContent>
                </Card>
              </TabsContent>

              <TabsContent value="documents">
                <Card>
                  <CardHeader>
                    <CardTitle>Generated Documents</CardTitle>
                    <CardDescription>
                      Documents created during activation
                    </CardDescription>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-3">
                      {status.documents?.map((doc, idx) => (
                        <div 
                          key={doc.id} 
                          className="flex items-center justify-between p-3 rounded-lg bg-muted/50"
                          data-testid={`document-item-${idx}`}
                        >
                          <div className="flex items-center gap-3">
                            <FileText className="h-5 w-5 text-muted-foreground" />
                            <div>
                              <p className="font-medium">{doc.documentName}</p>
                              <p className="text-sm text-muted-foreground capitalize">
                                {doc.documentType}  {doc.format}
                              </p>
                            </div>
                          </div>
                          <Button variant="ghost" size="sm" data-testid={`button-view-doc-${idx}`}>
                            View
                          </Button>
                        </div>
                      ))}
                      {(!status.documents || status.documents.length === 0) && (
                        <p className="text-center text-muted-foreground py-4">
                          No documents generated yet
                        </p>
                      )}
                    </div>
                  </CardContent>
                </Card>
              </TabsContent>

              <TabsContent value="events">
                <Card>
                  <CardHeader>
                    <CardTitle>Activation Events</CardTitle>
                    <CardDescription>
                      Timeline of activation events
                    </CardDescription>
                  </CardHeader>
                  <CardContent>
                    <ScrollArea className="h-[300px]">
                      <div className="space-y-3">
                        {status.events?.map((event, idx) => (
                          <div 
                            key={event.id} 
                            className="flex items-start gap-3 p-3 rounded-lg bg-muted/50"
                            data-testid={`event-item-${idx}`}
                          >
                            {event.success ? (
                              <CheckCircle2 className="h-5 w-5 text-green-500 mt-0.5" />
                            ) : (
                              <AlertCircle className="h-5 w-5 text-red-500 mt-0.5" />
                            )}
                            <div className="flex-1">
                              <div className="flex items-center justify-between">
                                <p className="font-medium capitalize">
                                  {event.eventType?.replace(/_/g, ' ')}
                                </p>
                                <span className="text-xs text-muted-foreground">
                                  {event.durationMs}ms
                                </span>
                              </div>
                              <p className="text-sm text-muted-foreground">
                                {new Date(event.createdAt).toLocaleTimeString()}
                              </p>
                            </div>
                          </div>
                        ))}
                        {(!status.events || status.events.length === 0) && (
                          <p className="text-center text-muted-foreground py-4">
                            No events recorded yet
                          </p>
                        )}
                      </div>
                    </ScrollArea>
                  </CardContent>
                </Card>
              </TabsContent>
            </Tabs>
          ) : null}
        </>
      )}
    </div>
  );
}


========================================
FILE: client/src/components/execution/PreApprovedResourcesAdmin.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import {
  DollarSign,
  Users,
  Package,
  Clock,
  Plus,
  MoreVertical,
  Edit,
  Trash2,
  CheckCircle,
  XCircle,
  AlertTriangle,
  Loader2,
  Search,
  Filter,
  Zap,
  Shield,
  Calendar,
} from 'lucide-react';
import { cn } from '@/lib/utils';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';
import { format, formatDistanceToNow, isAfter } from 'date-fns';

interface PreApprovedResourcesAdminProps {
  organizationId?: string;
  scenarioId?: string;
}

interface PreApprovedResource {
  id: string;
  organizationId: string;
  scenarioId?: string;
  resourceType: string;
  name: string;
  description?: string;
  allocatedAmount?: number;
  consumedAmount?: number;
  unit?: string;
  approvedBy?: string;
  approvalDate?: string;
  expiryDate?: string;
  status: string;
  conditions?: string;
  createdAt?: string;
}

const resourceTypeIcons: Record<string, any> = {
  budget: DollarSign,
  personnel: Users,
  equipment: Package,
  time: Clock,
  vendor: Shield,
};

const resourceTypeColors: Record<string, string> = {
  budget: 'text-green-500',
  personnel: 'text-blue-500',
  equipment: 'text-orange-500',
  time: 'text-purple-500',
  vendor: 'text-cyan-500',
};

export function PreApprovedResourcesAdmin({
  organizationId,
  scenarioId,
}: PreApprovedResourcesAdminProps) {
  const { toast } = useToast();
  const [showAddDialog, setShowAddDialog] = useState(false);
  const [editingResource, setEditingResource] = useState<PreApprovedResource | null>(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterType, setFilterType] = useState<string>('all');
  const [filterStatus, setFilterStatus] = useState<string>('all');
  
  const [formData, setFormData] = useState<Partial<PreApprovedResource>>({
    resourceType: 'budget',
    name: '',
    description: '',
    allocatedAmount: 0,
    unit: '',
    status: 'active',
    conditions: '',
  });
  
  const { data: resources = [], isLoading } = useQuery<PreApprovedResource[]>({
    queryKey: ['/api/pre-approved-resources', organizationId, scenarioId],
    enabled: !!organizationId,
  });
  
  const createMutation = useMutation({
    mutationFn: async (data: Partial<PreApprovedResource>) => {
      const response = await apiRequest('POST', '/api/pre-approved-resources', {
        ...data,
        organizationId,
        scenarioId,
      });
      return response.json();
    },
    onSuccess: () => {
      toast({ title: 'Resource Created', description: 'Pre-approved resource has been added.' });
      queryClient.invalidateQueries({ queryKey: ['/api/pre-approved-resources'] });
      setShowAddDialog(false);
      resetForm();
    },
    onError: (error) => {
      toast({
        title: 'Creation Failed',
        description: error instanceof Error ? error.message : 'Failed to create resource',
        variant: 'destructive',
      });
    },
  });
  
  const updateMutation = useMutation({
    mutationFn: async ({ id, data }: { id: string; data: Partial<PreApprovedResource> }) => {
      const response = await apiRequest('PATCH', `/api/pre-approved-resources/${id}`, data);
      return response.json();
    },
    onSuccess: () => {
      toast({ title: 'Resource Updated', description: 'Changes have been saved.' });
      queryClient.invalidateQueries({ queryKey: ['/api/pre-approved-resources'] });
      setEditingResource(null);
      resetForm();
    },
    onError: (error) => {
      toast({
        title: 'Update Failed',
        description: error instanceof Error ? error.message : 'Failed to update resource',
        variant: 'destructive',
      });
    },
  });
  
  const deleteMutation = useMutation({
    mutationFn: async (id: string) => {
      await apiRequest('DELETE', `/api/pre-approved-resources/${id}`);
    },
    onSuccess: () => {
      toast({ title: 'Resource Deleted', description: 'Pre-approved resource has been removed.' });
      queryClient.invalidateQueries({ queryKey: ['/api/pre-approved-resources'] });
    },
    onError: (error) => {
      toast({
        title: 'Delete Failed',
        description: error instanceof Error ? error.message : 'Failed to delete resource',
        variant: 'destructive',
      });
    },
  });
  
  const activateMutation = useMutation({
    mutationFn: async (id: string) => {
      const response = await apiRequest('POST', `/api/pre-approved-resources/${id}/activate`);
      return response.json();
    },
    onSuccess: () => {
      toast({ title: 'Resource Activated', description: 'Resource is now available for use.' });
      queryClient.invalidateQueries({ queryKey: ['/api/pre-approved-resources'] });
    },
    onError: (error) => {
      toast({
        title: 'Activation Failed',
        description: error instanceof Error ? error.message : 'Failed to activate resource',
        variant: 'destructive',
      });
    },
  });
  
  const resetForm = () => {
    setFormData({
      resourceType: 'budget',
      name: '',
      description: '',
      allocatedAmount: 0,
      unit: '',
      status: 'active',
      conditions: '',
    });
  };
  
  const handleEdit = (resource: PreApprovedResource) => {
    setEditingResource(resource);
    setFormData({
      resourceType: resource.resourceType,
      name: resource.name,
      description: resource.description || '',
      allocatedAmount: resource.allocatedAmount || 0,
      unit: resource.unit || '',
      status: resource.status,
      conditions: resource.conditions || '',
      expiryDate: resource.expiryDate,
    });
    setShowAddDialog(true);
  };
  
  const handleSubmit = () => {
    if (editingResource) {
      updateMutation.mutate({ id: editingResource.id, data: formData });
    } else {
      createMutation.mutate(formData);
    }
  };
  
  const filteredResources = resources.filter((resource) => {
    const matchesSearch = 
      resource.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      resource.description?.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesType = filterType === 'all' || resource.resourceType === filterType;
    const matchesStatus = filterStatus === 'all' || resource.status === filterStatus;
    return matchesSearch && matchesType && matchesStatus;
  });
  
  const getStatusBadge = (status: string, expiryDate?: string) => {
    const isExpired = expiryDate && isAfter(new Date(), new Date(expiryDate));
    
    if (isExpired) {
      return (
        <Badge variant="outline" className="text-muted-foreground">
          <XCircle className="h-3 w-3 mr-1" />
          Expired
        </Badge>
      );
    }
    
    const statusConfig: Record<string, { variant: 'default' | 'secondary' | 'destructive' | 'outline'; icon: any }> = {
      active: { variant: 'default', icon: CheckCircle },
      pending: { variant: 'secondary', icon: Clock },
      consumed: { variant: 'outline', icon: Package },
      expired: { variant: 'outline', icon: XCircle },
      revoked: { variant: 'destructive', icon: AlertTriangle },
    };
    
    const config = statusConfig[status] || statusConfig.pending;
    const Icon = config.icon;
    
    return (
      <Badge variant={config.variant}>
        <Icon className="h-3 w-3 mr-1" />
        {status.charAt(0).toUpperCase() + status.slice(1)}
      </Badge>
    );
  };
  
  const getUtilizationProgress = (resource: PreApprovedResource) => {
    if (!resource.allocatedAmount || resource.allocatedAmount === 0) return 0;
    return Math.round(((resource.consumedAmount || 0) / resource.allocatedAmount) * 100);
  };
  
  const formatResourceValue = (resource: PreApprovedResource) => {
    if (resource.resourceType === 'budget') {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        maximumFractionDigits: 0,
      }).format(resource.allocatedAmount || 0);
    }
    return `${resource.allocatedAmount || 0} ${resource.unit || ''}`;
  };
  
  const resourceTypeTotals = resources.reduce((acc, resource) => {
    if (!acc[resource.resourceType]) {
      acc[resource.resourceType] = { count: 0, totalAllocated: 0, totalConsumed: 0 };
    }
    acc[resource.resourceType].count++;
    acc[resource.resourceType].totalAllocated += resource.allocatedAmount || 0;
    acc[resource.resourceType].totalConsumed += resource.consumedAmount || 0;
    return acc;
  }, {} as Record<string, { count: number; totalAllocated: number; totalConsumed: number }>);
  
  return (
    <Card className="h-full">
      <CardHeader>
        <div className="flex items-center justify-between">
          <div>
            <CardTitle className="flex items-center gap-2">
              <Zap className="h-5 w-5" />
              Pre-Approved Resources
            </CardTitle>
            <CardDescription>
              Manage resources available for instant activation during execution
            </CardDescription>
          </div>
          <Button onClick={() => { resetForm(); setEditingResource(null); setShowAddDialog(true); }} data-testid="button-add-resource">
            <Plus className="h-4 w-4 mr-2" />
            Add Resource
          </Button>
        </div>
      </CardHeader>
      <CardContent className="space-y-6">
        <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
          {Object.entries(resourceTypeIcons).map(([type, Icon]) => {
            const totals = resourceTypeTotals[type] || { count: 0, totalAllocated: 0 };
            return (
              <Card key={type} className="p-4">
                <div className="flex items-center gap-3">
                  <div className={cn("w-10 h-10 rounded-lg bg-muted flex items-center justify-center", resourceTypeColors[type])}>
                    <Icon className="h-5 w-5" />
                  </div>
                  <div>
                    <p className="text-2xl font-bold">{totals.count}</p>
                    <p className="text-xs text-muted-foreground capitalize">{type}</p>
                  </div>
                </div>
              </Card>
            );
          })}
        </div>
        
        <div className="flex items-center gap-4">
          <div className="relative flex-1">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
            <Input
              placeholder="Search resources..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="pl-10"
              data-testid="input-search-resources"
            />
          </div>
          <Select value={filterType} onValueChange={setFilterType}>
            <SelectTrigger className="w-[150px]" data-testid="select-filter-type">
              <Filter className="h-4 w-4 mr-2" />
              <SelectValue placeholder="Type" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">All Types</SelectItem>
              <SelectItem value="budget">Budget</SelectItem>
              <SelectItem value="personnel">Personnel</SelectItem>
              <SelectItem value="equipment">Equipment</SelectItem>
              <SelectItem value="time">Time</SelectItem>
              <SelectItem value="vendor">Vendor</SelectItem>
            </SelectContent>
          </Select>
          <Select value={filterStatus} onValueChange={setFilterStatus}>
            <SelectTrigger className="w-[150px]" data-testid="select-filter-status">
              <SelectValue placeholder="Status" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">All Status</SelectItem>
              <SelectItem value="active">Active</SelectItem>
              <SelectItem value="pending">Pending</SelectItem>
              <SelectItem value="consumed">Consumed</SelectItem>
              <SelectItem value="expired">Expired</SelectItem>
            </SelectContent>
          </Select>
        </div>
        
        {isLoading ? (
          <div className="flex items-center justify-center py-12">
            <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
          </div>
        ) : filteredResources.length === 0 ? (
          <div className="text-center py-12">
            <Package className="h-12 w-12 mx-auto text-muted-foreground mb-4" />
            <h3 className="font-medium">No Resources Found</h3>
            <p className="text-sm text-muted-foreground mt-1">
              {searchQuery || filterType !== 'all' || filterStatus !== 'all'
                ? 'Try adjusting your filters'
                : 'Add pre-approved resources to enable instant activation'}
            </p>
          </div>
        ) : (
          <ScrollArea className="h-[400px]">
            <Table>
              <TableHeader>
                <TableRow>
                  <TableHead>Resource</TableHead>
                  <TableHead>Type</TableHead>
                  <TableHead>Allocation</TableHead>
                  <TableHead>Utilization</TableHead>
                  <TableHead>Status</TableHead>
                  <TableHead>Expiry</TableHead>
                  <TableHead className="w-12"></TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {filteredResources.map((resource) => {
                  const Icon = resourceTypeIcons[resource.resourceType] || Package;
                  const utilization = getUtilizationProgress(resource);
                  
                  return (
                    <TableRow key={resource.id} data-testid={`resource-row-${resource.id}`}>
                      <TableCell>
                        <div>
                          <p className="font-medium">{resource.name}</p>
                          {resource.description && (
                            <p className="text-sm text-muted-foreground line-clamp-1">
                              {resource.description}
                            </p>
                          )}
                        </div>
                      </TableCell>
                      <TableCell>
                        <div className="flex items-center gap-2">
                          <Icon className={cn("h-4 w-4", resourceTypeColors[resource.resourceType])} />
                          <span className="capitalize">{resource.resourceType}</span>
                        </div>
                      </TableCell>
                      <TableCell>
                        <span className="font-medium">{formatResourceValue(resource)}</span>
                      </TableCell>
                      <TableCell>
                        <div className="space-y-1">
                          <Progress value={utilization} className="h-2 w-24" />
                          <span className="text-xs text-muted-foreground">{utilization}% used</span>
                        </div>
                      </TableCell>
                      <TableCell>
                        {getStatusBadge(resource.status, resource.expiryDate)}
                      </TableCell>
                      <TableCell>
                        {resource.expiryDate ? (
                          <div className="flex items-center gap-1 text-sm">
                            <Calendar className="h-3 w-3" />
                            {format(new Date(resource.expiryDate), 'MMM d, yyyy')}
                          </div>
                        ) : (
                          <span className="text-muted-foreground text-sm">No expiry</span>
                        )}
                      </TableCell>
                      <TableCell>
                        <DropdownMenu>
                          <DropdownMenuTrigger asChild>
                            <Button variant="ghost" size="icon" data-testid={`button-actions-${resource.id}`}>
                              <MoreVertical className="h-4 w-4" />
                            </Button>
                          </DropdownMenuTrigger>
                          <DropdownMenuContent align="end">
                            <DropdownMenuItem onClick={() => handleEdit(resource)}>
                              <Edit className="h-4 w-4 mr-2" />
                              Edit
                            </DropdownMenuItem>
                            {resource.status === 'pending' && (
                              <DropdownMenuItem onClick={() => activateMutation.mutate(resource.id)}>
                                <CheckCircle className="h-4 w-4 mr-2" />
                                Activate
                              </DropdownMenuItem>
                            )}
                            <DropdownMenuSeparator />
                            <DropdownMenuItem 
                              onClick={() => deleteMutation.mutate(resource.id)}
                              className="text-destructive"
                            >
                              <Trash2 className="h-4 w-4 mr-2" />
                              Delete
                            </DropdownMenuItem>
                          </DropdownMenuContent>
                        </DropdownMenu>
                      </TableCell>
                    </TableRow>
                  );
                })}
              </TableBody>
            </Table>
          </ScrollArea>
        )}
      </CardContent>
      
      <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle>
              {editingResource ? 'Edit Resource' : 'Add Pre-Approved Resource'}
            </DialogTitle>
            <DialogDescription>
              Resources that can be instantly activated during execution
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4 py-4">
            <div className="space-y-2">
              <Label htmlFor="resourceType">Resource Type</Label>
              <Select 
                value={formData.resourceType} 
                onValueChange={(v) => setFormData({ ...formData, resourceType: v })}
              >
                <SelectTrigger id="resourceType" data-testid="select-resource-type">
                  <SelectValue placeholder="Select type" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="budget">
                    <div className="flex items-center gap-2">
                      <DollarSign className="h-4 w-4 text-green-500" />
                      Budget
                    </div>
                  </SelectItem>
                  <SelectItem value="personnel">
                    <div className="flex items-center gap-2">
                      <Users className="h-4 w-4 text-blue-500" />
                      Personnel
                    </div>
                  </SelectItem>
                  <SelectItem value="equipment">
                    <div className="flex items-center gap-2">
                      <Package className="h-4 w-4 text-orange-500" />
                      Equipment
                    </div>
                  </SelectItem>
                  <SelectItem value="time">
                    <div className="flex items-center gap-2">
                      <Clock className="h-4 w-4 text-purple-500" />
                      Time Allocation
                    </div>
                  </SelectItem>
                  <SelectItem value="vendor">
                    <div className="flex items-center gap-2">
                      <Shield className="h-4 w-4 text-cyan-500" />
                      Vendor Contract
                    </div>
                  </SelectItem>
                </SelectContent>
              </Select>
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="name">Resource Name</Label>
              <Input
                id="name"
                value={formData.name}
                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                placeholder="e.g., Emergency PR Budget"
                data-testid="input-resource-name"
              />
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="description">Description</Label>
              <Textarea
                id="description"
                value={formData.description}
                onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                placeholder="Brief description of the resource..."
                rows={2}
                data-testid="input-resource-description"
              />
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="amount">Allocated Amount</Label>
                <Input
                  id="amount"
                  type="number"
                  value={formData.allocatedAmount}
                  onChange={(e) => setFormData({ ...formData, allocatedAmount: Number(e.target.value) })}
                  placeholder="0"
                  data-testid="input-resource-amount"
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="unit">Unit</Label>
                <Input
                  id="unit"
                  value={formData.unit}
                  onChange={(e) => setFormData({ ...formData, unit: e.target.value })}
                  placeholder={formData.resourceType === 'budget' ? 'USD' : 'hours, units, etc.'}
                  data-testid="input-resource-unit"
                />
              </div>
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="expiryDate">Expiry Date (Optional)</Label>
              <Input
                id="expiryDate"
                type="date"
                value={formData.expiryDate || ''}
                onChange={(e) => setFormData({ ...formData, expiryDate: e.target.value })}
                data-testid="input-resource-expiry"
              />
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="conditions">Approval Conditions</Label>
              <Textarea
                id="conditions"
                value={formData.conditions}
                onChange={(e) => setFormData({ ...formData, conditions: e.target.value })}
                placeholder="Any conditions or restrictions..."
                rows={2}
                data-testid="input-resource-conditions"
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowAddDialog(false)}>
              Cancel
            </Button>
            <Button 
              onClick={handleSubmit}
              disabled={!formData.name || createMutation.isPending || updateMutation.isPending}
              data-testid="button-save-resource"
            >
              {(createMutation.isPending || updateMutation.isPending) ? (
                <>
                  <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                  Saving...
                </>
              ) : (
                editingResource ? 'Save Changes' : 'Add Resource'
              )}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </Card>
  );
}


========================================
FILE: client/src/components/execution/PreFlightChecklist.tsx
========================================
import { useQuery } from "@tanstack/react-query";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { AlertCircle, AlertTriangle, CheckCircle2, Info, Shield, Users, Clock, Link2 } from "lucide-react";
import { Skeleton } from "@/components/ui/skeleton";
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion";

interface PreFlightWarning {
  severity: 'info' | 'warning' | 'critical' | 'blocking';
  category: 'resource' | 'compliance' | 'timing' | 'dependencies';
  title: string;
  message: string;
  affectedTasks: string[];
  suggestedAction: string;
  estimatedDelay?: number;
}

interface PreFlightCheckResult {
  canProceed: boolean;
  warnings: PreFlightWarning[];
  readinessScore: number;
  estimatedCompletionTime: number;
  criticalIssues: number;
  metadata: {
    totalTasks: number;
    rolesRequired: number;
    rolesAvailable: number;
    complianceIssues: number;
  };
}

interface PreFlightChecklistProps {
  executionPlanId: string;
  organizationId: string;
  onReadyChange?: (canProceed: boolean, score: number) => void;
}

const severityConfig = {
  blocking: { icon: AlertCircle, color: "text-red-500", bg: "bg-red-500/10", badge: "destructive" as const },
  critical: { icon: AlertTriangle, color: "text-orange-500", bg: "bg-orange-500/10", badge: "destructive" as const },
  warning: { icon: AlertTriangle, color: "text-yellow-500", bg: "bg-yellow-500/10", badge: "secondary" as const },
  info: { icon: Info, color: "text-blue-500", bg: "bg-blue-500/10", badge: "outline" as const },
};

const categoryConfig = {
  resource: { icon: Users, label: "Resource" },
  compliance: { icon: Shield, label: "Compliance" },
  timing: { icon: Clock, label: "Timing" },
  dependencies: { icon: Link2, label: "Dependencies" },
};

export function PreFlightChecklist({ executionPlanId, organizationId, onReadyChange }: PreFlightChecklistProps) {
  const { data: result, isLoading, error } = useQuery<PreFlightCheckResult>({
    queryKey: ['/api/execution/preflight', executionPlanId],
    enabled: !!executionPlanId && !!organizationId,
    refetchInterval: 30000,
  });

  if (result && onReadyChange) {
    onReadyChange(result.canProceed, result.readinessScore);
  }

  if (isLoading) {
    return (
      <Card data-testid="preflight-loading">
        <CardHeader>
          <Skeleton className="h-6 w-48" />
          <Skeleton className="h-4 w-64" />
        </CardHeader>
        <CardContent className="space-y-4">
          <Skeleton className="h-4 w-full" />
          <Skeleton className="h-20 w-full" />
        </CardContent>
      </Card>
    );
  }

  if (error) {
    return (
      <Card data-testid="preflight-error">
        <CardContent className="py-6">
          <div className="flex items-center gap-2 text-red-500">
            <AlertCircle className="h-5 w-5" />
            <span>Failed to load pre-flight check results</span>
          </div>
        </CardContent>
      </Card>
    );
  }

  if (!result) {
    return null;
  }

  const scoreColor = result.readinessScore >= 80 
    ? "text-green-500" 
    : result.readinessScore >= 50 
      ? "text-yellow-500" 
      : "text-red-500";

  const groupedWarnings = result.warnings.reduce((acc, warning) => {
    if (!acc[warning.category]) {
      acc[warning.category] = [];
    }
    acc[warning.category].push(warning);
    return acc;
  }, {} as Record<string, PreFlightWarning[]>);

  return (
    <Card data-testid="preflight-checklist">
      <CardHeader>
        <div className="flex items-center justify-between">
          <div>
            <CardTitle className="flex items-center gap-2">
              <Shield className="h-5 w-5" />
              Pre-Flight Check
            </CardTitle>
            <CardDescription>
              Verifying readiness for activation
            </CardDescription>
          </div>
          <div className="text-right">
            <div className={`text-3xl font-bold ${scoreColor}`} data-testid="readiness-score">
              {result.readinessScore}%
            </div>
            <div className="text-sm text-muted-foreground">Readiness Score</div>
          </div>
        </div>
      </CardHeader>
      <CardContent className="space-y-6">
        <Progress 
          value={result.readinessScore} 
          className="h-2"
          data-testid="readiness-progress"
        />

        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div className="text-center p-3 rounded-lg bg-muted/50" data-testid="stat-tasks">
            <div className="text-2xl font-semibold">{result.metadata.totalTasks}</div>
            <div className="text-xs text-muted-foreground">Total Tasks</div>
          </div>
          <div className="text-center p-3 rounded-lg bg-muted/50" data-testid="stat-roles">
            <div className="text-2xl font-semibold">
              {result.metadata.rolesAvailable}/{result.metadata.rolesRequired}
            </div>
            <div className="text-xs text-muted-foreground">Roles Ready</div>
          </div>
          <div className="text-center p-3 rounded-lg bg-muted/50" data-testid="stat-time">
            <div className="text-2xl font-semibold">{result.estimatedCompletionTime}</div>
            <div className="text-xs text-muted-foreground">Est. Minutes</div>
          </div>
          <div className="text-center p-3 rounded-lg bg-muted/50" data-testid="stat-issues">
            <div className={`text-2xl font-semibold ${result.criticalIssues > 0 ? 'text-red-500' : 'text-green-500'}`}>
              {result.criticalIssues}
            </div>
            <div className="text-xs text-muted-foreground">Critical Issues</div>
          </div>
        </div>

        <div className="flex items-center gap-2 p-3 rounded-lg" style={{ backgroundColor: result.canProceed ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)' }}>
          {result.canProceed ? (
            <>
              <CheckCircle2 className="h-5 w-5 text-green-500" />
              <span className="font-medium text-green-700 dark:text-green-400" data-testid="status-ready">
                Ready for Activation
              </span>
            </>
          ) : (
            <>
              <AlertCircle className="h-5 w-5 text-red-500" />
              <span className="font-medium text-red-700 dark:text-red-400" data-testid="status-blocked">
                Activation Blocked - Resolve Issues Below
              </span>
            </>
          )}
        </div>

        {result.warnings.length > 0 && (
          <div className="space-y-2">
            <h4 className="font-medium text-sm text-muted-foreground uppercase tracking-wide">
              Issues & Warnings ({result.warnings.length})
            </h4>
            <Accordion type="multiple" className="space-y-2">
              {Object.entries(groupedWarnings).map(([category, warnings]) => {
                const config = categoryConfig[category as keyof typeof categoryConfig];
                const CategoryIcon = config?.icon || AlertTriangle;
                return (
                  <AccordionItem 
                    key={category} 
                    value={category}
                    className="border rounded-lg px-4"
                    data-testid={`warning-category-${category}`}
                  >
                    <AccordionTrigger className="hover:no-underline">
                      <div className="flex items-center gap-2">
                        <CategoryIcon className="h-4 w-4" />
                        <span>{config?.label || category}</span>
                        <Badge variant="secondary" className="ml-2">
                          {warnings.length}
                        </Badge>
                      </div>
                    </AccordionTrigger>
                    <AccordionContent>
                      <div className="space-y-3 pt-2">
                        {warnings.map((warning, idx) => {
                          const sevConfig = severityConfig[warning.severity];
                          const SeverityIcon = sevConfig.icon;
                          return (
                            <div 
                              key={idx} 
                              className={`p-3 rounded-lg ${sevConfig.bg}`}
                              data-testid={`warning-item-${category}-${idx}`}
                            >
                              <div className="flex items-start gap-2">
                                <SeverityIcon className={`h-4 w-4 mt-0.5 ${sevConfig.color}`} />
                                <div className="flex-1">
                                  <div className="flex items-center gap-2">
                                    <span className="font-medium">{warning.title}</span>
                                    <Badge variant={sevConfig.badge} className="text-xs">
                                      {warning.severity}
                                    </Badge>
                                  </div>
                                  <p className="text-sm text-muted-foreground mt-1">
                                    {warning.message}
                                  </p>
                                  {warning.suggestedAction && (
                                    <p className="text-sm mt-2 font-medium">
                                      Suggested: {warning.suggestedAction}
                                    </p>
                                  )}
                                  {warning.affectedTasks.length > 0 && (
                                    <div className="mt-2 flex flex-wrap gap-1">
                                      {warning.affectedTasks.map((task, i) => (
                                        <Badge key={i} variant="outline" className="text-xs">
                                          {task}
                                        </Badge>
                                      ))}
                                    </div>
                                  )}
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </AccordionContent>
                  </AccordionItem>
                );
              })}
            </Accordion>
          </div>
        )}

        {result.warnings.length === 0 && (
          <div className="text-center py-4 text-muted-foreground" data-testid="no-warnings">
            <CheckCircle2 className="h-8 w-8 mx-auto mb-2 text-green-500" />
            <p>All pre-flight checks passed</p>
          </div>
        )}
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/execution/SyncManagerPanel.tsx
========================================
import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Progress } from '@/components/ui/progress';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Switch } from '@/components/ui/switch';
import { Label } from '@/components/ui/label';
import { 
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Input } from '@/components/ui/input';
import { 
  RefreshCw, 
  Check, 
  X, 
  Clock, 
  AlertTriangle,
  Cloud,
  CloudOff,
  Download,
  Settings,
  Play,
  Pause,
  Link2,
  FileSpreadsheet,
  FileJson,
  FileText,
  ExternalLink,
  ChevronRight,
  CheckCircle2,
  XCircle,
  Loader2,
  Plug,
  PlugZap,
} from 'lucide-react';
import { SiJira, SiAsana } from 'react-icons/si';
import { cn } from '@/lib/utils';
import { apiRequest, queryClient } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';
import { format, formatDistanceToNow } from 'date-fns';

interface SyncManagerPanelProps {
  executionInstanceId?: string;
  scenarioId?: string;
  organizationId?: string;
  onExport?: (format: string, data: any) => void;
}

interface SyncPlatform {
  id: string;
  name: string;
  icon: string;
  description: string;
}

interface EnterpriseIntegration {
  id: string;
  organizationId: string;
  vendor: string;
  name: string;
  status: string;
  configuration: Record<string, any>;
  lastSyncAt?: Date;
  createdAt?: Date;
}

interface SyncRecord {
  id: string;
  executionInstanceId: string;
  platform: string;
  externalProjectId?: string;
  status: string;
  tasksMapped: number;
  lastSyncAt?: Date;
  errorMessage?: string;
}

const platformIcons: Record<string, any> = {
  jira: SiJira,
  asana: SiAsana,
  monday: () => <span className="font-bold text-sm">M</span>,
  ms_project: () => <span className="font-bold text-xs">MS</span>,
  servicenow: () => <span className="font-bold text-xs">SN</span>,
};

export function SyncManagerPanel({ 
  executionInstanceId, 
  scenarioId, 
  organizationId,
  onExport 
}: SyncManagerPanelProps) {
  const { toast } = useToast();
  const [activeTab, setActiveTab] = useState('integrations');
  const [showAddIntegration, setShowAddIntegration] = useState(false);
  const [showExportDialog, setShowExportDialog] = useState(false);
  const [selectedPlatform, setSelectedPlatform] = useState<string | null>(null);
  const [syncInProgress, setSyncInProgress] = useState<string | null>(null);
  
  const { data: platforms = [] } = useQuery<SyncPlatform[]>({
    queryKey: ['/api/sync/platforms'],
  });
  
  const { data: integrations = [], isLoading: loadingIntegrations } = useQuery<EnterpriseIntegration[]>({
    queryKey: ['/api/enterprise-integrations', organizationId],
    enabled: !!organizationId,
  });
  
  const { data: syncRecords = [] } = useQuery<SyncRecord[]>({
    queryKey: ['/api/sync/records', executionInstanceId],
    enabled: !!executionInstanceId,
  });
  
  const { data: exportFormats = [] } = useQuery<{ id: string; name: string; description: string; icon: string }[]>({
    queryKey: ['/api/export/formats'],
  });
  
  const testConnectionMutation = useMutation({
    mutationFn: async (integrationId: string) => {
      const response = await apiRequest('POST', `/api/enterprise-integrations/${integrationId}/test`);
      return response.json();
    },
    onSuccess: (data: any, integrationId) => {
      if (data.success) {
        toast({
          title: 'Connection Successful',
          description: data.message || 'Integration is connected and working.',
        });
        queryClient.invalidateQueries({ queryKey: ['/api/enterprise-integrations'] });
      } else {
        toast({
          title: 'Connection Failed',
          description: data.error || 'Unable to connect. Check your credentials.',
          variant: 'destructive',
        });
      }
    },
    onError: (error) => {
      toast({
        title: 'Connection Test Failed',
        description: error instanceof Error ? error.message : 'An error occurred',
        variant: 'destructive',
      });
    },
  });
  
  const startSyncMutation = useMutation({
    mutationFn: async ({ integrationId, platform }: { integrationId: string; platform: string }) => {
      setSyncInProgress(integrationId);
      const response = await apiRequest('POST', '/api/sync/start', {
        integrationId,
        platform,
        executionInstanceId,
        organizationId,
      });
      return response.json();
    },
    onSuccess: (data) => {
      setSyncInProgress(null);
      toast({
        title: 'Sync Started',
        description: `Syncing execution plan to ${data.platform || 'external platform'}...`,
      });
      queryClient.invalidateQueries({ queryKey: ['/api/sync/records'] });
    },
    onError: (error) => {
      setSyncInProgress(null);
      toast({
        title: 'Sync Failed',
        description: error instanceof Error ? error.message : 'Failed to start sync',
        variant: 'destructive',
      });
    },
  });
  
  const handleExport = async (format: string) => {
    if (!executionInstanceId) {
      toast({
        title: 'No Execution Selected',
        description: 'Please select an active execution to export.',
        variant: 'destructive',
      });
      return;
    }
    
    try {
      window.open(`/api/export/execution/${executionInstanceId}?format=${format}`, '_blank');
      toast({
        title: 'Export Started',
        description: `Downloading execution plan as ${format.toUpperCase()}...`,
      });
      setShowExportDialog(false);
    } catch (error) {
      toast({
        title: 'Export Failed',
        description: error instanceof Error ? error.message : 'Failed to export',
        variant: 'destructive',
      });
    }
  };
  
  const getStatusBadge = (status: string) => {
    const statusConfig: Record<string, { variant: 'default' | 'secondary' | 'destructive' | 'outline'; icon: any }> = {
      active: { variant: 'default', icon: CheckCircle2 },
      connected: { variant: 'default', icon: CheckCircle2 },
      synced: { variant: 'default', icon: Check },
      pending: { variant: 'secondary', icon: Clock },
      syncing: { variant: 'secondary', icon: RefreshCw },
      failed: { variant: 'destructive', icon: XCircle },
      error: { variant: 'destructive', icon: AlertTriangle },
      disconnected: { variant: 'outline', icon: CloudOff },
    };
    
    const config = statusConfig[status] || statusConfig.pending;
    const Icon = config.icon;
    
    return (
      <Badge variant={config.variant} className="flex items-center gap-1">
        <Icon className={cn("h-3 w-3", status === 'syncing' && "animate-spin")} />
        {status.charAt(0).toUpperCase() + status.slice(1)}
      </Badge>
    );
  };
  
  const renderPlatformIcon = (platform: string) => {
    const IconComponent = platformIcons[platform];
    if (IconComponent) {
      return <IconComponent className="h-5 w-5" />;
    }
    return <Cloud className="h-5 w-5" />;
  };
  
  const renderIntegrations = () => {
    if (loadingIntegrations) {
      return (
        <div className="flex items-center justify-center py-8">
          <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
        </div>
      );
    }
    
    if (integrations.length === 0) {
      return (
        <div className="text-center py-8 space-y-4">
          <div className="mx-auto w-12 h-12 rounded-full bg-muted flex items-center justify-center">
            <Plug className="h-6 w-6 text-muted-foreground" />
          </div>
          <div>
            <h3 className="font-medium">No Integrations Connected</h3>
            <p className="text-sm text-muted-foreground mt-1">
              Connect your project management tools to enable automatic sync
            </p>
          </div>
          <Button onClick={() => setShowAddIntegration(true)} data-testid="button-add-first-integration">
            <PlugZap className="h-4 w-4 mr-2" />
            Connect Integration
          </Button>
        </div>
      );
    }
    
    return (
      <div className="space-y-3">
        {integrations.map((integration) => (
          <div 
            key={integration.id}
            className="flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors"
            data-testid={`integration-item-${integration.id}`}
          >
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                {renderPlatformIcon(integration.vendor)}
              </div>
              <div>
                <h4 className="font-medium">{integration.name}</h4>
                <p className="text-sm text-muted-foreground">
                  {platforms.find(p => p.id === integration.vendor)?.description || integration.vendor}
                </p>
              </div>
            </div>
            <div className="flex items-center gap-3">
              {getStatusBadge(integration.status)}
              {integration.lastSyncAt && (
                <span className="text-xs text-muted-foreground">
                  Last sync: {formatDistanceToNow(new Date(integration.lastSyncAt), { addSuffix: true })}
                </span>
              )}
              <div className="flex gap-2">
                <Button 
                  variant="ghost" 
                  size="sm"
                  onClick={() => testConnectionMutation.mutate(integration.id)}
                  disabled={testConnectionMutation.isPending}
                  data-testid={`button-test-connection-${integration.id}`}
                >
                  {testConnectionMutation.isPending ? (
                    <Loader2 className="h-4 w-4 animate-spin" />
                  ) : (
                    <RefreshCw className="h-4 w-4" />
                  )}
                </Button>
                <Button
                  variant="outline"
                  size="sm"
                  onClick={() => startSyncMutation.mutate({ 
                    integrationId: integration.id, 
                    platform: integration.vendor 
                  })}
                  disabled={syncInProgress === integration.id || !executionInstanceId}
                  data-testid={`button-sync-${integration.id}`}
                >
                  {syncInProgress === integration.id ? (
                    <>
                      <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                      Syncing...
                    </>
                  ) : (
                    <>
                      <Play className="h-4 w-4 mr-2" />
                      Sync Now
                    </>
                  )}
                </Button>
              </div>
            </div>
          </div>
        ))}
        
        <Button 
          variant="outline" 
          className="w-full mt-4"
          onClick={() => setShowAddIntegration(true)}
          data-testid="button-add-integration"
        >
          <PlugZap className="h-4 w-4 mr-2" />
          Add Integration
        </Button>
      </div>
    );
  };
  
  const renderSyncHistory = () => {
    if (syncRecords.length === 0) {
      return (
        <div className="text-center py-8">
          <Clock className="h-8 w-8 mx-auto text-muted-foreground mb-3" />
          <h3 className="font-medium">No Sync History</h3>
          <p className="text-sm text-muted-foreground mt-1">
            Sync records will appear here after your first sync
          </p>
        </div>
      );
    }
    
    return (
      <ScrollArea className="h-[400px]">
        <div className="space-y-2">
          {syncRecords.map((record) => (
            <div 
              key={record.id}
              className="flex items-center justify-between p-3 border rounded-lg"
              data-testid={`sync-record-${record.id}`}
            >
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 rounded bg-muted flex items-center justify-center">
                  {renderPlatformIcon(record.platform)}
                </div>
                <div>
                  <div className="flex items-center gap-2">
                    <span className="font-medium text-sm">
                      {platforms.find(p => p.id === record.platform)?.name || record.platform}
                    </span>
                    {getStatusBadge(record.status)}
                  </div>
                  <p className="text-xs text-muted-foreground">
                    {record.tasksMapped} tasks synced
                    {record.externalProjectId && `  Project: ${record.externalProjectId}`}
                  </p>
                </div>
              </div>
              <div className="text-right">
                {record.lastSyncAt && (
                  <span className="text-xs text-muted-foreground">
                    {format(new Date(record.lastSyncAt), 'MMM d, h:mm a')}
                  </span>
                )}
                {record.errorMessage && (
                  <p className="text-xs text-destructive mt-1">{record.errorMessage}</p>
                )}
              </div>
            </div>
          ))}
        </div>
      </ScrollArea>
    );
  };
  
  const renderExportOptions = () => {
    const exportIcons: Record<string, any> = {
      csv: FileSpreadsheet,
      xlsx: FileSpreadsheet,
      json: FileJson,
      ms_project_xml: FileText,
    };
    
    return (
      <div className="grid grid-cols-2 gap-3">
        {exportFormats.map((format) => {
          const Icon = exportIcons[format.id] || FileText;
          return (
            <Button
              key={format.id}
              variant="outline"
              className="h-auto py-4 flex flex-col items-center gap-2"
              onClick={() => handleExport(format.id)}
              data-testid={`button-export-${format.id}`}
            >
              <Icon className="h-6 w-6" />
              <span className="font-medium">{format.name}</span>
              <span className="text-xs text-muted-foreground text-center">
                {format.description}
              </span>
            </Button>
          );
        })}
      </div>
    );
  };
  
  return (
    <Card className="h-full">
      <CardHeader>
        <div className="flex items-center justify-between">
          <div>
            <CardTitle className="flex items-center gap-2">
              <Cloud className="h-5 w-5" />
              Execution Sync Manager
            </CardTitle>
            <CardDescription>
              Sync execution plans to external project management tools
            </CardDescription>
          </div>
          <div className="flex gap-2">
            <Button 
              variant="outline" 
              size="sm"
              onClick={() => setShowExportDialog(true)}
              disabled={!executionInstanceId}
              data-testid="button-open-export"
            >
              <Download className="h-4 w-4 mr-2" />
              Export
            </Button>
          </div>
        </div>
      </CardHeader>
      <CardContent>
        <Tabs value={activeTab} onValueChange={setActiveTab}>
          <TabsList className="grid w-full grid-cols-3">
            <TabsTrigger value="integrations" data-testid="tab-integrations">
              <Link2 className="h-4 w-4 mr-2" />
              Integrations
            </TabsTrigger>
            <TabsTrigger value="history" data-testid="tab-history">
              <Clock className="h-4 w-4 mr-2" />
              Sync History
            </TabsTrigger>
            <TabsTrigger value="settings" data-testid="tab-settings">
              <Settings className="h-4 w-4 mr-2" />
              Settings
            </TabsTrigger>
          </TabsList>
          
          <TabsContent value="integrations" className="mt-4">
            {renderIntegrations()}
          </TabsContent>
          
          <TabsContent value="history" className="mt-4">
            {renderSyncHistory()}
          </TabsContent>
          
          <TabsContent value="settings" className="mt-4 space-y-6">
            <div className="space-y-4">
              <h3 className="font-medium">Sync Preferences</h3>
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <div>
                    <Label htmlFor="auto-sync">Automatic Sync</Label>
                    <p className="text-sm text-muted-foreground">
                      Automatically sync changes when tasks are updated
                    </p>
                  </div>
                  <Switch id="auto-sync" data-testid="switch-auto-sync" />
                </div>
                <div className="flex items-center justify-between">
                  <div>
                    <Label htmlFor="bi-directional">Bi-directional Sync</Label>
                    <p className="text-sm text-muted-foreground">
                      Pull updates from external platforms back into M
                    </p>
                  </div>
                  <Switch id="bi-directional" data-testid="switch-bi-directional" />
                </div>
                <div className="flex items-center justify-between">
                  <div>
                    <Label htmlFor="sync-comments">Sync Comments</Label>
                    <p className="text-sm text-muted-foreground">
                      Include task comments in sync operations
                    </p>
                  </div>
                  <Switch id="sync-comments" data-testid="switch-sync-comments" />
                </div>
              </div>
            </div>
            
            <div className="space-y-4">
              <h3 className="font-medium">Default Export Format</h3>
              <Select defaultValue="csv">
                <SelectTrigger data-testid="select-default-format">
                  <SelectValue placeholder="Select format" />
                </SelectTrigger>
                <SelectContent>
                  {exportFormats.map((format) => (
                    <SelectItem key={format.id} value={format.id}>
                      {format.name}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
          </TabsContent>
        </Tabs>
      </CardContent>
      
      <Dialog open={showAddIntegration} onOpenChange={setShowAddIntegration}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle>Connect Integration</DialogTitle>
            <DialogDescription>
              Select a platform to connect for execution plan sync
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-3 py-4">
            {platforms.map((platform) => (
              <button
                key={platform.id}
                onClick={() => {
                  setSelectedPlatform(platform.id);
                  setShowAddIntegration(false);
                }}
                className={cn(
                  "w-full flex items-center gap-3 p-3 rounded-lg border hover:bg-muted/50 transition-colors text-left",
                  selectedPlatform === platform.id && "border-primary bg-primary/5"
                )}
                data-testid={`platform-option-${platform.id}`}
              >
                <div className="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                  {renderPlatformIcon(platform.id)}
                </div>
                <div className="flex-1">
                  <h4 className="font-medium">{platform.name}</h4>
                  <p className="text-sm text-muted-foreground">{platform.description}</p>
                </div>
                <ChevronRight className="h-5 w-5 text-muted-foreground" />
              </button>
            ))}
          </div>
        </DialogContent>
      </Dialog>
      
      <Dialog open={showExportDialog} onOpenChange={setShowExportDialog}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Export Execution Plan</DialogTitle>
            <DialogDescription>
              Choose a format to download your execution plan
            </DialogDescription>
          </DialogHeader>
          <div className="py-4">
            {renderExportOptions()}
          </div>
        </DialogContent>
      </Dialog>
    </Card>
  );
}


========================================
FILE: client/src/components/scenario/CreateScenarioButton.tsx
========================================
import { useState } from 'react';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Plus, Rocket, Sparkles } from 'lucide-react';
import ScenarioWizard from './ScenarioWizard';
import { useToast } from '@/hooks/use-toast';
import { apiRequest, queryClient } from '@/lib/queryClient';

interface CreateScenarioButtonProps {
  organizationId: string;
  variant?: 'default' | 'outline' | 'ghost';
  size?: 'default' | 'sm' | 'lg';
  className?: string;
}

export default function CreateScenarioButton({ 
  organizationId, 
  variant = 'default',
  size = 'default',
  className = ''
}: CreateScenarioButtonProps) {
  const [isWizardOpen, setIsWizardOpen] = useState(false);
  const { toast } = useToast();

  const handleWizardComplete = async (scenarioData: any) => {
    try {
      const response = await fetch('/api/scenarios/comprehensive', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(scenarioData),
      });
      
      if (!response.ok) throw new Error('Failed to create scenario');
      
      toast({ 
        title: ' Playbook Created Successfully!',
        description: `${scenarioData.name} is now ready for execution`,
      });
      
      setIsWizardOpen(false);
      queryClient.invalidateQueries({ queryKey: ['/api/scenarios'] });
    } catch (error) {
      toast({ 
        title: 'Creation Failed',
        description: 'Failed to create playbook. Please try again.',
        variant: 'destructive',
      });
    }
  };

  return (
    <>
      <Button 
        onClick={() => setIsWizardOpen(true)}
        variant={variant}
        size={size}
        className={`bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white ${className}`}
        data-testid="button-create-scenario"
      >
        <Rocket className="w-4 h-4 mr-2" />
        Create New Playbook
        <Sparkles className="w-4 h-4 ml-2" />
      </Button>

      <Dialog open={isWizardOpen} onOpenChange={setIsWizardOpen}>
        <DialogContent className="max-w-5xl max-h-[90vh] overflow-hidden p-0">
          <DialogHeader className="px-6 pt-6 pb-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20">
            <DialogTitle className="text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3">
              <div className="w-10 h-10 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center">
                <Rocket className="w-6 h-6 text-white" />
              </div>
              Create Championship-Level Playbook
            </DialogTitle>
            <p className="text-sm text-gray-600 dark:text-gray-400 mt-2">
              Build a complete decision operations playbook in 5 strategic phases
            </p>
          </DialogHeader>
          
          <div className="overflow-y-auto max-h-[calc(90vh-120px)]">
            <ScenarioWizard 
              organizationId={organizationId}
              onComplete={handleWizardComplete}
              onCancel={() => setIsWizardOpen(false)}
            />
          </div>
        </DialogContent>
      </Dialog>
    </>
  );
}


========================================
FILE: client/src/components/scenario/ScenarioWizard.tsx
========================================
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import {
  CheckCircle,
  Circle,
  ArrowRight,
  ArrowLeft,
  Target,
  Users,
  Bell,
  BarChart3,
  BookOpen,
  Sparkles
} from 'lucide-react';

// Import wizard phases
import ScenarioContextPhase from './wizard/ScenarioContextPhase';
import StakeholderMatrixPhase from './wizard/StakeholderMatrixPhase';
import TriggerConfigurationPhase from './wizard/TriggerConfigurationPhase';
import ExecutionPlanPhase from './wizard/ExecutionPlanPhase';
import SuccessMetricsPhase from './wizard/SuccessMetricsPhase';
import ReviewPhase from './wizard/ReviewPhase';

type WizardPhase = 'context' | 'stakeholders' | 'triggers' | 'execution' | 'metrics' | 'review';

interface WizardPhaseConfig {
  id: WizardPhase;
  label: string;
  icon: any;
  description: string;
  requiredFields: string[];
}

const WIZARD_PHASES: WizardPhaseConfig[] = [
  {
    id: 'context',
    label: 'Context',
    icon: Target,
    description: 'Define mission, type, and strategic context',
    requiredFields: ['mission', 'scenarioType', 'timeHorizon', 'businessImpactCategory']
  },
  {
    id: 'stakeholders',
    label: 'Stakeholders',
    icon: Users,
    description: 'Map stakeholders, roles, and influence',
    requiredFields: ['stakeholders'] // At least one stakeholder required
  },
  {
    id: 'triggers',
    label: 'Triggers',
    icon: Bell,
    description: 'Configure monitoring signals and alerts',
    requiredFields: ['triggers'] // At least one trigger required
  },
  {
    id: 'execution',
    label: 'Execution Plan',
    icon: Target,
    description: 'Build Work Breakdown Structure with phases and tasks',
    requiredFields: [] // Optional - can proceed without execution plan
  },
  {
    id: 'metrics',
    label: 'Success Metrics',
    icon: BarChart3,
    description: 'Define how success will be measured',
    requiredFields: ['metrics'] // At least one metric required
  },
  {
    id: 'review',
    label: 'Review',
    icon: BookOpen,
    description: 'Review and finalize your scenario',
    requiredFields: []
  }
];

interface ScenarioWizardProps {
  organizationId: string;
  onComplete?: (scenarioData: any) => void;
  onCancel?: () => void;
}

export default function ScenarioWizard({ organizationId, onComplete, onCancel }: ScenarioWizardProps) {
  const [currentPhase, setCurrentPhase] = useState<WizardPhase>('context');
  const [completedPhases, setCompletedPhases] = useState<Set<WizardPhase>>(new Set());
  
  // Wizard data state
  const [scenarioData, setScenarioData] = useState({
    // Phase 1: Context
    name: '',
    description: '',
    mission: '',
    scenarioType: 'operational' as const,
    timeHorizon: 'short_term' as const,
    businessImpactCategory: '',
    primaryBusinessUnit: '',
    impactedProcesses: [] as string[],
    dependencyMap: { upstream: [], downstream: [], external: [] },
    geographicScope: [] as string[],
    regulatoryConstraints: [] as any[],
    complianceWindows: [] as any[],
    narrativeContext: '',
    
    // Phase 2: Stakeholders
    stakeholders: [] as any[],
    
    // Phase 3: Triggers
    triggers: [] as any[],
    
    // Phase 4: Execution Plan
    executionPlan: {
      immediate: [] as any[],
      secondary: [] as any[],
      follow_up: [] as any[],
    },
    
    // Phase 5: Metrics
    metrics: [] as any[],
  });

  const currentPhaseIndex = WIZARD_PHASES.findIndex(p => p.id === currentPhase);
  const currentPhaseConfig = WIZARD_PHASES[currentPhaseIndex];
  const completionPercentage = ((completedPhases.size) / (WIZARD_PHASES.length - 1)) * 100; // Exclude review from calculation

  const updateScenarioData = (updates: Partial<typeof scenarioData>) => {
    setScenarioData(prev => ({ ...prev, ...updates }));
  };

  const isPhaseComplete = (phase: WizardPhase): boolean => {
    const config = WIZARD_PHASES.find(p => p.id === phase);
    if (!config) return false;

    // Check if all required fields are filled
    return config.requiredFields.every(field => {
      const value = scenarioData[field as keyof typeof scenarioData];
      if (Array.isArray(value)) return value.length > 0;
      if (typeof value === 'string') return value.trim().length > 0;
      return !!value;
    });
  };

  const handleNext = () => {
    if (isPhaseComplete(currentPhase)) {
      setCompletedPhases(prev => new Set([...Array.from(prev), currentPhase]));
    }

    if (currentPhaseIndex < WIZARD_PHASES.length - 1) {
      setCurrentPhase(WIZARD_PHASES[currentPhaseIndex + 1].id);
    }
  };

  const handleBack = () => {
    if (currentPhaseIndex > 0) {
      setCurrentPhase(WIZARD_PHASES[currentPhaseIndex - 1].id);
    }
  };

  const handlePhaseClick = (phaseId: WizardPhase) => {
    // Allow jumping to any phase
    setCurrentPhase(phaseId);
  };

  const handleComplete = () => {
    if (onComplete) {
      onComplete({
        ...scenarioData,
        organizationId,
        completionScore: completionPercentage
      });
    }
  };

  const renderPhaseContent = () => {
    switch (currentPhase) {
      case 'context':
        return (
          <ScenarioContextPhase
            data={scenarioData}
            onChange={updateScenarioData}
          />
        );
      case 'stakeholders':
        return (
          <StakeholderMatrixPhase
            data={scenarioData}
            onChange={updateScenarioData}
          />
        );
      case 'triggers':
        return (
          <TriggerConfigurationPhase
            data={scenarioData}
            onChange={updateScenarioData}
            organizationId={organizationId}
          />
        );
      case 'execution':
        return (
          <ExecutionPlanPhase
            data={scenarioData}
            onChange={updateScenarioData}
          />
        );
      case 'metrics':
        return (
          <SuccessMetricsPhase
            data={scenarioData}
            onChange={updateScenarioData}
          />
        );
      case 'review':
        return (
          <ReviewPhase
            data={scenarioData}
            completionScore={completionPercentage}
          />
        );
      default:
        return null;
    }
  };

  const isCurrentPhaseComplete = isPhaseComplete(currentPhase);
  const canProceed = isCurrentPhaseComplete || currentPhase === 'review';

  return (
    <div className="max-w-6xl mx-auto space-y-6">
      {/* Progress Header */}
      <Card className="border-blue-500/30 bg-gradient-to-r from-blue-950/20 to-purple-950/20">
        <CardHeader>
          <div className="flex items-center justify-between mb-4">
            <div>
              <CardTitle className="text-white text-2xl">Complete Scenario Definition</CardTitle>
              <CardDescription className="text-gray-400">
                Build an actionable, executable playbook with complete situation capture
              </CardDescription>
            </div>
            <Badge className="bg-purple-600/20 text-purple-300 border-purple-500/50 px-4 py-2">
              <Sparkles className="h-4 w-4 mr-2" />
              {Math.round(completionPercentage)}% Complete
            </Badge>
          </div>
          
          <div className="space-y-2">
            <div className="flex items-center justify-between text-sm text-gray-400">
              <span>Overall Progress</span>
              <span>{completedPhases.size} of {WIZARD_PHASES.length - 1} phases complete</span>
            </div>
            <Progress value={completionPercentage} className="h-3" />
          </div>
        </CardHeader>
      </Card>

      {/* Phase Navigator */}
      <div className="grid grid-cols-6 gap-3">
        {WIZARD_PHASES.map((phase, index) => {
          const Icon = phase.icon;
          const isComplete = completedPhases.has(phase.id);
          const isCurrent = currentPhase === phase.id;
          const isAccessible = index <= currentPhaseIndex || isComplete;

          return (
            <button
              key={phase.id}
              onClick={() => handlePhaseClick(phase.id)}
              disabled={!isAccessible}
              data-testid={`wizard-phase-${phase.id}`}
              className={`p-4 rounded-lg border-2 transition-all text-left ${
                isCurrent
                  ? 'border-blue-500 bg-blue-950/30 scale-105'
                  : isComplete
                  ? 'border-green-500/50 bg-green-950/20 hover:scale-102'
                  : isAccessible
                  ? 'border-slate-700 bg-slate-900/50 hover:border-slate-600'
                  : 'border-slate-800 bg-slate-900/20 opacity-50 cursor-not-allowed'
              }`}
            >
              <div className="flex items-center gap-2 mb-2">
                {isComplete ? (
                  <CheckCircle className="h-5 w-5 text-green-400" />
                ) : (
                  <Circle className={`h-5 w-5 ${isCurrent ? 'text-blue-400' : 'text-gray-600'}`} />
                )}
                <span className={`text-sm font-semibold ${isCurrent ? 'text-blue-300' : isComplete ? 'text-green-300' : 'text-gray-400'}`}>
                  Phase {index + 1}
                </span>
              </div>
              <div className="flex items-center gap-2 mb-1">
                <Icon className={`h-4 w-4 ${isCurrent ? 'text-blue-400' : isComplete ? 'text-green-400' : 'text-gray-500'}`} />
                <p className={`font-medium text-sm ${isCurrent ? 'text-white' : isComplete ? 'text-gray-300' : 'text-gray-500'}`}>
                  {phase.label}
                </p>
              </div>
              <p className="text-xs text-gray-500 leading-tight">{phase.description}</p>
            </button>
          );
        })}
      </div>

      {/* Phase Content */}
      <Card className="border-slate-700">
        <CardHeader>
          <div className="flex items-center gap-3">
            {(() => {
              const Icon = currentPhaseConfig.icon;
              return <Icon className="h-6 w-6 text-blue-400" />;
            })()}
            <div>
              <CardTitle className="text-white">{currentPhaseConfig.label}</CardTitle>
              <CardDescription>{currentPhaseConfig.description}</CardDescription>
            </div>
          </div>
        </CardHeader>
        <CardContent>
          {renderPhaseContent()}
        </CardContent>
      </Card>

      {/* Navigation Controls */}
      <div className="flex items-center justify-between">
        <div>
          {onCancel && (
            <Button
              variant="ghost"
              onClick={onCancel}
              className="text-gray-400 hover:text-white"
              data-testid="button-cancel-wizard"
            >
              Cancel
            </Button>
          )}
        </div>

        <div className="flex items-center gap-3">
          {currentPhaseIndex > 0 && (
            <Button
              variant="outline"
              onClick={handleBack}
              className="border-slate-600 text-gray-300"
              data-testid="button-wizard-back"
            >
              <ArrowLeft className="h-4 w-4 mr-2" />
              Back
            </Button>
          )}

          {currentPhase !== 'review' ? (
            <Button
              onClick={handleNext}
              disabled={!canProceed}
              className={`${
                canProceed
                  ? 'bg-blue-600 hover:bg-blue-700'
                  : 'bg-slate-700 text-slate-500 cursor-not-allowed'
              } text-white`}
              data-testid="button-wizard-next"
            >
              {isCurrentPhaseComplete ? 'Continue' : 'Skip for Now'}
              <ArrowRight className="h-4 w-4 ml-2" />
            </Button>
          ) : (
            <Button
              onClick={handleComplete}
              className="bg-green-600 hover:bg-green-700 text-white"
              data-testid="button-complete-scenario"
            >
              <CheckCircle className="h-4 w-4 mr-2" />
              Complete & Save Scenario
            </Button>
          )}
        </div>
      </div>
    </div>
  );
}


========================================
FILE: client/src/components/intelligence/AlertCommandCenter.tsx
========================================
/**
 * Alert Command Center
 * 
 * Real-time alert queue with prioritization, acknowledgment, and escalation.
 * Provides executives with actionable intelligence and playbook recommendations.
 */

import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { queryClient, apiRequest } from '@/lib/queryClient';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { useToast } from '@/hooks/use-toast';
import { formatDistanceToNow } from 'date-fns';
import {
  Activity,
  AlertTriangle,
  ArrowRight,
  Bell,
  CheckCircle,
  ChevronRight,
  Clock,
  Eye,
  Filter,
  Play,
  Radio,
  RefreshCw,
  Shield,
  Target,
  TrendingUp,
  X,
  Zap
} from 'lucide-react';

interface StrategicAlert {
  id: string;
  title: string;
  description: string;
  alertType: string;
  severity: 'critical' | 'high' | 'medium' | 'low';
  category: string;
  status: string;
  aiConfidence?: string;
  dataSourcesUsed?: any;
  suggestedActions?: any[];
  recommendedScenario?: string;
  createdAt: string;
  acknowledgedAt?: string;
  acknowledgedBy?: string;
}

interface WeakSignal {
  id: string;
  signalType: string;
  description: string;
  confidence: string;
  timeline: string;
  impact: string;
  source: string;
  status: string;
  detectedAt: string;
}

const SEVERITY_CONFIG = {
  critical: { 
    color: 'bg-red-500', 
    borderColor: 'border-l-red-500',
    bgColor: 'bg-red-500/10',
    textColor: 'text-red-600 dark:text-red-400',
    label: 'Critical'
  },
  high: { 
    color: 'bg-orange-500', 
    borderColor: 'border-l-orange-500',
    bgColor: 'bg-orange-500/10',
    textColor: 'text-orange-600 dark:text-orange-400',
    label: 'High'
  },
  medium: { 
    color: 'bg-yellow-500', 
    borderColor: 'border-l-yellow-500',
    bgColor: 'bg-yellow-500/10',
    textColor: 'text-yellow-600 dark:text-yellow-400',
    label: 'Medium'
  },
  low: { 
    color: 'bg-blue-500', 
    borderColor: 'border-l-blue-500',
    bgColor: 'bg-blue-500/10',
    textColor: 'text-blue-600 dark:text-blue-400',
    label: 'Low'
  }
};

export function AlertCommandCenter() {
  const { toast } = useToast();
  const [selectedAlert, setSelectedAlert] = useState<StrategicAlert | null>(null);
  const [filterSeverity, setFilterSeverity] = useState<string>('all');
  const [filterStatus, setFilterStatus] = useState<string>('active');

  // Fetch alerts
  const { data: alertsResponse, isLoading, refetch } = useQuery<{
    success: boolean;
    data: {
      strategicAlerts: StrategicAlert[];
      weakSignals: WeakSignal[];
    };
  }>({
    queryKey: ['/api/intelligence/alerts'],
    refetchInterval: 30000 // Auto-refresh every 30 seconds
  });

  // Acknowledge alert mutation
  const acknowledgeMutation = useMutation({
    mutationFn: async (alertId: string) => {
      return apiRequest('POST', `/api/intelligence/alerts/${alertId}/acknowledge`, {});
    },
    onSuccess: () => {
      toast({
        title: 'Alert Acknowledged',
        description: 'The alert has been marked as acknowledged.'
      });
      queryClient.invalidateQueries({ queryKey: ['/api/intelligence/alerts'] });
    }
  });

  // Dismiss alert mutation
  const dismissMutation = useMutation({
    mutationFn: async (alertId: string) => {
      return apiRequest('POST', `/api/intelligence/alerts/${alertId}/dismiss`, {});
    },
    onSuccess: () => {
      toast({
        title: 'Alert Dismissed',
        description: 'The alert has been dismissed.'
      });
      queryClient.invalidateQueries({ queryKey: ['/api/intelligence/alerts'] });
    }
  });

  const alerts = alertsResponse?.data?.strategicAlerts || [];
  const weakSignals = alertsResponse?.data?.weakSignals || [];

  // Filter alerts
  const filteredAlerts = alerts.filter(alert => {
    if (filterSeverity !== 'all' && alert.severity !== filterSeverity) return false;
    if (filterStatus !== 'all' && alert.status !== filterStatus) return false;
    return true;
  });

  // Group alerts by severity for the summary
  const alertSummary = {
    critical: alerts.filter(a => a.severity === 'critical' && a.status === 'active').length,
    high: alerts.filter(a => a.severity === 'high' && a.status === 'active').length,
    medium: alerts.filter(a => a.severity === 'medium' && a.status === 'active').length,
    low: alerts.filter(a => a.severity === 'low' && a.status === 'active').length
  };

  return (
    <div className="space-y-6">
      {/* Alert Summary Header */}
      <div className="grid grid-cols-5 gap-4">
        <SummaryCard
          label="Critical"
          count={alertSummary.critical}
          icon={<AlertTriangle className="w-5 h-5" />}
          color="red"
        />
        <SummaryCard
          label="High Priority"
          count={alertSummary.high}
          icon={<Shield className="w-5 h-5" />}
          color="orange"
        />
        <SummaryCard
          label="Medium"
          count={alertSummary.medium}
          icon={<Bell className="w-5 h-5" />}
          color="yellow"
        />
        <SummaryCard
          label="Low"
          count={alertSummary.low}
          icon={<Activity className="w-5 h-5" />}
          color="blue"
        />
        <SummaryCard
          label="Weak Signals"
          count={weakSignals.filter(s => s.status === 'active').length}
          icon={<Radio className="w-5 h-5" />}
          color="purple"
        />
      </div>

      {/* Filters and Refresh */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-3">
          <Select value={filterSeverity} onValueChange={setFilterSeverity}>
            <SelectTrigger className="w-36" data-testid="filter-severity">
              <SelectValue placeholder="Severity" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">All Severities</SelectItem>
              <SelectItem value="critical">Critical</SelectItem>
              <SelectItem value="high">High</SelectItem>
              <SelectItem value="medium">Medium</SelectItem>
              <SelectItem value="low">Low</SelectItem>
            </SelectContent>
          </Select>
          <Select value={filterStatus} onValueChange={setFilterStatus}>
            <SelectTrigger className="w-36" data-testid="filter-status">
              <SelectValue placeholder="Status" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">All Status</SelectItem>
              <SelectItem value="active">Active</SelectItem>
              <SelectItem value="acknowledged">Acknowledged</SelectItem>
              <SelectItem value="dismissed">Dismissed</SelectItem>
            </SelectContent>
          </Select>
        </div>
        <Button 
          variant="outline" 
          size="sm" 
          onClick={() => refetch()}
          data-testid="button-refresh-alerts"
        >
          <RefreshCw className="w-4 h-4 mr-2" />
          Refresh
        </Button>
      </div>

      {/* Main Content */}
      <div className="grid grid-cols-3 gap-6">
        {/* Alert List */}
        <div className="col-span-2">
          <Tabs defaultValue="strategic" className="w-full">
            <TabsList>
              <TabsTrigger value="strategic" data-testid="tab-strategic-alerts">
                Strategic Alerts ({filteredAlerts.length})
              </TabsTrigger>
              <TabsTrigger value="weak" data-testid="tab-weak-signals">
                Weak Signals ({weakSignals.length})
              </TabsTrigger>
            </TabsList>

            <TabsContent value="strategic" className="mt-4">
              {isLoading ? (
                <div className="text-center py-8">
                  <RefreshCw className="w-6 h-6 animate-spin mx-auto mb-2 text-muted-foreground" />
                  <p className="text-muted-foreground">Loading alerts...</p>
                </div>
              ) : filteredAlerts.length === 0 ? (
                <Card>
                  <CardContent className="p-8 text-center">
                    <CheckCircle className="w-12 h-12 mx-auto mb-4 text-emerald-500" />
                    <h4 className="font-semibold mb-2">No Active Alerts</h4>
                    <p className="text-muted-foreground">
                      All systems are operating within normal parameters.
                    </p>
                  </CardContent>
                </Card>
              ) : (
                <ScrollArea className="h-[600px]">
                  <div className="space-y-3 pr-4">
                    {filteredAlerts.map((alert) => (
                      <AlertCard
                        key={alert.id}
                        alert={alert}
                        isSelected={selectedAlert?.id === alert.id}
                        onSelect={() => setSelectedAlert(alert)}
                        onAcknowledge={() => acknowledgeMutation.mutate(alert.id)}
                        onDismiss={() => dismissMutation.mutate(alert.id)}
                      />
                    ))}
                  </div>
                </ScrollArea>
              )}
            </TabsContent>

            <TabsContent value="weak" className="mt-4">
              {weakSignals.length === 0 ? (
                <Card>
                  <CardContent className="p-8 text-center">
                    <Radio className="w-12 h-12 mx-auto mb-4 text-muted-foreground" />
                    <h4 className="font-semibold mb-2">No Weak Signals Detected</h4>
                    <p className="text-muted-foreground">
                      The AI is continuously scanning for early indicators.
                    </p>
                  </CardContent>
                </Card>
              ) : (
                <ScrollArea className="h-[600px]">
                  <div className="space-y-3 pr-4">
                    {weakSignals.map((signal) => (
                      <WeakSignalCard key={signal.id} signal={signal} />
                    ))}
                  </div>
                </ScrollArea>
              )}
            </TabsContent>
          </Tabs>
        </div>

        {/* Alert Details Panel */}
        <div>
          {selectedAlert ? (
            <AlertDetailPanel
              alert={selectedAlert}
              onAcknowledge={() => acknowledgeMutation.mutate(selectedAlert.id)}
              onDismiss={() => dismissMutation.mutate(selectedAlert.id)}
              onClose={() => setSelectedAlert(null)}
            />
          ) : (
            <Card className="h-[600px] flex items-center justify-center">
              <CardContent className="text-center">
                <Eye className="w-12 h-12 mx-auto mb-4 text-muted-foreground" />
                <h4 className="font-semibold mb-2">Select an Alert</h4>
                <p className="text-muted-foreground text-sm">
                  Click on an alert to view details, recommended actions, and playbook suggestions.
                </p>
              </CardContent>
            </Card>
          )}
        </div>
      </div>
    </div>
  );
}

// Summary Card Component
function SummaryCard({
  label,
  count,
  icon,
  color
}: {
  label: string;
  count: number;
  icon: React.ReactNode;
  color: string;
}) {
  const colorClasses: Record<string, string> = {
    red: 'bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/30',
    orange: 'bg-orange-500/10 text-orange-600 dark:text-orange-400 border-orange-500/30',
    yellow: 'bg-yellow-500/10 text-yellow-600 dark:text-yellow-400 border-yellow-500/30',
    blue: 'bg-blue-500/10 text-blue-600 dark:text-blue-400 border-blue-500/30',
    purple: 'bg-purple-500/10 text-purple-600 dark:text-purple-400 border-purple-500/30'
  };

  return (
    <Card className={`border ${colorClasses[color]}`}>
      <CardContent className="p-4">
        <div className="flex items-center justify-between">
          <div className={`p-2 rounded-lg ${colorClasses[color]}`}>
            {icon}
          </div>
          <div className="text-right">
            <div className="text-2xl font-bold">{count}</div>
            <div className="text-xs text-muted-foreground">{label}</div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

// Alert Card Component
function AlertCard({
  alert,
  isSelected,
  onSelect,
  onAcknowledge,
  onDismiss
}: {
  alert: StrategicAlert;
  isSelected: boolean;
  onSelect: () => void;
  onAcknowledge: () => void;
  onDismiss: () => void;
}) {
  const config = SEVERITY_CONFIG[alert.severity] || SEVERITY_CONFIG.medium;

  return (
    <Card 
      className={`cursor-pointer transition-all border-l-4 ${config.borderColor} ${
        isSelected ? 'ring-2 ring-primary' : 'hover:shadow-md'
      }`}
      onClick={onSelect}
      data-testid={`alert-card-${alert.id}`}
    >
      <CardContent className="p-4">
        <div className="flex items-start justify-between mb-2">
          <div className="flex items-center gap-2">
            <Badge className={config.color}>{config.label}</Badge>
            <Badge variant="outline" className="text-xs">{alert.alertType}</Badge>
          </div>
          <div className="flex items-center gap-1 text-xs text-muted-foreground">
            <Clock className="w-3 h-3" />
            {alert.createdAt ? formatDistanceToNow(new Date(alert.createdAt), { addSuffix: true }) : 'Recently'}
          </div>
        </div>
        
        <h4 className="font-semibold mb-1">{alert.title}</h4>
        <p className="text-sm text-muted-foreground line-clamp-2 mb-3">
          {alert.description}
        </p>
        
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            {alert.aiConfidence && (
              <span className="text-xs text-muted-foreground flex items-center gap-1">
                <Target className="w-3 h-3" />
                {(parseFloat(alert.aiConfidence) * 100).toFixed(0)}% confidence
              </span>
            )}
          </div>
          <div className="flex items-center gap-1">
            {alert.status === 'active' && (
              <>
                <Button 
                  variant="ghost" 
                  size="sm"
                  onClick={(e) => { e.stopPropagation(); onAcknowledge(); }}
                  data-testid={`acknowledge-${alert.id}`}
                >
                  <CheckCircle className="w-4 h-4" />
                </Button>
                <Button 
                  variant="ghost" 
                  size="sm"
                  onClick={(e) => { e.stopPropagation(); onDismiss(); }}
                  data-testid={`dismiss-${alert.id}`}
                >
                  <X className="w-4 h-4" />
                </Button>
              </>
            )}
            <ChevronRight className="w-4 h-4 text-muted-foreground" />
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

// Weak Signal Card Component
function WeakSignalCard({ signal }: { signal: WeakSignal }) {
  const impactColors: Record<string, string> = {
    critical: 'border-red-500 bg-red-500/5',
    high: 'border-orange-500 bg-orange-500/5',
    medium: 'border-yellow-500 bg-yellow-500/5',
    low: 'border-blue-500 bg-blue-500/5'
  };

  return (
    <Card className={`border-l-4 ${impactColors[signal.impact] || impactColors.medium}`}>
      <CardContent className="p-4">
        <div className="flex items-start justify-between mb-2">
          <div className="flex items-center gap-2">
            <Radio className="w-4 h-4 text-purple-500" />
            <Badge variant="outline">{signal.signalType}</Badge>
          </div>
          <div className="flex items-center gap-1 text-xs text-muted-foreground">
            <Clock className="w-3 h-3" />
            {signal.detectedAt ? formatDistanceToNow(new Date(signal.detectedAt), { addSuffix: true }) : 'Recently'}
          </div>
        </div>
        
        <p className="text-sm mb-3">{signal.description}</p>
        
        <div className="flex items-center gap-4 text-xs text-muted-foreground">
          <span className="flex items-center gap-1">
            <Target className="w-3 h-3" />
            {signal.confidence}% confidence
          </span>
          <span className="flex items-center gap-1">
            <TrendingUp className="w-3 h-3" />
            {signal.timeline}
          </span>
          <Badge variant={signal.impact === 'critical' || signal.impact === 'high' ? 'destructive' : 'secondary'}>
            {signal.impact} impact
          </Badge>
        </div>
      </CardContent>
    </Card>
  );
}

// Alert Detail Panel
function AlertDetailPanel({
  alert,
  onAcknowledge,
  onDismiss,
  onClose
}: {
  alert: StrategicAlert;
  onAcknowledge: () => void;
  onDismiss: () => void;
  onClose: () => void;
}) {
  const config = SEVERITY_CONFIG[alert.severity] || SEVERITY_CONFIG.medium;

  return (
    <Card className="h-[600px] flex flex-col">
      <CardHeader className={`${config.bgColor} border-b`}>
        <div className="flex items-center justify-between">
          <Badge className={config.color}>{config.label}</Badge>
          <Button variant="ghost" size="sm" onClick={onClose}>
            <X className="w-4 h-4" />
          </Button>
        </div>
        <CardTitle className="text-lg">{alert.title}</CardTitle>
        <CardDescription>{alert.description}</CardDescription>
      </CardHeader>
      
      <ScrollArea className="flex-1">
        <CardContent className="p-4 space-y-6">
          {/* Alert Details */}
          <div className="space-y-3">
            <h4 className="font-medium text-sm">Alert Details</h4>
            <div className="grid grid-cols-2 gap-3 text-sm">
              <div>
                <span className="text-muted-foreground">Type:</span>
                <span className="ml-2">{alert.alertType}</span>
              </div>
              <div>
                <span className="text-muted-foreground">Category:</span>
                <span className="ml-2">{alert.category || 'General'}</span>
              </div>
              <div>
                <span className="text-muted-foreground">Confidence:</span>
                <span className="ml-2">
                  {alert.aiConfidence ? `${(parseFloat(alert.aiConfidence) * 100).toFixed(0)}%` : 'N/A'}
                </span>
              </div>
              <div>
                <span className="text-muted-foreground">Status:</span>
                <span className="ml-2 capitalize">{alert.status}</span>
              </div>
            </div>
          </div>

          {/* Recommended Actions */}
          {alert.suggestedActions && alert.suggestedActions.length > 0 && (
            <div className="space-y-3">
              <h4 className="font-medium text-sm flex items-center gap-2">
                <Target className="w-4 h-4" />
                Recommended Actions
              </h4>
              <div className="space-y-2">
                {alert.suggestedActions.map((action: any, idx: number) => (
                  <div 
                    key={idx}
                    className="p-3 bg-muted rounded-lg flex items-center justify-between"
                  >
                    <span className="text-sm">{action.action || action}</span>
                    <Button variant="ghost" size="sm">
                      <ArrowRight className="w-4 h-4" />
                    </Button>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Recommended Playbook */}
          {alert.recommendedScenario && (
            <div className="space-y-3">
              <h4 className="font-medium text-sm flex items-center gap-2">
                <Play className="w-4 h-4" />
                Recommended Playbook
              </h4>
              <Card className="border-primary/50 bg-primary/5">
                <CardContent className="p-4">
                  <div className="flex items-center justify-between">
                    <div>
                      <div className="font-medium">{alert.recommendedScenario}</div>
                      <p className="text-xs text-muted-foreground">
                        Pre-configured response for this alert type
                      </p>
                    </div>
                    <Button size="sm" data-testid="button-activate-playbook">
                      <Zap className="w-4 h-4 mr-1" />
                      Activate
                    </Button>
                  </div>
                </CardContent>
              </Card>
            </div>
          )}

          {/* Data Sources */}
          {alert.dataSourcesUsed && (
            <div className="space-y-3">
              <h4 className="font-medium text-sm">Data Sources</h4>
              <div className="flex flex-wrap gap-2">
                {(Array.isArray(alert.dataSourcesUsed) 
                  ? alert.dataSourcesUsed 
                  : [alert.dataSourcesUsed]
                ).map((source: any, idx: number) => (
                  <Badge key={idx} variant="outline">
                    {typeof source === 'string' ? source : source.name || 'Unknown'}
                  </Badge>
                ))}
              </div>
            </div>
          )}
        </CardContent>
      </ScrollArea>

      {/* Actions Footer */}
      {alert.status === 'active' && (
        <div className="p-4 border-t flex gap-2">
          <Button 
            variant="outline" 
            className="flex-1"
            onClick={onAcknowledge}
            data-testid="button-acknowledge-detail"
          >
            <CheckCircle className="w-4 h-4 mr-2" />
            Acknowledge
          </Button>
          <Button 
            variant="outline" 
            className="flex-1"
            onClick={onDismiss}
            data-testid="button-dismiss-detail"
          >
            <X className="w-4 h-4 mr-2" />
            Dismiss
          </Button>
        </div>
      )}
    </Card>
  );
}

export default AlertCommandCenter;


========================================
FILE: client/src/components/intelligence/SignalControlCenter.tsx
========================================
/**
 * Signal Control Center
 * 
 * Configuration dashboard for all 16 intelligence signal categories.
 * Provides visual status indicators, trigger configuration, and alert management.
 */

import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { queryClient, apiRequest } from '@/lib/queryClient';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Progress } from '@/components/ui/progress';
import { 
  Activity, 
  AlertTriangle, 
  Bell, 
  CheckCircle, 
  ChevronRight,
  Database,
  Eye,
  Filter,
  Grid3X3,
  Layers,
  LineChart,
  Play,
  Plus,
  Radio,
  Search,
  Settings,
  Shield,
  TrendingUp,
  Zap
} from 'lucide-react';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { TriggerBuilder } from './TriggerBuilder';

interface SignalCategory {
  id: string;
  name: string;
  description: string;
  phase: 'external' | 'internal';
  icon: string;
  color: string;
  dataPoints: DataPoint[];
  dataSources: string[];
  recommendedPlaybooks: string[];
}

interface DataPoint {
  id: string;
  name: string;
  description: string;
  metric: string;
  sources: string[];
  refreshInterval: string;
  defaultThreshold?: {
    operator: string;
    value: number;
    urgency: 'critical' | 'high' | 'medium' | 'low';
  };
}

interface SignalCategoryStatus {
  categoryId: string;
  categoryName: string;
  status: 'active' | 'warning' | 'alert' | 'inactive';
  activeAlerts: number;
  healthScore: number;
}

interface DashboardData {
  totalSignals: number;
  activeAlerts: number;
  criticalAlerts: number;
  triggersConfigured: number;
  dataSourcesConnected: number;
  categories: SignalCategoryStatus[];
  recentAlerts: any[];
  weakSignals: any[];
}

const CATEGORY_ICONS: Record<string, any> = {
  'competitive': Shield,
  'market': TrendingUp,
  'financial': LineChart,
  'regulatory': AlertTriangle,
  'supply-chain': Layers,
  'customer': Eye,
  'talent': Activity,
  'technology': Zap,
  'media': Radio,
  'geopolitical': Grid3X3,
  'economic': Database,
  'partnership': CheckCircle,
  'cybersecurity': Shield,
  'operational': Settings,
  'esg': Activity,
  'innovation': Plus
};

const PHASE_COLORS = {
  external: 'from-blue-600 to-cyan-600',
  internal: 'from-purple-600 to-pink-600'
};

const STATUS_COLORS = {
  active: 'bg-emerald-500',
  warning: 'bg-amber-500',
  alert: 'bg-red-500',
  inactive: 'bg-gray-400'
};

const STATUS_TEXT = {
  active: 'Nominal',
  warning: 'Attention',
  alert: 'Critical',
  inactive: 'Inactive'
};

export function SignalControlCenter() {
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedPhase, setSelectedPhase] = useState<'all' | 'external' | 'internal'>('all');
  const [selectedCategory, setSelectedCategory] = useState<SignalCategory | null>(null);

  // Fetch signal catalog
  const { data: catalogResponse, isLoading: catalogLoading } = useQuery<{
    success: boolean;
    data: SignalCategory[];
    meta: { totalCategories: number; totalDataPoints: number; externalSignals: number; internalSignals: number; triggerTemplates: number };
  }>({
    queryKey: ['/api/intelligence/catalog']
  });

  // Fetch dashboard data
  const { data: dashboardResponse, isLoading: dashboardLoading } = useQuery<{
    success: boolean;
    data: DashboardData;
  }>({
    queryKey: ['/api/intelligence/dashboard']
  });

  const catalog: SignalCategory[] = catalogResponse?.data || [];
  const dashboard: DashboardData = dashboardResponse?.data || {
    totalSignals: 0,
    activeAlerts: 0,
    criticalAlerts: 0,
    triggersConfigured: 0,
    dataSourcesConnected: 0,
    categories: [],
    recentAlerts: [],
    weakSignals: []
  };
  const statistics = catalogResponse?.meta || {
    totalCategories: 16,
    totalDataPoints: 200,
    externalSignals: 9,
    internalSignals: 7,
    triggerTemplates: 12
  };

  // Filter categories based on search and phase
  const filteredCategories = catalog.filter(cat => {
    const matchesSearch = cat.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                         cat.description.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesPhase = selectedPhase === 'all' || cat.phase === selectedPhase;
    return matchesSearch && matchesPhase;
  });

  const externalCategories = filteredCategories.filter(c => c.phase === 'external');
  const internalCategories = filteredCategories.filter(c => c.phase === 'internal');

  // Get status for a category
  const getCategoryStatus = (categoryId: string): SignalCategoryStatus | undefined => {
    return dashboard.categories?.find(c => c.categoryId === categoryId);
  };

  if (catalogLoading) {
    return (
      <div className="flex items-center justify-center h-96">
        <div className="text-center">
          <div className="animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"></div>
          <p className="text-muted-foreground">Loading Signal Control Center...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header Metrics */}
      <div className="grid grid-cols-5 gap-4">
        <MetricCard
          label="Signal Sources"
          value={statistics.totalDataPoints}
          icon={<Database className="w-5 h-5" />}
          trend="+12 this week"
          color="blue"
        />
        <MetricCard
          label="Active Alerts"
          value={dashboard.activeAlerts}
          icon={<Bell className="w-5 h-5" />}
          trend={dashboard.criticalAlerts > 0 ? `${dashboard.criticalAlerts} critical` : "All clear"}
          color={dashboard.criticalAlerts > 0 ? "red" : "green"}
        />
        <MetricCard
          label="Triggers Configured"
          value={dashboard.triggersConfigured}
          icon={<Zap className="w-5 h-5" />}
          trend="8 active"
          color="purple"
        />
        <MetricCard
          label="Data Sources"
          value={dashboard.dataSourcesConnected}
          icon={<Layers className="w-5 h-5" />}
          trend="All connected"
          color="cyan"
        />
        <MetricCard
          label="Signal Categories"
          value={statistics.totalCategories}
          icon={<Grid3X3 className="w-5 h-5" />}
          trend="16 monitored"
          color="amber"
        />
      </div>

      {/* Search and Filter Bar */}
      <div className="flex items-center gap-4">
        <div className="relative flex-1">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" />
          <Input
            placeholder="Search signal categories..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="pl-10"
            data-testid="input-search-signals"
          />
        </div>
        <div className="flex gap-2">
          <Button
            variant={selectedPhase === 'all' ? 'default' : 'outline'}
            size="sm"
            onClick={() => setSelectedPhase('all')}
            data-testid="button-filter-all"
          >
            All ({statistics.totalCategories})
          </Button>
          <Button
            variant={selectedPhase === 'external' ? 'default' : 'outline'}
            size="sm"
            onClick={() => setSelectedPhase('external')}
            data-testid="button-filter-external"
          >
            External ({statistics.externalSignals})
          </Button>
          <Button
            variant={selectedPhase === 'internal' ? 'default' : 'outline'}
            size="sm"
            onClick={() => setSelectedPhase('internal')}
            data-testid="button-filter-internal"
          >
            Internal ({statistics.internalSignals})
          </Button>
        </div>
      </div>

      {/* Main Content */}
      <Tabs defaultValue="categories" className="w-full">
        <TabsList>
          <TabsTrigger value="categories" data-testid="tab-categories">Signal Categories</TabsTrigger>
          <TabsTrigger value="alerts" data-testid="tab-alerts">Active Alerts ({dashboard.activeAlerts})</TabsTrigger>
          <TabsTrigger value="triggers" data-testid="tab-triggers">Triggers</TabsTrigger>
          <TabsTrigger value="sources" data-testid="tab-sources">Data Sources</TabsTrigger>
        </TabsList>

        <TabsContent value="categories" className="mt-4">
          {selectedCategory ? (
            <CategoryDetailView 
              category={selectedCategory} 
              status={getCategoryStatus(selectedCategory.id)}
              onBack={() => setSelectedCategory(null)} 
            />
          ) : (
            <div className="space-y-6">
              {/* External Intelligence Signals */}
              {externalCategories.length > 0 && (
                <div>
                  <div className="flex items-center gap-2 mb-4">
                    <div className={`h-1 w-8 bg-gradient-to-r ${PHASE_COLORS.external} rounded`}></div>
                    <h3 className="text-lg font-semibold">External Intelligence</h3>
                    <Badge variant="secondary">{externalCategories.length} categories</Badge>
                  </div>
                  <div className="grid grid-cols-3 gap-4">
                    {externalCategories.map(category => (
                      <SignalCategoryCard
                        key={category.id}
                        category={category}
                        status={getCategoryStatus(category.id)}
                        onClick={() => setSelectedCategory(category)}
                      />
                    ))}
                  </div>
                </div>
              )}

              {/* Internal Intelligence Signals */}
              {internalCategories.length > 0 && (
                <div>
                  <div className="flex items-center gap-2 mb-4">
                    <div className={`h-1 w-8 bg-gradient-to-r ${PHASE_COLORS.internal} rounded`}></div>
                    <h3 className="text-lg font-semibold">Internal Intelligence</h3>
                    <Badge variant="secondary">{internalCategories.length} categories</Badge>
                  </div>
                  <div className="grid grid-cols-3 gap-4">
                    {internalCategories.map(category => (
                      <SignalCategoryCard
                        key={category.id}
                        category={category}
                        status={getCategoryStatus(category.id)}
                        onClick={() => setSelectedCategory(category)}
                      />
                    ))}
                  </div>
                </div>
              )}
            </div>
          )}
        </TabsContent>

        <TabsContent value="alerts" className="mt-4">
          <AlertsPanel alerts={dashboard.recentAlerts} weakSignals={dashboard.weakSignals} />
        </TabsContent>

        <TabsContent value="triggers" className="mt-4">
          <TriggersPanel />
        </TabsContent>

        <TabsContent value="sources" className="mt-4">
          <DataSourcesPanel />
        </TabsContent>
      </Tabs>
    </div>
  );
}

// Metric Card Component
function MetricCard({ 
  label, 
  value, 
  icon, 
  trend, 
  color 
}: { 
  label: string; 
  value: number; 
  icon: React.ReactNode; 
  trend: string;
  color: string;
}) {
  const colorClasses: Record<string, string> = {
    blue: 'bg-blue-500/10 text-blue-600 dark:text-blue-400',
    red: 'bg-red-500/10 text-red-600 dark:text-red-400',
    green: 'bg-emerald-500/10 text-emerald-600 dark:text-emerald-400',
    purple: 'bg-purple-500/10 text-purple-600 dark:text-purple-400',
    cyan: 'bg-cyan-500/10 text-cyan-600 dark:text-cyan-400',
    amber: 'bg-amber-500/10 text-amber-600 dark:text-amber-400'
  };

  return (
    <Card>
      <CardContent className="p-4">
        <div className="flex items-center justify-between mb-2">
          <span className="text-sm text-muted-foreground">{label}</span>
          <div className={`p-2 rounded-lg ${colorClasses[color]}`}>
            {icon}
          </div>
        </div>
        <div className="text-2xl font-bold">{value}</div>
        <div className="text-xs text-muted-foreground mt-1">{trend}</div>
      </CardContent>
    </Card>
  );
}

// Signal Category Card
function SignalCategoryCard({ 
  category, 
  status, 
  onClick 
}: { 
  category: SignalCategory; 
  status?: SignalCategoryStatus;
  onClick: () => void;
}) {
  const IconComponent = CATEGORY_ICONS[category.id] || Activity;
  const currentStatus = status?.status || 'active';
  const healthScore = status?.healthScore || Math.floor(Math.random() * 30) + 70;

  return (
    <Card 
      className="cursor-pointer transition-all hover:shadow-lg hover:scale-[1.02] hover:border-primary/50"
      onClick={onClick}
      data-testid={`card-signal-${category.id}`}
    >
      <CardContent className="p-4">
        <div className="flex items-start justify-between mb-3">
          <div className={`p-2 rounded-lg bg-gradient-to-r ${PHASE_COLORS[category.phase]} text-white`}>
            <IconComponent className="w-5 h-5" />
          </div>
          <div className="flex items-center gap-2">
            <div className={`w-2 h-2 rounded-full ${STATUS_COLORS[currentStatus]}`}></div>
            <span className="text-xs text-muted-foreground">{STATUS_TEXT[currentStatus]}</span>
          </div>
        </div>
        
        <h4 className="font-semibold mb-1">{category.name}</h4>
        <p className="text-xs text-muted-foreground line-clamp-2 mb-3">
          {category.description}
        </p>

        <div className="space-y-2">
          <div className="flex items-center justify-between text-xs">
            <span className="text-muted-foreground">Health Score</span>
            <span className="font-medium">{healthScore}%</span>
          </div>
          <Progress value={healthScore} className="h-1.5" />
        </div>

        <div className="flex items-center justify-between mt-3 pt-3 border-t">
          <div className="flex items-center gap-1 text-xs text-muted-foreground">
            <Database className="w-3 h-3" />
            <span>{category.dataPoints.length} data points</span>
          </div>
          <ChevronRight className="w-4 h-4 text-muted-foreground" />
        </div>
      </CardContent>
    </Card>
  );
}

// Category Detail View
function CategoryDetailView({ 
  category, 
  status,
  onBack 
}: { 
  category: SignalCategory; 
  status?: SignalCategoryStatus;
  onBack: () => void;
}) {
  const IconComponent = CATEGORY_ICONS[category.id] || Activity;
  const healthScore = status?.healthScore || 85;
  
  const dataPoints = category.dataPoints || [];
  const dataSources = category.dataSources || [];
  const recommendedPlaybooks = category.recommendedPlaybooks || [];

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center gap-4">
        <Button variant="ghost" size="sm" onClick={onBack} data-testid="button-back">
           Back to Categories
        </Button>
      </div>

      <div className="flex items-start gap-6">
        <div className={`p-4 rounded-xl bg-gradient-to-r ${PHASE_COLORS[category.phase]} text-white`}>
          <IconComponent className="w-8 h-8" />
        </div>
        <div className="flex-1">
          <div className="flex items-center gap-3 mb-2">
            <h2 className="text-2xl font-bold">{category.name}</h2>
            <Badge variant={category.phase === 'external' ? 'default' : 'secondary'}>
              {category.phase}
            </Badge>
          </div>
          <p className="text-muted-foreground">{category.description}</p>
        </div>
        <div className="text-right">
          <div className="text-3xl font-bold text-primary">{healthScore}%</div>
          <div className="text-sm text-muted-foreground">Health Score</div>
        </div>
      </div>

      {/* Data Points */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Database className="w-5 h-5" />
            Data Points ({dataPoints.length})
          </CardTitle>
          <CardDescription>
            Signals monitored in this category
          </CardDescription>
        </CardHeader>
        <CardContent>
          <ScrollArea className="h-[400px] pr-4">
            <div className="space-y-3">
              {dataPoints.length > 0 ? dataPoints.map((dp, idx) => (
                <div 
                  key={dp.id} 
                  className="p-4 rounded-lg border bg-card hover:bg-accent/50 transition-colors"
                  data-testid={`datapoint-${dp.id}`}
                >
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-medium">{dp.name}</span>
                        {dp.defaultThreshold && (
                          <Badge variant={dp.defaultThreshold.urgency === 'critical' ? 'destructive' : 'outline'} className="text-xs">
                            {dp.defaultThreshold.urgency}
                          </Badge>
                        )}
                      </div>
                      <p className="text-sm text-muted-foreground mb-2">{dp.description}</p>
                      <div className="flex items-center gap-4 text-xs text-muted-foreground">
                        <span className="flex items-center gap-1">
                          <Activity className="w-3 h-3" />
                          {dp.metric}
                        </span>
                        <span className="flex items-center gap-1">
                          <Radio className="w-3 h-3" />
                          {dp.refreshInterval}
                        </span>
                      </div>
                    </div>
                    <Button variant="ghost" size="sm" data-testid={`button-configure-${dp.id}`}>
                      <Settings className="w-4 h-4" />
                    </Button>
                  </div>
                </div>
              )) : (
                <div className="text-center py-8 text-muted-foreground">
                  <Database className="w-8 h-8 mx-auto mb-2 opacity-50" />
                  <p>No data points configured for this category yet.</p>
                </div>
              )}
            </div>
          </ScrollArea>
        </CardContent>
      </Card>

      {/* Data Sources and Playbooks */}
      <div className="grid grid-cols-2 gap-4">
        <Card>
          <CardHeader>
            <CardTitle className="text-base flex items-center gap-2">
              <Layers className="w-4 h-4" />
              Data Sources
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="flex flex-wrap gap-2">
              {dataSources.length > 0 ? dataSources.map(source => (
                <Badge key={source} variant="outline">{source}</Badge>
              )) : (
                <span className="text-sm text-muted-foreground">No data sources configured</span>
              )}
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="text-base flex items-center gap-2">
              <Play className="w-4 h-4" />
              Recommended Playbooks
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="flex flex-wrap gap-2">
              {recommendedPlaybooks.length > 0 ? recommendedPlaybooks.map(pb => (
                <Badge key={pb} variant="secondary">{pb}</Badge>
              )) : (
                <span className="text-sm text-muted-foreground">No playbooks recommended yet</span>
              )}
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

// Alerts Panel
function AlertsPanel({ alerts, weakSignals }: { alerts: any[]; weakSignals: any[] }) {
  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <h3 className="font-semibold">Recent Alerts</h3>
        <Button variant="outline" size="sm">
          <Filter className="w-4 h-4 mr-2" />
          Filter
        </Button>
      </div>

      {alerts.length === 0 && weakSignals.length === 0 ? (
        <Card>
          <CardContent className="p-8 text-center">
            <CheckCircle className="w-12 h-12 mx-auto mb-4 text-emerald-500" />
            <h4 className="font-semibold mb-2">All Clear</h4>
            <p className="text-muted-foreground">No active alerts at this time. All signals are within normal parameters.</p>
          </CardContent>
        </Card>
      ) : (
        <div className="space-y-3">
          {alerts.map((alert, idx) => (
            <AlertCard key={alert.id || idx} alert={alert} />
          ))}
          {weakSignals.map((signal, idx) => (
            <WeakSignalCard key={signal.id || idx} signal={signal} />
          ))}
        </div>
      )}
    </div>
  );
}

function AlertCard({ alert }: { alert: any }) {
  const severityColors: Record<string, string> = {
    critical: 'border-red-500 bg-red-500/10',
    high: 'border-amber-500 bg-amber-500/10',
    medium: 'border-blue-500 bg-blue-500/10',
    low: 'border-gray-500 bg-gray-500/10'
  };

  return (
    <Card className={`border-l-4 ${severityColors[alert.severity || 'medium']}`}>
      <CardContent className="p-4">
        <div className="flex items-start justify-between">
          <div>
            <div className="flex items-center gap-2 mb-1">
              <AlertTriangle className="w-4 h-4" />
              <span className="font-medium">{alert.title}</span>
              <Badge variant="outline">{alert.severity}</Badge>
            </div>
            <p className="text-sm text-muted-foreground">{alert.description}</p>
          </div>
          <div className="flex gap-2">
            <Button variant="outline" size="sm" data-testid={`button-acknowledge-${alert.id}`}>
              Acknowledge
            </Button>
            <Button variant="default" size="sm" data-testid={`button-activate-${alert.id}`}>
              Activate Playbook
            </Button>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

function WeakSignalCard({ signal }: { signal: any }) {
  return (
    <Card className="border-l-4 border-purple-500 bg-purple-500/5">
      <CardContent className="p-4">
        <div className="flex items-start justify-between">
          <div>
            <div className="flex items-center gap-2 mb-1">
              <Radio className="w-4 h-4 text-purple-500" />
              <span className="font-medium">Weak Signal Detected</span>
              <Badge variant="outline">{signal.signalType}</Badge>
            </div>
            <p className="text-sm text-muted-foreground">{signal.description}</p>
            <div className="flex items-center gap-4 mt-2 text-xs text-muted-foreground">
              <span>Confidence: {signal.confidence}%</span>
              <span>Timeline: {signal.timeline}</span>
            </div>
          </div>
          <Button variant="ghost" size="sm">
            Investigate
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}

// Triggers Panel
function TriggersPanel() {
  const [showBuilder, setShowBuilder] = useState(false);
  
  const { data: triggersResponse, isLoading } = useQuery<{
    success: boolean;
    data: any[];
  }>({
    queryKey: ['/api/intelligence/triggers']
  });

  const triggers = triggersResponse?.data || [];

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <h3 className="font-semibold">Configured Triggers</h3>
        <Button size="sm" onClick={() => setShowBuilder(true)} data-testid="button-new-trigger">
          <Plus className="w-4 h-4 mr-2" />
          New Trigger
        </Button>
      </div>
      
      {/* Trigger Builder Dialog */}
      <Dialog open={showBuilder} onOpenChange={setShowBuilder}>
        <DialogContent className="max-w-4xl max-h-[90vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Zap className="w-5 h-5 text-amber-500" />
              Create New Trigger
            </DialogTitle>
          </DialogHeader>
          <TriggerBuilder onClose={() => setShowBuilder(false)} />
        </DialogContent>
      </Dialog>

      {isLoading ? (
        <div className="text-center py-8 text-muted-foreground">Loading triggers...</div>
      ) : triggers.length === 0 ? (
        <Card>
          <CardContent className="p-8 text-center">
            <Zap className="w-12 h-12 mx-auto mb-4 text-muted-foreground" />
            <h4 className="font-semibold mb-2">No Triggers Configured</h4>
            <p className="text-muted-foreground mb-4">
              Create triggers to automatically monitor signals and recommend playbook activation.
            </p>
            <Button onClick={() => setShowBuilder(true)} data-testid="button-create-first-trigger">
              <Plus className="w-4 h-4 mr-2" />
              Create First Trigger
            </Button>
          </CardContent>
        </Card>
      ) : (
        <div className="space-y-3">
          {triggers.map((trigger: any) => (
            <Card key={trigger.id}>
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className={`w-2 h-2 rounded-full ${trigger.isActive ? 'bg-emerald-500' : 'bg-gray-400'}`}></div>
                    <div>
                      <span className="font-medium">{trigger.name}</span>
                      <p className="text-sm text-muted-foreground">{trigger.description}</p>
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                    <Badge variant="outline">{trigger.triggerType}</Badge>
                    <Badge>{trigger.alertThreshold}</Badge>
                    <Button variant="ghost" size="sm">
                      <Settings className="w-4 h-4" />
                    </Button>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      )}
    </div>
  );
}

// Data Sources Panel
function DataSourcesPanel() {
  const { data: sourcesResponse, isLoading } = useQuery<{
    success: boolean;
    data: any[];
  }>({
    queryKey: ['/api/intelligence/data-sources']
  });

  const sources = sourcesResponse?.data || [];

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <h3 className="font-semibold">Connected Data Sources</h3>
        <Button size="sm" data-testid="button-connect-source">
          <Plus className="w-4 h-4 mr-2" />
          Connect Source
        </Button>
      </div>

      {isLoading ? (
        <div className="text-center py-8 text-muted-foreground">Loading data sources...</div>
      ) : sources.length === 0 ? (
        <Card>
          <CardContent className="p-8 text-center">
            <Database className="w-12 h-12 mx-auto mb-4 text-muted-foreground" />
            <h4 className="font-semibold mb-2">No Data Sources Connected</h4>
            <p className="text-muted-foreground mb-4">
              Connect enterprise data sources to enable real-time signal monitoring.
            </p>
            <Button data-testid="button-connect-first-source">
              <Plus className="w-4 h-4 mr-2" />
              Connect First Source
            </Button>
          </CardContent>
        </Card>
      ) : (
        <div className="grid grid-cols-2 gap-4">
          {sources.map((source: any) => (
            <Card key={source.id}>
              <CardContent className="p-4">
                <div className="flex items-center justify-between mb-2">
                  <span className="font-medium">{source.name}</span>
                  <div className={`w-2 h-2 rounded-full ${source.isActive ? 'bg-emerald-500' : 'bg-gray-400'}`}></div>
                </div>
                <div className="flex items-center gap-2 text-sm text-muted-foreground">
                  <Badge variant="outline">{source.sourceType}</Badge>
                  {source.category && <Badge variant="secondary">{source.category}</Badge>}
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      )}
    </div>
  );
}

export default SignalControlCenter;


========================================
FILE: client/src/components/intelligence/SignalPlaybookMapper.tsx
========================================
/**
 * Signal-to-Playbook Mapper
 * 
 * Connect triggers to automatic playbook recommendations and activation.
 * Provides a visual interface for mapping signal categories to playbooks.
 */

import { useState } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { queryClient, apiRequest } from '@/lib/queryClient';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Switch } from '@/components/ui/switch';
import { useToast } from '@/hooks/use-toast';
import {
  AlertTriangle,
  ArrowRight,
  CheckCircle,
  ChevronRight,
  Database,
  Filter,
  Link,
  Play,
  Plus,
  Search,
  Settings,
  Target,
  Unlink,
  Zap
} from 'lucide-react';

interface SignalCategory {
  id: string;
  name: string;
  shortName: string;
  description: string;
  phase: 'external' | 'internal';
  color: string;
  recommendedPlaybooks: string[];
  dataPoints: any[];
}

interface PlaybookMapping {
  signalCategoryId: string;
  playbookId: string;
  playbookName: string;
  autoActivate: boolean;
  priority: number;
}

export function SignalPlaybookMapper() {
  const { toast } = useToast();
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);

  // Fetch signal catalog
  const { data: catalogResponse, isLoading: catalogLoading } = useQuery<{
    success: boolean;
    data: SignalCategory[];
  }>({
    queryKey: ['/api/intelligence/catalog']
  });

  // Fetch playbooks - returns array directly
  const { data: playbooksData, isLoading: playbooksLoading } = useQuery<any[]>({
    queryKey: ['/api/scenario-templates']
  });

  const catalog = catalogResponse?.data || [];
  const playbooks = Array.isArray(playbooksData) ? playbooksData : [];
  const isLoading = catalogLoading || playbooksLoading;

  // Filter categories
  const filteredCategories = catalog.filter(cat =>
    cat.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
    cat.description.toLowerCase().includes(searchQuery.toLowerCase())
  );

  // Group playbooks by category for easy lookup
  const playbooksByCategory = playbooks.reduce((acc: Record<string, any[]>, pb: any) => {
    const category = pb.category || 'General';
    if (!acc[category]) acc[category] = [];
    acc[category].push(pb);
    return acc;
  }, {});

  const selectedCategoryData = catalog.find(c => c.id === selectedCategory);

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl font-bold flex items-center gap-2">
            <Link className="w-6 h-6 text-primary" />
            Signal-Playbook Mapping
          </h2>
          <p className="text-muted-foreground">
            Connect intelligence signals to automated playbook recommendations
          </p>
        </div>
        <Button data-testid="button-configure-mappings">
          <Settings className="w-4 h-4 mr-2" />
          Configure Auto-Activation
        </Button>
      </div>

      {/* Summary Stats */}
      <div className="grid grid-cols-4 gap-4">
        <StatCard
          label="Signal Categories"
          value={catalog.length}
          icon={<Database className="w-5 h-5" />}
          color="blue"
        />
        <StatCard
          label="Available Playbooks"
          value={playbooks.length}
          icon={<Play className="w-5 h-5" />}
          color="purple"
        />
        <StatCard
          label="Active Mappings"
          value={catalog.reduce((sum, c) => sum + c.recommendedPlaybooks.length, 0)}
          icon={<Link className="w-5 h-5" />}
          color="green"
        />
        <StatCard
          label="Auto-Activate Enabled"
          value={0}
          icon={<Zap className="w-5 h-5" />}
          color="amber"
        />
      </div>

      {/* Search */}
      <div className="relative">
        <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" />
        <Input
          placeholder="Search signal categories..."
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
          className="pl-10"
          data-testid="input-search-mappings"
        />
      </div>

      {/* Main Content */}
      <div className="grid grid-cols-3 gap-6">
        {/* Signal Categories List */}
        <div className="col-span-1">
          <Card>
            <CardHeader className="pb-3">
              <CardTitle className="text-base">Signal Categories</CardTitle>
              <CardDescription>Select a category to manage playbook mappings</CardDescription>
            </CardHeader>
            <CardContent className="p-0">
              <ScrollArea className="h-[500px]">
                {filteredCategories.map((category) => (
                  <button
                    key={category.id}
                    className={`w-full p-4 text-left border-b hover:bg-muted/50 transition-colors flex items-center gap-3 ${
                      selectedCategory === category.id ? 'bg-primary/10 border-l-4 border-l-primary' : ''
                    }`}
                    onClick={() => setSelectedCategory(category.id)}
                    data-testid={`category-select-${category.id}`}
                  >
                    <div 
                      className="w-3 h-3 rounded-full shrink-0"
                      style={{ backgroundColor: category.color }}
                    ></div>
                    <div className="flex-1 min-w-0">
                      <div className="font-medium truncate">{category.name}</div>
                      <div className="text-xs text-muted-foreground">
                        {category.recommendedPlaybooks.length} playbooks linked
                      </div>
                    </div>
                    <ChevronRight className="w-4 h-4 text-muted-foreground shrink-0" />
                  </button>
                ))}
              </ScrollArea>
            </CardContent>
          </Card>
        </div>

        {/* Mapping Configuration */}
        <div className="col-span-2">
          {selectedCategoryData ? (
            <Card>
              <CardHeader>
                <div className="flex items-center gap-3">
                  <div 
                    className="w-4 h-4 rounded-full"
                    style={{ backgroundColor: selectedCategoryData.color }}
                  ></div>
                  <div>
                    <CardTitle>{selectedCategoryData.name}</CardTitle>
                    <CardDescription>{selectedCategoryData.description}</CardDescription>
                  </div>
                </div>
              </CardHeader>
              <CardContent className="space-y-6">
                {/* Current Mappings */}
                <div className="space-y-3">
                  <div className="flex items-center justify-between">
                    <h4 className="font-medium flex items-center gap-2">
                      <Link className="w-4 h-4" />
                      Linked Playbooks
                    </h4>
                    <Button variant="outline" size="sm" data-testid="button-add-mapping">
                      <Plus className="w-4 h-4 mr-1" />
                      Add Playbook
                    </Button>
                  </div>
                  
                  {selectedCategoryData.recommendedPlaybooks.length === 0 ? (
                    <div className="p-8 text-center border rounded-lg border-dashed">
                      <Unlink className="w-8 h-8 mx-auto mb-2 text-muted-foreground" />
                      <p className="text-muted-foreground text-sm">
                        No playbooks linked to this signal category
                      </p>
                    </div>
                  ) : (
                    <div className="space-y-2">
                      {selectedCategoryData.recommendedPlaybooks.map((playbookName, idx) => (
                        <PlaybookMappingCard
                          key={idx}
                          playbookName={playbookName}
                          signalCategory={selectedCategoryData.name}
                          priority={idx + 1}
                        />
                      ))}
                    </div>
                  )}
                </div>

                {/* Signal Triggers */}
                <div className="space-y-3">
                  <h4 className="font-medium flex items-center gap-2">
                    <AlertTriangle className="w-4 h-4" />
                    Trigger Conditions
                  </h4>
                  <div className="grid grid-cols-2 gap-3">
                    {selectedCategoryData.dataPoints.slice(0, 4).map((dp) => (
                      <div 
                        key={dp.id}
                        className="p-3 border rounded-lg text-sm"
                      >
                        <div className="font-medium mb-1">{dp.name}</div>
                        {dp.defaultThreshold && (
                          <Badge variant="outline" className="text-xs">
                            {dp.defaultThreshold.operator} {dp.defaultThreshold.value}
                          </Badge>
                        )}
                      </div>
                    ))}
                  </div>
                  {selectedCategoryData.dataPoints.length > 4 && (
                    <Button variant="link" size="sm" className="px-0">
                      View all {selectedCategoryData.dataPoints.length} triggers
                      <ArrowRight className="w-4 h-4 ml-1" />
                    </Button>
                  )}
                </div>

                {/* Auto-Activation Settings */}
                <div className="p-4 bg-muted rounded-lg">
                  <div className="flex items-center justify-between mb-3">
                    <div>
                      <h4 className="font-medium">Auto-Activation</h4>
                      <p className="text-sm text-muted-foreground">
                        Automatically recommend playbooks when signals trigger
                      </p>
                    </div>
                    <Switch data-testid="switch-auto-activation" />
                  </div>
                  <div className="text-xs text-muted-foreground">
                    When enabled, M will automatically recommend linked playbooks when any signal in this category triggers an alert.
                  </div>
                </div>
              </CardContent>
            </Card>
          ) : (
            <Card className="h-[500px] flex items-center justify-center">
              <CardContent className="text-center">
                <Target className="w-12 h-12 mx-auto mb-4 text-muted-foreground" />
                <h4 className="font-semibold mb-2">Select a Signal Category</h4>
                <p className="text-muted-foreground text-sm">
                  Choose a signal category from the list to manage its playbook mappings
                </p>
              </CardContent>
            </Card>
          )}
        </div>
      </div>
    </div>
  );
}

// Stat Card Component
function StatCard({
  label,
  value,
  icon,
  color
}: {
  label: string;
  value: number;
  icon: React.ReactNode;
  color: string;
}) {
  const colorClasses: Record<string, string> = {
    blue: 'bg-blue-500/10 text-blue-600 dark:text-blue-400',
    purple: 'bg-purple-500/10 text-purple-600 dark:text-purple-400',
    green: 'bg-emerald-500/10 text-emerald-600 dark:text-emerald-400',
    amber: 'bg-amber-500/10 text-amber-600 dark:text-amber-400'
  };

  return (
    <Card>
      <CardContent className="p-4">
        <div className="flex items-center justify-between">
          <div className={`p-2 rounded-lg ${colorClasses[color]}`}>
            {icon}
          </div>
          <div className="text-right">
            <div className="text-2xl font-bold">{value}</div>
            <div className="text-xs text-muted-foreground">{label}</div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

// Playbook Mapping Card
function PlaybookMappingCard({
  playbookName,
  signalCategory,
  priority
}: {
  playbookName: string;
  signalCategory: string;
  priority: number;
}) {
  return (
    <div className="flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors">
      <div className="flex items-center gap-3">
        <div className="w-6 h-6 rounded-full bg-primary/10 text-primary flex items-center justify-center text-xs font-medium">
          {priority}
        </div>
        <div>
          <div className="font-medium">{playbookName}</div>
          <div className="text-xs text-muted-foreground">
            Linked to {signalCategory} signals
          </div>
        </div>
      </div>
      <div className="flex items-center gap-2">
        <Badge variant="outline">Priority {priority}</Badge>
        <Button variant="ghost" size="sm" data-testid={`button-unlink-${playbookName}`}>
          <Unlink className="w-4 h-4" />
        </Button>
      </div>
    </div>
  );
}

export default SignalPlaybookMapper;


========================================
FILE: client/src/components/intelligence/TriggerBuilder.tsx
========================================
/**
 * Visual Trigger Builder
 * 
 * Drag-and-drop interface for executives to define trigger conditions.
 * Allows selecting signal categories, data points, and configuring thresholds.
 */

import { useState, useEffect } from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { queryClient, apiRequest } from '@/lib/queryClient';
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
import { Switch } from '@/components/ui/switch';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Separator } from '@/components/ui/separator';
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from '@/components/ui/dialog';
import { useToast } from '@/hooks/use-toast';
import { 
  Activity,
  AlertTriangle,
  ArrowRight,
  Check,
  ChevronDown,
  ChevronRight,
  Database,
  GripVertical,
  Layers,
  Link,
  Play,
  Plus,
  Settings,
  Target,
  Trash2,
  X,
  Zap
} from 'lucide-react';

interface SignalCategory {
  id: string;
  name: string;
  shortName: string;
  description: string;
  phase: 'external' | 'internal';
  icon: string;
  color: string;
  dataPoints: DataPoint[];
  recommendedPlaybooks: string[];
}

interface DataPoint {
  id: string;
  name: string;
  description: string;
  metricType: string;
  unit?: string;
  sources: string[];
  defaultThreshold?: {
    operator: string;
    value: number;
    urgency: string;
  };
}

interface SelectedCondition {
  categoryId: string;
  categoryName: string;
  dataPointId: string;
  dataPointName: string;
  operator: string;
  value: string | number;
}

interface TriggerConfig {
  name: string;
  description: string;
  conditions: SelectedCondition[];
  logic: 'any' | 'all' | 'threshold';
  thresholdCount: number;
  urgency: 'critical' | 'high' | 'medium' | 'low';
  playbookIds: string[];
  autoActivate: boolean;
}

const OPERATORS = [
  { value: 'gte', label: '>= (Greater than or equal)', symbol: '' },
  { value: 'gt', label: '> (Greater than)', symbol: '>' },
  { value: 'lte', label: '<= (Less than or equal)', symbol: '' },
  { value: 'lt', label: '< (Less than)', symbol: '<' },
  { value: 'eq', label: '= (Equals)', symbol: '=' },
  { value: 'neq', label: '!= (Not equals)', symbol: '' },
  { value: 'spike', label: 'Spike (Sudden increase)', symbol: '' },
  { value: 'drop', label: 'Drop (Sudden decrease)', symbol: '' },
  { value: 'change', label: 'Any change', symbol: '' },
];

const URGENCY_LEVELS = [
  { value: 'critical', label: 'Critical', color: 'bg-red-500', description: 'Immediate executive action required' },
  { value: 'high', label: 'High', color: 'bg-orange-500', description: 'Requires attention within hours' },
  { value: 'medium', label: 'Medium', color: 'bg-yellow-500', description: 'Review within 24 hours' },
  { value: 'low', label: 'Low', color: 'bg-blue-500', description: 'Informational, weekly review' },
];

export function TriggerBuilder({ 
  onClose, 
  existingTrigger 
}: { 
  onClose?: () => void;
  existingTrigger?: any;
}) {
  const { toast } = useToast();
  const [step, setStep] = useState<'select' | 'configure' | 'review'>('select');
  const [triggerConfig, setTriggerConfig] = useState<TriggerConfig>({
    name: existingTrigger?.name || '',
    description: existingTrigger?.description || '',
    conditions: [],
    logic: 'any',
    thresholdCount: 2,
    urgency: 'high',
    playbookIds: [],
    autoActivate: false
  });
  const [selectedCategory, setSelectedCategory] = useState<SignalCategory | null>(null);
  const [expandedCategories, setExpandedCategories] = useState<Set<string>>(new Set());

  // Fetch signal catalog
  const { data: catalogResponse } = useQuery<{
    success: boolean;
    data: SignalCategory[];
  }>({
    queryKey: ['/api/intelligence/catalog']
  });

  // Fetch trigger templates
  const { data: templatesResponse } = useQuery<{
    success: boolean;
    data: any[];
  }>({
    queryKey: ['/api/intelligence/templates']
  });

  const catalog = catalogResponse?.data || [];
  const templates = templatesResponse?.data || [];

  // Create trigger mutation
  const createTriggerMutation = useMutation({
    mutationFn: async (config: TriggerConfig) => {
      const payload = {
        name: config.name,
        description: config.description,
        signalCategoryId: config.conditions[0]?.categoryId || 'multi',
        dataPointIds: config.conditions.map(c => c.dataPointId),
        logic: config.logic,
        thresholdCount: config.thresholdCount,
        conditions: {
          logic: config.logic,
          conditions: config.conditions.map(c => ({
            categoryId: c.categoryId,
            dataPointId: c.dataPointId,
            operator: c.operator,
            value: c.value
          }))
        },
        urgency: config.urgency,
        playbookIds: config.playbookIds
      };
      return apiRequest('POST', '/api/intelligence/triggers', payload);
    },
    onSuccess: () => {
      toast({
        title: 'Trigger Created',
        description: 'Your trigger has been created and is now monitoring signals.',
      });
      queryClient.invalidateQueries({ queryKey: ['/api/intelligence/triggers'] });
      onClose?.();
    },
    onError: (error) => {
      toast({
        title: 'Error',
        description: 'Failed to create trigger. Please try again.',
        variant: 'destructive'
      });
    }
  });

  const toggleCategory = (categoryId: string) => {
    const newExpanded = new Set(expandedCategories);
    if (newExpanded.has(categoryId)) {
      newExpanded.delete(categoryId);
    } else {
      newExpanded.add(categoryId);
    }
    setExpandedCategories(newExpanded);
  };

  const addCondition = (category: SignalCategory, dataPoint: DataPoint) => {
    const newCondition: SelectedCondition = {
      categoryId: category.id,
      categoryName: category.name,
      dataPointId: dataPoint.id,
      dataPointName: dataPoint.name,
      operator: dataPoint.defaultThreshold?.operator || 'gte',
      value: dataPoint.defaultThreshold?.value || 0
    };
    setTriggerConfig(prev => ({
      ...prev,
      conditions: [...prev.conditions, newCondition]
    }));
  };

  const removeCondition = (index: number) => {
    setTriggerConfig(prev => ({
      ...prev,
      conditions: prev.conditions.filter((_, i) => i !== index)
    }));
  };

  const updateCondition = (index: number, field: keyof SelectedCondition, value: any) => {
    setTriggerConfig(prev => ({
      ...prev,
      conditions: prev.conditions.map((c, i) => 
        i === index ? { ...c, [field]: value } : c
      )
    }));
  };

  const applyTemplate = (template: any) => {
    try {
      const conditions = Array.isArray(template.conditions) 
        ? template.conditions.map((c: any) => {
            const category = catalog.find(cat => cat.id === c.signalCategoryId);
            const dataPoint = category?.dataPoints?.find(dp => dp.id === c.dataPointId);
            return {
              categoryId: c.signalCategoryId || '',
              categoryName: category?.name || c.signalCategoryId || 'Unknown',
              dataPointId: c.dataPointId || '',
              dataPointName: dataPoint?.name || c.dataPointId || 'Unknown Signal',
              operator: c.operator || 'gte',
              value: c.value ?? 0
            };
          })
        : [];
      
      setTriggerConfig(prev => ({
        ...prev,
        name: template.name || '',
        description: template.description || '',
        conditions,
        urgency: template.urgency || 'high',
        playbookIds: template.recommendedPlaybooks || []
      }));
      setStep('configure');
    } catch (error) {
      console.error('Error applying template:', error);
      toast({
        title: 'Template Error',
        description: 'Could not apply this template. Try selecting signals manually.',
        variant: 'destructive'
      });
    }
  };

  const handleSubmit = () => {
    if (!triggerConfig.name) {
      toast({
        title: 'Name Required',
        description: 'Please provide a name for this trigger.',
        variant: 'destructive'
      });
      return;
    }
    if (triggerConfig.conditions.length === 0) {
      toast({
        title: 'Conditions Required',
        description: 'Please add at least one condition to this trigger.',
        variant: 'destructive'
      });
      return;
    }
    createTriggerMutation.mutate(triggerConfig);
  };

  return (
    <div className="space-y-6">
      {/* Progress Steps */}
      <div className="flex items-center justify-between px-4">
        <StepIndicator 
          step={1} 
          label="Select Signals" 
          active={step === 'select'} 
          completed={step !== 'select'}
        />
        <div className="flex-1 h-px bg-border mx-4"></div>
        <StepIndicator 
          step={2} 
          label="Configure Logic" 
          active={step === 'configure'} 
          completed={step === 'review'}
        />
        <div className="flex-1 h-px bg-border mx-4"></div>
        <StepIndicator 
          step={3} 
          label="Review & Create" 
          active={step === 'review'} 
          completed={false}
        />
      </div>

      {/* Step 1: Select Signals */}
      {step === 'select' && (
        <div className="space-y-6">
          {/* Quick Start Templates */}
          {templates.length > 0 && (
            <Card>
              <CardHeader className="pb-3">
                <CardTitle className="text-base flex items-center gap-2">
                  <Zap className="w-4 h-4 text-amber-500" />
                  Quick Start Templates
                </CardTitle>
                <CardDescription>Pre-configured trigger patterns for common scenarios</CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-2 gap-3">
                  {templates.slice(0, 4).map((template) => (
                    <Button
                      key={template.id}
                      variant="outline"
                      className="h-auto p-4 justify-start flex-col items-start"
                      onClick={() => applyTemplate(template)}
                      data-testid={`template-${template.id}`}
                    >
                      <div className="font-medium text-sm">{template.name}</div>
                      <div className="text-xs text-muted-foreground mt-1">{template.description}</div>
                    </Button>
                  ))}
                </div>
              </CardContent>
            </Card>
          )}

          {/* Selected Conditions */}
          {triggerConfig.conditions.length > 0 && (
            <Card className="border-primary/50">
              <CardHeader className="pb-3">
                <CardTitle className="text-base flex items-center gap-2">
                  <Target className="w-4 h-4" />
                  Selected Conditions ({triggerConfig.conditions.length})
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-2">
                  {triggerConfig.conditions.map((condition, index) => (
                    <div 
                      key={index}
                      className="flex items-center justify-between p-3 bg-muted rounded-lg"
                    >
                      <div className="flex items-center gap-3">
                        <GripVertical className="w-4 h-4 text-muted-foreground cursor-move" />
                        <div>
                          <span className="font-medium">{condition.dataPointName}</span>
                          <span className="text-muted-foreground mx-2">
                            {OPERATORS.find(o => o.value === condition.operator)?.symbol || condition.operator}
                          </span>
                          <span className="font-mono">{condition.value}</span>
                        </div>
                        <Badge variant="outline" className="text-xs">
                          {condition.categoryName}
                        </Badge>
                      </div>
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={() => removeCondition(index)}
                        data-testid={`remove-condition-${index}`}
                      >
                        <X className="w-4 h-4" />
                      </Button>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
          )}

          {/* Signal Categories */}
          <Card>
            <CardHeader>
              <CardTitle className="text-base flex items-center gap-2">
                <Database className="w-4 h-4" />
                Signal Categories
              </CardTitle>
              <CardDescription>Select data points to monitor</CardDescription>
            </CardHeader>
            <CardContent>
              <ScrollArea className="h-[400px] pr-4">
                <div className="space-y-2">
                  {catalog.map((category) => (
                    <div key={category.id} className="border rounded-lg overflow-hidden">
                      <button
                        className="w-full flex items-center justify-between p-3 hover:bg-muted transition-colors"
                        onClick={() => toggleCategory(category.id)}
                        data-testid={`category-toggle-${category.id}`}
                      >
                        <div className="flex items-center gap-3">
                          <div 
                            className="w-3 h-3 rounded-full"
                            style={{ backgroundColor: category.color }}
                          ></div>
                          <span className="font-medium">{category.name}</span>
                          <Badge variant="secondary" className="text-xs">
                            {category.dataPoints.length} signals
                          </Badge>
                        </div>
                        {expandedCategories.has(category.id) ? (
                          <ChevronDown className="w-4 h-4" />
                        ) : (
                          <ChevronRight className="w-4 h-4" />
                        )}
                      </button>
                      
                      {expandedCategories.has(category.id) && (
                        <div className="border-t bg-muted/30 p-3 space-y-2">
                          {category.dataPoints.map((dataPoint) => {
                            const isSelected = triggerConfig.conditions.some(
                              c => c.categoryId === category.id && c.dataPointId === dataPoint.id
                            );
                            return (
                              <div
                                key={dataPoint.id}
                                className={`flex items-center justify-between p-2 rounded-lg transition-colors ${
                                  isSelected ? 'bg-primary/10 border border-primary/30' : 'hover:bg-muted'
                                }`}
                              >
                                <div className="flex-1">
                                  <div className="flex items-center gap-2">
                                    <span className="text-sm font-medium">{dataPoint.name}</span>
                                    {dataPoint.defaultThreshold && (
                                      <Badge 
                                        variant="outline" 
                                        className={`text-xs ${
                                          dataPoint.defaultThreshold.urgency === 'critical' ? 'border-red-500 text-red-600' :
                                          dataPoint.defaultThreshold.urgency === 'high' ? 'border-orange-500 text-orange-600' :
                                          'border-gray-500'
                                        }`}
                                      >
                                        {dataPoint.defaultThreshold.urgency}
                                      </Badge>
                                    )}
                                  </div>
                                  <p className="text-xs text-muted-foreground mt-0.5">
                                    {dataPoint.description}
                                  </p>
                                </div>
                                <Button
                                  variant={isSelected ? "secondary" : "outline"}
                                  size="sm"
                                  onClick={() => {
                                    if (isSelected) {
                                      const idx = triggerConfig.conditions.findIndex(
                                        c => c.categoryId === category.id && c.dataPointId === dataPoint.id
                                      );
                                      if (idx >= 0) removeCondition(idx);
                                    } else {
                                      addCondition(category, dataPoint);
                                    }
                                  }}
                                  data-testid={`datapoint-select-${dataPoint.id}`}
                                >
                                  {isSelected ? <Check className="w-4 h-4" /> : <Plus className="w-4 h-4" />}
                                </Button>
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </ScrollArea>
            </CardContent>
          </Card>

          <div className="flex justify-end">
            <Button 
              onClick={() => setStep('configure')}
              disabled={triggerConfig.conditions.length === 0}
              data-testid="button-next-step"
            >
              Configure Logic
              <ArrowRight className="w-4 h-4 ml-2" />
            </Button>
          </div>
        </div>
      )}

      {/* Step 2: Configure Logic */}
      {step === 'configure' && (
        <div className="space-y-6">
          {/* Trigger Details */}
          <Card>
            <CardHeader>
              <CardTitle className="text-base">Trigger Details</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="grid gap-4">
                <div>
                  <Label htmlFor="trigger-name">Trigger Name</Label>
                  <Input
                    id="trigger-name"
                    value={triggerConfig.name}
                    onChange={(e) => setTriggerConfig(prev => ({ ...prev, name: e.target.value }))}
                    placeholder="e.g., Competitor Product Launch Alert"
                    data-testid="input-trigger-name"
                  />
                </div>
                <div>
                  <Label htmlFor="trigger-description">Description</Label>
                  <Textarea
                    id="trigger-description"
                    value={triggerConfig.description}
                    onChange={(e) => setTriggerConfig(prev => ({ ...prev, description: e.target.value }))}
                    placeholder="Describe what this trigger monitors..."
                    rows={2}
                    data-testid="input-trigger-description"
                  />
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Condition Logic */}
          <Card>
            <CardHeader>
              <CardTitle className="text-base flex items-center gap-2">
                <Layers className="w-4 h-4" />
                Condition Logic
              </CardTitle>
              <CardDescription>How should conditions be evaluated?</CardDescription>
            </CardHeader>
            <CardContent>
              <RadioGroup
                value={triggerConfig.logic}
                onValueChange={(value) => setTriggerConfig(prev => ({ 
                  ...prev, 
                  logic: value as 'any' | 'all' | 'threshold' 
                }))}
                className="space-y-3"
              >
                <div className="flex items-start space-x-3 p-3 rounded-lg border hover:bg-muted/50">
                  <RadioGroupItem value="any" id="logic-any" />
                  <div className="flex-1">
                    <Label htmlFor="logic-any" className="font-medium">ANY condition triggers</Label>
                    <p className="text-xs text-muted-foreground">Alert when any single condition is met</p>
                  </div>
                </div>
                <div className="flex items-start space-x-3 p-3 rounded-lg border hover:bg-muted/50">
                  <RadioGroupItem value="all" id="logic-all" />
                  <div className="flex-1">
                    <Label htmlFor="logic-all" className="font-medium">ALL conditions required</Label>
                    <p className="text-xs text-muted-foreground">Alert only when all conditions are met simultaneously</p>
                  </div>
                </div>
                <div className="flex items-start space-x-3 p-3 rounded-lg border hover:bg-muted/50">
                  <RadioGroupItem value="threshold" id="logic-threshold" />
                  <div className="flex-1">
                    <Label htmlFor="logic-threshold" className="font-medium">Threshold (at least N)</Label>
                    <p className="text-xs text-muted-foreground">Alert when a minimum number of conditions are met</p>
                    {triggerConfig.logic === 'threshold' && (
                      <div className="mt-2 flex items-center gap-2">
                        <Input
                          type="number"
                          min={1}
                          max={triggerConfig.conditions.length}
                          value={triggerConfig.thresholdCount}
                          onChange={(e) => setTriggerConfig(prev => ({ 
                            ...prev, 
                            thresholdCount: parseInt(e.target.value) || 1 
                          }))}
                          className="w-20"
                          data-testid="input-threshold-count"
                        />
                        <span className="text-sm text-muted-foreground">
                          of {triggerConfig.conditions.length} conditions
                        </span>
                      </div>
                    )}
                  </div>
                </div>
              </RadioGroup>
            </CardContent>
          </Card>

          {/* Configure Individual Conditions */}
          <Card>
            <CardHeader>
              <CardTitle className="text-base flex items-center gap-2">
                <Settings className="w-4 h-4" />
                Condition Thresholds
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                {triggerConfig.conditions.map((condition, index) => (
                  <div key={index} className="p-4 border rounded-lg space-y-3">
                    <div className="flex items-center justify-between">
                      <div className="font-medium">{condition.dataPointName}</div>
                      <Badge variant="outline">{condition.categoryName}</Badge>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label className="text-xs">Operator</Label>
                        <Select
                          value={condition.operator}
                          onValueChange={(value) => updateCondition(index, 'operator', value)}
                        >
                          <SelectTrigger data-testid={`select-operator-${index}`}>
                            <SelectValue />
                          </SelectTrigger>
                          <SelectContent>
                            {OPERATORS.map((op) => (
                              <SelectItem key={op.value} value={op.value}>
                                <span className="flex items-center gap-2">
                                  <span className="font-mono w-4">{op.symbol}</span>
                                  <span>{op.label}</span>
                                </span>
                              </SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label className="text-xs">Value</Label>
                        <Input
                          type="text"
                          value={condition.value}
                          onChange={(e) => updateCondition(index, 'value', e.target.value)}
                          data-testid={`input-value-${index}`}
                        />
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>

          {/* Urgency Level */}
          <Card>
            <CardHeader>
              <CardTitle className="text-base flex items-center gap-2">
                <AlertTriangle className="w-4 h-4" />
                Alert Urgency
              </CardTitle>
            </CardHeader>
            <CardContent>
              <RadioGroup
                value={triggerConfig.urgency}
                onValueChange={(value) => setTriggerConfig(prev => ({ 
                  ...prev, 
                  urgency: value as 'critical' | 'high' | 'medium' | 'low'
                }))}
                className="grid grid-cols-2 gap-3"
              >
                {URGENCY_LEVELS.map((level) => (
                  <div 
                    key={level.value}
                    className={`flex items-center space-x-3 p-3 rounded-lg border cursor-pointer transition-colors ${
                      triggerConfig.urgency === level.value ? 'border-primary bg-primary/5' : 'hover:bg-muted/50'
                    }`}
                    onClick={() => setTriggerConfig(prev => ({ ...prev, urgency: level.value as any }))}
                  >
                    <RadioGroupItem value={level.value} id={`urgency-${level.value}`} />
                    <div className="flex items-center gap-2 flex-1">
                      <div className={`w-3 h-3 rounded-full ${level.color}`}></div>
                      <div>
                        <Label htmlFor={`urgency-${level.value}`} className="font-medium cursor-pointer">
                          {level.label}
                        </Label>
                        <p className="text-xs text-muted-foreground">{level.description}</p>
                      </div>
                    </div>
                  </div>
                ))}
              </RadioGroup>
            </CardContent>
          </Card>

          <div className="flex justify-between">
            <Button variant="outline" onClick={() => setStep('select')} data-testid="button-back">
              Back
            </Button>
            <Button onClick={() => setStep('review')} data-testid="button-review">
              Review Trigger
              <ArrowRight className="w-4 h-4 ml-2" />
            </Button>
          </div>
        </div>
      )}

      {/* Step 3: Review & Create */}
      {step === 'review' && (
        <div className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Target className="w-5 h-5" />
                {triggerConfig.name || 'Untitled Trigger'}
              </CardTitle>
              <CardDescription>{triggerConfig.description}</CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              {/* Conditions Summary */}
              <div>
                <h4 className="font-medium mb-3">Monitoring Conditions</h4>
                <div className="space-y-2">
                  {triggerConfig.conditions.map((condition, index) => (
                    <div 
                      key={index}
                      className="flex items-center gap-2 p-3 bg-muted rounded-lg"
                    >
                      <Activity className="w-4 h-4 text-muted-foreground" />
                      <span className="font-medium">{condition.dataPointName}</span>
                      <Badge variant="outline" className="font-mono">
                        {OPERATORS.find(o => o.value === condition.operator)?.symbol} {condition.value}
                      </Badge>
                      <Badge variant="secondary" className="text-xs ml-auto">
                        {condition.categoryName}
                      </Badge>
                    </div>
                  ))}
                </div>
                <div className="mt-3 p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg">
                  <div className="flex items-center gap-2 text-sm">
                    <Link className="w-4 h-4 text-blue-600" />
                    <span className="text-blue-800 dark:text-blue-200">
                      {triggerConfig.logic === 'any' && 'Alert triggers when ANY condition is met'}
                      {triggerConfig.logic === 'all' && 'Alert triggers when ALL conditions are met'}
                      {triggerConfig.logic === 'threshold' && 
                        `Alert triggers when ${triggerConfig.thresholdCount} or more conditions are met`}
                    </span>
                  </div>
                </div>
              </div>

              <Separator />

              {/* Urgency */}
              <div className="flex items-center justify-between">
                <span className="font-medium">Alert Urgency</span>
                <Badge className={URGENCY_LEVELS.find(l => l.value === triggerConfig.urgency)?.color}>
                  {URGENCY_LEVELS.find(l => l.value === triggerConfig.urgency)?.label}
                </Badge>
              </div>

              <Separator />

              {/* Auto-activate Option */}
              <div className="flex items-center justify-between">
                <div>
                  <div className="font-medium">Auto-activate Playbook</div>
                  <p className="text-sm text-muted-foreground">
                    Automatically recommend playbook activation when triggered
                  </p>
                </div>
                <Switch
                  checked={triggerConfig.autoActivate}
                  onCheckedChange={(checked) => setTriggerConfig(prev => ({ ...prev, autoActivate: checked }))}
                  data-testid="switch-auto-activate"
                />
              </div>
            </CardContent>
            <CardFooter className="flex justify-between">
              <Button variant="outline" onClick={() => setStep('configure')} data-testid="button-edit">
                Edit Configuration
              </Button>
              <Button 
                onClick={handleSubmit}
                disabled={createTriggerMutation.isPending}
                data-testid="button-create-trigger"
              >
                {createTriggerMutation.isPending ? (
                  <>Creating...</>
                ) : (
                  <>
                    <Play className="w-4 h-4 mr-2" />
                    Create Trigger
                  </>
                )}
              </Button>
            </CardFooter>
          </Card>
        </div>
      )}
    </div>
  );
}

// Step Indicator Component
function StepIndicator({ 
  step, 
  label, 
  active, 
  completed 
}: { 
  step: number; 
  label: string; 
  active: boolean; 
  completed: boolean;
}) {
  return (
    <div className="flex items-center gap-2">
      <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-colors ${
        active ? 'bg-primary text-primary-foreground' :
        completed ? 'bg-green-500 text-white' :
        'bg-muted text-muted-foreground'
      }`}>
        {completed ? <Check className="w-4 h-4" /> : step}
      </div>
      <span className={`text-sm ${active ? 'font-medium' : 'text-muted-foreground'}`}>
        {label}
      </span>
    </div>
  );
}

export default TriggerBuilder;


========================================
FILE: client/src/components/intelligence/index.ts
========================================
/**
 * Intelligence Components Index
 * 
 * Central export for all intelligence signal monitoring components.
 */

export { SignalControlCenter } from './SignalControlCenter';
export { TriggerBuilder } from './TriggerBuilder';
export { AlertCommandCenter } from './AlertCommandCenter';
export { SignalPlaybookMapper } from './SignalPlaybookMapper';


========================================
FILE: client/src/components/homepage/AugmentedExecutionSection.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Users, Shield, Zap, Eye, CheckCircle2, TrendingUp, Cpu, Quote, ArrowRight } from 'lucide-react';

export default function AugmentedExecutionSection() {
  return (
    <section className="py-20 bg-gradient-to-b from-muted/20 to-background" data-testid="section-augmented-execution">
      <div className="container mx-auto px-4">
        <div className="max-w-6xl mx-auto">

          <div className="text-center mb-12">
            <Badge className="mb-4 bg-green-600 text-white text-sm px-4 py-1" data-testid="badge-human-machine">
              Human + Machine
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-4" data-testid="heading-augmented-execution">
              Augmented Execution: Where Humans Stay in Control
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
              M doesn't replace human judgmentwe amplify it. By eliminating 
              coordination friction while maintaining human oversight, we deliver 
              the speed of automation with the wisdom of human decision-making.
            </p>
          </div>

          <div className="mb-12 text-center">
            <div className="inline-flex items-center justify-center gap-6 p-8 bg-gradient-to-r from-blue-50 to-green-50 dark:from-blue-900/20 dark:to-green-900/20 rounded-2xl" data-testid="visual-equation">
              <div className="text-center">
                <Users className="w-20 h-20 mx-auto mb-2 text-blue-600" />
                <p className="font-semibold">Humans</p>
                <p className="text-sm text-muted-foreground">Judgment & Strategy</p>
              </div>
              <div className="text-4xl font-bold text-green-600">+</div>
              <div className="text-center">
                <Cpu className="w-20 h-20 mx-auto mb-2 text-green-600" />
                <p className="font-semibold">Machine</p>
                <p className="text-sm text-muted-foreground">Speed & Coordination</p>
              </div>
              <div className="text-4xl font-bold text-purple-600">=</div>
              <div className="text-center">
                <TrendingUp className="w-20 h-20 mx-auto mb-2 text-purple-600" />
                <p className="font-semibold">10x Results</p>
                <p className="text-sm text-muted-foreground">Augmented Execution</p>
              </div>
            </div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
            
            <Card className="border-2 hover:border-blue-500 transition-colors" data-testid="card-principle-control">
              <CardHeader>
                <Shield className="w-12 h-12 mb-3 text-blue-600" />
                <CardTitle className="text-xl">Humans Stay in Control</CardTitle>
              </CardHeader>
              <CardContent>
                <ul className="space-y-2 text-sm text-muted-foreground">
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>M doesn't replace decisions</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>Every critical action requires human approval</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>Stakeholders retain full authority</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>System coordinates, humans execute</span>
                  </li>
                </ul>
              </CardContent>
            </Card>

            <Card className="border-2 hover:border-green-500 transition-colors" data-testid="card-principle-friction">
              <CardHeader>
                <Zap className="w-12 h-12 mb-3 text-green-600" />
                <CardTitle className="text-xl">Eliminate Coordination Friction</CardTitle>
              </CardHeader>
              <CardContent>
                <ul className="space-y-2 text-sm text-muted-foreground">
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>From 72 hours of meetings  12 minutes</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>From 200 emails  1 activation</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>From calendar Tetris  instant alignment</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>From confusion  clarity</span>
                  </li>
                </ul>
              </CardContent>
            </Card>

            <Card className="border-2 hover:border-purple-500 transition-colors" data-testid="card-principle-transparency">
              <CardHeader>
                <Eye className="w-12 h-12 mb-3 text-purple-600" />
                <CardTitle className="text-xl">Build Trust Through Transparency</CardTitle>
              </CardHeader>
              <CardContent>
                <ul className="space-y-2 text-sm text-muted-foreground">
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>Real-time visibility for all stakeholders</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>Clear accountability (who does what)</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>Override capability (humans can change course)</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>Continuous learning (system improves from feedback)</span>
                  </li>
                </ul>
              </CardContent>
            </Card>
          </div>

          <Card className="bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 border-2 border-green-500 mb-12" data-testid="card-quote">
            <CardContent className="p-8">
              <div className="flex flex-col md:flex-row gap-6 items-center">
                <div className="flex-shrink-0">
                  <div className="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center">
                    <Quote className="w-8 h-8 text-white" />
                  </div>
                </div>
                <div className="flex-1 text-center md:text-left">
                  <blockquote className="text-xl md:text-2xl font-semibold mb-3">
                    "The real question isn't 'What can we automate?' it's 
                    'Where should humans stay in the loop?'"
                  </blockquote>
                  <p className="text-sm text-muted-foreground">
                     Torsten D., Enterprise Transformation Leader
                  </p>
                  <p className="text-sm text-muted-foreground mt-1">
                    From "Augmented Execution: Human + Machine" (October 2025)
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card className="bg-gradient-to-r from-orange-50 to-purple-50 dark:from-orange-900/20 dark:to-purple-900/20 border-2 border-orange-500 mb-12" data-testid="card-hypothesis-planning">
            <CardContent className="p-8">
              <div className="text-center mb-6">
                <div className="inline-flex items-center gap-2 bg-orange-600 text-white rounded-full px-4 py-2 mb-4">
                  <TrendingUp className="w-5 h-5" />
                  <span className="font-semibold">Hypothesis-Driven Planning</span>
                </div>
                <h3 className="text-2xl md:text-3xl font-bold mb-4">
                  From 5-Year Plans to 2-Year Hypotheses
                </h3>
              </div>
              
              <div className="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                <div className="text-center">
                  <div className="text-sm font-semibold text-muted-foreground mb-2">Old Model</div>
                  <div className="bg-red-100 dark:bg-red-900/20 rounded-lg p-6 border-2 border-red-300">
                    <p className="text-4xl font-bold text-red-600 mb-2">5 Years</p>
                    <p className="text-sm text-muted-foreground">
                      Strategic plans outdated before you finish writing them
                    </p>
                  </div>
                </div>
                <div className="text-center">
                  <div className="text-sm font-semibold text-muted-foreground mb-2">M Model</div>
                  <div className="bg-green-100 dark:bg-green-900/20 rounded-lg p-6 border-2 border-green-300">
                    <p className="text-4xl font-bold text-green-600 mb-2">2 Years</p>
                    <p className="text-sm text-muted-foreground">
                      Fast iteration, rapid testing, continuous adaptation
                    </p>
                  </div>
                </div>
              </div>

              <div className="mt-8 max-w-3xl mx-auto">
                <p className="text-lg text-center mb-4">
                  <strong>Speed of change demands speed of planning.</strong> M enables you to test 
                  strategic hypotheses in 2-minute conversations instead of 6-month planning cyclesand when 
                  you're ready to execute, coordinate 30 stakeholders in 12 minutes instead of 72 hours.
                </p>
                <div className="bg-white dark:bg-gray-900 rounded-lg p-4 border border-orange-200">
                  <p className="text-sm text-muted-foreground text-center">
                    <strong>Example:</strong> "What if a competitor enters APAC with 50% lower pricing?" 
                     M runs the hypothesis through your Predictive Execution Engine, shows impact 
                    on your playbooks/budgets/stakeholders in real-time, then executes your response in 12 minutes.
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          <div className="text-center">
            <h3 className="text-2xl font-bold mb-4">
              See Augmented Execution in Action
            </h3>
            <p className="text-lg text-muted-foreground mb-6">
              Watch how M coordinates 30 stakeholders in 12 minutes while 
              keeping every human in full control.
            </p>
            <Button size="lg" asChild data-testid="button-view-demo">
              <a href="/demo-selector">
                View Live Demo
                <ArrowRight className="w-5 h-5 ml-2" />
              </a>
            </Button>
          </div>

        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/homepage/ConversationalCommandLayer.tsx
========================================
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { MessageSquare, Zap, Shield, ArrowRight, CheckCircle2 } from 'lucide-react';
import { SiSlack } from 'react-icons/si';

export default function ConversationalCommandLayer() {
  return (
    <section className="py-20 bg-gradient-to-b from-purple-50 to-blue-50 dark:from-purple-900/10 dark:to-blue-900/10" data-testid="section-conversational-command">
      <div className="container mx-auto px-4">
        <div className="max-w-6xl mx-auto">

          <div className="text-center mb-12">
            <Badge className="mb-4 bg-purple-600 text-white text-sm px-4 py-1" data-testid="badge-conversational">
              Coming Soon: Conversational Command & Control
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-4" data-testid="heading-conversational">
              From Dashboard to Conversation
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
              The future of strategic execution isn't logging into another dashboardit's having a conversation 
              where you already work. M's upcoming conversational interface will bring AI-powered command and control directly into Slack and Teams.
            </p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            
            <Card className="border-2 border-purple-500" data-testid="card-conversational-interface">
              <CardContent className="p-8">
                <div className="flex items-center gap-3 mb-6">
                  <div className="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center">
                    <MessageSquare className="w-6 h-6 text-white" />
                  </div>
                  <h3 className="text-2xl font-bold">Conversational Interface</h3>
                </div>
                <ul className="space-y-3">
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                    <span className="text-muted-foreground">
                      <strong>Query status:</strong> "What's our ransomware preparedness score?"
                    </span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                    <span className="text-muted-foreground">
                      <strong>Activate playbooks:</strong> "Launch Product-101 for APAC expansion"
                    </span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                    <span className="text-muted-foreground">
                      <strong>Run hypotheses:</strong> "What if a competitor enters with 50% lower pricing?"
                    </span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                    <span className="text-muted-foreground">
                      <strong>Real-time updates:</strong> Automatic status feeds to War Room channels
                    </span>
                  </li>
                </ul>
              </CardContent>
            </Card>

            <Card className="border-2 border-blue-500" data-testid="card-ai-orchestration">
              <CardContent className="p-8">
                <div className="flex items-center gap-3 mb-6">
                  <div className="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                    <Zap className="w-6 h-6 text-white" />
                  </div>
                  <h3 className="text-2xl font-bold">AI Orchestration</h3>
                </div>
                <ul className="space-y-3">
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                    <span className="text-muted-foreground">
                      <strong>Autonomous tasks:</strong> AI drafts comms, generates reports, summarizes data
                    </span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                    <span className="text-muted-foreground">
                      <strong>Human checkpoints:</strong> Executives review and approve AI outputs
                    </span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                    <span className="text-muted-foreground">
                      <strong>Instant coordination:</strong> 67% of tasks automated, humans focus on judgment
                    </span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                    <span className="text-muted-foreground">
                      <strong>Override controls:</strong> Humans maintain full authority over every decision
                    </span>
                  </li>
                </ul>
              </CardContent>
            </Card>
          </div>

          <Card className="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 border-2 border-purple-500" data-testid="card-command-flow">
            <CardContent className="p-8">
              <h3 className="text-2xl font-bold mb-6 text-center">
                Coming Soon: 10-Second Command  12-Minute Execution
              </h3>
              
              <div className="grid grid-cols-1 md:grid-cols-5 gap-4 items-center">
                <div className="text-center">
                  <div className="bg-purple-600 text-white rounded-lg p-4 mb-2">
                    <MessageSquare className="w-8 h-8 mx-auto mb-2" />
                    <p className="text-sm font-semibold">Conversation</p>
                  </div>
                  <p className="text-xs text-muted-foreground">@M activate SC-101</p>
                </div>

                <div className="flex justify-center">
                  <ArrowRight className="w-6 h-6 text-purple-600" />
                </div>

                <div className="text-center">
                  <div className="bg-blue-600 text-white rounded-lg p-4 mb-2">
                    <Shield className="w-8 h-8 mx-auto mb-2" />
                    <p className="text-sm font-semibold">Approval</p>
                  </div>
                  <p className="text-xs text-muted-foreground">One-click confirm</p>
                </div>

                <div className="flex justify-center">
                  <ArrowRight className="w-6 h-6 text-purple-600" />
                </div>

                <div className="text-center">
                  <div className="bg-green-600 text-white rounded-lg p-4 mb-2">
                    <Zap className="w-8 h-8 mx-auto mb-2" />
                    <p className="text-sm font-semibold">Execution</p>
                  </div>
                  <p className="text-xs text-muted-foreground">30 stakeholders aligned</p>
                </div>
              </div>

              <div className="mt-8 text-center">
                <div className="inline-flex items-center gap-4 bg-white dark:bg-gray-900 rounded-lg p-4 border border-purple-200">
                  <div className="flex items-center gap-2">
                    <SiSlack className="w-6 h-6 text-[#4A154B]" />
                    <span className="text-sm font-semibold">Slack</span>
                  </div>
                  <div className="h-6 w-px bg-border" />
                  <div className="flex items-center gap-2">
                    <MessageSquare className="w-6 h-6 text-[#6264A7]" />
                    <span className="text-sm font-semibold">Microsoft Teams</span>
                  </div>
                  <div className="h-6 w-px bg-border" />
                  <span className="text-sm text-muted-foreground">Meet executives where they work</span>
                </div>
              </div>
            </CardContent>
          </Card>

          <div className="mt-8 text-center">
            <p className="text-lg text-muted-foreground mb-6">
              See how M's current execution orchestration capabilities lay the foundation for conversational commandwatch our live demos
            </p>
            <Button size="lg" asChild data-testid="button-see-conversational-demo">
              <a href="/demo-selector">
                See M Execution in Action
                <ArrowRight className="w-5 h-5 ml-2" />
              </a>
            </Button>
          </div>

        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/homepage/FootballConnectionCallout.tsx
========================================
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";

interface FootballConnectionCalloutProps {
  text: string;
  testId?: string;
}

export default function FootballConnectionCallout({ text, testId = "callout-football-connection" }: FootballConnectionCalloutProps) {
  return (
    <Card className="mt-6 border-2 border-green-500/30 bg-green-50 dark:bg-green-900/10" data-testid={testId}>
      <CardContent className="p-6">
        <div className="flex items-start gap-3">
          <Badge className="bg-green-600 text-white shrink-0 mt-1" data-testid={`${testId}-badge`}>
             The Connection
          </Badge>
          <p className="text-base text-foreground leading-relaxed" data-testid={`${testId}-text`}>
            {text}
          </p>
        </div>
      </CardContent>
    </Card>
  );
}


========================================
FILE: client/src/components/homepage/FootballHeroSection.tsx
========================================
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { CheckCircle2, X, Building2, ArrowRight } from "lucide-react";

export default function FootballHeroSection() {
  return (
    <section className="relative py-20 md:py-32 overflow-hidden bg-gradient-to-b from-primary/5 to-background">
      <div className="container mx-auto px-4">
        <div className="max-w-6xl mx-auto">
          
          {/* Eyebrow - The Heritage */}
          <div className="text-center mb-6">
            <Badge className="text-sm px-4 py-2 bg-green-600 text-white" data-testid="badge-football-heritage">
               Built on 100+ Years of Proven Methodology
            </Badge>
          </div>

          {/* Main Headline */}
          <div className="text-center mb-8">
            <h1 className="text-5xl md:text-7xl font-bold mb-6 leading-tight text-slate-900 dark:text-white" data-testid="text-hero-headline">
              Your Competitors Are<br />
              <span className="text-red-600 dark:text-red-400">Executing in 12 Minutes</span><br />
              You're Taking 72 Hours
            </h1>
            <p className="text-xl md:text-2xl text-slate-700 dark:text-slate-300 max-w-4xl mx-auto mb-6 font-semibold" data-testid="text-hero-subtext-1">
              Every strategic decision delayed costs Fortune 1000 companies <strong>$5.8M annually</strong> in lost value. 
              Competitors using M move 6x faster on market opportunities, crisis response, and M&A execution.
            </p>
            <p className="text-lg md:text-xl text-slate-600 dark:text-slate-400 max-w-4xl mx-auto" data-testid="text-hero-subtext-2">
              M is the only Strategic Execution Operating System that compresses 72-hour coordination into 12-minute action. 
              Not adopting it isn't an optionit's a competitive liability.
            </p>
          </div>

          {/* The Visual Comparison */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            
            {/* Football Card */}
            <Card className="border-2 border-green-500 bg-green-50 dark:bg-green-900/20" data-testid="card-football-system">
              <CardHeader>
                <div className="flex items-center gap-3 mb-3">
                  <div className="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center">
                    <span className="text-2xl"></span>
                  </div>
                  <div>
                    <CardTitle className="text-2xl">Elite Football</CardTitle>
                    <CardDescription className="text-base">The Proven System</CardDescription>
                  </div>
                </div>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="space-y-3">
                  <div className="flex items-start gap-3">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-1 flex-shrink-0" />
                    <div>
                      <p className="font-semibold">300+ Pre-Installed Plays</p>
                      <p className="text-sm text-muted-foreground">
                        Every scenario prepared before kickoff
                      </p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-1 flex-shrink-0" />
                    <div>
                      <p className="font-semibold">&lt;60 Second Execution</p>
                      <p className="text-sm text-muted-foreground">
                        From coach's decision to coordinated action
                      </p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-1 flex-shrink-0" />
                    <div>
                      <p className="font-semibold">11 Players, Perfect Sync</p>
                      <p className="text-sm text-muted-foreground">
                        Everyone knows their role, no coordination meetings
                      </p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <CheckCircle2 className="w-5 h-5 text-green-600 mt-1 flex-shrink-0" />
                    <div>
                      <p className="font-semibold">80+ Critical Decisions/Game</p>
                      <p className="text-sm text-muted-foreground">
                        Sustained execution velocity over 3+ hours
                      </p>
                    </div>
                  </div>
                </div>
                <div className="pt-4 border-t">
                  <p className="text-sm font-semibold text-green-600">
                     Proven System: 100+ years, thousands of teams, millions of successful plays
                  </p>
                </div>
              </CardContent>
            </Card>

            {/* Business Card - WITHOUT M */}
            <Card className="border-2 border-red-600 bg-red-50 dark:bg-red-900/30 shadow-lg" data-testid="card-business-crisis">
              <CardHeader>
                <div className="flex items-center gap-3 mb-3">
                  <div className="w-12 h-12 bg-red-600 rounded-full flex items-center justify-center">
                    <X className="w-6 h-6 text-white font-bold text-2xl" />
                  </div>
                  <div>
                    <CardTitle className="text-2xl">Business Today</CardTitle>
                    <CardDescription className="text-base">The Coordination Crisis</CardDescription>
                  </div>
                </div>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="space-y-3">
                  <div className="flex items-start gap-3">
                    <X className="w-5 h-5 text-red-600 mt-1 flex-shrink-0" />
                    <div>
                      <p className="font-semibold">Zero Pre-Built Playbooks</p>
                      <p className="text-sm text-muted-foreground">
                        Reinventing response for every situation
                      </p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <X className="w-5 h-5 text-red-600 mt-1 flex-shrink-0" />
                    <div>
                      <p className="font-semibold">72+ Hour Coordination</p>
                      <p className="text-sm text-muted-foreground">
                        Days of meetings and emails to align
                      </p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <X className="w-5 h-5 text-red-600 mt-1 flex-shrink-0" />
                    <div>
                      <p className="font-semibold">30 Stakeholders, Chaos</p>
                      <p className="text-sm text-muted-foreground">
                        Unclear roles, confusion, missed responsibilities
                      </p>
                    </div>
                  </div>
                  <div className="flex items-start gap-3">
                    <X className="w-5 h-5 text-red-600 mt-1 flex-shrink-0" />
                    <div>
                      <p className="font-semibold">Slow, Reactive Decisions</p>
                      <p className="text-sm text-muted-foreground">
                        Competitors move while you're still coordinating
                      </p>
                    </div>
                  </div>
                </div>
                <div className="pt-4 border-t">
                  <p className="text-sm font-semibold text-red-600">
                     McKinsey: 30% strategic value lost to coordination failures
                  </p>
                </div>
              </CardContent>
            </Card>
          </div>

          {/* The Bridge Statement */}
          <Card className="border-2 border-primary bg-primary/5 mb-8" data-testid="card-bridge-statement">
            <CardContent className="p-8 text-center">
              <h3 className="text-2xl md:text-3xl font-bold mb-4">
                What if your business could execute strategic decisions with 
                the same precision as championship football teams?
              </h3>
              <p className="text-lg text-muted-foreground mb-6 max-w-3xl mx-auto">
                M is the Strategic Execution Operating System built on football's 
                proven coordination methodologyvalidated by modern research, adapted 
                for business execution.
              </p>
              <div className="flex flex-col sm:flex-row gap-4 justify-center">
                <Button size="lg" asChild data-testid="button-watch-demo">
                  <a href="/demo-selector">
                    Watch Live Demo
                    <ArrowRight className="w-5 h-5 ml-2" />
                  </a>
                </Button>
                <Button size="lg" variant="outline" asChild data-testid="button-learn-methodology">
                  <a href="#methodology">
                    Learn the Methodology
                  </a>
                </Button>
              </div>
            </CardContent>
          </Card>

          {/* Quick Stats Bar */}
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
            <div className="p-4">
              <div className="text-3xl md:text-4xl font-bold text-primary mb-1" data-testid="stat-years">100+</div>
              <p className="text-sm text-muted-foreground">Years of Proven<br />Methodology</p>
            </div>
            <div className="p-4">
              <div className="text-3xl md:text-4xl font-bold text-green-600 mb-1" data-testid="stat-playbooks">166</div>
              <p className="text-sm text-muted-foreground">Pre-Built Strategic<br />Playbooks</p>
            </div>
            <div className="p-4">
              <div className="text-3xl md:text-4xl font-bold text-blue-600 mb-1" data-testid="stat-minutes">12min</div>
              <p className="text-sm text-muted-foreground">Decision to<br />Coordinated Action</p>
            </div>
            <div className="p-4">
              <div className="text-3xl md:text-4xl font-bold text-purple-600 mb-1" data-testid="stat-faster">360x</div>
              <p className="text-sm text-muted-foreground">Faster Than<br />Traditional Methods</p>
            </div>
          </div>

        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/homepage/FootballMethodologySection.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { 
  TrendingUp, 
  BookOpen, 
  Users, 
  Zap, 
  Target, 
  Shield,
  ArrowRight
} from "lucide-react";

export default function FootballMethodologySection() {
  return (
    <section id="methodology" className="py-20 bg-gradient-to-b from-background to-muted/20">
      <div className="container mx-auto px-4">
        <div className="max-w-6xl mx-auto">

          {/* Section Header */}
          <div className="text-center mb-16">
            <Badge className="mb-4 bg-green-600 text-white text-sm px-4 py-1" data-testid="badge-football-methodology">
              The Football Methodology
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-4" data-testid="text-methodology-headline">
              What Elite Football Has Known for a Century
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto" data-testid="text-methodology-description">
              Since the forward pass was legalized in 1906, football has continuously 
              refined the art of rapid coordination under pressure. M brings that 
              battle-tested system to strategic execution.
            </p>
          </div>

          {/* Timeline: Evolution of Football Coordination */}
          <Card className="mb-12 border-2 border-primary" data-testid="card-coordination-timeline">
            <CardHeader>
              <CardTitle className="text-2xl flex items-center gap-3">
                <TrendingUp className="w-8 h-8 text-primary" />
                100+ Years of Coordination Evolution
              </CardTitle>
              <CardDescription className="text-lg">
                How football perfected rapid decision-making over a century
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              
              {/* 1906 */}
              <div className="flex gap-4">
                <div className="flex-shrink-0 w-24 font-bold text-primary text-lg">1906</div>
                <div className="flex-1">
                  <h4 className="font-semibold mb-1">Forward Pass Legalized</h4>
                  <p className="text-sm text-muted-foreground">
                    Introduced complexity requiring real-time coordination between 
                    quarterback, receivers, and blockers. Teams needed systematic 
                    approach to synchronize 11 players in under 60 seconds.
                  </p>
                </div>
              </div>

              {/* 1940s */}
              <div className="flex gap-4">
                <div className="flex-shrink-0 w-24 font-bold text-primary text-lg">1940s</div>
                <div className="flex-1">
                  <h4 className="font-semibold mb-1">Playbook Systems Emerge</h4>
                  <p className="text-sm text-muted-foreground">
                    Coaches like Paul Brown introduced comprehensive playbooksdocumenting 
                    every scenario, every role, every responsibility. No more improvisation; 
                    preparation became the competitive advantage.
                  </p>
                </div>
              </div>

              {/* 1970s */}
              <div className="flex gap-4">
                <div className="flex-shrink-0 w-24 font-bold text-primary text-lg">1970s</div>
                <div className="flex-1">
                  <h4 className="font-semibold mb-1">Pre-Snap Reads & Audibles</h4>
                  <p className="text-sm text-muted-foreground">
                    Quarterbacks gained authority to change plays at the line based on 
                    defensive formations. Real-time adaptation became standarddecisions 
                    made in seconds, not minutes.
                  </p>
                </div>
              </div>

              {/* 1980s */}
              <div className="flex gap-4">
                <div className="flex-shrink-0 w-24 font-bold text-primary text-lg">1984-1988</div>
                <div className="flex-1">
                  <h4 className="font-semibold mb-1">No-Huddle Offense Pioneered</h4>
                  <p className="text-sm text-muted-foreground">
                    Cincinnati Bengals coach Sam Wyche pioneered the no-huddle offense, 
                    making it their base operation by 1988. QB Boomer Esiason won MVP 
                    as the Bengals led the NFL in scoring and reached the Super Bowl. 
                    Coordination time dropped from 40 seconds to 15 secondsspeed became 
                    the ultimate competitive weapon.
                  </p>
                </div>
              </div>

              {/* 1990s-2000s */}
              <div className="flex gap-4">
                <div className="flex-shrink-0 w-24 font-bold text-primary text-lg">1990s-2000s</div>
                <div className="flex-1">
                  <h4 className="font-semibold mb-1">Coach-to-QB Helmet Communication</h4>
                  <p className="text-sm text-muted-foreground">
                    NFL allowed radio communication from coaches to quarterbacks (1994, 
                    permanently by early 2000s). Instant voice coordination replaced hand 
                    signalseliminating communication delays entirely.
                  </p>
                </div>
              </div>

              {/* 2025 */}
              <div className="flex gap-4 pt-4 border-t">
                <div className="flex-shrink-0 w-24 font-bold text-green-600 text-lg">2025</div>
                <div className="flex-1">
                  <h4 className="font-semibold text-green-600 mb-1">M Brings It to Business</h4>
                  <p className="text-sm text-muted-foreground">
                    For the first time, business executives can execute strategic decisions 
                    with the same systematic coordination that championship teams have used 
                    for decades. Pre-built playbooks, instant alignment, sub-15-minute execution.
                  </p>
                </div>
              </div>

            </CardContent>
          </Card>

          {/* The 5 Principles (Football  M) */}
          <div className="mb-12">
            <h3 className="text-3xl font-bold text-center mb-8" data-testid="text-principles-headline">
              The 5 Principles Championship Teams Use
            </h3>
            <p className="text-center text-muted-foreground mb-12 max-w-3xl mx-auto">
              These principles aren't theorythey're proven across 100+ years, 
              thousands of teams, and millions of successful plays. M applies 
              them to business execution.
            </p>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
              
              {/* Principle 1 */}
              <Card className="border-2 hover:border-primary transition-colors" data-testid="card-principle-playbooks">
                <CardHeader>
                  <div className="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-3">
                    <BookOpen className="w-6 h-6 text-primary" />
                  </div>
                  <CardTitle>1. Prepare Playbooks Before Game Day</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-sm text-muted-foreground mb-4">
                    <strong>Football:</strong> Coaches install 300+ plays in training 
                    camp. Every scenario is prepared, practiced, and perfected before 
                    the season starts.
                  </p>
                  <p className="text-sm font-semibold text-primary">
                    <strong>M:</strong> 166 pre-built strategic playbooks cover 
                    crisis response, M&A integration, product launches, competitive 
                    response, and moreprepared before you need them.
                  </p>
                </CardContent>
              </Card>

              {/* Principle 2 */}
              <Card className="border-2 hover:border-primary transition-colors" data-testid="card-principle-roles">
                <CardHeader>
                  <div className="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-3">
                    <Users className="w-6 h-6 text-primary" />
                  </div>
                  <CardTitle>2. Every Role Knows Their Assignment</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-sm text-muted-foreground mb-4">
                    <strong>Football:</strong> When the play is called, left tackle 
                    knows exactly who to block, receiver knows the route, running back 
                    knows the protection scheme. Zero ambiguity.
                  </p>
                  <p className="text-sm font-semibold text-primary">
                    <strong>M:</strong> When playbook activates, every stakeholder 
                    sees their specific role, tasks, and accountabilities. McKinsey's 
                    "Clarity" outcome delivered instantly.
                  </p>
                </CardContent>
              </Card>

              {/* Principle 3 */}
              <Card className="border-2 hover:border-primary transition-colors" data-testid="card-principle-speed">
                <CardHeader>
                  <div className="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-3">
                    <Zap className="w-6 h-6 text-primary" />
                  </div>
                  <CardTitle>3. Execute at Game Speed</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-sm text-muted-foreground mb-4">
                    <strong>Football:</strong> From coach's decision to snap of ball: 
                    under 40 seconds. 80+ times per game. No delays, no coordination 
                    overhead.
                  </p>
                  <p className="text-sm font-semibold text-primary">
                    <strong>M:</strong> From executive decision to coordinated 
                    execution: 12 minutes average. Eliminate 72 hours of meetings 
                    and email chains.
                  </p>
                </CardContent>
              </Card>

              {/* Principle 4 */}
              <Card className="border-2 hover:border-primary transition-colors" data-testid="card-principle-practice">
                <CardHeader>
                  <div className="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-3">
                    <Target className="w-6 h-6 text-primary" />
                  </div>
                  <CardTitle>4. Practice Creates Muscle Memory</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-sm text-muted-foreground mb-4">
                    <strong>Football:</strong> Teams don't just have playbooksthey 
                    run each play 100+ times in practice. Game day execution is 
                    automatic because they've prepared.
                  </p>
                  <p className="text-sm font-semibold text-primary">
                    <strong>M:</strong> Practice Mode lets teams simulate crisis 
                    response, M&A integration, or product launches before they happen. 
                    Find gaps in preparation, not during real events.
                  </p>
                </CardContent>
              </Card>

              {/* Principle 5 */}
              <Card className="border-2 hover:border-primary transition-colors" data-testid="card-principle-learning">
                <CardHeader>
                  <div className="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-3">
                    <TrendingUp className="w-6 h-6 text-primary" />
                  </div>
                  <CardTitle>5. Film Study Drives Improvement</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-sm text-muted-foreground mb-4">
                    <strong>Football:</strong> After every game, teams review film to 
                    identify what worked, what didn't, and how to improve. Continuous 
                    learning is systematic.
                  </p>
                  <p className="text-sm font-semibold text-primary">
                    <strong>M:</strong> Four Outcomes Scorecard tracks Clarity, 
                    Speed, Skills, and Commitment after every activation. Learn from 
                    each execution to improve the next one.
                  </p>
                </CardContent>
              </Card>

              {/* Principle 6 - The Philosophy */}
              <Card className="border-2 border-green-500 bg-green-50 dark:bg-green-900/20" data-testid="card-principle-philosophy">
                <CardHeader>
                  <div className="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center mb-3">
                    <Shield className="w-6 h-6 text-white" />
                  </div>
                  <CardTitle>The Core Philosophy: Coach Decides, System Coordinates</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-sm text-muted-foreground mb-4">
                    <strong>Football:</strong> The coach makes the strategic decision 
                    (which play to run). The system handles coordination (getting 11 
                    players aligned). The coach stays in control.
                  </p>
                  <p className="text-sm font-semibold text-green-600">
                    <strong>M:</strong> Executives make strategic decisions. M 
                    handles coordination (aligning 30+ stakeholders). Human judgment + 
                    machine speed = Augmented Execution.
                  </p>
                </CardContent>
              </Card>

            </div>
          </div>

          {/* The Proof Statement */}
          <Card className="bg-gradient-to-r from-primary to-blue-600 text-white" data-testid="card-proof-statement">
            <CardContent className="p-8 md:p-12 text-center">
              <h3 className="text-3xl md:text-4xl font-bold mb-6">
                This Isn't Theory. It's a Century of Proof.
              </h3>
              <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div>
                  <div className="text-4xl font-bold mb-2" data-testid="stat-years">100+</div>
                  <p className="text-sm opacity-90">Years of Refinement</p>
                </div>
                <div>
                  <div className="text-4xl font-bold mb-2" data-testid="stat-teams">1,000s</div>
                  <p className="text-sm opacity-90">of Teams Using System</p>
                </div>
                <div>
                  <div className="text-4xl font-bold mb-2" data-testid="stat-plays">Millions</div>
                  <p className="text-sm opacity-90">of Successful Plays</p>
                </div>
                <div>
                  <div className="text-4xl font-bold mb-2" data-testid="stat-champions">Every</div>
                  <p className="text-sm opacity-90">Championship Team</p>
                </div>
              </div>
              <p className="text-xl mb-6 max-w-3xl mx-auto opacity-90">
                Every Super Bowl champion, every college football national champion, 
                every legendary coachthey all use this methodology. It's not 
                debatable. It's documented. It works.
              </p>
              <p className="text-2xl font-semibold mb-8">
                Now it's time to bring it to business.
              </p>
              <Button size="lg" variant="secondary" asChild data-testid="button-see-methodology">
                <a href="/demo-selector">
                  See the Methodology in Action
                  <ArrowRight className="w-5 h-5 ml-2" />
                </a>
              </Button>
            </CardContent>
          </Card>

        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/homepage/FutureReadinessHeroSection.tsx
========================================
import { useQuery } from '@tanstack/react-query';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { ArrowRight, Zap, Activity, TrendingUp, Target, Brain } from 'lucide-react';
import { useLocation } from 'wouter';

interface ReadinessMetric {
  overallScore: number;
  foresightScore: number;
  velocityScore: number;
  agilityScore: number;
  learningScore: number;
  adaptabilityScore: number;
  activeScenarios: number;
  weakSignalsDetected: number;
  playbooksReady: number;
}

export default function FutureReadinessHeroSection() {
  const [, setLocation] = useLocation();

  const { data: readiness, isLoading, isError } = useQuery<ReadinessMetric>({
    queryKey: ['/api/dynamic-strategy/readiness'],
    refetchInterval: 30000,
  });

  const score = readiness?.overallScore ?? (isLoading ? null : 84.4);
  const isHigh = score !== null && score >= 80;
  const isMedium = score !== null && score >= 65 && score < 80;
  const displayScore = score !== null ? score : 84.4;

  return (
    <section className="relative py-20 overflow-hidden bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950">
      <div className="absolute inset-0 bg-[linear-gradient(to_right,#1e293b_1px,transparent_1px),linear-gradient(to_bottom,#1e293b_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_80%_50%_at_50%_0%,#000_70%,transparent_110%)] opacity-20" />
      
      <div className="container mx-auto px-6 relative z-10">
        <div className="max-w-6xl mx-auto">
          <div className="text-center mb-12">
            <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/10 border border-emerald-500/20 mb-6">
              <Zap className="h-4 w-4 text-emerald-400" />
              <span className="text-sm font-medium text-emerald-400">NEW: Dynamic Strategy Operating System</span>
            </div>
            
            <h2 className="text-5xl md:text-6xl font-bold text-white mb-6">
              Future Readiness Index
            </h2>
            
            <p className="text-xl text-slate-300 max-w-3xl mx-auto">
              The world's first real-time strategic preparedness score. Know exactly how ready your organization isright now.
            </p>
          </div>

          <div className="grid md:grid-cols-2 gap-8 items-start">
            <Card className="relative overflow-hidden border-2 border-emerald-500/30 bg-gradient-to-br from-slate-900/90 to-slate-800/90 backdrop-blur-xl shadow-2xl">
              <div className="absolute inset-0 bg-gradient-to-br from-emerald-500/10 via-transparent to-blue-500/10" />
              
              <div className="relative p-8">
                <div className="flex items-center justify-between mb-8">
                  <div>
                    <div className="text-sm text-slate-400 mb-1">Your Organization</div>
                    <div className="text-2xl font-bold text-white">Future Readiness Index</div>
                  </div>
                  <div className="relative">
                    <div className="flex items-center gap-2">
                      <div className={`relative flex h-2 w-2 ${isHigh ? 'text-emerald-400' : isMedium ? 'text-amber-400' : 'text-red-400'}`}>
                        <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-current opacity-75"></span>
                        <span className="relative inline-flex rounded-full h-2 w-2 bg-current"></span>
                      </div>
                      <span className={`text-xs font-medium ${isHigh ? 'text-emerald-400' : isMedium ? 'text-amber-400' : 'text-red-400'}`}>
                        LIVE
                      </span>
                    </div>
                  </div>
                </div>

                <div className="text-center mb-8">
                  <div className={`text-7xl font-bold bg-gradient-to-br ${isHigh ? 'from-emerald-400 to-blue-400' : isMedium ? 'from-amber-400 to-orange-400' : 'from-red-400 to-pink-400'} bg-clip-text text-transparent mb-2`}>
                    {isLoading ? '...' : `${displayScore.toFixed(1)}%`}
                  </div>
                  <div className="text-sm text-slate-400">
                    {isLoading ? 'Loading...' : isError ? 'Error loading data' : 'Overall Readiness Score'}
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-4 mb-6">
                  <div className="p-4 rounded-lg bg-slate-800/50 border border-slate-700/50">
                    <div className="flex items-center gap-2 mb-2">
                      <Brain className="h-4 w-4 text-blue-400" />
                      <div className="text-xs text-slate-400">Foresight</div>
                    </div>
                    <div className="text-2xl font-bold text-blue-400">{readiness?.foresightScore?.toFixed(0) || '92'}%</div>
                  </div>
                  
                  <div className="p-4 rounded-lg bg-slate-800/50 border border-slate-700/50">
                    <div className="flex items-center gap-2 mb-2">
                      <Zap className="h-4 w-4 text-emerald-400" />
                      <div className="text-xs text-slate-400">Velocity</div>
                    </div>
                    <div className="text-2xl font-bold text-emerald-400">{readiness?.velocityScore?.toFixed(0) || '88'}%</div>
                  </div>
                  
                  <div className="p-4 rounded-lg bg-slate-800/50 border border-slate-700/50">
                    <div className="flex items-center gap-2 mb-2">
                      <Activity className="h-4 w-4 text-purple-400" />
                      <div className="text-xs text-slate-400">Agility</div>
                    </div>
                    <div className="text-2xl font-bold text-purple-400">{readiness?.agilityScore?.toFixed(0) || '86'}%</div>
                  </div>
                  
                  <div className="p-4 rounded-lg bg-slate-800/50 border border-slate-700/50">
                    <div className="flex items-center gap-2 mb-2">
                      <TrendingUp className="h-4 w-4 text-amber-400" />
                      <div className="text-xs text-slate-400">Learning</div>
                    </div>
                    <div className="text-2xl font-bold text-amber-400">{readiness?.learningScore?.toFixed(0) || '75'}%</div>
                  </div>
                </div>

                <Button 
                  className="w-full bg-gradient-to-r from-emerald-600 to-blue-600 hover:from-emerald-700 hover:to-blue-700 text-white"
                  onClick={() => setLocation('/future-readiness')}
                  data-testid="btn-view-full-readiness"
                >
                  View Full Readiness Dashboard
                  <ArrowRight className="ml-2 h-4 w-4" />
                </Button>
              </div>
            </Card>

            <div className="space-y-6">
              <div className="p-6 rounded-xl bg-slate-800/50 border border-slate-700/50 backdrop-blur-sm">
                <div className="flex items-start gap-4">
                  <div className="p-3 rounded-lg bg-blue-500/10 border border-blue-500/20">
                    <Target className="h-6 w-6 text-blue-400" />
                  </div>
                  <div>
                    <h3 className="text-lg font-semibold text-white mb-2">Real-Time Intelligence</h3>
                    <p className="text-sm text-slate-400">
                      Monitor {readiness?.activeScenarios || 166} strategic scenarios, detect {readiness?.weakSignalsDetected || 23} weak signals, and track emerging patterns continuously.
                    </p>
                  </div>
                </div>
              </div>

              <div className="p-6 rounded-xl bg-slate-800/50 border border-slate-700/50 backdrop-blur-sm">
                <div className="flex items-start gap-4">
                  <div className="p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20">
                    <Zap className="h-6 w-6 text-emerald-400" />
                  </div>
                  <div>
                    <h3 className="text-lg font-semibold text-white mb-2">12-Minute Response</h3>
                    <p className="text-sm text-slate-400">
                      From trigger detection to coordinated responsewhat used to take days now happens in 12 minutes.
                    </p>
                  </div>
                </div>
              </div>

              <div className="p-6 rounded-xl bg-slate-800/50 border border-slate-700/50 backdrop-blur-sm">
                <div className="flex items-start gap-4">
                  <div className="p-3 rounded-lg bg-purple-500/10 border border-purple-500/20">
                    <Brain className="h-6 w-6 text-purple-400" />
                  </div>
                  <div>
                    <h3 className="text-lg font-semibold text-white mb-2">Self-Learning Playbooks</h3>
                    <p className="text-sm text-slate-400">
                      Every execution teaches the system. AI extracts learnings and automatically refines playbooks over time.
                    </p>
                  </div>
                </div>
              </div>

              <div className="p-6 rounded-xl bg-gradient-to-br from-blue-500/10 to-purple-500/10 border border-blue-500/20 backdrop-blur-sm">
                <div className="text-center">
                  <div className="text-3xl font-bold text-white mb-2">
                    Top 1% of Fortune 1000
                  </div>
                  <p className="text-sm text-slate-400">
                    84.4% readiness places you in the elite tier of strategic execution velocity
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/homepage/McKinseyValidationSection.tsx
========================================
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { CheckCircle2, Clock, Users, Heart, ArrowRight } from 'lucide-react';
import FootballConnectionCallout from './FootballConnectionCallout';

export default function McKinseyValidationSection() {
  return (
    <section className="py-20 bg-blue-50 dark:bg-blue-900/10" data-testid="section-mckinsey-validation">
      <div className="container mx-auto px-4">
        <div className="max-w-6xl mx-auto">
          
          <div className="text-center mb-12">
            <Badge className="mb-4 bg-blue-600 text-white text-sm px-4 py-1" data-testid="badge-research-backed">
              Research Validation
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-4" data-testid="heading-mckinsey">
              McKinsey Confirms: Business Has the Coordination Problem Football Solved
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
              McKinsey research shows even high-performing companies lose 30% of 
              their strategic value to execution failures. Football's methodology closes this gap.
            </p>
          </div>

          <Card className="border-2 border-red-500 mb-8 overflow-hidden" data-testid="card-gap-explanation">
            <CardContent className="p-0">
              <div className="flex flex-col md:flex-row items-center">
                
                <div className="flex-shrink-0 bg-red-50 dark:bg-red-900/20 p-8 md:p-12">
                  <div className="w-40 h-40 bg-white dark:bg-gray-900 rounded-full 
                              flex items-center justify-center shadow-lg border-4 border-red-500">
                    <div className="text-center">
                      <div className="text-6xl font-bold text-red-600 dark:text-red-400" data-testid="text-gap-percent">30%</div>
                      <div className="text-sm text-muted-foreground mt-1">GAP</div>
                    </div>
                  </div>
                </div>

                <div className="flex-1 p-8 md:p-12">
                  <h3 className="text-2xl md:text-3xl font-bold mb-4">
                    The Strategy-to-Execution Gap
                  </h3>
                  <p className="text-lg text-muted-foreground mb-4">
                    McKinsey research reveals that even high-performing companies have 
                    a <strong>30% gap</strong> between their strategy's full potential 
                    and what is actually delivered.
                  </p>
                  <p className="text-lg font-semibold text-red-600 dark:text-red-400 mb-6">
                    This gap costs organizations millions in unrealized value and is 
                    attributed to shortcomings in their operating modelsspecifically 
                    how they coordinate decisions and execution.
                  </p>
                  <div className="flex flex-col sm:flex-row gap-3">
                    <Button size="lg" asChild data-testid="button-see-demo">
                      <a href="/demo-selector">
                        See How M Closes the Gap
                        <ArrowRight className="w-4 h-4 ml-2" />
                      </a>
                    </Button>
                    <Button size="lg" variant="outline" asChild data-testid="button-mckinsey-research">
                      <a href="https://www.mckinsey.com/capabilities/people-and-organizational-performance/our-insights/a-new-operating-model-for-a-new-world" target="_blank" rel="noopener noreferrer">
                        Read McKinsey Research
                      </a>
                    </Button>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>

          <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <Card className="text-center p-6 hover:shadow-lg transition-shadow" data-testid="card-outcome-clarity">
              <CheckCircle2 className="w-12 h-12 mx-auto mb-3 text-blue-600" />
              <h4 className="font-semibold text-lg mb-2">Clarity</h4>
              <p className="text-sm text-muted-foreground">
                Resources aligned to strategy
              </p>
            </Card>
            <Card className="text-center p-6 hover:shadow-lg transition-shadow" data-testid="card-outcome-speed">
              <Clock className="w-12 h-12 mx-auto mb-3 text-green-600" />
              <h4 className="font-semibold text-lg mb-2">Speed</h4>
              <p className="text-sm text-muted-foreground">
                Fast, frictionless workflows
              </p>
            </Card>
            <Card className="text-center p-6 hover:shadow-lg transition-shadow" data-testid="card-outcome-skills">
              <Users className="w-12 h-12 mx-auto mb-3 text-purple-600" />
              <h4 className="font-semibold text-lg mb-2">Skills</h4>
              <p className="text-sm text-muted-foreground">
                Future-ready workforce
              </p>
            </Card>
            <Card className="text-center p-6 hover:shadow-lg transition-shadow" data-testid="card-outcome-commitment">
              <Heart className="w-12 h-12 mx-auto mb-3 text-red-600" />
              <h4 className="font-semibold text-lg mb-2">Commitment</h4>
              <p className="text-sm text-muted-foreground">
                Performance-oriented culture
              </p>
            </Card>
          </div>

          <Card className="bg-primary text-primary-foreground" data-testid="card-four-outcomes-callout">
            <CardContent className="p-8 text-center">
              <h3 className="text-2xl font-bold mb-4">
                M Delivers McKinsey's Four Outcomes
              </h3>
              <p className="text-lg mb-6 opacity-90">
                McKinsey's research identified four measurable outcomes that drive 
                organizational performance: <strong>Clarity, Speed, Skills, and Commitment</strong>. 
                M is purpose-built to optimize all four.
              </p>
              <p className="text-xl font-semibold">
                From 30% execution gap to 95% strategic realization.
              </p>
            </CardContent>
          </Card>

          <FootballConnectionCallout 
            text="Football coaches close this gap by preparing playbooks before game day and coordinating execution in under 60 seconds. M brings that proven system to business strategy."
            testId="callout-mckinsey-connection"
          />

        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/homepage/MITCIOSection.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { TrendingUp, Zap, DollarSign, Award, ArrowRight } from 'lucide-react';
import FootballConnectionCallout from './FootballConnectionCallout';

export default function MITCIOSection() {
  return (
    <section className="py-20 bg-gradient-to-b from-background to-muted/20" data-testid="section-mit-cio">
      <div className="container mx-auto px-4">
        <div className="max-w-6xl mx-auto">

          <div className="text-center mb-12">
            <Badge className="mb-4 bg-purple-600 text-white text-sm px-4 py-1" data-testid="badge-research-validation">
              Research Validation
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-4" data-testid="heading-mit-cio">
              MIT Technology Review Validates: The Efficiency and Speed Football Delivers
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
              MIT Technology Review surveyed 600+ Fortune 1000 CIOs on AI's productivity impact. 
              Their findings confirm what football has proven for decades: systematic coordination 
              methodology delivers extraordinary efficiency gains.
            </p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            
            <Card className="border-2 border-blue-500" data-testid="card-process-efficiency">
              <CardHeader>
                <CardTitle className="flex items-center gap-2 text-blue-600">
                  <TrendingUp className="w-5 h-5" />
                  Efficiency Expectations
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div>
                  <p className="text-sm text-muted-foreground mb-1">MIT CIO Survey (600+ executives):</p>
                  <p className="text-3xl font-bold" data-testid="value-mit-efficiency">25%+ Gain</p>
                  <p className="text-xs text-muted-foreground mt-1">
                    81% expect AI to boost efficiency by 25%+ within 2 years
                  </p>
                </div>
                <div className="pt-4 border-t">
                  <p className="text-sm text-muted-foreground mb-1">M Delivers:</p>
                  <p className="text-3xl font-bold text-blue-600" data-testid="value-vexor-efficiency">360x Faster</p>
                  <p className="text-sm text-muted-foreground mt-1">
                    72 hours  12 minutes coordination
                  </p>
                </div>
              </CardContent>
            </Card>

            <Card className="border-2 border-green-500" data-testid="card-innovation-velocity">
              <CardHeader>
                <CardTitle className="flex items-center gap-2 text-green-600">
                  <Zap className="w-5 h-5" />
                  Peak Performance
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div>
                  <p className="text-sm text-muted-foreground mb-1">MIT CIO Survey (600+ executives):</p>
                  <p className="text-3xl font-bold" data-testid="value-mit-innovation">50%+ Gain</p>
                  <p className="text-xs text-muted-foreground mt-1">
                    33% expect efficiency gains of 50% or more
                  </p>
                </div>
                <div className="pt-4 border-t">
                  <p className="text-sm text-muted-foreground mb-1">M Delivers:</p>
                  <p className="text-3xl font-bold text-green-600" data-testid="value-vexor-innovation">2-4 Weeks</p>
                  <p className="text-sm text-muted-foreground mt-1">
                    Faster time-to-market (instant alignment)
                  </p>
                </div>
              </CardContent>
            </Card>

            <Card className="border-2 border-purple-500" data-testid="card-roi-governance">
              <CardHeader>
                <CardTitle className="flex items-center gap-2 text-purple-600">
                  <DollarSign className="w-5 h-5" />
                  Strategic Investment
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div>
                  <p className="text-sm text-muted-foreground mb-1">MIT CIO Survey (600+ executives):</p>
                  <p className="text-3xl font-bold" data-testid="value-mit-roi">46% Boost</p>
                  <p className="text-xs text-muted-foreground mt-1">
                    46% increasing AI budgets by 25%+ in next year
                  </p>
                </div>
                <div className="pt-4 border-t">
                  <p className="text-sm text-muted-foreground mb-1">M Delivers:</p>
                  <p className="text-3xl font-bold text-purple-600" data-testid="value-vexor-roi">$500K-$5M</p>
                  <p className="text-sm text-muted-foreground mt-1">
                    Annual value (governance built-in)
                  </p>
                </div>
              </CardContent>
            </Card>
          </div>

          <Card className="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 border-2 border-purple-500 mb-8" data-testid="card-cio-scaling">
            <CardContent className="p-8">
              <div className="flex flex-col md:flex-row items-center gap-6">
                <div className="flex-shrink-0">
                  <div className="w-24 h-24 bg-purple-600 rounded-full flex items-center justify-center">
                    <span className="text-3xl font-bold text-white" data-testid="text-cio-percent">64%</span>
                  </div>
                </div>
                <div className="flex-1 text-center md:text-left">
                  <h3 className="text-2xl font-bold mb-2">
                    CIOs Are Scaling AI Enterprise-Wide by 2026
                  </h3>
                  <p className="text-lg text-muted-foreground mb-4">
                    MIT research shows 64% of Fortune 1000 CIOs are scaling AI across 
                    their organizations. Most focus on knowledge workM addresses 
                    what they're missing: strategic coordination and execution velocity.
                  </p>
                  <div className="flex flex-col sm:flex-row gap-3 justify-center md:justify-start">
                    <Button size="lg" variant="default" asChild data-testid="button-see-vexor">
                      <a href="/demo-selector">
                        See M in Action
                        <ArrowRight className="w-4 h-4 ml-2" />
                      </a>
                    </Button>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card className="bg-muted/50" data-testid="card-mit-citation">
            <CardContent className="pt-6">
              <div className="flex items-start gap-4">
                <Award className="w-6 h-6 text-primary flex-shrink-0 mt-1" />
                <div className="space-y-2">
                  <p className="font-semibold">
                    Data Source: MIT Technology Review Insights
                  </p>
                  <p className="text-sm text-muted-foreground">
                    "Laying the Foundation for Data- and AI-Led Growth" (October 2023) 
                    surveyed 600+ CIOs, CTOs, and CDOs from Fortune 1000 companies. Key findings: 
                    81% expect AI to boost efficiency by at least 25% within 2 years, with 33% 
                    expecting gains of 50% or more. 100% of surveyed organizations will increase 
                    AI spending, with 46% boosting budgets by 25%+.
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          <FootballConnectionCallout 
            text="MIT found CIOs expect 25-50%+ efficiency gains from AI within 2 years. Football achieved 360x coordination speed decades ago through systematic playbooks. M delivers bothAI technology powered by proven football methodology."
            testId="callout-mit-connection"
          />

        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/homepage/ResearchValidationIntroSection.tsx
========================================
import { Card, CardContent } from "@/components/ui/card";

export default function ResearchValidationIntroSection() {
  return (
    <section className="py-16 bg-gradient-to-b from-muted/20 to-background">
      <div className="container mx-auto px-4">
        <div className="max-w-4xl mx-auto text-center">
          <Card className="border-2 border-primary/20 bg-background shadow-lg" data-testid="card-research-validation-intro">
            <CardContent className="p-8 md:p-12">
              <h2 className="text-4xl md:text-5xl font-bold mb-6" data-testid="text-research-validation-headline">
                Modern Research Confirms What Football Knew All Along
              </h2>
              <p className="text-xl text-muted-foreground leading-relaxed" data-testid="text-research-validation-description">
                For 100+ years, championship football teams have executed with precision. 
                Recent business research finally explains <strong>WHY</strong> this mattersand proves the 
                same coordination crisis exists in corporate America.
              </p>
            </CardContent>
          </Card>
        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/homepage/SalesforceSpeedSection.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Zap, Quote, ArrowRight, TrendingUp, AlertTriangle } from 'lucide-react';
import FootballConnectionCallout from './FootballConnectionCallout';

export default function SalesforceSpeedSection() {
  return (
    <section className="py-20 bg-orange-50 dark:bg-orange-900/10" data-testid="section-salesforce-speed">
      <div className="container mx-auto px-4">
        <div className="max-w-6xl mx-auto">

          <div className="text-center mb-12">
            <Badge className="mb-4 bg-orange-600 text-white text-sm px-4 py-1" data-testid="badge-research-validation">
              Research Validation
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-4" data-testid="heading-speed-currency">
              Industry Evolution: The Execution Velocity Football Perfected
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
              Business execution timelines have collapsed from years to months as competitive 
              pressure intensifies. Football achieved instant execution decades ago: from coach's 
              decision to coordinated action in under 60 seconds. M brings that velocity to business.
            </p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <Card className="text-center p-6 bg-gradient-to-br from-gray-50 to-white dark:from-gray-900/20 dark:to-background" data-testid="card-2000-era">
              <div className="mb-3">
                <span className="text-sm font-semibold">2000: Strategic Planning Era</span>
              </div>
              <div className="text-4xl font-bold text-muted-foreground mb-2">3-5 years</div>
              <p className="text-xs text-muted-foreground">
                Long-term strategic plans with annual reviews
              </p>
            </Card>

            <Card className="text-center p-6 bg-gradient-to-br from-blue-50 to-white dark:from-blue-900/20 dark:to-background" data-testid="card-2010-era">
              <div className="mb-3">
                <span className="text-sm font-semibold">2010: Digital Transformation</span>
              </div>
              <div className="text-4xl font-bold text-blue-600 dark:text-blue-400 mb-2">12-18 months</div>
              <p className="text-xs text-muted-foreground">
                Agile mindset with quarterly pivots
              </p>
            </Card>

            <Card className="text-center p-6 bg-gradient-to-br from-green-50 to-white dark:from-green-900/20 dark:to-background" data-testid="card-2020-era">
              <div className="mb-3">
                <span className="text-sm font-semibold">2020: Agile Organizations</span>
              </div>
              <div className="text-4xl font-bold text-green-600 dark:text-green-400 mb-2">3-6 months</div>
              <p className="text-xs text-muted-foreground">
                Continuous iteration with sprint-based delivery
              </p>
            </Card>

            <Card className="text-center p-6 bg-gradient-to-br from-orange-100 to-orange-50 dark:from-orange-900/40 dark:to-orange-900/20 border-2 border-orange-500" data-testid="card-2025-era">
              <div className="mb-3">
                <span className="text-sm font-semibold">2025: Augmented Execution</span>
              </div>
              <div className="text-4xl font-bold text-orange-600 dark:text-orange-400 mb-2">12 min</div>
              <p className="text-xs text-orange-600 dark:text-orange-400 font-semibold">
                M: Real-time strategic coordination
              </p>
            </Card>
          </div>

          <Card className="border-2 border-orange-500 mb-8" data-testid="card-old-vs-new">
            <CardContent className="p-8">
              <h3 className="text-2xl font-bold mb-6 text-center">
                The Old World vs. The New World
              </h3>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                  <div className="flex items-center gap-2 mb-4">
                    <AlertTriangle className="w-6 h-6 text-red-600" />
                    <h4 className="font-semibold text-lg">Old World (Coordination Bottleneck)</h4>
                  </div>
                  <ul className="space-y-3 text-sm text-muted-foreground">
                    <li className="flex items-start gap-2">
                      <span className="text-red-600 dark:text-red-400 font-bold mt-0.5"></span>
                      <span>Days/weeks to align 30 stakeholders across departments</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-red-600 dark:text-red-400 font-bold mt-0.5"></span>
                      <span>200+ emails per strategic decision</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-red-600 dark:text-red-400 font-bold mt-0.5"></span>
                      <span>20+ meetings to achieve coordination</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-red-600 dark:text-red-400 font-bold mt-0.5"></span>
                      <span>Opportunities missed while coordinating</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-red-600 dark:text-red-400 font-bold mt-0.5"></span>
                      <span>Competitors move faster</span>
                    </li>
                  </ul>
                </div>

                <div>
                  <div className="flex items-center gap-2 mb-4">
                    <Zap className="w-6 h-6 text-green-600" />
                    <h4 className="font-semibold text-lg">New World (M Velocity)</h4>
                  </div>
                  <ul className="space-y-3 text-sm text-muted-foreground">
                    <li className="flex items-start gap-2">
                      <span className="text-green-600 dark:text-green-400 font-bold mt-0.5"></span>
                      <span>12 minutes to coordinate 30 stakeholders globally</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-green-600 dark:text-green-400 font-bold mt-0.5"></span>
                      <span>1 activation replaces 200 emails</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-green-600 dark:text-green-400 font-bold mt-0.5"></span>
                      <span>Zero meetings required for execution</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-green-600 dark:text-green-400 font-bold mt-0.5"></span>
                      <span>Seize opportunities before competitors notice</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-green-600 dark:text-green-400 font-bold mt-0.5"></span>
                      <span>Become the "fast company" in your industry</span>
                    </li>
                  </ul>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card className="bg-gradient-to-r from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 border-2 border-orange-500 mb-8" data-testid="card-speed-quote">
            <CardContent className="p-8">
              <div className="flex flex-col md:flex-row gap-6 items-center">
                <div className="flex-shrink-0">
                  <div className="w-16 h-16 bg-orange-600 rounded-full flex items-center justify-center">
                    <Quote className="w-8 h-8 text-white" />
                  </div>
                </div>
                <div className="flex-1 text-center md:text-left">
                  <blockquote className="text-xl md:text-2xl font-semibold mb-3">
                    "Customer expectations keep going up: they want superior service, 
                    and they want it now."
                  </blockquote>
                  <p className="text-sm text-muted-foreground">
                     Salesforce Research, "State of the Connected Customer" (6th Edition, 2023)
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <Card className="text-center p-6" data-testid="card-stat-faster">
              <div className="text-4xl font-bold text-orange-600 dark:text-orange-400 mb-2">88%</div>
              <p className="text-sm text-muted-foreground">
                of customers more likely to buy when companies meet speed expectations
              </p>
              <p className="text-xs text-muted-foreground mt-1">
                (Salesforce Connected Customer, 2023)
              </p>
            </Card>

            <Card className="text-center p-6" data-testid="card-stat-waste">
              <div className="text-4xl font-bold text-red-600 dark:text-red-400 mb-2">70%</div>
              <p className="text-sm text-muted-foreground">
                of time wasted on coordination overhead
              </p>
              <p className="text-xs text-muted-foreground mt-1">
                (Common enterprise pattern)
              </p>
            </Card>

            <Card className="text-center p-6" data-testid="card-stat-compressed">
              <div className="text-4xl font-bold text-blue-600 dark:text-blue-400 mb-2">80%</div>
              <p className="text-sm text-muted-foreground">
                say experience is as important as products/services
              </p>
              <p className="text-xs text-muted-foreground mt-1">
                (Salesforce Connected Customer, 2023)
              </p>
            </Card>

            <Card className="text-center p-6 bg-gradient-to-br from-orange-100 to-orange-50 dark:from-orange-900/40 dark:to-orange-900/20 border-2 border-orange-500" data-testid="card-stat-advantage">
              <div className="text-4xl font-bold text-orange-600 dark:text-orange-400 mb-2">99.7%</div>
              <p className="text-sm font-semibold text-orange-600 dark:text-orange-400">
                faster with M (72h  12min)
              </p>
            </Card>
          </div>

          <Card className="bg-primary text-primary-foreground" data-testid="card-strategic-implication">
            <CardContent className="p-8">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <h4 className="font-semibold mb-2 flex items-center gap-2">
                    <AlertTriangle className="w-5 h-5 text-yellow-300" />
                    The Risk of Being Slow
                  </h4>
                  <ul className="space-y-1 text-sm opacity-90">
                    <li> Competitors seize opportunities while you're coordinating</li>
                    <li> Market windows close before you can act</li>
                    <li> Crises escalate while stakeholders align</li>
                    <li> Customers choose faster-moving alternatives</li>
                  </ul>
                </div>
                <div>
                  <h4 className="font-semibold mb-2 flex items-center gap-2">
                    <Zap className="w-5 h-5 text-green-300" />
                    The Advantage of Speed
                  </h4>
                  <ul className="space-y-1 text-sm opacity-90">
                    <li> Execute strategic decisions in minutes, not weeks</li>
                    <li> Respond to market changes before competitors know they happened</li>
                    <li> Turn crises into competitive advantages through speed</li>
                    <li> Build reputation as the "fast company" in your industry</li>
                  </ul>
                </div>
              </div>

              <div className="pt-6 border-t border-primary-foreground/20 text-center mt-6">
                <p className="text-lg font-semibold mb-4">
                  In a world where speed is currency, coordination is either your 
                  competitive advantage or your bottleneck.
                </p>
                <Button size="lg" variant="secondary" asChild data-testid="button-speed-demo">
                  <a href="/demo-selector">
                    See M's Speed in Action
                    <ArrowRight className="w-5 h-5 ml-2" />
                  </a>
                </Button>
              </div>
            </CardContent>
          </Card>

          <FootballConnectionCallout 
            text="Football perfected execution velocity through systematic playbooks and instant coordination. While business timelines collapsed from years to months, football had already achieved minutes. M applies football's proven methodology to close the gap."
            testId="callout-salesforce-speed-connection"
          />

        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/homepage/SalesforceTimeSection.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Clock, CheckCircle2, Zap, DollarSign, ArrowRight } from 'lucide-react';
import { Progress } from '@/components/ui/progress';
import FootballConnectionCallout from './FootballConnectionCallout';

export default function SalesforceTimeSection() {
  return (
    <section className="py-20 bg-gradient-to-b from-background to-muted/20" data-testid="section-salesforce-time">
      <div className="container mx-auto px-4">
        <div className="max-w-6xl mx-auto">

          <div className="text-center mb-12">
            <Badge className="mb-4 bg-orange-600 text-white text-sm px-4 py-1" data-testid="badge-research-validation">
              Research Validation
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-4" data-testid="heading-time-crisis">
              The Coordination Crisis: Business Wastes Time Football Eliminated Decades Ago
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
              Enterprise teams waste up to 70% of their time on coordination overhead 
              instead of execution. Football teams solved this decades ago with playbooks 
              and no-huddle executionM brings that proven efficiency to business.
            </p>
          </div>

          <Card className="border-2 border-orange-500 mb-8" data-testid="card-time-breakdown">
            <CardContent className="p-8">
              <h3 className="text-2xl font-bold mb-6 text-center">
                Where Strategic Execution Time Goes (Traditional Methods)
              </h3>
              
              <div className="space-y-6">
                <div>
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium">Scheduling & Coordinating Meetings</span>
                    <span className="text-sm font-bold text-orange-600 dark:text-orange-400">25%</span>
                  </div>
                  <Progress value={25} className="h-3" />
                </div>

                <div>
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium">Email Chains & Status Updates</span>
                    <span className="text-sm font-bold text-orange-600 dark:text-orange-400">20%</span>
                  </div>
                  <Progress value={20} className="h-3" />
                </div>

                <div>
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium">Finding Information & Documents</span>
                    <span className="text-sm font-bold text-orange-600 dark:text-orange-400">15%</span>
                  </div>
                  <Progress value={15} className="h-3" />
                </div>

                <div>
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium">Clarifying Roles & Responsibilities</span>
                    <span className="text-sm font-bold text-orange-600 dark:text-orange-400">10%</span>
                  </div>
                  <Progress value={10} className="h-3" />
                </div>

                <div className="pt-4 border-t">
                  <div className="flex items-center justify-between">
                    <span className="text-lg font-bold">Time Actually Executing Strategy</span>
                    <span className="text-lg font-bold text-green-600 dark:text-green-400">30%</span>
                  </div>
                  <Progress value={30} className="h-3 mt-2" />
                </div>
              </div>

              <div className="mt-6 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg text-center">
                <p className="text-lg font-semibold text-red-600 dark:text-red-400">
                  70% of time wasted on coordination overhead instead of execution
                </p>
                <p className="text-xs text-muted-foreground mt-2">
                  Based on common enterprise execution patterns
                </p>
              </div>
            </CardContent>
          </Card>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <Card className="border-2 hover:border-green-500 transition-colors" data-testid="card-vexor-solution">
              <CardHeader>
                <Zap className="w-12 h-12 mb-3 text-green-600" />
                <CardTitle className="text-xl">M's Solution</CardTitle>
              </CardHeader>
              <CardContent>
                <ul className="space-y-2 text-sm text-muted-foreground">
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>From 200 emails  1 activation</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>From 20 meetings  0 meetings</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>From 72 hours  12 minutes</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>From calendar Tetris  instant alignment</span>
                  </li>
                </ul>
              </CardContent>
            </Card>

            <Card className="border-2 hover:border-blue-500 transition-colors" data-testid="card-exec-time">
              <CardHeader>
                <Clock className="w-12 h-12 mb-3 text-blue-600" />
                <CardTitle className="text-xl">Executive Time Reclaimed</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-xs text-muted-foreground mb-3">M customer outcomes:</p>
                <ul className="space-y-2 text-sm text-muted-foreground">
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>C-suite saves 15-20 hours per week</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>VP-level saves 10-15 hours per week</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>Managers save 5-10 hours per week</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>Redirect time to strategic thinking</span>
                  </li>
                </ul>
              </CardContent>
            </Card>

            <Card className="border-2 hover:border-purple-500 transition-colors" data-testid="card-roi-impact">
              <CardHeader>
                <DollarSign className="w-12 h-12 mb-3 text-purple-600" />
                <CardTitle className="text-xl">ROI Impact</CardTitle>
              </CardHeader>
              <CardContent>
                <ul className="space-y-2 text-sm text-muted-foreground">
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>$500K-$5M annual time savings</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>360x faster coordination</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>70% reduction in overhead</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span>Higher strategic execution rate</span>
                  </li>
                </ul>
              </CardContent>
            </Card>
          </div>

          <Card className="bg-gradient-to-r from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 border-2 border-orange-500" data-testid="card-time-cta">
            <CardContent className="p-8 text-center">
              <h3 className="text-2xl font-bold mb-4">
                Stop Wasting Time. Start Executing.
              </h3>
              <p className="text-lg mb-6 text-muted-foreground max-w-2xl mx-auto">
                Watch how M eliminates coordination overhead and reclaims 70% 
                of your team's strategic execution time.
              </p>
              <Button size="lg" asChild data-testid="button-see-time-demo">
                <a href="/demo-selector">
                  See M Eliminate Coordination Friction
                  <ArrowRight className="w-5 h-5 ml-2" />
                </a>
              </Button>
            </CardContent>
          </Card>

          <FootballConnectionCallout 
            text="Football eliminated coordination overhead by removing the huddle and using instant play-calling. No meetings required. M applies the same principle: from decision to execution in 12 minutes."
            testId="callout-salesforce-connection"
          />

        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/homepage/StrategyVelocityIndex.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { TrendingUp, Clock, Zap, CheckCircle2 } from 'lucide-react';

export default function StrategyVelocityIndex() {
  return (
    <section className="py-20 bg-gradient-to-b from-background to-blue-50/30 dark:to-blue-900/10" data-testid="section-velocity-index">
      <div className="container mx-auto px-4">
        <div className="max-w-6xl mx-auto">

          <div className="text-center mb-12">
            <Badge className="mb-4 bg-blue-600 text-white text-sm px-4 py-1" data-testid="badge-velocity-index">
              Strategy Velocity Index
            </Badge>
            <h2 className="text-4xl md:text-5xl font-bold mb-4" data-testid="heading-velocity-index">
              The Companies Winning Aren't the Ones with the Best Plans
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
              They're the ones who execute and adapt faster than technology evolves. 
              M delivers the execution velocity that separates leaders from laggards.
            </p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            
            <Card className="border-2 border-blue-500 hover:shadow-xl transition-shadow" data-testid="card-time-to-execution">
              <CardHeader>
                <div className="flex items-center justify-between mb-2">
                  <Clock className="w-10 h-10 text-blue-600" />
                  <Badge className="bg-green-600 text-white">360x</Badge>
                </div>
                <CardTitle className="text-xl">Time to Execution</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <div>
                    <p className="text-sm text-muted-foreground mb-1">Industry Average:</p>
                    <p className="text-3xl font-bold text-red-600" data-testid="value-industry-time">72 hours</p>
                    <p className="text-xs text-muted-foreground mt-1">Email, meetings, coordination delays</p>
                  </div>
                  <div className="h-px bg-border" />
                  <div>
                    <p className="text-sm text-muted-foreground mb-1">M Performance:</p>
                    <p className="text-3xl font-bold text-green-600" data-testid="value-vexor-time">12 minutes</p>
                    <p className="text-xs text-muted-foreground mt-1">Conversation  Coordination  Execution</p>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card className="border-2 border-purple-500 hover:shadow-xl transition-shadow" data-testid="card-execution-gap">
              <CardHeader>
                <div className="flex items-center justify-between mb-2">
                  <TrendingUp className="w-10 h-10 text-purple-600" />
                  <Badge className="bg-purple-600 text-white">95%</Badge>
                </div>
                <CardTitle className="text-xl">Execution Gap Closure</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <div>
                    <p className="text-sm text-muted-foreground mb-1">Industry Baseline (McKinsey):</p>
                    <p className="text-3xl font-bold text-orange-600" data-testid="value-industry-gap">30% Gap</p>
                    <p className="text-xs text-muted-foreground mt-1">Strategy to execution value loss</p>
                  </div>
                  <div className="h-px bg-border" />
                  <div>
                    <p className="text-sm text-muted-foreground mb-1">M Performance:</p>
                    <p className="text-3xl font-bold text-purple-600" data-testid="value-vexor-gap">95% Realized</p>
                    <p className="text-xs text-muted-foreground mt-1">Strategic value delivered to execution</p>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card className="border-2 border-green-500 hover:shadow-xl transition-shadow" data-testid="card-autonomous-assist">
              <CardHeader>
                <div className="flex items-center justify-between mb-2">
                  <Zap className="w-10 h-10 text-green-600" />
                  <Badge className="bg-green-600 text-white">AI-Powered</Badge>
                </div>
                <CardTitle className="text-xl">Autonomous Assist Rate</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <div>
                    <p className="text-sm text-muted-foreground mb-1">Manual Coordination:</p>
                    <p className="text-3xl font-bold text-red-600" data-testid="value-manual-rate">100% Human</p>
                    <p className="text-xs text-muted-foreground mt-1">Every task requires human coordination</p>
                  </div>
                  <div className="h-px bg-border" />
                  <div>
                    <p className="text-sm text-muted-foreground mb-1">M AI Assist:</p>
                    <p className="text-3xl font-bold text-green-600" data-testid="value-ai-assist-rate">67%</p>
                    <p className="text-xs text-muted-foreground mt-1">AI handles coordination, humans focus on judgment</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          <Card className="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border-2 border-blue-500" data-testid="card-velocity-quote">
            <CardContent className="p-8">
              <div className="flex flex-col md:flex-row items-center gap-6">
                <div className="flex-shrink-0">
                  <div className="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center">
                    <TrendingUp className="w-10 h-10 text-white" />
                  </div>
                </div>
                <div className="flex-1 text-center md:text-left">
                  <blockquote className="text-xl md:text-2xl font-semibold mb-3">
                    "Speed is the new currency of business."
                  </blockquote>
                  <p className="text-sm text-muted-foreground">
                     Marc Benioff, Salesforce CEO (World Economic Forum, Davos 2016)
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          <div className="mt-8 text-center">
            <div className="inline-flex items-start gap-2 bg-muted/50 rounded-lg p-4 text-left max-w-2xl">
              <CheckCircle2 className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
              <div className="text-sm text-muted-foreground">
                <strong>Sources:</strong> Time-to-execution metrics based on McKinsey research on strategy-to-execution gaps 
                and MIT Technology Review CIO survey data. 
                M performance data from live demo scenarios modeling Fortune 1000 use cases.
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>
  );
}


========================================
FILE: client/src/components/onboarding/OnboardingOverlay.tsx
========================================
import { useEffect, useRef, useState } from 'react';
import { createPortal } from 'react-dom';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { useOnboarding, pageOnboardingConfigs } from '@/contexts/OnboardingContext';
import { 
  ChevronRight, 
  ChevronLeft, 
  X, 
  Lightbulb,
  Target,
  Eye,
  Zap,
  GraduationCap
} from 'lucide-react';

const phaseIcons = {
  IDENTIFY: Target,
  DETECT: Eye,
  EXECUTE: Zap,
  ADVANCE: GraduationCap
};

const phaseColors = {
  IDENTIFY: 'bg-violet-600',
  DETECT: 'bg-blue-600',
  EXECUTE: 'bg-emerald-600',
  ADVANCE: 'bg-amber-600'
};

export default function OnboardingOverlay() {
  const { 
    state, 
    getCurrentStep, 
    getCurrentPageSteps,
    nextStep, 
    prevStep, 
    skipOnboarding,
    dismissOnboarding
  } = useOnboarding();

  const [highlightedElement, setHighlightedElement] = useState<HTMLElement | null>(null);
  const [originalStyles, setOriginalStyles] = useState<Record<string, string>>({});
  const overlayRef = useRef<HTMLDivElement>(null);

  const currentStep = getCurrentStep();
  const steps = getCurrentPageSteps();
  const progress = steps.length > 0 ? ((state.currentStep + 1) / steps.length) * 100 : 0;
  const config = state.currentPage ? pageOnboardingConfigs[state.currentPage] : null;

  useEffect(() => {
    if (highlightedElement && Object.keys(originalStyles).length > 0) {
      highlightedElement.style.zIndex = originalStyles.zIndex || '';
      highlightedElement.style.position = originalStyles.position || '';
      highlightedElement.style.boxShadow = originalStyles.boxShadow || '';
      highlightedElement.style.outline = originalStyles.outline || '';
    }

    if (!state.isActive || !currentStep?.targetElement) {
      setHighlightedElement(null);
      return;
    }

    const timer = setTimeout(() => {
      const element = document.querySelector(`[data-testid="${currentStep.targetElement}"]`) as HTMLElement;
      if (element) {
        setOriginalStyles({
          zIndex: element.style.zIndex,
          position: element.style.position,
          boxShadow: element.style.boxShadow,
          outline: element.style.outline
        });

        element.style.zIndex = '9999';
        element.style.position = 'relative';
        element.style.boxShadow = '0 0 0 4px rgba(59, 130, 246, 0.6), 0 0 30px rgba(59, 130, 246, 0.3)';
        element.style.outline = '2px solid rgb(59, 130, 246)';

        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        setHighlightedElement(element);
      }
    }, 300);

    return () => clearTimeout(timer);
  }, [state.isActive, currentStep?.targetElement, state.currentStep]);

  useEffect(() => {
    return () => {
      if (highlightedElement && Object.keys(originalStyles).length > 0) {
        highlightedElement.style.zIndex = originalStyles.zIndex || '';
        highlightedElement.style.position = originalStyles.position || '';
        highlightedElement.style.boxShadow = originalStyles.boxShadow || '';
        highlightedElement.style.outline = originalStyles.outline || '';
      }
    };
  }, []);

  if (!state.isActive || !currentStep || !config) return null;

  const PhaseIcon = currentStep.phase ? phaseIcons[currentStep.phase] : Lightbulb;
  const phaseColor = currentStep.phase ? phaseColors[currentStep.phase] : 'bg-blue-600';

  return createPortal(
    <>
      <div 
        className="fixed inset-0 bg-black/40 z-[9998]" 
        onClick={dismissOnboarding}
        data-testid="onboarding-backdrop"
      />

      <div 
        ref={overlayRef}
        className="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-lg px-4"
        data-testid="onboarding-overlay"
      >
        <Card className="bg-slate-900/98 border-blue-500/50 shadow-2xl backdrop-blur-md">
          <CardContent className="p-5">
            <div className="flex items-start justify-between mb-4">
              <div className="flex items-center gap-3">
                <div className={`w-10 h-10 ${phaseColor} rounded-lg flex items-center justify-center`}>
                  <PhaseIcon className="h-5 w-5 text-white" />
                </div>
                <div>
                  <div className="flex items-center gap-2">
                    <h3 className="text-white font-semibold text-lg" data-testid="onboarding-title">
                      {currentStep.title}
                    </h3>
                    {currentStep.phase && (
                      <Badge 
                        variant="outline" 
                        className="text-xs border-blue-500/50 text-blue-300"
                        data-testid="onboarding-phase-badge"
                      >
                        {currentStep.phase}
                      </Badge>
                    )}
                  </div>
                  <p className="text-gray-400 text-xs">{config.pageName}</p>
                </div>
              </div>
              <Button
                size="sm"
                variant="ghost"
                onClick={dismissOnboarding}
                className="text-gray-400 hover:text-white hover:bg-white/10 -mt-1 -mr-2"
                data-testid="onboarding-close"
              >
                <X className="h-4 w-4" />
              </Button>
            </div>

            <p className="text-gray-200 text-sm leading-relaxed mb-4" data-testid="onboarding-description">
              {currentStep.description}
            </p>

            <div className="mb-4">
              <div className="flex items-center justify-between text-xs text-gray-400 mb-1">
                <span>Step {state.currentStep + 1} of {steps.length}</span>
                <span>{Math.round(progress)}%</span>
              </div>
              <Progress value={progress} className="h-1.5" />
            </div>

            <div className="flex items-center justify-between">
              <Button
                variant="ghost"
                size="sm"
                onClick={skipOnboarding}
                className="text-gray-400 hover:text-white text-xs"
                data-testid="onboarding-skip"
              >
                Skip tour
              </Button>

              <div className="flex items-center gap-2">
                <Button
                  size="sm"
                  variant="outline"
                  onClick={prevStep}
                  disabled={state.currentStep === 0}
                  className="border-gray-600 text-gray-300 hover:bg-white/10"
                  data-testid="onboarding-prev"
                >
                  <ChevronLeft className="h-4 w-4" />
                </Button>
                <Button
                  size="sm"
                  onClick={nextStep}
                  className="bg-blue-600 hover:bg-blue-700 text-white"
                  data-testid="onboarding-next"
                >
                  {state.currentStep >= steps.length - 1 ? 'Done' : 'Next'}
                  {state.currentStep < steps.length - 1 && <ChevronRight className="h-4 w-4 ml-1" />}
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </>,
    document.body
  );
}


========================================
FILE: client/src/components/onboarding/OnboardingTrigger.tsx
========================================
import { useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { useOnboarding } from '@/contexts/OnboardingContext';
import { HelpCircle } from 'lucide-react';

interface OnboardingTriggerProps {
  pageId: string;
  autoStart?: boolean;
  className?: string;
}

export default function OnboardingTrigger({ pageId, autoStart = true, className = '' }: OnboardingTriggerProps) {
  const { startOnboarding, isPageOnboarded, state } = useOnboarding();

  useEffect(() => {
    if (autoStart && !isPageOnboarded(pageId) && !state.isActive) {
      const timer = setTimeout(() => {
        startOnboarding(pageId);
      }, 1500);
      return () => clearTimeout(timer);
    }
  }, [pageId, autoStart, isPageOnboarded, startOnboarding, state.isActive]);

  return (
    <Button
      variant="outline"
      size="sm"
      onClick={() => startOnboarding(pageId)}
      className={`gap-2 ${className}`}
      data-testid={`onboarding-trigger-${pageId}`}
    >
      <HelpCircle className="h-4 w-4" />
      <span className="hidden sm:inline">Tour</span>
    </Button>
  );
}


========================================
FILE: client/src/components/ai/AIPrinciplesScorecard.tsx
========================================
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip';
import {
  Shield,
  Lock,
  Eye,
  CheckCircle,
  Scale,
  Users,
  Leaf,
  HelpCircle,
  Brain,
} from 'lucide-react';

export interface AIPrincipleScore {
  principle: string;
  score: number;
  description: string;
  icon: keyof typeof PRINCIPLE_ICONS;
}

const PRINCIPLE_ICONS = {
  safety: Shield,
  privacy: Lock,
  transparency: Eye,
  reliability: CheckCircle,
  fairness: Scale,
  accountability: Users,
  sustainability: Leaf,
  contestability: HelpCircle,
  humanAgency: Brain,
};

export const FOUNDATIONAL_AI_PRINCIPLES: AIPrincipleScore[] = [
  {
    principle: 'Safety & Security',
    score: 95,
    description: 'AI systems designed with robust safeguards against harmful outputs and security vulnerabilities',
    icon: 'safety',
  },
  {
    principle: 'Data Privacy',
    score: 92,
    description: 'Strong data protection measures ensuring personal and sensitive data is handled responsibly',
    icon: 'privacy',
  },
  {
    principle: 'Explainability & Transparency',
    score: 88,
    description: 'AI decisions can be understood and explained to stakeholders and regulators',
    icon: 'transparency',
  },
  {
    principle: 'Validity & Reliability',
    score: 94,
    description: 'AI outputs are accurate, consistent, and dependable across operating conditions',
    icon: 'reliability',
  },
  {
    principle: 'Fairness & Bias Detection',
    score: 89,
    description: 'Systems actively monitor and mitigate algorithmic bias and discrimination',
    icon: 'fairness',
  },
  {
    principle: 'Accountability',
    score: 96,
    description: 'Clear ownership and responsibility chains for AI decisions and outcomes',
    icon: 'accountability',
  },
  {
    principle: 'Sustainability',
    score: 82,
    description: 'AI systems designed for energy efficiency and minimal environmental impact',
    icon: 'sustainability',
  },
  {
    principle: 'Contestability',
    score: 85,
    description: 'Mechanisms for individuals to challenge AI decisions that affect them',
    icon: 'contestability',
  },
  {
    principle: 'Human Agency & Autonomy',
    score: 98,
    description: 'AI augments human decision-making while preserving human control and oversight',
    icon: 'humanAgency',
  },
];

function getScoreColor(score: number): string {
  if (score >= 90) return 'text-emerald-600 dark:text-emerald-400';
  if (score >= 80) return 'text-blue-600 dark:text-blue-400';
  if (score >= 70) return 'text-yellow-600 dark:text-yellow-400';
  return 'text-red-600 dark:text-red-400';
}

function getProgressColor(score: number): string {
  if (score >= 90) return 'bg-emerald-500';
  if (score >= 80) return 'bg-blue-500';
  if (score >= 70) return 'bg-yellow-500';
  return 'bg-red-500';
}

interface AIPrinciplesScorecardProps {
  principles?: AIPrincipleScore[];
  compact?: boolean;
  showOverallScore?: boolean;
}

export function AIPrinciplesScorecard({
  principles = FOUNDATIONAL_AI_PRINCIPLES,
  compact = false,
  showOverallScore = true,
}: AIPrinciplesScorecardProps) {
  const overallScore = Math.round(
    principles.reduce((sum, p) => sum + p.score, 0) / principles.length
  );

  if (compact) {
    return (
      <div className="flex items-center gap-2">
        <Badge 
          variant="outline" 
          className={`${getScoreColor(overallScore)} border-current`}
        >
          <Brain className="w-3 h-3 mr-1" />
          AI Principles: {overallScore}%
        </Badge>
      </div>
    );
  }

  return (
    <Card className="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700">
      <CardHeader className="pb-4">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <div>
            <CardTitle className="text-base font-semibold flex items-center gap-2">
              <Brain className="w-5 h-5 text-violet-600 dark:text-violet-400" />
              AI Principles Alignment
            </CardTitle>
            <p className="text-xs text-muted-foreground mt-1">
              Based on AI Trends 2026 governance framework
            </p>
          </div>
          {showOverallScore && (
            <div className="flex items-center gap-2">
              <span className="text-xs text-muted-foreground">Overall Score</span>
              <Badge 
                className={`text-base font-bold px-3 py-1 ${
                  overallScore >= 90 
                    ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/50 dark:text-emerald-300' 
                    : 'bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300'
                }`}
              >
                {overallScore}%
              </Badge>
            </div>
          )}
        </div>
      </CardHeader>
      <CardContent className="pt-0">
        <TooltipProvider>
          <div className="space-y-2">
            {principles.map((principle) => {
              const Icon = PRINCIPLE_ICONS[principle.icon] || Shield;
              return (
                <Tooltip key={principle.principle}>
                  <TooltipTrigger asChild>
                    <div className="flex items-center gap-3 py-2 px-3 rounded-md hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors cursor-help">
                      <Icon className="w-4 h-4 text-violet-600 dark:text-violet-400 flex-shrink-0" />
                      <span className="text-sm flex-1 min-w-0">
                        {principle.principle}
                      </span>
                      <div className="flex items-center gap-3 flex-shrink-0">
                        <div className="w-24 hidden sm:block">
                          <Progress 
                            value={principle.score} 
                            className="h-1.5"
                          />
                        </div>
                        <span className={`text-sm font-semibold w-10 text-right ${getScoreColor(principle.score)}`}>
                          {principle.score}%
                        </span>
                      </div>
                    </div>
                  </TooltipTrigger>
                  <TooltipContent side="left" className="max-w-xs">
                    <p className="text-sm">{principle.description}</p>
                  </TooltipContent>
                </Tooltip>
              );
            })}
          </div>
        </TooltipProvider>
      </CardContent>
    </Card>
  );
}

export function DeterministicExecutionBadge() {
  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <Badge 
            className="bg-gradient-to-r from-emerald-600 to-teal-600 text-white border-0 cursor-help"
          >
            <CheckCircle className="w-3 h-3 mr-1" />
            Deterministic Execution
          </Badge>
        </TooltipTrigger>
        <TooltipContent side="top" className="max-w-xs">
          <p className="text-sm">
            Unlike autonomous AI agents, M delivers predictable, pre-defined playbook execution. 
            AI monitors and recommendshumans decide, playbooks execute exactly as designed.
          </p>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}

export default AIPrinciplesScorecard;


========================================
FILE: client/src/components/configuration/TriggerConfigurationWizard.tsx
========================================
import { useState, useEffect } from 'react';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Switch } from '@/components/ui/switch';
import { Badge } from '@/components/ui/badge';
import { Textarea } from '@/components/ui/textarea';
import { Progress } from '@/components/ui/progress';
import { Separator } from '@/components/ui/separator';
import { useToast } from '@/hooks/use-toast';
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
import { apiRequest } from '@/lib/queryClient';
import { 
  Target, 
  ArrowLeft, 
  ArrowRight, 
  Check, 
  AlertTriangle,
  Bell,
  Settings,
  Zap,
  TrendingUp,
  Users,
  DollarSign,
  Shield,
  Globe,
  Cpu,
  BarChart3,
  Activity,
  Eye,
  Mail,
  MessageSquare,
  Smartphone,
  Webhook,
  PlayCircle,
  Clock
} from 'lucide-react';

interface TriggerConfigurationWizardProps {
  isOpen: boolean;
  onClose: () => void;
  onSuccess?: () => void;
  editTrigger?: any;
}

const SIGNAL_CATEGORIES = [
  { id: 'competitive', name: 'Competitive Intelligence', icon: Target, color: 'text-purple-500', description: 'Track competitor moves, pricing, market share' },
  { id: 'market', name: 'Market Dynamics', icon: TrendingUp, color: 'text-blue-500', description: 'Monitor market trends, demand shifts, sentiment' },
  { id: 'financial', name: 'Financial Signals', icon: DollarSign, color: 'text-green-500', description: 'Track revenue, margins, cash flow indicators' },
  { id: 'regulatory', name: 'Regulatory & Compliance', icon: Shield, color: 'text-red-500', description: 'Monitor policy changes, compliance requirements' },
  { id: 'supplychain', name: 'Supply Chain', icon: Activity, color: 'text-orange-500', description: 'Track supplier health, logistics, inventory' },
  { id: 'customer', name: 'Customer Signals', icon: Users, color: 'text-indigo-500', description: 'Monitor NPS, churn, satisfaction metrics' },
  { id: 'talent', name: 'Talent & Workforce', icon: Users, color: 'text-pink-500', description: 'Track attrition, engagement, skill gaps' },
  { id: 'geopolitical', name: 'Geopolitical', icon: Globe, color: 'text-amber-500', description: 'Monitor regional stability, trade policies' },
  { id: 'technology', name: 'Technology', icon: Cpu, color: 'text-cyan-500', description: 'Track tech disruptions, infrastructure issues' },
  { id: 'media', name: 'Media & Reputation', icon: Eye, color: 'text-violet-500', description: 'Monitor brand mentions, sentiment, PR issues' },
  { id: 'cyber', name: 'Cybersecurity', icon: Shield, color: 'text-red-600', description: 'Track threat levels, vulnerabilities, incidents' },
  { id: 'economic', name: 'Economic Indicators', icon: BarChart3, color: 'text-emerald-500', description: 'Monitor GDP, inflation, interest rates' },
  { id: 'partnership', name: 'Partnership & Alliance', icon: Users, color: 'text-teal-500', description: 'Track partner health, joint venture status' },
  { id: 'execution', name: 'Execution Velocity', icon: Zap, color: 'text-yellow-500', description: 'Monitor project timelines, delivery metrics' },
  { id: 'behavior', name: 'Behavioral Analytics', icon: Activity, color: 'text-rose-500', description: 'Track user patterns, engagement shifts' },
  { id: 'innovation', name: 'Innovation Pipeline', icon: PlayCircle, color: 'text-sky-500', description: 'Monitor R&D progress, patent filings' },
];

const SIGNAL_FIELDS: Record<string, Array<{ id: string; name: string; unit: string }>> = {
  competitive: [
    { id: 'market_share_change', name: 'Market Share Change', unit: '%' },
    { id: 'competitor_price_change', name: 'Competitor Price Change', unit: '%' },
    { id: 'new_product_launches', name: 'New Product Launches', unit: 'count' },
    { id: 'competitor_hiring', name: 'Competitor Hiring Activity', unit: 'count' },
  ],
  market: [
    { id: 'demand_index', name: 'Demand Index', unit: 'score' },
    { id: 'market_sentiment', name: 'Market Sentiment Score', unit: '%' },
    { id: 'search_volume', name: 'Search Volume Change', unit: '%' },
    { id: 'industry_growth', name: 'Industry Growth Rate', unit: '%' },
  ],
  financial: [
    { id: 'revenue_variance', name: 'Revenue Variance', unit: '%' },
    { id: 'margin_change', name: 'Gross Margin Change', unit: '%' },
    { id: 'cash_flow_ratio', name: 'Cash Flow Ratio', unit: 'ratio' },
    { id: 'debt_to_equity', name: 'Debt to Equity Ratio', unit: 'ratio' },
  ],
  regulatory: [
    { id: 'compliance_score', name: 'Compliance Score', unit: '%' },
    { id: 'policy_change_count', name: 'Policy Changes', unit: 'count' },
    { id: 'audit_findings', name: 'Audit Findings', unit: 'count' },
    { id: 'regulatory_risk', name: 'Regulatory Risk Score', unit: 'score' },
  ],
  supplychain: [
    { id: 'supplier_health', name: 'Supplier Health Score', unit: '%' },
    { id: 'lead_time_variance', name: 'Lead Time Variance', unit: 'days' },
    { id: 'inventory_turnover', name: 'Inventory Turnover', unit: 'ratio' },
    { id: 'disruption_risk', name: 'Disruption Risk Level', unit: 'score' },
  ],
  customer: [
    { id: 'nps_score', name: 'Net Promoter Score', unit: 'score' },
    { id: 'churn_rate', name: 'Churn Rate', unit: '%' },
    { id: 'csat_score', name: 'Customer Satisfaction', unit: '%' },
    { id: 'ticket_volume', name: 'Support Ticket Volume', unit: 'count' },
  ],
  talent: [
    { id: 'attrition_rate', name: 'Attrition Rate', unit: '%' },
    { id: 'engagement_score', name: 'Employee Engagement', unit: '%' },
    { id: 'time_to_hire', name: 'Time to Hire', unit: 'days' },
    { id: 'training_completion', name: 'Training Completion', unit: '%' },
  ],
  geopolitical: [
    { id: 'stability_index', name: 'Political Stability Index', unit: 'score' },
    { id: 'trade_risk', name: 'Trade Risk Level', unit: 'score' },
    { id: 'currency_volatility', name: 'Currency Volatility', unit: '%' },
    { id: 'sanctions_risk', name: 'Sanctions Risk', unit: 'score' },
  ],
  technology: [
    { id: 'system_uptime', name: 'System Uptime', unit: '%' },
    { id: 'tech_debt_score', name: 'Technical Debt Score', unit: 'score' },
    { id: 'deployment_frequency', name: 'Deployment Frequency', unit: 'per_week' },
    { id: 'incident_count', name: 'Incident Count', unit: 'count' },
  ],
  media: [
    { id: 'sentiment_score', name: 'Brand Sentiment', unit: '%' },
    { id: 'mention_volume', name: 'Media Mentions', unit: 'count' },
    { id: 'share_of_voice', name: 'Share of Voice', unit: '%' },
    { id: 'crisis_probability', name: 'Crisis Probability', unit: '%' },
  ],
  cyber: [
    { id: 'threat_level', name: 'Threat Level', unit: 'score' },
    { id: 'vulnerability_count', name: 'Open Vulnerabilities', unit: 'count' },
    { id: 'failed_logins', name: 'Failed Login Attempts', unit: 'count' },
    { id: 'anomaly_score', name: 'Anomaly Score', unit: 'score' },
  ],
  economic: [
    { id: 'gdp_growth', name: 'GDP Growth Forecast', unit: '%' },
    { id: 'inflation_rate', name: 'Inflation Rate', unit: '%' },
    { id: 'interest_rate', name: 'Interest Rate Change', unit: '%' },
    { id: 'unemployment_rate', name: 'Unemployment Rate', unit: '%' },
  ],
  partnership: [
    { id: 'partner_health', name: 'Partner Health Score', unit: '%' },
    { id: 'contract_risk', name: 'Contract Risk', unit: 'score' },
    { id: 'revenue_share', name: 'Revenue Share Variance', unit: '%' },
    { id: 'sla_compliance', name: 'SLA Compliance', unit: '%' },
  ],
  execution: [
    { id: 'project_velocity', name: 'Project Velocity', unit: 'score' },
    { id: 'deadline_variance', name: 'Deadline Variance', unit: 'days' },
    { id: 'resource_utilization', name: 'Resource Utilization', unit: '%' },
    { id: 'milestone_completion', name: 'Milestone Completion', unit: '%' },
  ],
  behavior: [
    { id: 'engagement_rate', name: 'User Engagement Rate', unit: '%' },
    { id: 'session_duration', name: 'Avg Session Duration', unit: 'minutes' },
    { id: 'feature_adoption', name: 'Feature Adoption', unit: '%' },
    { id: 'conversion_rate', name: 'Conversion Rate', unit: '%' },
  ],
  innovation: [
    { id: 'rd_velocity', name: 'R&D Velocity', unit: 'score' },
    { id: 'patent_filings', name: 'Patent Filings', unit: 'count' },
    { id: 'prototype_completion', name: 'Prototype Completion', unit: '%' },
    { id: 'innovation_index', name: 'Innovation Index', unit: 'score' },
  ],
};

const OPERATORS = [
  { id: 'gt', name: 'Greater than', symbol: '>' },
  { id: 'lt', name: 'Less than', symbol: '<' },
  { id: 'gte', name: 'Greater than or equal', symbol: '>=' },
  { id: 'lte', name: 'Less than or equal', symbol: '<=' },
  { id: 'eq', name: 'Equal to', symbol: '=' },
  { id: 'change', name: 'Changes by', symbol: '' },
  { id: 'drop', name: 'Drops by', symbol: '' },
  { id: 'spike', name: 'Spikes by', symbol: '' },
];

const SEVERITY_LEVELS = [
  { id: 'low', name: 'Low', color: 'bg-blue-100 text-blue-800', description: 'Informational, monitor only' },
  { id: 'medium', name: 'Medium', color: 'bg-yellow-100 text-yellow-800', description: 'Requires attention within 24 hours' },
  { id: 'high', name: 'High', color: 'bg-orange-100 text-orange-800', description: 'Urgent, requires action within 4 hours' },
  { id: 'critical', name: 'Critical', color: 'bg-red-100 text-red-800', description: 'Emergency, immediate response required' },
];

const MONITORING_FREQUENCIES = [
  { id: 'realtime', name: 'Real-time', description: 'Continuous monitoring' },
  { id: '5min', name: 'Every 5 minutes', description: 'Near real-time' },
  { id: '15min', name: 'Every 15 minutes', description: 'Frequent checks' },
  { id: 'hourly', name: 'Hourly', description: 'Standard monitoring' },
  { id: 'daily', name: 'Daily', description: 'Daily digest' },
];

export default function TriggerConfigurationWizard({ 
  isOpen, 
  onClose, 
  onSuccess,
  editTrigger 
}: TriggerConfigurationWizardProps) {
  const { toast } = useToast();
  const queryClient = useQueryClient();
  const [step, setStep] = useState(1);
  const totalSteps = 4;
  
  // Form state
  const [triggerName, setTriggerName] = useState('');
  const [description, setDescription] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('');
  const [selectedField, setSelectedField] = useState('');
  const [operator, setOperator] = useState('gt');
  const [thresholdValue, setThresholdValue] = useState('');
  const [severity, setSeverity] = useState('medium');
  const [monitoringFrequency, setMonitoringFrequency] = useState('realtime');
  const [autoActivatePlaybook, setAutoActivatePlaybook] = useState(false);
  
  // Notification settings
  const [emailEnabled, setEmailEnabled] = useState(true);
  const [slackEnabled, setSlackEnabled] = useState(false);
  const [inAppEnabled, setInAppEnabled] = useState(true);
  const [webhookEnabled, setWebhookEnabled] = useState(false);
  const [escalationEnabled, setEscalationEnabled] = useState(true);
  const [escalationTimeout, setEscalationTimeout] = useState('30');
  
  // Playbook mapping
  const [selectedPlaybooks, setSelectedPlaybooks] = useState<string[]>([]);
  
  // Fetch available playbooks
  const { data: playbooks } = useQuery({
    queryKey: ['/api/playbooks'],
  });
  
  // Create trigger mutation
  const createTriggerMutation = useMutation({
    mutationFn: async (triggerData: any) => {
      return apiRequest('POST', '/api/config/triggers', triggerData);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/config/triggers'] });
      queryClient.invalidateQueries({ queryKey: ['/api/triggers'] });
      toast({
        title: 'Trigger Created',
        description: 'Your custom trigger has been configured successfully.',
      });
      onSuccess?.();
      handleClose();
    },
    onError: (error: any) => {
      toast({
        title: 'Error',
        description: error.message || 'Failed to create trigger',
        variant: 'destructive',
      });
    },
  });
  
  const handleClose = () => {
    setStep(1);
    setTriggerName('');
    setDescription('');
    setSelectedCategory('');
    setSelectedField('');
    setOperator('gt');
    setThresholdValue('');
    setSeverity('medium');
    setMonitoringFrequency('realtime');
    setAutoActivatePlaybook(false);
    setEmailEnabled(true);
    setSlackEnabled(false);
    setInAppEnabled(true);
    setWebhookEnabled(false);
    setEscalationEnabled(true);
    setEscalationTimeout('30');
    setSelectedPlaybooks([]);
    onClose();
  };
  
  const canProceed = () => {
    switch (step) {
      case 1:
        return triggerName && selectedCategory;
      case 2:
        return selectedField && operator && thresholdValue;
      case 3:
        return emailEnabled || slackEnabled || inAppEnabled || webhookEnabled;
      case 4:
        return true;
      default:
        return false;
    }
  };
  
  const handleNext = () => {
    if (step < totalSteps) {
      setStep(step + 1);
    } else {
      handleSubmit();
    }
  };
  
  const handleBack = () => {
    if (step > 1) {
      setStep(step - 1);
    }
  };
  
  const handleSubmit = () => {
    const selectedFieldData = SIGNAL_FIELDS[selectedCategory]?.find(f => f.id === selectedField);
    
    const triggerData = {
      name: triggerName,
      description,
      category: selectedCategory,
      signalType: selectedField,
      conditionField: selectedFieldData?.name || selectedField,
      conditionOperator: operator,
      conditionValue: parseFloat(thresholdValue),
      conditionUnit: selectedFieldData?.unit || '',
      severity,
      monitoringFrequency,
      autoActivatePlaybook,
      notificationChannels: {
        email: emailEnabled,
        slack: slackEnabled,
        inApp: inAppEnabled,
        webhook: webhookEnabled,
      },
      escalationEnabled,
      escalationTimeoutMinutes: parseInt(escalationTimeout),
      recommendedPlaybooks: selectedPlaybooks,
    };
    
    createTriggerMutation.mutate(triggerData);
  };
  
  const getFieldUnit = () => {
    if (!selectedCategory || !selectedField) return '';
    const field = SIGNAL_FIELDS[selectedCategory]?.find(f => f.id === selectedField);
    return field?.unit || '';
  };
  
  const togglePlaybook = (playbookId: string) => {
    setSelectedPlaybooks(prev => 
      prev.includes(playbookId)
        ? prev.filter(id => id !== playbookId)
        : [...prev, playbookId]
    );
  };

  return (
    <Dialog open={isOpen} onOpenChange={handleClose}>
      <DialogContent className="max-w-4xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2 text-xl">
            <Target className="h-6 w-6 text-blue-600" />
            {editTrigger ? 'Edit Trigger' : 'Create Custom Trigger'}
          </DialogTitle>
          <DialogDescription>
            Define YOUR monitoring conditions - M AI will monitor 24/7 and alert you when triggers fire
          </DialogDescription>
        </DialogHeader>
        
        {/* Progress indicator */}
        <div className="mb-6">
          <div className="flex items-center justify-between mb-2">
            <span className="text-sm text-gray-500">Step {step} of {totalSteps}</span>
            <span className="text-sm font-medium">
              {step === 1 && 'Category & Basics'}
              {step === 2 && 'Conditions'}
              {step === 3 && 'Notifications'}
              {step === 4 && 'Playbook Mapping'}
            </span>
          </div>
          <Progress value={(step / totalSteps) * 100} className="h-2" />
          
          <div className="flex justify-between mt-2">
            {[1, 2, 3, 4].map((s) => (
              <div 
                key={s} 
                className={`flex items-center gap-1 text-xs ${s <= step ? 'text-blue-600' : 'text-gray-400'}`}
              >
                <div className={`w-6 h-6 rounded-full flex items-center justify-center ${
                  s < step ? 'bg-blue-600 text-white' : 
                  s === step ? 'bg-blue-100 text-blue-600 border-2 border-blue-600' : 
                  'bg-gray-100 text-gray-400'
                }`}>
                  {s < step ? <Check className="h-3 w-3" /> : s}
                </div>
                <span className="hidden md:inline">
                  {s === 1 && 'Category'}
                  {s === 2 && 'Conditions'}
                  {s === 3 && 'Notify'}
                  {s === 4 && 'Playbooks'}
                </span>
              </div>
            ))}
          </div>
        </div>
        
        <Separator className="my-4" />
        
        {/* Step 1: Category & Basics */}
        {step === 1 && (
          <div className="space-y-6">
            <div className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="trigger-name">Trigger Name *</Label>
                <Input
                  id="trigger-name"
                  placeholder="e.g., NPS Score Drop Alert"
                  value={triggerName}
                  onChange={(e) => setTriggerName(e.target.value)}
                  data-testid="input-trigger-name"
                />
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="description">Description</Label>
                <Textarea
                  id="description"
                  placeholder="Describe when this trigger should fire and what action should be taken..."
                  value={description}
                  onChange={(e) => setDescription(e.target.value)}
                  data-testid="input-trigger-description"
                />
              </div>
            </div>
            
            <div className="space-y-3">
              <Label>Select Signal Category *</Label>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                {SIGNAL_CATEGORIES.map((category) => {
                  const Icon = category.icon;
                  const isSelected = selectedCategory === category.id;
                  return (
                    <Card 
                      key={category.id}
                      className={`cursor-pointer transition-all hover:shadow-md ${
                        isSelected ? 'ring-2 ring-blue-600 bg-blue-50 dark:bg-blue-900/20' : ''
                      }`}
                      onClick={() => {
                        setSelectedCategory(category.id);
                        setSelectedField('');
                      }}
                      data-testid={`category-card-${category.id}`}
                    >
                      <CardContent className="p-4">
                        <div className="flex flex-col items-center text-center gap-2">
                          <Icon className={`h-6 w-6 ${category.color}`} />
                          <span className="text-sm font-medium">{category.name}</span>
                        </div>
                      </CardContent>
                    </Card>
                  );
                })}
              </div>
              
              {selectedCategory && (
                <p className="text-sm text-gray-500 mt-2">
                  {SIGNAL_CATEGORIES.find(c => c.id === selectedCategory)?.description}
                </p>
              )}
            </div>
          </div>
        )}
        
        {/* Step 2: Conditions */}
        {step === 2 && (
          <div className="space-y-6">
            <div className="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200">
              <div className="flex items-center gap-2 mb-2">
                <AlertTriangle className="h-5 w-5 text-blue-600" />
                <span className="font-medium text-blue-800 dark:text-blue-200">
                  Category: {SIGNAL_CATEGORIES.find(c => c.id === selectedCategory)?.name}
                </span>
              </div>
              <p className="text-sm text-blue-700 dark:text-blue-300">
                Define the specific condition that will trigger an alert
              </p>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="space-y-2">
                <Label>Select Metric to Monitor *</Label>
                <Select value={selectedField} onValueChange={setSelectedField}>
                  <SelectTrigger data-testid="select-field">
                    <SelectValue placeholder="Choose a metric..." />
                  </SelectTrigger>
                  <SelectContent>
                    {SIGNAL_FIELDS[selectedCategory]?.map((field) => (
                      <SelectItem key={field.id} value={field.id}>
                        {field.name} ({field.unit})
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
              
              <div className="space-y-2">
                <Label>Condition *</Label>
                <Select value={operator} onValueChange={setOperator}>
                  <SelectTrigger data-testid="select-operator">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    {OPERATORS.map((op) => (
                      <SelectItem key={op.id} value={op.id}>
                        {op.symbol} {op.name}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="space-y-2">
                <Label>Threshold Value *</Label>
                <div className="flex items-center gap-2">
                  <Input
                    type="number"
                    placeholder="Enter value..."
                    value={thresholdValue}
                    onChange={(e) => setThresholdValue(e.target.value)}
                    data-testid="input-threshold"
                  />
                  <span className="text-sm text-gray-500 min-w-[60px]">
                    {getFieldUnit()}
                  </span>
                </div>
              </div>
              
              <div className="space-y-2">
                <Label>Severity Level</Label>
                <Select value={severity} onValueChange={setSeverity}>
                  <SelectTrigger data-testid="select-severity">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    {SEVERITY_LEVELS.map((level) => (
                      <SelectItem key={level.id} value={level.id}>
                        <div className="flex items-center gap-2">
                          <Badge className={level.color}>{level.name}</Badge>
                        </div>
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
                <p className="text-xs text-gray-500">
                  {SEVERITY_LEVELS.find(l => l.id === severity)?.description}
                </p>
              </div>
            </div>
            
            <div className="space-y-2">
              <Label>Monitoring Frequency</Label>
              <Select value={monitoringFrequency} onValueChange={setMonitoringFrequency}>
                <SelectTrigger data-testid="select-frequency">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  {MONITORING_FREQUENCIES.map((freq) => (
                    <SelectItem key={freq.id} value={freq.id}>
                      <div className="flex flex-col">
                        <span>{freq.name}</span>
                        <span className="text-xs text-gray-500">{freq.description}</span>
                      </div>
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
            
            {/* Preview */}
            {selectedField && thresholdValue && (
              <Card className="bg-gray-50 dark:bg-gray-800/50 border-dashed">
                <CardContent className="p-4">
                  <div className="flex items-center gap-2 mb-2">
                    <Eye className="h-4 w-4 text-gray-500" />
                    <span className="text-sm font-medium text-gray-600 dark:text-gray-400">Trigger Preview</span>
                  </div>
                  <p className="text-lg font-medium">
                    Alert when{' '}
                    <span className="text-blue-600">
                      {SIGNAL_FIELDS[selectedCategory]?.find(f => f.id === selectedField)?.name}
                    </span>{' '}
                    <span className="text-orange-600">
                      {OPERATORS.find(o => o.id === operator)?.symbol} {thresholdValue} {getFieldUnit()}
                    </span>
                  </p>
                </CardContent>
              </Card>
            )}
          </div>
        )}
        
        {/* Step 3: Notifications */}
        {step === 3 && (
          <div className="space-y-6">
            <div className="p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200">
              <div className="flex items-center gap-2">
                <Bell className="h-5 w-5 text-amber-600" />
                <span className="font-medium text-amber-800 dark:text-amber-200">
                  Configure how you want to be notified when this trigger fires
                </span>
              </div>
            </div>
            
            <div className="space-y-4">
              <Label className="text-lg font-semibold">Notification Channels</Label>
              
              <Card>
                <CardContent className="p-4 space-y-4">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <Mail className="h-5 w-5 text-blue-500" />
                      <div>
                        <p className="font-medium">Email Notifications</p>
                        <p className="text-sm text-gray-500">Send email alerts to configured recipients</p>
                      </div>
                    </div>
                    <Switch 
                      checked={emailEnabled} 
                      onCheckedChange={setEmailEnabled}
                      data-testid="switch-email"
                    />
                  </div>
                  
                  <Separator />
                  
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <MessageSquare className="h-5 w-5 text-purple-500" />
                      <div>
                        <p className="font-medium">Slack Notifications</p>
                        <p className="text-sm text-gray-500">Post alerts to Slack channels</p>
                      </div>
                    </div>
                    <Switch 
                      checked={slackEnabled} 
                      onCheckedChange={setSlackEnabled}
                      data-testid="switch-slack"
                    />
                  </div>
                  
                  <Separator />
                  
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <Smartphone className="h-5 w-5 text-green-500" />
                      <div>
                        <p className="font-medium">In-App Notifications</p>
                        <p className="text-sm text-gray-500">Show alerts in the M platform</p>
                      </div>
                    </div>
                    <Switch 
                      checked={inAppEnabled} 
                      onCheckedChange={setInAppEnabled}
                      data-testid="switch-in-app"
                    />
                  </div>
                  
                  <Separator />
                  
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <Webhook className="h-5 w-5 text-orange-500" />
                      <div>
                        <p className="font-medium">Webhook Integration</p>
                        <p className="text-sm text-gray-500">Send data to external systems via webhook</p>
                      </div>
                    </div>
                    <Switch 
                      checked={webhookEnabled} 
                      onCheckedChange={setWebhookEnabled}
                      data-testid="switch-webhook"
                    />
                  </div>
                </CardContent>
              </Card>
            </div>
            
            <div className="space-y-4">
              <Label className="text-lg font-semibold">Escalation Rules</Label>
              
              <Card>
                <CardContent className="p-4 space-y-4">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <TrendingUp className="h-5 w-5 text-red-500" />
                      <div>
                        <p className="font-medium">Auto-Escalate</p>
                        <p className="text-sm text-gray-500">Automatically escalate if not acknowledged</p>
                      </div>
                    </div>
                    <Switch 
                      checked={escalationEnabled} 
                      onCheckedChange={setEscalationEnabled}
                      data-testid="switch-escalation"
                    />
                  </div>
                  
                  {escalationEnabled && (
                    <div className="ml-8 space-y-2">
                      <Label>Escalation Timeout (minutes)</Label>
                      <Select value={escalationTimeout} onValueChange={setEscalationTimeout}>
                        <SelectTrigger className="w-48" data-testid="select-timeout">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="15">15 minutes</SelectItem>
                          <SelectItem value="30">30 minutes</SelectItem>
                          <SelectItem value="60">1 hour</SelectItem>
                          <SelectItem value="120">2 hours</SelectItem>
                          <SelectItem value="240">4 hours</SelectItem>
                        </SelectContent>
                      </Select>
                      <p className="text-xs text-gray-500">
                        Alert will be escalated to the next level if not acknowledged within this time
                      </p>
                    </div>
                  )}
                </CardContent>
              </Card>
            </div>
          </div>
        )}
        
        {/* Step 4: Playbook Mapping */}
        {step === 4 && (
          <div className="space-y-6">
            <div className="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200">
              <div className="flex items-center gap-2">
                <PlayCircle className="h-5 w-5 text-green-600" />
                <span className="font-medium text-green-800 dark:text-green-200">
                  Link playbooks to this trigger for faster response
                </span>
              </div>
            </div>
            
            <div className="flex items-center justify-between">
              <div>
                <Label className="text-lg font-semibold">Auto-Activate Playbook</Label>
                <p className="text-sm text-gray-500">Automatically activate selected playbook when trigger fires</p>
              </div>
              <Switch 
                checked={autoActivatePlaybook} 
                onCheckedChange={setAutoActivatePlaybook}
                data-testid="switch-auto-activate"
              />
            </div>
            
            <div className="space-y-4">
              <Label className="text-lg font-semibold">Recommended Playbooks</Label>
              <p className="text-sm text-gray-500">
                Select playbooks that should be suggested when this trigger fires
              </p>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3 max-h-[300px] overflow-y-auto">
                {Array.isArray(playbooks) && playbooks.length > 0 ? (
                  playbooks.map((playbook: any) => (
                    <Card 
                      key={playbook.id}
                      className={`cursor-pointer transition-all ${
                        selectedPlaybooks.includes(playbook.id)
                          ? 'ring-2 ring-green-600 bg-green-50 dark:bg-green-900/20'
                          : 'hover:shadow-md'
                      }`}
                      onClick={() => togglePlaybook(playbook.id)}
                      data-testid={`playbook-card-${playbook.id}`}
                    >
                      <CardContent className="p-4">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="font-medium">{playbook.name || playbook.title}</p>
                            <p className="text-sm text-gray-500">{playbook.category}</p>
                          </div>
                          {selectedPlaybooks.includes(playbook.id) && (
                            <Check className="h-5 w-5 text-green-600" />
                          )}
                        </div>
                      </CardContent>
                    </Card>
                  ))
                ) : (
                  <Card className="col-span-2">
                    <CardContent className="p-8 text-center">
                      <PlayCircle className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                      <p className="text-gray-600">No playbooks available</p>
                      <p className="text-sm text-gray-500">Create playbooks first to link them to triggers</p>
                    </CardContent>
                  </Card>
                )}
              </div>
            </div>
            
            {/* Summary */}
            <Card className="bg-gray-50 dark:bg-gray-800/50 border-dashed">
              <CardHeader>
                <CardTitle className="text-lg flex items-center gap-2">
                  <Settings className="h-5 w-5" />
                  Trigger Summary
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-3">
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <span className="text-gray-500">Name:</span>
                    <p className="font-medium">{triggerName}</p>
                  </div>
                  <div>
                    <span className="text-gray-500">Category:</span>
                    <p className="font-medium">{SIGNAL_CATEGORIES.find(c => c.id === selectedCategory)?.name}</p>
                  </div>
                  <div>
                    <span className="text-gray-500">Condition:</span>
                    <p className="font-medium">
                      {SIGNAL_FIELDS[selectedCategory]?.find(f => f.id === selectedField)?.name}{' '}
                      {OPERATORS.find(o => o.id === operator)?.symbol} {thresholdValue} {getFieldUnit()}
                    </p>
                  </div>
                  <div>
                    <span className="text-gray-500">Severity:</span>
                    <Badge className={SEVERITY_LEVELS.find(l => l.id === severity)?.color}>
                      {severity.toUpperCase()}
                    </Badge>
                  </div>
                  <div>
                    <span className="text-gray-500">Notifications:</span>
                    <div className="flex gap-1 mt-1">
                      {emailEnabled && <Badge variant="outline">Email</Badge>}
                      {slackEnabled && <Badge variant="outline">Slack</Badge>}
                      {inAppEnabled && <Badge variant="outline">In-App</Badge>}
                      {webhookEnabled && <Badge variant="outline">Webhook</Badge>}
                    </div>
                  </div>
                  <div>
                    <span className="text-gray-500">Linked Playbooks:</span>
                    <p className="font-medium">{selectedPlaybooks.length} selected</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        )}
        
        {/* Navigation buttons */}
        <div className="flex justify-between mt-6 pt-4 border-t">
          <Button 
            variant="outline" 
            onClick={handleBack}
            disabled={step === 1}
            data-testid="button-back"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Back
          </Button>
          
          <div className="flex gap-2">
            <Button 
              variant="outline" 
              onClick={handleClose}
              data-testid="button-cancel"
            >
              Cancel
            </Button>
            <Button 
              onClick={handleNext}
              disabled={!canProceed() || createTriggerMutation.isPending}
              data-testid="button-next"
            >
              {createTriggerMutation.isPending ? (
                'Creating...'
              ) : step === totalSteps ? (
                <>
                  <Check className="h-4 w-4 mr-2" />
                  Create Trigger
                </>
              ) : (
                <>
                  Next
                  <ArrowRight className="h-4 w-4 ml-2" />
                </>
              )}
            </Button>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
}



========================================
FILE: Enterprise Task Library UI Components (for Try It Demo)
========================================

// Phase Filter Component for Task Library
<div className="grid grid-cols-2 md:grid-cols-4 gap-3" data-testid="phase-filter-buttons">
  {(Object.keys(TASK_PHASES) as TaskPhase[]).map((phase) => {
    const phaseConfig = TASK_PHASES[phase];
    const phaseTasks = ENTERPRISE_TASK_LIBRARY.filter(t => t.phase === phase);
    return (
      <Button
        key={phase}
        variant={selectedPhase === phase ? "default" : "outline"}
        className="h-auto py-3 flex flex-col items-center gap-1"
        onClick={() => setSelectedPhase(phase === selectedPhase ? 'all' : phase)}
        data-testid={`button-phase-${phase}`}
      >
        <span className={`text-xs font-bold ${phaseConfig.color}`}>
          {phaseConfig.label}
        </span>
        <span className="text-xs text-slate-500">{phaseTasks.length} tasks</span>
      </Button>
    );
  })}
</div>

// Task Library Card with Add functionality
{filteredLibraryTasks.map((template) => {
  const phaseConfig = TASK_PHASES[template.phase];
  const categoryConfig = TASK_CATEGORIES[template.category];
  const isAdded = addedLibraryIds.has(template.id);
  
  return (
    <Card 
      key={template.id}
      className={`transition-all ${isAdded ? 'opacity-60 bg-green-50 dark:bg-green-950/20' : 'hover:shadow-md'}`}
      data-testid={`card-library-task-${template.id}`}
    >
      <CardContent className="p-4">
        <div className="flex items-start justify-between gap-3">
          <div className="flex-1 min-w-0">
            <div className="flex items-center gap-2 mb-1">
              <span className={`text-xs font-bold ${phaseConfig.color}`}>
                {phaseConfig.label}
              </span>
              <Badge className={`text-xs ${categoryConfig.color}`}>
                {categoryConfig.label}
              </Badge>
            </div>
            <h3 className="font-semibold text-sm text-slate-900 dark:text-white">
              {template.title}
            </h3>
            <p className="text-xs text-slate-500 dark:text-slate-400 line-clamp-2 mt-1">
              {template.description}
            </p>
            <div className="flex flex-wrap gap-1.5 mt-2">
              <Badge variant="outline" className="text-xs">
                <Users className="h-3 w-3 mr-1" />
                {template.suggestedOwner}
              </Badge>
              <Badge variant="outline" className="text-xs">
                <Clock className="h-3 w-3 mr-1" />
                {template.estimatedMinutes}m
              </Badge>
              <Badge variant="outline" className={`text-xs ${
                template.priority === 'critical' ? 'border-red-300 text-red-600' :
                template.priority === 'high' ? 'border-orange-300 text-orange-600' :
                'border-slate-300 text-slate-600'
              }`}>
                {template.priority}
              </Badge>
            </div>
          </div>
          <Button
            size="sm"
            variant={isAdded ? "ghost" : "default"}
            disabled={isAdded}
            onClick={() => handleAddFromLibrary(template)}
            data-testid={`button-add-library-task-${template.id}`}
          >
            {isAdded ? (
              <><CheckCircle2 className="h-4 w-4 mr-1" />Added</>
            ) : (
              <><Plus className="h-4 w-4 mr-1" />Add</>
            )}
          </Button>
        </div>
      </CardContent>
    </Card>
  );
})}

